PR_TITLE,DIFF_CODE,IS_REVERSED
NPE fix: DayPickerView accessibilityAnnouncePageChanged()," 
     void accessibilityAnnouncePageChanged() {
         MonthView mv = getMostVisibleMonth();
+        if (mv != null) {
         String monthYear = getMonthAndYearString(mv.mMonth, mv.mYear, mController.getLocale());
         Utils.tryAccessibilityAnnounce(this, monthYear);
     }
+    }
 
     private static String getMonthAndYearString(int month, int year, Locale locale) {
         Calendar calendar = Calendar.getInstance();",0
"Fix NPE in PDE, affecting color picker and other Tools.","           render();
         } else {
           Graphics screen = getGraphics();
+          if (screen != null) {
           screen.drawImage(g.image, 0, 0, width, height, null);
         }
+        }
       } else {
         repaint();
       }",0
[BACKLOG-16118] Fixed issue with field lengths in text input,"     boolean bEndedLineWrote = false;
     boolean fileExist;
     Object[] r = getRow(); // This also waits for a row to be finished.
-    if ( r != null ) {
+    if ( r != null && meta.getOutputFields().length == 0 ) {
       data.outputRowMeta = getInputRowMeta().clone();
     }
     if ( r != null && first ) {
+      data.outputRowMeta = getInputRowMeta().clone();
       first = false;
       meta.getFields( data.outputRowMeta, getStepname(), null, null, this, repository, metaStore );
 ",0
Fix #670: Use Files.move instead of File.rename to move files," import java.io.File;
 import java.io.FileNotFoundException;
 import java.io.IOException;
+import java.nio.file.Files;
+import java.nio.file.StandardCopyOption;
 import java.util.Arrays;
 
 import org.apache.commons.io.FileUtils;
@@ -151,7 +153,12 @@
 
                 File destination = new File(destinationDirectory, ""node"");
                 this.logger.info(""Copying node binary from {} to {}"", nodeBinary, destination);
-                if (!nodeBinary.renameTo(destination)) {
+                if (destination.exists() && !destination.delete()) {
+                    throw new InstallationException(""Could not install Node: Was not allowed to delete "" + destination);
+                }
+                try {
+                    Files.move(nodeBinary.toPath(), destination.toPath(), StandardCopyOption.REPLACE_EXISTING);
+                } catch (IOException e) {
                     throw new InstallationException(""Could not install Node: Was not allowed to rename ""
                         + nodeBinary + "" to "" + destination);
                 }
@@ -219,7 +226,9 @@
 
                 File destination = new File(destinationDirectory, ""node.exe"");
                 this.logger.info(""Copying node binary from {} to {}"", nodeBinary, destination);
-                if (!nodeBinary.renameTo(destination)) {
+                try {
+                    Files.move(nodeBinary.toPath(), destination.toPath(), StandardCopyOption.REPLACE_EXISTING);
+                } catch (IOException e) {
                     throw new InstallationException(""Could not install Node: Was not allowed to rename ""
                         + nodeBinary + "" to "" + destination);
                 }",0
Fix possible NPE in configuration when no db props are provided," 
 import org.apereo.cas.authentication.adaptive.geo.GeoLocationService;
 import org.apereo.cas.configuration.CasConfigurationProperties;
-import org.apereo.cas.configuration.model.support.geo.maxmind.MaxmindProperties;
 import org.apereo.cas.support.geo.maxmind.MaxmindDatabaseGeoLocationService;
 
 import com.maxmind.db.CHMCache;
@@ -14,6 +13,7 @@
 import org.springframework.cloud.context.config.annotation.RefreshScope;
 import org.springframework.context.annotation.Bean;
 import org.springframework.context.annotation.Configuration;
+import org.springframework.core.io.Resource;
 
 import java.io.IOException;
 
@@ -27,16 +27,20 @@
 @EnableConfigurationProperties(CasConfigurationProperties.class)
 public class CasGeoLocationConfiguration {
 
-    @Autowired
     private CasConfigurationProperties casProperties;
 
+    @Autowired
+    public CasGeoLocationConfiguration(final CasConfigurationProperties casProperties) {
+        this.casProperties = casProperties;
+    }
+
     @Bean
     @RefreshScope
     @SneakyThrows
     public GeoLocationService geoLocationService() {
         val properties = casProperties.getMaxmind();
-        val cityDatabase = readCityDatabase(properties);
-        val countryDatabase = readCountryDatabase(properties);
+        val cityDatabase = readDatabase(properties.getCityDatabase());
+        val countryDatabase = readDatabase(properties.getCountryDatabase());
 
         if (cityDatabase == null && countryDatabase == null) {
             throw new IllegalArgumentException(""No geolocation services have been defined for Maxmind"");
@@ -47,16 +51,9 @@
         return svc;
     }
 
-    private DatabaseReader readCountryDatabase(final MaxmindProperties properties) throws IOException {
-        if (properties.getCountryDatabase().exists()) {
-            return new DatabaseReader.Builder(properties.getCountryDatabase().getFile()).withCache(new CHMCache()).build();
-        }
-        return null;
-    }
-
-    private DatabaseReader readCityDatabase(final MaxmindProperties properties) throws IOException {
-        if (properties.getCityDatabase().exists()) {
-            return new DatabaseReader.Builder(properties.getCityDatabase().getFile()).withCache(new CHMCache()).build();
+    private DatabaseReader readDatabase(final Resource maxmindDatabase) throws IOException {
+        if (maxmindDatabase != null && maxmindDatabase.exists()) {
+            return new DatabaseReader.Builder(maxmindDatabase.getFile()).withCache(new CHMCache()).build();
         }
         return null;
     }",0
fix potential wakelock," 		Context context = getApplicationContext();
 
 		// Get the class to call
-		String implemenationClass = context.getSharedPreferences(""EndlessJabberSDK"", Context.MODE_PRIVATE).getString(""InterfaceClass"", null);
+        String implementationClass = context.getSharedPreferences(""EndlessJabberSDK"", Context.MODE_PRIVATE).getString(""InterfaceClass"", null);
 
-		if (implemenationClass == null) {
-			return;
-		}
-
+        if (implementationClass != null) {
 		IEndlessJabberImplementation instanceOfMyClass;
 		try {
-			instanceOfMyClass = (IEndlessJabberImplementation) Class.forName(implemenationClass).newInstance();
+                instanceOfMyClass = (IEndlessJabberImplementation) Class.forName(implementationClass).newInstance();
 
 			Bundle extras = intent.getExtras();
 
@@ -69,10 +66,14 @@
 				break;
 			}
 			}
-		} catch (InstantiationException | IllegalAccessException | ClassNotFoundException e) {
+            } catch (InstantiationException e) {
+
+            } catch (IllegalAccessException e) {
+
+            } catch (ClassNotFoundException e) {
 
 		}
-
+        }
 		EndlessJabberReceiver.completeWakefulIntent(intent);
 	}
 }",0
fix bean config," 
 import org.springframework.context.annotation.Bean;
 import org.springframework.context.annotation.Configuration;
+import org.springframework.context.annotation.Profile;
 import org.springframework.security.authentication.AuthenticationManager;
 import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
 
 @Configuration
+@Profile(""!authz"")
 public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter {
 
     @Bean",0
Fix intermittent scans,"     private long mLastScanCycleEndTime = 0l;
     protected long mNextScanCycleStartTime = 0l;
     private long mScanCycleStopTime = 0l;
-    private long mLastScanStopTime = 0l;
 
     private boolean mScanning;
     protected boolean mScanningPaused;
@@ -271,23 +270,22 @@
             if (mScanning) {
                 if (getBluetoothAdapter() != null) {
                     if (getBluetoothAdapter().isEnabled()) {
-                        long now = System.currentTimeMillis();
+                        long now = SystemClock.elapsedRealtime();
                         if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.N &&
                                 mBetweenScanPeriod+mScanPeriod < ANDROID_N_MIN_SCAN_CYCLE_MILLIS &&
-                                now-mLastScanStopTime < ANDROID_N_MIN_SCAN_CYCLE_MILLIS) {
+                                now-mLastScanCycleStartTime < ANDROID_N_MIN_SCAN_CYCLE_MILLIS) {
                             // As of Android N, only 5 scans may be started in a 30 second period (6
                             // seconds per cycle)  otherwise they are blocked.  So we check here to see
                             // if the scan period is 6 seconds or less, and if we last stopped scanning
                             // fewer than 6 seconds ag and if so, we simply do not stop scanning
                             LogManager.d(TAG, ""Not stopping scan because this is Android N and we"" +
                                     "" keep scanning for a minimum of 6 seconds at a time. ""+
-                                    ""We will stop in ""+(ANDROID_N_MIN_SCAN_CYCLE_MILLIS-(now-mLastScanStopTime))+"" millisconds."");
+                                    ""We will stop in ""+(ANDROID_N_MIN_SCAN_CYCLE_MILLIS-(now-mLastScanCycleStartTime))+"" millisconds."");
                         }
                         else {
                             try {
                                 LogManager.d(TAG, ""stopping bluetooth le scan"");
                                 finishScan();
-                                mLastScanStopTime = now;
                             } catch (Exception e) {
                                 LogManager.w(e, TAG, ""Internal Android exception scanning for beacons"");
                             }",0
Fixes javadoc typo,"      * @param predicate A {@code Predicate} that tests elements of type {@code T}
      * @param <T>       tested object type
      * @return A new {@code Predicate}
-     * @throws NullPointerException if {@code values} is predicate
+     * @throws NullPointerException if {@code predicate} is null
      */
     @SuppressWarnings(""unchecked"")
     public static <T> Predicate<T> not(Predicate<? super T> predicate) {",0
Fixed the scope caching error," import io.undertow.client.ClientRequest;
 import io.undertow.util.HeaderValues;
 
+import java.util.Arrays;
+import java.util.HashSet;
 import java.util.Map;
+import java.util.Set;
 
 /**
  * This class is a singleton to manage ALL tokens.
@@ -101,7 +104,10 @@
     public Result<Jwt> getJwt(ClientRequest clientRequest) {
         HeaderValues scope = clientRequest.getRequestHeaders().get(OauthHelper.SCOPE);
         if(scope != null) {
-            return getJwt(new Jwt.Key(scope.getFirst()));
+            String scopeStr = scope.getFirst();
+            Set<String> scopeSet = new HashSet<>();
+            scopeSet.addAll(Arrays.asList(scopeStr.split("" "")));
+            return getJwt(new Jwt.Key(scopeSet));
         }
         HeaderValues serviceId = clientRequest.getRequestHeaders().get(OauthHelper.SERVICE_ID);
         if(serviceId != null) {",0
Fix - Remove Timezone Fix," import java.util.Calendar;
 import java.util.Collection;
 import java.util.List;
-import java.util.TimeZone;
 
 import static com.prolificinteractive.materialcalendarview.MaterialCalendarView.SHOW_DEFAULTS;
 import static com.prolificinteractive.materialcalendarview.MaterialCalendarView.showOtherMonths;
@@ -27,8 +26,9 @@
     protected static final int DEFAULT_DAYS_IN_WEEK = 7;
     protected static final int DEFAULT_MAX_WEEKS = 6;
     protected static final int DAY_NAMES_ROW = 1;
+
     private static final Calendar tempWorkingCalendar = CalendarUtils.getInstance();
-    private static final String TIME_ZONE_DEFAULT = ""UTC"";
+
     private final ArrayList<WeekDayView> weekDayViews = new ArrayList<>();
     private final ArrayList<DecoratorResult> decoratorResults = new ArrayList<>();
     @ShowOtherDates
@@ -52,15 +52,6 @@
         this.firstDayOfWeek = firstDayOfWeek;
         this.showWeekDays = showWeekDays;
 
-        /*
-         *   Set the defaultTimeZone to avoid wrong calculations that are positioning the last day of the
-         *   previous month on the first day of the current month when changing the TimeZone of the device
-         *
-         *   It's recommended that when manipulating Date objects that TimeZone could change according to
-         *   device configuration to use a default TimeZone to do the calculations.
-         */
-        TimeZone.setDefault(TimeZone.getTimeZone(TIME_ZONE_DEFAULT));
-
         setClipChildren(false);
         setClipToPadding(false);
 ",0
Fix bug 112 - Gravity incorrectly applied," import android.graphics.Typeface;
 import android.graphics.drawable.BitmapDrawable;
 import android.util.TypedValue;
+import android.view.Gravity;
 import android.view.View;
 import android.view.View.OnClickListener;
 import android.view.ViewGroup;
@@ -821,7 +822,7 @@
   private RelativeLayout initializeContentView(final Resources resources) {
     RelativeLayout contentView = new RelativeLayout(this.activity);
     contentView.setLayoutParams(new RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.MATCH_PARENT,
-      RelativeLayout.LayoutParams.WRAP_CONTENT));
+      RelativeLayout.LayoutParams.MATCH_PARENT));
 
     // set padding
     int padding = this.style.paddingInPixels;
@@ -847,6 +848,11 @@
     if (null != image) {
       textParams.addRule(RelativeLayout.RIGHT_OF, image.getId());
     }
+    
+    if (this.style.gravity == Gravity.CENTER) textParams.addRule(RelativeLayout.CENTER_IN_PARENT);
+    else if (this.style.gravity == Gravity.CENTER_VERTICAL) textParams.addRule(RelativeLayout.CENTER_VERTICAL);
+    else if (this.style.gravity == Gravity.CENTER_HORIZONTAL) textParams.addRule(RelativeLayout.CENTER_HORIZONTAL);
+
     contentView.addView(text, textParams);
     return contentView;
   }",0
Fix crash when using other su,"         Context de = Build.VERSION.SDK_INT >= Build.VERSION_CODES.N
                 ? mm.createDeviceProtectedStorageContext() : mm;
         if (!MANAGER_DB.canWrite()) {
-            if (!Shell.rootAccess()) {
+            if (!Shell.rootAccess() || Data.magiskVersionCode < 0) {
                 // We don't want the app to crash, create a db and return
                 return mm.openOrCreateDatabase(""su.db"", Context.MODE_PRIVATE, null);
             }",0
Postgres clean drop all types,"             jdbcTemplate.execute(statement);
         }
 
-        for (Type type : allTypes()) {
-            type.drop();
-        }
     }
 
     /**",0
#8120 - Fixing failing agent tests," import java.io.File;
 import java.io.FileInputStream;
 import java.io.IOException;
+import java.io.InputStream;
 import java.security.MessageDigest;
 import javax.servlet.ServletException;
 import javax.servlet.http.HttpServlet;
@@ -28,6 +29,8 @@
 import org.apache.commons.codec.binary.Base64;
 import org.apache.commons.io.IOUtils;
 
+import static com.thoughtworks.go.util.FileDigester.md5DigestOfStream;
+
 public class AgentBinariesServlet extends HttpServlet {
 
     private File file;
@@ -47,8 +50,7 @@
     protected void doHead(HttpServletRequest request, HttpServletResponse response)
             throws ServletException, IOException {
         try {
-            response.setHeader(""Content-MD5"",
-                    new String(new Base64().encode(MessageDigest.getInstance(""MD5"").digest(getAgentAsByteStream()))));
+            response.setHeader(""Content-MD5"", md5DigestOfStream(new FileInputStream(file)));
             response.setHeader(""Cruise-Server-Ssl-Port"", ""9443"");
         } catch (Exception e) {
             throw new RuntimeException(e);",0
修改心跳检查Bug，没有判断数据库切换类型," 		lastSendQryTime = System.currentTimeMillis();
 		MySQLDataSource ds = heartbeat.getSource();
 		String databaseName = ds.getDbPool().getSchemas()[0];
-
+		String[] fetchColms={};
+		if (heartbeat.getSource().getHostConfig().getSwitchType() == DataHostConfig.SYN_STATUS_SWITCH_DS) {
+			fetchColms=MYSQL_SLAVE_STAUTS_COLMS;
+		}
 		OneRawSQLQueryResultHandler resultHandler = new OneRawSQLQueryResultHandler(
-				MYSQL_SLAVE_STAUTS_COLMS, this);
+				fetchColms, this);
 		sqlJob = new SQLJob(heartbeat.getHeartbeatSQL(), databaseName,
 				resultHandler, ds);
 		sqlJob.run();",0
Fix Uncategorized warning message,"     if (category == null)
       category = ""Uncategorized"";
     if (!CATEGORIES.contains(category)) {
-      category = ""Uncategorized"";
       System.out.println(""WARNING: Category '"" + category + ""' in library "" +
               properties.get(""name"") + "" is not valid. Setting to 'Uncategorized'"");
+      category = ""Uncategorized"";
     }
 
     String license = properties.get(""license"");",0
Fix non working dialogs," 
     @Override
     public <T extends CoreScreenLayer> T createScreen(ResourceUrn screenUri, Class<T> expectedType) {
-        boolean existsAlready = assetManager.isLoaded(screenUri, UIElement.class);
+        boolean existsAlready = !screenUri.isInstance() && assetManager.isLoaded(screenUri, UIElement.class);
 
         Optional<UIElement> opt = Assets.get(screenUri, UIElement.class);
         if (!opt.isPresent()) {",0
fix for: java.lang.NullPointerException: Attempt to get length of null array,"         private SavedState(Parcel in) {
             super(in);
             mInputPointer = in.readInt();
+            int size = in.readInt();
+            if (size > 0) {
+                mInput = new int[size];
             in.readIntArray(mInput);
+            }
             mSign = in.readInt();
         }
 
+
         @Override
         public void writeToParcel(Parcel dest, int flags) {
             super.writeToParcel(dest, flags);
             dest.writeInt(mInputPointer);
+            if (mInput != null) {
+                dest.writeInt(mInput.length);
             dest.writeIntArray(mInput);
+            } else {
+                dest.writeInt(0);
+            }
             dest.writeInt(mSign);
         }
 ",0
Fixed race condition with NPE on Producer.closeAsync()," 
         stats.cancelStatsTimeout();
 
-        if (getClientCnx() == null || currentState != State.Ready) {
+        ClientCnx cnx = cnx();
+        if (cnx == null || currentState != State.Ready) {
             log.info(""[{}] [{}] Closed Producer (not connected)"", topic, producerName);
             synchronized (this) {
                 setState(State.Closed);
@@ -428,7 +429,6 @@
         ByteBuf cmd = Commands.newCloseProducer(producerId, requestId);
 
         CompletableFuture<Void> closeFuture = new CompletableFuture<>();
-        ClientCnx cnx = cnx();
         cnx.sendRequestWithId(cmd, requestId).handle((v, exception) -> {
             cnx.removeProducer(producerId);
             if (exception == null || !cnx.ctx().channel().isActive()) {",0
Fix delete button not working on error views - also move deletion logic to their own methods,"     startActivity(Intent.createChooser(intent, getString(R.string.leak_canary_share_with)));
   }
 
+  void deleteVisibleLeak() {
+    Leak visibleLeak = getVisibleLeak();
+    File heapDumpFile = visibleLeak.heapDump.heapDumpFile;
+    File resultFile = visibleLeak.resultFile;
+    boolean resultDeleted = resultFile.delete();
+    if (!resultDeleted) {
+      CanaryLog.d(""Could not delete result file %s"", resultFile.getPath());
+    }
+    boolean heapDumpDeleted = heapDumpFile.delete();
+    if (!heapDumpDeleted) {
+      CanaryLog.d(""Could not delete heap dump file %s"", heapDumpFile.getPath());
+    }
+    visibleLeakRefKey = null;
+    leaks.remove(visibleLeak);
+    updateUi();
+  }
+
+  void deleteAllLeaks() {
+    File leakDirectory = getLeakDirectory(DisplayLeakActivity.this);
+    File[] files = leakDirectory.listFiles();
+    if (files != null) {
+      for (File file : files) {
+        boolean deleted = file.delete();
+        if (!deleted) {
+          CanaryLog.d(""Could not delete file %s"", file.getPath());
+        }
+      }
+    }
+    leaks = Collections.emptyList();
+    updateUi();
+  }
+
   void updateUi() {
     if (leaks == null) {
       setTitle(""Loading leaks..."");
@@ -249,6 +281,12 @@
         getActionBar().setDisplayHomeAsUpEnabled(true);
         actionButton.setVisibility(VISIBLE);
         actionButton.setText(R.string.leak_canary_delete);
+        actionButton.setOnClickListener(new View.OnClickListener() {
+          @Override
+          public void onClick(View v) {
+            deleteVisibleLeak();
+          }
+        });
         listView.setAdapter(null);
       } else {
         final DisplayLeakAdapter adapter;
@@ -269,20 +307,7 @@
           actionButton.setText(R.string.leak_canary_delete);
           actionButton.setOnClickListener(new View.OnClickListener() {
             @Override public void onClick(View v) {
-              Leak visibleLeak = getVisibleLeak();
-              File heapDumpFile = visibleLeak.heapDump.heapDumpFile;
-              File resultFile = visibleLeak.resultFile;
-              boolean resultDeleted = resultFile.delete();
-              if (!resultDeleted) {
-                CanaryLog.d(""Could not delete result file %s"", resultFile.getPath());
-              }
-              boolean heapDumpDeleted = heapDumpFile.delete();
-              if (!heapDumpDeleted) {
-                CanaryLog.d(""Could not delete heap dump file %s"", heapDumpFile.getPath());
-              }
-              visibleLeakRefKey = null;
-              leaks.remove(visibleLeak);
-              updateUi();
+              deleteVisibleLeak();
             }
           });
         }
@@ -311,18 +336,7 @@
         actionButton.setText(R.string.leak_canary_delete_all);
         actionButton.setOnClickListener(new View.OnClickListener() {
           @Override public void onClick(View v) {
-            File leakDirectory = getLeakDirectory(DisplayLeakActivity.this);
-            File[] files = leakDirectory.listFiles();
-            if (files != null) {
-              for (File file : files) {
-                boolean deleted = file.delete();
-                if (!deleted) {
-                  CanaryLog.d(""Could not delete file %s"", file.getPath());
-                }
-              }
-            }
-            leaks = Collections.emptyList();
-            updateUi();
+            deleteAllLeaks();
           }
         });
       }",0
"fix : remove all actions present in ""ActionList"", before only first element is removed","      * @param evaluateActionId the evaluate action id
      * @return the action
      */
-    public Action createEvaluateActionForExistingActionState(final Flow flow, final String actionStateId,
-                                                             final String evaluateActionId) {
+    public Action createEvaluateActionForExistingActionState(final Flow flow, final String actionStateId, final String evaluateActionId) {
         final ActionState action = getState(flow, actionStateId, ActionState.class);
-        final List<Action> actions = StreamSupport.stream(action.getActionList().spliterator(), false)
-                .collect(Collectors.toList());
+        final Action[] actions = action.getActionList().toArray();
+        Arrays.stream(actions).forEach(action.getActionList()::remove);
         final Action evaluateAction = createEvaluateAction(evaluateActionId);
-        actions.add(0, evaluateAction);
-        action.getActionList().forEach(a -> action.getActionList().remove(a));
-        actions.forEach(action.getActionList()::add);
+        action.getActionList().add(evaluateAction);
+        action.getActionList().addAll(actions);
         return evaluateAction;
     }
 ",0
HBASE-22179 Fix RawAsyncHBaseAdmin.getCompactionState," import java.util.Set;
 import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.ConcurrentHashMap;
+import java.util.concurrent.ConcurrentLinkedQueue;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicReference;
 import java.util.function.BiConsumer;
@@ -406,7 +407,7 @@
       @Override
       public void run(PRESP resp) {
         if (controller.failed()) {
-          future.completeExceptionally(new IOException(controller.errorText()));
+          future.completeExceptionally(controller.getFailed());
         } else {
           try {
             future.complete(respConverter.convert(resp));
@@ -2937,7 +2938,7 @@
             future.completeExceptionally(err);
             return;
           }
-          List<CompactionState> regionStates = new ArrayList<>();
+          ConcurrentLinkedQueue<CompactionState> regionStates = new ConcurrentLinkedQueue<>();
           List<CompletableFuture<CompactionState>> futures = new ArrayList<>();
           locations.stream().filter(loc -> loc.getServerName() != null)
             .filter(loc -> loc.getRegion() != null).filter(loc -> !loc.getRegion().isOffline())
@@ -2979,11 +2980,11 @@
                     case NONE:
                     default:
                   }
+                }
                   if (!future.isDone()) {
                     future.complete(state);
                   }
                 }
-              }
             });
         });
         break;",0
leak assign schema in MessageImpl constructor,"         this.cnx = null;
         this.payload = payload;
         this.properties = Collections.unmodifiableMap(properties);
+        this.schema = schema;
     }
 
     public static MessageImpl<byte[]> deserialize(ByteBuf headersAndPayload) throws IOException {",0
migrate task fix bug," import com.alibaba.fastjson.JSON;
 import com.alibaba.fastjson.JSONArray;
 import com.google.common.base.Splitter;
+import com.google.common.base.Strings;
 import com.google.common.collect.Lists;
 import io.mycat.MycatServer;
 import io.mycat.config.loader.zkprocess.comm.ZkConfig;
@@ -113,18 +114,18 @@
 
             List<String> dataNodeList= ZKUtils.getConnection().getChildren().forPath(event.getData().getPath());
             if(!dataNodeList.isEmpty())    {
-            TaskNode taskNode=         JSON.parseObject(
-                    text,TaskNode.class);
+                if ((!Strings.isNullOrEmpty(text) )&& text.startsWith(""{"")) {
+                    TaskNode taskNode = JSON.parseObject(text, TaskNode.class);
             if(taskNode.getStatus()==0) {
              String boosterDataHosts=   ZkConfig.getInstance().getValue(ZkParamCfg.MYCAT_BOOSTER_DATAHOSTS) ;
                 Set<String> dataNodes=new HashSet<>(Splitter.on("","").trimResults().omitEmptyStrings().splitToList(boosterDataHosts)) ;
                 List<MigrateTask> finalMigrateList=new ArrayList<>();
                 for (String s : dataNodeList) {
-                    if(""_prepare"".equals(s))continue;
+                            if (""_prepare"".equals(s))
+                                continue;
                     if(dataNodes.contains(s)) {
                         String zkpath = event.getData().getPath() + ""/"" + s;
-                        String data=new String(ZKUtils.getConnection().getData().forPath(
-                                zkpath),""UTF-8"");
+                                String data = new String(ZKUtils.getConnection().getData().forPath(zkpath), ""UTF-8"");
                         List<MigrateTask> migrateTaskList= JSONArray.parseArray(data,MigrateTask.class);
                         for (MigrateTask migrateTask : migrateTaskList) {
                             migrateTask.setZkpath(zkpath);
@@ -133,7 +134,6 @@
                     }
                 }
 
-
                 Map<String, List<MigrateTask> > taskMap=mergerTaskForDataHost(finalMigrateList);
                 for (Map.Entry<String, List<MigrateTask>> stringListEntry : taskMap.entrySet()) {
                     String key=stringListEntry.getKey();
@@ -141,7 +141,6 @@
                     MycatServer.getInstance().getBusinessExecutor().submit(new MigrateMainRunner(key,value)) ;
                 }
 
-
                 //
                 taskNode.setStatus(1);
                 ZKUtils.getConnection().setData().forPath(event.getData().getPath(),JSON.toJSONBytes(taskNode));
@@ -154,11 +153,13 @@
                     List<String> dataHosts=  ZKUtils.getConnection().getChildren().forPath(tpath);
                     List<MigrateTask> allTaskList=MigrateUtils.queryAllTask(tpath,removeStatusNode(dataHosts));
                     allRunnerSet.add(taskID);
-                    scheduledExecutorService.schedule(new SwitchPrepareCheckRunner(taskID,tpath,taskNode, MigrateUtils.convertAllTask(allTaskList)),1,TimeUnit.SECONDS);
+                            scheduledExecutorService.schedule(new SwitchPrepareCheckRunner(taskID, tpath, taskNode,
+                                    MigrateUtils.convertAllTask(allTaskList)), 1, TimeUnit.SECONDS);
 
                 }
             }
             }
+            }
             }finally {
                  if(taskLock!=null){
                      taskLock.release();",0
MINOR: Fix javadoc typo,"      * Removes all headers for the given key returning if the operation succeeded.
      * 
      * @param key to remove all headers for.
-     * @return this instance of the Headers, once the header is added.
+     * @return this instance of the Headers, once the header is removed.
      * @throws IllegalStateException is thrown if headers are in a read-only state.
      */
     Headers remove(String key) throws IllegalStateException;",0
Fix crash for anonymous crashes,"         String parentClassName = classObj.getSuperClassObj().getClassName();
         if (Object.class.getName().equals(parentClassName)) {
           holderType = OBJECT;
-          // This is an anonymous class implementing an interface. The API does not give access
-          // to the interfaces implemented by the class. Let's see if it's in the class path and
-          // use that instead.
           try {
+            // This is an anonymous class implementing an interface. The API does not give access
+            // to the interfaces implemented by the class. We check if it's in the class path and
+            // use that instead.
             Class<?> actualClass = Class.forName(classObj.getClassName());
-            Class<?> implementedInterface = actualClass.getInterfaces()[0];
+            Class<?>[] interfaces = actualClass.getInterfaces();
+            if (interfaces.length > 0) {
+              Class<?> implementedInterface = interfaces[0];
             extra = ""(anonymous class implements "" + implementedInterface.getName() + "")"";
+            } else {
+              extra = ""(anonymous class extends java.lang.Object)"";
+            }
           } catch (ClassNotFoundException ignored) {
           }
         } else {",0
Added Video Framerate to Fix 'prepare' crash,"     recorder = new MediaRecorder();
     recorder.setVideoSource(SURFACE);
     recorder.setOutputFormat(MPEG_4);
+    recorder.setVideoFrameRate(30);
     recorder.setVideoEncoder(H264);
     recorder.setVideoSize(displayWidth, displayHeight);
     recorder.setVideoEncodingBitRate(8 * 1000 * 1000);",0
	fix配置不切换时，重启mycat会导致自动切换的bug,"         for (int i = 0; i < writeSources.length; i++) {
             int j = loop(i + index);
             if (initSource(j, writeSources[j])) {
+                //不切换-1时，如果主写挂了   不允许切换过去
+                if(dataHostConfig.getSwitchType()==DataHostConfig.NOT_SWITCH_DS&&j>0)
+                {
+                    break;
+                }
                 active = j;
                 activedIndex = active;
                 initSuccess = true;",0
Pass on exit code in WebSocketClient close function - fixes bug #827," 
 	@Override
 	public void close( int code ) {
-		engine.close();
+		engine.close( code );
 	}
 
 	@Override",0
Fixes #1587 : Remove unnecessary loop from InjectingAnnotationEngine,"      */
     public void process(Class<?> clazz, Object testInstance) {
         processIndependentAnnotations(testInstance.getClass(), testInstance);
-        processInjectMocks(testInstance.getClass(), testInstance);
-    }
-
-    private void processInjectMocks(final Class<?> clazz, final Object testInstance) {
-        Class<?> classContext = clazz;
-        while (classContext != Object.class) {
             injectMocks(testInstance);
-            classContext = classContext.getSuperclass();
-        }
     }
 
     private void processIndependentAnnotations(final Class<?> clazz, final Object testInstance) {",0
Fix service declaration,"     // Execute in the next second.
     Bundle extra = new Bundle(1);
     extra.putParcelable(INTENT_KEY, intent);
-    int did = scheduler.schedule(new JobInfo.Builder(JOB_SERVICE_ID, new ComponentName(context, PushService.class))
+    int did = scheduler.schedule(new JobInfo.Builder(JOB_SERVICE_ID, new ComponentName(context, PushServiceApi26.class))
         .setMinimumLatency(1L)
         .setOverrideDeadline(1000L)
         .setRequiresCharging(false)",0
上次改编码问题改出的代码BUG，会导致新文件上传不了,,0
Reset bug counter on session changes,"  */
 package org.zaproxy.zap.extension.log4j;
 
+import java.awt.EventQueue;
 import java.net.MalformedURLException;
 import java.net.URL;
 
@@ -24,8 +25,11 @@
 
 import org.apache.log4j.Logger;
 import org.parosproxy.paros.Constant;
+import org.parosproxy.paros.control.Control.Mode;
 import org.parosproxy.paros.extension.ExtensionAdaptor;
 import org.parosproxy.paros.extension.ExtensionHook;
+import org.parosproxy.paros.extension.SessionChangedListener;
+import org.parosproxy.paros.model.Session;
 import org.parosproxy.paros.view.View;
 import org.zaproxy.zap.view.ScanStatus;
 import org.zaproxy.zap.view.ZapMenuItem;
@@ -74,6 +78,7 @@
 
 	    if (getView() != null) {	        
 	        extensionHook.getHookMenu().addToolsMenuItem(getMenuGarbageCollect());
+	        extensionHook.addSessionListener(new ResetCounterOnSessionChange(scanStatus));
 	    }
 
 	}
@@ -118,4 +123,51 @@
 	public boolean supportsDb(String type) {
 		return true;
 	}
+
+    private static class ResetCounterOnSessionChange implements SessionChangedListener {
+        /**
+         * Keep track of errors logged while the session changes.
+         */
+        private int previousCount;
+        /**
+         * Do not reset the counter if ZAP is starting.
+         */
+        private boolean starting;
+        private ScanStatus scanStatus;
+
+        public ResetCounterOnSessionChange(ScanStatus scanStatus) {
+            this.scanStatus = scanStatus;
+            this.starting = true;
+        }
+
+        @Override
+        public void sessionAboutToChange(Session session) {
+            EventQueue.invokeLater(() -> {
+                previousCount = scanStatus.getScanCount();
+            });
+        }
+
+        @Override
+        public void sessionChanged(Session session) {
+            if (starting) {
+                starting = false;
+                return;
+            }
+
+            EventQueue.invokeLater(() -> {
+                scanStatus.setScanCount(scanStatus.getScanCount() - previousCount);
+                previousCount = 0;
+            });
+        }
+
+        @Override
+        public void sessionScopeChanged(Session session) {
+            // Nothing to do.
+        }
+
+        @Override
+        public void sessionModeChanged(Mode mode) {
+            // Nothing to do.
+        }
+    }
 }",0
Update ioc.adoc - Fixed typo,"     /**
      * System property that indicates the location of the reflection JSON file.
      */
-    public static final String REFLECTION_JSON_FILE = ""graal.reflection.json"";
+    public static final String REFLECTION_JSON_FILE = ""graalvm.reflection.json"";
     /**
      * System property that indicates whether class analysis is is enabled.
      */
-    public static final String GRAAL_CLASS_ANALYSIS = ""graal.class.analysis"";
+    public static final String GRAAL_CLASS_ANALYSIS = ""graalvm.class.analysis"";
+
     private static final String NETTY_TYPE = ""io.netty.channel.socket.nio.NioServerSocketChannel"";
     private final Set<String> classes = new ConcurrentSkipListSet<>();
     private final Set<String> beans = new ConcurrentSkipListSet<>();",0
Fix #720 Revert header's API version,"         super.configureRequest(request);
 
         request.setRequestProperty(HEADER_ACCEPT,
-                ""application/vnd.github.v3.full+json"");
+                ""application/vnd.github.beta.full+json"");
 
         return request;
     }",0
Fixed incorrectly ended bold tag on special note.,"  * </p>
  * 
  * <p>
- * <b>Note<b>: any values provided will not be clamped, it is the developer's responsibility to do so
+ * <b>Note</b>: any values provided will not be clamped, it is the developer's responsibility to do so
  * </p>
  * 
  * @author badlogicgames@gmail.com */",0
Fix comparison with IntStream.EOF," 	 */
 	protected int fill(int n) {
 		for (int i=0; i<n; i++) {
-			if (this.n > 0 && data[this.n - 1] == IntStream.EOF) {
+			if (this.n > 0 && data[this.n - 1] == (char)IntStream.EOF) {
 				return i;
 			}
 
@@ -206,7 +206,7 @@
         sync(i);
         int index = p + i - 1;
         if ( index < 0 ) throw new IndexOutOfBoundsException();
-		if ( index > n ) return IntStream.EOF;
+		if ( index >= n ) return IntStream.EOF;
         char c = data[index];
         if ( c==(char)IntStream.EOF ) return IntStream.EOF;
         return c;
@@ -315,7 +315,7 @@
 
 		if (interval.a < bufferStartIndex || interval.b >= bufferStartIndex + n) {
 			throw new UnsupportedOperationException(""interval ""+interval+"" outside buffer: ""+
-			                    bufferStartIndex+""..""+(bufferStartIndex+n));
+			                    bufferStartIndex+""..""+(bufferStartIndex+n-1));
 		}
 		// convert from absolute to local index
 		int i = interval.a - bufferStartIndex;",0
[FIX] Cast conflicts with 'instanceof'," 
     if (event instanceof ActivitiEntityEvent) {
       Object entity = ((ActivitiEntityEvent) event).getEntity();
-      if (entity instanceof ProcessDefinition) {
+      if (entity instanceof ProcessDefinitionEntity) {
         result = (ProcessDefinitionEntity) entity;
       }
     }",0
[JENKINS-46452] Don't reference null Jira session (#1364),"         }
         String jql = constructJQLQuery(issueKeys);
         JiraSession session = jiraSite.getSession();
+        if (session == null) {
+            return;
+        }
         // Query for JIRA issues
         Set<JiraIssue> issuesFromJqlSearch = Sets.newHashSet(Iterables.transform(session.getIssuesFromJqlSearch(jql), new Function<Issue, JiraIssue>() {
             @Override",0
repair database now considers 0:0 links broken,"     if (fieldValue instanceof OIdentifiable) {
       final ORID id = ((OIdentifiable) fieldValue).getIdentity();
 
+      if (id.getClusterId() == 0 && id.getClusterPosition() == 0)
+        return true;
+
       if (id.isValid())
         if (id.isPersistent()) {
           final ORecord connected = ((OIdentifiable) fieldValue).getRecord();",0
Fix update of prompt after USE statement in CLI,"                 executeCommand(queryRunner, query, clientOptions.outputFormat);
             }
             else {
-                runConsole(queryRunner, session, exiting);
+                runConsole(queryRunner, exiting);
             }
         }
     }
@@ -166,7 +166,7 @@
         return """";
     }
 
-    private static void runConsole(QueryRunner queryRunner, ClientSession session, AtomicBoolean exiting)
+    private static void runConsole(QueryRunner queryRunner, AtomicBoolean exiting)
     {
         try (TableNameCompleter tableNameCompleter = new TableNameCompleter(queryRunner);
                 LineReader reader = new LineReader(getHistory(), commandCompleter(), lowerCaseCommandCompleter(), tableNameCompleter)) {
@@ -175,8 +175,9 @@
             while (!exiting.get()) {
                 // read a line of input from user
                 String prompt = PROMPT_NAME;
-                if (session.getSchema() != null) {
-                    prompt += "":"" + session.getSchema();
+                String schema = queryRunner.getSession().getSchema();
+                if (schema != null) {
+                    prompt += "":"" + schema;
                 }
                 if (buffer.length() > 0) {
                     prompt = Strings.repeat("" "", prompt.length() - 1) + ""-"";",0
Fix regression in previous commit that made https not work," 
     private static final Logger LOGGER = LoggerFactory.getLogger(ResourceUtils.class);
 
-    private static final String HTTP_URL_PREFIX = ""http:"";
+    // This constant covers both http and https
+    private static final String HTTP_URL_PREFIX = ""http"";
 
     private ResourceUtils() {
     }",0
Minor documentation fix,"  *   {@code byte[]} - this will be automatically copied, and the copy will be stored in the structure.
  *   {@link org.vertx.java.core.buffer.Buffer} - this will be automatically copied, and the copy will be stored in the
  *   structure.
+ *   Classes implementing {@link org.vertx.java.core.shareddata.Shareable}
  * </pre>
  * <p>
  *",0
Fix NPE in ScanJob on Android O while bluetooth is turned off,"             BluetoothAdapter bluetoothAdapter = bluetoothManager.getAdapter();
             if (bluetoothAdapter == null) {
                 LogManager.w(TAG, ""Failed to construct a BluetoothAdapter"");
-            }
-            else {
+            } else if (!bluetoothAdapter.isEnabled()) {
+                LogManager.w(TAG, ""Failed to start background scan on Android O: BluetoothAdapter is not enabled"");
+            } else {
                 int result = bluetoothAdapter.getBluetoothLeScanner().startScan(filters, settings, getScanCallbackIntent());
                 if (result != 0) {
                     LogManager.e(TAG, ""Failed to start background scan on Android O.  Code: ""+result);
@@ -181,6 +182,8 @@
             BluetoothAdapter bluetoothAdapter = bluetoothManager.getAdapter();
             if (bluetoothAdapter == null) {
                 LogManager.w(TAG, ""Failed to construct a BluetoothAdapter"");
+            } else if (!bluetoothAdapter.isEnabled()) {
+                LogManager.w(TAG, ""BluetoothAdapter is not enabled"");
             } else {
                 bluetoothAdapter.getBluetoothLeScanner().stopScan(getScanCallbackIntent());
             }",0
Fix getColor()," import android.databinding.DataBindingUtil;
 import android.os.Bundle;
 import android.support.annotation.ColorRes;
+import android.support.v4.content.ContextCompat;
 import android.support.v7.widget.Toolbar;
 import android.transition.Fade;
 import android.transition.Transition;
@@ -155,7 +156,7 @@
             }
         });
         body.setText(R.string.reveal_body4);
-        body.setTextColor(getColor(R.color.theme_blue_background));
+        body.setTextColor(ContextCompat.getColor(this, R.color.theme_blue_background));
     }
 
     private void revealRed() {
@@ -170,7 +171,7 @@
             public void onTransitionEnd(Transition transition) {
                 animateRevealColor(bgViewGroup, R.color.sample_red);
                 body.setText(R.string.reveal_body3);
-                body.setTextColor(getColor(R.color.theme_red_background));
+                body.setTextColor(ContextCompat.getColor(RevealActivity.this, R.color.theme_red_background));
                 btnRed.setLayoutParams(originalParams);
             }
 
@@ -197,13 +198,13 @@
     private void revealYellow(float x, float y) {
         animateRevealColorFromCoordinates(bgViewGroup, R.color.sample_yellow, (int) x, (int) y);
         body.setText(R.string.reveal_body1);
-        body.setTextColor(getColor(R.color.theme_yellow_background));
+        body.setTextColor(ContextCompat.getColor(this, R.color.theme_yellow_background));
     }
 
     private void revealGreen() {
         animateRevealColor(bgViewGroup, R.color.sample_green);
         body.setText(R.string.reveal_body2);
-        body.setTextColor(getColor(R.color.theme_green_background));
+        body.setTextColor(ContextCompat.getColor(this, R.color.theme_green_background));
     }
 
     private void hideTarget() {
@@ -266,7 +267,7 @@
         float finalRadius = (float) Math.hypot(viewRoot.getWidth(), viewRoot.getHeight());
 
         Animator anim = ViewAnimationUtils.createCircularReveal(viewRoot, x, y, 0, finalRadius);
-        viewRoot.setBackgroundColor(getColor(color));
+        viewRoot.setBackgroundColor(ContextCompat.getColor(this, color));
         anim.setDuration(getResources().getInteger(R.integer.anim_duration_long));
         anim.setInterpolator(new AccelerateDecelerateInterpolator());
         anim.start();",0
Minor javadoc fix,"    * Get the Instant at position {@code pos} in the array.
    * <p>
    * JSON itself has no notion of a temporal types, this extension complies to the RFC-7493, so this method assumes
-   * there is a String value and it contains an ISO 8601 encoded data and time format such as ""2017-04-03T10:25:41Z"",
+   * there is a String value and it contains an ISO 8601 encoded date and time format such as ""2017-04-03T10:25:41Z"",
    * which it decodes if found and returns.
    * <p>
    * This method should be used in conjunction with {@link #add(Instant)}",0
[tomcat] Apply `keyPrefix` to both session and topic keys,"     }
 
     public RTopic getTopic() {
-        return redisson.getTopic(""redisson:tomcat_session_updates:"" + getContext().getName());
+        String separator = keyPrefix == null || keyPrefix.isEmpty() ? """" : "":"";
+        final String name = keyPrefix + separator + ""redisson:tomcat_session_updates:"" + getContext().getName();
+        return redisson.getTopic(name);
     }
     
     @Override",0
Fix FAM height was measured wrong when menu_buttonSpacing > 0.," 
         width = Math.max(mMaxButtonWidth, maxLabelWidth + mLabelsMargin) + getPaddingLeft() + getPaddingRight();
 
-        height += mButtonSpacing * (getChildCount() - 1) + getPaddingTop() + getPaddingBottom();
+        height += mButtonSpacing * (mButtonsCount - 1) + getPaddingTop() + getPaddingBottom();
         height = adjustForOvershoot(height);
 
         if (getLayoutParams().width == LayoutParams.MATCH_PARENT) {",0
:bug: 修复在形如ViewPager嵌套ViewPager的布局场景下，无法正确找到所选View；," import java.util.Arrays;
 import java.util.List;
 
+import me.ele.uetool.base.DimenUtil;
 import me.ele.uetool.base.Element;
 
 import static me.ele.uetool.base.DimenUtil.dip2px;
@@ -171,6 +172,9 @@
         for (int i = elements.size() - 1; i >= 0; i--) {
             final Element element = elements.get(i);
             if (element.getRect().contains((int) x, (int) y)) {
+                if (isParentNotVisible(element.getParentElement())) {
+                    continue;
+                }
                 if (element != childElement) {
                     childElement = element;
                     parentElement = element;
@@ -187,6 +191,18 @@
         return target;
     }
 
+    private boolean isParentNotVisible(Element parent) {
+        if (parent == null) {
+            return false;
+        }
+        if (parent.getRect().left >= DimenUtil.getScreenWidth()
+                || parent.getRect().top >= DimenUtil.getScreenHeight()) {
+            return true;
+        } else {
+            return isParentNotVisible(parent.getParentElement());
+        }
+    }
+
     protected List<Element> getTargetElements(float x, float y) {
         List<Element> validList = new ArrayList<>();
         for (int i = elements.size() - 1; i >= 0; i--) {",0
KYLIN-3912 fix CI,"         }
     }
 
-    private KylinConfig getCubeSpecificConfig() {
+    @Override
+    public KylinConfig getCubeSpecificConfig() {
         String cubeName = CubingExecutableUtil.getCubeName(getParams());
         CubeManager manager = CubeManager.getInstance(KylinConfig.getInstanceFromEnv());
         CubeInstance cube = manager.getCube(cubeName);",0
Fixed: Unchecked call to Long.valueOf(String) may cause an NFE,"       // DownloadsProvider
       else if (isDownloadsDocument(uri)) {
         final String id = DocumentsContract.getDocumentId(uri);
-        final Uri contentUri =
-            ContentUris.withAppendedId(Uri.parse(""content://downloads/public_downloads""),
-                Long.valueOf(id));
+        // String ""id"" may not represent a valid Long type data, it may equals to
+        // something like ""raw:/storage/emulated/0/Download/some_file"" instead.
+        // Doing a check before passing the ""id"" to Long.valueOf(String) would be much safer.
+        if (RawDocumentsHelper.isRawDocId(id)) {
+          filePath = RawDocumentsHelper.getAbsoluteFilePath(id);
+        } else {
+          final Uri contentUri = ContentUris.withAppendedId(Uri.parse(""content://downloads/public_downloads""), Long.valueOf(id));
         filePath = getDataColumn(context, contentUri, null, null);
       }
+      }
       // MediaProvider
       else if (isMediaDocument(uri)) {
         final String docId = DocumentsContract.getDocumentId(uri);
@@ -323,6 +328,23 @@
     return null;
   }
 
+  // A copy of com.android.providers.downloads.RawDocumentsHelper since it is invisibility.
+  public static class RawDocumentsHelper {
+    public static final String RAW_PREFIX = ""raw:"";
+
+    public static boolean isRawDocId(String docId) {
+      return docId != null && docId.startsWith(RAW_PREFIX);
+    }
+
+    public static String getDocIdForFile(File file) {
+      return RAW_PREFIX + file.getAbsolutePath();
+    }
+
+    public static String getAbsoluteFilePath(String rawDocumentId) {
+      return rawDocumentId.substring(RAW_PREFIX.length());
+    }
+  }
+
   /**
    * Get the value of the data column for this Uri. This is useful for
    * MediaStore Uris, and other file-based ContentProviders.",0
fixed #1601 backend priority loading when using reflection," 
         }
 
-        Collections.sort(backends, new Comparator<Nd4jBackend>() {
+        Collections.sort(reflectionBackends, new Comparator<Nd4jBackend>() {
             @Override
             public int compare(Nd4jBackend o1, Nd4jBackend o2) {
                 // high-priority first",0
Fix typo,"  * For JavaFX it is usually the Platform::RunLater executor, for a headless application it is any single threaded
  * executor.
  * Additionally sets a timer class so JavaFX and headless applications can set different timers (UITimer for JavaFX
- * otherwise we use teh default FrameRateTimer).
+ * otherwise we use the default FrameRateTimer).
  * <p>
  * Provides also methods for delayed and periodic executions.
  */",0
Attempt to fix Kerberos.credentialDelegationTest on windows," import java.net.InetAddress;
 import java.net.UnknownHostException;
 
+import org.ietf.jgss.GSSException;
+import org.ietf.jgss.GSSManager;
+import org.ietf.jgss.GSSName;
+import org.keycloak.util.KerberosSerializationUtils;
+import sun.security.jgss.GSSNameImpl;
+import sun.security.jgss.krb5.Krb5NameElement;
+
 /**
  * Factory for ApacheDS based LDAP and Kerberos servers
  *
@@ -71,9 +78,11 @@
         if (ldapSaslPrincipal == null || ldapSaslPrincipal.isEmpty()) {
             try {
                 // Same algorithm like sun.security.krb5.PrincipalName constructor
-                String canonicalHost = (InetAddress.getByName(bindHost)).getCanonicalHostName();
-                this.ldapSaslPrincipal = ""ldap/"" + canonicalHost + ""@"" + kerberosRealm;
-            } catch (UnknownHostException uhe) {
+                GSSName gssName = GSSManager.getInstance().createName(""ldap@localhost"", GSSName.NT_HOSTBASED_SERVICE);
+                GSSNameImpl gssName1 = (GSSNameImpl) gssName;
+                Krb5NameElement krb5NameElement = (Krb5NameElement) gssName1.getElement(KerberosSerializationUtils.KRB5_OID);
+                this.ldapSaslPrincipal = krb5NameElement.getKrb5PrincipalName().toString();
+            } catch (GSSException uhe) {
                 throw new RuntimeException(uhe);
             }
         }",0
Fix the REST mfa bypass call,"                             + ""service [{}] and provider [{}] via REST endpoint [{}]"",
                     principal.getId(), registeredService, provider, rest.getUrl());
 
-            final Map<String, String> parameters = CollectionUtils.wrap(""principal"", CollectionUtils.wrap(principal.getId()),
-                    ""provider"", CollectionUtils.wrap(provider.getId()));
+            final Map<String, String> parameters = CollectionUtils.wrap(""principal"", principal.getId(), ""provider"", provider.getId());
             if (registeredService != null) {
                 parameters.put(""service"", registeredService.getServiceId());
             }",0
Directimage fix,"      * The regex used to match the link in the message.
      */
     public static final String URL_PATTERN =
-        ""https?\\:\\/\\/(www\\.)*.*\\.(?:jpg|png|gif)"";
+        ""https?\\:\\/\\/.*\\.(?:jpg|png|gif)"";
 
     /**
      * Configuration label shown in the config form.",0
[ci] Fix suspected memory leak," import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
-import java.nio.channels.FileChannel;
 import java.util.Properties;
 
 import org.apache.ibatis.logging.Log;
@@ -43,9 +42,9 @@
       destFile.createNewFile();
     }
 
-    try (FileChannel source = new FileInputStream(sourceFile).getChannel();
-         FileChannel destination = new FileOutputStream(destFile).getChannel()){
-      destination.transferFrom(source, 0, source.size());
+    try (FileInputStream source = new FileInputStream(sourceFile);
+         FileOutputStream destination = new FileOutputStream(destFile)) {
+      destination.getChannel().transferFrom(source.getChannel(), 0, source.getChannel().size());
     }
 
   }",0
Bugfix to my previous contribution: FreeTypeFontGenerator.generateGlyphAndBitmap()," 		SizeMetrics fontMetrics = face.getSize().getMetrics();
 		int baseline = FreeType.toInt(fontMetrics.getAscender());
 
-		// Check if character exists in this font
-		if (!FreeType.loadChar(face, c, FreeType.FT_LOAD_DEFAULT)) {
+		// Check if character exists in this font.
+		// 0 means 'undefined character code'
+		if (FreeType.getCharIndex(face, c) == 0) {
 			return null;
 		}
 
+		// Try to load character
+		if (!FreeType.loadChar(face, c, FreeType.FT_LOAD_DEFAULT)) {
+			throw new GdxRuntimeException(""Unable to load character!"");
+		}
+
 		GlyphSlot slot = face.getGlyph();
 		
 		// Try to render to bitmap",0
Fix not-working menu items on Album Detail Fragment,"                 return true;
         }
 
+        Integer albumSortOrder = AlbumSortHelper.handleAlbumDetailMenuSortOrderClicks(item);
+        if (albumSortOrder != null) {
+            SortManager.getInstance().setArtistDetailAlbumsSortOrder(albumSortOrder);
+            presenter.loadData();
+        }
+        Boolean albumsAsc = AlbumSortHelper.handleAlbumDetailMenuSortOrderAscClicks(item);
+        if (albumsAsc != null) {
+            SortManager.getInstance().setArtistDetailAlbumsAscending(albumsAsc);
+            presenter.loadData();
+        }
         Integer songSortOder = SongSortHelper.handleSongMenuSortOrderClicks(item);
         if (songSortOder != null) {
             SortManager.getInstance().setAlbumDetailSongsSortOrder(songSortOder);
@@ -337,6 +347,7 @@
         }
 
         AlbumSortHelper.updateAlbumSortMenuItems(toolbar.getMenu(), SortManager.getInstance().getArtistDetailAlbumsSortOrder(), SortManager.getInstance().getArtistDetailAlbumsAscending());
+        SongSortHelper.updateSongSortMenuItems(toolbar.getMenu(), SortManager.getInstance().getAlbumDetailSongsSortOrder(), SortManager.getInstance().getAlbumDetailSongsAscending());
 
         return super.onOptionsItemSelected(item);
     }",0
fix:移除 LruCache 多余的同步块," import com.alibaba.dubbo.common.URL;
 import com.alibaba.dubbo.common.utils.LRUCache;
 
-import java.util.LinkedHashMap;
 import java.util.Map;
-import java.util.Map.Entry;
 
 /**
  * LruCache
@@ -38,15 +36,11 @@
     }
 
     public void put(Object key, Object value) {
-        synchronized (store) {
             store.put(key, value);
         }
-    }
 
     public Object get(Object key) {
-        synchronized (store) {
             return store.get(key);
         }
-    }
 
 }",0
[FIXED JENKINS-50795] Add null safety checks to FixedSet,"         boolean caseInsensitive = UserSearchProperty.isCaseInsensitive();
         for (SearchItem i : items) {
             String name = i.getSearchName();
-            if (name.equals(token) || (caseInsensitive && name.equalsIgnoreCase(token))) {
+            if (name != null && (name.equals(token) || (caseInsensitive && name.equalsIgnoreCase(token)))) {
                 result.add(i);
             }
         }
@@ -60,7 +60,7 @@
         boolean caseInsensitive = UserSearchProperty.isCaseInsensitive();
         for (SearchItem i : items) {
             String name = i.getSearchName();
-            if (name.contains(token) || (caseInsensitive && StringUtils.containsIgnoreCase(name, token))) {
+            if (name != null && (name.contains(token) || (caseInsensitive && StringUtils.containsIgnoreCase(name, token)))) {
                 result.add(i);
             }
         }",0
Fix NullPointerException during full config save (#5538)," 
         if (pluginInfo == null
                 || pluginInfo.getClusterProfileSettings() == null
+                || pluginInfo.getClusterProfileSettings().getConfigurations() == null
                 || pluginInfo.getClusterProfileSettings().getConfiguration(key) == null) {
             return false;
         }",0
fix debug log parameter error," 
             log.debug(""Created keyspace {}"", keySpaceName);
         } catch (ConnectionException e) {
-            log.debug(""Failed to create keyspace {}, keySpaceName"");
+            log.debug(""Failed to create keyspace {}"", keySpaceName);
             throw new TemporaryBackendException(e);
         }
     }",0
fixed caching issue when initlizing multiple token request haven't been tested,"      * @return a Jwt if successful, otherwise return error Status.
      */
     public Result<Jwt> getJwt(Jwt.Key key) {
-        Jwt cachedJwt = cacheStrategy.getCachedJwt(key);
-        Result<Jwt> result = cachedJwt == null ? OauthHelper.populateCCToken(new Jwt(key)) : OauthHelper.populateCCToken(cachedJwt);
+        Jwt cachedJwt = getJwt(cacheStrategy, key);
+
+        Result<Jwt> result = OauthHelper.populateCCToken(cachedJwt);
+        //update JWT
         if (result.isSuccess()) {
             cacheStrategy.cacheJwt(key, result.getResult());
         }
         return result;
     }
 
+    //cache jwt if not exist
+    private synchronized Jwt getJwt(ICacheStrategy cacheStrategy, Jwt.Key key) {
+        Jwt result = cacheStrategy.getCachedJwt(key);
+        if(result == null) {
+            //cache an empty JWT first.
+            result = new Jwt(key);
+            cacheStrategy.cacheJwt(key, result);
+        }
+        return result;
+    }
+
     /**
      * get a Jwt with a provided clientRequest,
      * it will get token based on Jwt.Key (either scope or service_id)",0
Bugfix in TcpSocketSender.java," 		boolean isWriteable = false;
 
 		if (channel != null && channel.channel().isOpen()) {
-			if (channel.channel().isActive()) {
+			if (channel.channel().isWritable()) {
 				isWriteable = true;
 			} else {
 				int count = m_attempts.incrementAndGet();",0
fixed issue #40  x + width must be <= bitmap.width,"         w = Math.round(r - l);
         h = Math.round(b - t);
 
-        if(w > source.getWidth()){
-            w = source.getWidth();
-            x = 0;
+        if(x+w > source.getWidth()){
+            w = source.getWidth()-x;
         }
-        if(h > source.getHeight()){
-            h = source.getHeight();
-            y = 0;
+        if(y+h > source.getHeight()){
+            h = source.getHeight()-y;
         }
 
         Bitmap cropped = Bitmap.createBitmap(source, x, y, w, h, null, false);",0
FIx AA_MODEL meta-data bug," 			final List<Class<? extends Model>> modelClasses = new ArrayList<Class<? extends Model>>();
 			final ClassLoader classLoader = mContext.getClass().getClassLoader();
 			for (String model : models) {
-				model = ensurePackageInName(model);
-
 				try {
-					Class modelClass = Class.forName(model, false, classLoader);
+					Class modelClass = Class.forName(model.trim(), false, classLoader);
 					if (ReflectionUtils.isModel(modelClass)) {
 						modelClasses.add(modelClass);
 					}
@@ -274,10 +272,8 @@
 			final List<Class<? extends TypeSerializer>> typeSerializers = new ArrayList<Class<? extends TypeSerializer>>();
 			final ClassLoader classLoader = mContext.getClass().getClassLoader();
 			for (String serializer : serializers) {
-				serializer = ensurePackageInName(serializer);
-
 				try {
-					Class serializerClass = Class.forName(serializer, false, classLoader);
+					Class serializerClass = Class.forName(serializer.trim(), false, classLoader);
 					if (ReflectionUtils.isTypeSerializer(serializerClass)) {
 						typeSerializers.add(serializerClass);
 					}
@@ -290,13 +286,5 @@
 			return typeSerializers;
 		}
 
-		private String ensurePackageInName(String name) {
-			String packageName = mContext.getPackageName();
-			if (name.startsWith(packageName)) {
-				return name.trim();
-			}
-
-			return packageName + name.trim();
-		}
 	}
 }",0
Fix typo in Exchange.java JavaDoc,"  * and set it as the in for the next {@link Processor}. If the previous {@link Processor} did not
  * produce an out, then the in of the previous {@link Processor} is sent as the next in. At the
  * end of the processing chain, depending on the {@link ExchangePattern Message Exchange Pattern} (or MEP)
- * the last out (or in of no out available) is sent by the {@link Consumer} back to the original caller.
+ * the last out (or in if no out available) is sent by the {@link Consumer} back to the original caller.
  * <p/>
  * Camel, in addition to providing out-of-the-box a large number of useful processors, it also allows 
  * you to implement and use your own. When the Exchange is passed to a {@link Processor}, it always ",0
Fixes a compilation issue.,"             return Collections.emptyMap();
         }
 
-        RedisCommand<Map<Object, Object>> command = new RedisCommand<Map<Object, Object>>(""MGET"", new MapGetAllDecoder(Arrays.asList(keys), 0), ValueType.OBJECTS);
+        RedisCommand<Map<Object, Object>> command = new RedisCommand<Map<Object, Object>>(""MGET"", new MapGetAllDecoder(Arrays.<Object>asList(keys), 0), ValueType.OBJECTS);
         Future<Map<String, V>> future = commandExecutor.readAsync(keys[0], new DelegateDecoderCodec(codec), command, keys);
         return commandExecutor.get(future);
     }",0
Fixed notify on exception in mapreduce when jobowner is the local node," 
 import com.hazelcast.cluster.ClusterService;
 import com.hazelcast.instance.MemberImpl;
+import com.hazelcast.logging.ILogger;
 import com.hazelcast.mapreduce.JobPartitionState;
 import com.hazelcast.mapreduce.PartitionIdAware;
 import com.hazelcast.mapreduce.impl.operation.KeysAssignmentOperation;
@@ -73,15 +74,25 @@
     }
 
     public static void notifyRemoteException(JobSupervisor supervisor, Throwable throwable) {
+        MapReduceService mapReduceService = supervisor.getMapReduceService();
+        NodeEngine nodeEngine = mapReduceService.getNodeEngine();
+        try {
+            Address jobOwner = supervisor.getJobOwner();
+            if (supervisor.isOwnerNode()) {
+                supervisor.notifyRemoteException(jobOwner, throwable);
+            } else {
         String name = supervisor.getConfiguration().getName();
         String jobId = supervisor.getConfiguration().getJobId();
         NotifyRemoteExceptionOperation operation = new NotifyRemoteExceptionOperation(name, jobId, throwable);
-        MapReduceService mapReduceService = supervisor.getMapReduceService();
-        NodeEngine nodeEngine = mapReduceService.getNodeEngine();
+
         OperationService os = nodeEngine.getOperationService();
-        Address jobOwner = supervisor.getJobOwner();
         os.send(operation, jobOwner);
     }
+        } catch (Exception e) {
+            ILogger logger = nodeEngine.getLogger(MapReduceUtil.class);
+            logger.warning(""Could not notify remote map-reduce owner"", e);
+        }
+    }
 
     public static JobPartitionState.State stateChange(Address owner, int partitionId, JobPartitionState.State currentState,
                                                       JobProcessInformationImpl processInformation,",0
Fixed typo," 
     /**
      * Return the user associated with the status.<br>
-     * This can be null if the instance if from User.getStatus().
+     * This can be null if the instance is from User.getStatus().
      *
      * @return the user
      */",0
"fixes #1089, make ExecutionDispatcher meet dubbo-user-book","     }
 
     @Override
-    public void connected(Channel channel) throws RemotingException {
-        executor.execute(new ChannelEventRunnable(channel, handler, ChannelState.CONNECTED));
-    }
-
-    @Override
-    public void disconnected(Channel channel) throws RemotingException {
-        executor.execute(new ChannelEventRunnable(channel, handler, ChannelState.DISCONNECTED));
-    }
-
-    @Override
     public void received(Channel channel, Object message) throws RemotingException {
+        if (message instanceof Request) {
     	try {
             executor.execute(new ChannelEventRunnable(channel, handler, ChannelState.RECEIVED, message));
         } catch (Throwable t) {
             //TODO A temporary solution to the problem that the exception information can not be sent to the opposite end after the thread pool is full. Need a refactoring
             //fix The thread pool is full, refuses to call, does not return, and causes the consumer to wait for time out
-        	if(message instanceof Request &&
-        			t instanceof RejectedExecutionException){
+                if (t instanceof RejectedExecutionException) {
         		Request request = (Request)message;
         		if(request.isTwoWay()){
-        			String msg = ""Server side(""+url.getIp()+"",""+url.getPort()+"") threadpool is exhausted ,detail msg:""+t.getMessage();
+                        String msg = ""Server side("" + url.getIp() + "","" + url.getPort()
+                            + "") threadpool is exhausted ,detail msg:"" + t.getMessage();
         			Response response = new Response(request.getId(), request.getVersion());
         			response.setStatus(Response.SERVER_THREADPOOL_EXHAUSTED_ERROR);
         			response.setErrorMessage(msg);
@@ -66,11 +57,8 @@
         	}
             throw new ExecutionException(message, channel, getClass() + "" error when process received event ."", t);
         }
+        } else {
+            handler.received(channel, message);
     }
-
-    @Override
-    public void caught(Channel channel, Throwable exception) throws RemotingException {
-        executor.execute(new ChannelEventRunnable(channel, handler, ChannelState.CAUGHT, exception));
     }
-
 }",0
fix maxSessionIdleTimeout setter," 
     @Override
     public void setDefaultMaxSessionIdleTimeout(final long timeout) {
-        this.maxSessionIdleTimeout = maxSessionIdleTimeout;
+        this.maxSessionIdleTimeout = timeout;
     }
 
     @Override",0
small fixes for the Criteria class," 
     private final List<Criteria> criteriaChain;
 
-    private enum CriteriaType {
+    private static enum CriteriaType {
         EQ {
             @Override
             boolean eval(Object expected, Object actual, Configuration configuration) {
@@ -329,7 +329,7 @@
      * @return
      */
     public Criteria is(Object o) {
-        this.criteriaType = CriteriaType.TYPE.EQ;
+        this.criteriaType = CriteriaType.EQ;
         this.expected = o;
         return this;
     }
@@ -351,7 +351,7 @@
      * @return
      */
     public Criteria ne(Object o) {
-        this.criteriaType = CriteriaType.TYPE.NE;
+        this.criteriaType = CriteriaType.NE;
         this.expected = o;
         return this;
     }
@@ -363,7 +363,7 @@
      * @return
      */
     public Criteria lt(Object o) {
-        this.criteriaType = CriteriaType.TYPE.LT;
+        this.criteriaType = CriteriaType.LT;
         this.expected = o;
         return this;
     }
@@ -375,7 +375,7 @@
      * @return
      */
     public Criteria lte(Object o) {
-        this.criteriaType = CriteriaType.TYPE.LTE;
+        this.criteriaType = CriteriaType.LTE;
         this.expected = o;
         return this;
     }
@@ -387,7 +387,7 @@
      * @return
      */
     public Criteria gt(Object o) {
-        this.criteriaType = CriteriaType.TYPE.GT;
+        this.criteriaType = CriteriaType.GT;
         this.expected = o;
         return this;
     }
@@ -399,7 +399,7 @@
      * @return
      */
     public Criteria gte(Object o) {
-        this.criteriaType = CriteriaType.TYPE.GTE;
+        this.criteriaType = CriteriaType.GTE;
         this.expected = o;
         return this;
     }
@@ -412,7 +412,7 @@
      */
     public Criteria regex(Pattern pattern) {
         notNull(pattern, ""pattern can not be null"");
-        this.criteriaType = CriteriaType.TYPE.REGEX;
+        this.criteriaType = CriteriaType.REGEX;
         this.expected = pattern;
         return this;
     }
@@ -437,7 +437,7 @@
      */
     public Criteria in(Collection<?> c) {
         notNull(c, ""collection can not be null"");
-        this.criteriaType = CriteriaType.TYPE.IN;
+        this.criteriaType = CriteriaType.IN;
         this.expected = c;
         return this;
     }
@@ -462,7 +462,7 @@
      */
     public Criteria nin(Collection<?> c) {
         notNull(c, ""collection can not be null"");
-        this.criteriaType = CriteriaType.TYPE.NIN;
+        this.criteriaType = CriteriaType.NIN;
         this.expected = c;
         return this;
     }
@@ -487,7 +487,7 @@
      */
     public Criteria all(Collection<?> c) {
         notNull(c, ""collection can not be null"");
-        this.criteriaType = CriteriaType.TYPE.ALL;
+        this.criteriaType = CriteriaType.ALL;
         this.expected = c;
         return this;
     }
@@ -504,7 +504,7 @@
      * @return
      */
     public Criteria size(int size) {
-        this.criteriaType = CriteriaType.TYPE.SIZE;
+        this.criteriaType = CriteriaType.SIZE;
         this.expected = size;
         return this;
     }
@@ -517,7 +517,7 @@
      * @return
      */
     public Criteria exists(boolean b) {
-        this.criteriaType = CriteriaType.TYPE.EXISTS;
+        this.criteriaType = CriteriaType.EXISTS;
         this.expected = b;
         return this;
     }
@@ -530,7 +530,7 @@
      */
     public Criteria type(Class<?> t) {
         notNull(t, ""type can not be null"");
-        this.criteriaType = CriteriaType.TYPE.TYPE;
+        this.criteriaType = CriteriaType.TYPE;
         this.expected = t;
         return this;
     }
@@ -541,7 +541,7 @@
      * @return
      */
     public Criteria notEmpty() {
-        this.criteriaType = CriteriaType.TYPE.NOT_EMPTY;
+        this.criteriaType = CriteriaType.NOT_EMPTY;
         this.expected = null;
         return this;
     }
@@ -552,7 +552,7 @@
      * @return
      */
     public Criteria matches(Predicate p) {
-        this.criteriaType = CriteriaType.TYPE.MATCHES;
+        this.criteriaType = CriteriaType.MATCHES;
         this.expected = p;
         return this;
     }",0
Improve node enumeration in pre-scan phase," // ZAP: 2016/11/14 Restore and deprecate old constructor, to keep binary compatibility
 // ZAP: 2016/12/13 Issue 2951:  Support active scan rule and scan max duration
 // ZAP: 2016/12/20 Include the name of the user when logging the scan info
+// ZAP: 2017/03/20 Improve node enumeration in pre-scan phase.
 
 package org.parosproxy.paros.core.scanner;
 
@@ -261,8 +262,11 @@
         StringBuilder strBuilder = new StringBuilder(150);
         strBuilder.append(""Scanning "");
         strBuilder.append(nodeInScopeCount);
-        strBuilder.append("" node(s) from "");
-        strBuilder.append(hostAndPort);
+        strBuilder.append("" node(s) "");
+        if (parentScanner.getJustScanInScope()) {
+            strBuilder.append(""[just in scope] "");
+        }
+        strBuilder.append(""from "").append(hostAndPort);
         if (user != null) {
             strBuilder.append("" as "");
             strBuilder.append(user.getName());
@@ -391,18 +395,7 @@
         // do not poll for isStop here to allow every plugin to run but terminate immediately.
         //if (isStop()) return;
 
-        if (node == null || node.getHistoryReference() == null) {
-            log.debug(""scanSingleNode node or href null, returning: node="" + node);
-            return false;
-        }
-        
-        if (HistoryReference.TYPE_SCANNER == node.getHistoryReference().getHistoryType()) {
-            log.debug(""Ignoring \""scanner\"" type href"");
-            return false;
-        }
-
-        if (!nodeInScope(node.getName())) {
-            log.debug(""scanSingleNode node not in scope"");
+        if (!canScanNode(node)) {
             return false;
         }
 
@@ -454,6 +447,47 @@
     }
 
     /**
+     * Tells whether or not the scanner can scan the given node.
+     * <p>
+     * A node must not be null, must contain a valid HistoryReference and be in scope.
+     *
+     * @param node the node to be checked
+     * @return {@code true} if the node can be scanned, {@code false} otherwise.
+     */
+    private boolean canScanNode(StructuralNode node) {
+        if (node == null) {
+            if (log.isDebugEnabled()) {
+                log.debug(""Ignoring null node"");
+            }
+            return false;
+        }
+
+        HistoryReference hRef = node.getHistoryReference();
+        if (hRef == null) {
+            if (log.isDebugEnabled()) {
+                log.debug(""Ignoring null history reference for node: "" + node.getName());
+            }
+            return false;
+        }
+
+        if (HistoryReference.TYPE_SCANNER == hRef.getHistoryType()) {
+            if (log.isDebugEnabled()) {
+                log.debug(""Ignoring \""scanner\"" type href [id="" + hRef.getHistoryId() + "", URL="" + hRef.getURI() + ""]"");
+            }
+            return false;
+        }
+
+        if (!nodeInScope(node.getName())) {
+            if (log.isDebugEnabled()) {
+                log.debug(""Ignoring node not in scope: "" + node.getName());
+            }
+            return false;
+        }
+
+        return true;
+    }
+
+    /**
      * ZAP: method to get back the number of tests that need to be performed
      * @return the number of tests that need to be executed for this Scanner
      */
@@ -919,18 +953,19 @@
     }
 
     /**
-     * A {@code TraverseAction} that counts the nodes traversed.
+     * A {@code TraverseAction} that counts the nodes traversed and that can be scanned.
      * 
      * @see #getCount()
+     * @see HostProcess#canScanNode(StructuralNode)
      */
-    private static class TraverseCounter implements TraverseAction {
+    private class TraverseCounter implements TraverseAction {
 
         private int count;
 
         /**
-         * Returns the number of nodes traversed.
+         * Returns the number of nodes traversed and that can be scanned.
          *
-         * @return the number of nodes traversed
+         * @return the number of nodes traversed and that can be scanned.
          */
         public int getCount() {
             return count;
@@ -938,8 +973,10 @@
 
         @Override
         public void apply(StructuralNode node) {
+            if (canScanNode(node)) {
             count++;
         }
+        }
 
         @Override
         public boolean isStopTraversing() {",0
Fix for StringTextIconRenderer icon overlapping issue,"     private final int marginRight;
 
     protected StringTextIconRenderer() {
-        this(true, 5, 5, 5, 10);
+        this(false, 5, 5, 5, 10);
     }
 
     protected StringTextIconRenderer(boolean wrap, int marginTop, int marginBottom, int marginLeft, int marginRight) {
@@ -66,25 +66,28 @@
         // Drawing the text, adjusting for icon width
         String text = getString(value);
         int iconWidth = marginLeft + texture.getWidth() + marginRight;
+        Rect2i textRegion =  Rect2i.createFromMinAndSize(iconWidth, 0, canvas.getRegion().width() - iconWidth, canvas.getRegion().height());
 
         if (wrap) {
-            canvas.drawText(text, Rect2i.createFromMinAndSize(iconWidth, 0, canvas.getRegion().width() - iconWidth, canvas.getRegion().height()));
+            canvas.drawText(text, textRegion);
         } else {
-            int width = canvas.size().x - iconWidth;
+            int maxTextWidth = canvas.size().x - iconWidth;
             Font font = canvas.getCurrentStyle().getFont();
-            if (font.getWidth(text) <= width) {
-                canvas.drawText(text);
+
+            // If text does not horizontally fit within the canvas, shrink it
+            if (font.getWidth(text) <= maxTextWidth) {
+                canvas.drawText(text, textRegion);
             } else {
                 String shortText = ""..."";
                 StringBuilder sb = new StringBuilder(text);
                 while (sb.length() > 0) {
                     shortText = sb.toString() + ""..."";
-                    if (font.getWidth(shortText) <= width) {
+                    if (font.getWidth(shortText) <= maxTextWidth) {
                         break;
                     }
                     sb.setLength(sb.length() - 1);
                 }
-                canvas.drawText(shortText, Rect2i.createFromMinAndSize(iconWidth, 0, canvas.getRegion().width() - iconWidth, canvas.getRegion().height()));
+                canvas.drawText(shortText, textRegion);
             }
         }
     }",0
Fix typo in PVector.java docs,"    * @usage web_application
    * @brief Linear interpolate the vector to another vector
    * @param v the vector to lerp to
-   * @param amt  The amount of interpolation; some value between 0.0 (old vector) and 1.0 (new vector). 0.1 is very near the new vector. 0.5 is halfway in between.
+   * @param amt  The amount of interpolation; some value between 0.0 (old vector) and 1.0 (new vector). 0.1 is very near the old vector; 0.5 is halfway in between.
    * @see PApplet#lerp(float, float, float)
    */
   public PVector lerp(PVector v, float amt) {",0
Avoid tree jump during file selection,"             if (e != null) {
                 setClassName(e, tree.getTreeStyles().styles().selected(), select);
             }
-            tree.moveFocus(nodeDescriptor.getRootContainer());
         }
     }
 ",0
Write to the correct cache,"                 if (includeUnqualifiedPolymorphicEntities) {
                     POLYMORPHIC_ENTITY_CACHE.put(ceilingClass, filteredEntities);
                 } else {
-                    POLYMORPHIC_ENTITY_CACHE.put(ceilingClass, filteredEntities);
+                    POLYMORPHIC_ENTITY_CACHE_WO_EXCLUSIONS.put(ceilingClass, filteredEntities);
                 }
             }
         }",0
Fix to prevent issue #66," 	public void idsExists(Element element, Res res, IsValid valid) {
 
 		int[] idsValues = annotationHelper.extractAnnotationValue(element);
-		if (idsValues[0] == Id.DEFAULT_VALUE) {
+
+		if (idsValues == null) {
+			valid.invalidate();
+			annotationHelper.printAnnotationWarning(element, ""The value of the %s annotation could not be determined at compile time, for unknown reasons. Please report this issue."");
+		} else if (idsValues[0] == Id.DEFAULT_VALUE) {
 			idExists(element, res, true, true, valid, idsValues[0]);
 		} else {
 			for (int idValue : idsValues) {",0
"Do not log explicit no unsafe, fixes helper method.","     }
 
     static boolean isExplicitNoUnsafe() {
-        return EXPLICIT_NO_UNSAFE_CAUSE == null;
+        return EXPLICIT_NO_UNSAFE_CAUSE != null;
     }
 
     private static Throwable explicitNoUnsafeCause0() {",0
Added null checks when dependency is not found,"         installedVersion.bindText(new ReadOnlyBinding<String>() {
             @Override
             public String get() {
-                if (dependencyInfoBinding.get() != null) {
+                if (dependencyInfoBinding.get() != null && moduleManager.getRegistry().getLatestModuleVersion(dependencyInfoBinding.get().getId()) != null) {
                     return String.valueOf(moduleManager.getRegistry().getLatestModuleVersion(dependencyInfoBinding.get().getId()).getVersion());
                 }
                 return """";
@@ -288,6 +288,11 @@
 
             @Override
             public void draw(DependencyInfo value, Canvas canvas) {
+                if (moduleManager.getRegistry().getLatestModuleVersion(value.getId()) == null) {
+                    canvas.setMode(""invalid"");
+                } else {
+                    canvas.setMode(""available"");
+                }
                 canvas.drawText(getString(value), canvas.getRegion());
             }
 
@@ -316,7 +321,7 @@
             public Boolean get() {
                 final String online = onlineVersion.getText();
                 final String installed = installedVersion.getText();
-                if (StringUtils.isNotBlank(online)) {
+                if (StringUtils.isNotBlank(online) && StringUtils.isNotBlank(installed)) {
                     return new Version(online).compareTo(new Version(installed)) > 0;
                 }
                 return false;",0
Override some methods in SortedMap for refinement of their result class,"     SortedMap<K, V> put(Tuple2<? extends K, ? extends V> entry);
 
     @Override
+    <U extends V> SortedMap<K, V> put(K key, U value, BiFunction<? super V, ? super U, ? extends V> merge);
+
+    @Override
+    <U extends V> SortedMap<K, V> put(Tuple2<? extends K, U> entry, BiFunction<? super V, ? super U, ? extends V> merge);
+
+    @Override
     SortedMap<K, V> remove(K key);
 
     @Override
     SortedMap<K, V> removeAll(Iterable<? extends K> keys);
 
     @Override
+    SortedMap<K, V> replace(K key, V oldValue, V newValue);
+
+    @Override
     SortedMap<K, V> replace(Tuple2<K, V> currentElement, Tuple2<K, V> newElement);
 
     @Override
+    SortedMap<K, V> replaceValue(K key, V value);
+
+    @Override
+    SortedMap<K, V> replaceAll(BiFunction<? super K, ? super V, ? extends V> function);
+
+    @Override
     SortedMap<K, V> replaceAll(Tuple2<K, V> currentElement, Tuple2<K, V> newElement);
 
     @Override",0
Fix loot tracker box subtitle," 
 		logTitle.add(titleLabel, BorderLayout.WEST);
 
-		// If we have subtitle, add it
-		if (!Strings.isNullOrEmpty(subtitle))
-		{
-			subTitleLabel.setText(subtitle);
 			subTitleLabel.setFont(FontManager.getRunescapeSmallFont());
 			subTitleLabel.setForeground(ColorScheme.LIGHT_GRAY_COLOR);
 			logTitle.add(subTitleLabel, BorderLayout.CENTER);
+
+		if (!Strings.isNullOrEmpty(subtitle))
+		{
+			subTitleLabel.setText(subtitle);
 		}
 
 		priceLabel.setFont(FontManager.getRunescapeSmallFont());",0
Fix a array index out of bounds warning," package io.crate.expression.scalar.arithmetic;
 
 import io.crate.data.Input;
+import io.crate.expression.scalar.ScalarFunctionModule;
 import io.crate.metadata.BaseFunctionResolver;
-import io.crate.metadata.functions.params.FuncParams;
 import io.crate.metadata.FunctionIdent;
 import io.crate.metadata.FunctionImplementation;
 import io.crate.metadata.FunctionInfo;
 import io.crate.metadata.FunctionResolver;
 import io.crate.metadata.Scalar;
+import io.crate.metadata.functions.params.FuncParams;
 import io.crate.metadata.functions.params.Param;
-import io.crate.expression.scalar.ScalarFunctionModule;
 import io.crate.types.DataType;
 import io.crate.types.DataTypes;
 import org.elasticsearch.common.lucene.BytesRefs;
@@ -84,7 +84,7 @@
     @Override
     public final Object evaluate(Input<Object>... args) {
         Map<String, Object> m = new HashMap<>(args.length / 2, 1.0f);
-        for (int i = 0; i < args.length; i += 2) {
+        for (int i = 0; i < args.length - 1; i += 2) {
             m.put(BytesRefs.toBytesRef(args[i].value()).utf8ToString(), args[i + 1].value());
         }
         return m;",0
correct a bug introduced with optionals," 
 package com.github.javaparser.ast.expr;
 
+import static com.github.javaparser.utils.Utils.assertNotNull;
+
+import java.util.Optional;
+
 import com.github.javaparser.Range;
 import com.github.javaparser.ast.NodeList;
 import com.github.javaparser.ast.body.BodyDeclaration;
@@ -33,10 +37,6 @@
 import com.github.javaparser.ast.visitor.GenericVisitor;
 import com.github.javaparser.ast.visitor.VoidVisitor;
 
-import java.util.Optional;
-
-import static com.github.javaparser.utils.Utils.assertNotNull;
-
 /**
  * Defines constructor call expression.
  * Example:
@@ -59,7 +59,6 @@
 
     private NodeList<Expression> args;
 
-    // TODO This can be null, to indicate there is no body
     private NodeList<BodyDeclaration<?>> anonymousClassBody;
 
     public ObjectCreationExpr() {
@@ -68,7 +67,7 @@
                 new ClassOrInterfaceType(),
                 new NodeList<>(),
                 new NodeList<>(),
-                new NodeList<>());
+                null);
     }
 
     /**
@@ -85,7 +84,7 @@
                 type,
                 new NodeList<>(),
                 args,
-                new NodeList<>());
+                null);
     }
 
     public ObjectCreationExpr(final Range range,
@@ -135,9 +134,11 @@
     }
 
     /**
-     * Sets the anonymousClassBody
+     * Sets the anonymousClassBody<br>
+     * Null means no class body<br>
+     * Empty NodeList means new ClassName(){ }
      * 
-     * @param anonymousClassBody the anonymousClassBody, can be null
+     * @param anonymousClassBody the anonymousClassBody, can be null or empty
      * @return this, the ObjectCreationExpr
      */
     public ObjectCreationExpr setAnonymousClassBody(final NodeList<BodyDeclaration<?>> anonymousClassBody) {",0
Fix PUBDEV-3593 TwoDimTable array entries,"       cellValues[row][col] = new IcedWrapper(null);
     else if (o instanceof Double && Double.isNaN((double)o))
       cellValues[row][col] = new IcedWrapper(Double.NaN);
+    else if (o instanceof int[])
+      cellValues[row][col] = new IcedWrapper(Arrays.toString((int[])o));
+    else if (o instanceof long[])
+      cellValues[row][col] = new IcedWrapper(Arrays.toString((long[])o));
+    else if (o instanceof float[])
+      cellValues[row][col] = new IcedWrapper(Arrays.toString((float[])o));
+    else if (o instanceof double[])
+      cellValues[row][col] = new IcedWrapper(Arrays.toString((double[])o));
     else if (colTypes[col]==""string"")
       cellValues[row][col] = new IcedWrapper(o.toString());
     else",0
Fixed GWT gl20," 	@Override
 	public int glGetUniformLocation (int program, String name) {
 		WebGLUniformLocation location = gl.getUniformLocation(programs.get(program), name);
+		if (location == null) return -1;
 		return allocateUniformLocationId(program, location);
 	}
 ",0
Prevent negative values when overlay is bigger than screen," 					}
 
 					final Dimension realDimensions = client.getRealDimensions();
-					location.x = Ints.constrainToRange(location.x, 0, realDimensions.width - dimension.width);
-					location.y = Ints.constrainToRange(location.y, 0, realDimensions.height - dimension.height);
+					location.x = Ints.constrainToRange(location.x, 0, Math.max(0, realDimensions.width - dimension.width));
+					location.y = Ints.constrainToRange(location.y, 0, Math.max(0, realDimensions.height - dimension.height));
 				}
 
 				if (overlay.getPreferredSize() != null)
@@ -347,8 +347,8 @@
 		{
 			final Dimension realDimension = client.getRealDimensions();
 			mousePoint.translate(-overlayOffset.x, -overlayOffset.y);
-			mousePoint.x = Ints.constrainToRange(mousePoint.x, 0, realDimension.width - movedOverlay.getBounds().width);
-			mousePoint.y = Ints.constrainToRange(mousePoint.y, 0, realDimension.height - movedOverlay.getBounds().height);
+			mousePoint.x = Ints.constrainToRange(mousePoint.x, 0, Math.max(0, realDimension.width - movedOverlay.getBounds().width));
+			mousePoint.y = Ints.constrainToRange(mousePoint.y, 0, Math.max(0, realDimension.height - movedOverlay.getBounds().height));
 			movedOverlay.setPreferredPosition(null);
 			movedOverlay.setPreferredLocation(mousePoint);
 			mouseEvent.consume();",0
PUBDEV-5900: Fix Java version in error message,"     String version = System.getProperty(""java.version"");
     // NOTE for developers: make sure that the following whitelist is logically consistent with whitelist in R code - see file connection.R near line 536
     if (version != null && !(version.startsWith(""1.7"") || version.startsWith(""1.8"") || version.startsWith(""9"") || version.startsWith(""10""))) {
-      System.err.println(""Only Java 1.7-1.8, 9 and 10 is supported, system version is "" + version);
+      System.err.println(""Only Java 7, 8, 9 and 10 are supported, system version is "" + version);
       return true;
     }
     String vmName = System.getProperty(""java.vm.name"");",0
Fix Water/Lava Fluid Localization," import java.util.Map;
 
 import net.minecraft.block.Block;
+import net.minecraft.util.StatCollector;
 import net.minecraftforge.common.MinecraftForge;
 import net.minecraftforge.event.Event;
 
@@ -25,8 +26,19 @@
     static BiMap<String, Integer> fluidIDs = HashBiMap.create();
     static BiMap<Block, Fluid> fluidBlocks;
     
-    public static final Fluid WATER = new Fluid(""water"").setBlockID(Block.waterStill.blockID).setUnlocalizedName(Block.waterStill.getUnlocalizedName());
-    public static final Fluid LAVA = new Fluid(""lava"").setBlockID(Block.lavaStill.blockID).setLuminosity(15).setDensity(3000).setViscosity(6000).setTemperature(1300).setUnlocalizedName(Block.lavaStill.getUnlocalizedName());
+    public static final Fluid WATER = new Fluid(""water"") {
+        @Override
+        public String getLocalizedName() {
+            return StatCollector.translateToLocal(""tile.water.name"");
+        }
+    }.setBlockID(Block.waterStill.blockID).setUnlocalizedName(Block.waterStill.getUnlocalizedName());
+    
+    public static final Fluid LAVA = new Fluid(""lava"") {
+        @Override
+        public String getLocalizedName() {
+            return StatCollector.translateToLocal(""tile.lava.name"");
+        }
+    }.setBlockID(Block.lavaStill.blockID).setLuminosity(15).setDensity(3000).setViscosity(6000).setTemperature(1300).setUnlocalizedName(Block.lavaStill.getUnlocalizedName());
 
     public static int renderIdFluid = -1;
 ",0
fix bug#connection in druid infinitely increased," public class ElasticSearchConnection implements Connection {
 
     private Client client;
+    //关闭标识
+    private boolean closeStatus = true;
 
     public ElasticSearchConnection(String jdbcUrl, Properties info) {
 
@@ -41,6 +43,7 @@
                 transportClient.addTransportAddress(new TransportAddress(InetAddress.getByName(host), Integer.parseInt(port)));
             }
             client = transportClient;
+            closeStatus = false;
         } catch (UnknownHostException e) {
             e.printStackTrace();
         }
@@ -586,12 +589,14 @@
 
     @Override
     public void close() throws SQLException {
+        this.getClient().close();
+        closeStatus = true;
 
     }
 
     @Override
     public boolean isClosed() throws SQLException {
-        return false;
+        return closeStatus;
     }
 
     @Override",0
fix direct-memory usage count for load-manager," import com.yahoo.pulsar.broker.PulsarService;
 import com.yahoo.pulsar.broker.admin.AdminResource;
 import com.yahoo.pulsar.broker.loadbalance.BrokerHostUsage;
+import com.yahoo.pulsar.broker.stats.metrics.JvmMetrics;
 import com.yahoo.pulsar.common.naming.NamespaceName;
 import com.yahoo.pulsar.common.naming.ServiceUnitId;
 import com.yahoo.pulsar.common.policies.data.loadbalancer.SystemResourceUsage;
@@ -169,8 +170,7 @@
         systemResourceUsage.memory.limit = (double) maxHeapMemoryInBytes / MIBI;
 
         // Collect JVM direct memory
-        systemResourceUsage.directMemory.usage = (double) (sun.misc.SharedSecrets.getJavaNioAccess()
-                .getDirectBufferPool().getMemoryUsed() / MIBI);
+        systemResourceUsage.directMemory.usage = (double) (JvmMetrics.getJvmDirectMemoryUsed() / MIBI);
         systemResourceUsage.directMemory.limit = (double) (sun.misc.VM.maxDirectMemory() / MIBI);
 
         return systemResourceUsage;",0
fixing BoundingBox mul," 	 * @return This bounding box for chaining. */
 	public BoundingBox mul (Matrix4 transform) {
 		final float x0 = min.x, y0 = min.y, z0 = min.z, x1 = max.x, y1 = max.y, z1 = max.z;
+		inf();
 		ext(tmpVector.set(x0, y0, z0).mul(transform));
 		ext(tmpVector.set(x0, y0, z1).mul(transform));
 		ext(tmpVector.set(x0, y1, z0).mul(transform));",0
Fix javadoc in PluginLoader#withAlias' javadoc,"     }
 
     /**
-     * @Deprecated Let's avoid adding more aliases. It complicates the API.
+     * @deprecated Let's avoid adding more aliases. It complicates the API.
      * Instead of an alias, we can use fully qualified class name of the alternative implementation.
      * <p>
      * Adds an alias for a class name to this plugin loader. Instead of the fully qualified type name,",0
Fix NPE with cookies and headers processing," 		JClass stringClass = classes().STRING;
 		JClass mapClass = classes().HASH_MAP.narrow(stringClass, stringClass);
 		availableHeadersField = getGeneratedClass().field(JMod.PRIVATE, mapClass, ""availableHeaders"");
-		init.body().assign(availableHeadersField, _new(mapClass));
+		getInit().body().assign(availableHeadersField, _new(mapClass));
 	}
 
 	public JFieldVar getAvailableCookiesField() {
@@ -245,7 +245,7 @@
 		JClass stringClass = classes().STRING;
 		JClass mapClass = classes().HASH_MAP.narrow(stringClass, stringClass);
 		availableCookiesField = getGeneratedClass().field(JMod.PRIVATE, mapClass, ""availableCookies"");
-		init.body().assign(availableCookiesField, _new(mapClass));
+		getInit().body().assign(availableCookiesField, _new(mapClass));
 	}
 
 	public JFieldVar getAuthenticationField() {",0
#146 No limit on queries for update,"  */
 package org.jkiss.dbeaver.model.impl.sql;
 
+import net.sf.jsqlparser.statement.select.PlainSelect;
+import net.sf.jsqlparser.statement.select.Select;
 import org.jkiss.dbeaver.model.exec.DBCException;
 import org.jkiss.dbeaver.model.exec.DBCQueryTransformer;
 import org.jkiss.dbeaver.model.exec.DBCStatement;
@@ -59,7 +61,7 @@
             String testQuery = query.getQuery().toUpperCase().trim();
             plainSelect = testQuery.startsWith(""SELECT"") && !testQuery.contains(""LIMIT"") && !testQuery.contains(""INTO"");
         }
-        if (!plainSelect) {
+        if (!plainSelect || ((PlainSelect)((Select) query.getStatement()).getSelectBody()).isForUpdate()) {
             // Do not use limit if it is not a select or it already has LIMIT or it is SELECT INTO statement
             limitSet = false;
             newQuery = query.getQuery();",0
Fix parsing of quoted strings," 
     private static final String NEW_LINE = System.getProperty(""line.separator"");
 
+		private static final int MODE_SINGLE = 100;
+		private static final int MODE_DOUBLE = 101;
+		private static final int MODE_ESCAPE_SINGLE = 102;
+		private static final int MODE_ESCAPE_DOUBLE = 103;
+		private static final int MODE_BETWEEN = 104;
+
     private static void appendIndent(StringBuilder sb, int count) {
         for (; count > 0; --count) sb.append(INDENT);
     }
 
-    private static boolean isEscaped(StringBuilder sb, int index) {
-        boolean escaped = false;
-        int idx = Math.min(index, sb.length());
-        try {
-            while (idx > 0 && sb.charAt(--idx) == '\\') {
-                escaped = !escaped;
-            }
-        } catch (Exception e){
-            logger.warn(""Failed to check escaped "", e);
-        }
-        return escaped;
-    }
-
     public static String prettyPrint(String input) {
 
         input = input.replaceAll(""[\\r\\n]"", """");
 
         StringBuilder output = new StringBuilder(input.length() * 2);
-        boolean quoteOpened = false;
+				int mode = MODE_BETWEEN;
         int depth = 0;
 
         for (int i = 0; i < input.length(); ++i) {
             char ch = input.charAt(i);
 
+						switch (mode) {
+								case MODE_BETWEEN:
             switch (ch) {
                 case '{':
                 case '[':
                     output.append(ch);
-                    if (!quoteOpened) {
                         output.append(NEW_LINE);
                         appendIndent(output, ++depth);
-                    }
                     break;
                 case '}':
                 case ']':
-                    if (quoteOpened)
-                        output.append(ch);
-                    else {
                         output.append(NEW_LINE);
                         appendIndent(output, --depth);
                         output.append(ch);
-                    }
-                    break;
-                case '""':
-                case '\'':
-                    output.append(ch);
-                    if (quoteOpened) {
-                        if (!isEscaped(output, i))
-                            quoteOpened = false;
-                    } else quoteOpened = true;
                     break;
                 case ',':
                     output.append(ch);
-                    if (!quoteOpened) {
                         output.append(NEW_LINE);
                         appendIndent(output, depth);
-                    }
                     break;
                 case ':':
-                    if (quoteOpened) output.append(ch);
-                    else output.append("" : "");
+														output.append("" : "");
+														break;
+												case '\'':
+														output.append(ch);
+														mode = MODE_SINGLE;
+														break;
+												case '""':
+														output.append(ch);
+														mode = MODE_DOUBLE;
+														break;
+												case ' ':
                     break;
                 default:
-                    if (quoteOpened || !(ch == ' '))
                         output.append(ch);
                     break;
             }
+										break;
+								case MODE_ESCAPE_SINGLE:
+										output.append(ch);
+										mode = MODE_SINGLE;
+										break;
+								case MODE_ESCAPE_DOUBLE:
+										output.append(ch);
+										mode = MODE_DOUBLE;
+										break;
+								case MODE_SINGLE:
+										output.append(ch);
+										switch (ch) {
+												case '\'':
+														mode = MODE_BETWEEN;
+														break;
+												case '\\':
+														mode = MODE_ESCAPE_SINGLE;
+														break;
+										}
+										break;
+								case MODE_DOUBLE:
+										output.append(ch);
+										switch (ch) {
+												case '""':
+														mode = MODE_BETWEEN;
+														break;
+												case '\\':
+														mode = MODE_ESCAPE_DOUBLE;
+														break;
+										}
+										break;
+            }
         }
         return output.toString();
     }",0
CAMEL-7868: Fix concatenation of params to url," 
         String url = ""jetty:%s://%s:%s/%s?httpMethodRestrict=%s"";
         if (!query.isEmpty()) {
-            url = url + ""?"" + query;
+            url = url + ""&"" + query;
         }
 
         // must use upper case for restrict",0
[android] Fix sorting bug," import android.os.ParcelUuid;
 import android.os.Parcelable;
 import android.os.SystemClock;
+import android.util.Log;
 import android.view.LayoutInflater;
 import android.view.Menu;
 import android.view.View;
@@ -96,7 +97,7 @@
       scanLeDevice(false);
       mMdnsUrlDiscoverer.stopScanning();
       mSsdpUrlDiscoverer.stopScanning();
-      mNearbyDeviceAdapter.sortDevices();
+      mNearbyDeviceAdapter.sortUrls();
       mNearbyDeviceAdapter.notifyDataSetChanged();
       fadeInListView();
     }
@@ -225,7 +226,7 @@
       return;
     }
     // Get the url for the given item
-    String url = mNearbyDeviceAdapter.getUrlForListItem(position);
+    String url = mNearbyDeviceAdapter.getItem(position);
     String urlToNavigateTo = url;
     // If this url has metadata
     if (mUrlToUrlMetadata.get(url) != null) {
@@ -261,7 +262,7 @@
       mNearbyDeviceAdapter.addItem(url, mockAddress, mockTxPower);
       mNearbyDeviceAdapter.updateItem(url, mockAddress, mockRssi, mockTxPower);
       // Inform the list adapter of the new data
-      mNearbyDeviceAdapter.sortDevices();
+      mNearbyDeviceAdapter.sortUrls();
       mNearbyDeviceAdapter.notifyDataSetChanged();
       // Stop the refresh animation
       mSwipeRefreshWidget.setRefreshing(false);
@@ -416,14 +417,14 @@
 
     public final RegionResolver mRegionResolver;
     private final HashMap<String, String> mUrlToDeviceAddress;
-    private List<String> mSortedDevices;
+    private List<String> mSortedUrls;
     private final HashMap<String, Integer> mUrlToTxPower;
 
     NearbyBeaconsAdapter() {
       mUrlToDeviceAddress = new HashMap<>();
       mUrlToTxPower = new HashMap<>();
       mRegionResolver = new RegionResolver();
-      mSortedDevices = new ArrayList<>();
+      mSortedUrls = new ArrayList<>();
     }
 
     public void updateItem(String url, String address, int rssi, int txPower) {
@@ -437,12 +438,12 @@
 
     @Override
     public int getCount() {
-      return mSortedDevices.size();
+      return mSortedUrls.size();
     }
 
     @Override
     public String getItem(int i) {
-      return mSortedDevices.get(i);
+      return mSortedUrls.get(i);
     }
 
     @Override
@@ -465,7 +466,7 @@
       ImageView iconImageView = (ImageView) view.findViewById(R.id.icon);
 
       // Get the url for the given position
-      String url = getUrlForListItem(i);
+      String url = getItem(i);
 
       // Get the metadata for this url
       PwsClient.UrlMetadata urlMetadata = mUrlToUrlMetadata.get(url);
@@ -540,23 +541,14 @@
       }
     }
 
-    public String getUrlForListItem(int i) {
-      String address = getItem(i);
-      for (String url : mUrlToDeviceAddress.keySet()) {
-        if (mUrlToDeviceAddress.get(url).equals(address)) {
-          return url;
-        }
-      }
-      return null;
-    }
-
-    public void sortDevices() {
-      mSortedDevices = new ArrayList<>(mUrlToDeviceAddress.values());
-      Collections.sort(mSortedDevices, new MetadataComparator(mUrlToUrlMetadata));
+    public void sortUrls() {
+      Log.d(TAG, ""Sorting urls"");
+      mSortedUrls = new ArrayList<>(mUrlToDeviceAddress.keySet());
+      Collections.sort(mSortedUrls, new MetadataComparator(mUrlToUrlMetadata));
     }
 
     public void clear() {
-      mSortedDevices.clear();
+      mSortedUrls.clear();
       mUrlToDeviceAddress.clear();
       notifyDataSetChanged();
     }",0
解决了连接JDBC的出现空指针的小bug," 		c.setHost(dsc.getIp());
 		c.setPort(dsc.getPort());
 		c.setPool(this);
+		c.setSchema(schema);
 		try {
 			Connection con = DriverManager.getConnection(dsc.getUrl(),
 					dsc.getUser(), dsc.getPassword());",0
KYLIN-3822 fix the param parse error in DeployCoprocessorCLI,"             hbaseAdmin = conn.getAdmin();
             String localCoprocessorJar;
             int curIdx = 0;
-            if (""default"".equals(args[curIdx++])) {
+            if (""default"".equals(args[curIdx])) {
                 localCoprocessorJar = kylinConfig.getCoprocessorLocalJar();
             } else {
                 localCoprocessorJar = new File(args[curIdx]).getAbsolutePath();
             }
-
+            curIdx++;
             logger.info(""Identify coprocessor jar "" + localCoprocessorJar);
 
             try {
-                MAX_THREADS = Integer.parseInt(args[curIdx++]);
+                MAX_THREADS = Integer.parseInt(args[curIdx]);
             } catch (Exception e) {
-                curIdx--;
+                
             }
+            curIdx++;
             logger.info(""Use at most {} threads to do upgrade"", MAX_THREADS);
 
             List<String> tableNames = getHTableNames(kylinConfig);",0
Fix css tag selector," 
           case ""tag name"":
             toReturn.put(""using"", ""css selector"");
-            toReturn.put(""value"", ""#"" + cssEscape(value));
+            toReturn.put(""value"", cssEscape(value));
             break;
 
           case ""xpath"":",0
Fixing bug with drop logic.,"     }
 
     private boolean shouldDropToWorld(CreateBlockDropsEvent event, Block block, BlockDamageModifierComponent blockDamageModifierComponent, EntityRef item) {
-        return !isDirectPickup(block, blockDamageModifierComponent)
-                && !inventoryManager.giveItem(event.getInstigator(), item);
+        return !isDirectPickup(block, blockDamageModifierComponent) || !inventoryManager.giveItem(event.getInstigator(), item);
     }
 
     private boolean isDirectPickup(Block block, BlockDamageModifierComponent blockDamageModifierComponent) {",0
ReaderHandler starts receiving messages after WebSocket session estab…," import org.apache.pulsar.common.util.DateFormatter;
 import org.apache.pulsar.common.util.ObjectMapperFactory;
 import org.apache.pulsar.websocket.data.ConsumerMessage;
+import org.eclipse.jetty.websocket.api.Session;
 import org.eclipse.jetty.websocket.api.WriteCallback;
 import org.eclipse.jetty.websocket.servlet.ServletUpgradeResponse;
 import org.slf4j.Logger;
@@ -87,7 +88,6 @@
                 log.warn(""[{}:{}] Failed to add reader handler for topic {}"", request.getRemoteAddr(),
                         request.getRemotePort(), topic);
             }
-            receiveMessage();
         } catch (Exception e) {
             log.warn(""[{}:{}] Failed in creating reader {} on topic {}"", request.getRemoteAddr(),
                     request.getRemotePort(), subscription, topic, e);
@@ -162,6 +162,12 @@
     }
 
     @Override
+    public void onWebSocketConnect(Session session) {
+        super.onWebSocketConnect(session);
+        receiveMessage();
+    }
+
+    @Override
     public void onWebSocketText(String message) {
         super.onWebSocketText(message);
 ",0
fix protocol version compatibility on master," public final class Version {
     private static final Logger logger = LoggerFactory.getLogger(Version.class);
 
-    // Dubbo RPC protocol version
-    public static final String DEFAULT_DUBBO_PROTOCOL_VERSION = ""2.0.2"";
+    // Dubbo RPC protocol version, for compatibility, it must not be between 2.0.10 ~ 2.6.2
+    public static final String DEFAULT_DUBBO_PROTOCOL_VERSION = ""2.0.1"";
     // Dubbo implementation version, usually is jar version.
     private static final String VERSION = getVersion(Version.class, """");
 
@@ -43,7 +43,7 @@
      * For protocol compatibility purpose.
      * Because {@link #isSupportResponseAttatchment} is checked for every call, int compare expect to has higher performance than string.
      */
-    private static final int LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT = 202; // 2.0.2
+    private static final int LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT = 20001; // 2.0.1
     private static final Map<String, Integer> VERSION2INT = new HashMap<String, Integer>();
 
     static {
@@ -66,7 +66,13 @@
         if (version == null || version.length() == 0) {
             return false;
         }
-        return getIntVersion(version) >= LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT;
+        // for previous dubbo version(2.0.10/020010~2.6.2/020602), this version is the jar's version, so they need to be ignore
+        int iVersion = getIntVersion(version);
+        if (iVersion >= 20010 && iVersion <= 20602) {
+            return false;
+        }
+
+        return iVersion >= LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT;
     }
 
     public static int getIntVersion(String version) {
@@ -82,12 +88,31 @@
         int v = 0;
         String[] vArr = version.split(""\\."");
         int len = vArr.length;
-        for (int i = 1; i <= len; i++) {
-            v += Integer.parseInt(vArr[len - i]) * Math.pow(10, i - 1);
+        for (int i = 0; i < len; i++) {
+            v += Integer.parseInt(getDigital(vArr[i])) * Math.pow(10, (len - i - 1) * 2);
         }
         return v;
     }
 
+    private static String getDigital(String v) {
+        int index = 0;
+        for (int i = 0; i < v.length(); i++) {
+            char c = v.charAt(i);
+            if (Character.isDigit(c)) {
+                if (i == v.length() - 1) {
+                    index = i + 1;
+                } else {
+                    index = i;
+                }
+                continue;
+            } else {
+                index = i;
+                break;
+            }
+        }
+        return v.substring(0, index);
+    }
+
     private static boolean hasResource(String path) {
         try {
             return Version.class.getClassLoader().getResource(path) != null;",0
Prevent WSMessage deserialization failure from closing websocket," package net.runelite.client.ws;
 
 import com.google.gson.Gson;
+import com.google.gson.JsonParseException;
 import java.util.Collection;
 import java.util.HashSet;
 import java.util.Objects;
@@ -154,7 +155,18 @@
 	@Override
 	public void onMessage(WebSocket webSocket, String text)
 	{
-		final WebsocketMessage message = gson.fromJson(text, WebsocketMessage.class);
+		final WebsocketMessage message;
+
+		try
+		{
+			message = gson.fromJson(text, WebsocketMessage.class);
+		}
+		catch (JsonParseException e)
+		{
+			log.debug(""Failed to deserialize message"", e);
+			return;
+		}
+
 		if (message.isParty() && !(message instanceof PartyMessage))
 		{
 			// spoofed message?",0
Fix wrong analytics event for demo mode switch.," 
       analytics.send(new HitBuilders.EventBuilder() //
           .setCategory(Analytics.CATEGORY_SETTINGS)
-          .setAction(Analytics.ACTION_CHANGE_SHOW_TOUCHES)
+          .setAction(Analytics.ACTION_CHANGE_USE_DEMO_MODE)
           .setValue(newValue ? 1 : 0)
           .build());
     }",0
jecxz jcxz translators call fix,"       translators.put(""jae"", new JccTranslator(new NotBelowGenerator()));
       translators.put(""jb"", new JccTranslator(new BelowGenerator()));
       translators.put(""jbe"", new JccTranslator(new BelowEqualGenerator()));
-      translators.put(""jcxz"", new JccTranslator(new EcxZeroGenerator()));
-      translators.put(""jecxz"", new JccTranslator(new CxZeroGenerator()));
+      translators.put(""jecxz"", new JccTranslator(new EcxZeroGenerator()));
+      translators.put(""jcxz"", new JccTranslator(new CxZeroGenerator()));
       translators.put(""je"", new JccTranslator(new ZeroGenerator()));
       translators.put(""jg"", new JccTranslator(new GreaterGenerator()));
       translators.put(""jge"", new JccTranslator(new GreaterEqualGenerator()));",0
Fixes NPE when initializing twice," 	private void prepareReactApp() {
 		if (shouldCreateContext()) {
 			reactInstanceManager.createReactContextInBackground();
-		} else if (waitingForAppLaunchEvent) {
-			emitAppLaunched();
 		}
 	}
 
-	private void emitAppLaunched() {
+	private void emitAppLaunched(final ReactContext context) {
+		if (waitingForAppLaunchEvent) {
 		waitingForAppLaunchEvent = false;
-		new NavigationEvent(reactInstanceManager.getCurrentReactContext()).appLaunched();
+			new NavigationEvent(context).appLaunched();
+		}
 	}
 
 	private boolean shouldCreateContext() {
@@ -61,6 +61,6 @@
 
 	@Override
 	public void onReactContextInitialized(final ReactContext context) {
-		emitAppLaunched();
+		emitAppLaunched(context);
 	}
 }",0
[FORWARD-PORT] Fixes overflow problem in ClientResponseHandlerSupplier," import static com.hazelcast.client.spi.properties.ClientProperty.RESPONSE_THREAD_COUNT;
 import static com.hazelcast.instance.OutOfMemoryErrorDispatcher.onOutOfMemory;
 import static com.hazelcast.spi.impl.operationservice.impl.InboundResponseHandlerSupplier.getIdleStrategy;
+import static com.hazelcast.util.HashUtil.hashToIndex;
 
 /**
  * A {@link Supplier} for {@link ClientResponseHandler} instance.
@@ -186,7 +187,7 @@
     class AsyncMultiThreadedResponseHandler implements ClientResponseHandler {
         @Override
         public void handle(ClientMessage message, ClientConnection connection) {
-            int threadIndex = INT_HOLDER.get().getAndInc() % responseThreads.length;
+            int threadIndex = hashToIndex(INT_HOLDER.get().getAndInc(), responseThreads.length);
             responseThreads[threadIndex].responseQueue.add(new ClientPacket(connection, message));
         }
     }",0
Local ZapVersions.xml is saved with default character encoding," import java.awt.event.ActionListener;
 import java.awt.event.KeyEvent;
 import java.io.File;
-import java.io.FileWriter;
 import java.io.IOException;
 import java.io.StringReader;
 import java.lang.reflect.InvocationTargetException;
 import java.net.MalformedURLException;
 import java.net.URL;
 import java.nio.file.FileAlreadyExistsException;
+import java.nio.file.Files;
 import java.nio.file.Path;
 import java.util.ArrayList;
 import java.util.Collection;
@@ -820,22 +820,11 @@
 
         // Save version file so we can report new addons next time
 		File f = new File(Constant.FOLDER_LOCAL_PLUGIN, VERSION_FILE_NAME);
-    	FileWriter out = null;
 	    try {
-	    	out = new FileWriter(f);
-	    	out.write(msg.getResponseBody().toString());
-		} catch (Exception e) {
-			logger.error(e.getMessage(), e);
-	    } finally {
-	    	try {
-				if (out != null) {
-					out.close();
+            Files.write(f.toPath(), msg.getResponseBody().getBytes());
+        }catch(IOException ioe){
+            logger.error(ioe.getMessage(), ioe);
 				}
-			} catch (IOException e) {
-				// Ignore
-			}
-		}
-
     	
     	return config;
     }",0
Fix item use counting towards craft stat," 
                     world.markAndNotifyBlock(snap.getPos(), null, oldBlock, newBlock, updateFlag);
                 }
-                player.addStat(StatList.getCraftStats(itemstack.getItem()));
+                player.addStat(StatList.getObjectUseStats(itemstack.getItem()));
             }
         }
         world.capturedBlockSnapshots.clear();",0
Fix storing meeting metadata,"                 // Need to lowercase to maintain backward compatibility with
                 // 0.81
                 String metaName = removeMetaString(entry.getKey()).toLowerCase();
-                metas.put(metaName, params.get(entry.getValue()));
+                metas.put(metaName, entry.getValue());
             }
         }
 ",0
Fix source block check for BlockFluidClassic," 
     public boolean isSourceBlock(IBlockAccess world, BlockPos pos)
     {
-        return world.getBlockState(pos) == this && ((Integer)world.getBlockState(pos).getValue(LEVEL)).intValue() == 0;
+        return world.getBlockState(pos).getBlock() == this && ((Integer)world.getBlockState(pos).getValue(LEVEL)).intValue() == 0;
     }
 
     protected boolean[] getOptimalFlowDirections(World world, BlockPos pos)",0
use hyphen instead of camel for prefix,"             @EnableDubboConfigBinding(prefix = ""dubbo.monitor"", type = MonitorConfig.class),
             @EnableDubboConfigBinding(prefix = ""dubbo.provider"", type = ProviderConfig.class),
             @EnableDubboConfigBinding(prefix = ""dubbo.consumer"", type = ConsumerConfig.class),
-            @EnableDubboConfigBinding(prefix = ""dubbo.configCenter"", type = ConfigCenterBean.class),
-            @EnableDubboConfigBinding(prefix = ""dubbo.registryData"", type = RegistryDataConfig.class),
-            @EnableDubboConfigBinding(prefix = ""dubbo.metadataReport"", type = MetadataReportConfig.class)
+            @EnableDubboConfigBinding(prefix = ""dubbo.config-center"", type = ConfigCenterBean.class),
+            @EnableDubboConfigBinding(prefix = ""dubbo.registry-data"", type = RegistryDataConfig.class),
+            @EnableDubboConfigBinding(prefix = ""dubbo.metadata-report"", type = MetadataReportConfig.class)
     })
     public static class Single {
 
@@ -78,7 +78,7 @@
             @EnableDubboConfigBinding(prefix = ""dubbo.monitors"", type = MonitorConfig.class, multiple = true),
             @EnableDubboConfigBinding(prefix = ""dubbo.providers"", type = ProviderConfig.class, multiple = true),
             @EnableDubboConfigBinding(prefix = ""dubbo.consumers"", type = ConsumerConfig.class, multiple = true),
-            @EnableDubboConfigBinding(prefix = ""dubbo.configCenters"", type = ConfigCenterBean.class, multiple = true)
+            @EnableDubboConfigBinding(prefix = ""dubbo.config-centers"", type = ConfigCenterBean.class, multiple = true)
     })
     public static class Multiple {
 ",0
fix class loader npe,"                     classes.put(""java.lang."" + className, result);
                 }
             }
+            if (result == null) {
+                return null;
+            }
             classes.put(className, result);
         }
         return result;",0
Fix NPE when no OnHeaderClickListener is set," 
 			@Override
 			public void onClick(View v) {
+				if(mOnHeaderClickListener != null)
 				mOnHeaderClickListener.onHeaderClick(StickyListHeadersListView.this, mHeader, mHeaderPosition,
 						mHeaderId, true);
 			}",0
Fix delayed ducking of Audio,"     private void onAudioFocusLossCanDuck() {
         Log.d(TAG, ""onAudioFocusLossCanDuck() called"");
         // Set the volume to 1/10 on ducking
-        animateAudio(player.getVolume(), DUCK_AUDIO_TO);
+        player.setVolume(DUCK_AUDIO_TO);
     }
 
     private void animateAudio(final float from, final float to) {",0
"Ellipse, fixed javadoc"," 		return this;
 	}
 
-	/** @return The area of this {@link Ellipse} as {@link MathUtils#PI} * {@link rx Ellipse#width} * {@link ry Ellipse#height} */
+	/** @return The area of this {@link Ellipse} as {@link MathUtils#PI} * {@link Ellipse#width} * {@link Ellipse#height} */
 	public float area () {
 		return MathUtils.PI * (this.width * this.height) / 4;
 	}",0
fix 引用类的问题," import com.google.common.base.Splitter;
 import com.google.common.collect.Lists;
 import com.google.common.io.Files;
-import com.sun.xml.internal.messaging.saaj.util.ByteInputStream;
 import org.opencloudb.config.ErrorCode;
 import org.opencloudb.config.model.SystemConfig;
 import org.opencloudb.mpp.LoadData;
@@ -47,11 +46,11 @@
 
 import java.io.*;
 import java.nio.ByteBuffer;
-import java.nio.CharBuffer;
-import java.nio.channels.FileChannel;
 import java.nio.charset.Charset;
-import java.nio.charset.CharsetDecoder;
-import java.util.*;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.Scanner;
 
 /**
  * mysql命令行客户端也需要启用local file权限，加参数--local-infile=1
@@ -106,10 +105,6 @@
     }
 
 
-
-
-
-
     private  void parseLoadDataPram()
     {
         loadData=new LoadData();
@@ -186,14 +181,12 @@
         try
         {
             BinaryPacket packet = new BinaryPacket();
-            ByteInputStream inputStream = new ByteInputStream(data, data.length);
+            ByteArrayInputStream inputStream = new ByteArrayInputStream(data, 0, data.length);
             packet.read(inputStream);
 
              saveByteOrToFile(packet.data,false);
 
 
-
-
         } catch (IOException e)
         {
             throw new RuntimeException(e);
@@ -266,8 +259,7 @@
         if(rrs==null ||rrs.getNodes()==null||rrs.getNodes().length==0)
         {
             //无路由处理
-        }
-        else
+        } else
         {
             for (RouteResultsetNode routeResultsetNode : rrs.getNodes())
             {
@@ -321,8 +313,6 @@
     }
 
 
-
-
     private RouteResultset buildResultSet(Map<String,LoadData>   routeMap)
     {
         statement.setLocal(true);//强制local
@@ -363,8 +353,6 @@
     }
 
 
-
-
     private String makeSimpleInsert(List<SQLExpr> columns, List<String> fields, String table, boolean isAddEncose)
     {
         StringBuilder sb = new StringBuilder();
@@ -418,7 +406,8 @@
              parseFileByLine(tempFile,loadData.getCharset(),loadData.getLineTerminatedBy()) ;
          }   else
          {
-         String content=new String(tempByteBuffer.toByteArray(),Charset.forName(loadData.getCharset())) ;;
+            String content = new String(tempByteBuffer.toByteArray(), Charset.forName(loadData.getCharset()));
+            ;
         List<String> lines = Splitter.on(loadData.getLineTerminatedBy()).omitEmptyStrings().splitToList(content);
         for (final String line : lines)
         {
@@ -444,16 +433,19 @@
     private  void parseFileByLine(String file,String encode,String split)
     {
         Scanner scanner =null;
-        try {
+        try
+        {
             scanner = new Scanner(new FileInputStream(file), encode);
             scanner.useDelimiter(split);
-            while (scanner.hasNextLine()){
+            while (scanner.hasNextLine())
+            {
                 parseOneLine(statement.getColumns(), statement.getTableName().getSimpleName(), scanner.nextLine(),true,split);
             }
         } catch (FileNotFoundException e)
         {
           throw new RuntimeException(e);
-        } finally{
+        } finally
+        {
             if(scanner!=null)
             scanner.close();
         }
@@ -461,7 +453,6 @@
     }
 
 
-
 //    private void sendOk(byte packID)
 //    {
 //        OkPacket ok = new OkPacket();
@@ -509,8 +500,7 @@
     /**
      * 删除目录及其所有子目录和文件
      *
-     * @param dirPath
-     *            要删除的目录路径
+     * @param dirPath 要删除的目录路径
      * @throws Exception
      */
     private static void deleteFile(String dirPath)",0
Fix tests to avoid OOMs,"     }
 
     @Test
-    public void testGroupByPartitioningColumn()
-            throws Exception
-    {
-        assertQuery(""SELECT orderkey, count(*) FROM lineitem GROUP BY orderkey"");
-    }
-
-    @Test
-    public void testJoinPartitionedTable()
-            throws Exception
-    {
-        assertQuery(""SELECT * FROM lineitem a JOIN lineitem b ON a.orderkey = b.orderkey"");
-    }
-
-    @Test
     public void testApproxPercentile()
             throws Exception
     {",0
Fix: JobExecutionContext threw a ConcurrentModificationException," 
 import javax.annotation.Nullable;
 import java.util.*;
+import java.util.concurrent.ConcurrentHashMap;
+import java.util.concurrent.ConcurrentMap;
 import java.util.concurrent.atomic.AtomicBoolean;
 import java.util.concurrent.atomic.AtomicInteger;
 
@@ -38,7 +40,8 @@
     private static final ESLogger LOGGER = Loggers.getLogger(JobExecutionContext.class);
 
     private final UUID jobId;
-    private final LinkedHashMap<Integer, ExecutionSubContext> subContexts;
+    private final ConcurrentMap<Integer, ExecutionSubContext> subContexts = new ConcurrentHashMap<>();
+    private final List<Integer> reverseContextIds;
     private final AtomicBoolean closed = new AtomicBoolean(false);
     private ThreadPool threadPool;
     private StatsTables statsTables;
@@ -88,7 +91,7 @@
                                 ThreadPool threadPool,
                                 StatsTables statsTables,
                                 LinkedHashMap<Integer, ExecutionSubContext> subContexts) {
-        this.subContexts = new LinkedHashMap<>(subContexts.size());
+        reverseContextIds = Lists.reverse(Lists.newArrayList(subContexts.keySet()));
         this.jobId = jobId;
         this.threadPool = threadPool;
         this.statsTables = statsTables;
@@ -121,10 +124,6 @@
     }
 
     public void start() {
-        List<Integer> reverseContextIds;
-        synchronized (subContexts) {
-             reverseContextIds = Lists.reverse(Lists.newArrayList(subContexts.keySet()));
-        }
         for (Integer id : reverseContextIds) {
             ExecutionSubContext subContext = subContexts.get(id);
             if (subContext == null || closed.get()) {
@@ -163,11 +162,7 @@
             if (activeSubContexts.get() == 0) {
                 callContextCallback();
             } else {
-                List<ExecutionSubContext> contexts;
-                synchronized (subContexts) {
-                    contexts = Lists.newArrayList(subContexts.values());
-                }
-                for (ExecutionSubContext executionSubContext : contexts) {
+                for (ExecutionSubContext executionSubContext : subContexts.values()) {
                     // kill will trigger the ContextCallback onClose too
                     // so it is not necessary to remove the executionSubContext from the map here as it will be done in the callback
                     executionSubContext.kill();",0
[3.5.5] ILock expiry operation should be able run both owner and backup,"         try {
             submit(operation, key);
         } catch (Throwable t) {
-            ILogger logger = nodeEngine.getLogger(getClass());
             logger.warning(t);
         }
     }
@@ -76,6 +75,7 @@
         OperationAccessor.setCallerAddress(operation, nodeEngine.getThisAddress());
         operation.setCallerUuid(nodeEngine.getLocalMember().getUuid());
         operation.setResponseHandler(unlockResponseHandler);
+        operation.setValidateTarget(false);
         operation.setAsyncBackup(true);
 
         operationService.executeOperation(operation);",0
Color fix," 			} else if (attr.equals(""COLOR"")) {
 				vertexAttributes.add(VertexAttribute.ColorUnpacked());
 			} else if (attr.equals(""COLORPACKED"")) {
-				vertexAttributes.add(VertexAttribute.Color());
+				vertexAttributes.add(VertexAttribute.ColorPacked());
 			} else if (attr.equals(""TANGENT"")) {
 				vertexAttributes.add(VertexAttribute.Tangent());
 			} else if (attr.equals(""BINORMAL"")) {",0
Fix LeakCanary toasting,"  */
 package com.squareup.leakcanary;
 
+import android.app.Activity;
+import android.app.Application;
 import android.app.Notification;
 import android.app.NotificationManager;
 import android.content.Context;
-import android.content.res.Configuration;
-import android.graphics.PixelFormat;
-import android.os.Build;
 import android.os.Debug;
 import android.os.Handler;
 import android.os.Looper;
@@ -30,16 +29,12 @@
 import android.support.annotation.Nullable;
 import android.view.Gravity;
 import android.view.LayoutInflater;
-import android.view.View;
-import android.view.WindowManager;
-import android.view.accessibility.AccessibilityEvent;
-import android.view.accessibility.AccessibilityManager;
 import android.widget.Toast;
+import com.squareup.leakcanary.internal.ActivityLifecycleCallbacksAdapter;
 import com.squareup.leakcanary.internal.FutureResult;
 import com.squareup.leakcanary.internal.LeakCanaryInternals;
 import java.io.File;
 
-import static android.view.accessibility.AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED;
 import static java.util.concurrent.TimeUnit.SECONDS;
 
 public final class AndroidHeapDumper implements HeapDumper {
@@ -48,11 +43,26 @@
   private final LeakDirectoryProvider leakDirectoryProvider;
   private final Handler mainHandler;
 
+  private Activity resumedActivity;
+
   public AndroidHeapDumper(@NonNull Context context,
       @NonNull LeakDirectoryProvider leakDirectoryProvider) {
     this.leakDirectoryProvider = leakDirectoryProvider;
     this.context = context.getApplicationContext();
     mainHandler = new Handler(Looper.getMainLooper());
+
+    Application application = (Application) context.getApplicationContext();
+    application.registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacksAdapter() {
+      @Override public void onActivityResumed(Activity activity) {
+        resumedActivity = activity;
+      }
+
+      @Override public void onActivityPaused(Activity activity) {
+        if (resumedActivity == activity) {
+          resumedActivity = null;
+        }
+      }
+    });
   }
 
   @SuppressWarnings(""ReferenceEquality"") // Explicitly checking for named null.
@@ -96,12 +106,16 @@
   private void showToast(final FutureResult<Toast> waitingForToast) {
     mainHandler.post(new Runnable() {
       @Override public void run() {
-        final Toast toast = new Toast(context);
+        if (resumedActivity == null) {
+          waitingForToast.set(null);
+          return;
+        }
+        final Toast toast = new Toast(resumedActivity);
         toast.setGravity(Gravity.CENTER_VERTICAL, 0, 0);
         toast.setDuration(Toast.LENGTH_LONG);
-        LayoutInflater inflater = LayoutInflater.from(context);
+        LayoutInflater inflater = LayoutInflater.from(resumedActivity);
         toast.setView(inflater.inflate(R.layout.leak_canary_heap_dump_toast, null));
-        show(toast);
+        toast.show();
         // Waiting for Idle to make sure Toast gets rendered.
         Looper.myQueue().addIdleHandler(new MessageQueue.IdleHandler() {
           @Override public boolean queueIdle() {
@@ -114,86 +128,13 @@
   }
 
   private void cancelToast(final Toast toast) {
+    if (toast == null) {
+      return;
+    }
     mainHandler.post(new Runnable() {
       @Override public void run() {
-        hide(toast);
+        toast.cancel();
       }
     });
   }
-
-  private void show(Toast toast) {
-    View view = toast.getView();
-    Context context = toast.getView().getContext();
-
-    WindowManager windowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
-
-    // We can resolve the Gravity here by using the Locale for getting
-    // the layout direction
-    Configuration config = view.getContext().getResources().getConfiguration();
-    int gravity = toast.getGravity();
-    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR1) {
-      gravity = Gravity.getAbsoluteGravity(gravity, config.getLayoutDirection());
-    }
-
-    WindowManager.LayoutParams params = buildLayoutParams();
-    params.gravity = gravity;
-    if ((gravity & Gravity.HORIZONTAL_GRAVITY_MASK) == Gravity.FILL_HORIZONTAL) {
-      params.horizontalWeight = 1.0f;
-    }
-    if ((gravity & Gravity.VERTICAL_GRAVITY_MASK) == Gravity.FILL_VERTICAL) {
-      params.verticalWeight = 1.0f;
-    }
-    params.x = toast.getXOffset();
-    params.y = toast.getYOffset();
-    params.verticalMargin = toast.getVerticalMargin();
-    params.horizontalMargin = toast.getHorizontalMargin();
-    params.packageName = context.getPackageName();
-    try {
-      windowManager.addView(view, params);
-    } catch (WindowManager.BadTokenException ignored) {
-      CanaryLog.d(""Could not show leak toast, the window token has been canceled"");
-      return;
-    }
-    trySendAccessibilityEvent(view);
-  }
-
-  private void hide(Toast toast) {
-    View view = toast.getView();
-    if (view.getParent() != null) {
-      Context context = toast.getView().getContext();
-      WindowManager windowManager =
-          (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);
-      windowManager.removeView(view);
-    }
-  }
-
-  private WindowManager.LayoutParams buildLayoutParams() {
-    WindowManager.LayoutParams params = new WindowManager.LayoutParams();
-    params.height = WindowManager.LayoutParams.WRAP_CONTENT;
-    params.width = WindowManager.LayoutParams.WRAP_CONTENT;
-    params.format = PixelFormat.TRANSLUCENT;
-    params.windowAnimations = android.R.style.Animation_Toast;
-    params.type = WindowManager.LayoutParams.TYPE_TOAST;
-    params.setTitle(""Toast"");
-    params.flags = WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON
-        | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE
-        | WindowManager.LayoutParams.FLAG_NOT_TOUCHABLE;
-    return params;
-  }
-
-  private void trySendAccessibilityEvent(View view) {
-    Context context = view.getContext();
-    AccessibilityManager accessibilityManager =
-        (AccessibilityManager) context.getSystemService(Context.ACCESSIBILITY_SERVICE);
-    if (!accessibilityManager.isEnabled()) {
-      return;
-    }
-    // treat toasts as notifications since they are used to
-    // announce a transient piece of information to the user
-    AccessibilityEvent event = AccessibilityEvent.obtain(TYPE_NOTIFICATION_STATE_CHANGED);
-    event.setClassName(getClass().getName());
-    event.setPackageName(context.getPackageName());
-    view.dispatchPopulateAccessibilityEvent(event);
-    accessibilityManager.sendAccessibilityEvent(event);
-  }
 }",0
fix_jump_game,"         can[0] = true;
         for (int i = 1; i < A.length; i++) {
             for (int j = 0; j < i; j++) {
-                if (A[j] && (j + A[j] >= i)) {
+                if (can[j] && (j + A[j] >= i)) {
                     can[i] = true;
                     break;
                 }",0
Fix rn 0.50 repeated calls to onMeasure.," 
     @Override
     protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
-        super.onMeasure(widthMeasureSpec, heightMeasureSpec);
-        int measuredHeight = viewMeasurer.getMeasuredHeight(heightMeasureSpec);
-        setMeasuredDimension(viewMeasurer.getMeasuredWidth(widthMeasureSpec), measuredHeight);
+        int widthSpec = MeasureSpec.makeMeasureSpec(MeasureSpec.getSize(widthMeasureSpec), MeasureSpec.AT_MOST);
+        int heightSpec = MeasureSpec.makeMeasureSpec(MeasureSpec.getSize(heightMeasureSpec), MeasureSpec.AT_MOST);
+
+        super.onMeasure(widthSpec, heightSpec);
+
+        int measuredHeight = viewMeasurer.getMeasuredHeight(heightSpec);
+        setMeasuredDimension(viewMeasurer.getMeasuredWidth(widthSpec), measuredHeight);
     }
 
     @Override",0
fixed Actor.component() method," import org.terasology.engine.API;
 import org.terasology.entitySystem.Component;
 import org.terasology.entitySystem.entity.EntityRef;
+import org.terasology.entitySystem.metadata.ComponentLibrary;
+import org.terasology.entitySystem.metadata.ComponentMetadata;
 import org.terasology.logic.location.LocationComponent;
+import org.terasology.registry.CoreRegistry;
 import org.terasology.rendering.logic.SkeletalMeshComponent;
 
 import java.util.Map;
@@ -59,16 +62,13 @@
     }
 
     public <T extends Component> T component(Class<T> type) {
-        try {
             T component = minion.getComponent(type);
             if (component == null) {
-                component = type.newInstance();
+            ComponentMetadata<T> metadata = CoreRegistry.get(ComponentLibrary.class).getMetadata(type);
+            component = metadata.newInstance();
                 minion.addComponent(component);
             }
             return component;
-        } catch (InstantiationException | IllegalAccessException e) {
-            throw new RuntimeException(e);
-        }
     }
 
     public SkeletalMeshComponent skeletalMesh() {",0
Fix texture coordinates for Plane primitive," 				vertices[vertexCount + 1] = ((float) j / (float) mSegmentsH - 0.5f) * mHeight;
 				vertices[vertexCount + 2] = 0;
 
-				textureCoords[texCoordCount++] = (float) i / (float) mSegmentsW;
-				textureCoords[texCoordCount++] = 1.0f - (float) j / (float) mSegmentsH;
+				textureCoords[texCoordCount++] = (float) j / (float) mSegmentsW;
+				textureCoords[texCoordCount++] = 1.0f - (float) i / (float) mSegmentsH;
 
 				normals[vertexCount] = 0;
 				normals[vertexCount + 1] = 0;",0
Fixed bug where rules based on Locale couldn't be promoted,"                 .build());
         fields.add(new FieldData.Builder()
                 .label(""rule_localeCode"")
-                .name(""locale"")
+                .name(""locale.localeCode"")
                 .operators(RuleOperatorType.TEXT)
                 .options(RuleOptionType.EMPTY_COLLECTION)
                 .type(SupportedFieldType.STRING)",0
Add missing condition for tentatively unfreezing node,"     public RFuture<T> get(RedisCommand<?> command) {
         for (int j = entries.size() - 1; j >= 0; j--) {
             final ClientConnectionsEntry entry = getEntry();
-            if (!entry.isFreezed() 
-                    && tryAcquireConnection(entry)) {
+            if ((!entry.isFreezed() || entry.getFreezeReason() == FreezeReason.SYSTEM) && 
+        		    tryAcquireConnection(entry)) {
                 return acquireConnection(command, entry);
             }
         }",0
Correct prefix-delimiter-suffix in mk*() JavaDoc,"     /**
      * Joins the string representations of this elements using a specific delimiter.
      * <p>
-     * This has the same effect as calling {@code mkString(delimiter, """", """")}.
+     * This has the same effect as calling {@code mkString("""", delimiter, """")}.
      *
      * @param delimiter A delimiter string put between string representations of elements of this
      * @return A new String
@@ -788,7 +788,7 @@
     /**
      * Joins the string representations of this elements using a specific delimiter, prefix and suffix.
      * <p>
-     * Example: {@code List.of(""a"", ""b"", ""c"").mkString("", "", ""Chars("", "")"") = ""Chars(a, b, c)""}
+     * Example: {@code List.of(""a"", ""b"", ""c"").mkString(""Chars("", "", "", "")"") = ""Chars(a, b, c)""}
      *
      * @param prefix    prefix of the resulting string
      * @param delimiter A delimiter string put between string representations of elements of this
@@ -815,7 +815,7 @@
     /**
      * Joins the string representations of this elements using a specific delimiter.
      * <p>
-     * This has the same effect as calling {@code mkCharSeq(delimiter, """", """")}.
+     * This has the same effect as calling {@code mkCharSeq("""", delimiter, """")}.
      *
      * @param delimiter A delimiter string put between string representations of elements of this
      * @return A new {@link CharSeq}
@@ -827,7 +827,7 @@
     /**
      * Joins the string representations of this elements using a specific delimiter, prefix and suffix.
      * <p>
-     * Example: {@code List.of(""a"", ""b"", ""c"").mkCharSeq("", "", ""Chars("", "")"") = CharSeq.of(""Chars(a, b, c))""}
+     * Example: {@code List.of(""a"", ""b"", ""c"").mkCharSeq(""Chars("", "", "", "")"") = CharSeq.of(""Chars(a, b, c))""}
      *
      * @param prefix    prefix of the resulting {@link CharSeq}
      * @param delimiter A delimiter string put between string representations of elements of this",0
fixed blank nav bar titles on Android when title font size not set.,"     }
 
     protected void setTitleTextFontSize(StyleParams params) {
-        if (params.titleBarTitleFontSize == -1) {
-            return;
-        }
+        if (params.titleBarTitleFontSize > 0) {
         View titleView = getTitleView();
         if (titleView instanceof TextView) {
             ((TextView) titleView).setTextSize(((float) params.titleBarTitleFontSize));
         }
     }
+    }
 
     protected void setSubtitleTextColor(StyleParams params) {
         if (params.titleBarSubtitleColor.hasColor()) {",0
Fixed the implementation of ViewUtil.hitTestImpl(),"         final View child = viewGroup.getChildAt(i);
 
         if (ViewUtil.isTransformedPointInView(viewGroup, child, x, y, localPoint)) {
-          View childResult = hitTest(child, localPoint.x, localPoint.y, viewSelector);
+          View childResult = hitTestImpl(
+              child,
+              localPoint.x,
+              localPoint.y,
+              viewSelector,
+              allowViewGroupResult);
+
           if (childResult != null) {
             return childResult;
           }",0
Fix: trigger function rest-api,"     @Consumes(MediaType.MULTIPART_FORM_DATA)
     public Response triggerFunction(final @PathParam(""tenant"") String tenant,
                                     final @PathParam(""namespace"") String namespace,
-                                    final @PathParam(""name"") String functionName,
+                                    final @PathParam(""functionName"") String functionName,
                                     final @FormDataParam(""data"") String input,
                                     final @FormDataParam(""dataStream"") InputStream uploadedInputStream,
                                     final @FormDataParam(""topic"") String topic) {",0
Fix typo at javadoc in ProcessorDefinition#onCompletion,"     }
 
     /**
-     * Adds a onComplection {@link org.apache.camel.spi.Synchronization} hook that invoke this route as
+     * Adds a onCompletion {@link org.apache.camel.spi.Synchronization} hook that invoke this route as
      * a callback when the {@link org.apache.camel.Exchange} has finished being processed.
      * The hook invoke callbacks for either onComplete or onFailure.
      * <p/>",0
Fix for issue #23,"         // and when we set the dimension we add it back again. Now the actual content 
         // of the view will be square, but, depending on the padding, the total dimensions 
         // of the view might not be.
+        int heightMode = MeasureSpec.getMode(heightMeasureSpec);
+        int widthMode = MeasureSpec.getMode(widthMeasureSpec);
+        if (heightMode != MeasureSpec.UNSPECIFIED && widthMode != MeasureSpec.UNSPECIFIED) {
         if (widthWithoutPadding > heigthWithoutPadding) {
             size = heigthWithoutPadding;
         } else {
             size = widthWithoutPadding;
         }
+        } else {
+            size = Math.max(heigthWithoutPadding, widthWithoutPadding);
+        }
+
         
         // If you override onMeasure() you have to call setMeasuredDimension(). 
         // This is how you report back the measured size.  If you don’t call",0
"Fix bug, now also works with RGBA8888"," 
 		float[] dest = new float[width * height];
 		for (int i = 0; i < dest.length; ++i) {
-			int v = source[sourceOffset + i * 3];
+			int v = source[sourceOffset + i * bytesPerColor];
 			v = v < 0 ? 256 + v : v;
 			dest[i] = (float)v / 255f;
 		}",0
Fix wrong buffer clear," 
 	private IntBuffer toIntBuffer (int v[], int offset, int count) {
 		ensureBufferCapacity(count << 2);
-		floatBuffer.clear();
+		intBuffer.clear();
 		com.badlogic.gdx.utils.BufferUtils.copy(v, count, offset, intBuffer);
 		return intBuffer;
 	}",0
Fix - issue with arrow not enable when setting maxDate,"         currentMonth = c;
         int position = adapter.getIndexForDay(c);
         pager.setCurrentItem(position, false);
+        updateUi();
     }
 
     public static class SavedState extends BaseSavedState {",0
[Dubbo-3237]fix connectionMonitor in RestProtocol seems not work #3237,"     private final RestServerFactory serverFactory = new RestServerFactory();
 
     // TODO in the future maybe we can just use a single rest client and connection manager
-    private final List<ResteasyClient> clients = Collections.synchronizedList(new LinkedList<ResteasyClient>());
+    private final List<ResteasyClient> clients = Collections.synchronizedList(new LinkedList<>());
 
     private volatile ConnectionMonitor connectionMonitor;
 
@@ -136,9 +136,6 @@
 
     @Override
     protected <T> T doRefer(Class<T> serviceType, URL url) throws RpcException {
-        if (connectionMonitor == null) {
-            connectionMonitor = new ConnectionMonitor();
-        }
 
         // TODO more configs to add
         PoolingHttpClientConnectionManager connectionManager = new PoolingHttpClientConnectionManager();
@@ -146,6 +143,10 @@
         connectionManager.setMaxTotal(url.getParameter(Constants.CONNECTIONS_KEY, HTTPCLIENTCONNECTIONMANAGER_MAXTOTAL));
         connectionManager.setDefaultMaxPerRoute(url.getParameter(Constants.CONNECTIONS_KEY, HTTPCLIENTCONNECTIONMANAGER_MAXPERROUTE));
 
+        if (connectionMonitor == null) {
+            connectionMonitor = new ConnectionMonitor();
+            connectionMonitor.start();
+        }
         connectionMonitor.addConnectionManager(connectionManager);
         RequestConfig requestConfig = RequestConfig.custom()
                 .setConnectTimeout(url.getParameter(Constants.CONNECT_TIMEOUT_KEY, Constants.DEFAULT_CONNECT_TIMEOUT))",0
Fixing imports of `Strings.isNullOrEmpty`.,"  */
 package org.graylog.plugins.pipelineprocessor.rest;
 
+import com.google.common.base.Strings;
+import io.swagger.annotations.Api;
+import io.swagger.annotations.ApiOperation;
+import io.swagger.annotations.ApiParam;
 import org.apache.shiro.authz.annotation.RequiresAuthentication;
 import org.apache.shiro.authz.annotation.RequiresPermissions;
-import org.elasticsearch.common.Strings;
 import org.graylog.plugins.pipelineprocessor.processors.ConfigurationStateUpdater;
 import org.graylog.plugins.pipelineprocessor.processors.PipelineInterpreter;
 import org.graylog.plugins.pipelineprocessor.simulator.PipelineInterpreterTracer;
@@ -32,9 +35,6 @@
 import org.graylog2.shared.security.RestPermissions;
 import org.graylog2.streams.StreamService;
 
-import java.util.ArrayList;
-import java.util.List;
-
 import javax.inject.Inject;
 import javax.validation.constraints.NotNull;
 import javax.ws.rs.Consumes;
@@ -42,10 +42,8 @@
 import javax.ws.rs.Path;
 import javax.ws.rs.Produces;
 import javax.ws.rs.core.MediaType;
-
-import io.swagger.annotations.Api;
-import io.swagger.annotations.ApiOperation;
-import io.swagger.annotations.ApiParam;
+import java.util.ArrayList;
+import java.util.List;
 
 @Api(value = ""Pipelines/Simulator"", description = ""Simulate pipeline message processor"")
 @Path(""/system/pipelines/simulate"")",0
Fix start of Che assembly on non-k8s infras," import org.eclipse.che.api.workspace.server.spi.provision.env.WorkspaceMavenServerJavaOptsEnvVariableProvider;
 import org.eclipse.che.api.workspace.server.stack.StackLoader;
 import org.eclipse.che.api.workspace.server.token.MachineTokenProvider;
+import org.eclipse.che.api.workspace.server.wsnext.WorkspaceNextApplier;
 import org.eclipse.che.commons.auth.token.ChainedTokenExtractor;
 import org.eclipse.che.commons.auth.token.RequestTokenExtractor;
 import org.eclipse.che.core.db.DBTermination;
@@ -257,6 +258,8 @@
     }
 
     bind(org.eclipse.che.api.user.server.AppStatesPreferenceCleaner.class);
+
+    MapBinder.newMapBinder(binder(), String.class, WorkspaceNextApplier.class);
   }
 
   private void configureSingleUserMode(Map<String, String> persistenceProperties) {",0
[HOTFIX] :fire: REST API registration failure under Java6,"       try {
         ModelMojoWriter mmw = (ModelMojoWriter) retClass.newInstance();
         return mmw.mojoVersion();
-      } catch (InstantiationException | IllegalAccessException e) {
-        throw new RuntimeException(""MojoWriter class "" + retClass + "" must define a no-arg constructor.\n"" + e);
+      } catch (InstantiationException e) {
+        throw getMissingCtorException(retClass, e);
+      } catch (IllegalAccessException e) {
+        throw getMissingCtorException(retClass, e);
       }
     } catch (NoSuchMethodException e) {
       throw new RuntimeException(""Model class "" + modelClass + "" is expected to have method getMojo();"");
     }
   }
+
+  private RuntimeException getMissingCtorException(Class<?> retClass, Exception e) {
+    return new RuntimeException(""MojoWriter class "" + retClass + "" must define a no-arg constructor.\n"" + e);
+  }
 }
 
 ",0
Fix ObjectMapper's treatment of static fields," import java.lang.reflect.Field;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
+import java.lang.reflect.Modifier;
 import java.lang.reflect.ParameterizedType;
 import java.lang.reflect.Type;
 import java.util.ArrayList;
@@ -104,6 +105,9 @@
     Field[] fields = type.getFields();
     for (int i = 0; i < fields.length; ++i) {
       Field field = fields[i];
+      if (Modifier.isStatic(field.getModifiers())) {
+        continue;
+      }
       Object value = jsonObject.opt(field.getName());
       Object setValue = getValueForField(field, value);
       try {
@@ -240,21 +244,25 @@
     JSONObject jsonObject = new JSONObject();
     Field[] fields = fromValue.getClass().getFields();
     for (int i = 0; i < fields.length; ++i) {
-      JsonProperty property = fields[i].getAnnotation(JsonProperty.class);
+      Field field = fields[i];
+      if (Modifier.isStatic(field.getModifiers())) {
+        continue;
+      }
+      JsonProperty property = field.getAnnotation(JsonProperty.class);
       if (property != null) {
         // AutoBox here ...
-        Object value = fields[i].get(fromValue);
-        Class clazz = fields[i].getType();
+        Object value = field.get(fromValue);
+        Class clazz = field.getType();
         if (value != null) {
           clazz = value.getClass();
         }
-        String name = fields[i].getName();
+        String name = field.getName();
         if (property.required() && value == null) {
           value = JSONObject.NULL;
         } else if (value == JSONObject.NULL) {
           // Leave it as null in this case.
         } else {
-          value = getJsonValue(value, clazz, fields[i]);
+          value = getJsonValue(value, clazz, field);
         }
         jsonObject.put(name, value);
       }",0
Fix: custom drawable not change,"     /**
      * Does all the initial setup of the button such as retrieving all the attributes that were
      * set in xml and inflating the like button's view and initial state.
+     *
      * @param context
      * @param attrs
      * @param defStyle
@@ -122,14 +123,9 @@
 
         if (likeDrawable == null && unLikeDrawable == null) {
             if (currentIcon != null) {
-
-                setLikeDrawableRes(currentIcon.getOnIconResourceId());
-                setUnlikeDrawableRes(currentIcon.getOffIconResourceId());
+                setIcon();
             } else {
-                currentIcon = parseIconType(IconType.Heart);
-                setLikeDrawableRes(currentIcon.getOnIconResourceId());
-                setUnlikeDrawableRes(currentIcon.getOffIconResourceId());
-
+                setIcon(IconType.Heart);
             }
         }
 
@@ -141,8 +137,7 @@
         array.recycle();
     }
 
-    private Drawable getDrawableFromResource(TypedArray array, int styleableIndexId)
-    {
+    private Drawable getDrawableFromResource(TypedArray array, int styleableIndexId) {
         int id = array.getResourceId(styleableIndexId, -1);
 
         return (-1 != id) ? ContextCompat.getDrawable(getContext(), id) : null;
@@ -151,6 +146,7 @@
     /**
      * This triggers the entire functionality of the button such as icon changes,
      * animations, listeners etc.
+     *
      * @param v
      */
     @Override
@@ -235,6 +231,7 @@
     /**
      * Used to trigger the scale animation that takes places on the
      * icon when the button is touched.
+     *
      * @param event
      * @return
      */
@@ -275,9 +272,9 @@
         return true;
     }
 
-
     /**
      * This drawable is shown when the button is a liked state.
+     *
      * @param resId
      */
     public void setLikeDrawableRes(@DrawableRes int resId) {
@@ -286,24 +283,32 @@
         if (iconSize != 0) {
             likeDrawable = Utils.resizeDrawable(getContext(), likeDrawable, iconSize, iconSize);
         }
+
+        if (isChecked) {
+            icon.setImageDrawable(likeDrawable);
+        }
     }
 
     /**
      * This drawable is shown when the button is in a liked state.
+     *
      * @param likeDrawable
      */
     public void setLikeDrawable(Drawable likeDrawable) {
-
         this.likeDrawable = likeDrawable;
 
         if (iconSize != 0) {
             this.likeDrawable = Utils.resizeDrawable(getContext(), likeDrawable, iconSize, iconSize);
         }
 
+        if (isChecked) {
+            icon.setImageDrawable(this.likeDrawable);
+        }
     }
 
     /**
      * This drawable will be shown when the button is in on unLiked state.
+     *
      * @param resId
      */
     public void setUnlikeDrawableRes(@DrawableRes int resId) {
@@ -312,48 +317,62 @@
         if (iconSize != 0) {
             unLikeDrawable = Utils.resizeDrawable(getContext(), unLikeDrawable, iconSize, iconSize);
         }
+
+        if (!isChecked) {
         icon.setImageDrawable(unLikeDrawable);
     }
+    }
 
     /**
      * This drawable will be shown when the button is in on unLiked state.
+     *
      * @param unLikeDrawable
      */
     public void setUnlikeDrawable(Drawable unLikeDrawable) {
-
         this.unLikeDrawable = unLikeDrawable;
 
         if (iconSize != 0) {
             this.unLikeDrawable = Utils.resizeDrawable(getContext(), unLikeDrawable, iconSize, iconSize);
         }
-        icon.setImageDrawable(unLikeDrawable);
 
-
+        if (!isChecked) {
+            icon.setImageDrawable(this.unLikeDrawable);
+        }
     }
 
     /**
      * Sets one of the three icons that are bundled with the library.
+     *
      * @param currentIconType
      */
     public void setIcon(IconType currentIconType) {
         currentIcon = parseIconType(currentIconType);
         setLikeDrawableRes(currentIcon.getOnIconResourceId());
         setUnlikeDrawableRes(currentIcon.getOffIconResourceId());
+        icon.setImageDrawable(this.unLikeDrawable);
+    }
+
+    public void setIcon() {
+        setLikeDrawableRes(currentIcon.getOnIconResourceId());
+        setUnlikeDrawableRes(currentIcon.getOffIconResourceId());
+        icon.setImageDrawable(this.unLikeDrawable);
     }
 
     /**
      * Sets the size of the drawable/icon that's being used. The views that generate
      * the like effect are also updated to reflect the size of the icon.
+     *
      * @param iconSize
      */
 
-    public void setIconSizeDp(int iconSize)
-    {
+    public void setIconSizeDp(int iconSize) {
         setIconSizePx((int)Utils.dipToPixels(getContext(),(float)iconSize));
     }
+
     /**
      * Sets the size of the drawable/icon that's being used. The views that generate
      * the like effect are also updated to reflect the size of the icon.
+     *
      * @param iconSize
      */
     public void setIconSizePx(int iconSize) {
@@ -369,6 +388,7 @@
      * These icons are bundled with the library and
      * are accessed via objects that contain their
      * resource ids and an enum with their name.
+     *
      * @param iconType
      * @return Icon
      */
@@ -389,6 +409,7 @@
      * These icons are bundled with the library and
      * are accessed via objects that contain their
      * resource ids and an enum with their name.
+     *
      * @param iconType
      * @return
      */
@@ -407,6 +428,7 @@
     /**
      * Listener that is triggered once the
      * button is in a liked or unLiked state
+     *
      * @param likeListener
      */
     public void setOnLikeListener(OnLikeListener likeListener) {
@@ -417,6 +439,7 @@
     /**
      * This set sets the colours that are used for the little dots
      * that will be exploding once the like button is clicked.
+     *
      * @param primaryColor
      * @param secondaryColor
      */
@@ -449,22 +472,28 @@
     /**
      * Sets the initial state of the button to liked
      * or unliked.
+     *
      * @param status
      */
-    public void setLiked(Boolean status)
-    {
-        if(status)
-        {
+    public void setLiked(Boolean status) {
+        if (status) {
             isChecked=true;
             icon.setImageDrawable(likeDrawable);
-        }
-        else
-        {
+        } else {
             isChecked=false;
             icon.setImageDrawable(unLikeDrawable);
         }
     }
 
+    /**
+     * Returns current like state
+     * @return current like state
+     */
+    public boolean isLiked()
+    {
+        return isChecked;
+    }
+
     @Override
     public void setEnabled(boolean enabled) {
         isEnabled = enabled;",0
Fix array out of bounds exception on '$.' path expression,"                         break;
                     case PERIOD:
                         i++;
-                        if (path.charAt(i) == PERIOD) {
+                        if ( i < path.length() && path.charAt(i) == PERIOD) {
                             //This is a deep scan
                             fragment = "".."";
                             i++;",0
LocalBuffer尺寸导致超过Size的BUg修复," public final class BufferPool {
 	// this value not changed ,isLocalCacheThread use it
 	public static final String LOCAL_BUF_THREAD_PREX = ""$_"";
-	private static final ThreadLocalBufferPool localBufferPool = new ThreadLocalBufferPool(
-			4000);
+	private final ThreadLocalBufferPool localBufferPool;
 	private static final Logger LOGGER = Logger.getLogger(BufferPool.class);
 	private final int chunkSize;
 	private final ConcurrentLinkedQueue<ByteBuffer> items = new ConcurrentLinkedQueue<ByteBuffer>();
@@ -56,6 +55,7 @@
 		for (int i = 0; i < capactiy; i++) {
 			items.offer(createDirectBuffer(chunkSize));
 		}
+		localBufferPool = new ThreadLocalBufferPool(threadLocalCount);
 	}
 
 	private static final boolean isLocalCacheThread() {",0
Fix: volume should not change on onAudioFocusChange event,"     private boolean isPaused;
     private boolean isBuffering;
     private float rate = 1f;
+    private float audioVolume = 1f;
 
     private int minBufferMs = DefaultLoadControl.DEFAULT_MIN_BUFFER_MS;
     private int maxBufferMs = DefaultLoadControl.DEFAULT_MAX_BUFFER_MS;
@@ -454,10 +455,10 @@
         if (player != null) {
             if (focusChange == AudioManager.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK) {
                 // Lower the volume
-                player.setVolume(0.8f);
+                player.setVolume(audioVolume * 0.8f);
             } else if (focusChange == AudioManager.AUDIOFOCUS_GAIN) {
                 // Raise it back to normal
-                player.setVolume(1);
+                player.setVolume(audioVolume * 1);
             }
         }
     }
@@ -875,15 +876,17 @@
     }
 
     public void setMutedModifier(boolean muted) {
+        audioVolume = muted ? 0.f : 1.f;
         if (player != null) {
-            player.setVolume(muted ? 0 : 1);
+            player.setVolume(audioVolume);
         }
     }
 
 
     public void setVolumeModifier(float volume) {
+        audioVolume = volume;
         if (player != null) {
-            player.setVolume(volume);
+            player.setVolume(audioVolume);
         }
     }
 ",0
Fixed an error caused by performing an unchecked cast,"     @Override
     public void addSiteMapEntries(SiteMapGeneratorConfiguration smgc, SiteMapBuilder siteMapBuilder) {
 
+        if (CategorySiteMapGeneratorConfiguration.class.isAssignableFrom(smgc.getClass())) {
         CategorySiteMapGeneratorConfiguration categorySMGC = (CategorySiteMapGeneratorConfiguration) smgc;
 
         // Recursively construct the category SiteMap URLs
         Long rootCategoryId = categorySMGC.getRootCategory().getId();
         Category rootCategory = categoryDao.readCategoryById(rootCategoryId);
         addCategorySiteMapEntries(rootCategory, 0, categorySMGC, siteMapBuilder);
-        
+        }
     }
 
     protected void addCategorySiteMapEntries(Category parentCategory, int currentDepth, CategorySiteMapGeneratorConfiguration categorySMGC, SiteMapBuilder siteMapBuilder) {",0
fix AppCompatActivity use theme in application crash," 
 import com.qihoo360.replugin.ext.lang3.ClassUtils;
 import com.qihoo360.replugin.ext.lang3.reflect.FieldUtils;
+
 import org.json.JSONArray;
 import org.json.JSONObject;
 
@@ -561,6 +562,10 @@
 
         // 插件 manifest 中设置的 ThemeId
         int manifestThemeId = intent.getIntExtra(PmLocalImpl.INTENT_KEY_THEME_ID, 0);
+        //如果插件上没有主题则使用Application节点的Theme
+        if (manifestThemeId == 0) {
+            manifestThemeId = activity.getApplicationInfo().theme;
+        }
 
         // 根据 manifest 中声明主题是否透明，获取默认主题
         int defaultThemeId = getDefaultThemeId();
@@ -611,7 +616,7 @@
     /**
      * 获取默认 ThemeID
      * 如果 Host 配置了使用 AppCompat，则此处通过反射调用 AppCompat 主题。
-     *
+     * <p>
      * 注：Host 必须配置 AppCompat 依赖，否则反射调用会失败，导致宿主编译不过。
      */
     private static int getDefaultThemeId() {",0
amend mGet bug," 					m_get += transactionTotalCount;
 					m_missed = m_missed + eventName.getTotalCount();
 					m_hited = 1 - (double) m_missed / m_get;
-				} else if (""mget"".equals(method)) {
+				} else if (""mGet"".equals(method)) {
 					m_mget += transactionTotalCount;
 				} else if (""add"".equals(method)) {
 					m_add += transactionTotalCount;",0
Label not setting font scale to 1 (fixes #4232)," 		BitmapFont font = cache.getFont();
 		float oldScaleX = font.getScaleX();
 		float oldScaleY = font.getScaleY();
-		if (fontScaleX != 1 || fontScaleY != 1) font.getData().setScale(fontScaleX, fontScaleY);
+		if (fontScaleX != oldScaleX || fontScaleY != oldScaleY) font.getData().setScale(fontScaleX, fontScaleY);
 
 		computePrefSize();
 
-		if (fontScaleX != 1 || fontScaleY != 1) font.getData().setScale(oldScaleX, oldScaleY);
+		if (fontScaleX != oldScaleX || fontScaleY != oldScaleY) font.getData().setScale(oldScaleX, oldScaleY);
 	}
 
 	private void computePrefSize () {
@@ -147,7 +147,7 @@
 		BitmapFont font = cache.getFont();
 		float oldScaleX = font.getScaleX();
 		float oldScaleY = font.getScaleY();
-		if (fontScaleX != 1 || fontScaleY != 1) font.getData().setScale(fontScaleX, fontScaleY);
+		if (fontScaleX != oldScaleX || fontScaleY != oldScaleY) font.getData().setScale(fontScaleX, fontScaleY);
 
 		boolean wrap = this.wrap && ellipsis == null;
 		if (wrap) {
@@ -201,7 +201,7 @@
 		layout.setText(font, text, 0, text.length, Color.WHITE, textWidth, lineAlign, wrap, ellipsis);
 		cache.setText(layout, x, y);
 
-		if (fontScaleX != 1 || fontScaleY != 1) font.getData().setScale(oldScaleX, oldScaleY);
+		if (fontScaleX != oldScaleX || fontScaleY != oldScaleY) font.getData().setScale(oldScaleX, oldScaleY);
 	}
 
 	public void draw (Batch batch, float parentAlpha) {",0
Fix for JsonParser.getValueAsLong(),"      * default value of <b>0</b> will be returned; no exceptions are thrown.
      */
     public long getValueAsLong() throws IOException, JsonParseException {
-        return getValueAsInt(0);
+        return getValueAsLong(0);
     }
     
     /**",0
Do not try to clear a non existent request,"      */
     @Override
     public void run() {
+        if (request != null) {
         request.clear();
     }
+    }
 
     /**
      * Can be safely called from either the main thread or a background thread to cleanup the resources used by this",0
Fix maximum structure alignment on Android i386,"         MAX_ALIGNMENT = Platform.isSPARC() || Platform.isWindows()
             || (Platform.isLinux() && (Platform.isARM() || Platform.isPPC() || Platform.isMIPS()))
             || Platform.isAIX()
-            || Platform.isAndroid()
+            || (Platform.isAndroid() && !Platform.isIntel())
             ? 8 : LONG_SIZE;
         MAX_PADDING = (Platform.isMac() && Platform.isPPC()) ? 8 : MAX_ALIGNMENT;
         System.setProperty(""jna.loaded"", ""true"");",0
CallTarget initialization must not throw NPE if PolyglotEngine is not initialized,"         synchronized (this) {
             if (!this.initialized) {
                 this.initialized = true;
-                Accessor.INSTRUMENTHANDLER.initializeCallTarget(this);
+                Accessor accessor = Accessor.INSTRUMENTHANDLER;
+                if (accessor != null) {
+                    accessor.initializeCallTarget(this);
+                }
             }
         }
     }",0
Fix F-Droid build," import android.view.MenuItem;
 import android.view.View;
 import android.widget.RelativeLayout;
+import android.widget.ImageView;
 import android.widget.TextView;
 
 import com.amaze.filemanager.R;",0
修复心跳启动立马切换主从 bug," 				if (detector == null || detector.isQuit()) {
 					try {
 						detector = new MySQLDetector(this);
+						detector.heartbeat();
 					} catch (Exception e) {
 						LOGGER.warn(source.getConfig().toString(), e);
 						setResult(ERROR_STATUS, detector, null);",0
Fix FileResolver for OSGi bundle resources,"   }
 
   /**
+   * It is possible to determine if a resource from a bundle is a directory based on whether or not the ClassLoader
+   * returns null for a path (which does not already contain a trailing '/') *and* that path with an added trailing '/'
+   *
+   * @param url      the url
+   * @return if the bundle resource represented by the bundle URL is a directory
+   */
+  private boolean isBundleUrlDirectory(URL url) {
+    return url.toExternalForm().endsWith(""/"") ||
+      getClassLoader().getResource(url.getPath().substring(1) + ""/"") != null;
+  }
+
+  /**
    * bundle:// urls are used by OSGi implementations to refer to a file contained in a bundle, or in a fragment. There
    * is not much we can do to get the file from it, except reading it from the url. This method copies the files by
    * reading it from the url.
@@ -283,7 +295,7 @@
     try {
       File file = new File(cacheDir, url.getHost() + File.separator + url.getFile());
       file.getParentFile().mkdirs();
-      if (url.toExternalForm().endsWith(""/"")  || isDir) {
+      if ((getClassLoader() != null && isBundleUrlDirectory(url))  || isDir) {
         // Directory
         file.mkdirs();
       } else {",0
Fixes bug with ASceneFrameCallback extending AFrameTask.," package org.rajawali3d.scene;
 
-import org.rajawali3d.renderer.AFrameTask;
-
 /**
  * Abstract class for receiving frame callbacks from {@link RajawaliScene}. The timing
  * of this interface assumes that the rendering time does not affect the timing of
@@ -16,7 +14,7 @@
  *
  * @author Jared Woolston (jwoolston@tenkiv.com)
  */
-public abstract class ASceneFrameCallback extends AFrameTask {
+public abstract class ASceneFrameCallback {
 
     /**
      * Pre frame handling callback. This will be called prior to any camera or animation updates in the scene.",0
1181 Fix null element in InputValueDefinition#getChildren,"     public List<Node> getChildren() {
         List<Node> result = new ArrayList<>();
         result.add(type);
+        if (defaultValue != null) {
         result.add(defaultValue);
+        }
         result.addAll(directives);
         return result;
     }",0
Fix ExpandableListItemAdapter with header views," import com.nineoldandroids.animation.ValueAnimator;
 
 import java.util.ArrayList;
+import java.util.HashSet;
 import java.util.List;
+import java.util.Set;
 
 /**
  * An {@link ArrayAdapter} which allows items to be expanded using an animation.
@@ -273,6 +275,20 @@
         return contentView;
     }
 
+    @Override
+    public void notifyDataSetChanged() {
+        super.notifyDataSetChanged();
+
+        Set<Long> removedIds = new HashSet<Long>(mExpandedIds);
+
+        for (int i = 0; i < getCount(); ++i) {
+            long id = getItemId(i);
+            removedIds.remove(id);
+        }
+
+        mExpandedIds.removeAll(removedIds);
+    }
+
     /**
      * Return the content parent at the specified position.
      *
@@ -325,10 +341,15 @@
         View result = null;
         for (int i = 0; i < mAbsListView.getChildCount() && result == null; i++) {
             View childView = mAbsListView.getChildAt(i);
-            if (mAbsListView.getPositionForView(childView) == position) {
+            if (childView.getTag() instanceof ViewHolder) {
+                ViewHolder holder = (ViewHolder) childView.getTag();
+                long id = (Long) holder.contentParent.getTag();
+                int childPosition = findPositionForId(id);
+                if (childPosition == position) {
                 result = childView;
             }
         }
+        }
         return result;
     }
 ",0
fix bug with parsing like/dislike count,"             // likes
             likesString = doc.select(""button.like-button-renderer-like-button"").first()
                     .select(""span.yt-uix-button-content"").first().text();
-            videoInfo.like_count = Integer.parseInt(likesString.replace("","", """"));
+            videoInfo.like_count = Integer.parseInt(likesString.replaceAll(""[^\\d]"", """"));
             // dislikes
             dislikesString = doc.select(""button.like-button-renderer-dislike-button"").first()
                             .select(""span.yt-uix-button-content"").first().text();
 
-            videoInfo.dislike_count = Integer.parseInt(dislikesString.replace("","", """"));
+            videoInfo.dislike_count = Integer.parseInt(dislikesString.replaceAll(""[^\\d]"", """"));
         } catch(NumberFormatException nfe) {
             Log.e(TAG, ""failed to parse likesString \""""+likesString+""\"" and dislikesString \""""+
             dislikesString+""\"" as integers"");",0
Remove useless `jacoco.fileSets` from documentation of `MergeMojo`," 	 * </code>
 	 * </pre>
 	 */
-	@Parameter(property = ""jacoco.fileSets"", required = true)
+	@Parameter(required = true)
 	private List<FileSet> fileSets;
 
 	@Override",0
Fixes issue #1552 Where the flowIntoBlock method was not setting the Block to the fluid and causing crashes,"         if (meta < 0) return;
         if (displaceIfPossible(world, pos))
         {
-            world.setBlockState(pos, world.getBlockState(pos).withProperty(LEVEL, meta), 3);
+            world.setBlockState(pos, this.getBlockState().getBaseState().withProperty(LEVEL, meta), 3);
         }
     }
 ",0
implement empty onNewIntent method to fix #275,"       videoDurationLimit = options.getInt(""durationLimit"");
     }
   }
+
+  public void onNewIntent(Intent intent) { }
 }",0
Fix NPE in CheckSideEffects,"           if (n.getFirstChild().isGetProp()) {
             Node rootNameNode =
                 NodeUtil.getRootOfQualifiedName(n.getFirstChild());
-            isDefinedInSrc =
+            isDefinedInSrc = rootNameNode != null && rootNameNode.isName() &&
                 t.getScope().getVar(rootNameNode.getString()) != null;
           } else {
             isDefinedInSrc = t.getScope().getVar(qname) != null;",0
Fix crash when texture loading throws RuntimeException without message," import org.lwjgl.input.Mouse;
 import org.lwjgl.opengl.Display;
 
+import com.google.common.base.Objects;
 import com.google.common.base.Strings;
 import com.google.common.base.Throwables;
 import com.google.common.collect.BiMap;
@@ -906,7 +907,7 @@
         if (badType == null)
         {
             badType = Sets.newHashSet();
-            brokenTextures.put(resourceLocation.getResourceDomain(), error, badType);
+            brokenTextures.put(resourceLocation.getResourceDomain(), Objects.firstNonNull(error, ""Unknown error""), badType);
         }
         badType.add(resourceLocation);
     }",0
 修复一个PatchControl类isSupport可能会多重匹配的bug。,"             Integer methodNumber = Config.methodMap.get(methodLongName);
             //just Forward methods with methodNumber
             if (methodNumber != null) {
-                methodsIdBuilder.append(methodNumber + "":"");
+                // 一前一后的冒号作为匹配锚点，只有一边有的话可能会有多重匹配的bug
+                methodsIdBuilder.append("":"" + methodNumber + "":"");
             }
         }
 
         if (Constants.isLogging) {
-            isSupportBuilder.append(""  android.util.Log.d(\""robust\"",\""arrivied in isSupport \""+methodName+\"" paramArrayOfObject  \"" +paramArrayOfObject+\"" isSupport result is \""+\"""" + methodsIdBuilder.toString() + ""\"".contains(methodNo));"");
+            isSupportBuilder.append(""  android.util.Log.d(\""robust\"",\""arrivied in isSupport \""+methodName+\"" paramArrayOfObject  \"" +paramArrayOfObject+\"" isSupport result is \""+\"""" + methodsIdBuilder.toString() + ""\"".contains(\"":\"" + methodNo + \"":\""));"");
         }
-        isSupportBuilder.append(""return \"""" + methodsIdBuilder.toString() + ""\"".contains(methodNo);"");
+        isSupportBuilder.append(""return \"""" + methodsIdBuilder.toString() + ""\"".contains(\"":\"" + methodNo + \"":\"");"");
         return isSupportBuilder.toString();
     }
 ",0
"Ignore deprecated ""default"" field in IndexSetConfig"," 
 import com.fasterxml.jackson.annotation.JsonAutoDetect;
 import com.fasterxml.jackson.annotation.JsonCreator;
+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;
 import com.fasterxml.jackson.annotation.JsonProperty;
 import com.google.auto.value.AutoValue;
 import com.google.common.collect.ComparisonChain;
@@ -38,6 +39,9 @@
 @AutoValue
 @WithBeanGetter
 @JsonAutoDetect
+// Ignore deprecated ""default"" message field. Only relevant for Graylog 2.2.0-beta.[12] users.
+// TODO: Remove in Graylog 3.0.0
+@JsonIgnoreProperties({""default""})
 public abstract class IndexSetConfig implements Comparable<IndexSetConfig> {
     public static final String FIELD_INDEX_PREFIX = ""index_prefix"";
     public static final String FIELD_CREATION_DATE = ""creation_date"";",0
Fix Copy&Paste Error in VariationalAutoencoder Builder,"          * @param decoderLayerSizes    Size of each deccoder layer in the variational autoencoder
          */
         public Builder decoderLayerSizes(int... decoderLayerSizes) {
-            if (encoderLayerSizes == null || encoderLayerSizes.length < 1) {
+            if (decoderLayerSizes == null || decoderLayerSizes.length < 1) {
                 throw new IllegalArgumentException(""Decoder layer sizes array must have length > 0"");
             }
             this.decoderLayerSizes = decoderLayerSizes;",0
Prevent chests from losing items.," import org.terasology.network.NetworkComponent;
 import org.terasology.physics.components.RigidBodyComponent;
 import org.terasology.registry.In;
+import org.terasology.rendering.logic.MeshComponent;
 import org.terasology.rendering.world.WorldRenderer;
 
 @RegisterSystem(RegisterMode.CLIENT)
@@ -155,11 +156,9 @@
             if (mountPointComponent != null) {
 
                 if (clientHeldItem.exists()) {
-                    clientHeldItem.destroy();
-                    clientHeldItem = EntityRef.NULL;
+                    clientHeldItem.removeComponent(MeshComponent.class);
                 }
 
-
                 // remove the location from the old item
                 if (oldItem != null && oldItem.exists()) {
                     oldItem.removeComponent(ItemIsHeldComponent.class);",0
Disabled automatic gzip decompression in HttpClient. Fixes #225," package com.github.eirslett.maven.plugins.frontend.lib;
 
-import com.github.eirslett.maven.plugins.frontend.lib.ProxyConfig.Proxy;
+import java.io.File;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.net.URI;
+import java.net.URISyntaxException;
+import java.nio.channels.Channels;
+import java.nio.channels.ReadableByteChannel;
+
 import org.apache.commons.io.FileUtils;
 import org.apache.commons.io.FilenameUtils;
 import org.apache.http.HttpHost;
@@ -16,13 +23,7 @@
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import java.io.File;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.net.URI;
-import java.net.URISyntaxException;
-import java.nio.channels.Channels;
-import java.nio.channels.ReadableByteChannel;
+import com.github.eirslett.maven.plugins.frontend.lib.ProxyConfig.Proxy;
 
 final class DownloadException extends Exception {
     public DownloadException(String message){
@@ -82,7 +83,7 @@
             return executeViaProxy(proxy, requestUrl);
         } else {
             LOGGER.info(""No proxy was configured, downloading directly"");
-            response = HttpClients.createDefault().execute(new HttpGet(requestUrl));
+            response = buildHttpClient(null).execute(new HttpGet(requestUrl));
         }
         return response;
     }
@@ -95,9 +96,9 @@
                     new AuthScope(proxy.host, proxy.port),
                     new UsernamePasswordCredentials(proxy.username, proxy.password)
             );
-            proxyClient = HttpClients.custom().setDefaultCredentialsProvider(credentialsProvider).build();
+            proxyClient = buildHttpClient(credentialsProvider);
         } else {
-            proxyClient = HttpClients.createDefault();
+            proxyClient = buildHttpClient(null);
         }
 
         final HttpHost proxyHttpHost = new HttpHost(proxy.host, proxy.port, proxy.protocol);
@@ -109,4 +110,12 @@
 
         return proxyClient.execute(request);
     }
+    
+    private CloseableHttpClient buildHttpClient(CredentialsProvider credentialsProvider) {
+    	return HttpClients.custom()
+    			.disableContentCompression()
+    			.setDefaultCredentialsProvider(credentialsProvider)
+    			.build();
+    }
+    
 }",0
Automatic connection fix,"   /**
    * Configuration for the database connection.
    */
-  private static CDatabaseConfiguration m_databaseConfiguration;
+  private CDatabaseConfiguration m_databaseConfiguration;
 
   /**
    * Current database connection properties.
    */
-  private static Properties m_properties;
+  private Properties m_properties;
 
   /**
    * Connection to the database.",0
Fix NPE in getDefaultWorldGenerator(),"     }
 
     public SimpleUri getDefaultWorldGenerator(Module module) {
-        return new SimpleUri(module.getMetadata().getExtension(ModuleManager.DEFAULT_WORLD_GENERATOR_EXT, String.class));
+        String ext = module.getMetadata().getExtension(ModuleManager.DEFAULT_WORLD_GENERATOR_EXT, String.class);
+        return ext != null ? new SimpleUri(ext) : null;
     }
 }",0
fix lightbox not unmount bug when back pressed for android,"     private Runnable onDismissListener;
     private ContentView content;
     private RelativeLayout lightBox;
+    private boolean cancelable;
 
     public LightBox(AppCompatActivity activity, Runnable onDismissListener, LightBoxParams params) {
         super(activity, R.style.LightBox);
         this.onDismissListener = onDismissListener;
+        this.cancelable =!params.overrideBackPress; 
         setOnDismissListener(this);
         requestWindowFeature(Window.FEATURE_NO_TITLE);
         createContent(activity, params);
-        setCancelable(!params.overrideBackPress);
+        setCancelable(cancelable);
         getWindow().setWindowAnimations(android.R.style.Animation);
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             getWindow().addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);
@@ -92,6 +94,12 @@
         animateHide();
     }
 
+    @Override public void onBackPressed() {
+        if (cancelable) {
+            hide();
+        }
+    }
+
     @Override
     public void onDismiss(DialogInterface dialogInterface) {
         onDismissListener.run();",0
[PDI-13132] - Fix for Netezza sequence usage,"    */
   @Override
   public String getSQLNextSequenceValue( String sequenceName ) {
-    return ""select nextval('"" + sequenceName + ""')"";
+    return ""select next value for "" + sequenceName;
   }
 
   /**",0
Fixed TabBar from not adopting screen background color," import android.support.v7.app.AppCompatActivity;
 import android.view.View;
 import android.widget.RelativeLayout;
-
 import com.aurelhubert.ahbottomnavigation.AHBottomNavigation;
 import com.facebook.react.bridge.Arguments;
 import com.facebook.react.bridge.Callback;
@@ -319,12 +318,24 @@
         bottomTabs.setCurrentItem(getScreenStackIndex(navigatorId));
     }
 
+    private boolean hasBackgroundColor(StyleParams params) {
+        return params.screenBackgroundColor != null &&
+                params.screenBackgroundColor.hasColor();
+    }
+
+    private void setStyleFromScreen(StyleParams params) {
+        bottomTabs.setStyleFromScreen(params);
+        if (hasBackgroundColor(params)) {
+            asView().setBackgroundColor(params.screenBackgroundColor.getColor());
+        }
+    }
+
     @Override
     public void push(ScreenParams params) {
         ScreenStack screenStack = getScreenStack(params.getNavigatorId());
         screenStack.push(params, createScreenLayoutParams(params));
+        setStyleFromScreen(params.styleParams);
         if (isCurrentStack(screenStack)) {
-            bottomTabs.setStyleFromScreen(params.styleParams);
             alignSnackbarContainerWithBottomTabs((LayoutParams) snackbarAndFabContainer.getLayoutParams(), params.styleParams);
             EventBus.instance.post(new ScreenChangedEvent(params));
         }
@@ -359,7 +370,7 @@
         ScreenStack screenStack = getScreenStack(params.getNavigatorId());
         screenStack.newStack(params, createScreenLayoutParams(params));
         if (isCurrentStack(screenStack)) {
-            bottomTabs.setStyleFromScreen(params.styleParams);
+            setStyleFromScreen(params.styleParams);
             alignSnackbarContainerWithBottomTabs((LayoutParams) snackbarAndFabContainer.getLayoutParams(), params.styleParams);
             EventBus.instance.post(new ScreenChangedEvent(params));
         }
@@ -433,7 +444,7 @@
 
     private void showStackAndUpdateStyle(ScreenStack newStack) {
         newStack.show();
-        bottomTabs.setStyleFromScreen(newStack.getCurrentScreenStyleParams());
+        setStyleFromScreen(newStack.getCurrentScreenStyleParams());
     }
 
     private void hideCurrentStack() {
@@ -486,7 +497,7 @@
     }
 
     private void setBottomTabsStyleFromCurrentScreen() {
-        bottomTabs.setStyleFromScreen(getCurrentScreenStack().getCurrentScreenStyleParams());
+        setStyleFromScreen(getCurrentScreenStack().getCurrentScreenStyleParams());
     }
 
     @Override",0
Proposed fix for Issue 56," import com.koushikdutta.async.http.libcore.RawHeaders;
 import com.koushikdutta.async.parser.AsyncParser;
 import com.koushikdutta.async.parser.ByteBufferListParser;
+import com.koushikdutta.async.parser.JSONArrayParser;
 import com.koushikdutta.async.parser.JSONObjectParser;
 import com.koushikdutta.async.parser.StringParser;
 import com.koushikdutta.async.stream.OutputStreamDataCallback;
 
+import org.json.JSONArray;
 import org.json.JSONObject;
 
 import java.io.BufferedOutputStream;
@@ -377,6 +379,9 @@
     public static abstract class JSONObjectCallback extends RequestCallbackBase<JSONObject> {
     }
 
+    public static abstract class JSONArrayCallback extends RequestCallbackBase<JSONArray> {
+    }
+
     public static abstract class FileCallback extends RequestCallbackBase<File> {
     }
 
@@ -442,6 +447,29 @@
         return execute(req, new JSONObjectParser(), callback);
     }
 
+    @Deprecated
+    public Future<JSONArray> get(String uri, final JSONArrayCallback callback) {
+        return executeJSONArray(new AsyncHttpGet(uri), callback);
+    }
+    @Deprecated
+    public Future<JSONArray> execute(AsyncHttpRequest req, final JSONArrayCallback callback) {
+        return executeJSONArray(req, callback);
+    }
+
+    public Future<JSONArray> getJSONArray(String uri) {
+        return getJSONArray(uri, null);
+    }
+    public Future<JSONArray> getJSONArray(String uri, final JSONArrayCallback callback) {
+        return executeJSONArray(new AsyncHttpGet(uri), callback);
+    }
+
+    public Future<JSONArray> executeJSONArray(AsyncHttpRequest req) {
+        return executeJSONArray(req, null);
+    }
+    public Future<JSONArray> executeJSONArray(AsyncHttpRequest req, final JSONArrayCallback callback) {
+        return execute(req, new JSONArrayParser(), callback);
+    }
+
     private <T> void invokeWithAffinity(final RequestCallback<T> callback, SimpleFuture<T> future, final AsyncHttpResponse response, final Exception e, final T result) {
         boolean complete;
         if (e != null)",0
[UNDERTOW-487] Bugfix: session would expire in a half time of actual session-timeout…," 
             final int maxInactiveInterval = getMaxInactiveInterval();
             if (maxInactiveInterval > 0) {
-                long newExpireTime = System.currentTimeMillis() + (maxInactiveInterval * 500L);
+                long newExpireTime = System.currentTimeMillis() + (maxInactiveInterval * 1000L);
                 if(timerCancelKey != null && (newExpireTime < expireTime)) {
                     // We have to re-schedule as the new maxInactiveInterval is lower than the old one
                     if (!timerCancelKey.remove()) {
@@ -374,7 +374,7 @@
                     //+500ms, to make sure that the time has actually expired
                     //we don't re-schedule every time, as it is expensive
                     //instead when it expires we check if the timeout has been bumped, and if so we re-schedule
-                    timerCancelKey = executor.executeAfter(cancelTask, (maxInactiveInterval * 500L) + 1, TimeUnit.MILLISECONDS);
+                    timerCancelKey = executor.executeAfter(cancelTask, (maxInactiveInterval * 1000L) + 500L, TimeUnit.MILLISECONDS);
                 }
             }
             if (evictionToken != null) {",0
Noop fix to WebvttDecoder,"         foundEvent = EVENT_END_OF_FILE;
       } else if (STYLE_START.equals(line)) {
         foundEvent = EVENT_STYLE_BLOCK;
-      } else if (COMMENT_START.startsWith(line)) {
+      } else if (line.startsWith(COMMENT_START)) {
         foundEvent = EVENT_COMMENT;
       } else {
         foundEvent = EVENT_CUE;",0
fix javadoc,"     /**
      * Returns {@code true} if this Redisson instance has been shut down.
      *
-     * @return code true} if this Redisson instance has been shut down overwise <code>false</code>
+     * @return {@code true} if this Redisson instance has been shut down overwise <code>false</code>
      */
     boolean isShutdown();
 ",0
Fix date in file list for root mode,"             if(main.theme1==1)a.theme(Theme.DARK);
             a.build().show();}else{Toast.makeText(main.getActivity(),main.getResources().getString(R.string.enablerootmde),Toast.LENGTH_LONG).show();}
     }
+
     public String[] parseName(String line){
-        boolean linked=false;String name="""",link="""",size=""-1"",date="""";
+        boolean linked = false;
+        String name = """", link = """", size = ""-1"", date = """";
         String[] array=line.split("" "");
         for(int i=0;i<array.length;i++){
-            if(array[i].contains(""->"")){linked=true;}
-        }int p=getColonPosition(array);
+            if (array[i].contains(""->"")) {
+                linked = true;
+            }
+        }
+        int p = getColonPosition(array);
         date=array[p-1] +"" | ""+array[p];
         size=array[p-2];
         if(!linked){
-            for(int i=p+1;i<array.length;i++){name=name+"" ""+array[i];}
-            name=name.trim();
+            for (int i = p + 1; i < array.length; i++) {
+                name = name + "" "" + array[i];
         }
-        else if(linked){
-            int q=getLinkPosition(array);
-            for(int i=p+1;i<q;i++){name=name+"" ""+array[i];}
             name=name.trim();
-            for(int i=q+1;i<array.length;i++){link=link+"" ""+array[i];}
+        } else {
+            int q = getLinkPosition(array);
+            for (int i = p + 1; i < q; i++) {
+                name = name + "" "" + array[i];
+            }
+            name = name.trim();
+            for (int i = q + 1; i < array.length; i++) {
+                link = link + "" "" + array[i];
+            }
         }
         String size1=size;
-        if(size.equals("""")){size=""-1"";size1="""";}
+        if (size.equals("""")) {
+            size = ""-1"";
+            size1 = """";
+        }
         ParsePosition pos = new ParsePosition(0);
-        SimpleDateFormat simpledateformat = new SimpleDateFormat(""yyyy-mm-dd | HH:mm"");
+        SimpleDateFormat simpledateformat = new SimpleDateFormat(""yyyy-MM-dd | HH:mm"");
         Date stringDate = simpledateformat.parse(date, pos);
         return new String[]{name,link,array[0],size,stringDate.getTime()+"""",size1};
     }",0
Fix a logical bug when setting async/sync mode.," 
     @Override
     public void setUseSynchronousMode(boolean value) {
-        // Test that a looper has been prepared prior to setting asynchronous mode.
-        if (value && null == Looper.myLooper()) {
-            value = false;
-            Log.i(LOG_TAG, ""Current thread has not called Looper.prepare(). Forcing synchronous mode."");
+        // A looper must be prepared before setting asynchronous mode.
+        if (!value && Looper.myLooper() == null) {
+            value = true;
+            Log.w(LOG_TAG, ""Current thread has not called Looper.prepare(). Forcing synchronous mode."");
         }
 
-        // If using asynchronous mode.
-        if (value && handler == null) {
+        // If using synchronous mode.
+        if (!value && handler == null) {
             // Create a handler on current thread to submit tasks
             handler = new ResponderHandler(this);
-        } else if (!value && handler != null) {
+        } else if (value && handler != null) {
             // TODO: Consider adding a flag to remove all queued messages.
             handler = null;
         }",0
Fix #4013; Callback Endpoint now returns a StatusCode 200 OK," import org.parosproxy.paros.extension.ExtensionHook;
 import org.parosproxy.paros.extension.OptionsChangedListener;
 import org.parosproxy.paros.model.OptionsParam;
+import org.parosproxy.paros.network.HttpHeader;
+import org.parosproxy.paros.network.HttpMalformedHeaderException;
 import org.parosproxy.paros.network.HttpMessage;
+import org.parosproxy.paros.network.HttpStatusCode;
 import org.parosproxy.paros.view.View;
 
 public class ExtensionCallback extends ExtensionAdaptor implements
@@ -194,6 +197,8 @@
                         + path + "" from ""
                         + msg.getRequestHeader().getSenderAddress());
 
+                msg.setResponseHeader(HttpHeader.HTTP11 + "" "" + HttpStatusCode.OK);
+
                 if (path.startsWith(""/"" + TEST_PREFIX)) {
                     String str = Constant.messages.getString(
                             ""callback.test.msg"", url, msg.getRequestHeader()
@@ -221,7 +226,7 @@
                 }
                 LOGGER.error(""No callback handler for URL : "" + url + "" from ""
                         + msg.getRequestHeader().getSenderAddress());
-            } catch (URIException e) {
+            } catch (URIException | HttpMalformedHeaderException e) {
                 LOGGER.error(e.getMessage(), e);
             }
             return true;",0
Cast correct object to WebSocketUpgradeHandler,"         logger.trace(""onClose {}"");
 
         try {
-            WebSocketUpgradeHandler h = WebSocketUpgradeHandler.class.cast(future);
+            WebSocketUpgradeHandler h = WebSocketUpgradeHandler.class.cast(future.getAsyncHandler());
             NettyWebSocket webSocket = NettyWebSocket.class.cast(h.onCompleted());
 
             logger.trace(""Connection was closed abnormally (that is, with no close frame being sent)."");",0
Use raw address for main proxy address option," 
     public ProxiesParamProxy getMainProxy() {
         ProxyParam mainProxyParam = Model.getSingleton().getOptionsParam().getProxyParam();
-        ProxiesParamProxy mainProxy = new ProxiesParamProxy(mainProxyParam.getProxyIp(), mainProxyParam.getProxyPort(), true);
+        ProxiesParamProxy mainProxy = new ProxiesParamProxy(mainProxyParam.getRawProxyIP(), mainProxyParam.getProxyPort(), true);
         mainProxy.setAlwaysDecodeGzip(mainProxyParam.isAlwaysDecodeGzip());
         mainProxy.setBehindNat(mainProxyParam.isBehindNat());
         mainProxy.setProxyIpAnyLocalAddress(mainProxyParam.isProxyIpAnyLocalAddress());",0
"Fixes issue #2508, excess scrolling in module list","     @Override
     public void onDraw(Canvas canvas) {
         updateItemListeners();
+        canvas.setPart(""item"");
 
         boolean enabled = isEnabled();
         Border margin = canvas.getCurrentStyle().getMargin();
 
-        canvas.setPart(""item"");
         int yOffset = 0;
         for (int i = 0; i < list.get().size(); ++i) {
             T item = list.get().get(i);",0
Fix broken Samsung screen off scans on 8.1+ ,"             filters = new ScanFilterUtils().createScanFiltersForBeaconParsers(
                           mBeaconManager.getBeaconParsers());
         } else {
-            LogManager.d(TAG, ""starting non-filtered scan in SCAN_MODE_LOW_LATENCY"");
+            LogManager.d(TAG, ""starting a scan in SCAN_MODE_LOW_LATENCY"");
             settings = (new ScanSettings.Builder().setScanMode(ScanSettings.SCAN_MODE_LOW_LATENCY)).build();
-            // We create wildcard scan filters that match any advertisement so that we can detect
+            // We create scan filters that match so that we can detect
             // beacons in foreground mode even if the screen is off.  This is a necessary workaround
             // for a change in Android 8.1 that blocks scan results when the screen is off unless
-            // there is a scan filter associatd with the scan.  Prior to 8.1, filters could just be
-            // left null.  The wildcard filter matches everything.
+            // there is a scan filter associated with the scan.  Prior to 8.1, filters could just be
+            // left null.
             // We only add these filters on 8.1+ devices, because adding scan filters has been reported
             // to cause scan failures on some Samsung devices with Android 5.x
             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O_MR1) {
+                if (Build.MANUFACTURER.equalsIgnoreCase(""samsung"")) {
+                    // On the Samsung Galaxy Note 8.1, scans are blocked with screen off when the
+                    // scan filter is empty (wildcard).  We do a more detailed filter on Samsung only
+                    // because it might block detections of AltBeacon packets with non-standard
+                    // manufacturer codes.  See #769 for details.
+                    LogManager.d(TAG, ""Using a non-empty scan filter since this is Samsung 8.1+"");
+                    filters = new ScanFilterUtils().createScanFiltersForBeaconParsers(
+                            mBeaconManager.getBeaconParsers());
+                }
+                else {
+                    LogManager.d(TAG, ""Using an empty scan filter since this is 8.1+ on Non-Samsung"");
+                    // The wildcard filter matches everything.
                 filters = new ScanFilterUtils().createWildcardScanFilters();
             }
         }
+            else {
+                LogManager.d(TAG, ""Using no scan filter since this is pre-8.1"");
+            }
+        }
 
         if (settings != null) {
             postStartLeScan(filters, settings);",0
Turn off fixed rate scheduling in OpenGL," 
 
   protected void initAnimator() {
-    animator = new FPSAnimator(window, 60, true);
+    animator = new FPSAnimator(window, 60);
     drawException = null;
     animator.setUncaughtExceptionHandler(new GLAnimatorControl.UncaughtExceptionHandler() {
       @Override",0
[FIXED JENKINS-17025] NPE when checking if the executor is interrupted,"                     LOGGER.fine(MessageFormat.format(""{0} : {1} failed"", Build.this.toString(), bs));
                     return false;
                 }
-                if (getExecutor().isInterrupted()) {
+                
+                Executor executor = getExecutor();
+                if (executor != null && executor.isInterrupted()) {
                     // someone asked build interruption, let stop the build before trying to run another build step
                     throw new InterruptedException();
                 }",0
Fixed issue where the query cache wasn't invalidated when OMS updated sku inventory," 
 package org.broadleafcommerce.core.inventory.service;
 
+import org.apache.commons.lang3.ClassUtils;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
+import org.broadleafcommerce.common.event.BroadleafSystemEvent;
+import org.broadleafcommerce.common.event.BroadleafSystemEvent.BroadleafEventScopeType;
+import org.broadleafcommerce.common.event.BroadleafSystemEvent.BroadleafEventWorkerType;
+import org.broadleafcommerce.common.event.BroadleafSystemEventDetail;
 import org.broadleafcommerce.common.extension.ExtensionResultHolder;
 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;
 import org.broadleafcommerce.common.util.TransactionUtils;
@@ -30,8 +35,13 @@
 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;
 import org.broadleafcommerce.core.order.domain.Order;
 import org.broadleafcommerce.core.order.domain.OrderItem;
+import org.hibernate.annotations.Cache;
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.context.ApplicationContext;
 import org.springframework.stereotype.Service;
 import org.springframework.transaction.annotation.Transactional;
+import org.springframework.transaction.support.TransactionSynchronizationAdapter;
+import org.springframework.transaction.support.TransactionSynchronizationManager;
 
 import java.util.Arrays;
 import java.util.Collection;
@@ -53,6 +63,9 @@
     @Resource(name = ""blInventoryServiceExtensionManager"")
     protected InventoryServiceExtensionManager extensionManager;
 
+    @Autowired
+    protected ApplicationContext applicationContext;
+
     @Override
     public boolean checkBasicAvailablility(Sku sku) {
         if(sku != null) {
@@ -200,6 +213,7 @@
                     int newInventory = inventoryAvailable - quantity;
                     sku.setQuantityAvailable(newInventory);
                     catalogService.saveSku(sku);
+                    invalidateSkuInventory(sku);
                 } else {
                     LOG.info(""Not decrementing inventory as the Sku has been marked as always available"");
                 }
@@ -241,6 +255,7 @@
                 int newInventory = currentInventoryAvailable + quantity;
                 sku.setQuantityAvailable(newInventory);
                 catalogService.saveSku(sku);
+                invalidateSkuInventory(sku);
             } else {
                 LOG.info(""Not incrementing inventory as the Sku has been marked as always available"");
             }
@@ -304,4 +319,61 @@
         return skuInventoryMap;
     }
 
+    /**
+     * Invalidates the cache for a given sku
+     * 
+     * @param sku The Sku to be invalidated from cache
+     */
+    protected void invalidateSkuInventory(Sku sku) {
+        final Class<?> clazz = sku.getClass();
+        final String id = sku.getId().toString();
+        if (TransactionSynchronizationManager.isSynchronizationActive()) {
+            TransactionSynchronizationManager.registerSynchronization(new TransactionSynchronizationAdapter() {
+
+                @Override
+                public void afterCommit() {
+                    invalidateEntity(clazz, id);
+                }
+            });
+        } else {
+            invalidateEntity(clazz, id);
+        }
+    }
+
+    /**
+     * Given the class and identifier of an entity, invalidates the cache for that entity 
+     * 
+     * @param clazz The class of the entity to invalidate the cache for
+     * @param id The id of the entity to invalidate the cache for
+     */
+    protected void invalidateEntity(Class<?> clazz, String id) {
+        if (LOG.isInfoEnabled()) {
+            LOG.info(""Invalidating entity of type "" + clazz.getName() + "" with id "" + id);
+        }
+        for (Class<?> superclazz : ClassUtils.hierarchy(clazz)) {
+            Cache cacheAnnotation = superclazz.getAnnotation(Cache.class);
+            if (cacheAnnotation != null) {
+                if (LOG.isInfoEnabled()) {
+                    LOG.info(""Cache invalidation event to be sent"");
+                    LOG.info(""superclazz : "" + superclazz.getName());
+                    LOG.info(""region : "" + cacheAnnotation.region());
+                    LOG.info(""id : "" + id);
+                }
+                Map<String, BroadleafSystemEventDetail> detailMap = new HashMap<>();
+                detailMap.put(""CACHE_REGION"", new BroadleafSystemEventDetail(""Cache Region"", cacheAnnotation.region()));
+                detailMap.put(""ENTITY_TYPE"", new BroadleafSystemEventDetail(""Entity Type"", superclazz.getName()));
+                detailMap.put(""IDENTIFIER"", new BroadleafSystemEventDetail(""Identifier"", id));
+                BroadleafSystemEvent event = new BroadleafSystemEvent(""CACHE"", detailMap, BroadleafEventScopeType.GLOBAL, BroadleafEventWorkerType.ANY, true);
+                applicationContext.publishEvent(event);
+            } else {
+                if (LOG.isInfoEnabled()) {
+                    LOG.info(""No region found so no cache invalidation event to be created"");
+                    LOG.info(""superclazz : "" + superclazz.getName());
+                    LOG.info(""region : N/A"");
+                    LOG.info(""id : "" + id);
+                }
+            }
+        }
+    }
+
 }",0
fix date bug," 	 * @return 偏移后的日期
 	 */
 	public static DateTime offsiteDay(Date date, int offsite) {
-		return offsiteDate(new DateTime(), Calendar.DAY_OF_YEAR, offsite);
+		return offsiteDate(date, Calendar.DAY_OF_YEAR, offsite);
 	}
 	
 	/**
@@ -344,7 +344,7 @@
 	 * @return 偏移后的日期
 	 */
 	public static DateTime offsiteWeek(Date date, int offsite) {
-		return offsiteDate(new DateTime(), Calendar.WEEK_OF_YEAR, offsite);
+		return offsiteDate(date, Calendar.WEEK_OF_YEAR, offsite);
 	}
 	
 	/**
@@ -354,7 +354,7 @@
 	 * @return 偏移后的日期
 	 */
 	public static DateTime offsiteMonth(Date date, int offsite) {
-		return offsiteDate(new DateTime(), Calendar.MONTH, offsite);
+		return offsiteDate(date, Calendar.MONTH, offsite);
 	}
 	
 	/**",0
Fix the ForgeChunkManager to use the writebehind FileIO thread for writing," import net.minecraft.world.WorldServer;
 import net.minecraft.world.chunk.Chunk;
 import net.minecraft.world.chunk.storage.AnvilChunkLoader;
+import net.minecraft.world.storage.ThreadedFileIOBase;
 import net.minecraftforge.common.config.ConfigCategory;
 import net.minecraftforge.common.config.Configuration;
 import net.minecraftforge.common.config.Property;
@@ -944,6 +945,9 @@
                 }
             }
         }
+
+        // Write the actual file on the IO thread rather than blocking the server thread
+        ThreadedFileIOBase.getThreadedIOInstance().queueIO(() -> {
         try
         {
             CompressedStreamTools.write(forcedChunkData, chunkLoaderData);
@@ -951,8 +955,9 @@
         catch (IOException e)
         {
             FMLLog.log.warn(""Unable to write forced chunk data to {} - chunkloading won't work"", chunkLoaderData.getAbsolutePath(), e);
-            return;
         }
+            return false;
+        });
     }
 
     static void loadEntity(Entity entity)",0
test fix / workaround for wildfly shutdown with MCC that hasn't called close.,"             engine.closeInbound();
         } catch (SSLException e) {
             UndertowLogger.REQUEST_IO_LOGGER.trace(""Exception closing read side of SSL channel"", e);
-            IoUtils.safeClose(delegate);
+            IoUtils.safeClose(connection, delegate);
         }
 
         state |= FLAG_READ_CLOSED | FLAG_ENGINE_INBOUND_SHUTDOWN | FLAG_READ_SHUTDOWN;",0
[core] Ant Task Formatter encoding issue with XMLRenderer," package net.sourceforge.pmd.ant;
 
 import java.io.BufferedWriter;
+import java.io.Console;
 import java.io.File;
-import java.io.FileWriter;
+import java.io.FileOutputStream;
 import java.io.IOException;
+import java.io.OutputStream;
 import java.io.OutputStreamWriter;
 import java.io.Writer;
+import java.lang.reflect.Field;
+import java.lang.reflect.InvocationTargetException;
+import java.lang.reflect.Method;
+import java.nio.charset.Charset;
+import java.nio.charset.StandardCharsets;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Properties;
 
+import org.apache.commons.io.IOUtils;
 import org.apache.tools.ant.BuildException;
 import org.apache.tools.ant.types.Parameter;
 
@@ -57,12 +65,43 @@
     }
 
     public void start(String baseDir) {
+
+        Properties properties = createProperties();
+
+        Charset charset;
+        {
+            String s = (String) properties.get(""encoding"");
+            if (null == s) {
+
+                if (toConsole) {
+                    s = getConsoleEncoding();
+                    if (null == s) {
+                        s = System.getProperty(""file.encoding"");
+                    }
+                }
+
+                if (null == s) {
+                    charset = StandardCharsets.UTF_8;
+                } else {
+                    charset = Charset.forName(s);
+                }
+
+                // Configures the encoding for the renderer.
+                final Parameter parameter = new Parameter();
+                parameter.setName(""encoding"");
+                parameter.setValue(charset.name());
+                parameters.add(parameter);
+            } else {
+                charset = Charset.forName(s);
+            }
+        }
+
         try {
             if (toConsole) {
-                writer = new BufferedWriter(new OutputStreamWriter(System.out));
+                writer = new BufferedWriter(new OutputStreamWriter(System.out, charset));
             }
             if (toFile != null) {
-                writer = getToFileWriter(baseDir);
+                writer = getToFileWriter(baseDir, toFile, charset);
             }
             renderer = createRenderer();
             renderer.setWriter(writer);
@@ -131,11 +170,67 @@
         return properties;
     }
 
-    private Writer getToFileWriter(String baseDir) throws IOException {
-        if (!toFile.isAbsolute()) {
-            return new BufferedWriter(
-                    new FileWriter(new File(baseDir + System.getProperty(""file.separator"") + toFile.getPath())));
+    private static Writer getToFileWriter(String baseDir, File toFile, Charset charset) throws IOException {
+        final File file;
+        if (toFile.isAbsolute()) {
+            file = toFile;
+        } else {
+            file = new File(baseDir + System.getProperty(""file.separator"") + toFile.getPath());
         }
-        return new BufferedWriter(new FileWriter(toFile));
+
+        OutputStream output = null;
+        Writer writer = null;
+        boolean isOnError = true;
+        try {
+            output = new FileOutputStream(file);
+            writer = new OutputStreamWriter(output, charset);
+            writer = new BufferedWriter(writer);
+            isOnError = false;
+        } finally {
+            if (isOnError) {
+                IOUtils.closeQuietly(output);
+                IOUtils.closeQuietly(writer);
+            }
+        }
+        return writer;
+    }
+
+    private static String getConsoleEncoding() {
+        Console console = System.console();
+        // in case of pipe or redirect, no interactive console.
+        if (console != null) {
+            try {
+                Field f = Console.class.getDeclaredField(""cs"");
+                f.setAccessible(true);
+                Object res = f.get(console);
+                if (res instanceof Charset) {
+                    return ((Charset) res).name();
+                }
+            } catch (NoSuchFieldException e) {
+                // fall-through
+            } catch (IllegalAccessException e) {
+                // fall-through
+            }
+            return getNativeConsoleEncoding();
+        }
+        return null;
+    }
+
+    private static String getNativeConsoleEncoding() {
+        try {
+            Method m = Console.class.getDeclaredMethod(""encoding"");
+            m.setAccessible(true);
+            Object res = m.invoke(null);
+            if (res instanceof String) {
+                return (String) res;
+            }
+        } catch (NoSuchMethodException e) {
+            // fall-through
+        } catch (InvocationTargetException e) {
+            // fall-through
+        } catch (IllegalAccessException e) {
+            // fall-through
+        }
+        return null;
     }
 }",0
Proposed fix for Issue #836 - height and width parameters ignored when barcode_format is DATA_MATRIX,"     }
 
     if (width < 0 || height < 0) {
-      throw new IllegalArgumentException(""Requested dimensions are too small: "" + width + 'x' + height);
+      throw new IllegalArgumentException(""Requested dimensions can't be negative: "" + width + 'x' + height);
     }
 
     // Try to get force shape & min / max size
@@ -89,12 +89,11 @@
     String codewords = ErrorCorrection.encodeECC200(encoded, symbolInfo);
 
     //3. step: Module placement in Matrix
-    DefaultPlacement placement =
-        new DefaultPlacement(codewords, symbolInfo.getSymbolDataWidth(), symbolInfo.getSymbolDataHeight());
+    DefaultPlacement placement = new DefaultPlacement(codewords, symbolInfo.getSymbolDataWidth(), symbolInfo.getSymbolDataHeight());
     placement.place();
 
     //4. step: low-level encoding
-    return encodeLowLevel(placement, symbolInfo);
+    return encodeLowLevel(placement, symbolInfo, width, height);
   }
 
   /**
@@ -104,7 +103,7 @@
    * @param symbolInfo The symbol info to encode.
    * @return The bit matrix generated.
    */
-  private static BitMatrix encodeLowLevel(DefaultPlacement placement, SymbolInfo symbolInfo) {
+  private static BitMatrix encodeLowLevel(DefaultPlacement placement, SymbolInfo symbolInfo, int width, int height) {
     int symbolWidth = symbolInfo.getSymbolDataWidth();
     int symbolHeight = symbolInfo.getSymbolDataHeight();
 
@@ -150,26 +149,45 @@
       }
     }
 
-    return convertByteMatrixToBitMatrix(matrix);
+    return convertByteMatrixToBitMatrix(matrix, width, height);
   }
 
   /**
    * Convert the ByteMatrix to BitMatrix.
    *
+   * @param reqHeight The requested height of the image (in pixels) with the Datamatrix code
+   * @param reqWidth The requested width of the image (in pixels) with the Datamatrix code
    * @param matrix The input matrix.
    * @return The output matrix.
    */
-  private static BitMatrix convertByteMatrixToBitMatrix(ByteMatrix matrix) {
-    int matrixWidgth = matrix.getWidth();
+  private static BitMatrix convertByteMatrixToBitMatrix(ByteMatrix matrix, int reqWidth, int reqHeight) {
+    int matrixWidth = matrix.getWidth();
     int matrixHeight = matrix.getHeight();
+    int outputWidth = Math.max(reqWidth, matrixWidth);
+    int outputHeight = Math.max(reqHeight, matrixHeight);
 
-    BitMatrix output = new BitMatrix(matrixWidgth, matrixHeight);
+    int multiple = Math.min(outputWidth / matrixWidth, outputHeight / matrixHeight);
+
+    int leftPadding = (outputWidth - (matrixWidth * multiple)) / 2 ;
+    int topPadding = (outputHeight - (matrixHeight * multiple)) / 2 ;
+
+    BitMatrix output;
+
+    // remove padding if requested width and height are too small
+    if (reqHeight < matrixHeight || reqWidth < matrixWidth) {
+      leftPadding = 0;
+      topPadding = 0;
+      output = new BitMatrix(matrixWidth, matrixHeight);
+    } else {
+      output = new BitMatrix(reqWidth, reqHeight);
+    }
+
     output.clear();
-    for (int i = 0; i < matrixWidgth; i++) {
-      for (int j = 0; j < matrixHeight; j++) {
-        // Zero is white in the bytematrix
-        if (matrix.get(i, j) == 1) {
-          output.set(i, j);
+    for (int inputY = 0, outputY = topPadding; inputY < matrixHeight; inputY++, outputY += multiple) {
+      // Write the contents of this row of the bytematrix
+      for (int inputX = 0, outputX = leftPadding; inputX < matrixWidth; inputX++, outputX += multiple) {
+        if (matrix.get(inputX, inputY) == 1) {
+          output.setRegion(outputX, outputY, multiple, multiple);
         }
       }
     }",0
"Revert ""service startup scan fix"""," import android.graphics.Color;
 import android.net.Uri;
 import android.os.Build;
-import android.os.Handler;
 import android.os.IBinder;
 import android.os.PowerManager;
 import android.support.v4.app.NotificationCompat;
@@ -91,15 +90,6 @@
       Log.d(TAG, ""onScanFailed  "" + ""errorCode: "" + errorCode);
     }
   };
-  private Runnable mFirstUriBeaconScanTimeout = new Runnable() {
-    @Override
-    public void run() {
-      // Stop low latency scanning
-      getLeScanner().stopScan(mScanCallback);
-      // Start low power scanning
-      startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_POWER);
-    }
-  };
   private static final String NOTIFICATION_GROUP_KEY = ""URI_BEACON_NOTIFICATIONS"";
   private static final int NEAREST_BEACON_NOTIFICATION_ID = 23;
   private static final int SECOND_NEAREST_BEACON_NOTIFICATION_ID = 24;
@@ -108,7 +98,6 @@
   private static final int NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR = Color.parseColor(""#ffffff"");
   private static final int NON_LOLLIPOP_NOTIFICATION_URL_COLOR = Color.parseColor(""#999999"");
   private static final int NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR = Color.parseColor(""#999999"");
-  private static final long DURATION_FIRST_URI_BEACON_SCAN = TimeUnit.SECONDS.toMillis(2);
   private ScreenBroadcastReceiver mScreenStateBroadcastReceiver;
   private RegionResolver mRegionResolver;
   private NotificationManagerCompat mNotificationManager;
@@ -116,7 +105,6 @@
   private List<String> mSortedDevices;
   private HashMap<String, String> mDeviceAddressToUrl;
   private MdnsUrlDiscoverer mMdnsUrlDiscoverer;
-  private Handler mHandler;
   private Comparator<String> mComparator = new Comparator<String>() {
     @Override
     public int compare(String address, String otherAddress) {
@@ -152,19 +140,16 @@
   }
 
   private void initialize() {
-    mHandler = new Handler();
     mNotificationManager = NotificationManagerCompat.from(this);
     mMdnsUrlDiscoverer = new MdnsUrlDiscoverer(this, UriBeaconDiscoveryService.this);
     initializeScreenStateBroadcastReceiver();
   }
-
   private void initializeLists() {
     mRegionResolver = new RegionResolver();
     mUrlToUrlMetadata = new HashMap<>();
     mSortedDevices = null;
     mDeviceAddressToUrl = new HashMap<>();
   }
-
   /**
    * Create the broadcast receiver that will listen
    * for screen on/off events
@@ -194,10 +179,7 @@
     // Start scanning only if the screen is on
     PowerManager powerManager = (PowerManager) getSystemService(Context.POWER_SERVICE);
     if (powerManager.isScreenOn()) {
-      // Start a brief low latency scan
-      startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_LATENCY);
-      mHandler.postDelayed(mFirstUriBeaconScanTimeout, DURATION_FIRST_URI_BEACON_SCAN);
-      // Start mdns discovery
+      startSearchingForUriBeacons();
       mMdnsUrlDiscoverer.startScanning();
     }
 
@@ -214,8 +196,7 @@
   @Override
   public void onDestroy() {
     Log.d(TAG, ""onDestroy:  service exiting"");
-    getLeScanner().stopScan(mScanCallback);
-    mHandler.removeCallbacks(mFirstUriBeaconScanTimeout);
+    stopSearchingForUriBeacons();
     mMdnsUrlDiscoverer.stopScanning();
     unregisterReceiver(mScreenStateBroadcastReceiver);
     mNotificationManager.cancelAll();
@@ -251,10 +232,10 @@
     }
   }
 
-  private void startUriBeaconScan(int scanMode) {
+  private void startSearchingForUriBeacons() {
     ScanSettings settings = new ScanSettings.Builder()
         .setCallbackType(ScanSettings.CALLBACK_TYPE_ALL_MATCHES)
-        .setScanMode(scanMode)
+        .setScanMode(ScanSettings.SCAN_MODE_LOW_POWER)
         .build();
 
     List<ScanFilter> filters = new ArrayList<>();
@@ -267,7 +248,12 @@
 
     filters.add(filter);
 
-    getLeScanner().startScan(filters, settings, mScanCallback);
+    boolean started = getLeScanner().startScan(filters, settings, mScanCallback);
+    Log.v(TAG, started ? ""... scan started"" : ""... scan NOT started"");
+  }
+
+  private void stopSearchingForUriBeacons() {
+    getLeScanner().stopScan(mScanCallback);
   }
 
   private void handleFoundDevice(ScanResult scanResult) {
@@ -493,15 +479,10 @@
       initializeLists();
       mNotificationManager.cancelAll();
       if (isScreenOn) {
-        // Start a brief low latency scan
-        startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_LATENCY);
-        mHandler.postDelayed(mFirstUriBeaconScanTimeout, DURATION_FIRST_URI_BEACON_SCAN);
-        // Start mdns discovery
+        startSearchingForUriBeacons();
         mMdnsUrlDiscoverer.startScanning();
       } else {
-        // Stop all scanning and service discovery
-        getLeScanner().stopScan(mScanCallback);
-        mHandler.removeCallbacks(mFirstUriBeaconScanTimeout);
+        stopSearchingForUriBeacons();
         mMdnsUrlDiscoverer.stopScanning();
       }
     }",0
Fix resource leak warning in MainAndStaticFileHandler,"                 HttpUtil.setContentLength(resp, 0);
             } else {
                 var buffer = alloc.buffer();
-                var outputStream = new ByteBufOutputStream(buffer);
+                try (var outputStream = new ByteBufOutputStream(buffer)) {
                 writeJSON(outputStream, response, httpStatus, nodeName);
+                }
                 resp = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, httpStatus, buffer);
                 resp.headers().set(HttpHeaderNames.CONTENT_TYPE, ""application/json"");
                 HttpUtil.setContentLength(resp, buffer.readableBytes());",0
Nullify damage events while in god mode (fixes #652)," import gnu.trove.iterator.TIntIterator;
 import gnu.trove.list.TFloatList;
 import gnu.trove.list.TIntList;
+import org.terasology.logic.characters.CharacterMovementComponent;
+import org.terasology.logic.characters.MovementMode;
 import org.terasology.utilities.Assets;
 import org.terasology.assets.ResourceUrn;
 import org.terasology.audio.StaticSound;
@@ -168,7 +170,12 @@
 
     private void doDamage(EntityRef entity, int damageAmount, Prefab damageType, EntityRef instigator, EntityRef directCause) {
         HealthComponent health = entity.getComponent(HealthComponent.class);
-        if (health != null) {
+        CharacterMovementComponent characterMovementComponent = entity.getComponent(CharacterMovementComponent.class);
+        boolean ghost = false;
+        if (characterMovementComponent != null) {
+            ghost = (characterMovementComponent.mode == MovementMode.GHOSTING);
+        }
+        if ((health != null) && !ghost) {
             int damagedAmount = health.currentHealth - Math.max(health.currentHealth - damageAmount, 0);
             health.currentHealth -= damagedAmount;
             health.nextRegenTick = time.getGameTimeInMs() + TeraMath.floorToInt(health.waitBeforeRegen * 1000);",0
[Android] Fix title glitch and alignment," 
     private TitleBarButtonController leftButtonController;
     private View component;
-    private Alignment mAlignment;
-    private CharSequence mTitle;
+    private Alignment titleAlignment;
+    private Alignment subtitleAlignment;
+    private Boolean isTitleChanged = false;
+    private Boolean isSubtitleChanged = false;
 
     public TitleBar(Context context) {
         super(context);
@@ -48,10 +50,13 @@
     public void setTitle(CharSequence title) {
         clearComponent();
         super.setTitle(title);
-        if (mTitle != title && mAlignment != null) {
-            this.setTitleAlignment(mAlignment);
+        isTitleChanged = true;
         }
-        mTitle = title;
+
+    @Override
+    public void setSubtitle(CharSequence title) {
+        super.setSubtitle(title);
+        isSubtitleChanged = true;
     }
 
     public String getTitle() {
@@ -84,10 +89,7 @@
     }
 
     public void setTitleAlignment(Alignment alignment) {
-        mAlignment = alignment;
-        TextView title = findTitleTextView();
-        if (title == null || title == mTitle) return;
-        alignTextView(alignment, title);
+        titleAlignment = alignment;
     }
 
     public void setSubtitleTypeface(Typeface typeface) {
@@ -101,26 +103,42 @@
     }
 
     public void setSubtitleAlignment(Alignment alignment) {
-        TextView subtitle = findSubtitleTextView();
-        if (subtitle == null) return;
-        alignTextView(alignment, subtitle);
+        subtitleAlignment = alignment;
     }
 
     private void alignTextView(Alignment alignment, TextView view) {
         Integer direction = view.getParent().getLayoutDirection();
         Boolean isRTL = direction == View.LAYOUT_DIRECTION_RTL;
-        int width = view.getResources().getDisplayMetrics().widthPixels;
-        view.post(() -> {
+
             if (alignment == Alignment.Center) {
-                view.measure(0, 0);
                 //noinspection IntegerDivisionInFloatingPointContext
-                view.setX((width - view.getWidth()) / 2);
+            view.setX((getWidth() - view.getWidth()) / 2);
             } else if (leftButtonController != null) {
                 view.setX(isRTL ? (getWidth() - view.getWidth()) - getContentInsetStartWithNavigation() : getContentInsetStartWithNavigation());
             } else {
                 view.setX(isRTL ? (getWidth() - view.getWidth()) - UiUtils.dpToPx(getContext(), DEFAULT_LEFT_MARGIN) : UiUtils.dpToPx(getContext(), DEFAULT_LEFT_MARGIN));
             }
-        });
+    }
+
+    @Override
+    protected void onLayout(boolean changed, int l, int t, int r, int b) {
+        super.onLayout(changed, l, t, r, b);
+
+        if(changed || isTitleChanged) {
+            TextView title = findTitleTextView();
+            if (title != null) {
+                this.alignTextView(titleAlignment, title);
+            }
+            isTitleChanged = false;
+        }
+
+        if(changed || isSubtitleChanged) {
+            TextView subtitle = findSubtitleTextView();
+            if (subtitle != null) {
+                this.alignTextView(subtitleAlignment, subtitle);
+            }
+            isSubtitleChanged = false;
+        }
     }
 
     @Nullable",0
Declare ExtensionDynSSL as supporting low mem,"     	return true;
     }
 	
+	@Override
+	public boolean supportsLowMemory() {
+		return true;
+	}
+
 	/**
 	 * Gets ZAPs current Root CA Certificate in X.509 format. 
 	 * Could return {@code null} if there is a problem getting the certificate.",0
typo fix in old json writer,"         //TO DO: Add precision support in toString
         //TO DO: Write to file one line at time
         String lineOne = ""{\n"";
-        String lineTwo = ""\""filefrom:\"" \""dl4j\"",\n"";
-        String lineThree = ""\""ordering:\"" \"""" + thisnD.ordering() + ""\"",\n"";
+        String lineTwo = ""\""filefrom\"": \""dl4j\"",\n"";
+        String lineThree = ""\""ordering\"": \"""" + thisnD.ordering() + ""\"",\n"";
         String lineFour = ""\""shape\"":\t"" + java.util.Arrays.toString(thisnD.shape()) + "",\n"";
         String lineFive = ""\""data\"":\n"";
         String fileData = thisnD.toString();",0
Vector fix for LossUtil,"     public static void applyMask(INDArray to, INDArray mask) {
         //Two possibilities exist: it's *per example* masking, or it's *per output* masking
         //These cases have different mask shapes. Per example: column vector. Per output: same shape as score array
-        if (mask.isColumnVector()) {
+        if (mask.isColumnVectorOrScalar()) {
             to.muliColumnVector(mask);
         } else if (Arrays.equals(to.shape(), mask.shape())) {
             to.muli(mask);",0
Fix androidannotations.log in apt folder," 	@Override
 	public void setProcessingEnv(ProcessingEnvironment processingEnv) {
 		super.setProcessingEnv(processingEnv);
+		if (file == null) {
 		resolveLogFile();
 	}
+	}
 
 	private void resolveLogFile() {
 		String logFile = optionsHelper.getLogFile();",0
Fix uncheck conversion warnings from ant plugin,"     this.forceRecompile = false;
     this.angularPass = false;
     this.replacePropertiesPrefix = ""closure.define."";
-    this.defineParams = new LinkedList();
-    this.entryPointParams = new LinkedList();
-    this.externFileLists = new LinkedList();
-    this.sourceFileLists = new LinkedList();
-    this.sourcePaths = new LinkedList();
-    this.warnings = new LinkedList();
+    this.defineParams = new LinkedList<>();
+    this.entryPointParams = new LinkedList<>();
+    this.externFileLists = new LinkedList<>();
+    this.sourceFileLists = new LinkedList<>();
+    this.sourcePaths = new LinkedList<>();
+    this.warnings = new LinkedList<>();
   }
 
   /**
@@ -513,7 +513,7 @@
    * replacements.
    */
   private void convertEntryPointParameters(CompilerOptions options) {
-    List<String> entryPoints = new LinkedList();
+    List<String> entryPoints = new LinkedList<>();
     for (Parameter p : entryPointParams) {
       String key = p.getName();
       entryPoints.add(key);
@@ -598,7 +598,7 @@
   }
 
   private List<SourceFile> findExternFiles() {
-    List<SourceFile> files = new LinkedList();
+    List<SourceFile> files = new LinkedList<>();
     if (!this.customExternsOnly) {
       files.addAll(getDefaultExterns());
     }
@@ -611,7 +611,7 @@
   }
 
   private List<SourceFile> findSourceFiles() {
-    List<SourceFile> files = new LinkedList();
+    List<SourceFile> files = new LinkedList<>();
 
     for (FileList list : this.sourceFileLists) {
       files.addAll(findJavaScriptFiles(list));
@@ -629,7 +629,7 @@
    * the compiler expects.
    */
   private List<SourceFile> findJavaScriptFiles(ResourceCollection rc) {
-    List<SourceFile> files = new LinkedList();
+    List<SourceFile> files = new LinkedList<>();
     Iterator<Resource> iter = rc.iterator();
     while (iter.hasNext()) {
       FileResource fr = (FileResource) iter.next();",0
fix javadoc comment for getSet() return,"      * 
      * @param <V> type of value
      * @param name - name of object
-     * @return Lock object
+     * @return Set object
      */
     <V> RSet<V> getSet(String name);
 ",0
"CompositeShader, add unimplemented method to fix warning"," 	}
 	
 	@Override
+	public void init () {
+	}
+
+	@Override
 	public int compareTo (Shader other) {
 		return 0;
 	}",0
MINOR: Remove unnecessary conditional in KafkaAdminClient to fix checkstyle,"             // this RPC. That is why 'tries' is not incremented.
             if ((throwable instanceof UnsupportedVersionException) &&
                      handleUnsupportedVersionException((UnsupportedVersionException) throwable)) {
-                if (log.isDebugEnabled()) {
                     log.debug(""{} attempting protocol downgrade and then retry."", this);
-                }
                 runnable.enqueue(this, now);
                 return;
             }",0
Fix cast,"             if(Integer.class.isAssignableFrom(src.getClass())){
                return (Integer) src;
             } else if (Long.class.isAssignableFrom(src.getClass())) {
-                return ((Integer) src).intValue();
+                return ((Long) src).intValue();
             } else if (Double.class.isAssignableFrom(src.getClass())) {
                 return ((Double) src).intValue();
             } else if (BigDecimal.class.isAssignableFrom(src.getClass())) {",0
fix samsung systemui only accept resourc type when updateNotification," import android.content.res.TypedArray;
 import android.graphics.Bitmap;
 import android.graphics.drawable.Drawable;
+import android.graphics.drawable.Icon;
 import android.net.Uri;
 import android.os.Build;
 import android.os.Bundle;
@@ -54,6 +55,7 @@
 import com.lody.virtual.helper.utils.BitmapUtils;
 import com.lody.virtual.helper.utils.ComponentUtils;
 import com.lody.virtual.helper.utils.DrawableUtils;
+import com.lody.virtual.helper.utils.Reflect;
 import com.lody.virtual.helper.utils.VLog;
 import com.lody.virtual.os.VUserHandle;
 import com.lody.virtual.os.VUserInfo;
@@ -692,6 +694,22 @@
                 VLog.e(getClass().getSimpleName(), ""Unknown flag : "" + args[4]);
             }
             VNotificationManager.get().dealNotification(id, notification, getAppPkg());
+
+            /**
+             * `BaseStatusBar#updateNotification` aosp will use use
+             * `new StatusBarIcon(...notification.getSmallIcon()...)`
+             *  while in samsung SystemUI.apk ,the corresponding code comes as
+             * `new StatusBarIcon(...pkgName,notification.icon...)`
+             * the icon comes from `getSmallIcon.getResource`
+             * which will throw an exception on :x process thus crash the application
+             */
+            if (notification != null && Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&
+                    (Build.BRAND.equalsIgnoreCase(""samsung"") || Build.MANUFACTURER.equalsIgnoreCase(""samsung""))) {
+                notification.icon = getHostContext().getApplicationInfo().icon;
+                Icon icon = Icon.createWithResource(getHostPkg(), notification.icon);
+                Reflect.on(notification).call(""setSmallIcon"", icon);
+            }
+
             VActivityManager.get().setServiceForeground(component, token, id, notification, removeNotification);
             return 0;
         }",0
"fix: If the value is null, the normal business is affected."," 
 import com.alibaba.dubbo.common.Constants;
 import com.alibaba.dubbo.common.extension.Activate;
-import com.alibaba.dubbo.rpc.Filter;
-import com.alibaba.dubbo.rpc.Invocation;
-import com.alibaba.dubbo.rpc.Invoker;
-import com.alibaba.dubbo.rpc.Result;
-import com.alibaba.dubbo.rpc.RpcContext;
-import com.alibaba.dubbo.rpc.RpcException;
+import com.alibaba.dubbo.rpc.*;
 import org.apache.commons.lang3.StringUtils;
 import org.dromara.hmily.annotation.Hmily;
 import org.dromara.hmily.common.bean.context.HmilyTransactionContext;
@@ -35,8 +30,11 @@
 import org.dromara.hmily.common.enums.HmilyRoleEnum;
 import org.dromara.hmily.common.exception.HmilyRuntimeException;
 import org.dromara.hmily.common.utils.GsonUtils;
+import org.dromara.hmily.common.utils.LogUtil;
 import org.dromara.hmily.core.concurrent.threadlocal.HmilyTransactionContextLocal;
 import org.dromara.hmily.core.service.executor.HmilyTransactionExecutor;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 import java.lang.reflect.Method;
 import java.util.Objects;
@@ -49,6 +47,8 @@
 @Activate(group = {Constants.SERVER_KEY, Constants.CONSUMER})
 public class DubboHmilyTransactionFilter implements Filter {
 
+    private static final Logger LOGGER = LoggerFactory.getLogger(DubboHmilyTransactionFilter.class);
+
     private HmilyTransactionExecutor hmilyTransactionExecutor;
 
     /**
@@ -68,14 +68,17 @@
         Class clazz = invoker.getInterface();
         Class[] args = invocation.getParameterTypes();
         final Object[] arguments = invocation.getArguments();
-        converterParamsClass(args, arguments);
         Method method = null;
         Hmily hmily = null;
         try {
+            converterParamsClass(args, arguments);
             method = clazz.getMethod(methodName, args);
             hmily = method.getAnnotation(Hmily.class);
         } catch (NoSuchMethodException e) {
             e.printStackTrace();
+        } catch (Exception ex) {
+            ex.printStackTrace();
+            LogUtil.error(LOGGER, ""hmily find method error {} "", ex::getMessage);
         }
         if (Objects.nonNull(hmily)) {
             try {
@@ -140,7 +143,9 @@
             return;
         }
         for (int i = 0; i < arguments.length; i++) {
+            if (arguments[i] != null) {
             args[i] = arguments[i].getClass();
         }
     }
 }
+}",0
PR Fixing #1550 - Object3D.setScreenCoordinates() anomaly?," 	}
 
 	/**
-	 * Maps screen coordinates to object coordinates
+	 * Positions the object in the plane of the screen/viewport (z = 0), with
+	 * x and y specified in GL screen coordinates (origin at bottom left);
+	 * Assumes:
+	 *  - the object is a direct child of the current scene (not in a container)
+	 *  - the current viewport is centered on the Z-axis, and has the given dimensions
+	 *  - the current camera is positioned at the given eyeZ
 	 *
-	 * @param x
-	 * @param y
-	 * @param viewportWidth
-	 * @param viewportHeight
-	 * @param eyeZ
+	 * @param x object x coordinate in pixels [0 = viewport left]
+	 * @param y object y coordinate in pixels [0 = viewport bottom]
+	 * @param viewportWidth width of current viewport in pixels
+	 * @param viewportHeight height of current viewport in pixels
+	 * @param eyeZ location of current camera on Z-axis
 	 */
 	public void setScreenCoordinates(double x, double y, int viewportWidth, int viewportHeight, double eyeZ) {
 		double[] r1 = new double[16];",0
Fixed wrong calculation of last segment number when using segment templa...,"         return DashSegmentIndex.INDEX_UNBOUNDED;
       } else {
         long durationMs = (duration * 1000) / timescale;
-        return startNumber + (int) (periodDurationMs / durationMs);
+        return startNumber + (int) (periodDurationMs / durationMs) - 1;
       }
     }
 ",0
Small fix for hard tanh,"      */
     public SDVariable hardTanh(String name,SDVariable iX) {
         SDVariable result = functionFactory.hardTanh(iX);
-        result.setVarName(name);
-        return result;
+        return updateVariableNameAndReference(result, name);
     }
 
     /**",0
Fix javadoc comment,"         }
 
         /**
-         * Define the default window in milliseconds in which the Not Before, Issued At and Expires At Claims will still be valid.
+         * Define the default window in seconds in which the Not Before, Issued At and Expires At Claims will still be valid.
          * Setting a specific leeway value on a given Claim will override this value for that Claim.
          *
          * @param leeway the window in seconds in which the Not Before, Issued At and Expires At Claims will still be valid.",0
[Android] Wait for the view to be attached when playing (fixes autoplay)," import android.os.Looper;
 import android.support.v4.view.ViewCompat;
 import android.widget.ImageView;
+import android.view.View.OnAttachStateChangeListener;
+import android.view.View;
 
 import com.airbnb.lottie.LottieAnimationView;
 import com.facebook.react.bridge.ReadableArray;
@@ -62,6 +64,21 @@
             if (ViewCompat.isAttachedToWindow(view)) {
               view.setProgress(0f);
               view.playAnimation();
+            } else {
+              view.addOnAttachStateChangeListener(new OnAttachStateChangeListener() {
+                   @Override
+                   public void onViewAttachedToWindow(View v) {
+                      LottieAnimationView view = (LottieAnimationView)v;
+                      view.setProgress(0f);
+                      view.playAnimation();
+                      view.removeOnAttachStateChangeListener(this);
+                   }
+
+                   @Override
+                   public void onViewDetachedFromWindow(View v) {
+                      view.removeOnAttachStateChangeListener(this);
+                   }
+               });
             }
           }
         });",0
fix: server worker thread reject message," import com.weibo.api.motan.codec.Codec;
 import com.weibo.api.motan.common.URLParamType;
 import com.weibo.api.motan.core.extension.ExtensionLoader;
+import com.weibo.api.motan.exception.MotanErrorMsgConstant;
 import com.weibo.api.motan.exception.MotanFrameworkException;
 import com.weibo.api.motan.exception.MotanServiceException;
 import com.weibo.api.motan.rpc.DefaultResponse;
@@ -70,14 +71,17 @@
                         }
                     });
                 } catch (RejectedExecutionException rejectException) {
-                    LoggerUtil.debug(""process thread pool is full, run in io thread, active={} poolSize={} corePoolSize={} maxPoolSize={} taskCount={}"",
-                            threadPoolExecutor.getActiveCount(), threadPoolExecutor.getPoolSize(),
-                            threadPoolExecutor.getCorePoolSize(), threadPoolExecutor.getMaximumPoolSize(),
-                            threadPoolExecutor.getTaskCount());
+                    if (((NettyMessage) msg).isRequest()) {
+                        rejectMessage(ctx, (NettyMessage) msg);
+                    } else {
+                        LoggerUtil.warn(""process thread pool is full, run in io thread, active={} poolSize={} corePoolSize={} maxPoolSize={} taskCount={} requestId={}"",
+                                threadPoolExecutor.getActiveCount(), threadPoolExecutor.getPoolSize(), threadPoolExecutor.getCorePoolSize(),
+                                threadPoolExecutor.getMaximumPoolSize(), threadPoolExecutor.getTaskCount(), ((NettyMessage) msg).getRequestId());
                     processMessage(ctx, (NettyMessage) msg);
                 }
+                }
             } else {
-                processMessage(ctx, ((NettyMessage) msg));
+                processMessage(ctx, (NettyMessage) msg);
             }
         } else {
             LoggerUtil.error(""NettyChannelHandler messageReceived type not support: class="" + msg.getClass());
@@ -85,6 +89,19 @@
         }
     }
 
+    private void rejectMessage(ChannelHandlerContext ctx, NettyMessage msg) {
+        if (msg.isRequest()) {
+            DefaultResponse response = new DefaultResponse();
+            response.setRequestId(msg.getRequestId());
+            response.setException(new MotanServiceException(""process thread pool is full, reject by server: "" + ctx.channel().localAddress(), MotanErrorMsgConstant.SERVICE_REJECT));
+            sendResponse(ctx, response);
+
+            LoggerUtil.error(""process thread pool is full, reject, active={} poolSize={} corePoolSize={} maxPoolSize={} taskCount={} requestId={}"",
+                    threadPoolExecutor.getActiveCount(), threadPoolExecutor.getPoolSize(), threadPoolExecutor.getCorePoolSize(),
+                    threadPoolExecutor.getMaximumPoolSize(), threadPoolExecutor.getTaskCount(), msg.getRequestId());
+        }
+    }
+
     private void processMessage(ChannelHandlerContext ctx, NettyMessage msg) {
         String remoteIp = getRemoteIp(ctx);
         Object result;",0
Fix NPE in NodeStatsContextFieldResolver," import org.elasticsearch.common.inject.Singleton;
 import org.elasticsearch.common.logging.Loggers;
 import org.elasticsearch.common.lucene.BytesRefs;
+import org.elasticsearch.common.transport.BoundTransportAddress;
 import org.elasticsearch.common.transport.TransportAddress;
 import org.elasticsearch.http.HttpServer;
 import org.elasticsearch.monitor.MonitorService;
@@ -72,6 +73,7 @@
     private final JvmService jvmService;
 
     @Inject
+    @SuppressWarnings(""unused"")
     public NodeStatsContextFieldResolver(ClusterService clusterService,
                                          MonitorService monitorService,
                                          @Nullable HttpServer httpServer,
@@ -84,7 +86,13 @@
             () -> httpServer == null ? null : httpServer.info().getAddress().publishAddress(),
             threadPool,
             extendedNodeInfo,
-            () -> postgresNetty.boundAddress().publishAddress()
+            () -> {
+                BoundTransportAddress boundTransportAddress = postgresNetty.boundAddress();
+                if (boundTransportAddress == null) {
+                    return null;
+                }
+                return boundTransportAddress.publishAddress();
+            }
         );
     }
 ",0
Fix for bug in lookupUsers,"      */
     @Override
     public ResponseList<User> lookupUsers(String[] screenNames) throws TwitterException {
-        return factory.createUserList(post(conf.getRestBaseURL() + ""users/lookup.json""
+        return factory.createUserList(get(conf.getRestBaseURL() + ""users/lookup.json""
                 , new HttpParameter[]{new HttpParameter(""screen_name"", z_T4JInternalStringUtil.join(screenNames))}));
     }
 ",0
Fix SDK_INT range expression,"     }
   },
 
-  SPELL_CHECKER_SESSION(SDK_INT >= JELLY_BEAN || SDK_INT <= LOLLIPOP_MR1) {
+  SPELL_CHECKER_SESSION(SDK_INT >= JELLY_BEAN && SDK_INT <= LOLLIPOP_MR1) {
     @Override void add(ExcludedRefs.Builder excluded) {
       // SpellCheckerSessionListenerImpl.mHandler is leaking destroyed Activity when the
       // SpellCheckerSession is closed before the service is connected.",0
fix #35,"     }).start();
   }
 
-  @Override public boolean animateChange(ViewHolder oldHolder, ViewHolder newHolder,
-      ItemHolderInfo preLayoutInfo, ItemHolderInfo postLayoutInfo) {
-    return false;
-  }
-
   @Override
   public boolean animateChange(ViewHolder oldHolder, ViewHolder newHolder, int fromX, int fromY,
       int toX, int toY) {",0
Fixes #827: support for multiple process versions added," import org.springframework.core.io.InputStreamResource;
 import org.springframework.core.io.Resource;
 import org.springframework.http.MediaType;
+import org.springframework.http.ResponseEntity;
 import org.springframework.web.bind.annotation.PathVariable;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.RequestMethod;
 import org.springframework.web.bind.annotation.ResponseBody;
 
 import java.io.InputStream;
+import java.util.List;
+
+import static org.springframework.http.HttpStatus.NOT_FOUND;
 
 /**
  * Renders a valid running BPMN process definition as a BPMN diagram.
@@ -53,9 +57,17 @@
      */
     @RequestMapping(value = ""/processes/{processDefinitionKey:.*}"", method = RequestMethod.GET, produces = MediaType.IMAGE_JPEG_VALUE)
     @ResponseBody
-    public Resource processDefinitionDiagram(@PathVariable String processDefinitionKey) {
-        ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()
-                .processDefinitionKey(processDefinitionKey).singleResult();
+    public ResponseEntity processDefinitionDiagram(@PathVariable String processDefinitionKey) {
+        List processDefinitions = repositoryService.createProcessDefinitionQuery()
+                .processDefinitionKey(processDefinitionKey)
+                .orderByProcessDefinitionVersion()
+                .desc()
+                .list();
+        if (processDefinitions.isEmpty()) {
+            return ResponseEntity.status(NOT_FOUND).body(null);
+        }
+
+        ProcessDefinition processDefinition = (ProcessDefinition) processDefinitions.get(0);
         ProcessDiagramGenerator processDiagramGenerator = new DefaultProcessDiagramGenerator();
         BpmnModel bpmnModel = repositoryService.getBpmnModel(processDefinition.getId());
 
@@ -65,7 +77,6 @@
         }
 
         InputStream is = processDiagramGenerator.generateJpgDiagram(bpmnModel);
-        return new InputStreamResource(is);
+        return ResponseEntity.ok(new InputStreamResource(is));
     }
-
 }",0
Fix withLatestFrom's tparam,"     @Experimental
     public final <T1, T2, T3, T4, T5, R> Observable<R> withLatestFrom(
             Observable<T1> o1, Observable<T2> o2, 
-            Observable<T1> o3, Observable<T2> o4, 
-            Observable<T1> o5, 
+            Observable<T3> o3, Observable<T4> o4,
+            Observable<T5> o5,
             Func6<? super T, ? super T1, ? super T2, ? super T3, ? super T4, ? super T5, R> combiner) {
         return create(new OperatorWithLatestFromMany<T, R>(this, 
                 new Observable<?>[] { o1, o2, o3, o4, o5 }, null, Functions.fromFunc(combiner)));
@@ -12085,8 +12085,8 @@
     @Experimental
     public final <T1, T2, T3, T4, T5, T6, R> Observable<R> withLatestFrom(
             Observable<T1> o1, Observable<T2> o2, 
-            Observable<T1> o3, Observable<T2> o4, 
-            Observable<T1> o5, Observable<T2> o6, 
+            Observable<T3> o3, Observable<T4> o4,
+            Observable<T5> o5, Observable<T6> o6,
             Func7<? super T, ? super T1, ? super T2, ? super T3, ? super T4, ? super T5, ? super T6, R> combiner) {
         return create(new OperatorWithLatestFromMany<T, R>(this, 
                 new Observable<?>[] { o1, o2, o3, o4, o5, o6 }, null, Functions.fromFunc(combiner)));
@@ -12132,9 +12132,9 @@
     @Experimental
     public final <T1, T2, T3, T4, T5, T6, T7, R> Observable<R> withLatestFrom(
             Observable<T1> o1, Observable<T2> o2, 
-            Observable<T1> o3, Observable<T2> o4, 
-            Observable<T1> o5, Observable<T2> o6, 
-            Observable<T1> o7,
+            Observable<T3> o3, Observable<T4> o4,
+            Observable<T5> o5, Observable<T6> o6,
+            Observable<T7> o7,
             Func8<? super T, ? super T1, ? super T2, ? super T3, ? super T4, ? super T5, ? super T6, ? super T7, R> combiner) {
         return create(new OperatorWithLatestFromMany<T, R>(this, 
                 new Observable<?>[] { o1, o2, o3, o4, o5, o6, o7 }, null, Functions.fromFunc(combiner)));
@@ -12182,9 +12182,9 @@
     @Experimental
     public final <T1, T2, T3, T4, T5, T6, T7, T8, R> Observable<R> withLatestFrom(
             Observable<T1> o1, Observable<T2> o2, 
-            Observable<T1> o3, Observable<T2> o4, 
-            Observable<T1> o5, Observable<T2> o6, 
-            Observable<T1> o7, Observable<T2> o8, 
+            Observable<T3> o3, Observable<T4> o4,
+            Observable<T5> o5, Observable<T6> o6,
+            Observable<T7> o7, Observable<T8> o8,
             Func9<? super T, ? super T1, ? super T2, ? super T3, ? super T4, ? super T5, ? super T6, ? super T7, ? super T8, R> combiner) {
         return create(new OperatorWithLatestFromMany<T, R>(this, 
                 new Observable<?>[] { o1, o2, o3, o4, o5, o6, o7, o8 }, null, Functions.fromFunc(combiner)));",0
Fix localAddress usage,"                 remoteAddress = new InetSocketAddress(request.getInetAddress(), AsyncHttpProviderUtils.getPort(uri));
             } else if (proxyServer == null || avoidProxy) {
                 remoteAddress = new InetSocketAddress(AsyncHttpProviderUtils.getHost(uri), AsyncHttpProviderUtils.getPort(uri));
-            } else if(request.getLocalAddress() != null) {
-                remoteAddress = new InetSocketAddress(request.getLocalAddress(), 0);
             } else {
                 remoteAddress = new InetSocketAddress(proxyServer.getHost(), proxyServer.getPort());
             }
 
+            if(request.getLocalAddress() != null){
+                channelFuture = bootstrap.connect(remoteAddress, new InetSocketAddress(request.getLocalAddress(), 0));
+            }else{
             channelFuture = bootstrap.connect(remoteAddress);
+            }
+
         } catch (Throwable t) {
             if (acquiredConnection) {
                 freeConnections.release();",0
[JENKINS-16276] and various fixes for related exceptions,"                     final int n = getNumber();
                     for (MatrixConfiguration c : activeConfigurations) {
                         for (Item i : q.getItems(c)) {
-                            if (i.getAction(ParentBuildAction.class).parent==getBuild()) {
+                            ParentBuildAction a = i.getAction(ParentBuildAction.class);
+                            if (a!=null && a.parent==getBuild()) {
                                 q.cancel(i);
                                 logger.println(Messages.MatrixBuild_Cancelled(ModelHyperlinkNote.encodeTo(c)));
                             }",0
Fixed typo in MviFragment.java,"       return (V) this;
     } catch (ClassCastException e) {
       String msg =
-          ""Couldn't cast the View to the corresponding View interface. Most likely you forgot to add \""Activity implements YourMvpViewInterface\"".\"""";
+          ""Couldn't cast the View to the corresponding View interface. Most likely you forgot to add \""Fragment implements YourMvpViewInterface\"".\"""";
       Log.e(this.toString(), msg);
       throw new RuntimeException(msg, e);
     }",0
Fix another class loading lock with scripts,"      * @see AddOnClassLoader#findClass(String)
      * @see ClassLoader#loadClass(String, boolean)
      */
-    private static class ParentClassLoader extends ClassLoader {
+    private class ParentClassLoader extends ClassLoader {
 
         public ParentClassLoader(ClassLoader classLoader) {
             super(classLoader);
@@ -336,6 +336,14 @@
         protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
             return super.loadClass(name, resolve);
         }
+
+        @Override
+        protected Object getClassLoadingLock(String className) {
+            if (classLoadingLockProvider != null) {
+                return classLoadingLockProvider.getLock(className);
+            }
+            return super.getClassLoadingLock(className);
+        }
     }
 
     @FunctionalInterface",0
Do not depend on the implementation detail of Unpooled.buffer(int) wh…,"             int b = (int) (Long.parseLong(BEGINNING_DIGIT.matcher(key2).replaceAll("""")) /
                            BEGINNING_SPACE.matcher(key2).replaceAll("""").length());
             long c = req.content().readLong();
-            ByteBuf input = Unpooled.buffer(16);
+            ByteBuf input = Unpooled.wrappedBuffer(new byte[16]).setIndex(0, 0);
             input.writeInt(a);
             input.writeInt(b);
             input.writeLong(c);",0
Fixes #2836," 			// updatable recordset does not work in hsqldb jdbc impelementation!
 			//psWrite = mConn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_UPDATABLE);
 			psDelete = conn.prepareStatement(""DELETE FROM HISTORY WHERE "" + HISTORYID + "" = ?"");
-			psDeleteTemp = conn.prepareStatement(""DELETE FROM HISTORY WHERE "" + HISTTYPE + "" = ?"");
+			psDeleteTemp = conn.prepareStatement(""DELETE FROM HISTORY WHERE "" + HISTTYPE + "" IN (?) LIMIT 1000"");
 			psContainsURI = conn.prepareStatement(""SELECT TOP 1 HISTORYID FROM HISTORY WHERE URI = ? AND  METHOD = ? AND REQBODY = ? AND SESSIONID = ? AND HISTTYPE = ?"");
 
 			
@@ -716,8 +716,13 @@
     public void deleteTemporary() throws DatabaseException {
         try {
             for (Integer type : HistoryReference.getTemporaryTypes()) {
+                while (true) {
                 psDeleteTemp.setInt(1, type);
-                psDeleteTemp.execute();
+                    int result = psDeleteTemp.executeUpdate();
+                    if (result == 0) {
+                        break;
+                    }
+                }
             }
 		} catch (SQLException e) {
 			throw new DatabaseException(e);",0
Fix a full stopper NullPointerExcpetion in remote client.," 
     public RemoteChunkProvider(BlockManager blockManager, LocalPlayer localPlayer) {
         this.blockManager = blockManager;
+        this.localPlayer = localPlayer;
         pipeline = new ChunkGenerationPipeline(new ChunkTaskRelevanceComparator());
         ChunkMonitor.fireChunkProviderInitialized(this);
     }",0
(fix) incorrect reachability assumption in ResourceLeakDetector,"             // Ensure that the object that was tracked is the same as the one that was passed to close(...).
             assert trackedHash == System.identityHashCode(trackedObject);
 
-            // We need to actually do the null check of the trackedObject after we close the leak because otherwise
-            // we may get false-positives reported by the ResourceLeakDetector. This can happen as the JIT / GC may
-            // be able to figure out that we do not need the trackedObject anymore and so already enqueue it for
-            // collection before we actually get a chance to close the enclosing ResourceLeak.
-            return close() && trackedObject != null;
+            try {
+                return close();
+            } finally {
+                // This method will do `synchronized(trackedObject)` and we should be sure this will not cause deadlock.
+                // It should not, because somewhere up the callstack should be a (successful) `trackedObject.release`,
+                // therefore it is unreasonable that anyone else, anywhere, is holding a lock on the trackedObject.
+                // (Unreasonable but possible, unfortunately.)
+                reachabilityFence0(trackedObject);
+            }
+        }
+
+         /**
+         * Ensures that the object referenced by the given reference remains
+         * <a href=""package-summary.html#reachability""><em>strongly reachable</em></a>,
+         * regardless of any prior actions of the program that might otherwise cause
+         * the object to become unreachable; thus, the referenced object is not
+         * reclaimable by garbage collection at least until after the invocation of
+         * this method.
+         *
+         * <p> Recent versions of the JDK have a nasty habit of prematurely deciding objects are unreachable.
+         * see: https://stackoverflow.com/questions/26642153/finalize-called-on-strongly-reachable-object-in-java-8
+         * The Java 9 method Reference.reachabilityFence offers a solution to this problem.
+         *
+         * <p> This method is always implemented as a synchronization on {@code ref}, not as
+         * {@code Reference.reachabilityFence} for consistency across platforms and to allow building on JDK 6-8.
+         * <b>It is the caller's responsibility to ensure that this synchronization will not cause deadlock.</b>
+         *
+         * @param ref the reference. If {@code null}, this method has no effect.
+         * @see java.lang.ref.Reference#reachabilityFence
+         */
+        private static void reachabilityFence0(Object ref) {
+            if (ref != null) {
+                // Empty synchronized is ok: https://stackoverflow.com/a/31933260/1151521
+                synchronized (ref) { }
+            }
         }
 
         @Override",0
Instance variables and setPosition() fix,"         sb.append(String.format(
             ""\n"" +
             indent + ""class %1$s:\n"" +
-            indent + ""    buffer_ = 0\n"" +
-            indent + ""    bufferLength_ = 0\n"" +
-            indent + ""    blockLength_ = 0\n"" +
-            indent + ""    count_ = 0\n"" +
-            indent + ""    index_ = 0\n"" +
-            indent + ""    offset_ = 0\n"" +
-            indent + ""    actingVersion_ = 0\n"" +
-            indent + ""    position_ = [0]\n"" +
-            indent + ""    dimensions_ = %2$s.%2$s()\n\n"",
+            indent + ""    def __init__(self):\n"" +
+            indent + ""        self.buffer_ = 0\n"" +
+            indent + ""        self.bufferLength_ = 0\n"" +
+            indent + ""        self.blockLength_ = 0\n"" +
+            indent + ""        self.count_ = 0\n"" +
+            indent + ""        self.index_ = 0\n"" +
+            indent + ""        self.offset_ = 0\n"" +
+            indent + ""        self.actingVersion_ = 0\n"" +
+            indent + ""        self.position_ = [0]\n"" +
+            indent + ""        self.dimensions_ = %2$s.%2$s()\n\n"",
             formatClassName(groupName),
             dimensionsClassName
         ));
@@ -851,9 +852,10 @@
     private CharSequence generateFixedFlyweightCode(final String className, final int size)
     {
         return String.format(
-            ""    buffer_ = 0\n"" +
-            ""    offset_ = 0\n"" +
-            ""    actingVersion_ = 0\n\n"" +
+            ""    def __init__(self):\n"" +
+            ""        self.buffer_ = 0\n"" +
+            ""        self.offset_ = 0\n"" +
+            ""        self.actingVersion_ = 0\n\n"" +
 
             ""    def wrap(self, buffer, offset, actingVersion, bufferLength):\n"" +
             ""        if (offset > (bufferLength - %2$s)):\n"" +
@@ -876,12 +878,13 @@
         final String semanticType = token.encoding().semanticType() == null ? """" : token.encoding().semanticType();
 
         return String.format(
-            ""    buffer_ = 0\n"" +
-            ""    bufferLength_ = 0\n"" +
-            ""    offset_ = 0\n"" +
-            ""    actingBlockLength_ = 0\n"" +
-            ""    actingVersion_ = 0\n"" +
-            ""    position_ = [0]\n\n"" +
+            ""    def __init__(self):\n"" +
+            ""        self.buffer_ = 0\n"" +
+            ""        self.bufferLength_ = 0\n"" +
+            ""        self.offset_ = 0\n"" +
+            ""        self.actingBlockLength_ = 0\n"" +
+            ""        self.actingVersion_ = 0\n"" +
+            ""        self.position_ = [0]\n\n"" +
 
             ""    @staticmethod\n"" +
             ""    def sbeBlockLength():\n"" +
@@ -928,7 +931,7 @@
             ""        return self.position_\n\n"" +
 
             ""    def setPosition(self, position):\n"" +
-            ""        if self.position_[0] > self.bufferLength_:\n"" +
+            ""        if position > self.bufferLength_:\n"" +
             ""            raise Exception('buffer too short')\n"" +
             ""        self.position_[0] = position\n\n"" +
 ",0
双向链表删除节点时，只修改了当前后驱节点，未修改当前节点的前驱节点，修改此BUG,"         if (node.tail != null && node.next != null){
             //它的上一节点指向它的下一节点 也就删除当前节点
             node.tail.next = node.next ;
+            node.next.tail = node.tail;
             nodeCount -- ;
         }
 ",0
Fix the photo grid invisible after activity restart.,"       photoDirectoryAll.setName(context.getString(R.string.__picker_all_image));
       photoDirectoryAll.setId(""ALL"");
 
+      data.moveToFirst();
+
       while (data.moveToNext()) {
 
         int imageId  = data.getInt(data.getColumnIndexOrThrow(_ID));",0
MINOR: Fix javadoc for consumer offsets lookup APIs which do not block indefinitely,"      * If the message format version in a partition is before 0.10.0, i.e. the messages do not have timestamps, null
      * will be returned for that partition.
      *
-     * Notice that this method may block indefinitely if the partition does not exist.
-     *
      * @param timestampsToSearch the mapping from partition to the timestamp to look up.
      * @return a mapping from partition to the timestamp and offset of the first message with timestamp greater
      *         than or equal to the target timestamp. {@code null} will be returned for the partition if there is no
      *         such message.
      * @throws org.apache.kafka.common.errors.AuthenticationException if authentication fails. See the exception for more details
      * @throws org.apache.kafka.common.errors.AuthorizationException if not authorized to the topic(s). See the exception for more details
-     * @throws IllegalArgumentException if the target timestamp is negative.
+     * @throws IllegalArgumentException if the target timestamp is negative
      * @throws org.apache.kafka.common.errors.TimeoutException if the offset metadata could not be fetched before
-     *         expiration of the configured request timeout
+     *         expiration of the configured {@code request.timeout.ms}
      * @throws org.apache.kafka.common.errors.UnsupportedVersionException if the broker does not support looking up
-     *         the offsets by timestamp.
+     *         the offsets by timestamp
      */
     @Override
     public Map<TopicPartition, OffsetAndTimestamp> offsetsForTimes(Map<TopicPartition, Long> timestampsToSearch) {
@@ -1627,7 +1625,6 @@
     /**
      * Get the first offset for the given partitions.
      * <p>
-     * Notice that this method may block indefinitely if the partition does not exist.
      * This method does not change the current consumer position of the partitions.
      *
      * @see #seekToBeginning(Collection)
@@ -1636,8 +1633,8 @@
      * @return The earliest available offsets for the given partitions
      * @throws org.apache.kafka.common.errors.AuthenticationException if authentication fails. See the exception for more details
      * @throws org.apache.kafka.common.errors.AuthorizationException if not authorized to the topic(s). See the exception for more details
-     * @throws org.apache.kafka.common.errors.TimeoutException if the offset metadata could not be fetched before
-     *         expiration of the configured request timeout
+     * @throws org.apache.kafka.common.errors.TimeoutException if the offsets could not be fetched before
+     *         expiration of the configured {@code request.timeout.ms}
      */
     @Override
     public Map<TopicPartition, Long> beginningOffsets(Collection<TopicPartition> partitions) {
@@ -1655,7 +1652,6 @@
      * to the the partition, the offset returned will be 0.
      *
      * <p>
-     * Notice that this method may block indefinitely if the partition does not exist.
      * This method does not change the current consumer position of the partitions.
      * <p>
      * When {@code isolation.level=read_committed} the last offset will be the Last Stable Offset (LSO).
@@ -1668,8 +1664,8 @@
      * @return The end offsets for the given partitions.
      * @throws org.apache.kafka.common.errors.AuthenticationException if authentication fails. See the exception for more details
      * @throws org.apache.kafka.common.errors.AuthorizationException if not authorized to the topic(s). See the exception for more details
-     * @throws org.apache.kafka.common.errors.TimeoutException if the offset metadata could not be fetched before
-     *         expiration of the configured request timeout
+     * @throws org.apache.kafka.common.errors.TimeoutException if the offsets could not be fetched before
+     *         expiration of the configured {@code request.timeout.ms}
      */
     @Override
     public Map<TopicPartition, Long> endOffsets(Collection<TopicPartition> partitions) {",0
Mark Recognizer.getTokenErrorDisplay as deprecated (fixes #480)," 	 *  the token). This is better than forcing you to override a method in
 	 *  your token objects because you don't have to go modify your lexer
 	 *  so that it creates a new Java type.
+	 *
+	 * @deprecated This method is not called by the ANTLR 4 Runtime. Specific
+	 * implementations of {@link ANTLRErrorStrategy} may provide a similar
+	 * feature when necessary. For example, see
+	 * {@link DefaultErrorStrategy#getTokenErrorDisplay}.
 	 */
+	@Deprecated
 	public String getTokenErrorDisplay(Token t) {
 		if ( t==null ) return ""<no token>"";
 		String s = t.getText();",0
[BACKPORT] Ensure skipping previously removed `CacheEntryListenerConfiguration` …," import java.lang.ref.WeakReference;
 import java.net.URI;
 import java.util.Collections;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.LinkedHashSet;
 import java.util.Map;
@@ -412,9 +413,14 @@
     protected <K, V> void registerListeners(CacheConfig<K, V> cacheConfig, ICache<K, V> source) {
         Iterator<CacheEntryListenerConfiguration<K, V>> iterator =
                 cacheConfig.getCacheEntryListenerConfigurations().iterator();
+        Set<CacheEntryListenerConfiguration> removedListenerConfigs = new HashSet<CacheEntryListenerConfiguration>();
         while (iterator.hasNext()) {
             CacheEntryListenerConfiguration<K, V> listenerConfig = iterator.next();
+            if (removedListenerConfigs.contains(listenerConfig)) {
+                continue;
+            }
             iterator.remove();
+            removedListenerConfigs.add(listenerConfig);
             source.registerCacheEntryListener(listenerConfig);
         }
     }",0
Fix can not use properties 'validateOnCheckout'," import org.quartz.utils.ConnectionProvider;
 import org.quartz.utils.DBConnectionManager;
 import org.quartz.utils.JNDIConnectionProvider;
+import org.quartz.utils.C3p0PoolingConnectionProvider;
 import org.quartz.utils.PoolingConnectionProvider;
 import org.quartz.utils.PropertiesParser;
 import org.slf4j.Logger;
@@ -63,7 +64,6 @@
 import java.lang.reflect.Constructor;
 import java.lang.reflect.Method;
 import java.security.AccessControlException;
-import java.sql.SQLException;
 import java.util.Collection;
 import java.util.Locale;
 import java.util.Properties;
@@ -1401,6 +1401,7 @@
         copyProps.remove(PoolingConnectionProvider.DB_PASSWORD);
         copyProps.remove(PoolingConnectionProvider.DB_MAX_CONNECTIONS);
         copyProps.remove(PoolingConnectionProvider.DB_VALIDATION_QUERY);
+        copyProps.remove(C3p0PoolingConnectionProvider.DB_VALIDATE_ON_CHECKOUT);
         props.remove(PoolingConnectionProvider.POOLING_PROVIDER);
         setBeanProps(cp.getDataSource(), copyProps);
     }",0
Fix a crash if the project is using HoloEverywhere 2.0+ which no longer ...," 				return true;
 			}
 			if (qName.startsWith(""org.holoeverywhere"")) {
-				/*
-				 * HoloEverywhere depends on ABS and uses its own provided
-				 * activity classes
-				 */
-				return true;
+				// Since 2.0.0, HoloEverywhere no longer depends on ABS so we
+				// had to find a way to to detect the version in classpath.
+				// Since org.holoeverywhere.addon.AddonSherlock has been removed
+				// during ABS to ABC migration, we're checking if this class is
+				// in the classpath. If so, we're using HEW < 2.0
+				// See issue #776
+				return annotationHelper.typeElementFromQualifiedName(""org.holoeverywhere.addon.AddonSherlock"") != null;
 			}
 		}
 		return false;",0
Use empty String in query/post variant parameters," // ZAP: 2014/01/06 Issue 965: Support 'single page' apps and 'non standard' parameter separators
 // ZAP: 2014/02/08 Used the same constants used in ScanParam Target settings
 // ZAP: 2016/05/04 Changes to address issues related to ParameterParser
+// ZAP: 2016/05/26 Use non-null String for names and values of parameters, scanners might not handle null names/values well
 
 package org.parosproxy.paros.core.scanner;
 
@@ -119,11 +120,18 @@
 
         int i = 0;
         for (org.zaproxy.zap.model.NameValuePair parameter : parameters) {
-            listParam.add(new NameValuePair(type, parameter.getName(), parameter.getValue(), i));
+            listParam.add(new NameValuePair(type, nonNullString(parameter.getName()), nonNullString(parameter.getValue()), i));
             i++;
         }
     }
 
+    private static String nonNullString(String string) {
+        if (string == null) {
+            return """";
+        }
+        return string;
+    }
+
     @Override
     public List<NameValuePair> getParamList() {
         return listParam;",0
Fix OAuthCodeImpl TGT deserialization," import org.apereo.cas.ticket.proxy.ProxyGrantingTicket;
 import org.springframework.util.Assert;
 
+import com.fasterxml.jackson.annotation.JsonProperty;
+
 import javax.persistence.Column;
 import javax.persistence.DiscriminatorColumn;
 import javax.persistence.DiscriminatorValue;
@@ -37,6 +39,7 @@
      * The {@link TicketGrantingTicket} this is associated with.
      */
     @ManyToOne(targetEntity = TicketGrantingTicketImpl.class)
+    @JsonProperty(""grantingTicket"")
     private TicketGrantingTicket ticketGrantingTicket;
     
     /** The service this ticket is valid for. */",0
Fix broken getSceneCenterCoordinates(final float pReuse)," 
 	@Override
 	public float[] getSceneCenterCoordinates(final float[] pReuse) {
-		return this.convertLocalCoordinatesToSceneCoordinates(0, 0, pReuse);
+		return this.convertLocalCoordinatesToSceneCoordinates(this.mWidth * 0.5f, this.mHeight * 0.5f, pReuse);
 	}
 
 	@Override",0
Fixes #1326 : Reduce the allocation rate for the typical use of Locat…," public class LocationImpl implements Location, Serializable {
 
     private static final long serialVersionUID = -9054861157390980624L;
+    //Limit the amount of objects being created, as this class is heavily instantiated:
+    private static final StackTraceFilter defaultStackTraceFilter = new StackTraceFilter();
+
     private final Throwable stackTraceHolder;
     private final StackTraceFilter stackTraceFilter;
 
     public LocationImpl() {
-        this(new StackTraceFilter());
+        this(defaultStackTraceFilter);
     }
 
     public LocationImpl(StackTraceFilter stackTraceFilter) {
@@ -23,7 +26,7 @@
     }
 
     public LocationImpl(Throwable stackTraceHolder) {
-        this(new StackTraceFilter(), stackTraceHolder);
+        this(defaultStackTraceFilter, stackTraceHolder);
     }
 
     private LocationImpl(StackTraceFilter stackTraceFilter, Throwable stackTraceHolder) {",0
Fixes gatewayServicesManagementCheck action state creation,"         createStateDefaultTransition(terminateSession, CasWebflowConstants.STATE_ID_GATEWAY_REQUEST_CHECK);
 
         final ActionState gatewayServicesManagementCheck = createActionState(flow,
-                CasWebflowConstants.STATE_ID_TERMINATE_SESSION, createEvaluateAction(""gatewayServicesManagementCheck""));
+                CasWebflowConstants.STATE_ID_GATEWAY_SERVICES_MGMT_CHECK, createEvaluateAction(""gatewayServicesManagementCheck""));
         createTransitionForState(gatewayServicesManagementCheck, CasWebflowConstants.STATE_ID_SUCCESS,
                 CasWebflowConstants.STATE_ID_REDIRECT);
         ",0
[TEST] fix test,"    * MappingInput and one MappingOutput step in the Mapping.
    */
   public boolean processRow( StepMetaInterface smi, StepDataInterface sdi ) throws KettleException {
+    SimpleMappingData simpleMappingData = getData();
     try {
       meta = (SimpleMappingMeta) smi;
       setData( (SimpleMappingData) sdi );
-      SimpleMappingData simpleMappingData = getData();
       if ( first ) {
         first = false;
         simpleMappingData.wasStarted = true;",0
Fix copying non-AA array of annotations," 	public void copyAnnotation(IJAnnotatable annotatable, AnnotationMirror annotationMirror) {
 		Map<? extends ExecutableElement, ? extends AnnotationValue> parameters = annotationMirror.getElementValues();
 
-		if (!hasAnnotation(annotatable, annotationMirror)) {
+		if (!hasAnnotation(annotatable, annotationMirror) || annotatable instanceof JAnnotationArrayMember) {
 			AbstractJClass annotation = typeMirrorToJClass(annotationMirror.getAnnotationType());
 			JAnnotationUse annotate = annotatable.annotate(annotation);
 ",0
Fix load commands," package org.eclipse.che.ide.extension.machine.client.command;
 
 import com.google.inject.Inject;
-import com.google.web.bindery.event.shared.EventBus;
 
 import org.eclipse.che.api.core.model.machine.Command;
 import org.eclipse.che.api.core.model.machine.Machine;
@@ -31,7 +30,6 @@
 import org.eclipse.che.ide.api.command.CommandTypeRegistry;
 import org.eclipse.che.ide.api.machine.MachineServiceClient;
 import org.eclipse.che.ide.api.macro.MacroProcessor;
-import org.eclipse.che.ide.api.workspace.WorkspaceReadyEvent;
 import org.eclipse.che.ide.api.workspace.WorkspaceServiceClient;
 import org.eclipse.che.ide.dto.DtoFactory;
 import org.eclipse.che.ide.extension.machine.client.outputspanel.console.CommandConsoleFactory;
@@ -75,7 +73,6 @@
                               WorkspaceServiceClient workspaceServiceClient,
                               MachineServiceClient machineServiceClient,
                               DtoFactory dtoFactory,
-                              EventBus eventBus,
                               MacroProcessor macroProcessor,
                               CommandConsoleFactory commandConsoleFactory,
                               ProcessesPanelPresenter processesPanelPresenter) {
@@ -90,14 +87,8 @@
 
         commands = new HashMap<>();
         commandChangedListeners = new HashSet<>();
-
-        eventBus.addHandler(WorkspaceReadyEvent.getType(), new WorkspaceReadyEvent.WorkspaceReadyHandler() {
-            @Override
-            public void onWorkspaceReady(WorkspaceReadyEvent event) {
                 retrieveAllCommands();
             }
-        });
-    }
 
     private void retrieveAllCommands() {
         workspaceServiceClient.getCommands(appContext.getWorkspaceId()).then(new Operation<List<CommandDto>>() {",0
File creation fixes in #26," import android.provider.MediaStore;
 import android.support.v4.app.Fragment;
 import android.support.v4.content.FileProvider;
+import android.support.v4.os.EnvironmentCompat;
 
 import com.zhihu.matisse.internal.entity.CaptureStrategy;
 
@@ -32,6 +33,7 @@
 import java.lang.ref.WeakReference;
 import java.text.SimpleDateFormat;
 import java.util.Date;
+import java.util.Locale;
 
 public class MediaStoreCompat {
 
@@ -79,6 +81,7 @@
                 mCurrentPhotoUri = FileProvider.getUriForFile(mContext.get(),
                         mCaptureStrategy.authority, photoFile);
                 captureIntent.putExtra(MediaStore.EXTRA_OUTPUT, mCurrentPhotoUri);
+                captureIntent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
                 if (mFragment != null) {
                     mFragment.get().startActivityForResult(captureIntent, requestCode);
                 } else {
@@ -90,8 +93,9 @@
 
     private File createImageFile() throws IOException {
         // Create an image file name
-        String timeStamp = new SimpleDateFormat(""yyyyMMdd_HHmmss"").format(new Date());
-        String imageFileName = ""JPEG_"" + timeStamp + ""_"";
+        String timeStamp =
+                new SimpleDateFormat(""yyyyMMdd_HHmmss"", Locale.getDefault()).format(new Date());
+        String imageFileName = String.format(""JPEG_%s.jpg"", timeStamp);
         File storageDir;
         if (mCaptureStrategy.isPublic) {
             storageDir = Environment.getExternalStoragePublicDirectory(
@@ -99,7 +103,16 @@
         } else {
             storageDir = mContext.get().getExternalFilesDir(Environment.DIRECTORY_PICTURES);
         }
-        return new File(storageDir + imageFileName + "".jpg"");
+
+        // Avoid joining path components manually
+        File tempFile = new File(storageDir, imageFileName);
+
+        // Handle the situation that user's external storage is not ready
+        if (!Environment.MEDIA_MOUNTED.equals(EnvironmentCompat.getStorageState(tempFile))) {
+            return null;
+        }
+
+        return tempFile;
     }
 
     public Uri getCurrentPhotoPath() {",0
Fixes javaslang/javaslang#116,"      * @throws java.lang.NullPointerException if comparator is null
      * @throws java.lang.UnsupportedOperationException if no elements are present
      */
-    default T maxBy(Comparator<T> comparator) {
+    default T maxBy(Comparator<? super T> comparator) {
         Objects.requireNonNull(comparator, ""comparator is null"");
         if (isEmpty()) {
             throw new UnsupportedOperationException(""maxBy of nothing"");
@@ -707,7 +707,7 @@
      * @throws java.lang.NullPointerException if comparator is null
      * @throws java.lang.UnsupportedOperationException if no elements are present
      */
-    default T minBy(Comparator<T> comparator) {
+    default T minBy(Comparator<? super T> comparator) {
         Objects.requireNonNull(comparator, ""comparator is null"");
         if (isEmpty()) {
             throw new UnsupportedOperationException(""minBy of nothing"");",0
修复自定义PathToStream时必须抛出异常的bug," 			} else if (path.startsWith(""jar://"")) {
 				return new Jar2Stream().toStream(path);
 			} else if (path.startsWith(""class://"")) {
-				((PathToStream) Class.forName(path.substring(8).split(""\\|"")[0]).newInstance()).toStream(path);
+				return ((PathToStream) Class.forName(path.substring(8).split(""\\|"")[0]).newInstance()).toStream(path);
 			} else if (path.startsWith(""http://"")||path.startsWith(""https://"")) {
 				return new Url2Stream().toStream(path);
 			} else {
@@ -34,7 +34,6 @@
 		} catch (Exception e) {
 			throw new LibraryException(e);
 		}
-		throw new LibraryException(""not find method type in path "" + path);
 	}
 
 	public abstract InputStream toStream(String path);",0
Fix TextureUnpacker bug when regions are rotated in atlas," 		// get the needed part of the page and rotate if needed
 		if (region.rotate) {
 			BufferedImage srcImage = page.getSubimage(region.left, region.top, region.height, region.width);
-			splitImage = new BufferedImage(region.height, region.width, page.getType());
+			splitImage = new BufferedImage(region.width, region.height, page.getType());
 
 			AffineTransform transform = new AffineTransform();
 			transform.rotate(Math.toRadians(90.0));",0
Remove possible null pointer dereference,"     @Override
     public void doTag() throws JspException, IOException {
         JspWriter out = getJspContext().getOut();
-        String webPropertyId = getWebPropertyId();
         
-        if (webPropertyId == null) {
+        if (this.webPropertyId == null) {
             ServletContext sc = ((PageContext) getJspContext()).getServletContext();
             ApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(sc);
             context.getAutowireCapableBeanFactory().autowireBeanProperties(this, AutowireCapableBeanFactory.AUTOWIRE_BY_NAME, false);
         }
         
+        String webPropertyId = getWebPropertyId();
+        
         if (webPropertyId.equals(""UA-XXXXXXX-X"")) {
             LOG.warn(""googleAnalytics.webPropertyId has not been overridden in a custom property file. Please set this in order to properly use the Google Analytics tag"");
         }",0
Fix PreferenceActivity bread crumbs,"-
 package org.holoeverywhere.preference;
 
 import java.io.IOException;
@@ -876,7 +875,7 @@
 
     public void showBreadCrumbs(CharSequence title, CharSequence shortTitle) {
         if (mFragmentBreadCrumbs == null) {
-            View crumbs = findViewById(android.R.id.title);
+            View crumbs = findViewById(R.id.title);
             try {
                 mFragmentBreadCrumbs = (FragmentBreadCrumbs) crumbs;
             } catch (ClassCastException e) {",0
fix typo,"         if (bowerInheritsProxyConfigFromMaven) {
             return MojoUtils.getProxyConfig(session, decrypter);
         } else {
-            getLog().info(""npm not inheriting proxy config from Maven"");
+            getLog().info(""bower not inheriting proxy config from Maven"");
             return new ProxyConfig(Collections.<ProxyConfig.Proxy>emptyList());
         }
     }",0
Don't apply partition response coming from old connection," 
     private void waitForPartitionsFetchedOnce() {
         while (partitionCount == 0 && client.getConnectionManager().isAlive()) {
-            Connection ownerConnection = this.ownerConnection;
-            if (ownerConnection == null) {
+            Connection currentOwnerConnection = this.ownerConnection;
+            if (currentOwnerConnection == null) {
                 sleepBeforeNextTry();
                 continue;
             }
@@ -132,11 +132,20 @@
             // invocation should go to owner connection because the listener is added to owner connection
             // and partition state version should be fetched from one member to keep it consistent
             ClientInvocationFuture future =
-                    new ClientInvocation(client, requestMessage, null, ownerConnection).invokeUrgent();
+                    new ClientInvocation(client, requestMessage, null, currentOwnerConnection).invokeUrgent();
             try {
                 ClientMessage responseMessage = future.get();
                 ClientGetPartitionsCodec.ResponseParameters response =
                         ClientGetPartitionsCodec.decodeResponse(responseMessage);
+                Connection connection = responseMessage.getConnection();
+                if (!currentOwnerConnection.equals(ownerConnection)) {
+                    if (logger.isFinestEnabled()) {
+                        logger.finest("" We will not apply the response, since response come from an old connection  "" + connection
+                                + "". Current connection "" + this.ownerConnection + "" state version:""
+                                + (response.partitionStateVersionExist ? response.partitionStateVersion : ""NotAvailable""));
+                    }
+                    continue;
+                }
                 processPartitionResponse(response.partitions,
                         response.partitionStateVersion, response.partitionStateVersionExist);
             } catch (Exception e) {",0
Fix issue where backup provider not configured,"      */
     public void start()
     {
-        if ( isActive() )
-        {
+        if (isActive()) {
             repeatingActivity.start();
             exhibitor.getConfigManager().addConfigListener
                 (
@@ -123,8 +122,7 @@
     @Override
     public void close() throws IOException
     {
-        if ( isActive() )
-        {
+        if (isActive()) {
             repeatingActivity.close();
         }
     }
@@ -186,7 +184,13 @@
     /**
      * Restore all known logs
      */
-    public void restoreAll() throws Exception {
+    public void restoreAll() throws Exception
+    {
+
+        if (!backupProvider.isPresent()) {
+            log.info(""No backup provider configured. Skipping restore."");
+            return;
+        }
 
         ZooKeeperLogFiles logFiles = new ZooKeeperLogFiles(exhibitor);
         log.info(""Restoring log files from backup."");
@@ -220,8 +224,7 @@
         File                    tempFile = File.createTempFile(""exhibitor-backup"", "".tmp"");
         OutputStream            out = new FileOutputStream(tempFile);
         InputStream in = null;
-        try
-        {
+        try {
             backupProvider.get().downloadBackup(exhibitor, backup, out, getBackupConfig());
             CloseableUtils.closeQuietly(out);
             out = null;
@@ -231,12 +234,10 @@
 
             ByteStreams.copy(in, out);
         }
-        finally
-        {
+        finally {
             CloseableUtils.closeQuietly(in);
             CloseableUtils.closeQuietly(out);
-            if ( !tempFile.delete() )
-            {
+            if (!tempFile.delete()) {
                 exhibitor.getLog().add(ActivityLog.Type.ERROR, ""Could not delete temp file (for restore): "" + tempFile);
             }
         }
@@ -244,59 +245,48 @@
 
     private void doBackup() throws Exception
     {
-        if ( !exhibitor.getControlPanelValues().isSet(ControlPanelTypes.BACKUPS) )
-        {
+        if (!exhibitor.getControlPanelValues().isSet(ControlPanelTypes.BACKUPS)) {
             return;
         }
 
         ZooKeeperLogFiles zooKeeperLogFiles = new ZooKeeperLogFiles(exhibitor);
-        if ( !zooKeeperLogFiles.isValid() )
-        {
+        if (!zooKeeperLogFiles.isValid()) {
             return;
         }
 
         Map<String, String> config = getBackupConfig();
 
         BackupProvider      provider = backupProvider.get();
-        if ( !provider.isValidConfig(exhibitor, config) )
-        {
+        if (!provider.isValidConfig(exhibitor, config)) {
             return;
         }
 
-        for ( File f : zooKeeperLogFiles.getPaths() )
-        {
+        for (File f : zooKeeperLogFiles.getPaths()) {
             TempCompressedFile      tempCompressedFile = new TempCompressedFile(f);
-            try
-            {
+            try {
                 tempCompressedFile.compress();
 
                 BackupMetaData          metaData = new BackupMetaData(f.getName(), f.lastModified());
                 BackupProvider.UploadResult result = provider.uploadBackup(exhibitor, metaData, tempCompressedFile.getTempFile(), config);
-                switch ( result )
-                {
-                    case SUCCEEDED:
-                    {
+                switch (result) {
+                    case SUCCEEDED: {
                         exhibitor.getLog().add(ActivityLog.Type.DEBUG, ""Backing up: "" + f);
                         break;
                     }
 
-                    case DUPLICATE:
-                    {
+                    case DUPLICATE: {
                         // ignore
                         break;
                     }
 
-                    case REPLACED_OLD_VERSION:
-                    {
+                    case REPLACED_OLD_VERSION: {
                         exhibitor.getLog().add(ActivityLog.Type.DEBUG, ""Updated back up for: "" + f);
                         break;
                     }
                 }
             }
-            finally
-            {
-                if ( !tempCompressedFile.getTempFile().delete() )
-                {
+            finally {
+                if (!tempCompressedFile.getTempFile().delete()) {
                     exhibitor.getLog().add(ActivityLog.Type.ERROR, ""Could not delete temp file: "" + tempCompressedFile.getTempFile());
                 }
             }
@@ -315,19 +305,16 @@
     private void doRoll(Map<String, String> config) throws Exception
     {
         long        elapsed = System.currentTimeMillis() - lastRollCheck.get();
-        if ( elapsed < (exhibitor.getConfigManager().getConfig().getInt(IntConfigs.BACKUP_MAX_STORE_MS) / 3) )
-        {
+        if (elapsed < (exhibitor.getConfigManager().getConfig().getInt(IntConfigs.BACKUP_MAX_STORE_MS) / 3)) {
             return;
         }
 
         exhibitor.getLog().add(ActivityLog.Type.DEBUG, ""Checking for elapsed backups"");
 
         List<BackupMetaData>        availableBackups = backupProvider.get().getAvailableBackups(exhibitor, config);
-        for ( BackupMetaData backup : availableBackups )
-        {
+        for (BackupMetaData backup : availableBackups) {
             long        age = System.currentTimeMillis() - backup.getModifiedDate();
-            if ( age > exhibitor.getConfigManager().getConfig().getInt(IntConfigs.BACKUP_MAX_STORE_MS) )
-            {
+            if (age > exhibitor.getConfigManager().getConfig().getInt(IntConfigs.BACKUP_MAX_STORE_MS)) {
                 exhibitor.getLog().add(ActivityLog.Type.DEBUG, ""Cleaning backup: "" + backup);
                 backupProvider.get().deleteBackup(exhibitor, backup, config);
             }",0
Batch.java documentation fix,"  * <p>
  * A Batch is a pretty heavy object so you should only ever have one in your program.
  * <p>
- * A Batch works with OpenGL ES 1.x and 2.0. In the case of a 2.0 context it will use its own custom shader to draw all provided
+ * A Batch works with OpenGL ES 2.0. It will use its own custom shader to draw all provided
  * sprites. You can set your own custom shader via {@link #setShader(ShaderProgram)}.
  * <p>
  * A Batch has to be disposed if it is no longer used.
@@ -178,8 +178,8 @@
 	public void enableBlending ();
 
 	/** Sets the blending function to be used when rendering sprites.
-	 * @param srcFunc the source function, e.g. GL11.GL_SRC_ALPHA. If set to -1, Batch won't change the blending function.
-	 * @param dstFunc the destination function, e.g. GL11.GL_ONE_MINUS_SRC_ALPHA */
+	 * @param srcFunc the source function, e.g. GL20.GL_SRC_ALPHA. If set to -1, Batch won't change the blending function.
+	 * @param dstFunc the destination function, e.g. GL20.GL_ONE_MINUS_SRC_ALPHA */
 	public void setBlendFunction (int srcFunc, int dstFunc);
 
 	public int getBlendSrcFunc ();",0
BACKLOG-19752 - Fixed failing PDI Integration Tests," import org.pentaho.di.core.Result;
 import org.pentaho.di.core.logging.KettleLogStore;
 import org.pentaho.di.job.Job;
+import org.pentaho.di.job.JobMeta;
 
 import java.io.File;
 import java.nio.file.Files;
@@ -53,6 +54,7 @@
   public void setUp() throws Exception {
     entry = new JobEntryCopyFiles( ""Job entry copy files"" );
     entry.setParentJob( new Job() );
+    entry.setParentJobMeta( new JobMeta() );
 
     source = Files.createTempDirectory( ""src"" );
     destination = Files.createTempDirectory( ""dest"" );",0
[BACKLOG-4068] Identify and fix the places in code where xalan librar…,"       // Create a few objects to help do the layout of XML snippets we find along the way
       //
       Transformer transformer = null;
-      try {
-        Class<?> clazz = Class.forName( ""org.apache.xalan.processor.TransformerFactoryImpl"" );
-        TransformerFactory transformerFactory = (TransformerFactory) clazz.newInstance();
-        transformer = transformerFactory.newTransformer();
-      } catch ( Throwable t ) {
+      /* 
+       * as of BACKLOG-4068, explicit xalan factory references have been deprecated; we use the javax.xml factory 
+       * and let java's SPI determine the proper transformer implementation. In addition, tests has been made to
+       * safeguard that https://github.com/pentaho/pentaho-kettle/commit/3b57f7a9aac657fe77cc4f08e8d4287fcccbc073
+       * continues working as intended
+       */
+
         TransformerFactory transformerFactory = TransformerFactory.newInstance();
         transformer = transformerFactory.newTransformer();
-      }
+
       transformer.setOutputProperty( OutputKeys.OMIT_XML_DECLARATION, ""yes"" );
       transformer.setOutputProperty( OutputKeys.INDENT, ""yes"" );
 ",0
fix javadoc in indarray,"     boolean isWrapAround();
 
     /**
-     * The rank of the ndarray (the number of dimensions
-     * @return the rank for the ndarray
+     * Returns the rank of the ndarray (the number of dimensions).
+     * 
+     * @return the rank for the ndarray.
      */
     int rank();
 
@@ -235,17 +236,17 @@
 
 
     /**
-     * Cumulative sum along a dimension
+     * Returns the cumulative sum along a dimension. In-place method.
      *
-     * @param dimension the dimension to perform cumulative sum along
-     * @return the cumulative sum along the specified dimension
+     * @param dimension the dimension to perform cumulative sum along.
+     * @return this object.
      */
     INDArray cumsumi(int dimension);
 
     /**
-     * Cumulative sum along a dimension (in place)
+     * Returns the cumulative sum along a dimension.
      *
-     * @param dimension the dimension to perform cumulative sum along
+     * @param dimension the dimension to perform cumulative sum along.
      * @return the cumulative sum along the specified dimension
      */
     INDArray cumsum(int dimension);
@@ -349,22 +350,18 @@
     INDArray putScalar(int dim0, int dim1, int dim2, int dim3, double value);
 
     /**
-     * Returns an ndarray with 1 if the element is less than
-     * the given element 0 other wise
+     * Returns the binary ndarray for ""Less"" comparison.
      *
-     * @param other the number to compare
-     * @return a copied ndarray with the given
-     * binary conditions
+     * @param other the number to compare.
+     * @return the binary ndarray for ""Less"" comparison.
      */
     INDArray lt(Number other);
 
     /**
-     * In place less than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Less"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the number to compare.
+     * @return this object.
      */
     INDArray lti(Number other);
 
@@ -385,206 +382,185 @@
     INDArray putScalar(int[] indexes, int value);
 
     /**
-     * Returns an ndarray with 1 if the element is epsilon equals
+     * Returns the binary ndarray for ""Epsilon equals"" comparison.
      *
-     * @param other the number to compare
-     * @return a copied ndarray with the given
-     * binary conditions
+     * @param other the number to compare.
+     * @return the binary ndarray for ""Epsilon equals"" comparison.
      */
     INDArray eps(Number other);
 
 
     /**
-     * Returns an ndarray with 1 if the element is epsilon equals
+     * Returns the binary ndarray for ""Epsilon equals"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return a copied ndarray with the given
-     * binary conditions
+     * @param other the number to compare.
+     * @return this object.
      */
     INDArray epsi(Number other);
 
 
     /**
-     * Returns an ndarray with 1 if the element is less than
-     * the given element 0 other wise
+     * Returns the binary ndarray for ""Equals"" comparison.
      *
-     * @param other the number to compare
-     * @return a copied ndarray with the given
-     * binary conditions
+     * @param other the number to compare.
+     * @return the binary ndarray for ""Equals"" comparison.
      */
     INDArray eq(Number other);
 
     /**
-     * In place less than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Equals"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the number to compare.
+     * @return this object.
      */
     INDArray eqi(Number other);
 
     /**
-     * Greater than boolean (copying)(
+     * Returns the binary ndarray for ""Greater"" comparison.
      *
-     * @param other
-     * @return
+     * @param other the number to compare.
+     * @return the binary ndarray for ""Greater"" comparison.
      */
     INDArray gt(Number other);
 
    /**
-    * Greter or equals
+    * Returns binary ndarray for ""Greter or equals"" comparison.
     *
-    * @param other
-    * @return
+    * @param other the number to compare.
+    * @return binary ndarray for ""Greter or equals"" comparison.
     */
     INDArray gte(Number other);
 
    /**
-    * Less or equals
+    * Returns the binary ndarray for ""Less or equals"" comparison.
     *
-    * @param other
-    * @return
+    * @param other the number to compare.
+    * @return the binary ndarray for ""Less or equals"" comparison.
     */
     INDArray lte(Number other);
 
    /**
-    * Inplace greater or equals
+    * Returns the binary ndarray for ""Greter or equals"" comparison. In-place method.
     *
-    * @param other
-    * @return
+    * @param other the number to compare.
+    * @return this object.
     */
     INDArray gtei(Number other);
 
    /**
-    * Inplace less or equals
+    * Returns the binary ndarray for ""Less or equals"" comparison. In-place method.
     *
-    * @param other
-    * @return
+    * @param other the number to compare.
+    * @return this object.
     */
     INDArray ltei(Number other);
 
     /**
-     * In place greater than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Greter"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the number to compare.
+     * @return this object.
      */
     INDArray gti(Number other);
 
     /**
-     * less than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Less"" comparison.
      *
-     * @param other the number to compare
-     * @return the result ndarray
+     * @param other the ndarray to compare.
+     * @return the binary ndarray for ""Less"" comparison.
      */
 
     INDArray lt(INDArray other);
 
     /**
-     * In place less than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Less"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return this object.
      */
     INDArray lti(INDArray other);
 
 
     /**
-     * epsilon equals than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Epsilon equals"" comparison.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return the binary ndarray for ""Epsilon equals"" comparison.
      */
     INDArray eps(INDArray other);
 
     /**
-     * In place epsilon equals than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Epsilon equals"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return this object.
      */
     INDArray epsi(INDArray other);
 
     /**
-     * Not equal
-     * @param other
-     * @return
+     * Returns the binary ndarray for ""Not equals"" comparison.
+     * 
+     * @param other the number to compare.
+     * @return the binary ndarray for ""Not equals"" comparison.
      */
     INDArray neq(Number other);
 
     /**
-     * In place not equal
-     * @param other
-     * @return
+     * Returns the binary ndarray for ""Not equals"" comparison. In-place method.
+     * 
+     * @param other the number to compare.
+     * @return this object.
      */
     INDArray neqi(Number other);
 
     /**
+     * Returns the binary ndarray for ""Not equals"" comparison.
      *
-     * @param other
-     * @return
+     * @param other the ndarray to compare.
+     * @return the binary ndarray for ""Not equals"" comparison.
      */
     INDArray neq(INDArray other);
 
     /**
+     * Returns the binary ndarray for ""Not equals"" comparison. In-place method.
      *
-     * @param other
-     * @return
+     * @param other the ndarray to compare.
+     * @return this object.
      */
     INDArray neqi(INDArray other);
 
     /**
-     * equal than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Equals"" comparison.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return the binary ndarray for ""Equals"" comparison.
      */
     INDArray eq(INDArray other);
 
     /**
-     * In place equal than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Equals"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return this object.
      */
     INDArray eqi(INDArray other);
 
     /**
-     * greater than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Greter"" comparison.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return the binary ndarray for ""Greter"" comparison.
      */
     INDArray gt(INDArray other);
 
     /**
-     * In place greater than comparison:
-     * If the given number is less than the
-     * comparison number the item is 0 otherwise 1
+     * Returns the binary ndarray for ""Greter"" comparison. In-place method.
      *
-     * @param other the number to compare
-     * @return
+     * @param other the ndarray to compare.
+     * @return this object.
      */
     INDArray gti(INDArray other);
 
-
     /**
      * Returns the ndarray negative (cloned)
      *
@@ -1787,14 +1763,16 @@
 
 
     /**
-     * Return a copy of this ndarray
+     * Returns a copy of this ndarray
      *
      * @return a copy of this ndarray
      */
     INDArray dup();
 
-    /**Return a copy of this ndarray, where the returned ndarray has the specified order
-     * @param order Order of the NDArray. 'f' or 'c'
+    /**
+     * Returns a copy of this ndarray, where the returned ndarray has the specified order
+     * 
+     * @param order order of the NDArray. 'f' or 'c'
      * @return copy of ndarray with specified order
      */
     INDArray dup(char order);",0
Prevent NullPointerException by not setting the static instance,"                     for (GlideModule module : modules) {
                         module.applyOptions(applicationContext, builder);
                     }
-                    glide = builder.createGlide();
+                    Glide glide = builder.createGlide();
                     for (GlideModule module : modules) {
                         module.registerComponents(applicationContext, glide);
                     }
+                    Glide.glide = glide;
                 }
             }
         }",0
Fix nesterov updater state array," import lombok.Data;
 import lombok.NoArgsConstructor;
 import org.nd4j.linalg.api.ndarray.INDArray;
+import org.nd4j.linalg.api.ops.impl.transforms.arithmetic.AddOp;
 import org.nd4j.linalg.api.shape.Shape;
+import org.nd4j.linalg.factory.Nd4j;
 
 import java.io.Serializable;
 
@@ -74,15 +76,21 @@
         if (v == null)
             throw new IllegalStateException(""Updater has not been initialized with view state"");
 
-        INDArray vPrev = v;
-        v = vPrev.mul(momentum).subi(gradient.mul(learningRate));
         //reference https://cs231n.github.io/neural-networks-3/#sgd 2nd equation
         //DL4J default is negative step function thus we flipped the signs:
         // x += mu * v_prev + (-1 - mu) * v
         //i.e., we do params -= updatedGradient, not params += updatedGradient
 
+        //v = mu * v - lr * gradient
+        INDArray vPrev = v.dup();
+        v.muli(momentum).subi(gradient.mul(learningRate));              //Modify state array in-place
+
+        /*
+        Next line is equivalent to:
         INDArray ret = vPrev.muli(momentum).addi(v.mul(-momentum - 1));
         gradient.assign(ret);
+        */
+        Nd4j.getExecutioner().exec(new AddOp(vPrev.muli(momentum), v.mul(-momentum - 1), gradient));
 
         return gradient;
     }",0
little fix,"    * @return Unique deployment id
    */
   public String deployVerticle(String main, int instances) {
-    return deployVerticle(main, null, 1);
+    return deployVerticle(main, null, instances);
   }
 
   /**",0
Fixed negative netty sleep values.,"      */
     private int getSleepTimeMs()
     {
-        int sleepMs = base_sleep_ms * Math.max(1, random.nextInt(1 << retries.get()));
+        int backoff = 1 << Math.max(1, retries.get());
+        int sleepMs = base_sleep_ms * Math.max(1, random.nextInt(backoff));
         if ( sleepMs > max_sleep_ms )
             sleepMs = max_sleep_ms;
+        if ( sleepMs < base_sleep_ms )
+          sleepMs = base_sleep_ms;
         return sleepMs;
     }
 ",0
Fixed issue #21," 		}
 
 		holder.eBean = codeModel._class(modifiers, generatedBeanQualifiedName, ClassType.CLASS);
-
 		JClass eBeanClass = codeModel.directClass(eBeanQualifiedName);
 
 		holder.eBean._extends(eBeanClass);
 
+		holder.eBean.annotate(SuppressWarnings.class).param(""value"", ""unused"");
+		holder.eBean.javadoc().append( //
+				""We use @SuppressWarning here because our java code\n"" +
+				""generator doesn't know that there is no need\n"" +
+				""to import OnXXXListeners from View as we already\n"" +
+				""are in a View. <b>See issue #21.</b>"");
+
 		{
 			// init
 			holder.init = holder.eBean.method(PRIVATE, codeModel.VOID, ""init_"");",0
Fix NPE when password has expired but there are remaining logins.,"             return;
         }
 
+        if (warning.getExpiration()!=null){
         final ZonedDateTime expDate = DateTimeUtils.zonedDateTimeOf(warning.getExpiration());
         final long ttl = ZonedDateTime.now(ZoneOffset.UTC).until(expDate, ChronoUnit.DAYS);
         LOGGER.debug(
@@ -165,6 +166,7 @@
         if (configuration.isAlwaysDisplayPasswordExpirationWarning() || ttl < configuration.getPasswordWarningNumberOfDays()) {
             messages.add(new PasswordExpiringWarningMessageDescriptor(""Password expires in {0} days."", ttl));
         }
+        }
         if (warning.getLoginsRemaining() > 0) {
             messages.add(new DefaultMessageDescriptor(
                     ""password.expiration.loginsRemaining"",",0
Fixing memory leak related to TouchFocus and pooling," 		public void reset () {
 			listenerActor = null;
 			listener = null;
+			target = null;
 		}
 	}
 }",0
Fix proxyticket prefix," 
     @Override
     public String getPrefix() {
-        return ProxyTicket.PREFIX;
+        return ProxyTicket.PROXY_TICKET_PREFIX;
     }
 }",0
"Foreign key lookups on Content Items should show the entity's name, not ID"," import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.broadleafcommerce.cms.field.domain.FieldDefinition;
+import org.broadleafcommerce.cms.field.domain.FieldDefinitionImpl;
 import org.broadleafcommerce.cms.field.domain.FieldGroup;
 import org.broadleafcommerce.cms.structure.domain.StructuredContent;
 import org.broadleafcommerce.cms.structure.domain.StructuredContentField;
@@ -32,6 +33,7 @@
 import org.broadleafcommerce.cms.structure.domain.StructuredContentTypeImpl;
 import org.broadleafcommerce.cms.structure.service.StructuredContentService;
 import org.broadleafcommerce.common.exception.ServiceException;
+import org.broadleafcommerce.common.presentation.client.SupportedFieldType;
 import org.broadleafcommerce.openadmin.dto.ClassMetadata;
 import org.broadleafcommerce.openadmin.dto.ClassTree;
 import org.broadleafcommerce.openadmin.dto.CriteriaTransferObject;
@@ -41,6 +43,7 @@
 import org.broadleafcommerce.openadmin.dto.PersistencePackage;
 import org.broadleafcommerce.openadmin.dto.Property;
 import org.broadleafcommerce.openadmin.server.dao.DynamicEntityDao;
+import org.broadleafcommerce.openadmin.server.service.AdminEntityService;
 import org.broadleafcommerce.openadmin.server.service.ValidationException;
 import org.broadleafcommerce.openadmin.server.service.handler.CustomPersistenceHandlerAdapter;
 import org.broadleafcommerce.openadmin.server.service.handler.DynamicEntityRetriever;
@@ -77,6 +80,9 @@
     @PersistenceContext(unitName=""blPU"")
     protected EntityManager em;
 
+    @Resource(name = ""blAdminEntityService"")
+    protected AdminEntityService service;
+
     @Override
     public Boolean canHandleFetch(PersistencePackage persistencePackage) {
         String ceilingEntityFullyQualifiedClassname = persistencePackage.getCeilingEntityFullyQualifiedClassname();
@@ -180,6 +186,12 @@
                 if (!CollectionUtils.isEmpty(dirtyFields) && dirtyFields.contains(property.getName())) {
                     property.setIsDirty(true);
                 }
+
+                if (SupportedFieldType.ADDITIONAL_FOREIGN_KEY.equals(def.getFieldType()) && value != null) {
+                    // we need to look up the display value
+                    String display = service.getForeignEntityName(def.getAdditionalForeignKeyClass(), value);
+                    property.setDisplayValue(display);
+                }
                 propertiesList.add(property);
             }
         }",0
Fix silent exceptions on elements," 		Iterator<? extends TypeElement> iterator = annotations.iterator();
 		if (iterator.hasNext()) {
 			Element element = roundEnv.getElementsAnnotatedWith(iterator.next()).iterator().next();
-			LOGGER.error(""Something went wront : {}"", errorMessage, element);
+			LOGGER.error(""Something went wront : {}"", element, errorMessage);
 		} else {
 			LOGGER.error(""Something went wront : {}"", errorMessage);
 		}",0
Missing id for BPMN element fixed," import org.activiti.api.process.model.events.SequenceFlowTakenEvent;
 import org.activiti.api.runtime.event.impl.SequenceFlowTakenImpl;
 import org.activiti.engine.delegate.event.ActivitiSequenceFlowTakenEvent;
-import org.activiti.api.runtime.model.impl.SequenceFlowImpl;
 
 public class ToSequenceFlowTakenConverter implements EventConverter<SequenceFlowTakenEvent, ActivitiSequenceFlowTakenEvent>{
 
-    @Override
+       
     public Optional<SequenceFlowTakenEvent> from(ActivitiSequenceFlowTakenEvent internalEvent) {
-        SequenceFlowImpl sequenceFlow = new SequenceFlowImpl(internalEvent.getSourceActivityId(),
+        BPMNSequenceFlowImpl sequenceFlow = new BPMNSequenceFlowImpl(internalEvent.getId(),
+                                                                     internalEvent.getSourceActivityId(),
                                                              internalEvent.getTargetActivityId());
+
+
         sequenceFlow.setProcessDefinitionId(internalEvent.getProcessDefinitionId());
         sequenceFlow.setProcessInstanceId(internalEvent.getProcessInstanceId());
         sequenceFlow.setSourceActivityName(internalEvent.getSourceActivityName());
         sequenceFlow.setSourceActivityType(internalEvent.getSourceActivityType());
         sequenceFlow.setTargetActivityName(internalEvent.getTargetActivityName());
         sequenceFlow.setTargetActivityType(internalEvent.getTargetActivityType());
-        return Optional.of(new SequenceFlowTakenImpl(sequenceFlow));
+
+
+        SequenceFlowTakenImpl sequenceFlowTaken = new SequenceFlowTakenImpl(sequenceFlow);
+        sequenceFlowTaken.setProcessInstanceId(internalEvent.getProcessInstanceId());
+        sequenceFlowTaken.setProcessDefinitionId(internalEvent.getProcessDefinitionId());
+
+        return Optional.of(sequenceFlowTaken);
     }
+
 }",0
fix scheduledReport issue," 		model.setUserReportSubStates(userRules);
 	}
 
-	public void refreshScheduledReport() throws Exception {
-		Map<String, Project> projects = m_projectService.findAllProjects();
-
-		for (Entry<String, Project> entry : projects.entrySet()) {
-			String domain = entry.getKey();
-			String cmdbDomain = entry.getValue().getCmdbDomain();
-
-			if (StringUtils.isNotEmpty(cmdbDomain) && !m_reports.containsKey(cmdbDomain)) {
-				updateData(cmdbDomain);
-			} else if (StringUtils.isEmpty(cmdbDomain) && !m_reports.containsKey(domain)) {
-				updateData(domain);
-			}
-		}
-	}
-
 	public void scheduledReportDelete(Payload payload) {
 		int id = payload.getScheduledReportId();
 		ScheduledReport proto = m_scheduledReportDao.createLocal();
@@ -168,6 +153,52 @@
 		}
 	}
 
+	@Override
+	public void initialize() throws InitializationException {
+		try {
+			List<ScheduledReport> reports = m_scheduledReportDao.findAll(ScheduledReportEntity.READSET_FULL);
+
+			for (ScheduledReport report : reports) {
+				String domain = report.getDomain();
+				Project project = m_projectService.findByDomain(domain);
+
+				if (project == null) {
+					project = m_projectService.findByCmdbDomain(domain);
+				}
+
+				if (project != null) {
+					String cmdbDomain = project.getCmdbDomain();
+
+					if (StringUtils.isNotEmpty(cmdbDomain) && !report.getDomain().equals(cmdbDomain)
+					      && !m_reports.containsKey(cmdbDomain)) {
+						ScheduledReport entity = m_scheduledReportDao.createLocal();
+
+						entity.setKeyId(report.getKeyId());
+						entity.setId(report.getId());
+						entity.setNames(report.getNames());
+						entity.setDomain(cmdbDomain);
+
+						int succ = m_scheduledReportDao.updateByPK(entity, ScheduledReportEntity.UPDATESET_FULL);
+						if (succ > 0) {
+							report.setDomain(cmdbDomain);
+							m_reports.put(cmdbDomain, report);
+						} else {
+							m_reports.put(domain, report);
+						}
+					} else {
+						m_reports.put(domain, report);
+					}
+				} else {
+					m_reports.put(domain, report);
+				}
+			}
+			Threads.forGroup(""cat"").start(new ScheduledReportUpdateTask());
+		} catch (Exception e) {
+			Cat.logError(e);
+			e.printStackTrace();
+		}
+	}
+
 	private void updateData(String domain) throws Exception {
 		ScheduledReport entity = m_scheduledReportDao.createLocal();
 
@@ -179,9 +210,19 @@
 		m_reports.put(domain, report);
 	}
 
-	@Override
-	public void initialize() throws InitializationException {
-		Threads.forGroup(""Cat"").start(new ScheduledReportUpdateTask());
+	public void refreshScheduledReport() throws Exception {
+		Map<String, Project> projects = m_projectService.findAllProjects();
+
+		for (Entry<String, Project> entry : projects.entrySet()) {
+			String domain = entry.getKey();
+			String cmdbDomain = entry.getValue().getCmdbDomain();
+
+			if (StringUtils.isNotEmpty(cmdbDomain) && !m_reports.containsKey(cmdbDomain)) {
+				updateData(cmdbDomain);
+			} else if (StringUtils.isEmpty(cmdbDomain) && !m_reports.containsKey(domain)) {
+				updateData(domain);
+			}
+		}
 	}
 
 	public class ScheduledReportUpdateTask implements Task {",0
Fix NPE,"   }
 
   private static File getKeyValueCacheDir() {
-    if (directory == null || !directory.exists()) {
+    if (directory != null && !directory.exists()) {
       directory.mkdir();
     }
     return directory;",0
Fix accidental calls to setAdapter(ListAdapter)," 	 * @deprecated use #setAdapter(BaseAdapter) instead.
 	 */
 	public void setAdapter(ListAdapter adapter) {
+		if (!(adapter instanceof BaseAdapter)) {
 		throw new IllegalArgumentException(""DynamicListView needs a BaseAdapter!"");
 	}
+		super.setAdapter(adapter);
+	}
 
 	/**
 	 * Listens for long clicks on any items in the listview. When a cell has",0
Actually support all supported legacy ATN UUIDs (fixes #410)," 
 import java.io.InvalidClassException;
 import java.util.ArrayList;
-import java.util.HashSet;
 import java.util.List;
 import java.util.Locale;
-import java.util.Set;
 import java.util.UUID;
 
 /**
@@ -152,8 +150,7 @@
 
 		UUID uuid = toUUID(data, p);
 		p += 8;
-		if (!uuid.equals(SERIALIZED_UUID)
-			&& !uuid.equals(BASE_SERIALIZED_UUID)) {
+		if (!SUPPORTED_UUIDS.contains(uuid)) {
 			String reason = String.format(Locale.getDefault(), ""Could not deserialize ATN with UUID %s (expected %s or a legacy UUID)."", uuid, SERIALIZED_UUID);
 			throw new UnsupportedOperationException(new InvalidClassException(ATN.class.getName(), reason));
 		}",0
fix table undefine NullPointerException," 		
 		List<SQLUpdateSetItem> updateSetItem = update.getItems();
 		TableConfig tc = schema.getTables().get(tableName);
+		if (tc == null) {
+            return;
+        }
 
 		if(RouterUtil.isNoSharding(schema,tableName)) {//整个schema都不分库或者该表不拆分
 			RouterUtil.routeForTableMeta(rrs, schema, tableName, rrs.getStatement());",0
Legacy Liquid Load Fix," package net.minecraftforge.fluids;
 
 import java.util.Locale;
-
+import com.google.common.base.Strings;
 import net.minecraft.item.ItemStack;
 import net.minecraft.nbt.NBTTagCompound;
 
@@ -60,7 +60,7 @@
             return null;
         }
         String fluidName = nbt.getString(""FluidName"");
-        if (fluidName == null)
+        if (Strings.isNullOrEmpty(fluidName))
         {
             fluidName = nbt.hasKey(""LiquidName"") ? nbt.getString(""LiquidName"").toLowerCase(Locale.ENGLISH) : null;
             fluidName = Fluid.convertLegacyName(fluidName);",0
Just a fix to accelerometer in iOS version of SupaJumpa ," import com.badlogic.gdx.Application;
 import com.badlogic.gdx.Game;
 import com.badlogic.gdx.Gdx;
+import com.badlogic.gdx.Application.ApplicationType;
 import com.badlogic.gdx.Input.Keys;
+import com.badlogic.gdx.Input.Peripheral;
 import com.badlogic.gdx.Screen;
 import com.badlogic.gdx.graphics.GL10;
 import com.badlogic.gdx.graphics.GLCommon;
@@ -128,7 +130,10 @@
 			}
 		}
 
-		if (Gdx.app.getType() == Application.ApplicationType.Android) {
+		ApplicationType appType = Gdx.app.getType();
+		
+		// should work also with Gdx.input.isPeripheralAvailable(Peripheral.Accelerometer)
+		if (appType == ApplicationType.Android || appType == ApplicationType.iOS) {
 			world.update(deltaTime, Gdx.input.getAccelerometerX());
 		} else {
 			float accel = 0;",0
Fixed notify on exception in mapreduce when jobowner is the local node," 
 import com.hazelcast.cluster.ClusterService;
 import com.hazelcast.instance.MemberImpl;
+import com.hazelcast.logging.ILogger;
 import com.hazelcast.mapreduce.JobPartitionState;
 import com.hazelcast.mapreduce.PartitionIdAware;
 import com.hazelcast.mapreduce.impl.operation.KeysAssignmentOperation;
@@ -73,15 +74,25 @@
     }
 
     public static void notifyRemoteException(JobSupervisor supervisor, Throwable throwable) {
+        MapReduceService mapReduceService = supervisor.getMapReduceService();
+        NodeEngine nodeEngine = mapReduceService.getNodeEngine();
+        try {
+            Address jobOwner = supervisor.getJobOwner();
+            if (supervisor.isOwnerNode()) {
+                supervisor.notifyRemoteException(jobOwner, throwable);
+            } else {
         String name = supervisor.getConfiguration().getName();
         String jobId = supervisor.getConfiguration().getJobId();
         NotifyRemoteExceptionOperation operation = new NotifyRemoteExceptionOperation(name, jobId, throwable);
-        MapReduceService mapReduceService = supervisor.getMapReduceService();
-        NodeEngine nodeEngine = mapReduceService.getNodeEngine();
+
         OperationService os = nodeEngine.getOperationService();
-        Address jobOwner = supervisor.getJobOwner();
         os.send(operation, jobOwner);
     }
+        } catch (Exception e) {
+            ILogger logger = nodeEngine.getLogger(MapReduceUtil.class);
+            logger.warning(""Could not notify remote map-reduce owner"", e);
+        }
+    }
 
     public static JobPartitionState.State stateChange(Address owner, int partitionId, JobPartitionState.State currentState,
                                                       JobProcessInformationImpl processInformation,",0
Bugfix: 修复SmaliTool在修改字段的时候replace函数限制不严导致某些情况下smali中的类名会被修改成错误的类名的bug,"                 // 字段处理
                 //sget-object v4, Lcom/sankuai/meituan/fingerprint/FingerprintConfig;->accelerometerInfoList:Ljava/util/List;
                 String fieldName = result.substring(packageNameIndex + packageNameList.get(index).length() + 3, result.lastIndexOf("":""));
-                result = result.replace(fieldName, getObscuredMemberName(packageNameList.get(index).replaceAll(""/"", ""\\.""), fieldName));
+                // 前后都加上 ""->"" 是为了避免类名中包含字段名时，类名被误修改导致patch生成错误
+                result = result.replaceFirst(""->"" + fieldName, ""->"" + getObscuredMemberName(packageNameList.get(index).replaceAll(""/"", ""\\.""), fieldName));
             }
         }
         for (int index = 0; packageNameList != null && index < packageNameList.size(); index++) {",0
Fix ClassCastException in AbstractVertexCentricQueryBuilder,"             Interval interval = null;
             //First check for equality constraints, since those are the most constraining
             for (Iterator<Condition<TitanRelation>> iter = conditions.iterator(); iter.hasNext(); ) {
-                PredicateCondition<TitanType, TitanRelation> atom = (PredicateCondition) iter.next();
+                Condition<TitanRelation> cond = iter.next();
+                if (cond instanceof PredicateCondition) {
+                    PredicateCondition<TitanType, TitanRelation> atom = (PredicateCondition) cond;
                 if (atom.getKey().equals(pktype) && atom.getPredicate() == Cmp.EQUAL && interval == null) {
                     interval = new PointInterval(atom.getValue());
                     iter.remove();
                 }
             }
+            }
 
             //If there are no equality constraints, check if the sort key's datatype allows comparison
             //and if so, find a bounding interval from the remaining constraints",0
Fix Bug in limit on From class," 
 		if (mLimit != null) {
 			sql.append(""LIMIT "");
+			sql.append(mLimit);
 			sql.append("" "");
 		}
 ",0
Fix typos in user visible output," 		String coreVersion = getAAProcessorVersion();
 
 		if (!apiVersion.equals(coreVersion)) {
-			LOGGER.error(""AndroidAnnotation version for API ({}) and core ({}) doesn't match. Please check your classpath"", apiVersion, coreVersion);
-			throw new VersionMismatchException(""AndroidAnnotation version for API ("" + apiVersion + "") and core ("" + coreVersion + "") doesn't match. Please check your classpath"");
+			LOGGER.error(""AndroidAnnotations version for API ({}) and core ({}) doesn't match. Please check your classpath"", apiVersion, coreVersion);
+			throw new VersionMismatchException(""AndroidAnnotations version for API ("" + apiVersion + "") and core ("" + coreVersion + "") doesn't match. Please check your classpath"");
 		}
 	}
 
@@ -132,7 +132,7 @@
 			URL url = getClass().getClassLoader().getResource(filename);
 			properties.load(url.openStream());
 		} catch (Exception e) {
-			LOGGER.error(""Core property file {} couldn't be parse"");
+			LOGGER.error(""Core property file {} couldn't be parsed"");
 			throw new FileNotFoundException(""Core property file "" + filename + "" couldn't be parsed."");
 		}
 	}
@@ -143,7 +143,7 @@
 			URL url = EActivity.class.getClassLoader().getResource(filename);
 			propertiesApi.load(url.openStream());
 		} catch (Exception e) {
-			LOGGER.error(""API property file {} couldn't be parse"");
+			LOGGER.error(""API property file {} couldn't be parsed"");
 			throw new FileNotFoundException(""API property file "" + filename + "" couldn't be parsed. Please check your classpath and verify that AA-API's version is at least 3.0"");
 		}
 	}
@@ -266,9 +266,9 @@
 		Iterator<? extends TypeElement> iterator = annotations.iterator();
 		if (iterator.hasNext()) {
 			Element element = roundEnv.getElementsAnnotatedWith(iterator.next()).iterator().next();
-			LOGGER.error(""Something went wront : {}"", element, errorMessage);
+			LOGGER.error(""Something went wrong: {}"", element, errorMessage);
 		} else {
-			LOGGER.error(""Something went wront : {}"", errorMessage);
+			LOGGER.error(""Something went wrong: {}"", errorMessage);
 		}
 	}
 ",0
SlideImagesPreviewScaleFixed,"     public void onDraw(Canvas canvas) {
         if (image.get() != null) {
             if (ignoreAspectRatio) {
+                canvas.drawTexture(image.get(), tint.get());
+            } else {
                 ScaleMode scaleMode = canvas.getCurrentStyle().getTextureScaleMode();
-                canvas.getCurrentStyle().setTextureScaleMode(ScaleMode.STRETCH);
+                canvas.getCurrentStyle().setTextureScaleMode(ScaleMode.SCALE_FILL);
                 canvas.drawTexture(image.get(), tint.get());
                 canvas.getCurrentStyle().setTextureScaleMode(scaleMode);
-            } else {
-                canvas.drawTexture(image.get(), tint.get());
             }
         }
     }",0
Fixes #208: MpscLinkedAtomicQueue can be made not final,"  * @param <E> the type of elements in this queue
  * @author nitsanw
  */
-public final class MpscLinkedAtomicQueue<E> extends BaseLinkedAtomicQueue<E> {
+public class MpscLinkedAtomicQueue<E> extends BaseLinkedAtomicQueue<E> {
 
     public MpscLinkedAtomicQueue() {
         LinkedQueueAtomicNode<E> node = newNode();",0
KYLIN-3505 Fix wrong usage of cache in DataType,"         LEGACY_TYPE_MAP.put(""hllc16"", ""hllc(16)"");
     }
 
-    private static final ConcurrentMap<DataType, DataType> CACHE = new ConcurrentHashMap<DataType, DataType>();
+    private static final ConcurrentMap<String, DataType> CACHE = new ConcurrentHashMap<String, DataType>();
 
     public static final DataType ANY = DataType.getType(""any"");
 
@@ -142,10 +142,10 @@
         if (type == null)
             return null;
 
-        DataType dataType = new DataType(type);
-        DataType cached = CACHE.get(dataType);
+        DataType cached = CACHE.get(type);
         if (cached == null) {
-            CACHE.put(dataType, dataType);
+            DataType dataType = new DataType(type);
+            CACHE.put(type, dataType);
             cached = dataType;
         }
         return cached;",0
780: fixed wrong condition check in Array.valid()," import java.util.Arrays;
 import java.util.Collections;
 import java.util.List;
+import java.util.Objects;
 
 /**
  * Fixed size array.
@@ -14,20 +15,14 @@
 
     @SafeVarargs
     Array(String type, T... values) {
-        if (!valid(values, type)) {
-            throw new UnsupportedOperationException(
-                    ""If empty list is provided, use empty array instance"");
-        }
+        checkValid(type, Arrays.asList(values));
 
         this.type = type;
         this.value = Arrays.asList(values);
     }
 
     Array(String type, List<T> values) {
-        if (!valid(values, type)) {
-            throw new UnsupportedOperationException(
-                    ""If empty list is provided, use empty array instance"");
-        }
+        checkValid(type, values);
 
         this.type = type;
         this.value = values;
@@ -48,12 +43,13 @@
         return type;
     }
 
-    private boolean valid(T[] values, String type) {
-        return values != null || values.length != 0 || type != null;
-    }
+    private void checkValid(String type, List<T> values) {
+        Objects.requireNonNull(type);
 
-    private boolean valid(List<T> values, String type) {
-        return values != null || values.size() != 0 || type != null;
+        if (values == null || values.size() == 0) {
+            throw new UnsupportedOperationException(
+                ""If empty list is provided, use empty array instance"");
+        }
     }
 
     @Override",0
Fix offset of the bubble view on Oneplus6 devices.,"         super.onLayout(changed, left, top, right, bottom);
 
         if (!isHideBubble) {
-            locatePositionOnScreen();
+            locatePositionInWindow();
         }
     }
 
@@ -464,8 +464,8 @@
      * 先计算进度mProgress为mMin时BubbleView的中心坐标（mBubbleCenterRawSolidX，mBubbleCenterRawSolidY），
      * 然后根据进度来增量计算横坐标mBubbleCenterRawX，再动态设置LayoutParameter.x，就实现了气泡跟随滑动移动。
      */
-    private void locatePositionOnScreen() {
-        getLocationOnScreen(mPoint);
+    private void locatePositionInWindow() {
+        getLocationInWindow(mPoint);
 
         ViewParent parent = getParent();
         if (parent != null && parent instanceof View && ((View) parent).getMeasuredWidth() > 0) {
@@ -1071,7 +1071,7 @@
         if (isHideBubble)
             return;
 
-        locatePositionOnScreen();
+        locatePositionInWindow();
 
         if (mBubbleView.getParent() != null) {
             if (isAlwaysShowBubble) {",0
jdbc 驱动 bug," 		}
 		
 		if (!StringUtils.startsWithIgnoreCase(url, PREFIX)) {	
-			throw new IllegalArgumentException(""uri needs to start with "" + PREFIX);//return null;
+			return null;//throw new IllegalArgumentException(""uri needs to start with "" + PREFIX);//return null;
 		}
 		String uri=url;
         uri = uri.substring(PREFIX.length());
@@ -87,10 +87,10 @@
 	@Override
 	public boolean acceptsURL(String url) throws SQLException {
 		if (!StringUtils.startsWithIgnoreCase(url, PREFIX)) {
-			return true;
-		}
 		return false;
 	}
+		return true;
+	}
 	
 	@Override
 	public DriverPropertyInfo[] getPropertyInfo(String url, Properties info)",0
Fix bug when changing TimeZone of the device," import java.util.Calendar;
 import java.util.Collection;
 import java.util.List;
+import java.util.TimeZone;
 
 import static com.prolificinteractive.materialcalendarview.MaterialCalendarView.SHOW_DEFAULTS;
 import static com.prolificinteractive.materialcalendarview.MaterialCalendarView.showOtherMonths;
@@ -27,6 +28,7 @@
     protected static final int DEFAULT_MAX_WEEKS = 6;
     protected static final int DAY_NAMES_ROW = 1;
     private static final Calendar tempWorkingCalendar = CalendarUtils.getInstance();
+    private static final String TIME_ZONE_DEFAULT = ""UTC"";
     private final ArrayList<WeekDayView> weekDayViews = new ArrayList<>();
     private final ArrayList<DecoratorResult> decoratorResults = new ArrayList<>();
     @ShowOtherDates
@@ -50,6 +52,15 @@
         this.firstDayOfWeek = firstDayOfWeek;
         this.showWeekDays = showWeekDays;
 
+        /*
+        *   Set the defaultTimeZone to avoid wrong calculations that are positioning the last day of the
+        *   previous month on the first day of the current month when changing the TimeZone of the device
+        *
+        *   It's recommended that when manipulating Date objects that TimeZone could change according to
+        *   device configuration to use a default TimeZone to do the calculations.
+        */
+        TimeZone.setDefault(TimeZone.getTimeZone(TIME_ZONE_DEFAULT));
+
         setClipChildren(false);
         setClipToPadding(false);
 ",0
Fix S3Producer," import org.apache.camel.Exchange;
 import org.apache.camel.Message;
 import org.apache.camel.WrappedFile;
-import org.apache.camel.component.aws.ec2.EC2Constants;
 import org.apache.camel.impl.DefaultProducer;
 import org.apache.camel.util.CastUtils;
 import org.apache.camel.util.FileUtil;
@@ -313,7 +312,7 @@
     }
     
     private S3Operations determineOperation(Exchange exchange) {
-        S3Operations operation = exchange.getIn().getHeader(EC2Constants.OPERATION, S3Operations.class);
+        S3Operations operation = exchange.getIn().getHeader(S3Constants.S3_OPERATION, S3Operations.class);
         if (operation == null) {
             operation = getConfiguration().getOperation();
         }",0
Fix code inspection results discussed in #67  - UrlShortener.java," import java.net.MalformedURLException;
 import java.net.URL;
 import java.util.concurrent.ExecutionException;
+import android.util.Log;
 
 /**
  * This class shortens urls and also expands those short urls
@@ -51,7 +52,7 @@
   public static String shortenUrl(String longUrl) {
     String shortUrl = null;
     try {
-      shortUrl = (String) new ShortenUrlTask().execute(longUrl).get();
+      shortUrl = new ShortenUrlTask().execute(longUrl).get();
     } catch (InterruptedException | ExecutionException e) {
       e.printStackTrace();
     }
@@ -62,16 +63,19 @@
    * Create a google url shortener interface object
    * and make a request to shorten the given url
    */
-  private static class ShortenUrlTask extends AsyncTask {
+  private static class ShortenUrlTask extends AsyncTask<String, Void, String> {
     @Override
-    protected String doInBackground(Object[] params) {
-      String longUrl = (String) params[0];
+    protected String doInBackground(String[] params) {
+      String longUrl = params[0];
       Urlshortener urlshortener = createGoogleUrlShortener();
       Url url = new Url();
       url.setLongUrl(longUrl);
       try {
         Url response = urlshortener.url().insert(url).execute();
+        //avoid possible NPE
+        if (response != null) {
         return response.getId();
+        }
       } catch (IOException e) {
         e.printStackTrace();
       }
@@ -117,36 +121,29 @@
   public static String lengthenShortUrl(String shortUrl) {
     String longUrl = null;
     try {
-      longUrl = (String) new LengthenShortUrlTask().execute(shortUrl).get();
+      longUrl = new LengthenShortUrlTask().execute(shortUrl).get();
     } catch (InterruptedException | ExecutionException e) {
       e.printStackTrace();
     }
     return longUrl;
   }
 
-  private static class LengthenShortUrlTask extends AsyncTask {
+  private static class LengthenShortUrlTask extends AsyncTask<String, Void, String> {
     @Override
-    protected String doInBackground(Object[] params) {
-      String shortUrl = (String) params[0];
-      String longUrl;
-      URL url = null;
+    protected String doInBackground(String[] params) {
+      String shortUrl = params[0];
       try {
-        url = new URL(shortUrl);
+        URL url = new URL(shortUrl);
+        HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection();
+        httpURLConnection.setInstanceFollowRedirects(false);
+        String longUrl = httpURLConnection.getHeaderField(""location"");
+        return (longUrl != null) ? longUrl : shortUrl;
       } catch (MalformedURLException e) {
-        e.printStackTrace();
-      }
-      HttpURLConnection httpURLConnection = null;
-      try {
-        httpURLConnection = (HttpURLConnection) url.openConnection();
+        Log.w(TAG, ""Malformed URL: "" + shortUrl);
       } catch (IOException e) {
         e.printStackTrace();
       }
-      httpURLConnection.setInstanceFollowRedirects(false);
-      longUrl = httpURLConnection.getHeaderField(""location"");
-      if (longUrl == null) {
-        longUrl = shortUrl;
-      }
-      return longUrl;
+      return null;
     }
   }
 }",0
"bringback ""Fix: SignleTop launch mode"""""," 					}
 				}
 			} break;
+			case ONLY_TOP : {
+				marked = false;
+			} break;
 		}
 
 		return marked;
@@ -239,8 +242,9 @@
 
 		switch (info.launchMode) {
 			case LAUNCH_SINGLE_TOP : {
-				clearTop = false;
-				clearTarget = ClearTarget.AFTER_TOP;
+				if (!clearTop) {
+					clearTarget = ClearTarget.ONLY_TOP;
+				}
 				if (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {
 					reuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
 							? ReuseTarget.MULTIPLE
@@ -594,7 +598,9 @@
 		NOTHING,
 		SPEC_ACTIVITY,
 		FULL_TASK(true),
-		AFTER_TOP(true);
+		AFTER_TOP(true),
+		ONLY_TOP(true);
+
 		boolean deliverIntent;
 
 		ClearTarget() {",0
Fix Bullet Nesting in CONTRIBUTING.md," package org.zaproxy.zap.extension.api;
 
 import java.io.BufferedWriter;
+import java.io.File;
 import java.io.IOException;
 import java.io.Writer;
 import java.nio.charset.Charset;
@@ -21,7 +22,7 @@
 
 	private final String HEADER = ""// Zed Attack Proxy (ZAP) and its related class files.\n"" + ""//\n""
 			+ ""// ZAP is an HTTP/HTTPS proxy for assessing web application security.\n"" + ""//\n""
-			+ ""// Copyright 2016 the ZAP development team\n"" + ""//\n""
+			+ ""// Copyright 2017 the ZAP development team\n"" + ""//\n""
 			+ ""// Licensed under the Apache License, Version 2.0 (the \""License\"");\n""
 			+ ""// you may not use this file except in compliance with the License.\n""
 			+ ""// You may obtain a copy of the License at\n"" + ""//\n""
@@ -69,7 +70,8 @@
 		String className = imp.getPrefix().substring(0, 1).toUpperCase() + imp.getPrefix().substring(1);
 		String pkgName = safeName(camelCaseToLowerCaseDash(className));
 
-		Path file = getDirectory().resolve(pkgName + "".go"");
+		Path file = getDirectory().resolve(pkgName + ""_generated.go"");
+		createDirAndFile(file);
 		System.out.println(""Generating "" + file.toAbsolutePath());
 		try (BufferedWriter out = Files.newBufferedWriter(file, StandardCharsets.UTF_8)) {
 			out.write(HEADER);
@@ -78,7 +80,7 @@
 			out.write(""//\n\n"");
 			out.write(""package zap\n\n"");
 			out.write(""_imports_"");
-			out.write(""type "" + className + "" struct {}"" + ""\n\n"");
+			out.write(""type "" + className + "" struct {\n\tc *Client\n}"" + ""\n\n"");
 
 			for (ApiElement view : imp.getApiViews()) {
 				this.generateGoElement(view, className, imp.getPrefix(), VIEW_ENDPOINT, out);
@@ -146,7 +148,7 @@
 		if (typeOther) {
 			out.write("" ([]byte, error) "");
 		} else {
-			out.write("" (interface{}, error) "");
+			out.write("" (map[string]interface{}, error) "");
 		}
 		out.write(""{\n"");
 
@@ -163,7 +165,7 @@
 			out.write(""\n\t}\n"");
 		}
 
-		String method = ""Request"";
+		String method = className.substring(0, 1).toLowerCase()+"".c.Request"";
 		if (typeOther) {
 			method += ""Other"";
 		}
@@ -171,11 +173,26 @@
 
 		if (hasParams) {
 			out.write("", m"");
+		} else {
+			out.write("", nil"");
 		}
 		out.write("")\n"");
 		out.write(""}\n\n"");
 	}
 
+	// create dir/files if not exist
+	private void createDirAndFile(Path path) throws IOException {
+			// create dir and file first if dir/file not exist
+			File file = new File(path.toAbsolutePath().toString());
+			File dir = file.getParentFile();
+			if (dir != null && !dir.exists()) {
+				dir.mkdirs();
+			}
+			if (!file.exists()) {
+				file.createNewFile();
+			}
+	}
+
 	// Writes the function arguments
 	private void writeOutArgs(List<String> elements, Writer out, boolean hasParams) throws IOException {
 		if (elements != null && elements.size() > 0) {",0
Fix for #1806," import org.terasology.naming.Name;
 import org.terasology.world.block.BlockPart;
 import org.terasology.world.block.family.FreeformBlockFamilyFactory;
+import org.terasology.world.block.sounds.BlockSounds;
 import org.terasology.world.block.tiles.BlockTile;
 
 import java.io.IOException;
@@ -77,6 +78,7 @@
             for (BlockPart part : BlockPart.values()) {
                 data.getBaseSection().getBlockTiles().put(part, blockTile.get());
             }
+            data.getBaseSection().setSounds(assetManager.getAsset(""engine:default"", BlockSounds.class).get());
             data.setFamilyFactory(freeformBlockFamilyFactory);
             return Optional.of(data);
         }",0
Fix workspace leak in ActivationRReLU," 
 import lombok.EqualsAndHashCode;
 import lombok.Getter;
+import org.nd4j.linalg.api.memory.MemoryWorkspace;
 import org.nd4j.linalg.primitives.Pair;
 import org.nd4j.linalg.activations.BaseActivationFunction;
 import org.nd4j.linalg.api.ndarray.INDArray;
@@ -45,7 +46,9 @@
     @Override
     public INDArray getActivation(INDArray in, boolean training) {
         if (training) {
+            try(MemoryWorkspace ws = Nd4j.getWorkspaceManager().scopeOutOfWorkspaces()) {
             this.alpha = Nd4j.rand(in.shape(), l, u, Nd4j.getRandom());
+            }
             INDArray inTimesAlpha = in.mul(alpha);
             BooleanIndexing.replaceWhere(in, inTimesAlpha, Conditions.lessThan(0));
         } else {",0
fix scan without seed javadoc," 	 * <br>
 	 * The accumulation works as follows:
 	 * <pre><code>
-	 * result[0] = accumulator(source[0], source[1])
-	 * result[1] = accumulator(result[0], source[2])
-	 * result[2] = accumulator(result[1], source[3])
+	 * result[0] = source[0]
+	 * result[1] = accumulator(result[0], source[1])
+	 * result[2] = accumulator(result[1], source[2])
+	 * result[3] = accumulator(result[2], source[3])
 	 * ...
 	 * </code></pre>
 	 *",0
MacOSX: CMD+SHIFT-LEFT/RIGHT selects the entire line. Fixes #3238,"   public SketchTextAreaDefaultInputMap() {
     int defaultModifier = getDefaultModifier();
     int alt = InputEvent.ALT_MASK;
+    int shift = InputEvent.SHIFT_MASK;
     boolean isOSX = RTextArea.isOSX();
     int moveByWordMod = isOSX ? alt : defaultModifier;
 
@@ -38,10 +39,16 @@
       put(KeyStroke.getKeyStroke(KeyEvent.VK_UP, defaultModifier), DefaultEditorKit.beginAction);
       put(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, defaultModifier), DefaultEditorKit.endAction);
 
+      put(KeyStroke.getKeyStroke(KeyEvent.VK_LEFT, defaultModifier | shift), DefaultEditorKit.selectLineAction);
+      put(KeyStroke.getKeyStroke(KeyEvent.VK_RIGHT, defaultModifier | shift), DefaultEditorKit.selectLineAction);
+
       remove(KeyStroke.getKeyStroke(KeyEvent.VK_J, defaultModifier));
 
       put(KeyStroke.getKeyStroke(KeyEvent.VK_OPEN_BRACKET, defaultModifier), DefaultEditorKit.insertTabAction);
       put(KeyStroke.getKeyStroke(KeyEvent.VK_CLOSE_BRACKET, defaultModifier), RSyntaxTextAreaEditorKit.rstaDecreaseIndentAction);
+
+      put(KeyStroke.getKeyStroke(KeyEvent.VK_UP, defaultModifier | shift), DefaultEditorKit.selectionBeginAction);
+      put(KeyStroke.getKeyStroke(KeyEvent.VK_DOWN, defaultModifier | shift), DefaultEditorKit.selectionEndAction);
     }
 
     put(KeyStroke.getKeyStroke(KeyEvent.VK_DIVIDE, defaultModifier), RSyntaxTextAreaEditorKit.rstaToggleCommentAction);",0
fix misuse of glDeleteBuffer for glDeleteRenderBuffer in dispose," 		disposeColorTexture(colorTexture);
 
 		if (hasDepthStencilPackedBuffer) {
-			gl.glDeleteBuffer(depthStencilPackedBufferHandle);
+			gl.glDeleteRenderbuffer(depthStencilPackedBufferHandle);
 		} else {
 			if (hasDepth) gl.glDeleteRenderbuffer(depthbufferHandle);
 			if (hasStencil) gl.glDeleteRenderbuffer(stencilbufferHandle);",0
FIX bug when ActivityInfo null can not be  initialized," 		} else {
 			activityInfo = resolveActivityInfo(intent.getComponent(), userId);
 		}
-		return new ActivityInfo(activityInfo);
+		return activityInfo != null ? new ActivityInfo(activityInfo) : null;
 	}
 
 	public ActivityInfo resolveActivityInfo(ComponentName componentName, int userId) {",0
fix for last path in tabs,"         getSortModes();
         home = Sp.getString(""home"", System.getenv(""EXTERNAL_STORAGE""));
         this.setRetainInstance(false);
-        String path=content.get(0).getPath();
+        int pos = Sp.getInt(""spinner_selected"", 0);
+        String path=content.get(pos).getPath();
         File f;
         if(path!=null)f=new File(path);
         else
@@ -319,7 +320,6 @@
                 }
             }
 
-            int pos = Sp.getInt(""spinner_selected"", 0);
             mainActivity.tabsSpinner.setAdapter(tabSpinnerAdapter);
             mainActivity.tabsSpinner.setSelection(pos);
 ",0
Fixed #1428. Made the getConstructor generic,"     public static AsyncHttpClient getAsyncHttpClient(AsyncHttpClientConfig config) {
         if (attemptInstantiation()) {
             try {
-                Constructor<AsyncHttpClient> constructor = asyncHttpClientImplClass.getConstructor(DefaultAsyncHttpClientConfig.class);
+                Constructor<AsyncHttpClient> constructor = asyncHttpClientImplClass.getConstructor(AsyncHttpClientConfig.class);
                 return constructor.newInstance(config);
             } catch (Exception e) {
                 throw new AsyncHttpClientImplException(""Unable to find the instantiate the class specified by system property : """,0
Set correct foreground colour on checkboxtree node," import javax.swing.JPanel;
 import javax.swing.JScrollPane;
 import javax.swing.JTree;
+import javax.swing.UIManager;
 import javax.swing.tree.DefaultMutableTreeNode;
 import javax.swing.tree.DefaultTreeModel;
 import javax.swing.tree.DefaultTreeSelectionModel;
@@ -181,6 +182,7 @@
             	checkBox.setEnabled(false);
             }
             altLabel.setText(textRepresentation);
+            altLabel.setForeground(UIManager.getColor(selected ? ""Tree.selectionForeground"" : ""Tree.textForeground""));
 
             return this;
         }       ",0
Bugfix: Missing '@Override' annotation on 'customizePropertySources()',"     @Bean(name = BASE_PACKAGES_PROPERTY_RESOLVER_BEAN_NAME)
     public PropertyResolver dubboScanBasePackagesPropertyResolver(ConfigurableEnvironment environment) {
         ConfigurableEnvironment propertyResolver = new AbstractEnvironment() {
+            @Override
             protected void customizePropertySources(MutablePropertySources propertySources) {
                 Map<String, Object> dubboScanProperties = PropertySourcesUtils.getSubProperties(environment, DUBBO_SCAN_PREFIX);
                 propertySources.addLast(new MapPropertySource(""dubboScanProperties"", dubboScanProperties));",0
Fix name of test project in its config,"     InputStream in = getClass().getResourceAsStream(""/templates/project/"" + template);
     String json = IoUtil.readAndCloseQuietly(in);
 
-    String url = getWsAgentUrl(workspaceId);
     ProjectConfigDto project = getInstance().createDtoFromJson(json, ProjectConfigDto.class);
+    project.setName(projectName);
 
+    String url = getWsAgentUrl(workspaceId);
     requestFactory
         .fromUrl(url + ""/"" + projectName)
         .usePutMethod()",0
Search synonyms could be splitting the characters incorrectly,"     }
     @Override
     public String[] getSynonyms() {
-        return synonyms.split(""|"");
+        return synonyms.split(""\\|"");
     }
     @Override
     public void setSynonyms(String[] synonyms) {",0
OrderMultishipOption's OrderItem's children aren't added to fulfillment groups,"                 order.getFulfillmentGroups().add(fg);
             }
 
+            // Build a list of all order items associated with this OrderMultishipOption
+            // This is necessary because an order item may have child items associated
+            List<OrderItem> fgItemOrderItems = new ArrayList<>();
+            fgItemOrderItems.add(option.getOrderItem());
+            fgItemOrderItems.addAll(option.getOrderItem().getChildOrderItems());
+
+            for (OrderItem orderItem : fgItemOrderItems) {
             // See if there is a fulfillment group item that matches this OrderMultishipOption
             // OrderItem request
             FulfillmentGroupItem fulfillmentGroupItem = null;
             for (FulfillmentGroupItem fgi : fg.getFulfillmentGroupItems()) {
-                if (fgi.getOrderItem().getId().equals(option.getOrderItem().getId())) {
+                    if (fgi.getOrderItem().getId().equals(orderItem.getId())) {
                     fulfillmentGroupItem = fgi;
                 }
             }
@@ -353,20 +360,10 @@
             if (fulfillmentGroupItem == null) {
                 fulfillmentGroupItem = fulfillmentGroupItemDao.create();
                 fulfillmentGroupItem.setFulfillmentGroup(fg);
-                fulfillmentGroupItem.setOrderItem(option.getOrderItem());
+                    fulfillmentGroupItem.setOrderItem(orderItem);
                 fulfillmentGroupItem.setQuantity(1);
                 fulfillmentGroupItem = fulfillmentGroupItemDao.save(fulfillmentGroupItem);
                 fg.getFulfillmentGroupItems().add(fulfillmentGroupItem);
-
-                // Do the same for any child order items (add-ons)
-                for (OrderItem childItem : option.getOrderItem().getChildOrderItems()) {
-                    FulfillmentGroupItem childFulfillmentGroupItem = fulfillmentGroupItemDao.create();
-                    childFulfillmentGroupItem.setFulfillmentGroup(fg);
-                    childFulfillmentGroupItem.setOrderItem(childItem);
-                    childFulfillmentGroupItem.setQuantity(1);
-                    childFulfillmentGroupItem = fulfillmentGroupItemDao.save(childFulfillmentGroupItem);
-                    fg.getFulfillmentGroupItems().add(childFulfillmentGroupItem);
-                }
             } else {
                 // There are three potential scenarios where a fulfillment group item exists:
                 //   1: It has been previously created and exists in the database and
@@ -396,6 +393,7 @@
                     fulfillmentGroupItem.setQuantity(fulfillmentGroupItem.getQuantity() + 1);
                 }
             }
+            }
 
             multishipGroups.put(key, fg);
         }",0
Fixes double allocation," 			
 			for (int y = margin; y <= stopHeight; y += tileheight + spacing) {
 				for (int x = margin; x <= stopWidth; x += tilewidth + spacing) {
-					TextureRegion tileRegion = new TextureRegion(new TextureRegion(texture, x, y, tilewidth, tileheight));
+					TextureRegion tileRegion = new TextureRegion(texture, x, y, tilewidth, tileheight);
 					if (!yUp) {
 						tileRegion.flip(false, true);
 					}",0
Hack to fix when app is stuck on the splash screen.,"     @Nullable
     private PermissionListener mPermissionListener;
 
+    boolean killedBySystem = false;
+
     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         if (!NavigationApplication.instance.getReactGateway().hasStartedCreatingContext() ||
                 getIntent() == null ||
                 getIntent().getBundleExtra(""ACTIVITY_PARAMS_BUNDLE"") == null) {
+            killedBySystem = true;
             SplashActivity.start(this);
             finish();
             return;
@@ -196,6 +199,10 @@
     }
 
     private void destroyJsIfNeeded() {
+        if ( killedBySystem ) {
+            return;
+        }
+
         if (currentActivity == null || currentActivity.isFinishing()) {
             getReactGateway().onDestroyApp(this);
         }",0
Fix index set overview with closed indices,"         final List<String> indexNames = new ArrayList<>();
         indexStats.fieldNames().forEachRemaining(indexNames::add);
         final Map<String, Boolean> areReopened = indices.areReopened(indexNames);
-        final Map<String, IndexSummary> indicesSummaries = buildIndexSummaries(deflectorSummary, indexRanges, indexStats, areReopened);
-
-        indices.getClosedIndices(indexSet).forEach(indexName -> indicesSummaries.put(indexName, IndexSummary.create(
-                null,
-                indexRanges.stream().filter((indexRangeSummary) -> indexRangeSummary.indexName().equals(indexName)).findFirst().orElse(null),
-                indexName.equals(deflectorSummary.currentTarget()),
-                true,
-                false
-        )));
+        final Map<String, IndexSummary> indicesSummaries = buildIndexSummaries(deflectorSummary, indexSet, indexRanges, indexStats, areReopened);
 
         return IndexerOverview.create(deflectorSummary,
                 IndexerClusterOverview.create(indexerClusterResource.clusterHealth(), indexerClusterResource.clusterName().name()),
                 countResource.total(indexSetId), indicesSummaries);
     }
 
-    private Map<String, IndexSummary> buildIndexSummaries(DeflectorSummary deflectorSummary, List<IndexRangeSummary> indexRanges, JsonNode indexStats, Map<String, Boolean> areReopened) {
+    private Map<String, IndexSummary> buildIndexSummaries(DeflectorSummary deflectorSummary, IndexSet indexSet, List<IndexRangeSummary> indexRanges, JsonNode indexStats, Map<String, Boolean> areReopened) {
         final Iterator<Map.Entry<String, JsonNode>> fields = indexStats.fields();
         final ImmutableMap.Builder<String, IndexSummary> indexSummaries = ImmutableMap.builder();
         while (fields.hasNext()) {
@@ -146,6 +138,13 @@
             indexSummaries.put(entry.getKey(), buildIndexSummary(entry, indexRanges, deflectorSummary, areReopened));
 
         }
+        indices.getClosedIndices(indexSet).forEach(indexName -> indexSummaries.put(indexName, IndexSummary.create(
+                null,
+                indexRanges.stream().filter((indexRangeSummary) -> indexRangeSummary.indexName().equals(indexName)).findFirst().orElse(null),
+                indexName.equals(deflectorSummary.currentTarget()),
+                true,
+                false
+        )));
         return indexSummaries.build();
     }
 ",0
Library debug,"     rescanLibraryIndex(progress);
   }
 
-  public void install(ContributedLibrary lib, ContributedLibrary replacedLib) throws Exception {
+  public void install(ContributedLibrary lib, ContributedLibrary replacedLib) {
     if (lib.isInstalled()) {
-      throw new Exception(_(""Library is already installed!""));
+      System.out.println(_(""Library is already installed: \"""" + lib.getName() + ""\""""));
+      return;
     }
 
     final MultiStepProgress progress = new MultiStepProgress(3);
 
     // Step 1: Download library
     try {
-      downloader.download(lib, progress, _(""Downloading library.""));
+      downloader.download(lib, progress, _(""Downloading library: \"""" + lib.getName() + ""\""""));
     } catch (InterruptedException e) {
       // Download interrupted... just exit
       return;
@@ -117,7 +118,7 @@
     // all the temporary folders and abort installation.
 
     // Step 2: Unpack library on the correct location
-    progress.setStatus(_(""Installing library...""));
+    progress.setStatus(_(""Installing library: \"""" + lib.getName() + ""\""""));
     onProgress(progress);
     File libsFolder = indexer.getSketchbookLibrariesFolder();
     File tmpFolder = FileUtils.createTempFolderIn(libsFolder);
@@ -148,7 +149,7 @@
     final MultiStepProgress progress = new MultiStepProgress(2);
 
     // Step 1: Remove library
-    progress.setStatus(_(""Removing library...""));
+    progress.setStatus(_(""Removing library: \"""" + lib.getName() + ""\""""));
     onProgress(progress);
     FileUtils.recursiveDelete(lib.getInstalledFolder());
     progress.stepDone();",0
Fix typo for DOM.attributeModified,"       message.nodeId = mDocument.getNodeIdForElement(element);
       message.name = name;
       message.value = value;
-      mPeerManager.sendNotificationToPeers(""DOM.onAttributeModified"", message);
+      mPeerManager.sendNotificationToPeers(""DOM.attributeModified"", message);
     }
 
     public void onAttributeRemoved(Object element, String name) {",0
Fix : Unique constraint violation issue,"             }
         }
 
-        db.insert(tableName, null, contentValues);
-        updateRowResponse.isSuccessful = true;
+        long result = db.insert(tableName, null, contentValues);
+        updateRowResponse.isSuccessful = result > 0;
+
         return updateRowResponse;
 
     }",0
fix: visible string 'spacer' in about dialog when using Nimbus LAF," package com.tagtraum.perf.gcviewer;
 
+import com.tagtraum.perf.gcviewer.util.BuildInfoReader;
+import com.tagtraum.perf.gcviewer.util.LocalisationHelper;
+import com.tagtraum.perf.gcviewer.util.UrlDisplayHelper;
 import java.awt.Color;
 import java.awt.Dimension;
 import java.awt.FlowLayout;
 import java.awt.Frame;
 import java.awt.GridBagConstraints;
 import java.awt.GridBagLayout;
+import java.awt.Insets;
 import java.awt.Panel;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-
 import javax.swing.BorderFactory;
 import javax.swing.ImageIcon;
 import javax.swing.JButton;
@@ -19,10 +22,6 @@
 import javax.swing.plaf.basic.BasicHTML;
 import javax.swing.text.View;
 
-import com.tagtraum.perf.gcviewer.util.BuildInfoReader;
-import com.tagtraum.perf.gcviewer.util.LocalisationHelper;
-import com.tagtraum.perf.gcviewer.util.UrlDisplayHelper;
-
 /**
  * About dialog showing version and contributors information.
  * 
@@ -32,13 +31,8 @@
 public class AboutDialog extends ScreenCenteredDialog implements ActionListener {
 
     private static final String GCVIEWER_HOMEPAGE = ""https://github.com/chewiebug/gcviewer/wiki"";
-
-    private static final String ACTION_OK = ""ok"";
     private static final String ACTION_HOMEPAGE = ""homepage"";
     
-    private JButton homePageButton;
-    private JButton okButton;
-    
     private static final String[] CONTRIBUTORS = {
         ""Hans Bausewein"",
         ""Peter Bilstein"",
@@ -80,42 +74,41 @@
         JLabel version = new JLabel(""<html><font color=\""gray\"">version:</font> "" + BuildInfoReader.getVersion() + ""</html>"", JLabel.CENTER);
         JLabel buildDate = new JLabel(""<html><font color=\""gray\"">build date:</font> "" + BuildInfoReader.getBuildDate() + ""</html>"", JLabel.CENTER);
         
-        JLabel spacer1 = new JLabel(""spacer"");
-        spacer1.setForeground(getBackground());
-        JLabel spacer2 = new JLabel(""spacer"");
-        spacer2.setForeground(getBackground());
-
         GridBagConstraints gridBagConstraints = new GridBagConstraints();
         gridBagConstraints.anchor = GridBagConstraints.NORTH;
         gridBagConstraints.fill = GridBagConstraints.VERTICAL;
         gridBagConstraints.gridx = 0;
 
+        Insets insetsGapOnTop = new java.awt.Insets(10, 0, 0, 0);
+        GridBagConstraints gridBagConstraintsGapOnTop = new GridBagConstraints();
+
         versionPanel.add(copyright, gridBagConstraints);
-        gridBagConstraints.gridy = 1;
-        versionPanel.add(spacer1, gridBagConstraints);
+
+        gridBagConstraintsGapOnTop.gridy = 1;
+        gridBagConstraintsGapOnTop.insets = insetsGapOnTop;
+        versionPanel.add(contributorsLabel, gridBagConstraintsGapOnTop);
+
         gridBagConstraints.gridy = 2;
-        versionPanel.add(contributorsLabel, gridBagConstraints);
-        gridBagConstraints.gridy = 3;
         gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;
         versionPanel.add(contributors, gridBagConstraints);
-        gridBagConstraints.gridy = 4;
         gridBagConstraints.fill = GridBagConstraints.VERTICAL;
-        versionPanel.add(spacer2, gridBagConstraints);
-        gridBagConstraints.gridy = 5;
-        versionPanel.add(version, gridBagConstraints);
-        gridBagConstraints.gridy = 6;
+
+        gridBagConstraintsGapOnTop.gridy = 3;
+        versionPanel.add(version, gridBagConstraintsGapOnTop);
+
+        gridBagConstraints.gridy = 4;
         versionPanel.add(buildDate, gridBagConstraints);
         
         Panel buttonPanel = new Panel();
         buttonPanel.setLayout(new FlowLayout(FlowLayout.CENTER));
         if (UrlDisplayHelper.displayUrlIsSupported()) {
-            homePageButton = new JButton(""Homepage"");
+        JButton homePageButton = new JButton(""Homepage"");
             homePageButton.setActionCommand(ACTION_HOMEPAGE);
             homePageButton.addActionListener(this);
             buttonPanel.add(homePageButton);
         }
 
-        okButton = new JButton(LocalisationHelper.getString(""button_ok""));
+        JButton okButton = new JButton(LocalisationHelper.getString(""button_ok""));
         okButton.setActionCommand(ACTION_OK);
         okButton.addActionListener(this);
         buttonPanel.add(okButton);
@@ -160,6 +153,7 @@
                 (int) Math.ceil(h));
     }
 
+    @Override
     public void actionPerformed(ActionEvent e) {
         if (ACTION_HOMEPAGE.equals(e.getActionCommand())) {
             UrlDisplayHelper.displayUrl(this, GCVIEWER_HOMEPAGE);",0
Fixed initialization order of acknowledgmentsGroupingTracker in ConsumerImpl,"         this.readCompacted = conf.isReadCompacted();
         this.subscriptionInitialPosition = conf.getSubscriptionInitialPosition();
 
-        TopicName topicName = TopicName.get(topic);
-        if (topicName.isPersistent()) {
-            this.acknowledgmentsGroupingTracker =
-                new PersistentAcknowledgmentsGroupingTracker(this, conf, client.eventLoopGroup());
-        } else {
-            this.acknowledgmentsGroupingTracker =
-                NonPersistentAcknowledgmentGroupingTracker.of();
-        }
-
         if (client.getConfiguration().getStatsIntervalSeconds() > 0) {
             stats = new ConsumerStatsRecorderImpl(client, conf, this);
         } else {
@@ -203,6 +194,15 @@
             new Backoff(100, TimeUnit.MILLISECONDS, 60, TimeUnit.SECONDS, 0, TimeUnit.MILLISECONDS),
             this);
 
+        TopicName topicName = TopicName.get(topic);
+        if (topicName.isPersistent()) {
+            this.acknowledgmentsGroupingTracker =
+                new PersistentAcknowledgmentsGroupingTracker(this, conf, client.eventLoopGroup());
+        } else {
+            this.acknowledgmentsGroupingTracker =
+                NonPersistentAcknowledgmentGroupingTracker.of();
+        }
+
         grabCnx();
     }
 ",0
Fix ComputationGraph.score,"      * Set the specified input for the ComputationGraph
      */
     public void setInput(int inputNum, INDArray input) {
+        if(inputs == null){
+            //May be null after clear()
+            inputs = new INDArray[numInputArrays];
+        }
         inputs[inputNum] = input;
     }
 
@@ -1763,6 +1767,7 @@
             setLayerMaskArrays(dataSet.getFeaturesMaskArrays(), dataSet.getLabelsMaskArrays());
         }
 
+        double score = 0.0;
         MemoryWorkspace workspace = configuration.getTrainingWorkspaceMode() == WorkspaceMode.NONE ? dummy : Nd4j.getWorkspaceManager().getWorkspaceForCurrentThread(workspaceConfigurationExternal,workspaceExternal);
         try (MemoryWorkspace ws = workspace.notifyScopeEntered()) {
 
@@ -1774,7 +1779,6 @@
             double l1 = calcL1();
             double l2 = calcL2();
 
-            double score = 0.0;
             int i = 0;
             for (String s : configuration.getNetworkOutputs()) {
                 Layer outLayer = verticesMap.get(s).getLayer();",0
Epic bug was fixed," 	 */
 	@Override
 	public float[] convertLocalToSceneCoordinates(final float[] pCoordinates) {
-		return this.convertSceneToLocalCoordinates(pCoordinates, Entity.VERTICES_LOCAL_TO_SCENE_TMP);
+		return this.convertLocalToSceneCoordinates(pCoordinates, Entity.VERTICES_LOCAL_TO_SCENE_TMP);
 	}
 
 	/* (non-Javadoc)",0
Fix JavaDoc Typo,"     }
     
     /**
-     * Inner methid to check if the current parameter should be excluded
+     * Inner method to check if the current parameter should be excluded
      * @param param the param object
      * @return true if it need to be excluded
      */",0
Also cleanup input metrics if an input is stopped.," 
     public void stop() {
         transport.stop();
+        cleanupMetrics();
     }
 
     public void terminate() {
+        cleanupMetrics();
+    }
+
+    private void cleanupMetrics() {
         if (localRegistry != null && localRegistry.getMetrics() != null)
             for (String metricName : localRegistry.getMetrics().keySet())
                 metricRegistry.remove(getUniqueReadableId() + ""."" + metricName);
@@ -183,8 +188,6 @@
         return descriptor;
     }
 
-    ;
-
     public String getName() {
         return descriptor.getName();
     }",0
[3.6] ILock expiry operation should be able run both owner and backup,"         try {
             submit(operation, key);
         } catch (Throwable t) {
-            ILogger logger = nodeEngine.getLogger(getClass());
             logger.warning(t);
         }
     }
@@ -77,6 +76,7 @@
         OperationAccessor.setCallerAddress(operation, nodeEngine.getThisAddress());
         operation.setCallerUuid(nodeEngine.getLocalMember().getUuid());
         operation.setOperationResponseHandler(unlockResponseHandler);
+        operation.setValidateTarget(false);
         operation.setAsyncBackup(true);
 
         operationService.executeOperation(operation);",0
Regression: fixed wrong BUILTIN_AS_LAST comparator,"   public static final Comparator<ContributedPlatform> BUILTIN_AS_LAST = (x, y) -> {
     int px = x.isBuiltIn() ? 1 : -1;
     int py = y.isBuiltIn() ? 1 : -1;
-    return py - px;
+    return px - py;
   };
 
   private Map<ContributedToolReference, ContributedTool> resolvedToolReferences;",0
Hot/Cold clue near Fishing tutor location fix," 	KARAMJA_KHARAZI_SW(new WorldPoint(2783, 2898, 0), KARAMJA, ""South-western part of Kharazi Jungle.""),
 	KARAMJA_CRASH_ISLAND(new WorldPoint(2910, 2737, 0), KARAMJA, ""Northern part of Crash Island.""),
 	MISTHALIN_VARROCK_STONE_CIRCLE(new WorldPoint(3225, 3355, 0), MISTHALIN, ""South of the stone circle near Varrock's entrance.""),
-	MISTHALIN_LUMBRIDGE(new WorldPoint(3240, 3163, 0), MISTHALIN, ""Just north-west of the Lumbridge Fishing tutor.""),
+	MISTHALIN_LUMBRIDGE(new WorldPoint(3238, 3166, 0), MISTHALIN, ""Just north-west of the Lumbridge Fishing tutor.""),
 	MISTHALIN_LUMBRIDGE_2(new WorldPoint(3170, 3278, 0), MISTHALIN, ""North of the pond between Lumbridge and Draynor Village.""),
 	MISTHALIN_GERTUDES(new WorldPoint(3158, 3421, 0), MISTHALIN, ""Nort-east of Gertrude's house west of Varrock.""),
 	MISTHALIN_DRAYNOR_BANK(new WorldPoint(3096, 3235, 0), MISTHALIN, ""South of Draynor Village bank.""),",0
Fix proxy when using JDK provider,"             ProxyServer proxyServer = ProxyUtils.getProxyServer(config, request);
             boolean avoidProxy = ProxyUtils.avoidProxy(proxyServer, uri.getHost());
             if (!avoidProxy) {
-                urlConnection.setRequestProperty(""Connection"", ka);
                 if (proxyServer.getPrincipal() != null) {
                     urlConnection.setRequestProperty(""Proxy-Authorization"", AuthenticatorUtils.computeBasicAuthentication(proxyServer));
                 }",0
TokenStreamRewriter indentation fix," 					System.out.println(""new rop ""+rop);
 				}
 				else if ( !disjoint && !same ) {
-					throw new IllegalArgumentException(""replace op boundaries of ""+rop+
-													   "" overlap with previous ""+prevRop);
+					throw new IllegalArgumentException(""replace op boundaries of ""+rop+"" overlap with previous ""+prevRop);
 				}
 			}
 		}
@@ -558,8 +557,7 @@
 					continue;
 				}
 				if ( iop.index >= rop.index && iop.index <= rop.lastIndex ) {
-					throw new IllegalArgumentException(""insert op ""+iop+
-													   "" within boundaries of previous ""+rop);
+					throw new IllegalArgumentException(""insert op ""+iop+"" within boundaries of previous ""+rop);
 				}
 			}
 		}
@@ -597,5 +595,4 @@
 		}
 		return ops;
 	}
-
 }",0
Close online player overlay before showing death screen,"     public void onPlayerDeath(PlayerDeathEvent event, EntityRef character) {
         EntityRef client = character.getComponent(CharacterComponent.class).controller;
         if (client.getComponent(ClientComponent.class).local) {
+            nuiManager.removeOverlay(""engine:onlinePlayersOverlay"");
             nuiManager.pushScreen(""engine:deathScreen"");
             if (event.damageTypeName != null) {
                 ((DeathScreen) nuiManager.getScreen(""engine:deathScreen"")).setDeathDetails(event.instigatorName, event.damageTypeName);",0
fixed:java.lang.NullPointerException at org.opencloudb.parser.druid.Drui...," 
 		if (value instanceof Object[]) {
 			for (Object item : (Object[]) value) {
+				if(item == null) {
+					continue;
+				}
 				columValues.add(new ColumnRoutePair(item.toString()));
 			}
 		} else if (value instanceof RangeValue) {",0
Quick fix for the visual artifact caused by DirectionalLightsNode,"     @Override
     public void initialise() {
         playerCamera = worldRenderer.getActiveCamera();
-        sceneOpaque = frameBuffersManager.getFBO(""sceneOpaque"");
         lightGeometryShader = worldRenderer.getMaterial(""engine:prog.lightGeometryPass"");
         lightBufferPass = worldRenderer.getMaterial(""engine:prog.lightBufferPass"");
         initMainDirectionalLight();
@@ -83,6 +82,7 @@
     @Override
     public void process() {
         PerformanceMonitor.startActivity(""rendering/directionallights"");
+        sceneOpaque = frameBuffersManager.getFBO(""sceneOpaque"");
         sceneOpaque.bind();
 
         Vector3f sunlightWorldPosition = new Vector3f(backdropProvider.getSunDirection(true));",0
Fix minor gotchas in DOM.resolveNode," import com.facebook.stetho.inspector.jsonrpc.JsonRpcException;
 import com.facebook.stetho.inspector.jsonrpc.JsonRpcPeer;
 import com.facebook.stetho.inspector.jsonrpc.JsonRpcResult;
+import com.facebook.stetho.inspector.jsonrpc.protocol.JsonRpcError;
 import com.facebook.stetho.inspector.protocol.ChromeDevtoolsDomain;
 import com.facebook.stetho.inspector.protocol.ChromeDevtoolsMethod;
 import com.facebook.stetho.json.ObjectMapper;
@@ -123,13 +124,20 @@
       throws JsonRpcException {
     ResolveNodeRequest request = mObjectMapper.convertValue(params, ResolveNodeRequest.class);
     Object object = mObjectIdMapper.getObjectForId(request.nodeId);
+    if (object == null) {
+      throw new JsonRpcException(
+          new JsonRpcError(
+              JsonRpcError.ErrorCode.INVALID_PARAMS,
+              ""No known nodeId="" + request.nodeId,
+              null /* data */));
+    }
 
     int mappedObjectId = Runtime.mapObject(peer, object);
 
     Runtime.RemoteObject remoteObject = new Runtime.RemoteObject();
     remoteObject.type = Runtime.ObjectType.OBJECT;
     remoteObject.subtype = Runtime.ObjectSubType.NODE;
-    remoteObject.className = remoteObject.getClass().getName();
+    remoteObject.className = object.getClass().getName();
     remoteObject.value = null; // not a primitive
     remoteObject.description = null; // not sure what this does...
     remoteObject.objectId = String.valueOf(mappedObjectId);",0
Do not delete types that extensions depend on when cleaning PostgreSql,"         List<Map<String, String>> rows =
                 jdbcTemplate.queryForList(
                         ""select typname, typcategory from pg_catalog.pg_type t ""
+                                + ""left join pg_depend dep on dep.objid = t.oid and dep.deptype = 'e' ""
                                 + ""where (t.typrelid = 0 OR (SELECT c.relkind = 'c' FROM pg_catalog.pg_class c WHERE c.oid = t.typrelid)) and ""
                                 + ""NOT EXISTS(SELECT 1 FROM pg_catalog.pg_type el WHERE el.oid = t.typelem AND el.typarray = t.oid) and ""
-                                + ""t.typnamespace in (select oid from pg_catalog.pg_namespace where nspname = ?)"",
+                                + ""t.typnamespace in (select oid from pg_catalog.pg_namespace where nspname = ?) and ""
+                                + ""dep.objid is null"",
                         name);
 
         List<String> statements = new ArrayList<>();",0
fix: cannot receive direct messages while streaming," 
     @Override
     protected void onDirectMessage(JSONObject json, StreamListener[] listeners) throws TwitterException, JSONException {
-        DirectMessage directMessage = asDirectMessage(json);
+        DirectMessage directMessage = asDirectMessage(json.getJSONObject(""direct_message""));
         for (StreamListener listener : listeners) {
             ((UserStreamListener) listener).onDirectMessage(directMessage);
         }",0
Fix typo," 	 * called after all original members of the class has been processed.
 	 * 
 	 * @param cv
-	 *            visitor to create fields and classes
+	 *            visitor to create fields and methods
 	 * @param probeCount
 	 *            total number of probes required for this class
 	 */",0
Fix error message,"   public Caffeine<K, V> expireAfterWrite(@NonNegative long duration, @NonNull TimeUnit unit) {
     requireState(expireAfterWriteNanos == UNSET_INT,
         ""expireAfterWrite was already set to %s ns"", expireAfterWriteNanos);
-    requireState(expiry == null, ""expireAfterAccess may not be used with variable expiration"");
+    requireState(expiry == null, ""expireAfterWrite may not be used with variable expiration"");
     requireArgument(duration >= 0, ""duration cannot be negative: %s %s"", duration, unit);
     this.expireAfterWriteNanos = unit.toNanos(duration);
     return this;",0
STFU findbugs on TaskBatch," package com.hazelcast.spi.impl.operationexecutor.impl;
 
 import com.hazelcast.spi.impl.operationservice.PartitionTaskFactory;
+import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 
 import static com.hazelcast.spi.impl.operationexecutor.impl.OperationExecutorImpl.getPartitionThreadId;
 
@@ -31,6 +32,7 @@
     private final int partitionThreadCount;
     private int partitionIndex;
 
+    @SuppressFBWarnings(""EI_EXPOSE_REP"")
     public TaskBatch(PartitionTaskFactory taskFactory, int[] partitions, int threadId, int partitionThreadCount) {
         this.taskFactory = taskFactory;
         this.partitions = partitions;",0
Fix NullPointerException on some devices,"     public static Toast custom(@NonNull Context context, @NonNull CharSequence message, Drawable icon,
                                @ColorInt int tintColor, int duration,
                                boolean withIcon, boolean shouldTint) {
-        final Toast currentToast = Toast.makeText(context, null, duration);
+        final Toast currentToast = new Toast(context);
         final View toastLayout = ((LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE))
                 .inflate(R.layout.toast_layout, null);
         final ImageView toastIcon = toastLayout.findViewById(R.id.toast_icon);
@@ -196,6 +196,7 @@
         toastTextView.setTypeface(currentTypeface);
         toastTextView.setTextSize(TypedValue.COMPLEX_UNIT_SP, textSize);
 
+        currentToast.setDuration(duration);
         currentToast.setView(toastLayout);
         return currentToast;
     }",0
Fix RFC 6122 implementation,"         if (jid.isEmpty() || jid.length() > 3071) {
             throw new InvalidJidException(InvalidJidException.INVALID_LENGTH);
         }
-        if (atCount > 1 || slashCount > 1 ||
-                jid.startsWith(""@"") || jid.endsWith(""@"") ||
-                jid.startsWith(""/"") || jid.endsWith(""/"")) {
+
+		// Go ahead and check if the localpart or resourcepart is empty.
+		if (jid.startsWith(""@"") || (jid.endsWith(""@"") && slashCount == 0) || jid.startsWith(""/"") || (jid.endsWith(""/"") && slashCount < 2)) {
             throw new InvalidJidException(InvalidJidException.INVALID_CHARACTER);
         }
 
         String finaljid;
 
         final int domainpartStart;
-        if (atCount == 1) {
             final int atLoc = jid.indexOf(""@"");
+		final int slashLoc = jid.indexOf(""/"");
+		// If there is no ""@"" in the JID (eg. ""example.net"" or ""example.net/resource"")
+		// or there are one or more ""@"" signs but they're all in the resourcepart (eg. ""example.net/@/rp@""):
+		if (atCount == 0 || (atCount > 0 && slashLoc != -1 && atLoc > slashLoc)) {
+			localpart = """";
+			finaljid = """";
+			domainpartStart = 0;
+		} else {
             final String lp = jid.substring(0, atLoc);
             try {
                 localpart = Stringprep.nodeprep(lp);
@@ -90,15 +97,10 @@
             }
             domainpartStart = atLoc + 1;
             finaljid = lp + ""@"";
-        } else {
-            localpart = """";
-            finaljid = """";
-            domainpartStart = 0;
         }
 
         final String dp;
-        if (slashCount == 1) {
-            final int slashLoc = jid.indexOf(""/"");
+		if (slashCount > 0) {
             final String rp = jid.substring(slashLoc + 1, jid.length());
             try {
                 resourcepart = Stringprep.resourceprep(rp);",0
Bugfix for GdxSetupUI on Linux when needing a SDK update," 
 		if (modules.contains(ProjectType.ANDROID)) {
 			if (!GdxSetup.isSdkUpToDate(sdkLocation)) { 
+				File sdkLocationFile = new File(sdkLocation);
 				try {  //give them a poke in the right direction
 					if (System.getProperty(""os.name"").contains(""Windows"")) {
 						String replaced = sdkLocation.replace(""\\"", ""\\\\"");
 						Runtime.getRuntime().exec(""\"""" + replaced + ""\\SDK Manager.exe\"""");
 					} else {
-						Runtime.getRuntime().exec(""\"""" + sdkLocation + ""tools/android sdk\"""");
+						File sdkManager = new File(sdkLocation, ""tools/android"");
+						Runtime.getRuntime().exec(new String[] {sdkManager.getAbsolutePath(), ""sdk""});
 					}
 				} catch (IOException e) {
 					e.printStackTrace();",0
Fix #1186: GdxNativesLoader.extractLibrary overwriting existing .so," 	static public String extractLibrary (String native32, String native64) {
 		String nativeFileName = is64Bit ? native64 : native32;
 		File nativeFile = new File(nativesDir, nativeFileName);
+		if (!nativeFile.exists()) {
 		try {
 			// Extract native from classpath to temp dir.
 			InputStream input = GdxNativesLoader.class.getResourceAsStream(""/"" + nativeFileName);
@@ -81,6 +82,7 @@
 			output.close();
 		} catch (IOException ex) {
 		}
+		}
 		return nativeFile.exists() ? nativeFile.getAbsolutePath() : null;
 	}
 ",0
fix: not using HashSet.," 
 import android.content.ContentResolver;
 import android.net.Uri;
+import android.support.v4.util.ArraySet;
 import android.webkit.MimeTypeMap;
 
 import com.zhihu.matisse.internal.utils.PhotoMetadataUtils;
 
+import java.util.Arrays;
 import java.util.EnumSet;
-import java.util.HashSet;
 import java.util.Locale;
 import java.util.Set;
 
@@ -36,84 +37,57 @@
  */
 @SuppressWarnings(""unused"")
 public enum MimeType {
+
     // ============== images ==============
-    JPEG(""image/jpeg"", new HashSet<String>() {
-        {
-            add(""jpg"");
-            add(""jpeg"");
-        }
-    }),
-    PNG(""image/png"", new HashSet<String>() {
-        {
-            add(""png"");
-        }
-    }),
-    GIF(""image/gif"", new HashSet<String>() {
-        {
-            add(""gif"");
-        }
-    }),
-    BMP(""image/x-ms-bmp"", new HashSet<String>() {
-        {
-            add(""bmp"");
-        }
-    }),
-    WEBP(""image/webp"", new HashSet<String>() {
-        {
-            add(""webp"");
-        }
-    }),
+    JPEG(""image/jpeg"", arraySetOf(
+            ""jpg"",
+            ""jpeg""
+    )),
+    PNG(""image/png"", arraySetOf(
+            ""png""
+    )),
+    GIF(""image/gif"", arraySetOf(
+            ""gif""
+    )),
+    BMP(""image/x-ms-bmp"", arraySetOf(
+            ""bmp""
+    )),
+    WEBP(""image/webp"", arraySetOf(
+            ""webp""
+    )),
 
     // ============== videos ==============
-    MPEG(""video/mpeg"", new HashSet<String>() {
-        {
-            add(""mpeg"");
-            add(""mpg"");
-        }
-    }),
-    MP4(""video/mp4"", new HashSet<String>() {
-        {
-            add(""mp4"");
-            add(""m4v"");
-        }
-    }),
-    QUICKTIME(""video/quicktime"", new HashSet<String>() {
-        {
-            add(""mov"");
-        }
-    }),
-    THREEGPP(""video/3gpp"", new HashSet<String>() {
-        {
-            add(""3gp"");
-            add(""3gpp"");
-        }
-    }),
-    THREEGPP2(""video/3gpp2"", new HashSet<String>() {
-        {
-            add(""3g2"");
-            add(""3gpp2"");
-        }
-    }),
-    MKV(""video/x-matroska"", new HashSet<String>() {
-        {
-            add(""mkv"");
-        }
-    }),
-    WEBM(""video/webm"", new HashSet<String>() {
-        {
-            add(""webm"");
-        }
-    }),
-    TS(""video/mp2ts"", new HashSet<String>() {
-        {
-            add(""ts"");
-        }
-    }),
-    AVI(""video/avi"", new HashSet<String>() {
-        {
-            add(""avi"");
-        }
-    });
+    MPEG(""video/mpeg"", arraySetOf(
+            ""mpeg"",
+            ""mpg""
+    )),
+    MP4(""video/mp4"", arraySetOf(
+            ""mp4"",
+            ""m4v""
+    )),
+    QUICKTIME(""video/quicktime"", arraySetOf(
+            ""mov""
+    )),
+    THREEGPP(""video/3gpp"", arraySetOf(
+            ""3gp"",
+            ""3gpp""
+    )),
+    THREEGPP2(""video/3gpp2"", arraySetOf(
+            ""3g2"",
+            ""3gpp2""
+    )),
+    MKV(""video/x-matroska"", arraySetOf(
+            ""mkv""
+    )),
+    WEBM(""video/webm"", arraySetOf(
+            ""webm""
+    )),
+    TS(""video/mp2ts"", arraySetOf(
+            ""ts""
+    )),
+    AVI(""video/avi"", arraySetOf(
+            ""avi""
+    ));
 
     private final String mMimeTypeName;
     private final Set<String> mExtensions;
@@ -139,6 +113,10 @@
         return EnumSet.of(MPEG, MP4, QUICKTIME, THREEGPP, THREEGPP2, MKV, WEBM, TS, AVI);
     }
 
+    private static Set<String> arraySetOf(String... suffixes) {
+        return new ArraySet<>(Arrays.asList(suffixes));
+    }
+
     @Override
     public String toString() {
         return mMimeTypeName;",0
Fix DataSourceInputStream.read() for EOF cases," 
   @Override
   public int read() throws IOException {
-    read(singleByteArray);
+    int length = read(singleByteArray);
+    if(length != -1) {
     return singleByteArray[0] & 0xFF;
   }
+    return length;
+  }
 
   @Override
   public int read(byte[] buffer) throws IOException {",0
do not load plugins for journal commands," import org.graylog2.bindings.ConfigurationModule;
 import org.graylog2.bootstrap.CmdLineTool;
 import org.graylog2.plugin.KafkaJournalConfiguration;
+import org.graylog2.plugin.Plugin;
 import org.graylog2.plugin.ServerStatus;
 import org.graylog2.shared.bindings.SchedulerBindings;
 import org.graylog2.shared.bindings.ServerStatusBindings;
 import org.graylog2.shared.journal.KafkaJournal;
 import org.graylog2.shared.journal.KafkaJournalModule;
+import org.graylog2.shared.plugins.ChainingClassLoader;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -72,6 +74,11 @@
         return true;
     }
 
+    @Override
+    protected Set<Plugin> loadPlugins(String pluginPath, ChainingClassLoader chainingClassLoader) {
+        // these commands do not need plugins, which could cause problems because of not loaded config beans
+        return Collections.emptySet();
+    }
 
     @Override
     protected void startCommand() {",0
Issue #3698: Fixed wrong Y property in case of Tile Object in TMX map," 				object.getProperties().put(""id"", id);
 			}
 			object.getProperties().put(""x"", x);
+			
+			if (object instanceof TiledMapTileMapObject) {
+				object.getProperties().put(""y"", y);
+			} else {
 			object.getProperties().put(""y"", (flipY ? y - height : y));
+			}
 			object.getProperties().put(""width"", width);
 			object.getProperties().put(""height"", height);
 			object.setVisible(element.getIntAttribute(""visible"", 1) == 1);",0
Make DumpVisitor extenable and Customizable. Fixes #201 and #202,"  * 
  * @author Julio Vilmar Gesser
  */
-public final class DumpVisitor implements VoidVisitor<Object> {
+public class DumpVisitor implements VoidVisitor<Object> {
 
     private boolean printComments;
 
@@ -97,7 +97,13 @@
         this.printComments = printComments;
     }
 
-	private static class SourcePrinter {
+	protected static class SourcePrinter {
+		
+		private final String indentation;
+
+		protected SourcePrinter(final String indentation) {
+			this.indentation = indentation;
+		}
 
 		private int level = 0;
 
@@ -115,7 +121,7 @@
 
 		private void makeIndent() {
 			for (int i = 0; i < level; i++) {
-				buf.append(""    "");
+				buf.append(indentation);
 			}
 		}
 
@@ -146,7 +152,11 @@
 		}
 	}
 
-	private final SourcePrinter printer = new SourcePrinter();
+	private final SourcePrinter printer = createSourcePrinter();
+	
+	protected SourcePrinter createSourcePrinter() {
+		return new SourcePrinter(""    "");
+	}
 
 	public String getSource() {
 		return printer.getSource();",0
"#1171: Fix ""jdbc:google:"" for new GAE versions.","         }
 
         if (url.startsWith(""jdbc:google:"")) {
-            return ""com.google.appengine.api.rdbms.AppEngineDriver"";
+            return ""com.mysql.jdbc.GoogleDriver"";
         }
 
         if (url.startsWith(ORACLE_JDBC_URL_PREFIX)) {",0
Bugfix: don't allocate 4 times the requested memory," 	// Methods
 	// ===========================================================
 
+	/**
+	 * @param pCapacity Capacity of the buffer in bytes
+	 * @return
+	 */
 	public static ByteBuffer allocateDirectByteBuffer(final int pCapacity) {
 		if(BufferUtils.WORKAROUND_BYTEBUFFER_ALLOCATE_DIRECT) {
-			return BufferUtils.jniAllocateDirect(pCapacity * DataConstants.BYTES_PER_FLOAT);
+			return BufferUtils.jniAllocateDirect(pCapacity);
 		} else {
-			return ByteBuffer.allocateDirect(pCapacity * DataConstants.BYTES_PER_FLOAT);
+			return ByteBuffer.allocateDirect(pCapacity);
 		}
 	}
 ",0
Removing own AMQP reconnecting in favor of the library's.,"  */
 package org.graylog2.inputs.transports;
 
-import com.google.common.util.concurrent.Uninterruptibles;
 import com.rabbitmq.client.AMQP;
 import com.rabbitmq.client.Channel;
 import com.rabbitmq.client.Connection;
 import com.rabbitmq.client.ConnectionFactory;
 import com.rabbitmq.client.DefaultConsumer;
 import com.rabbitmq.client.Envelope;
-import com.rabbitmq.client.ShutdownListener;
-import com.rabbitmq.client.ShutdownSignalException;
 import org.graylog2.plugin.inputs.MessageInput;
 import org.graylog2.plugin.journal.RawMessage;
 import org.slf4j.Logger;
@@ -95,12 +92,7 @@
         this.requeueInvalid = requeueInvalid;
         this.amqpTransport = amqpTransport;
 
-        scheduler.scheduleAtFixedRate(new Runnable() {
-            @Override
-            public void run() {
-                lastSecBytesRead.set(lastSecBytesReadTmp.getAndSet(0));
-            }
-        }, 1, 1, TimeUnit.SECONDS);
+        scheduler.scheduleAtFixedRate(() -> lastSecBytesRead.set(lastSecBytesReadTmp.getAndSet(0)), 1, 1, TimeUnit.SECONDS);
     }
 
     public void run() throws IOException {
@@ -156,6 +148,8 @@
         factory.setPort(port);
         factory.setVirtualHost(virtualHost);
         factory.setRequestedHeartbeat(heartbeatTimeout);
+        // explicitly setting this, to ensure it is true even if the default changes.
+        factory.setAutomaticRecoveryEnabled(true);
 
         if (tls) {
             try {
@@ -187,35 +181,15 @@
         if (null != channel && prefetchCount > 0) {
             channel.basicQos(prefetchCount);
 
-            LOG.info(""AMQP prefetch count overriden to <{}>."", prefetchCount);
+            LOG.debug(""AMQP prefetch count overriden to <{}>."", prefetchCount);
         }
 
-        connection.addShutdownListener(new ShutdownListener() {
-            @Override
-            public void shutdownCompleted(ShutdownSignalException cause) {
+        connection.addShutdownListener(cause -> {
                 if (cause.isInitiatedByApplication()) {
-                    LOG.info(""Not reconnecting connection, we disconnected explicitly."");
+                LOG.info(""Shutting down AMPQ consumer."");
                     return;
                 }
-                while (true) {
-                    try {
-                        LOG.error(""AMQP connection lost! Trying reconnect in 1 second."");
-
-                        Uninterruptibles.sleepUninterruptibly(1, TimeUnit.SECONDS);
-
-                        connect();
-
-                        LOG.info(""Connected! Re-starting consumer."");
-
-                        run();
-
-                        LOG.info(""Consumer running."");
-                        break;
-                    } catch (IOException e) {
-                        LOG.error(""Could not re-connect to AMQP broker."", e);
-                    }
-                }
-            }
+            LOG.warn(""AMQP connection lost! Reconnecting ..."");
         });
     }
 ",0
Fix A problem with  disableWhenHorizontalMove(),"                 float offsetX = mPtrIndicator.getOffsetX();
                 float offsetY = mPtrIndicator.getOffsetY();
 
-                if (mDisableWhenHorizontalMove && !mPreventForHorizontal && (Math.abs(offsetX) > mPagingTouchSlop || Math.abs(offsetX) > 3 * Math.abs(offsetY))) {
+                if (mDisableWhenHorizontalMove && !mPreventForHorizontal && (Math.abs(offsetX) > mPagingTouchSlop && Math.abs(offsetX) > Math.abs(offsetY))) {
                     if (mPtrIndicator.isInStartPosition()) {
                         mPreventForHorizontal = true;
                     }",0
Reinstate the one year warn,"     	
     	final OptionsParamCheckForUpdates options = getModel().getOptionsParam().getCheckForUpdatesParam();
     	
+        if (View.isInitialised()) {
+            if (!options.isCheckOnStart()) {
+                alertIfOutOfDate(false);
+                return;
+            }
+        }
+
 		if (! options.checkOnStart()) {
 			// Top level option not set, dont do anything, unless already downloaded last release
 			if (View.isInitialised() && this.getPreviousVersionInfo() != null) {",0
修复预处理sql字符串类型字段带转义字符处理异常的bug," import java.io.UnsupportedEncodingException;
 import java.util.HashMap;
 import java.util.Map;
-import java.util.regex.Matcher;
 
 import org.slf4j.Logger; import org.slf4j.LoggerFactory;
 
+import com.google.common.escape.Escaper;
+import com.google.common.escape.Escapers;
+import com.google.common.escape.Escapers.Builder;
+
 import io.mycat.backend.mysql.BindValue;
 import io.mycat.backend.mysql.ByteUtil;
 import io.mycat.backend.mysql.PreparedStatement;
@@ -53,6 +56,15 @@
 	
 	private static final Logger LOGGER = LoggerFactory.getLogger(ServerPrepareHandler.class);
 	
+	private static Escaper varcharEscaper = null;
+	
+	static {
+		Builder escapeBuilder = Escapers.builder();
+		escapeBuilder.addEscape('\'', ""\\'"");
+		escapeBuilder.addEscape('$', ""\\$"");
+		varcharEscaper = escapeBuilder.build();
+	}
+	
     private ServerConnection source;
     private volatile long pstmtId;
     private Map<String, PreparedStatement> pstmtForSql;
@@ -189,39 +201,50 @@
      */
     private String prepareStmtBindValue(PreparedStatement pstmt, BindValue[] bindValues) {
     	String sql = pstmt.getStatement();
-    	int paramNumber = pstmt.getParametersNumber();
     	int[] paramTypes = pstmt.getParametersType();
-    	for(int i = 0; i < paramNumber; i++) {
-    		int paramType = paramTypes[i];
-    		BindValue bindValue = bindValues[i];
-    		if(bindValue.isNull) {
-    			sql = sql.replaceFirst(""\\?"", ""NULL"");
+    	
+    	StringBuilder sb = new StringBuilder();
+    	int idx = 0;
+    	for(int i = 0, len = sql.length(); i < len; i++) {
+    		char c = sql.charAt(i);
+    		if(c != '?') {
+    			sb.append(c);
     			continue;
     		}
+    		// 处理占位符?
+    		int paramType = paramTypes[idx];
+    		BindValue bindValue = bindValues[idx];
+    		idx++;
+    		// 处理字段为空的情况
+    		if(bindValue.isNull) {
+    			sb.append(""NULL"");
+    			continue;
+    		}
+    		// 非空情况, 根据字段类型获取值
     		switch(paramType & 0xff) {
     		case Fields.FIELD_TYPE_TINY:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.byteBinding));
+    			sb.append(String.valueOf(bindValue.byteBinding));
     			break;
     		case Fields.FIELD_TYPE_SHORT:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.shortBinding));
+    			sb.append(String.valueOf(bindValue.shortBinding));
     			break;
     		case Fields.FIELD_TYPE_LONG:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.intBinding));
+    			sb.append(String.valueOf(bindValue.intBinding));
     			break;
     		case Fields.FIELD_TYPE_LONGLONG:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.longBinding));
+    			sb.append(String.valueOf(bindValue.longBinding));
     			break;
     		case Fields.FIELD_TYPE_FLOAT:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.floatBinding));
+    			sb.append(String.valueOf(bindValue.floatBinding));
     			break;
     		case Fields.FIELD_TYPE_DOUBLE:
-    			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.doubleBinding));
+    			sb.append(String.valueOf(bindValue.doubleBinding));
     			break;
     		case Fields.FIELD_TYPE_VAR_STRING:
             case Fields.FIELD_TYPE_STRING:
             case Fields.FIELD_TYPE_VARCHAR:
-            	bindValue.value = Matcher.quoteReplacement( String.valueOf( bindValue.value ) );
-            	sql = sql.replaceFirst(""\\?"", ""'"" + bindValue.value + ""'"");
+            	bindValue.value = varcharEscaper.asFunction().apply(String.valueOf(bindValue.value));
+            	sb.append(""'"" + bindValue.value + ""'"");
             	break;
             case Fields.FIELD_TYPE_TINY_BLOB:
             case Fields.FIELD_TYPE_BLOB:
@@ -229,26 +252,27 @@
             case Fields.FIELD_TYPE_LONG_BLOB:
             	if(bindValue.value instanceof ByteArrayOutputStream) {
             		byte[] bytes = ((ByteArrayOutputStream) bindValue.value).toByteArray();
-            		sql = sql.replaceFirst(""\\?"", ""X'"" + HexFormatUtil.bytesToHexString(bytes) + ""'"");
+            		sb.append(""X'"" + HexFormatUtil.bytesToHexString(bytes) + ""'"");
             	} else {
             		// 正常情况下不会走到else, 除非long data的存储方式(ByteArrayOutputStream)被修改
             		LOGGER.warn(""bind value is not a instance of ByteArrayOutputStream, maybe someone change the implement of long data storage!"");
-            		sql = sql.replaceFirst(""\\?"", ""'"" + bindValue.value + ""'"");
+            		sb.append(""'"" + bindValue.value + ""'"");
             	}
             	break;
             case Fields.FIELD_TYPE_TIME:
             case Fields.FIELD_TYPE_DATE:
             case Fields.FIELD_TYPE_DATETIME:
             case Fields.FIELD_TYPE_TIMESTAMP:
-            	sql = sql.replaceFirst(""\\?"", ""'"" + bindValue.value + ""'"");
+            	sb.append(""'"" + bindValue.value + ""'"");
             	break;
             default:
-            	bindValue.value = Matcher.quoteReplacement( String.valueOf( bindValue.value ) );
-            	sql = sql.replaceFirst(""\\?"", bindValue.value.toString());
+            	bindValue.value = varcharEscaper.asFunction().apply(String.valueOf(bindValue.value));
+            	sb.append(bindValue.value.toString());
             	break;
     		}
     	}
-    	return sql;
+    	
+    	return sb.toString();
     }
 
 }
\ No newline at end of file",0
quick fix for scene2d debug memory leak," 		}
 
 		static void draw (Stage stage) {
-			if (app != Gdx.app) debugRenderer = new ImmediateModeRenderer20(128, false, true, 0);
+			// Handle cases where Android holds on to static objects
+			if (app != Gdx.app || debugRenderer == null) {
+				debugRenderer = new ImmediateModeRenderer20(128, false, true, 0);
+				app = Gdx.app;
+			}
 
 			debugRenderer.begin(stage.getBatch().getProjectionMatrix(), GL20.GL_LINES);
 			draw(stage.getActors());",0
Clamp delta time and add debug rendering in SuperKoalio test," 
 import com.badlogic.gdx.Gdx;
 import com.badlogic.gdx.Input.Keys;
+import com.badlogic.gdx.graphics.Color;
 import com.badlogic.gdx.graphics.GL20;
 import com.badlogic.gdx.graphics.OrthographicCamera;
 import com.badlogic.gdx.graphics.Texture;
 import com.badlogic.gdx.graphics.g2d.Animation;
 import com.badlogic.gdx.graphics.g2d.Batch;
 import com.badlogic.gdx.graphics.g2d.TextureRegion;
+import com.badlogic.gdx.graphics.glutils.ShapeRenderer;
+import com.badlogic.gdx.graphics.glutils.ShapeRenderer.ShapeType;
 import com.badlogic.gdx.maps.tiled.TiledMap;
 import com.badlogic.gdx.maps.tiled.TiledMapTileLayer;
 import com.badlogic.gdx.maps.tiled.TiledMapTileLayer.Cell;
@@ -80,6 +83,9 @@
 
 	private static final float GRAVITY = -2.5f;
 
+	private boolean debug = false;
+	private ShapeRenderer debugRenderer;
+
 	@Override
 	public void create () {
 		// load the koala frames, split them, and assign them to Animations
@@ -108,6 +114,8 @@
 		// create the Koala we want to move around the world
 		koala = new Koala();
 		koala.position.set(20, 20);
+
+		debugRenderer = new ShapeRenderer();
 	}
 
 	@Override
@@ -133,10 +141,17 @@
 
 		// render the koala
 		renderKoala(deltaTime);
+
+		// render debug rectangles
+		if (debug) renderDebug();
 	}
 
 	private void updateKoala (float deltaTime) {
 		if (deltaTime == 0) return;
+
+		if (deltaTime > 0.1f)
+			deltaTime = 0.1f;
+
 		koala.stateTime += deltaTime;
 
 		// check input and apply to velocity & state
@@ -158,6 +173,9 @@
 			koala.facesRight = true;
 		}
 
+		if (Gdx.input.isKeyJustPressed(Keys.B))
+			debug = !debug;
+
 		// apply gravity if we are falling
 		koala.velocity.add(0, GRAVITY);
 
@@ -238,7 +256,6 @@
 		// Apply damping to the velocity on the x-axis so we don't
 		// walk infinitely once a key was pressed
 		koala.velocity.x *= Koala.DAMPING;
-
 	}
 
 	private boolean isTouched (float startX, float endX) {
@@ -297,6 +314,27 @@
 		batch.end();
 	}
 
+	private void renderDebug () {
+		debugRenderer.setProjectionMatrix(camera.combined);
+		debugRenderer.begin(ShapeType.Line);
+
+		debugRenderer.setColor(Color.RED);
+		debugRenderer.rect(koala.position.x, koala.position.y, Koala.WIDTH, Koala.HEIGHT);
+
+		debugRenderer.setColor(Color.YELLOW);
+		TiledMapTileLayer layer = (TiledMapTileLayer)map.getLayers().get(""walls"");
+		for (int y = 0; y <= layer.getHeight(); y++) {
+			for (int x = 0; x <= layer.getWidth(); x++) {
+				Cell cell = layer.getCell(x, y);
+				if (cell != null) {
+					if (camera.frustum.boundsInFrustum(x + 0.5f, y + 0.5f, 0, 1, 1, 0))
+						debugRenderer.rect(x, y, 1, 1);
+				}
+			}
+		}
+		debugRenderer.end();
+	}
+
 	@Override
 	public void dispose () {
 	}",0
Fix import issue," 
 import org.nd4j.linalg.factory.Nd4jBackend;
 import org.nd4j.linalg.io.Resource;
-import org.nd4j.linalg.util.Paths;
+import org.nd4j.org.nd4j.linalg.util.Paths;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.nd4j.linalg.io.ClassPathResource;",0
Fix snapped overlays above chatbox not being rendered," 
 	private boolean shouldInvalidateBounds()
 	{
-		final Widget chatbox = client.getWidget(WidgetInfo.CHATBOX_MESSAGES);
+		final Widget chatbox = client.getWidget(WidgetInfo.CHATBOX);
 		final boolean resizeableChanged = isResizeable != client.isResized();
 		boolean changed = false;
 ",0
Fix to define expected method name as String,"             new Implementation(NoCorrespondingNeedsPermissionDetector.class,
                     EnumSet.of(Scope.JAVA_FILE)));
 
-    static final Set<String> NEEDS_PERMISSION_NAME = new HashSet<String>(2) {{
-        add(""NeedsPermission"");
-        add(""permissions.dispatcher.NeedsPermission"");
-    }};
-
-    static final Set<String> ON_SHOW_RATIONALE_NAME = new HashSet<String>(2) {{
-        add(""OnShowRationale"");
-        add(""permissions.dispatcher.OnShowRationale"");
-    }};
-
     @Override
     public List<Class<? extends UElement>> getApplicableUastTypes() {
         return Collections.<Class<? extends UElement>>singletonList(UClass.class);
@@ -77,9 +67,9 @@
             }
             // Let's store NeedsPermission and OnShowRationale
             String type = node.getQualifiedName();
-            if (NEEDS_PERMISSION_NAME.contains(type)) {
+            if (""permissions.dispatcher.NeedsPermission"".equals(type)) {
                 needsPermissionAnnotations.add(node);
-            } else if (ON_SHOW_RATIONALE_NAME.contains(type)) {
+            } else if (""permissions.dispatcher.OnShowRationale"".equals(type)) {
                 onShowRationaleAnnotations.add(node);
             }
             if (onShowRationaleAnnotations.isEmpty()) {",0
PGP fix," 
 				@Override
 				public void onReturn(Intent result) {
-					notifyPgpDecryptionService(message.getContact().getAccount(), OpenPgpApi.ACTION_DECRYPT_VERIFY, result);
+					notifyPgpDecryptionService(message.getConversation().getAccount(), OpenPgpApi.ACTION_DECRYPT_VERIFY, result);
 					switch (result.getIntExtra(OpenPgpApi.RESULT_CODE,
 							OpenPgpApi.RESULT_CODE_ERROR)) {
 					case OpenPgpApi.RESULT_CODE_SUCCESS:
@@ -160,7 +160,7 @@
 
 				@Override
 				public void onReturn(Intent result) {
-					notifyPgpDecryptionService(message.getContact().getAccount(), OpenPgpApi.ACTION_ENCRYPT, result);
+					notifyPgpDecryptionService(message.getConversation().getAccount(), OpenPgpApi.ACTION_ENCRYPT, result);
 					switch (result.getIntExtra(OpenPgpApi.RESULT_CODE,
 							OpenPgpApi.RESULT_CODE_ERROR)) {
 					case OpenPgpApi.RESULT_CODE_SUCCESS:
@@ -206,7 +206,7 @@
 
 					@Override
 					public void onReturn(Intent result) {
-						notifyPgpDecryptionService(message.getContact().getAccount(), OpenPgpApi.ACTION_ENCRYPT, result);
+						notifyPgpDecryptionService(message.getConversation().getAccount(), OpenPgpApi.ACTION_ENCRYPT, result);
 						switch (result.getIntExtra(OpenPgpApi.RESULT_CODE,
 								OpenPgpApi.RESULT_CODE_ERROR)) {
 						case OpenPgpApi.RESULT_CODE_SUCCESS:",0
fix a bug in HeartBeatAlert: cannot get whole report," import org.unidal.tuple.Pair;
 
 import com.dianping.cat.Cat;
+import com.dianping.cat.Constants;
 import com.dianping.cat.consumer.heartbeat.HeartbeatAnalyzer;
 import com.dianping.cat.consumer.heartbeat.model.entity.HeartbeatReport;
 import com.dianping.cat.consumer.heartbeat.model.entity.Machine;
@@ -119,7 +120,8 @@
 	}
 
 	private HeartbeatReport generateReport(String domain, long date) {
-		ModelRequest request = new ModelRequest(domain, date);
+		ModelRequest request = new ModelRequest(domain, date)//
+		      .setProperty(""ip"", Constants.ALL);
 
 		if (m_service.isEligable(request)) {
 			ModelResponse<HeartbeatReport> response = m_service.invoke(request);",0
Jaas auth fix,"         final String username = credential.getUsername();
         final String password = credential.getPassword();
 
+        Principal principal = null;
         final LoginContext lc = new LoginContext(this.realm, new UsernamePasswordCallbackHandler(username, password));
         try {
             LOGGER.debug(""Attempting authentication for: [{}]"", username);
             lc.login();
-        } finally {
-            lc.logout();
-        }
-
-        Principal principal = null;
         final Set<java.security.Principal> principals = lc.getSubject().getPrincipals();
         if (principals != null && !principals.isEmpty()) {
             final java.security.Principal secPrincipal = principals.iterator().next();
             principal = this.principalFactory.createPrincipal(secPrincipal.getName());
         }
+        } finally {
+            lc.logout();
+        }
+
         return createHandlerResult(credential, principal, null);
     }
 ",0
Handle unknown runtime exception while reading entries,"     @Override
     public void asyncReadEntry(ReadHandle lh, PositionImpl position, final ReadEntryCallback callback,
             final Object ctx) {
+        try {
+            asyncReadEntry0(lh, position, callback, ctx);
+        } catch (Throwable t) {
+            log.warn(""failed to read entries for {}-{}"", lh.getId(), position, t);
+            // invalidate all entries related to ledger from the cache (it might happen if entry gets corrupt
+            // (entry.data is already deallocate due to any race-condition) so, invalidate cache and next time read from
+            // the bookie)
+            invalidateAllEntries(lh.getId());
+            callback.readEntryFailed(createManagedLedgerException(t), ctx);
+        }
+    }
+    
+    private void asyncReadEntry0(ReadHandle lh, PositionImpl position, final ReadEntryCallback callback,
+            final Object ctx) {
         if (log.isDebugEnabled()) {
             log.debug(""[{}] Reading entry ledger {}: {}"", ml.getName(), lh.getId(), position.getEntryId());
         }
@@ -202,9 +216,23 @@
     }
 
     @Override
-    @SuppressWarnings({ ""unchecked"", ""rawtypes"" })
     public void asyncReadEntry(ReadHandle lh, long firstEntry, long lastEntry, boolean isSlowestReader,
             final ReadEntriesCallback callback, Object ctx) {
+        try {
+            asyncReadEntry0(lh, firstEntry, lastEntry, isSlowestReader, callback, ctx);
+        } catch (Throwable t) {
+            log.warn(""failed to read entries for {}--{}-{}"", lh.getId(), firstEntry, lastEntry, t);
+            // invalidate all entries related to ledger from the cache (it might happen if entry gets corrupt
+            // (entry.data is already deallocate due to any race-condition) so, invalidate cache and next time read from
+            // the bookie)
+            invalidateAllEntries(lh.getId());
+            callback.readEntriesFailed(createManagedLedgerException(t), ctx);
+        }
+    }
+    
+    @SuppressWarnings({ ""unchecked"", ""rawtypes"" })
+    private void asyncReadEntry0(ReadHandle lh, long firstEntry, long lastEntry, boolean isSlowestReader,
+            final ReadEntriesCallback callback, Object ctx) {
         final long ledgerId = lh.getId();
         final int entriesToRead = (int) (lastEntry - firstEntry) + 1;
         final PositionImpl firstPosition = PositionImpl.get(lh.getId(), firstEntry);",0
Fix playableDuration attribute of onProgress event,"                             && player.getPlayWhenReady()
                             ) {
                         long pos = player.getCurrentPosition();
-                        eventEmitter.progressChanged(pos, player.getBufferedPercentage());
+                        eventEmitter.progressChanged(pos, player.getBufferedPosition());
                         msg = obtainMessage(SHOW_PROGRESS);
                         sendMessageDelayed(msg, Math.round(mProgressUpdateInterval));
                     }",0
Fix a NullPointerException in headless server ," import org.terasology.entitySystem.entity.internal.EngineEntityManager;
 import org.terasology.entitySystem.event.internal.EventSystem;
 import org.terasology.game.GameManifest;
+import org.terasology.input.InputSystem;
 import org.terasology.logic.console.Console;
 import org.terasology.logic.console.ConsoleImpl;
 import org.terasology.logic.console.ConsoleSystem;
@@ -90,6 +91,7 @@
 
         componentSystemManager.register(new ConsoleSystem(), ""engine:ConsoleSystem"");
         componentSystemManager.register(new CoreCommands(), ""engine:CoreCommands"");
+        componentSystemManager.register(context.get(InputSystem.class), ""engine:InputSystem"");
 
         EntityRef localPlayerEntity = entityManager.create(new ClientComponent());
         LocalPlayer localPlayer = new LocalPlayer();",0
Fix broken master: Handle header only if the Header annotation is present,"                     String headerValue = header.value();
                     headers.put(headerName, headerValue);
                 }
-            } else {
-                Header header = context.getAnnotation(Header.class);
-                headers.put(header.name(), header.value());
+            }
+
+            Header headerAnnotation = context.getAnnotation(Header.class);
+            if (headerAnnotation != null) {
+                headers.put(headerAnnotation.name(), headerAnnotation.value());
             }
 
             List<NettyCookie> cookies = new ArrayList<>();",0
Fixes hash function for LinkKey,"     @Override
     public int hashCode() {
         final int hash = this.hash;
-        if (hash == 0) {
+        if (hash != 0) {
             return hash;
         }
         int result = fromApplication.hashCode();",0
Fix leaking pixmap," 					if (pixmap.getFormat() != Format.RGBA8888) {
 						Pixmap rgba = new Pixmap(pixmap.getWidth(), pixmap.getHeight(), Format.RGBA8888);
 						rgba.drawPixmap(pixmap, 0, 0);
+						pixmap.dispose();
 						pixmap = rgba;
 					}
 					icons[i] = ByteBuffer.allocateDirect(pixmap.getPixels().limit());",0
Fix size of RuneLite minimap dots,"  */
 public class OverlayUtil
 {
+	private static final int MINIMAP_DOT_RADIUS = 4;
+
 	public static void renderPolygon(Graphics2D graphics, Polygon poly, Color color)
 	{
 		graphics.setColor(color);
@@ -61,9 +63,9 @@
 	public static void renderMinimapLocation(Graphics2D graphics, Point mini, Color color)
 	{
 		graphics.setColor(Color.BLACK);
-		graphics.fillOval(mini.getX() - 2, mini.getY() - 2 + 1, 5, 5);
+		graphics.fillOval(mini.getX() - MINIMAP_DOT_RADIUS / 2, mini.getY() - MINIMAP_DOT_RADIUS / 2 + 1, MINIMAP_DOT_RADIUS, MINIMAP_DOT_RADIUS);
 		graphics.setColor(color);
-		graphics.fillOval(mini.getX() - 2, mini.getY() - 2, 5, 5);
+		graphics.fillOval(mini.getX() - MINIMAP_DOT_RADIUS / 2, mini.getY() - MINIMAP_DOT_RADIUS / 2, MINIMAP_DOT_RADIUS, MINIMAP_DOT_RADIUS);
 	}
 
 	public static void renderTextLocation(Graphics2D graphics, Point txtLoc, String text, Color color)",0
 修复异常关闭连接之后。继续处理抛出null的bug。," 											LOGGER.warn(""caught err: ""+con, e);
 										}
 										con.close(""program err:"" + e.toString());
+										continue;
 									}
 								}
 								if (key.isWritable()) {",0
fix typo: currentPid," 
         List<String> lines = ExecutingCommand.runNative(command);
 
-        int currentPid = Integer.parseInt(PidUtils.getPid());
+        int currentPid = Integer.parseInt(PidUtils.currentPid());
         for (String line : lines) {
             String[] strings = line.trim().split(""\\s+"");
             if (strings.length < 1) {",0
Issue #27: Fix ActionBar clobberage,"     }
 
     @Override public void showScreen(Blueprint newScreen, Flow.Direction direction) {
-      super.showScreen(newScreen, direction);
-
       boolean hasUp = newScreen instanceof HasParent;
       String title = newScreen.getClass().getSimpleName();
       ActionBarOwner.MenuAction menu =
@@ -71,6 +69,8 @@
             }
           });
       actionBarOwner.setConfig(new ActionBarOwner.Config(false, hasUp, title, menu));
+
+      super.showScreen(newScreen, direction);
     }
 
     @Override protected Blueprint getFirstScreen() {",0
[1.13] Fix ToolTypes being null.,"     {
         if (VALID_NAME.matcher(name).find())
             throw new IllegalArgumentException(""ToolType.create() called with invalid name: "" + name);
-        return values.putIfAbsent(name, new ToolType(name));
+        return values.computeIfAbsent(name, k -> new ToolType(name));
     }
 
     private final String name;",0
Fix Distance Comparator,"     new Handler(Looper.getMainLooper()).post(new Runnable() {
       @Override
       public void run() {
-        for (PwPair pwPair : mPwCollection.getGroupedPwPairsSortedByRank()) {
+        for (PwPair pwPair : mPwCollection.getGroupedPwPairsSortedByRank(
+            Utils.newDistanceComparator())) {
           String groupId = Utils.getGroupId(pwPair.getPwsResult());
           Log.d(TAG, ""groupid to add "" + groupId);
           if (mNearbyDeviceAdapter.containsGroupId(groupId)) {",0
fix:#558 修复 Builder#newObjectBuilder 存在死循环的风险,"                 t = t.getSuperclass();
                 if (t == null)
                     throw new RuntimeException(""Can not found Constructor?"");
-                cs = c.getDeclaredConstructors();
+                cs = t.getDeclaredConstructors();
             }
             while (cs.length == 0);
         }",0
Fixes JENKINS-36074,"     public Collection<?> getActions() {
         List<BlueActionProxy> actionProxies = new ArrayList<>();
         for(Action action:run.getAllActions()){
-            if(!action.getClass().isAnnotationPresent(ExportedBean.class)){
+            if(action == null || !action.getClass().isAnnotationPresent(ExportedBean.class)){
                 continue;
             }
             actionProxies.add(new ActionProxiesImpl(action, this));
@@ -202,7 +202,9 @@
     public String getCommitId(){
         BuildData data = run.getAction(BuildData.class);
 
-        if(data == null){
+        if(data == null
+            || data.getLastBuiltRevision() == null
+            || data.getLastBuiltRevision().getSha1String() == null) {
             return null;
         } else {
             return data.getLastBuiltRevision().getSha1String();",0
Bug fix for throwing item,"                     pickupItem = removedItem;
                 }
             } else {
-                final EntityRef removedItem = CoreRegistry.get(InventoryManager.class).removeItem(owner, EntityRef.NULL, pickupItem, false);
+                final EntityRef removedItem = CoreRegistry.get(InventoryManager.class).removeItem(owner, EntityRef.NULL, pickupItem, false, 1);
                 if (removedItem != null) {
                     pickupItem = removedItem;
                 }",0
Make sure directory in capture strategy exists before proceeding,"         }
         if (mCaptureStrategy.directory != null) {
             storageDir = new File(storageDir, mCaptureStrategy.directory);
+            if (!storageDir.exists()) storageDir.mkdirs();
         }
 
         // Avoid joining path components manually",0
Fix issue 1231 for MathUtils.atan2()," 			add = 0;
 		}
 		float invDiv = 1 / ((x < y ? y : x) * INV_ATAN2_DIM_MINUS_1);
+		
+		if (invDiv == Float.POSITIVE_INFINITY)
+			return ((float)Math.atan2(y, x) + add) * mul;
+		
 		int xi = (int)(x * invDiv);
 		int yi = (int)(y * invDiv);
 		return (Atan2.table[yi * ATAN2_DIM + xi] + add) * mul;",0
Fixed @Trace annotation validation when traces are disabled," 		modelValidator.register(new BeanValidator(processingEnv));
 		modelValidator.register(new AfterInjectValidator(processingEnv));
 		modelValidator.register(new AfterViewsValidator(processingEnv));
-		if (traceActivated()) {
 			modelValidator.register(new TraceValidator(processingEnv));
-		}
 		modelValidator.register(new RunnableValidator(UiThread.class, processingEnv));
 		modelValidator.register(new RunnableValidator(Background.class, processingEnv));
 		modelValidator.register(new InstanceStateValidator(processingEnv));
@@ -522,7 +520,9 @@
 		modelProcessor.register(new RootContextProcessor());
 		modelProcessor.register(new BeanProcessor(processingEnv));
 		modelProcessor.register(new AfterViewsProcessor());
+		if (traceActivated()) {
 		modelProcessor.register(new TraceProcessor());
+		}
 		modelProcessor.register(new UiThreadProcessor());
 		modelProcessor.register(new BackgroundProcessor());
 		modelProcessor.register(new AfterInjectProcessor());",0
fixed a bug causing drawable bounds being invalid after changing the image,"         mLastGenTrans = new Transition(srcRect, dstRect, mTransitionDuration,
                 mTransitionInterpolator);
 
-        mLastDrawableBounds = drawableBounds;
+        mLastDrawableBounds = new RectF(drawableBounds);
 
         return mLastGenTrans;
     }",0
Fixed javadoc for deployVerticle method,"   void deployModule(String moduleName, int instances, Handler<AsyncResult<String>> doneHandler);
 
   /**
-   * Deploy a worker verticle programmatically
+   * Deploy a verticle programmatically
    * @param main The main of the verticle
    */
   void deployVerticle(String main);",0
typo fix," 
     @Override
     public String onnxName() {
-        throw new NoOpNameFoundException(""No onnx name found for shape "" + opName());
+        throw new NoOpNameFoundException(""No onnx name found for "" + opName());
     }
 
     @Override",0
Fix the bug of SessionConfig.equals," 
     @Override
     public boolean equals(Object other) {
-        return other instanceof SonicSessionConfig && sessionMode == ((SonicSessionConfig) other).sessionMode;
+        if (other instanceof SonicSessionConfig) {
+            SonicSessionConfig config = (SonicSessionConfig)other;
+            return sessionMode == config.sessionMode && SUPPORT_LOCAL_SERVER == config.SUPPORT_LOCAL_SERVER;
+        }
+
+        return false;
+
     }
 
     private SonicSessionConfig() {",0
add pr #108 changes to trunk as they were commited on old branch.,"             }
             if (type != DAY_OF_WEEK && type != DAY_OF_MONTH) {
                 throw new ParseException(
-                            ""'?' can only be specfied for Day-of-Month or Day-of-Week."",
+                            ""'?' can only be specified for Day-of-Month or Day-of-Week."",
                             i);
             }
             if (type == DAY_OF_WEEK && !lastdayOfMonth) {
                 int val = daysOfMonth.last();
                 if (val == NO_SPEC_INT) {
                     throw new ParseException(
-                                ""'?' can only be specfied for Day-of-Month -OR- Day-of-Week."",
+                                ""'?' can only be specified for Day-of-Month -OR- Day-of-Week."",
                                 i);
                 }
             }",0
Grouping resources with missing resourceId,"         }
 
         double resourceCostValue = costValue;
-        if (items.length > resourceIndex && !StringUtils.isEmpty(items[resourceIndex]) && config.resourceService != null) {
+        if (items.length > resourceIndex && config.resourceService != null) {
 
             if (config.useCostForResourceGroup.equals(""modeled"") && product == Product.ec2_instance)
                 operation = Operation.getReservedInstances(config.reservationService.getDefaultReservationUtilization(0L));",0
fix unicode text that failed build on linux,"     @Override
     public void deletedTag(final CTagManager manager, final ITreeNode<CTag> parent,
         final ITreeNode<CTag> tag) {
-      // container node can´t be deleted
+      // container node can't be deleted
     }
 
     @Override
     public void deletedTagSubtree(final CTagManager manager, final ITreeNode<CTag> parent,
         final ITreeNode<CTag> tag) {
-      // container node subtree can´t be deleted
+      // container node subtree can't be deleted
     }
 
     @Override",0
Fixed issue with TicketRegistryCleaner schedule,"         @Scheduled(initialDelayString = ""${cas.ticket.registry.cleaner.schedule.startDelay:PT30S}"",
                 fixedDelayString = ""${cas.ticket.registry.cleaner.schedule.repeatInterval:PT120S}"")
         public void run() {
+            try {
             this.ticketRegistryCleaner.clean();
+            } catch (final Exception e) {
+                LOGGER.error(e.getMessage(), e);
+            }
         }
     }
 }",0
Fix bug with measuring behavior,"         init(context, attrs);
     }
 
+    //region Init
+
     @SuppressWarnings(""WrongConstant"")
     private void init(@NonNull Context context, @Nullable AttributeSet attrs) {
         TypedArray a = context.getTheme().obtainStyledAttributes(attrs, R.styleable.CameraView, 0, 0);
@@ -200,10 +202,9 @@
         super.onDetachedFromWindow();
     }
 
+    //endregion
 
-    // Smart measuring behavior
-    // ------------------------
-
+    //region Measuring behavior
 
     private String ms(int mode) {
         switch (mode) {
@@ -249,7 +250,7 @@
         final float previewHeight = flip ? previewSize.getWidth() : previewSize.getHeight();
 
         // If MATCH_PARENT is interpreted as AT_MOST, transform to EXACTLY
-        // to be consistent with our semantics.
+        // to be consistent with our semantics (and our docs).
         final ViewGroup.LayoutParams lp = getLayoutParams();
         if (widthMode == AT_MOST && lp.width == MATCH_PARENT) widthMode = EXACTLY;
         if (heightMode == AT_MOST && lp.height == MATCH_PARENT) heightMode = EXACTLY;
@@ -261,7 +262,7 @@
 
         // If we have fixed dimensions (either 300dp or MATCH_PARENT), there's nothing we should do,
         // other than respect it. The preview will eventually be cropped at the sides (by PreviewImpl scaling)
-        // except the case in which these fixed dimensions somehow fit exactly the preview aspect ratio.
+        // except the case in which these fixed dimensions manage to fit exactly the preview aspect ratio.
         if (widthMode == EXACTLY && heightMode == EXACTLY) {
             Log.e(TAG, ""onMeasure, both are MATCH_PARENT or fixed value. We adapt. This means CROP_INSIDE. "" +
                     ""("" + widthValue + ""x"" + heightValue + "")"");
@@ -272,17 +273,20 @@
         // If both dimensions are free, with no limits, then our size will be exactly the
         // preview size. This can happen rarely, for example in scrollable containers.
         if (widthMode == UNSPECIFIED && heightMode == UNSPECIFIED) {
-            Log.e(TAG, ""onMeasure, both are completely free. We respect that and extend to the whole preview size. "" +
+            Log.e(TAG, ""onMeasure, both are completely free. "" +
+                    ""We respect that and extend to the whole preview size. "" +
                     ""("" + previewWidth + ""x"" + previewHeight + "")"");
-            super.onMeasure(MeasureSpec.makeMeasureSpec((int) previewWidth, EXACTLY),
+            super.onMeasure(
+                    MeasureSpec.makeMeasureSpec((int) previewWidth, EXACTLY),
                     MeasureSpec.makeMeasureSpec((int) previewHeight, EXACTLY));
             return;
         }
 
-        // It sure now that at least one dimension can be determined (either because EXACTLY or AT_MOST).
+        // It's sure now that at least one dimension can be determined (either because EXACTLY or AT_MOST).
         // This starts to seem a pleasant situation.
 
-        // If one of the dimension is completely free, take the other and fit the ratio.
+        // If one of the dimension is completely free (e.g. in a scrollable container),
+        // take the other and fit the ratio.
         // One of the two might be AT_MOST, but we use the value anyway.
         float ratio = previewHeight / previewWidth;
         if (widthMode == UNSPECIFIED || heightMode == UNSPECIFIED) {
@@ -325,7 +329,7 @@
         // Last case, AT_MOST and AT_MOST. Here we can SURELY fit the aspect ratio by filling one
         // dimension and adapting the other.
         int height, width;
-        float atMostRatio = heightValue / widthValue;
+        float atMostRatio = (float) heightValue / (float) widthValue;
         if (atMostRatio >= ratio) {
             // We must reduce height.
             width = widthValue;
@@ -340,10 +344,9 @@
                 MeasureSpec.makeMeasureSpec(height, EXACTLY));
     }
 
+    //endregion
 
-    // Gesture APIs and touch control
-    // ------------------------------
-
+    //region Gesture APIs
 
     /**
      * Maps a {@link Gesture} to a certain gesture action.
@@ -468,10 +471,9 @@
         return false;
     }
 
+    //endregion
 
-    // Lifecycle APIs
-    // --------------
-
+    //region Lifecycle APIs
 
     /**
      * Returns whether the camera has started showing its preview.
@@ -586,10 +588,9 @@
         mWorkerHandler = null;
     }
 
+    //endregion
 
-    // Public APIs for parameters and controls
-    // ---------------------------------------
-
+    //region Public APIs for controls
 
     /**
      * Returns a {@link CameraOptions} instance holding supported options for this camera
@@ -1158,10 +1159,9 @@
         }
     }
 
+    //endregion
 
-    // Callbacks and dispatch
-    // ----------------------
-
+    //region Callbacks and dispatching
 
     private MediaActionSound mSound;
     private final boolean mUseSounds = Build.VERSION.SDK_INT >= 16;
@@ -1394,10 +1394,9 @@
         }
     }
 
+    //endregion
 
-    // Deprecated stuff
-    // ----------------
-
+    //region Deprecated
 
     /**
      * This does nothing.
@@ -1459,4 +1458,5 @@
         return 0;
     }
 
+    //endregion
 }",0
Fix for bug #3134 GlyphRun: Final white space omitted ," 			}
 		}
 
-		// determine space width and set glyph
+		// determine space width
 		if (face.loadChar(' ', FreeType.FT_LOAD_DEFAULT)) {
 			data.spaceWidth = FreeType.toInt(face.getGlyph().getMetrics().getHoriAdvance());
 		} else {
 			data.spaceWidth = face.getMaxAdvanceWidth(); // FIXME possibly very wrong :)
 		}
-		Glyph spaceGlyph = new Glyph();
-		spaceGlyph.xadvance = (int)data.spaceWidth;
-		spaceGlyph.id = (int)' ';
-		data.setGlyph(' ', spaceGlyph);
 
 		// determine x-height
 		for (char xChar : data.xChars) {
@@ -410,6 +406,16 @@
 			}
 		}
 
+		// Set space glyph.
+		Glyph spaceGlyph = data.getGlyph(' ');
+		if (spaceGlyph == null) {
+			spaceGlyph = new Glyph();
+			spaceGlyph.xadvance = (int)data.spaceWidth;
+			spaceGlyph.id = (int)' ';
+			data.setGlyph(' ', spaceGlyph);
+		}
+		if (spaceGlyph.width == 0) spaceGlyph.width = (int)(spaceGlyph.xadvance + data.padRight);
+
 		if (stroker != null && !incremental) stroker.dispose();
 
 		// Generate kerning.",0
Fix exchange client leak when queries are abandoned,"         this.queryManager = checkNotNull(queryManager, ""queryManager is null"");
         this.exchangeClientSupplier = checkNotNull(exchangeClientSupplier, ""exchangeClientSupplier is null"");
 
-        queryPurger.scheduleWithFixedDelay(new PurgeQueriesRunnable(queries.keySet(), queryManager), 200, 200, TimeUnit.MILLISECONDS);
+        queryPurger.scheduleWithFixedDelay(new PurgeQueriesRunnable(queries, queryManager), 200, 200, TimeUnit.MILLISECONDS);
     }
 
     @PreDestroy
@@ -651,12 +651,12 @@
     private static class PurgeQueriesRunnable
             implements Runnable
     {
-        private final Set<QueryId> queryIds;
+        private final ConcurrentMap<QueryId, Query> queries;
         private final QueryManager queryManager;
 
-        public PurgeQueriesRunnable(Set<QueryId> queryIds, QueryManager queryManager)
+        public PurgeQueriesRunnable(ConcurrentMap<QueryId, Query> queries, QueryManager queryManager)
         {
-            this.queryIds = queryIds;
+            this.queries = queries;
             this.queryManager = queryManager;
         }
 
@@ -670,14 +670,17 @@
                 // not live queries set.  If we did this in the other order, a query could be
                 // registered between fetching the live queries and inspecting the queryIds set.
 
-                Set<QueryId> queryIdsSnapshot = ImmutableSet.copyOf(queryIds);
+                Set<QueryId> queryIdsSnapshot = ImmutableSet.copyOf(queries.keySet());
                 // do not call queryManager.getQueryInfo() since it updates the heartbeat time
                 Set<QueryId> liveQueries = ImmutableSet.copyOf(transform(queryManager.getAllQueryInfo(), queryIdGetter()));
 
                 Set<QueryId> deadQueries = Sets.difference(queryIdsSnapshot, liveQueries);
-                for (QueryId deadQuery : deadQueries) {
-                    queryIds.remove(deadQuery);
-                    log.debug(""Removed expired query %s"", deadQuery);
+                for (QueryId deadQueryId : deadQueries) {
+                    Query query = queries.remove(deadQueryId);
+                    if (query != null) {
+                        query.close();
+                        log.info(""Removed expired query %s"", deadQueryId);
+                    }
                 }
             }
             catch (Throwable e) {",0
DragDropUtil onMove fixed,"     public static void onMove(FastItemAdapter fastItemAdapter, int oldPosition, int newPosition) {
         // necessary, because the positions passed to this function may be jumping in case of that the recycler view is scrolled while holding an item outside of the recycler view
         if (oldPosition < newPosition) {
-            for (int i = newPosition - 1; i >= oldPosition; i--) {
-                Collections.swap(fastItemAdapter.getAdapterItems(), i, i + 1);
-                fastItemAdapter.notifyAdapterItemMoved(i, i + 1);
+            for (int i = oldPosition + 1; i <= newPosition; i++) {
+                Collections.swap(fastItemAdapter.getAdapterItems(), i, i - 1);
+                fastItemAdapter.notifyAdapterItemMoved(i, i - 1);
             }
         } else {
             for (int i = oldPosition - 1; i >= newPosition; i--) {",0
Fix CAMEL-10253: Add check on null,"     }
 
     public String getTraceLabel() {
-        return ""throwException["" + exception.getClass().getSimpleName() + ""]"";
+        String className = this.exception == null ? this.type.getSimpleName() : this.exception.getClass().getSimpleName();
+        return ""throwException["" + className + ""]"";
     }
 
     public String getId() {",0
Remove unreferenced {} in logger.warn," 
     @Override
     public void handleException(NettyResponseFuture<?> future, Throwable e) {
-        logger.warn(""onError {}"", e);
+        logger.warn(""onError"", e);
 
         try {
             WebSocketUpgradeHandler h = (WebSocketUpgradeHandler) future.getAsyncHandler();",0
DSL: Fix bug in error reporting which generated code even if the parsed node was invalid.,"         }
         for (MessageContainer sink : findChildContainers()) {
             if (visitedSinks.contains(sink)) {
-                return false;
+                continue;
             }
 
             visitedSinks.add(sink);",0
"OrthographicCamera ""fix"""," 	private Vector3 calculateDirection (float angle) {
 		Matrix4 transform = new Matrix4();
 		Vector3 dir = new Vector3(-1, 0, 1).nor();
-		float rotAngle = (float)Math.toDegrees(Math.asin(Math.tan(Math.toRadians(angle))));
 		transform.setToRotation(new Vector3(1, 0, 1).nor(), angle);
 		dir.mul(transform).nor();
 		return dir;",0
Fix unregistering of event listener,"         {
             for(ArrayList<IEventListener> list : priorities)
             {
-                list.remove(listener);
+                if (list.remove(listener))
+                {
+                    rebuild = true;
+                }
             }
         }
     }",0
Missing @since versions for SECURITY-170 fix,"      *
      * @param parameters the parameters
      * @param additionalSafeParameters additional safe parameters
-     * @since TODO
+     * @since 1.651.2, 2.3
      */
     public ParametersAction(List<ParameterValue> parameters, Collection<String> additionalSafeParameters) {
         this(parameters);
@@ -334,7 +334,7 @@
      * caller could inject any parameter (using any key) here. <strong>Treat it as untrusted data</strong>.
      *
      * @return all parameters defined here.
-     * @since TODO
+     * @since 1.651.2, 2.3
      */
     public List<ParameterValue> getAllParameters() {
         return Collections.unmodifiableList(parameters);",0
Fixed typo in CasOAuthWebflowConfiguration,"     private FlowDefinitionRegistry logoutFlowDefinitionRegistry;
 
     @Autowired
-    @Qualifier(""oauth20AuthenticationServiceSelectionStrategy"")
+    @Qualifier(""oauth20AuthenticationRequestServiceSelectionStrategy"")
     private AuthenticationServiceSelectionStrategy oauth20AuthenticationServiceSelectionStrategy;
 
     @Autowired",0
Fix for issue 235,"                     ""    def set%2$s(self, value):\n"" +
                     ""        bits = struct.unpack_from('%3$s', self.buffer_, self.offset_)[0]\n"" +
                     ""        bits = (bits | ( 0x1L << %5$s)) if value > 0 else (bits & ~(0x1L << %5$s))\n"" +
-                    ""        struct.pack_into('%3$s', self.buffer_, self.offset_, value)\n"" +
+                    ""        struct.pack_into('%3$s', self.buffer_, self.offset_, bits)\n"" +
                     ""        return self\n"",
                     bitsetClassName,
                     toUpperFirstChar(choiceName),",0
fix geo uri regex (fix #3050)," 	private static final String SHARE_LOCATION_PACKAGE_NAME = ""eu.siacs.conversations.location.request"";
 	private static final String SHOW_LOCATION_PACKAGE_NAME = ""eu.siacs.conversations.location.show"";
 
-	public static Pattern GEO_URI = Pattern.compile(""geo:([\\-0-9.]+),([\\-0-9.]+)(?:,([\\-0-9.]+))?(?:\\?(.*))?"", Pattern.CASE_INSENSITIVE);
+	public static Pattern GEO_URI = Pattern.compile(""geo:(-?\\d+(?:\\.\\d+)?),(-?\\d+(?:\\.\\d+)?)(?:,-?\\d+(?:\\.\\d+)?)?(?:;crs=[\\w-]+)?(?:;u=\\d+(?:\\.\\d+)?)?(?:;[\\w-]+=(?:[\\w-_.!~*'()]|%[\\da-f][\\da-f])+)*"", Pattern.CASE_INSENSITIVE);
 
 	public static boolean isLocationPluginInstalled(Context context) {
 		return new Intent(SHARE_LOCATION_PACKAGE_NAME).resolveActivity(context.getPackageManager()) != null;",0
Fix getResourcePaths for windows,"             if(file != null) {
                 File base = res.getResourceManagerRoot();
                 String filePath = file.getAbsolutePath().substring(base.getAbsolutePath().length());
-                filePath.replace('\\', '/'); //for windows systems
+                filePath = filePath.replace('\\', '/'); //for windows systems
                 if(file.isDirectory()) {
                     filePath = filePath + ""/"";
                 }",0
Fixed deadlock in getBitmapWithFilterApplied,"                     }
                 }
             });
-            requestRender();
             synchronized(mFilter) {
+                requestRender();
                 try {
                     mFilter.wait();
                 } catch (InterruptedException e) {",0
fix compile error," package com.airbnb.android.react.lottie;
 
+import android.animation.Animator;
+import android.content.Context;
+import android.content.ContextWrapper;
 import android.os.Handler;
 import android.os.Looper;
 import android.support.v4.view.ViewCompat;
@@ -8,11 +11,15 @@
 import android.view.View;
 
 import com.airbnb.lottie.LottieAnimationView;
+import com.facebook.react.bridge.Arguments;
+import com.facebook.react.bridge.ReactContext;
 import com.facebook.react.bridge.ReadableArray;
+import com.facebook.react.bridge.WritableMap;
 import com.facebook.react.common.MapBuilder;
 import com.facebook.react.uimanager.SimpleViewManager;
 import com.facebook.react.uimanager.ThemedReactContext;
 import com.facebook.react.uimanager.annotations.ReactProp;
+import com.facebook.react.uimanager.events.RCTEventEmitter;
 
 import java.util.Map;
 import java.util.WeakHashMap;",0
fix plugin notification logic when notification has not any view inside," import android.app.Application;
 import android.app.Notification;
 import android.content.Context;
+import android.content.pm.ApplicationInfo;
 import android.graphics.Bitmap;
 import android.graphics.BitmapFactory;
 import android.graphics.Canvas;
@@ -33,6 +34,7 @@
 import android.graphics.drawable.Drawable;
 import android.os.Build.VERSION;
 import android.os.Build.VERSION_CODES;
+import android.os.Bundle;
 import android.text.TextUtils;
 import android.view.View;
 import android.widget.RemoteViews;
@@ -356,6 +358,19 @@
                 }
             }
         }
+
+        try {
+            Bundle mExtras = (Bundle) FieldUtils.readField(notification, ""extras"", true);
+            for (String s : mExtras.keySet()) {
+                if (mExtras.get(s) != null && mExtras.get(s) instanceof ApplicationInfo) {
+                    ApplicationInfo applicationInfo = (ApplicationInfo) mExtras.get(s);
+                    return !TextUtils.equals(mHostContext.getPackageName(), applicationInfo.packageName);
+                }
+            }
+        } catch (Exception e) {
+            e.printStackTrace();
+        }
+
         return false;
     }
 ",0
FIX #1802 - Better failure logging when handleMessage failes,"       theHandler.handle(message);
       metrics.endHandleMessage(metric, null);
     } catch (Exception e) {
-      log.error(""Failed to handleMessage"", e);
+      log.error(""Failed to handleMessage. address: "" + message.address(), e);
       metrics.endHandleMessage(metric, e);
       throw e;
     }",0
[FIXED JENKINS-38534] Isolate the code that requires the `Jenkins` class to be loaded from an agent code path,"  */
 package hudson.util;
 
+import hudson.ExtensionList;
 import hudson.ExtensionPoint;
 import hudson.util.ProcessTreeRemoting.IOSProcess;
 
@@ -32,7 +33,7 @@
 import javax.annotation.CheckForNull;
 import javax.annotation.Nonnull;
 
-import jenkins.model.Jenkins;
+import jenkins.util.JenkinsJVM;
 
 /**
  * Allows extensions to veto killing processes. If at least one extension vetoes
@@ -74,11 +75,20 @@
      *         list if Jenkins is not available, never null.
      */
     public static List<ProcessKillingVeto> all() {
-        // check if we are a thread running on the master JVM or a thread running in a remote JVM
-        Jenkins jenkins = Jenkins.getInstanceOrNull();
-        if (jenkins == null)
-            return Collections.emptyList(); // we are remote, no body gets to veto
-        return jenkins.getExtensionList(ProcessKillingVeto.class);
+        if (JenkinsJVM.isJenkinsJVM()) {
+            return _all();
+        }
+        return Collections.emptyList();
+    }
+
+    /**
+     * As classloading is lazy, the classes referenced in this method will not be resolved
+     * until the first time the method is invoked, so we use this method to guard access to Jenkins JVM only classes.
+     *
+     * @return All ProcessKillingVeto extensions currently registered.
+     */
+    private static List<ProcessKillingVeto> _all() {
+        return ExtensionList.lookup(ProcessKillingVeto.class);
     }
 
     /**",0
fix for stack index offset,"     private static final int MAX_METHOD_COUNT = 5;
 
     /**
+     * The minimum stack trace index, starts at this class after two native calls.
+     */
+    private static final int MIN_STACK_OFFSET = 3;
+
+    /**
      * It is used to determine log settings such as method count, thread info visibility
      */
     private static final Settings settings = new Settings();
@@ -120,7 +125,7 @@
 
     public static void e(String message, int methodCount) {
         validateMethodCount(methodCount);
-        e(message, null, methodCount);
+        e(TAG, message, methodCount);
     }
 
     public static void e(String tag, String message, int methodCount) {
@@ -303,8 +308,11 @@
             logDivider(logType, tag);
         }
         String level = """";
+
+        int stackOffset = getStackOffset(trace);
+
         for (int i = methodCount; i > 0; i--) {
-            int stackIndex = i + 5;
+            int stackIndex = i + stackOffset;
             StringBuilder builder = new StringBuilder();
             builder.append(""║ "")
                     .append(level)
@@ -407,5 +415,20 @@
         }
     }
 
+    /**
+     * Determines the starting index of the stack trace, after method calls made by this class.
+     *
+     * @param trace the stack trace
+     * @return  the stack offset
+     */
+    private static int getStackOffset(StackTraceElement[] trace) {
+        for (int i = MIN_STACK_OFFSET; i < trace.length; i++) {
+            StackTraceElement e = trace[i];
+            if (!e.getClassName().equals(Logger.class.getName())) {
+                return --i;
+            }
+        }
+        return -1;
+    }
 
 }",0
replace cache map with thread-safe implemention. Fixes #6,"     public static final String EMPTY_PARAM = ""void"";
     private static final Class<?>[] EMPTY_CLASS_ARRAY = new Class<?>[0];
 
-    private static final Map<String, Class<?>> name2ClassCache = new HashMap<String, Class<?>>();
+    private static final ConcurrentMap<String, Class<?>> name2ClassCache = new ConcurrentHashMap<String, Class<?>>();
     private static final ConcurrentMap<Class<?>, String> class2NameCache = new ConcurrentHashMap<Class<?>, String>();
 
     private static final String[] PRIMITIVE_NAMES = new String[] {""boolean"", ""byte"", ""char"", ""double"", ""float"", ""int"", ""long"", ""short"",
@@ -129,10 +129,8 @@
 
         clz = forNameWithoutCache(className);
 
-        if (clz != null) {
             // 应该没有内存消耗过多的可能，除非有些代码很恶心，创建特别多的类
-            name2ClassCache.put(className, clz);
-        }
+        name2ClassCache.putIfAbsent(className, clz);
 
         return clz;
     }
@@ -308,4 +306,5 @@
             return null;
         }
     }
+
 }",0
OaIdl.INVOKEKIND can't be instantiated (fixes failing TypeLibUtilTest),"                 Structure.ByReference {
         };
 
+        public static final List<String> FIELDS = createFieldsOrder(""value"");
+        
         // / <i>native declaration : line 30</i>
         public static final INVOKEKIND INVOKE_FUNC = new INVOKEKIND(1);
         // / <i>native declaration : line 31</i>
@@ -1084,7 +1086,6 @@
         // / <i>native declaration : line 33</i>
         public static final INVOKEKIND INVOKE_PROPERTYPUTREF = new INVOKEKIND(8);
 
-        public static final List<String> FIELDS = createFieldsOrder(""value"");
         public int value;
 
         public INVOKEKIND() {",0
[BACKLOG-24282] Minor fix to the MDI analyzer - should override newInstance method instead of cloneAnaalyzer,"     }
   }
 
-  @Override public IClonableStepAnalyzer cloneAnalyzer() {
+  @Override protected IClonableStepAnalyzer newInstance() {
     return new MetaInjectAnalyzer();
   }
 ",0
 修复PhotopagerActivity最后一张不能删除的bug,"             .setPositiveButton(R.string.__picker_yes, new DialogInterface.OnClickListener() {
               @Override public void onClick(DialogInterface dialogInterface, int i) {
                 dialogInterface.dismiss();
-                setResult(RESULT_OK);
-                finish();
+                pagerFragment.getPaths().remove(index);
+                pagerFragment.getViewPager().getAdapter().notifyDataSetChanged();
+                onBackPressed();
               }
             })
             .setNegativeButton(R.string.__picker_cancel, new DialogInterface.OnClickListener() {",0
Fixes #2265,"                 throw new IllegalArgumentException(""No block found for '"" + uri + ""'"");
             }
         } else if (matchingUris.isEmpty()) {
-            throw new IllegalArgumentException(""No block found for '"" + uri + ""'"");
+        	return suggestItemIfAvailable(uri);
         } else {
             StringBuilder builder = new StringBuilder();
             builder.append(""Non-unique block name, possible matches: "");
@@ -228,6 +228,23 @@
     }
 
     /**
+     * Tells players that their request matched no blocks, and directs them to giveItem if an item matches.
+     * 
+     * @param uri the URI to use to look for an item
+     */
+    private String suggestItemIfAvailable(String uri){
+    	Set<ResourceUrn> matchingItems = assetManager.resolve(uri, Prefab.class);
+    	StringBuilder result = new StringBuilder();
+    	result.append(""No block found for ""+uri);
+    	if(matchingItems.size() != 0){
+    		result.append("". "");
+    		result.append(""Item matches found, use 'giveItem' to request one: "");
+    		Joiner.on("", "").appendTo(result, matchingItems);
+    	}
+    	return result.toString();
+    }
+
+    /**
      * Actual implementation of the giveBlock command.
      *
      * @param blockFamily the block family of the queried block",0
Fix udf serialization ,"     public List<NamedXContentRegistry.Entry> getNamedXContent() {
         List<NamedXContentRegistry.Entry> entries = new ArrayList<>();
         entries.add(new NamedXContentRegistry.Entry(
-            UserDefinedFunctionsMetaData.class,
+            MetaData.Custom.class,
             new ParseField(UserDefinedFunctionsMetaData.TYPE),
             UserDefinedFunctionsMetaData::fromXContent
         ));",0
Config usage bugfix.," import org.glassfish.grizzly.ssl.SSLEngineConfigurator;
 import org.glassfish.grizzly.ssl.SSLFilter;
 import org.glassfish.grizzly.strategies.SameThreadIOStrategy;
+import org.glassfish.grizzly.strategies.WorkerThreadIOStrategy;
 import org.glassfish.grizzly.utils.BufferOutputStream;
 import org.glassfish.grizzly.utils.DelayedExecutor;
 import org.glassfish.grizzly.utils.IdleTimeoutFilter;
@@ -104,6 +105,7 @@
 import java.util.Map;
 import java.util.concurrent.Callable;
 import java.util.concurrent.ExecutionException;
+import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Semaphore;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.TimeoutException;
@@ -225,6 +227,10 @@
         try {
             connectionManager.destroy();
             clientTransport.stop();
+            final ExecutorService service = clientConfig.executorService();
+            if (service != null) {
+                service.shutdown();
+            }
             if (timeoutExecutor != null) {
                 timeoutExecutor.stop();
             }
@@ -278,8 +284,6 @@
 
     protected void initializeTransport(AsyncHttpClientConfig clientConfig) {
         
-
-
         final FilterChainBuilder fcb = FilterChainBuilder.stateless();
         fcb.add(new AsyncHttpClientTransportFilter());
 
@@ -363,10 +367,10 @@
             if (customizer != null) {
                 customizer.customize(clientTransport, fcb);
             } else {
-                clientTransport.setIOStrategy(SameThreadIOStrategy.getInstance());
+                doDefaultTransportConfig();
             }
         } else {
-            clientTransport.setIOStrategy(SameThreadIOStrategy.getInstance());
+            doDefaultTransportConfig();
         }
 
         clientTransport.setProcessor(fcb.build());
@@ -402,6 +406,16 @@
 
     // --------------------------------------------------------- Private Methods
 
+    private void doDefaultTransportConfig() {
+        final ExecutorService service = clientConfig.executorService();
+        if (service != null) {
+            clientTransport.setIOStrategy(WorkerThreadIOStrategy.getInstance());
+            clientTransport.setWorkerThreadPool(service);
+        } else {
+            clientTransport.setIOStrategy(SameThreadIOStrategy.getInstance());
+        }
+    }
+
 
     private <T> CompletionHandler<WriteResult> createWriteCompletionHandler(final GrizzlyResponseFuture<T> future) {
         return new CompletionHandler<WriteResult>() {",0
adding somebytes column that was missing from CREATE TABLE TweetsTable,"     @NonNull
     public static final String COLUMN_CONTENT = ""content"";
 
+    public static final String COLUMN_SOME_BYTES = ""some_bytes"";
+
     // Yep, with StorIO you can safely store queries as objects and reuse them, they are immutable
     @NonNull
     public static final Query QUERY_ALL = Query.builder()
@@ -44,7 +46,8 @@
         return ""CREATE TABLE "" + TABLE + ""(""
                 + COLUMN_ID + "" INTEGER NOT NULL PRIMARY KEY, ""
                 + COLUMN_AUTHOR + "" TEXT NOT NULL, ""
-                + COLUMN_CONTENT + "" TEXT NOT NULL""
+                + COLUMN_CONTENT + "" TEXT NOT NULL,""
+                + COLUMN_SOME_BYTES + "" BLOB ""
                 + "");"";
     }
 }",0
cpd: fix #1144 CPD encoding argument has no effect,"     	 String languageString = findOptionalStringValue(args, ""--language"", ""java"");
     	 language = new LanguageFactory().createLanguage(languageString);
     	 
-         String formatString = findOptionalStringValue(args, ""--format"", ""text"");
-         renderer = getRendererFromString(formatString);
-         
          final String systemDefaultEncoding = System.getProperty(""file.encoding"");
          setEncoding( findOptionalStringValue(args, ""--encoding"", systemDefaultEncoding) );
 
+         String formatString = findOptionalStringValue(args, ""--format"", ""text"");
+         renderer = getRendererFromString(formatString);
+
          minimumTileSize = Integer.parseInt(findRequiredStringValue(args, ""--minimum-tokens""));
          
          skipDuplicates = findBooleanSwitch(args, ""--skip-duplicate-files"");",0
Fixed logging delegate name for Log4j,"  * <p>
  * If you would prefer to use Log4J or SLF4J instead of JUL then you can set a system property called
  * {@code vertx.logger-delegate-factory-class-name} to the class name of the delegate for your logging system.
- * For Log4J the value is {@code io.vertx.core.logging.impl.Log4JLogDelegateFactory}, for SLF4J the value
+ * For Log4J the value is {@code io.vertx.core.logging.Log4jLogDelegateFactory}, for SLF4J the value
  * is {@code io.vertx.core.logging.SLF4JLogDelegateFactory}. You will need to ensure whatever jar files
  * required by your favourite log framework are on your classpath.
  *",0
Fix addTypes not adding in the base types.,"             type.biomes.add(biome);
         }
 
-        getBiomeInfo(biome).types.addAll(supertypes);
+        BiomeInfo biomeInfo = getBiomeInfo(biome);
+        Collections.addAll(biomeInfo.types, types);
+        biomeInfo.types.addAll(supertypes);
     }
 
     /**",0
"[KEYCLOAK-7985] fix the table name error,  from RESOURCE_URI to RESOURCE_URIS","                         String resourceId = resultSet.getString(1);
                         String resourceUri = resultSet.getString(2);
 
-                        InsertStatement insertComponent = new InsertStatement(null, null, database.correctObjectName(""RESOURCE_URI"", Table.class))
+                        InsertStatement insertComponent = new InsertStatement(null, null, database.correctObjectName(""RESOURCE_URIS"", Table.class))
                                 .addColumnValue(""RESOURCE_ID"", resourceId)
                                 .addColumnValue(""VALUE"", resourceUri);
 
@@ -36,7 +36,7 @@
                 statement.close();
             }
 
-            confirmationMessage.append(""Moved "" + statements.size() + "" records from RESOURCE_SERVER_RESOURCE to RESOURCE_URI table"");
+            confirmationMessage.append(""Moved "" + statements.size() + "" records from RESOURCE_SERVER_RESOURCE to RESOURCE_URIS table"");
         } catch (Exception e) {
             throw new CustomChangeException(getTaskId() + "": Exception when updating data from previous version"", e);
         }",0
Prevent NPE in GelfChunkAggregator#checkForCompletion(),"             final byte[] allChunks[] = new byte[sequenceCount][];
             for (int i = 0; i < entry.payloadArray.length(); i++) {
                 final GELFMessageChunk messageChunk = entry.payloadArray.get(i);
+                if (messageChunk == null) {
+                    log.debug(""Couldn't read chunk {} of message {}, skipping this chunk."", i, messageId);
+                } else {
                 allChunks[i] = messageChunk.getData();
-
+                }
             }
             completeMessages.inc();
             return ChannelBuffers.wrappedBuffer(allChunks);",0
修复无排序时结果集大小bug,"             {
                 end=results.size();
             }
-			if (rrs.getOrderByCols() == null) {
-				end = results.size();
-				start = 0;
-			}
+//			if (rrs.getOrderByCols() == null) {
+//				end = results.size();
+//				start = 0;
+//			}
 			for (int i = start; i < end; i++) {
 				RowDataPacket row = results.get(i);
 				row.packetId = ++packetId;",0
Fix bug where selectize rules failed when using entity ids while finding Iterable intersections," 	    if (a == null || b == null) {
 	        return Collections.EMPTY_LIST;
         }
-		if (a instanceof String) {
-			return intersectString((String) a, (Iterable<String>) b);
-		} else {
-			return intersectIterable((Iterable) a, (Iterable) b);
-		}
+        Iterable iterableA = a instanceof Iterable ? (Iterable) a : Collections.singletonList(String.valueOf(a));
+        Iterable iterableB = b instanceof Iterable ? (Iterable) b : Collections.singletonList(String.valueOf(b));
+        return intersectIterable(iterableA, iterableB);
 	}
 
     private static Collection intersectIterable(final Iterable a, final Iterable b) {
@@ -88,10 +86,4 @@
         return CollectionUtils.intersection(temp, b);
     }
 
-    private static Collection<String> intersectString(final String a, final Iterable<String> b) {
-        List<String> temp = new ArrayList<>();
-        temp.add(a);
-        return CollectionUtils.intersection(temp, b);
-    }
-
 }",0
Fixed a bug with item model loading ,"             throw new IllegalStateException(""circular model dependencies involving model "" + location);
         }
         loadingModels.add(location);
+        try
+        {
         IModel model = ModelLoaderRegistry.getModel(location);
         for(ResourceLocation dep : model.getDependencies())
         {
             getModel(dep);
+               
         }
         textures.addAll(model.getTextures());
+        }
+        finally
+        {
         loadingModels.remove(location);
     }
+    }
 
     private class VanillaModelWrapper implements IRetexturableModel
     {",0
HHH-13330: Fix a minor typo in ManagedBeanRegistryInitiator," 	public ManagedBeanRegistry initiateService(
 			Map configurationValues,
 			ServiceRegistryImplementor serviceRegistry) {
-		return new ManagedBeanRegistryImpl( resoveBeanContainer( configurationValues, serviceRegistry ) );
+		return new ManagedBeanRegistryImpl( resolveBeanContainer( configurationValues, serviceRegistry ) );
 	}
 
-	private BeanContainer resoveBeanContainer(Map configurationValues, ServiceRegistryImplementor serviceRegistry) {
+	private BeanContainer resolveBeanContainer(Map configurationValues, ServiceRegistryImplementor serviceRegistry) {
 		final ClassLoaderService classLoaderService = serviceRegistry.getService( ClassLoaderService.class );
 		final ConfigurationService cfgSvc = serviceRegistry.getService( ConfigurationService.class );
 ",0
[C++] Fix indentation.,,0
Fixed NullPointerException #62,"         private SavedState(Parcel in) {
             super(in);
             mInputPointer = in.readInt();
-            in.readIntArray(mInput);
+            mInput = in.createIntArray();
             mAmPmState = in.readInt();
         }
 ",0
Use the currency of the order instead of the default currency in checkout,"         // Add authorize and authorize_and_capture transactions;
         // there should only be one or the other in the payment
         // Also add any pending transactions (as these are marked as being AUTH or CAPTURED later)
-        Money paymentSum = new Money(BigDecimal.ZERO);
+        Money paymentSum = new Money(BigDecimal.ZERO, order.getCurrency());
         for (OrderPayment payment : order.getPayments()) {
             if (payment.isActive()) {
                 paymentSum = paymentSum.add(payment.getSuccessfulTransactionAmountForType(PaymentTransactionType.AUTHORIZE))",0
Fix ACM group.," 
 	private static final String DIAMOND_PROPERTY_SOURCE_NAME = ""diamond"";
 
-	private static String defaultDiamondGroup = ""DEFAULT_GROUP"";
-
 	private AcmPropertySourceBuilder acmPropertySourceBuilder = new AcmPropertySourceBuilder();
 
 	@Autowired
@@ -45,14 +43,14 @@
 				DIAMOND_PROPERTY_SOURCE_NAME);
 
 		for (String dataId : acmIntegrationProperties.getGroupConfigurationDataIds()) {
-			loadDiamondDataIfPresent(compositePropertySource, dataId, defaultDiamondGroup,
-					true);
+			loadDiamondDataIfPresent(compositePropertySource, dataId,
+					acmIntegrationProperties.getAcmProperties().getGroup(), true);
 		}
 
 		for (String dataId : acmIntegrationProperties
 				.getApplicationConfigurationDataIds()) {
-			loadDiamondDataIfPresent(compositePropertySource, dataId, defaultDiamondGroup,
-					false);
+			loadDiamondDataIfPresent(compositePropertySource, dataId,
+					acmIntegrationProperties.getAcmProperties().getGroup(), false);
 		}
 
 		return compositePropertySource;",0
fixed `retweets' param,"                 new HttpParameter[]{
                         new HttpParameter(""screen_name"", screenName),
                         new HttpParameter(""device"", enableDeviceNotification),
-                        new HttpParameter(""retweets"", enableDeviceNotification)
+                        new HttpParameter(""retweets"", retweets)
                 }));
     }
 ",0
Fix formatting," 																														element.width = $wnd.screen.width;
 																														element.height = $wnd.screen.height;
 																														element.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
-																														$doc.addEventListener(""webkitfullscreenchange"", function() {
+			$doc
+					.addEventListener(
+							""webkitfullscreenchange"",
+							function() {
 																														graphics.@com.badlogic.gdx.backends.gwt.GwtGraphics::fullscreenChanged()();
 																														}, false);
 																														return true;
@@ -172,7 +175,10 @@
 																														element.width = $wnd.screen.width;
 																														element.height = $wnd.screen.height;
 																														element.mozRequestFullScreen();
-																														$doc.addEventListener(""mozfullscreenchange"", function() {
+			$doc
+					.addEventListener(
+							""mozfullscreenchange"",
+							function() {
 																														graphics.@com.badlogic.gdx.backends.gwt.GwtGraphics::fullscreenChanged()();
 																														}, false);
 																														return true;
@@ -181,8 +187,10 @@
 																														}-*/;
 
 	private native void exitFullscreen () /*-{
-														if($doc.webkitExitFullscreen) $doc.webkitExitFullscreen();
-														if($doc.mozExitFullscreen) $doc.mozExitFullscreen();
+		if ($doc.webkitExitFullscreen)
+			$doc.webkitExitFullscreen();
+		if ($doc.mozExitFullscreen)
+			$doc.mozExitFullscreen();
 														}-*/;
 
 	@Override",0
varinspector: Lazily initialize var arrays," 
 	private int lastTick = 0;
 
-	private final int[] oldVarps;
-	private final int[] oldVarps2;
+	private int[] oldVarps = null;
+	private int[] oldVarps2 = null;
 	private int numVarbits = 10000;
 
-	private final int[] oldIntVarcs;
-	private final String[] oldStrVarcs;
+	private int[] oldIntVarcs = null;
+	private String[] oldStrVarcs = null;
 
 	@Inject
 	VarInspector(Client client, EventBus eventBus)
 	{
 		this.eventBus = eventBus;
 		this.client = client;
-		oldVarps = new int[client.getVarps().length];
-		oldVarps2 = new int[client.getVarps().length];
-		oldIntVarcs = new int[client.getIntVarcs().length];
-		oldStrVarcs = new String[client.getStrVarcs().length];
 
 		setTitle(""RuneLite Var Inspector"");
 		setIconImage(ClientUI.ICON);
@@ -330,6 +326,14 @@
 
 	public void open()
 	{
+		if (oldVarps == null)
+		{
+			oldVarps = new int[client.getVarps().length];
+			oldVarps2 = new int[client.getVarps().length];
+			oldIntVarcs = new int[client.getIntVarcs().length];
+			oldStrVarcs = new String[client.getStrVarcs().length];
+		}
+
 		System.arraycopy(client.getVarps(), 0, oldVarps, 0, oldVarps.length);
 		System.arraycopy(client.getVarps(), 0, oldVarps2, 0, oldVarps2.length);
 		System.arraycopy(client.getIntVarcs(), 0, oldIntVarcs, 0, oldIntVarcs.length);",0
fixed classpathresolver again for windows,"       if (url != null) {
         String sfile = url.getFile();
         if (sfile != null) {
-          return Paths.get(spath);
+          return Paths.get(sfile);
         }
       }
     }",0
Sample: Fix CharacteristicOperationExample not updating UI,"         } else {
             connectionObservable.subscribe(rxBleConnection -> {
                 Log.d(getClass().getSimpleName(), ""Hey, connection has been established!"");
+                runOnUiThread(this::updateUI);
             }, this::onConnectionFailure);
         }
-
-        updateUI();
     }
 
     private boolean isConnected() {",0
Fixed adding --webdriver-logfile and --webdriver CLI arguments through t...,"                     // Add the canonical path to GhostDriver
                     argsBuilder.add(ghostdriver.getCanonicalPath());
 
-                    // Add the port to listed on
+                    // Add the port to listen on (if not specified in command line args)
+                    if (!argsContains(this.ghostdriverCommandLineArguments, ""port"")) {
                     argsBuilder.add(String.format(""--port=%d"", port));
+                    }
 
-                    // Add Log File
-                    if (logFile != null) {
+                    // Add Log File (if not specified in command line args)
+                    if (logFile != null && !argsContains(this.ghostdriverCommandLineArguments, ""logFile"")) {
                         argsBuilder.add(String.format(""--logFile=%s"", logFile.getAbsolutePath()));
                     }
 
@@ -519,11 +521,13 @@
                     }
                 } else { //< Path to GhostDriver not provided: use PhantomJS's internal GhostDriver (default behaviour)
 
-                    // Append required parameters
+                    // Append required parameters (if not specified in command line args)
+                    if (!argsContains(this.commandLineArguments, ""webdriver"")) {
                     argsBuilder.add(String.format(""--webdriver=%d"", port));
+                    }
 
-                    // Add Log File
-                    if (logFile != null) {
+                    // Add Log File (if not specified in command line args)
+                    if (logFile != null && !argsContains(this.commandLineArguments, ""webdriver-logfile"")) {
                         argsBuilder.add(String.format(""--webdriver-logfile=%s"", logFile.getAbsolutePath()));
                     }
                 }
@@ -534,5 +538,18 @@
                 throw new WebDriverException(e);
             }
         }
+
+        private boolean argsContains(String[] args, String targetArg) {
+            if (args != null) {
+                for (int i = 0; i < args.length; i++) {
+                    String arg = args[i];
+                    if (arg.startsWith(""--"" + targetArg + ""="")) {
+                        return true;
+                    }
+                }
+            }
+
+            return false;
+        }
     }
 }",0
Ensure OpenSslEngine will not try to call SSL_free multiple times eve…,"                 // setMode may impact the overhead.
                 calculateMaxWrapOverhead();
             } catch (Throwable cause) {
-                SSL.freeSSL(ssl);
+                // Call shutdown so we are sure we correctly release all native memory and also guard against the
+                // case when shutdown() will be called by the finalizer again. If we would call SSL.free(...) directly
+                // the finalizer may end up calling it again as we would miss to update the DESTROYED_UPDATER.
+                shutdown();
+
                 PlatformDependent.throwException(cause);
             }
         }",0
[JENKINS-42670] - Fix the potential File descriptor leak in the Windows Service installer,"         try {
             return Kernel32Utils.waitForExitProcess(sei.hProcess);
         } finally {
-            FileInputStream fin = new FileInputStream(new File(pwd,""redirect.log""));
+            try (FileInputStream fin = new FileInputStream(new File(pwd,""redirect.log""))) {
             IOUtils.copy(fin, out.getLogger());
-            fin.close();
+            }
         }
     }
 ",0
Fix dataflow gap,"         continue;
       }
 
+      //don't link self-dependency
+      if(search.getInstruction() == instruction)
+        continue;
+
       if (ReilHelpers.writesThirdOperand(instruction.getMnemonicCode())
           && instruction.getThirdOperand().getValue().equals(value)) {
         final List<OperandGraphNode> nodes = graphMap.get(block).first();",0
"Revert ""Recycle OpAddEntry when ledger-ops fails (#1415)""","         if (cb != null) {
             cb.addFailed(e, ctx);
             ml.mbean.recordAddEntryError();
-            this.recycle();
         }
     }
 ",0
Fix JSF bean validation tests when using non US locale. ,"     @Size(min = 3, message = ""At least 3 characters"")
     private String name;
 
-    @Min(18)
-    @Max(25)
+    @Min(value=18, message= ""must be greater than or equal to 18"")
+    @Max(value=25, message= ""must be less than or equal to 25"")
     private int age;
 
-    @Pattern(regexp = ""[0-9]{5}"")
+    @Pattern(regexp = ""[0-9]{5}"", message= ""must match \""[0-9]{5}\"""")
     private String zip;
 
     public String getName() {",0
Fix Sonic still send request in FirstLoad mode when server return Cac…,"             sessionData.unAvailableTime = unavailableTime;
             updateSessionData(db, sessionId, sessionData);
             return true;
+        } else {
+            sessionData = new SessionData();
+            sessionData.sessionId = sessionId;
+            sessionData.eTag = ""Unknown"";
+            sessionData.htmlSha1 = ""Unknown"";
+            sessionData.unAvailableTime = unavailableTime;
+            insertSessionData(db, sessionId, sessionData);
+            return true;
         }
-        return false;
     }
 
     /**",0
Fix TimeLwjgl ref," 
 public abstract class TimeBase implements EngineTime {
 
-    private static final Logger logger = LoggerFactory.getLogger(TimeLwjgl.class);
+    private static final Logger logger = LoggerFactory.getLogger(TimeBase.class);
     private static final float DECAY_RATE = 0.95f;
     private static final float ONE_MINUS_DECAY_RATE = 1.0f - DECAY_RATE;
     private static final float RESYNC_TIME_RATE = 0.1f;",0
Fix default log level," 
 public final class LoggerContext {
 
-	public static final Option OPTION_LOG_LEVEL = new Option(""logLevel"", ""DEBUG"");
+	public static final Option OPTION_LOG_LEVEL = new Option(""logLevel"", ""WARN"");
 	public static final Option OPTION_LOG_APPENDER_CONSOLE = new Option(""logAppenderConsole"", ""false"");
 	public static final Option OPTION_LOG_APPENDER_FILE = new Option(""logAppenderFile"", ""true"");
 
 	private static LoggerContext instance = null;
-	private static final Level DEFAULT_LEVEL = Level.DEBUG;
+	private static final Level DEFAULT_LEVEL = Level.WARN;
 
 	private Level currentLevel = DEFAULT_LEVEL;
 	private List<Appender> appenders = new ArrayList<>();",0
Fixed typo of canvasId in the gwt configuration.," 	public Panel rootPanel;
 	/** the id of a canvas element to be used as the drawing area, can be null in which case a Panel and Canvas are added to the
 	 * body element of the DOM **/
-	public String canavsId;
+	public String canvasId;
 	/** a TextArea to log messages to, can be null in which case a TextArea will be added to the body element of the DOM. */
 	public TextArea log;
 	/** whether to use debugging mode for OpenGL calls. Errors will result in a RuntimeException being thrown. */",0
fix #1194," import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
+import java.util.Set;
 
 import io.mycat.net.mysql.RowDataPacket;
 import io.mycat.util.ByteUtil;
@@ -229,7 +231,7 @@
 			return;
 		}
 
-
+		Set<Integer> rmIndexSet = new HashSet<Integer>();
 		for (MergeCol merg : mergCols) {
 			if(merg.mergeType==MergeCol.MERGE_AVG)
 			{
@@ -240,12 +242,16 @@
 				if (result != null)
 				{
 					toRow.fieldValues.set(merg.colMeta.avgSumIndex, result);
-					toRow.fieldValues.remove(merg.colMeta.avgCountIndex) ;
+//					toRow.fieldValues.remove(merg.colMeta.avgCountIndex) ;
+//					toRow.fieldCount=toRow.fieldCount-1;
+					rmIndexSet.add(merg.colMeta.avgCountIndex);
+				}
+			}
+		}
+		for(Integer index : rmIndexSet) {
+			toRow.fieldValues.remove(index);
 					toRow.fieldCount=toRow.fieldCount-1;
 				}
-			}
-		}
-
 
 
 	}",0
1.4 cherry pick: JENKINS-48198 - Add logging when a property is skipped (#1625)," package io.jenkins.blueocean.commons.stapler.export;
 
-import org.kohsuke.stapler.export.Exported;
-
 import java.io.IOException;
 import java.lang.reflect.InvocationTargetException;
+import java.util.logging.Level;
+import java.util.logging.Logger;
 
 /**
  * Allows caller to intercept exporting of properties.
@@ -14,6 +14,9 @@
  * @author James Dumay
  */
 public abstract class ExportInterceptor {
+
+    public static final Logger LOGGER = Logger.getLogger(ExportInterceptor.class.getName());
+
     /**
      * Constant to tell if return of {@link ExportInterceptor#getValue(Property, Object, ExportConfig)} should be skipped.
      *
@@ -43,6 +46,7 @@
                 return property.getValue(model);
             } catch (IllegalAccessException | InvocationTargetException e) {
                 if(config.isSkipIfFail()) {
+                    LOGGER.log(Level.WARNING,""Failed to get \"""" + property.name + ""\"" from a "" + model.getClass().getName(), e);
                     return SKIP;
                 }
                 throw new IOException(""Failed to write "" + property.name + "":"" + e.getMessage(), e);",0
Fix copy of default file from source with new home,"     }
 
     private static void copyFileToHome(Path targetFile, String sourceFilePath, String fallbackResource) throws IOException {
-        Path defaultConfig = Paths.get(zapInstall, sourceFilePath);
+        Path defaultConfig = Paths.get(getZapInstall(), sourceFilePath);
         if (Files.exists(defaultConfig)) {
             Files.copy(defaultConfig, targetFile, StandardCopyOption.REPLACE_EXISTING);
         } else {",0
"Revert ""Fix issues with Android BackHandler"""," 
     @Override
     public void invokeDefaultOnBackPressed() {
-        if (layout != null && !layout.onBackPressed()) {
             super.onBackPressed();
         }
-    }
 
     @Override
     public void onBackPressed() {
-        if (getReactGateway().isInitialized()) {
+        if (layout != null && !layout.onBackPressed()) {
             getReactGateway().onBackPressed();
         }
     }",0
Fixes #802. Trigger events for alt labels in parser listeners.," 			}
 		}
 		_ctx = localctx;
+		if ( _parseListeners != null ) {
+			triggerEnterRuleEvent();
+		}
 	}
 
 	/**",0
Fix UseShippingAddress for mixed Shippable/Nonshippable orders," import org.broadleafcommerce.common.payment.PaymentGatewayType;
 import org.broadleafcommerce.common.payment.PaymentType;
 import org.broadleafcommerce.core.order.domain.Order;
+import org.broadleafcommerce.core.order.service.FulfillmentGroupService;
 import org.broadleafcommerce.core.payment.domain.OrderPayment;
 import org.broadleafcommerce.core.pricing.service.exception.PricingException;
 import org.broadleafcommerce.core.web.checkout.model.PaymentInfoForm;
@@ -47,6 +48,9 @@
     @Resource(name = ""blSavedPaymentService"")
     protected SavedPaymentService savedPaymentService;
 
+    @Resource(name = ""blFulfillmentGroupService"")
+    protected FulfillmentGroupService fulfillmentGroupService;
+
     /**
      * Processes the request to save an {@link OrderPayment} based on an existing or new {@link CustomerPayment}.
      *
@@ -168,8 +172,8 @@
      * to the billing address on the PaymentInfoForm that is passed in.
      */
     protected void copyShippingAddressToBillingAddress(Order order, PaymentInfoForm paymentInfoForm) {
-        if (order.getFulfillmentGroups().get(0) != null) {
-            Address shipping = order.getFulfillmentGroups().get(0).getAddress();
+        if (fulfillmentGroupService.getFirstShippableFulfillmentGroup(order) != null) {
+            Address shipping = fulfillmentGroupService.getFirstShippableFulfillmentGroup(order).getAddress();
             if (shipping != null) {
                 Address billing = addressService.copyAddress(shipping) ;
                 paymentInfoForm.setAddress(billing);",0
Fixed Skin.getTiledDrawable," 		if (tiled != null) return tiled;
 
 		Drawable drawable = optional(name, Drawable.class);
-		if (tiled != null) {
+		if (drawable != null) {
 			if (!(drawable instanceof TiledDrawable)) {
 				throw new GdxRuntimeException(""Drawable found but is not a TiledDrawable: "" + name + "", ""
 					+ drawable.getClass().getName());
 			}
-			return tiled;
+			return (TiledDrawable)drawable;
 		}
 
 		tiled = new TiledDrawable(getRegion(name));",0
Fix RequestProcessor.removeSpiceServiceListener to actually remove listener rather than adding it again,"     }
 
     public void removeSpiceServiceListener(final SpiceServiceServiceListener spiceServiceServiceListener) {
-        this.spiceServiceListenerSet.add(spiceServiceServiceListener);
+        this.spiceServiceListenerSet.remove(spiceServiceServiceListener);
     }
 
     protected void notifyOfRequestProcessed(final CachedSpiceRequest<?> request) {",0
Fix mongo to pass with testsuite,"     public List<UserSessionModel> getUserSessions(RealmModel realm, ClientModel client, int firstResult, int maxResults) {
         DBObject query = new QueryBuilder()
                 .and(""clientId"").is(client.getId())
+                .and(""sessionId"").notEquals(null)
                 .get();
         DBObject sort = new BasicDBObject(""timestamp"", 1).append(""id"", 1);
 
@@ -142,7 +143,11 @@
 
     @Override
     public int getActiveUserSessions(RealmModel realm, ClientModel client) {
-        return getUserSessions(realm, client).size();
+        DBObject query = new QueryBuilder()
+                .and(""clientId"").is(client.getId())
+                .and(""sessionId"").notEquals(null)
+                .get();
+        return mongoStore.countEntities(MongoClientSessionEntity.class, query, invocationContext);
     }
 
     @Override",0
Fixes #1726 (precision problems in intersectSegmentPolygon and intersectLinePolygon).," 
 package com.badlogic.gdx.math;
 
-import com.badlogic.gdx.Gdx;
 import com.badlogic.gdx.math.Plane.PlaneSide;
 import com.badlogic.gdx.math.collision.BoundingBox;
 import com.badlogic.gdx.math.collision.Ray;
@@ -671,23 +670,22 @@
 	public static boolean intersectLinePolygon (Vector2 p1, Vector2 p2, Polygon polygon) {
 		float[] vertices = polygon.getTransformedVertices();
 		float x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y;
-		float width12 = x1 - x2, height12 = y1 - y2;
-		float det1 = x1 * y2 - y1 * x2;
 		int n = vertices.length;
 		float x3 = vertices[n - 2], y3 = vertices[n - 1];
 		for (int i = 0; i < n; i += 2) {
 			float x4 = vertices[i], y4 = vertices[i + 1];
-			float det2 = x3 * y4 - y3 * x4;
-			float width34 = x3 - x4, height34 = y3 - y4;
-			float det3 = width12 * height34 - height12 * width34;
-			float x = (det1 * width34 - width12 * det2) / det3;
-			if ((x >= x3 && x <= x4) || (x >= x4 && x <= x3)) {
-				float y = (det1 * height34 - height12 * det2) / det3;
-				if ((y >= y3 && y <= y4) || (y >= y4 && y <= y3)) return true;
+			  float d = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);
+			  if (d != 0) {
+					float yd = y1 - y3;
+					float xd = x1 - x3;
+					float ua = ((x4 - x3) * yd - (y4 - y3) * xd) / d;
+					if (ua >= 0 && ua <= 1) {
+						 return true;
 			}
 			x3 = x4;
 			y3 = y4;
 		}
+		 }
 		return false;
 	}
 
@@ -709,27 +707,29 @@
 	/** Check whether the given line segment and {@link Polygon} intersect.
 	 * @param p1 The first point of the segment
 	 * @param p2 The second point of the segment
-	 * @return Whether polygon and line intersects */
+	  * @return Whether polygon and segment intersect */
 	public static boolean intersectSegmentPolygon (Vector2 p1, Vector2 p2, Polygon polygon) {
 		float[] vertices = polygon.getTransformedVertices();
 		float x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y;
-		float width12 = x1 - x2, height12 = y1 - y2;
-		float det1 = x1 * y2 - y1 * x2;
 		int n = vertices.length;
 		float x3 = vertices[n - 2], y3 = vertices[n - 1];
 		for (int i = 0; i < n; i += 2) {
 			float x4 = vertices[i], y4 = vertices[i + 1];
-			float det2 = x3 * y4 - y3 * x4;
-			float width34 = x3 - x4, height34 = y3 - y4;
-			float det3 = width12 * height34 - height12 * width34;
-			float x = (det1 * width34 - width12 * det2) / det3;
-			if (((x >= x3 && x <= x4) || (x >= x4 && x <= x3)) && ((x >= x1 && x <= x2) || (x >= x2 && x <= x1))) {
-				float y = (det1 * height34 - height12 * det2) / det3;
-				if (((y >= y3 && y <= y4) || (y >= y4 && y <= y3)) && ((y >= y1 && y <= y2) || (y >= y2 && y <= y1))) return true;
+				float d = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1);
+				if (d != 0) {
+					 float yd = y1 - y3;
+					 float xd = x1 - x3;
+					 float ua = ((x4 - x3) * yd - (y4 - y3) * xd) / d;
+					 if (ua >= 0 && ua <= 1) {
+						  float ub = ((x2 - x1) * yd - (y2 - y1) * xd) / d;
+						  if (ub >= 0 && ub <= 1) {
+								return true;
+						  }
 			}
 			x3 = x4;
 			y3 = y4;
 		}
+		  }
 		return false;
 	}
 ",0
"Revert ""Fixes NPE when initializing twice"""," 	private void prepareReactApp() {
 		if (shouldCreateContext()) {
 			reactInstanceManager.createReactContextInBackground();
+		} else if (waitingForAppLaunchEvent) {
+			emitAppLaunched();
 		}
 	}
 
-	private void emitAppLaunched(final ReactContext context) {
-		if (waitingForAppLaunchEvent) {
+	private void emitAppLaunched() {
 			waitingForAppLaunchEvent = false;
-			new NavigationEvent(context).appLaunched();
-		}
+		new NavigationEvent(reactInstanceManager.getCurrentReactContext()).appLaunched();
 	}
 
 	private boolean shouldCreateContext() {
@@ -61,6 +61,6 @@
 
 	@Override
 	public void onReactContextInitialized(final ReactContext context) {
-		emitAppLaunched(context);
+		emitAppLaunched();
 	}
 }",0
Fix typo in error message,"         long loadTime = cache.statsTicker().read() - startTime;
         if (value == null) {
           if (error != null) {
-            logger.log(Level.WARNING, ""Exception thrown during asynchonous load"", error);
+            logger.log(Level.WARNING, ""Exception thrown during asynchronous load"", error);
           }
           cache.statsCounter().recordLoadFailure(loadTime);
           cache.remove(key, result[0]);
@@ -241,7 +241,7 @@
       long loadTime = cache.statsTicker().read() - startTime;
       if (value == null) {
         if (error != null) {
-          logger.log(Level.WARNING, ""Exception thrown during asynchonous load"", error);
+          logger.log(Level.WARNING, ""Exception thrown during asynchronous load"", error);
         }
         cache.remove(key, valueFuture);
         cache.statsCounter().recordLoadFailure(loadTime);
@@ -281,7 +281,7 @@
           entry.getValue().obtrudeException(error);
         }
         cache.statsCounter().recordLoadFailure(loadTime);
-        logger.log(Level.WARNING, ""Exception thrown during asynchonous load"", error);
+        logger.log(Level.WARNING, ""Exception thrown during asynchronous load"", error);
       } else {
         fillProxies(result);
         addNewEntries(result);",0
Fixed bug of AES URI Pattern for hls,"   private static final Pattern METHOD_ATTR_REGEX =
       Pattern.compile(METHOD_ATTR + ""=("" + METHOD_NONE + ""|"" + METHOD_AES128 + "")"");
   private static final Pattern URI_ATTR_REGEX =
-      Pattern.compile(URI_ATTR + ""=\""(.+)\"""");
+      Pattern.compile(URI_ATTR + ""=\""(.+?)\"""");
   private static final Pattern IV_ATTR_REGEX =
       Pattern.compile(IV_ATTR + ""=([^,.*]+)"");
   private static final Pattern TYPE_ATTR_REGEX =",0
Fix bug when tabHost has only two tabs.," 
     // Disable the Scroll Bar
     setHorizontalScrollBarEnabled(false);
-    // Make sure that the Tab Strips fills this View
-    setFillViewport(true);
 
     final DisplayMetrics dm = getResources().getDisplayMetrics();
     final float density = dm.density;
@@ -155,6 +153,9 @@
           ""'distributeEvenly' and 'indicatorAlwaysInCenter' both use does not support"");
     }
 
+    // Make sure that the Tab Strips fills this View
+    setFillViewport(!tabStrip.isIndicatorAlwaysInCenter());
+
     addView(tabStrip, LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);
 
   }
@@ -175,6 +176,7 @@
       View lastTab = tabStrip.getChildAt(getChildCount() - 1);
       int left = (w - Utils.getMeasuredWidth(firstTab)) / 2 - Utils.getMarginStart(firstTab);
       int right = (w - Utils.getMeasuredWidth(lastTab)) / 2 - Utils.getMarginEnd(lastTab);
+      tabStrip.setMinimumWidth(tabStrip.getMeasuredWidth());
       setPadding(left, getPaddingTop(), right, getPaddingBottom());
       setClipToPadding(false);
     }",0
Remove Unused Annotation.,"  * @author <a href=""mailto:zhanggeng.zg@antfin.com"">GengZhang</a>
  * @since 5.4.0
  */
-@Extension(""http"")
 public abstract class AbstractHttpServer implements Server {
 
     protected final String container;",0
Fix exception in offload index block for consistency,"         DataInputStream dis = new DataInputStream(stream);
         int magic = dis.readInt();
         if (magic != this.INDEX_MAGIC_WORD) {
-            throw new IOException(""Invalid MagicWord. read: "" + Integer.toHexString(magic)
-                + "" expected: 0x"" + Integer.toHexString(INDEX_MAGIC_WORD));
+            throw new IOException(String.format(""Invalid MagicWord. read: 0x%x  expected: 0x%x"",
+                                                magic, INDEX_MAGIC_WORD));
         }
         int indexBlockLength = dis.readInt();
         int segmentMetadataLength = dis.readInt();",0
"Fix for ""Awaiting Character Spawn"" in Headless Mode"," 
         // Free unused space
         PerformanceMonitor.startActivity(""Update Chunk Cache"");
+        chunkProvider.completeUpdate();
         chunkProvider.beginUpdate();
         PerformanceMonitor.endActivity();
 ",0
Fix silly bug,"         updateKeyStore(sslContextFactory -> {
             sslContextFactory.setKeyStore(keyStore);
             if (password != null) {
-                sslContextFactory.setKeyStorePassword(null);
+                sslContextFactory.setKeyStorePassword(password);
             }
         });
     }",0
Fixed strong tag closing in javadoc documentation in RepositoryService.,"   void suspendProcessDefinitionById(String processDefinitionId, boolean suspendProcessInstances, Date suspensionDate);
   
   /**
-   * Suspends the <strong>all<strong> process definitions with the given key (= id in the bpmn20.xml file). 
+   * Suspends the <strong>all</strong> process definitions with the given key (= id in the bpmn20.xml file).
    * 
    * If a process definition is in state suspended, it will not be possible to start new process instances
    * based on the process definition.
@@ -186,7 +186,7 @@
   void suspendProcessDefinitionByKey(String processDefinitionKey);
   
   /**
-   * Suspends the <strong>all<strong> process definitions with the given key (= id in the bpmn20.xml file). 
+   * Suspends the <strong>all</strong> process definitions with the given key (= id in the bpmn20.xml file).
    * 
    * If a process definition is in state suspended, it will not be possible to start new process instances
    * based on the process definition.",0
pax-britannica: Fix Ship collisionCenter calculation position error.," 		collisionPoints.get(2).set( this.getVertices()[10], this.getVertices()[11]);
 		collisionPoints.get(3).set( this.getVertices()[15], this.getVertices()[16]);
 		
-		collisionCenter.set(collisionPoints.get(2)).scl(0.5f).add(collisionPoints.get(0));
+		collisionCenter.set(collisionPoints.get(0)).add(collisionPoints.get(2)).scl(0.5f);
 
 		velocity.scl( (float) Math.pow(0.97f, delta * 30.f));
 		position.add(velocity.x * delta, velocity.y * delta);",0
[java] Fix ClassCastException on CloneMethodMustImplementCloneable," import java.util.Arrays;
 import java.util.List;
 
+import net.sourceforge.pmd.lang.ast.Node;
 import net.sourceforge.pmd.lang.java.ast.ASTBlock;
 import net.sourceforge.pmd.lang.java.ast.ASTBlockStatement;
 import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceDeclaration;
@@ -33,7 +34,13 @@
 	ASTImplementsList impl = node.getFirstChildOfType(ASTImplementsList.class);
 	if (impl != null && impl.jjtGetParent().equals(node)) {
 	    for (int ix = 0; ix < impl.jjtGetNumChildren(); ix++) {
-		ASTClassOrInterfaceType type = (ASTClassOrInterfaceType) impl.jjtGetChild(ix);
+            	Node child = impl.jjtGetChild(ix);
+            	
+            	if (child.getClass() != ASTClassOrInterfaceType.class) {
+            		continue;
+            	}
+            	
+                ASTClassOrInterfaceType type = (ASTClassOrInterfaceType) child;
 		if (type.getType() == null) {
 		    if (""Cloneable"".equals(type.getImage())) {
 			return data;",0
Fixes overflow problem in ClientResponseHandlerSupplier," import static com.hazelcast.client.spi.properties.ClientProperty.RESPONSE_THREAD_COUNT;
 import static com.hazelcast.instance.OutOfMemoryErrorDispatcher.onOutOfMemory;
 import static com.hazelcast.spi.impl.operationservice.impl.InboundResponseHandlerSupplier.getIdleStrategy;
+import static com.hazelcast.util.HashUtil.hashToIndex;
 
 /**
  * A {@link Supplier} for {@link ClientResponseHandler} instance.
@@ -186,7 +187,7 @@
     class AsyncMultiThreadedResponseHandler implements ClientResponseHandler {
         @Override
         public void handle(ClientMessage message, ClientConnection connection) {
-            int threadIndex = INT_HOLDER.get().getAndInc() % responseThreads.length;
+            int threadIndex = hashToIndex(INT_HOLDER.get().getAndInc(), responseThreads.length);
             responseThreads[threadIndex].responseQueue.add(new ClientPacket(connection, message));
         }
     }",0
Fixed layout inflater throwing NullPointerException during initization.,"     }
 
     public static void registerPackage(String packageName) {
-        packageName = Package.getPackage(packageName).getName();
-        if (!sPackages.contains(packageName)) {
+        packageName = resolveFullPackageName(packageName);
+
+        if (packageName != null && !sPackages.contains(packageName)) {
             sPackages.add(packageName);
         }
     }
 
+    private static String resolveFullPackageName(String packageName) {
+        Package resolvedPackage = Package.getPackage(packageName);
+
+        if (resolvedPackage == null) {
+            return null;
+        }
+
+        return resolvedPackage.getName();
+    }
+
     /**
      * @deprecated Use {@link #register(Class<? extends View>...)} instead
      */",0
PUBDEV-4308 Fix in Rollupstats. Do not throw can not clean up rollups…,"               break;
             } catch (Exception e) {
               Log.err(e);
-              if (cleanupStats(nnn))
+              cleanupStats(nnn);
                 throw e;
-              else
-                throw new IllegalStateException(""Unable to clean up RollupStats after an exception (see cause). "" +
-                      ""This could cause a key leakage, key="" + _rsKey, e);
             }
           } // else someone else is modifying the rollups => try again
         }",0
fix: Adds a null check.,"             Class<T> serviceClass)
     {
         ServiceReference<T> serviceReference
-            = bundleContext.getServiceReference(serviceClass);
+            = bundleContext == null
+                ? null : bundleContext.getServiceReference(serviceClass);
 
         return
             (serviceReference == null)",0
"apply latest changes (git #60cebee, #d916429) in Box2DDebugRenderer to t..."," 	private boolean drawJoints;
 	private boolean drawAABBs;
 	private boolean drawInactiveBodies;
+	private boolean drawVelocities;
 
 	public Box2DDebugRenderer () {
-		this(true, true, false, true);
+		this(true, true, false, true, false);
 	}
 
-	public Box2DDebugRenderer (boolean drawBodies, boolean drawJoints, boolean drawAABBs, boolean drawInactiveBodies) {
+	public Box2DDebugRenderer (boolean drawBodies, boolean drawJoints, boolean drawAABBs, boolean drawInactiveBodies,
+		boolean drawVelocities) {
 		// next we setup the immediate mode renderer
 		renderer = new ShapeRenderer();
 
@@ -72,6 +74,7 @@
 		this.drawJoints = drawJoints;
 		this.drawAABBs = drawAABBs;
 		this.drawInactiveBodies = drawInactiveBodies;
+		this.drawVelocities = drawVelocities;
 	}
 
 	/** This assumes that the projection matrix has already been set. */
@@ -87,6 +90,7 @@
 	private final Color SHAPE_AWAKE = new Color(0.9f, 0.7f, 0.7f, 1);
 	private final Color JOINT_COLOR = new Color(0.5f, 0.8f, 0.8f, 1);
 	private final Color AABB_COLOR = new Color(1.0f, 0, 1.0f, 1f);
+	private final Color VELOCITY_COLOR = new Color(1.0f, 0, 0f, 1f);
 
 	private void renderBodies (World world) {
 		renderer.begin(ShapeType.Line);
@@ -94,6 +98,28 @@
 		if (drawBodies || drawAABBs) {
 			for (Iterator<Body> iter = world.getBodies(); iter.hasNext();) {
 				Body body = iter.next();
+				if (body.isActive() || drawInactiveBodies) renderBody(body);
+			}
+		}
+
+		if (drawJoints) {
+			for (Iterator<Joint> iter = world.getJoints(); iter.hasNext();) {
+				Joint joint = iter.next();
+				drawJoint(joint);
+			}
+		}
+		renderer.end();
+
+		if (Gdx.gl10 != null) Gdx.gl10.glPointSize(3);
+		renderer.begin(ShapeType.Point);
+		int len = world.getContactList().size();
+		for (int i = 0; i < len; i++)
+			drawContact(world.getContactList().get(i));
+		renderer.end();
+		if (Gdx.gl10 != null) Gdx.gl10.glPointSize(1);
+	}
+
+	protected void renderBody (Body body) {
 				Transform transform = body.getTransform();
 				int len = body.getFixtureList().size();
 				List<Fixture> fixtures = body.getFixtureList();
@@ -118,24 +144,6 @@
 					}
 				}
 			}
-		}
-
-		if (drawJoints) {
-			for (Iterator<Joint> iter = world.getJoints(); iter.hasNext();) {
-				Joint joint = iter.next();
-				drawJoint(joint);
-			}
-		}
-		renderer.end();
-
-		if (Gdx.gl10 != null) Gdx.gl10.glPointSize(3);
-		renderer.begin(ShapeType.Point);
-		int len = world.getContactList().size();
-		for (int i = 0; i < len; i++)
-			drawContact(world.getContactList().get(i));
-		renderer.end();
-		if (Gdx.gl10 != null) Gdx.gl10.glPointSize(1);
-	}
 
 	private void drawAABB (Fixture fixture, Transform transform) {
 		if (fixture.getType() == Type.Circle) {
@@ -331,6 +339,14 @@
 		this.drawInactiveBodies = drawInactiveBodies;
 	}
 
+	public boolean isDrawVelocities () {
+		return drawVelocities;
+	}
+
+	public void setDrawVelocities (boolean drawVelocities) {
+		this.drawVelocities = drawVelocities;
+	}
+
 	public static Vector2 getAxis () {
 		return axis;
 	}",0
master: fix for https://github.com/RobotiumTech/robotium/issues/828," import android.app.Instrumentation;
 import android.app.Instrumentation.ActivityMonitor;
 import android.content.IntentFilter;
+import android.os.SystemClock;
 import android.util.Log;
 import android.view.KeyEvent;
 
-
 /**
  * Contains activity related methods. Examples are:
  * getCurrentActivity(), getActivityMonitor(), setActivityOrientation(int orientation).
@@ -145,11 +145,14 @@
 
 		setRegisterActivities(true);
 
-		Runnable runnable = new Runnable() {
-			public void run() {
-				while (shouldRegisterActivities()) {
+		activityThread = new RegisterActivitiesThread(this);
+		activityThread.start();
+	}
+
+
+	void monitorActivities() {
 					if(activityMonitor != null){
-						Activity activity = activityMonitor.waitForActivityWithTimeout(2000);
+			Activity activity = activityMonitor.waitForActivityWithTimeout(2000L);
 
 						if(activity != null){
 							if (activitiesStoredInActivityStack.remove(activity.toString())){
@@ -161,11 +164,8 @@
 						}
 					}
 				}
-			}
-		};
-		activityThread = new Thread(runnable, ""activityMonitorThread"");
-		activityThread.start();
-	}
+
+
 
 	/**
 	 * Removes a given activity from the activity stack
@@ -464,4 +464,38 @@
 			}
 		}
 	}
+
+	private static final class RegisterActivitiesThread extends Thread {
+
+		public static final long REGISTER_ACTIVITY_THREAD_SLEEP_MS = 16L;
+		private final WeakReference<ActivityUtils> activityUtilsWR;
+
+		RegisterActivitiesThread(ActivityUtils activityUtils) {
+			super(""activityMonitorThread"");
+			activityUtilsWR = new WeakReference<ActivityUtils>(activityUtils);
+			setPriority(Thread.MIN_PRIORITY);
+		}
+
+		@Override
+		public void run() {
+			while (shouldMonitor()) {
+				monitorActivities();
+				SystemClock.sleep(REGISTER_ACTIVITY_THREAD_SLEEP_MS);
+			}
+		}
+
+		private boolean shouldMonitor() {
+			ActivityUtils activityUtils = activityUtilsWR.get();
+
+			return activityUtils != null && activityUtils.shouldRegisterActivities();
+		}
+
+		private void monitorActivities() {
+			ActivityUtils activityUtils = activityUtilsWR.get();
+			if (activityUtils != null) {
+				activityUtils.monitorActivities();
+			}
+		}
+	}
+
 }",0
[BACKLOG-16118] Fixed issue with field lengths in text input,"     boolean bEndedLineWrote = false;
     boolean fileExist;
     Object[] r = getRow(); // This also waits for a row to be finished.
-    if ( r != null ) {
+    if ( r != null && meta.getOutputFields().length == 0 ) {
       data.outputRowMeta = getInputRowMeta().clone();
     }
     if ( r != null && first ) {
+      data.outputRowMeta = getInputRowMeta().clone();
       first = false;
       meta.getFields( data.outputRowMeta, getStepname(), null, null, this, repository, metaStore );
 ",0
修改解析sql时会产生死循环的bug," 				} else {
 					pos++;
 				}
+			}else{
+				break;
 			}
 		}
 		",0
Fix NPE introduced by #3701," 
         @Override
         public void started(Instance machine) throws ServerException {
-            launchAgents(machine, nameToMachine.get(machine.getConfig().getName()).getAgents());
+            ExtendedMachine extMachine = nameToMachine.get(machine.getConfig().getName());
+            if (extMachine != null) {
+                launchAgents(machine, extMachine.getAgents());
+            }
         }
     }
 ",0
修改心跳检查bug," 		try {
 			stmt = con.createStatement();
 			stmt.execute(sql);
+			if(!isAutocommit()){ //如果在写库上，如果是事务方式的连接，需要进行手动commit
+			    con.commit();
+			}
 			this.respHandler.okResponse(OkPacket.OK, this);
 
 		}",0
Remove dupe PVP_HR entry in world hopper," 			currentWorldTypes.remove(WorldType.PVP);
 			currentWorldTypes.remove(WorldType.PVP_HIGH_RISK);
 		}
-		// Don't regard skill total and bounty worlds as a type that must be hopped between
+		// Don't regard these worlds as a type that must be hopped between
 		currentWorldTypes.remove(WorldType.BOUNTY);
 		currentWorldTypes.remove(WorldType.SKILL_TOTAL);
-		// Allow hopping from a high risk world to a non-high risk world
-		currentWorldTypes.remove(WorldType.PVP_HIGH_RISK);
-		// Allow hopping from a LMS world to a non-LMS world
 		currentWorldTypes.remove(WorldType.LAST_MAN_STANDING);
 
 		List<World> worlds = worldResult.getWorlds();",0
Fixed infinite loop in GWTApplication postRunnable ," 	private TextArea log = null;
 	private int logLevel = LOG_ERROR;
 	private Array<Runnable> runnables = new Array<Runnable>();
+	private Array<Runnable> runnablesHelper = new Array<Runnable>();
 	private int lastWidth, lastHeight;
 	private Preloader preloader;
 	private static AgentInfo agentInfo;
@@ -187,10 +188,12 @@
 						lastHeight = graphics.getHeight();
 						Gdx.gl.glViewport(0, 0, lastWidth, lastHeight);
 					}
-					for (int i = 0; i < runnables.size; i++) {
-						runnables.get(i).run();
-					}
+					runnablesHelper.addAll(runnables);
 					runnables.clear();
+					for (int i = 0; i < runnablesHelper.size; i++) {
+						runnablesHelper.get(i).run();
+					}
+					runnablesHelper.clear();					
 					listener.render();
 					input.justTouched = false;
 				} catch (Throwable t) {",0
Hack to fix a unmarshaller crash in CustomNavigationView.SaveState on Marshmallow," package com.amaze.filemanager.ui.views.drawer;
 
 import android.content.Context;
+import android.os.Build;
 import android.os.Parcel;
 import android.os.Parcelable;
 import android.support.annotation.NonNull;
@@ -65,6 +66,10 @@
 
     @Override
     public Parcelable onSaveInstanceState() {
+        if (!doesNavigationViewSavedStateExist()) {
+            return super.onSaveInstanceState();
+        }
+
         //begin boilerplate code that allows parent classes to save state
         Parcelable superState = super.onSaveInstanceState();
 
@@ -78,6 +83,11 @@
 
     @Override
     public void onRestoreInstanceState(Parcelable state) {
+        if(!doesNavigationViewSavedStateExist()) {
+            super.onRestoreInstanceState(state);
+            return;
+        }
+
         //begin boilerplate code so parent classes can restore state
         if(!(state instanceof SavedState)) {
             super.onRestoreInstanceState(state);
@@ -91,6 +101,20 @@
         this.checkedId = ss.selectedId;
     }
 
+    /**
+     * This is a hack, when the SavedState class is unmarshalled a ""ClassNotFoundException""
+     * will be thrown (the actual class not found is ""android.support.design.widget.NavigationView$SavedState"")
+     * and I seem to only be able to replicate on Marshmallow.
+     * Trying to find the class and returning false if Class.forName() throws ""ClassNotFoundException""
+     * doesn't work because the class seems to have been loaded with the current loader
+     * (not the one the unmarshaller uses); of course I have no idea of what any of this means so
+     * I could be wrong.
+     * For the crash see https://github.com/TeamAmaze/AmazeFileManager/issues/1101.
+     */
+    public boolean doesNavigationViewSavedStateExist() {
+        return Build.VERSION.SDK_INT != Build.VERSION_CODES.M;
+    }
+
     static class SavedState extends BaseSavedState {
         int selectedId;
 ",0
Fix animation bug when programmatically selecting tab (issue #214),"         selectTab(newTab, animate);
 
         updateSelectedTab(position);
-        shiftingMagic(oldTab, newTab, false);
+        shiftingMagic(oldTab, newTab, animate);
     }
 
     /**",0
Don't skip the first line when rendering (debug) text.,"             int top = 2;
             for (String msg : listL)
             {
-                top += fontrenderer.FONT_HEIGHT;
                 if (msg == null) continue;
                 drawRect(1, top - 1, 2 + fontrenderer.getStringWidth(msg) + 1, top + fontrenderer.FONT_HEIGHT - 1, -1873784752);
                 fontrenderer.drawString(msg, 2, top, 14737632);
+                top += fontrenderer.FONT_HEIGHT;
             }
 
             top = 2;
             for (String msg : listR)
             {
-                top += fontrenderer.FONT_HEIGHT;
                 if (msg == null) continue;
                 int w = fontrenderer.getStringWidth(msg);
                 int left = width - 2 - w;
                 drawRect(left - 1, top - 1, left + w + 1, top + fontrenderer.FONT_HEIGHT - 1, -1873784752);
                 fontrenderer.drawString(msg, left, top, 14737632);
+                top += fontrenderer.FONT_HEIGHT;
             }
         }
 ",0
Fix drawBackground for more than 150 values," 
 				if (i > 0) {
 					// fill space between last and current point
-					int numSpace = (int) ((endX - lastEndX) / 3f) +1;
+					double numSpace = ((endX - lastEndX) / 3f) +1;
 					for (int xi=0; xi<numSpace; xi++) {
 						float spaceX = (float) (lastEndX + ((endX-lastEndX)*xi/(numSpace-1)));
 						float spaceY = (float) (lastEndY + ((endY-lastEndY)*xi/(numSpace-1)));",0
Fix world map configuration typos," 
 	@ConfigItem(
 		keyName = WorldMapPlugin.CONFIG_KEY_NORMAL_TELEPORT_ICON,
-		name = ""Show standard spellbook destionations"",
-		description = ""Show icons at the destinations for teleports in the standard spellbook"",
+		name = ""Show Standard Spellbook destinations"",
+		description = ""Show icons at the destinations for teleports in the Standard Spellbook"",
 		position = 5
 	)
 	default boolean normalTeleportIcon()
@@ -93,8 +93,8 @@
 
 	@ConfigItem(
 		keyName = WorldMapPlugin.CONFIG_KEY_ANCIENT_TELEPORT_ICON,
-		name = ""Show ancient magicks destionations"",
-		description = ""Show icons at the destinations for teleports in the ancient spellbook"",
+		name = ""Show Ancient Magicks destinations"",
+		description = ""Show icons at the destinations for teleports in the Ancient Spellbook"",
 		position = 6
 	)
 	default boolean ancientTeleportIcon()
@@ -104,8 +104,8 @@
 
 	@ConfigItem(
 		keyName = WorldMapPlugin.CONFIG_KEY_LUNAR_TELEPORT_ICON,
-		name = ""Show lunar spellbook destionations"",
-		description = ""Show icons at the destinations for teleports in the lunar spellbook"",
+		name = ""Show Lunar Spellbook destinations"",
+		description = ""Show icons at the destinations for teleports in the Lunar Spellbook"",
 		position = 7
 	)
 	default boolean lunarTeleportIcon()
@@ -115,8 +115,8 @@
 
 	@ConfigItem(
 		keyName = WorldMapPlugin.CONFIG_KEY_ARCEUUS_TELEPORT_ICON,
-		name = ""Show arceuus spellbook destionations"",
-		description = ""Show icons at the destinations for teleports in the arceuus spellbook"",
+		name = ""Show Arceuus Spellbook destinations"",
+		description = ""Show icons at the destinations for teleports in the Arceuus Spellbook"",
 		position = 8
 	)
 	default boolean arceuusTeleportIcon()",0
Fix #4431," 			if (layer.isVisible()) {
 				if (layer instanceof TiledMapTileLayer) {
 					renderTileLayer((TiledMapTileLayer)layer);
-				} if (layer instanceof TiledMapImageLayer) {
+				} else if (layer instanceof TiledMapImageLayer) {
 					renderImageLayer((TiledMapImageLayer)layer);
 				} else {
 					renderObjects(layer);",0
FIX an issue about the 'client_port' parameter in RtspServer,"                         return response;
                     }
 
-                    p = Pattern.compile(""client_port=(\\d+)-(\\d+)"", Pattern.CASE_INSENSITIVE);
+                    p = Pattern.compile(""client_port=(\\d+)(?:-(\\d+))?"", Pattern.CASE_INSENSITIVE);
                     m = p.matcher(request.headers.get(""transport""));
 
                     if (!m.find()) {
@@ -514,8 +514,12 @@
                         p2 = ports[1];
                     } else {
                         p1 = Integer.parseInt(m.group(1));
+                        if (m.group(2) == null) {
+                            p2 = p1+1;
+                        } else {
                         p2 = Integer.parseInt(m.group(2));
                     }
+                    }
 
                     ssrc = mSession.getTrack(trackId).getSSRC();
                     src = mSession.getTrack(trackId).getLocalPorts();",0
ajp prefix code log,"                 } else {
                     final byte prefix = buf.get();
                     if (prefix != 2) {
-                        throw new IllegalArgumentException(""We do  not support prefix codes other than 2 yet."" + prefix);
+                        throw new IllegalArgumentException(""We do not support prefix codes other than 2 yet. Received: "" + prefix);
                     }
                 }
             }",0
"Revert ""Remove Query.CompleteBuilder.whereArgs(list), it was error in…","         }
 
         /**
+         * Optional: Specifies arguments for where clause.
+         * <p>
+         * Passed objects will be immediately converted list of
+         * to {@link String} via calling {@link Object#toString()}.
+         * <p>
+         * Default value is {@code null}.
+         *
+         * @param whereArgs list of arguments for where clause.
+         * @return builder.
+         * @see Query#whereArgs()
+         */
+        @NonNull
+        public CompleteBuilder whereArgs(@Nullable List<?> whereArgs) {
+            this.whereArgs = unmodifiableNonNullListOfStrings(whereArgs);
+            return this;
+        }
+
+        /**
          * Optional: Specifies {@code GROUP BY} clause.
          * <p>
          * Optional filter declaring how to group rows.",0
Fix ParceledListSlice type detect," 					//noinspection unchecked
 					Object _infos = method.invoke(who, args);
 					List<ActivityManager.RecentTaskInfo> infos =
-							_infos instanceof ParceledListSlice
+							ParceledListSlice.TYPE != null && ParceledListSlice.TYPE.isInstance(_infos)
 									? ParceledListSlice.getList.call(_infos)
 									: (List)_infos;
 					for (ActivityManager.RecentTaskInfo info : infos) {",0
修正continue到break,"         }
         for (Node bucket : buckets) {
             if (bucket == null){
-                continue;
+                break;
             }
             if (bucket.key >= key) {
                 return bucket.value;",0
#1227: Use flyway's classloader to detect OSGI framework,"      */
     public boolean isOsgiFrameworkAvailable() {
         if (osgiFrameworkAvailable == null) {
-            osgiFrameworkAvailable = ClassUtils.isPresent(""org.osgi.framework.Bundle"", classLoader);
+            osgiFrameworkAvailable = ClassUtils.isPresent(""org.osgi.framework.Bundle"", FeatureDetector.class.getClassLoader());
             LOG.debug(""OSGi framework available: "" + osgiFrameworkAvailable);
         }
 ",0
Do not try to authenticate without credentials," 			}
 			UsernamePasswordAuthenticationCredentials cred = (UsernamePasswordAuthenticationCredentials) credentials;
 
+			if (!cred.isConfigured()) {
+				log.warn(""No credentials to authenticate user: "" + user.getName());
+				return null;
+			}
+			
 			// Prepare login message
 			HttpMessage msg;
 			try {",0
Fix ArrayType position issue in a cleaner way," package com.github.javaparser.ast.type;
 
-import com.github.javaparser.Position;
 import com.github.javaparser.Range;
 import com.github.javaparser.ast.ArrayBracketPair;
 import com.github.javaparser.ast.NodeList;
@@ -10,7 +9,7 @@
 import com.github.javaparser.ast.visitor.VoidVisitor;
 import com.github.javaparser.utils.Pair;
 
-import static com.github.javaparser.ast.NodeList.nodeList;
+import static com.github.javaparser.ast.NodeList.*;
 import static com.github.javaparser.utils.Utils.assertNotNull;
 
 /**
@@ -58,20 +57,8 @@
             final NodeList<ArrayBracketPair> arrayBracketPairList = arrayBracketPairLists[i];
             if (arrayBracketPairList != null) {
                 for (int j = arrayBracketPairList.size() - 1; j >= 0; j--) {
-                    // if the type has a position we can use it to derive the position of the ArrayType and possibly
-                    // also the one of the ArrayBracketPair
-                    if (!type.getRange().equals(Range.UNKNOWN)) {
-                        ArrayBracketPair arrayBracketPair = arrayBracketPairList.get(j);
-                        if (arrayBracketPair.getRange().equals(Range.UNKNOWN)) {
-                            Position bracketsStart = type.getRange().end.withColumn(type.getRange().end.column + 1);
-                            Position bracketsEnd = type.getRange().end.withColumn(type.getRange().end.column + 2);
-                            arrayBracketPairList.get(j).setRange(new Range(bracketsStart, bracketsEnd));
-                        }
-                        Range range = type.getRange().withEnd(arrayBracketPair.getEnd());
-                        type = new ArrayType(range, type, arrayBracketPairList.get(j).getAnnotations());
-                    } else {
-                        type = new ArrayType(type, arrayBracketPairList.get(j).getAnnotations());
-                    }
+                    ArrayBracketPair pair = arrayBracketPairList.get(j);
+                    type = new ArrayType(pair.getRange(), type, pair.getAnnotations());
                 }
             }
         }",0
Bug fix: Time was parsed too wrong timezone," import static android.text.format.DateUtils.MINUTE_IN_MILLIS;
 import android.text.format.DateUtils;
 
+import org.joda.time.DateTime;
+import org.joda.time.format.DateTimeFormat;
+import org.joda.time.format.DateTimeFormatter;
+
 import java.text.DateFormat;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
@@ -53,18 +57,13 @@
     }
 
     public static Date stringToDate(String value){
-        DateFormat format = new SimpleDateFormat(""yyyy-MM-dd'T'HH:mm:ss'Z'"", Locale.getDefault());
-        Date date = null;
-        try {
-            date = format.parse(value);
-        } catch (ParseException e) {
-            e.printStackTrace();
-        }
-        return date;
+        DateTimeFormatter format = DateTimeFormat.forPattern(""yyyy-MM-dd'T'HH:mm:ss'Z'"");
+        DateTime t = format.parseDateTime(value);
+        return t.toDate();
     }
 
     public static String dateToString(Date value){
-        DateFormat format = new SimpleDateFormat(""yyyy-MM-dd'T'HH:mm:ss'Z'"", Locale.getDefault());
-        return format.format(value);
+        DateTimeFormatter formats = DateTimeFormat.forPattern(""yyyy-MM-dd'T'HH:mm:ss'Z'"");
+        return formats.print(value.getTime());
     }
 }",0
Fixed wrong versions in AndroidExcludedRefs," import static android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH;
 import static android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH_MR1;
 import static android.os.Build.VERSION_CODES.JELLY_BEAN;
+import static android.os.Build.VERSION_CODES.JELLY_BEAN_MR2;
 import static android.os.Build.VERSION_CODES.KITKAT;
 import static android.os.Build.VERSION_CODES.LOLLIPOP;
 import static android.os.Build.VERSION_CODES.LOLLIPOP_MR1;
@@ -250,7 +251,7 @@
     }
   },
 
-  USER_MANAGER__SINSTANCE(SDK_INT >= JELLY_BEAN && SDK_INT <= M) {
+  USER_MANAGER__SINSTANCE(SDK_INT >= JELLY_BEAN_MR2 && SDK_INT < O) {
     @Override void add(ExcludedRefs.Builder excluded) {
       excluded.instanceField(""android.os.UserManager"", ""mContext"")
           .reason(""UserManager has a static sInstance field that creates an instance and caches it""",0
- fixed: relatively rare StrictMode warnings about forgotten close() for streams,"             }
             writeContentDisposition(key, key, mimeType);
 
-            InputStream inputStream = FacebookSdk
-                    .getApplicationContext()
-                    .getContentResolver()
-                    .openInputStream(contentUri);
-
             int totalBytes = 0;
             if (outputStream instanceof ProgressNoopOutputStream) {
                 // If we are only counting bytes then skip reading the file
@@ -2194,6 +2189,10 @@
 
                 ((ProgressNoopOutputStream) outputStream).addProgress(contentSize);
             } else {
+                InputStream inputStream = FacebookSdk
+                        .getApplicationContext()
+                        .getContentResolver()
+                        .openInputStream(contentUri);
                 totalBytes += Utility.copyAndCloseInputStream(inputStream, outputStream);
             }
 ",0
fix alert bug," 		int command = Integer.valueOf(conditions.split("";"")[0]);
 		String type = array[1];
 		Pair<Integer, List<Condition>> pair = queryCheckMinuteAndConditions(rule.getConfigs());
-		QueryEntity queryEntity = buildQueryEntity(pair.getKey(), conditions);
-		double[] datas = ArrayUtils.toPrimitive(m_appDataService.queryValue(queryEntity, type), 0);
+		double[] datas = fetchDatas(conditions, type, pair.getKey());
+
+		if (datas != null && datas.length > 0) {
 		List<Condition> checkedConditions = pair.getValue();
 		List<AlertResultEntity> alertResults = m_dataChecker.checkData(datas, checkedConditions);
 
@@ -135,6 +136,59 @@
 			m_sendManager.addAlert(entity);
 		}
 	}
+	}
+
+	private Calendar queryDayPeriod(int day) {
+		Calendar cal = Calendar.getInstance();
+		cal.add(Calendar.DATE, day);
+		cal.set(Calendar.HOUR_OF_DAY, 0);
+		cal.set(Calendar.MINUTE, 0);
+		cal.set(Calendar.SECOND, 0);
+		cal.set(Calendar.MILLISECOND, 0);
+		return cal;
+	}
+
+	private double[] fetchDatas(String conditions, String type, int minute) {
+		long time = (System.currentTimeMillis()) / 1000 / 60;
+		int endMinute = (int) (time % (60)) - DATA_AREADY_MINUTE;
+		int startMinute = endMinute - minute;
+		double[] datas = null;
+
+		if (startMinute < 0 && endMinute < 0) {
+			String period = m_sdf.format(queryDayPeriod(-1).getTime());
+			QueryEntity queryEntity = new QueryEntity(period + "";"" + conditions + "";;"");
+			datas = ArrayUtils.toPrimitive(m_appDataService.queryValue(queryEntity, type), 0);
+		} else if (startMinute < 0 && endMinute >= 0) {
+			String last = m_sdf.format(queryDayPeriod(-1).getTime());
+			String current = m_sdf.format(queryDayPeriod(0).getTime());
+			QueryEntity lastQueryEntity = new QueryEntity(last + "";"" + conditions + "";;"");
+			QueryEntity currentQueryEntity = new QueryEntity(current + "";"" + conditions + "";;"");
+			double[] lastDatas = ArrayUtils.toPrimitive(m_appDataService.queryValue(lastQueryEntity, type), 0);
+			double[] currentDatas = ArrayUtils.toPrimitive(m_appDataService.queryValue(currentQueryEntity, type), 0);
+			datas = mergerArray(lastDatas, currentDatas);
+		} else if (startMinute >= 0) {
+			String period = m_sdf.format(queryDayPeriod(0).getTime());
+			QueryEntity queryEntity = new QueryEntity(period + "";"" + conditions + "";;"");
+			datas = ArrayUtils.toPrimitive(m_appDataService.queryValue(queryEntity, type), 0);
+		}
+		return datas;
+	}
+
+	protected double[] mergerArray(double[] from, double[] to) {
+		int fromLength = from.length;
+		int toLength = to.length;
+		double[] result = new double[fromLength + toLength];
+		int index = 0;
+
+		for (int i = 0; i < fromLength; i++) {
+			result[i] = from[i];
+			index++;
+		}
+		for (int i = 0; i < toLength; i++) {
+			result[i + index] = to[i];
+		}
+		return result;
+	}
 
 	private String queryType(String type) {
 		String title = """";
@@ -215,21 +269,4 @@
 
 		return result;
 	}
-
-	private QueryEntity buildQueryEntity(int duration, String conditions) {
-		long current = (System.currentTimeMillis()) / 1000 / 60;
-		int endMinute = (int) (current % (60)) - DATA_AREADY_MINUTE;
-		int startMinute = endMinute - duration;
-
-		Calendar cal = Calendar.getInstance();
-		cal.set(Calendar.HOUR_OF_DAY, 0);
-		cal.set(Calendar.MINUTE, 0);
-		cal.set(Calendar.SECOND, 0);
-		cal.set(Calendar.MILLISECOND, 0);
-		String period = m_sdf.format(cal.getTime());
-		String split = "";"";
-
-		return new QueryEntity(period + split + conditions + split + startMinute + split + endMinute);
-	}
-
 }",0
"Fix ""Could not parse -1 for --dsiplay"" error"," 
         // Make sure the display set in Preferences actually exists
         GraphicsDevice runDevice = editorDevice;
-        if (runDisplay > 0) {
-          if (runDisplay <= devices.length) {
+        if (runDisplay > 0 && runDisplay <= devices.length) {
             runDevice = devices[runDisplay-1];
-
           } else {
-            // If a bad display is selected, use the same display as the editor
+          // If a bad display (or -1 display) is selected, use the same display as the editor
             if (runDisplay > 0) {  // don't complain about -1 or 0
               System.err.println(""Display "" + runDisplay + "" not available."");
             }
             runDevice = editorDevice;
             for (int i = 0; i < devices.length; i++) {
               if (devices[i] == runDevice) {
+              // Prevent message on the first run
+              if (runDisplay != -1) {
+                System.err.println(""Setting 'Run Sketches on Display' preference to display "" + (i+1));
+              }
+              runDisplay = i + 1;
                 // Wasn't setting the pref to avoid screwing things up with
                 // something temporary. But not setting it makes debugging one's
                 // setup just too damn weird, so changing that behavior.
-                runDisplay = i + 1;
-                System.err.println(""Setting 'Run Sketches on Display' preference to display "" + runDisplay);
                 Preferences.setInteger(""run.display"", runDisplay);
                 break;
               }
             }
           }
-        }
 
         Point windowLocation = editor.getSketchLocation();
 //        if (windowLocation != null) {",0
Fix mistypes for RESTARTABLE macros in JavaNetNetUtil,"         // 164   RESTARTABLE( (size_t) ::read(fd, buf, (size_t) nBytes), res);
         do {
             res = Unistd.read(fd, buf, WordFactory.unsigned(nBytes)).rawValue();
-        } while ((res == VmRuntimeOS.OSReturn.OS_ERR()) || (Errno.errno() == Errno.EINTR()));
+        } while ((res == VmRuntimeOS.OSReturn.OS_ERR()) && (Errno.errno() == Errno.EINTR()));
         // 165   return res;
         return res;
     }
@@ -2312,7 +2312,7 @@
         // 4095 RESTARTABLE(::ioctl(fd, FIONREAD, pbytes), ret);
         do {
             ret = Ioctl.ioctl(fd, Ioctl.FIONREAD(), pbytes);
-        } while ((ret == VmRuntimeOS.OSReturn.OS_ERR()) || (Errno.errno() == Errno.EINTR()));
+        } while ((ret == VmRuntimeOS.OSReturn.OS_ERR()) && (Errno.errno() == Errno.EINTR()));
         // 4096
         // 4097 //%% note ioctl can return 0 when successful, JVM_SocketAvailable
         // 4098 // is expected to return 0 on failure and 1 on success to the jdk.
@@ -2328,7 +2328,7 @@
             int _result;
             do {
                 _result = (int) Socket.send(fd, buf, WordFactory.unsigned(nBytes), flags).rawValue();
-            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) || (Errno.errno() == Errno.EINTR()));
+            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) && (Errno.errno() == Errno.EINTR()));
             return _result;
         } while (false);
     }
@@ -2340,7 +2340,7 @@
             int _result;
             do {
                 _result = (int) Socket.sendto(fd, buf, WordFactory.unsigned(n), flags, addr, addr_len).rawValue();
-            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) || (Errno.errno() == Errno.EINTR()));
+            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) && (Errno.errno() == Errno.EINTR()));
             return _result;
         } while (false);
     }
@@ -2352,7 +2352,7 @@
             int _result;
             do {
                 _result = (int) Socket.recvfrom(fd, buf, WordFactory.unsigned(n), flags, addr, addr_len).rawValue();
-            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) || (Errno.errno() == Errno.EINTR()));
+            } while ((_result == VmRuntimeOS.OSReturn.OS_ERR()) && (Errno.errno() == Errno.EINTR()));
             return _result;
         } while (false);
     }",0
Fixing StickyListHeadersListViewWrapper.getChildAt(),"     @Nullable
     @Override
     public View getChildAt(final int index) {
-        return mListView.getChildAt(index);
+        return mListView.getListChildAt(index);
     }
 
     @Override",0
Fix for an issue when a wrong week is selected when switching between  month and week display mode," 
         private int weekNumberDifference(@NonNull CalendarDay min, @NonNull CalendarDay max) {
             long millisDiff = max.getDate().getTime() - min.getDate().getTime();
-            long dayDiff = TimeUnit.DAYS.convert(millisDiff, TimeUnit.MILLISECONDS);
+
+            int dstOffsetMax = max.getCalendar().get(Calendar.DST_OFFSET);
+            int dstOffsetMin = min.getCalendar().get(Calendar.DST_OFFSET);
+
+            long dayDiff = TimeUnit.DAYS.convert(millisDiff + dstOffsetMax - dstOffsetMin, TimeUnit.MILLISECONDS);
             return (int) (dayDiff / DAYS_IN_WEEK);
         }
 ",0
Directory Bug," 	public static void makeDirs(@Nullable File dir) {
 		if (dir != null) {
 			synchronized (MKDIR_SYNC) {
-				if (!dir.exists() && !dir.mkdirs()) {
+				if (!dir.mkdirs() && !dir.isDirectory()) {
 					throw new JadxRuntimeException(""Can't create directory "" + dir);
 				}
 			}",0
fix import ," import io.mycat.sqlengine.OneRawSQLQueryResultHandler;
 import io.mycat.sqlengine.SQLJob;
 import io.mycat.sqlengine.SQLQueryResult;
-import javassist.expr.NewArray;
 
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import com.alibaba.fastjson.JSON;
-
-import java.util.ArrayList;
 import java.util.Date;
-import java.util.List;
 import java.util.Map;
-import java.util.concurrent.ConcurrentHashMap;
-import java.util.concurrent.TimeUnit;
-import java.util.concurrent.atomic.AtomicInteger;
-import java.util.concurrent.locks.ReentrantLock;
 
 /**
  * @author zwy",0
fixed dynamic theme,"             LOGGER.debug(""Service [{}] is configured to use a custom theme [{}]"", rService, rService.getTheme());
             
             final Resource resource = ResourceUtils.getRawResourceFrom(rService.getTheme());
-            if (resource instanceof FileSystemResource) {
+            if (resource instanceof FileSystemResource && resource.exists()) {
                 LOGGER.debug(""Executing groovy script to determine theme for [{}]"", service.getId());
                 final String result = ScriptingUtils.executeGroovyScript(resource, new Object[]{service, rService,
                         request.getQueryString(), HttpRequestUtils.getRequestHeaders(request), LOGGER}, String.class);",0
Fix SQL syntax error in MetaDataTableImpl.java,,0
Pac4j: Fix SAML IdP initiated logout ,"         val request = WebUtils.getHttpServletRequestFromExternalWebflowContext(context);
         val response = WebUtils.getHttpServletResponseFromExternalWebflowContext(context);
 
-        if (singleSignOnSessionExists(context)) {
+        if (!isLogoutRequest(request) && singleSignOnSessionExists(context)) {
             LOGGER.trace(""An existing single sign-on session already exists. Skipping delegation and routing back to CAS authentication flow"");
             return resumeWebflow();
         }
@@ -220,6 +220,10 @@
         throw new IllegalArgumentException(msg);
     }
 
+    private boolean isLogoutRequest(final HttpServletRequest request) {
+        return request.getParameter(SAML2ServiceProviderMetadataResolver.LOGOUT_ENDPOINT_PARAMETER) != null;
+    }
+
     private boolean singleSignOnSessionExists(final RequestContext requestContext) {
         val tgtId = WebUtils.getTicketGrantingTicketId(requestContext);
         if (StringUtils.isBlank(tgtId)) {
@@ -453,8 +457,8 @@
     protected Service restoreAuthenticationRequestInContext(final RequestContext requestContext,
                                                             final J2EContext webContext,
                                                             final String clientName) {
-        val logoutEndpoint = webContext.getRequestParameter(SAML2ServiceProviderMetadataResolver.LOGOUT_ENDPOINT_PARAMETER);
-        if (logoutEndpoint != null) {
+        val logoutEndpoint = isLogoutRequest(webContext.getRequest());
+        if (logoutEndpoint) {
             return null;
         } else {
             try {",0
Fix LinuxBrokerHostUsageImpl scheduled timer,"  */
 public class LinuxBrokerHostUsageImpl implements BrokerHostUsage {
     // The interval for host usage check command
-    private final int hostUsageCheckInterval;
+    private final int hostUsageCheckIntervalMin;
     private long lastCollection;
     private double lastTotalNicUsageTx;
     private double lastTotalNicUsageRx;
@@ -52,11 +52,11 @@
     private static final Logger LOG = LoggerFactory.getLogger(LinuxBrokerHostUsageImpl.class);
 
     public LinuxBrokerHostUsageImpl(PulsarService pulsar) {
-        this.hostUsageCheckInterval = pulsar.getConfiguration().getLoadBalancerHostUsageCheckIntervalMinutes();
+        this.hostUsageCheckIntervalMin = pulsar.getConfiguration().getLoadBalancerHostUsageCheckIntervalMinutes();
         this.systemBean = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
         this.lastCollection = 0L;
         this.usage = new SystemResourceUsage();
-        pulsar.getLoadManagerExecutor().scheduleAtFixedRate(this::calculateBrokerHostUsage, 0, hostUsageCheckInterval, TimeUnit.SECONDS);
+        pulsar.getLoadManagerExecutor().scheduleAtFixedRate(this::calculateBrokerHostUsage, 0, hostUsageCheckIntervalMin, TimeUnit.MINUTES);
     }
 
     @Override",0
Fix unwanted visuals on touch up outside of tap area," 					tapCount++;
 					lastTapTime = time;
 					clicked(event, x, y);
+					visualPressedTime = TimeUtils.nanoTime() + visualPressedDuration * 1000000000;
 				}
 			}
 			pressed = false;
-			visualPressedTime = TimeUtils.nanoTime() + visualPressedDuration * 1000000000;
 			pressedPointer = -1;
 			pressedButton = -1;
 			cancelled = false;",0
Fix javadocs for getValueAsLong/Double,"      * and 1 (true), and Strings are parsed using default Java language integer
      * parsing rules.
      *<p>
-     * If representation can not be converted to an int (including structured type
+     * If representation can not be converted to a long (including structured type
      * markers like start/end Object/Array)
-     * default value of <b>0</b> will be returned; no exceptions are thrown.
+     * default value of <b>0L</b> will be returned; no exceptions are thrown.
      */
     public long getValueAsLong() throws IOException {
         return getValueAsLong(0);
@@ -1505,7 +1505,7 @@
      * and 1 (true), and Strings are parsed using default Java language integer
      * parsing rules.
      *<p>
-     * If representation can not be converted to an int (including structured type
+     * If representation can not be converted to a long (including structured type
      * markers like start/end Object/Array)
      * specified <b>def</b> will be returned; no exceptions are thrown.
      */
@@ -1517,10 +1517,10 @@
      * Method that will try to convert value of current token to a Java
      * <b>double</b>.
      * Numbers are coerced using default Java rules; booleans convert to 0.0 (false)
-     * and 1.0 (true), and Strings are parsed using default Java language integer
-     * parsing rules.
+     * and 1.0 (true), and Strings are parsed using default Java language floating
+     * point parsing rules.
      *<p>
-     * If representation can not be converted to an int (including structured types
+     * If representation can not be converted to a double (including structured types
      * like Objects and Arrays),
      * default value of <b>0.0</b> will be returned; no exceptions are thrown.
      */
@@ -1532,10 +1532,10 @@
      * Method that will try to convert value of current token to a
      * Java <b>double</b>.
      * Numbers are coerced using default Java rules; booleans convert to 0.0 (false)
-     * and 1.0 (true), and Strings are parsed using default Java language integer
-     * parsing rules.
+     * and 1.0 (true), and Strings are parsed using default Java language floating
+     * point parsing rules.
      *<p>
-     * If representation can not be converted to an int (including structured types
+     * If representation can not be converted to a double (including structured types
      * like Objects and Arrays),
      * specified <b>def</b> will be returned; no exceptions are thrown.
      */",0
Fix error message of RPC-02412.,"      */
     private SofaRpcException cannotFoundServiceMethod(String appName, String serviceName, String methodName) {
         String errorMsg = LogCodes.getLog(
-            LogCodes.ERROR_PROVIDER_SERVICE_METHOD_CANNOT_FOUND, methodName, serviceName);
+            LogCodes.ERROR_PROVIDER_SERVICE_METHOD_CANNOT_FOUND, serviceName, methodName);
         LOGGER.errorWithApp(appName, errorMsg);
         return new SofaRpcException(RpcErrorType.SERVER_NOT_FOUND_INVOKER, errorMsg);
     }",0
Fix a comment in class AndPermission.,"     /**
      * Create a service that opens the permission setting page.
      *
-     * @param context {@link android.app.Fragment}.
+     * @param context {@link Context}.
      * @return {@link SettingService}.
      */
     @NonNull",0
Fix/#180,"     }
 
     public boolean isOutOfRange(Timepoint current) {
-        if(mSelectableTimes != null) return !Arrays.asList(mSelectableTimes).contains(current);
-
         if(mMinTime != null && mMinTime.compareTo(current) > 0) return true;
 
         if(mMaxTime != null && mMaxTime.compareTo(current) < 0) return true;
 
+        if(mSelectableTimes != null) return !Arrays.asList(mSelectableTimes).contains(current);
+
         return false;
     }
 
@@ -777,25 +777,20 @@
         if(current == null) return false;
 
         if(index == HOUR_INDEX) {
+            if(mMinTime != null && mMinTime.getHour() > current.getHour()) return true;
+
+            if(mMaxTime != null && mMaxTime.getHour()+1 <= current.getHour()) return true;
+
             if(mSelectableTimes != null) {
                 for(Timepoint t : mSelectableTimes) {
                     if(t.getHour() == current.getHour()) return false;
                 }
                 return true;
             }
-            if(mMinTime != null && mMinTime.getHour() > current.getHour()) return true;
-
-            if(mMaxTime != null && mMaxTime.getHour()+1 <= current.getHour()) return true;
 
             return false;
         }
         else if(index == MINUTE_INDEX) {
-            if(mSelectableTimes != null) {
-                for(Timepoint t : mSelectableTimes) {
-                    if(t.getHour() == current.getHour() && t.getMinute() == current.getMinute()) return false;
-                }
-                return true;
-            }
             if(mMinTime != null) {
                 Timepoint roundedMin = new Timepoint(mMinTime.getHour(), mMinTime.getMinute());
                 if (roundedMin.compareTo(current) > 0) return true;
@@ -806,6 +801,13 @@
                 if (roundedMax.compareTo(current) < 0) return true;
             }
 
+            if(mSelectableTimes != null) {
+                for(Timepoint t : mSelectableTimes) {
+                    if(t.getHour() == current.getHour() && t.getMinute() == current.getMinute()) return false;
+                }
+                return true;
+            }
+
             return false;
         }
         else return isOutOfRange(current);
@@ -815,13 +817,13 @@
     public boolean isAmDisabled() {
         Timepoint midday = new Timepoint(12);
 
+        if(mMinTime != null && mMinTime.compareTo(midday) > 0) return true;
+
         if(mSelectableTimes != null) {
             for(Timepoint t : mSelectableTimes) if(t.compareTo(midday) < 0) return false;
             return true;
         }
 
-        if(mMinTime != null && mMinTime.compareTo(midday) > 0) return true;
-
         return false;
     }
 
@@ -829,13 +831,13 @@
     public boolean isPmDisabled() {
         Timepoint midday = new Timepoint(12);
 
+        if(mMaxTime != null && mMaxTime.compareTo(midday) < 0) return true;
+
         if(mSelectableTimes != null) {
             for(Timepoint t : mSelectableTimes) if(t.compareTo(midday) >= 0) return false;
             return true;
         }
 
-        if(mMaxTime != null && mMaxTime.compareTo(midday) < 0) return true;
-
         return false;
     }
 
@@ -850,6 +852,10 @@
 
     @Override
     public Timepoint roundToNearest(Timepoint time, Timepoint.TYPE type) {
+
+        if(mMinTime != null && mMinTime.compareTo(time) > 0) return mMinTime;
+
+        if(mMaxTime != null && mMaxTime.compareTo(time) < 0) return mMaxTime;
         if(mSelectableTimes != null) {
             int currentDistance = Integer.MAX_VALUE;
             Timepoint output = time;
@@ -866,10 +872,6 @@
             return output;
         }
 
-        if(mMinTime != null && mMinTime.compareTo(time) > 0) return mMinTime;
-
-        if(mMaxTime != null && mMaxTime.compareTo(time) < 0) return mMaxTime;
-
         return time;
     }
 ",0
Fix braces style,"    }
 
    @Override
-   public IMetricsTracker create(String poolName, PoolStats poolStats)
-   {
+   public IMetricsTracker create(String poolName, PoolStats poolStats) {
       Collector collector = new HikariCPCollector(poolName, poolStats).register(registry);
       return new PrometheusMetricsTracker(poolName, collector, registry);
    }",0
url mapping fix,"     public void contextInitialized(ServletContextEvent sce) {
         System.out.println(""Servlet context initialized: "" + sce.getServletContext().getContextPath());
         ServletRegistration.Dynamic registration = sce.getServletContext().addServlet(""dynamic"", DynamicServlet.class);
-        registration.addMapping(""dynamic"");
+        registration.addMapping(""/dynamic"");
     }
 
     @Override",0
Fixed unhandled NullReferenceException in specific case,"    */
   private boolean isTestingPhase() {
     String phase = execution.getLifecyclePhase();
-    return phase.equals(""test"") || phase.equals(""integration-test"");
+    return phase!=null && (phase.equals(""test"") || phase.equals(""integration-test""));
   }
 
   protected abstract void execute(FrontendPluginFactory factory) throws FrontendException;",0
Fix issues with Android BackHandler," 
     @Override
     public void invokeDefaultOnBackPressed() {
+        if (layout != null && !layout.onBackPressed()) {
         super.onBackPressed();
     }
+    }
 
     @Override
     public void onBackPressed() {
-        if (layout != null && !layout.onBackPressed()) {
+        if (getReactGateway().isInitialized()) {
             getReactGateway().onBackPressed();
         }
     }",0
FIX ISSUE #127 NettyAsyncHttpProdiver redirects ignoring case,"                 String location = response.getHeader(HttpHeaders.Names.LOCATION);
                 URI uri = AsyncHttpProviderUtils.getRedirectUri(future.getURI(), location);
                 boolean stripQueryString = config.isRemoveQueryParamOnRedirect();
-                if (!uri.toString().equalsIgnoreCase(future.getURI().toString())) {
+                if (!uri.toString().equals(future.getURI().toString())) {
                     final RequestBuilder nBuilder = stripQueryString ?
                             new RequestBuilder(future.getRequest()).setQueryParameters(null)
                             : new RequestBuilder(future.getRequest());",0
:bug: 防止多开,"         final String userName = user.optString(User.USER_NAME);
         boolean playing = false;
         LOGGER.debug(""new connection from "" + userName);
+        if(SESSIONS.containsKey(userId)){
+            JSONObject sendText = new JSONObject();
+            sendText.put(""type"", 6);
+            sendText.put(""message"", ""【系统】：您已在匹配队列中，请勿开始多个游戏，如需打开新的窗口，请先关闭原窗口再开始"");
+            session.getAsyncRemote().sendText(sendText.toString());
+            return;
+        }else{
         SESSIONS.put(userId, session);
+        }
         for (String temp : chessPlaying.keySet()) {
             ChessGame chessGame = chessPlaying.get(temp);
             if (userId.equals(chessGame.getPlayer1())) { //玩家1返回战局",0
minor fix for copy," 
 
             if (counter == a.size()) {
-                if (lol != null) {
+                if (lol != null && lol.size() != 0) {
                     Intent intent = new Intent(con, CopyService.class);
                     intent.putExtra(""FILE_PATHS"", lol);
                     intent.putExtra(""COPY_DIRECTORY"", ma.current);
@@ -755,7 +755,7 @@
             super.onPostExecute(strings);
             if (!move) {
 
-                if (b != null) {
+                if (b != null && b.size() != 0) {
 
                     Intent intent = new Intent(con, CopyService.class);
                     intent.putExtra(""FILE_PATHS"", b);
@@ -763,7 +763,7 @@
                     startService(intent);
                 }
 
-                if (a != null) {
+                if (a != null && a.size() != 0) {
                     showDialog();
                 }
             } else {",0
Hot/Cold clue West of Brimhaven location fix," 	KANDARIN_BA_AGILITY_COURSE(new WorldPoint(2536, 3546, 0), KANDARIN, ""Inside the Barbarian Agility Course. Completion of Alfred Grimhand's Barcrawl is required.""),
 	KARAMJA_MUSA_POINT(new WorldPoint(2914, 3168, 0), KARAMJA, ""Musa Point, banana plantation.""),
 	KARAMJA_BRIMHAVEN_FRUIT_TREE(new WorldPoint(2783, 3214, 0), KARAMJA, ""Brimhaven, east of the fruit tree patch.""),
-	KARAMJA_WEST_BRIMHAVEN(new WorldPoint(2715, 3161, 0), KARAMJA, ""West of Brimhaven.""),
+	KARAMJA_WEST_BRIMHAVEN(new WorldPoint(2721, 3169, 0), KARAMJA, ""West of Brimhaven.""),
 	KARAMJA_GLIDER(new WorldPoint(2966, 2975, 0), KARAMJA, ""West of the gnome glider.""),
 	KARAMJA_KHARAZI_NE(new WorldPoint(2908, 2922, 0), KARAMJA, ""North-eastern part of Kharazi Jungle.""),
 	KARAMJA_KHARAZI_SW(new WorldPoint(2783, 2898, 0), KARAMJA, ""South-western part of Kharazi Jungle.""),",0
Fix the NPE in isBulkInsertable() by changing .get() to .containsKey(),"   }
   
   public Boolean isBulkInsertable(Class<? extends PersistentObject> persistentObjectClass) {
-  	return bulkInsertableMap != null && bulkInsertableMap.get(persistentObjectClass);
+  	return bulkInsertableMap != null && bulkInsertableMap.containsKey(persistentObjectClass);
   }
 
   // getters and setters //////////////////////////////////////////////////////",0
fix motan2 decode bug,"                 request.setMethodName(metaMap.remove(M2_METHOD));
                 request.setParamtersDesc(metaMap.remove(M2_METHOD_DESC));
                 request.setAttachments(metaMap);
+                if (obj != null) {
                 request.setArguments(new Object[]{obj});
+                }
                 if (metaMap.get(M2_GROUP) != null) {
                     request.setAttachment(URLParamType.group.getName(), metaMap.get(M2_GROUP));
                 }",0
Fix ScreenUtils reading pixels outside the framebuffer," 	 * @param w the width of the framebuffer contents to capture
 	 * @param h the height of the framebuffer contents to capture */
 	public static TextureRegion getFrameBufferTexture (int x, int y, int w, int h) {
-		Gdx.gl.glPixelStorei(GL10.GL_PACK_ALIGNMENT, 1);
 		final int potW = MathUtils.nextPowerOfTwo(w);
 		final int potH = MathUtils.nextPowerOfTwo(h);
 
-		final Pixmap pixmap = new Pixmap(potW, potH, Format.RGBA8888);
-		ByteBuffer pixels = pixmap.getPixels();
-		Gdx.gl.glReadPixels(x, y, potW, potH, GL10.GL_RGBA, GL10.GL_UNSIGNED_BYTE, pixels);
-
-		Texture texture = new Texture(pixmap);
+		final Pixmap pixmap = getFrameBufferPixmap(x, y, w, h);
+		final Pixmap potPixmap = new Pixmap(potW, potH, Format.RGBA8888);
+		potPixmap.drawPixmap(pixmap, 0, 0);
+		Texture texture = new Texture(potPixmap);
 		TextureRegion textureRegion = new TextureRegion(texture, 0, h, w, -h);
 		pixmap.dispose();
 ",0
Fix spelling of highlight," 	@ConfigItem(
 		position = 3,
 		keyName = ""notifyOnHighlight"",
-		name = ""Notify on hightlight"",
+		name = ""Notify on highlight"",
 		description = ""Notifies you whenever a highlighted word is matched""
 	)
 	default boolean notifyOnHighlight()",0
Fix typo in CasOAuthConfiguration.java,"     }
 
     @Bean
-    @ConditionalOnMissingBean(name = ""oauth20ValidationServiceSelectionStrategy"")
-    public AuthenticationRequestServiceSelectionStrategy oauth20ValidationServiceSelectionStrategy() {
+    @ConditionalOnMissingBean(name = ""oauth20AuthenticationRequestServiceSelectionStrategy"")
+    public AuthenticationRequestServiceSelectionStrategy oauth20AuthenticationRequestServiceSelectionStrategy() {
         final OAuth20AuthenticationRequestServiceSelectionStrategy s = new OAuth20AuthenticationRequestServiceSelectionStrategy();
         s.setServicesManager(servicesManager);
         s.setWebApplicationServiceFactory(webApplicationServiceFactory);
@@ -422,6 +422,6 @@
             servicesManager.load();
         }
 
-        this.authenticationRequestServiceSelectionStrategies.add(0, oauth20ValidationServiceSelectionStrategy());
+        this.authenticationRequestServiceSelectionStrategies.add(0, oauth20AuthenticationRequestServiceSelectionStrategy());
     }
 }",0
Fix drop table test to use correct table,"             throws Exception
     {
         assertFalse(queryRunner.tableExists(getSession(), ""test_drop_if_exists""));
-        assertQueryTrue(""DROP TABLE IF EXISTS test_create"");
+        assertQueryTrue(""DROP TABLE IF EXISTS test_drop_if_exists"");
         assertFalse(queryRunner.tableExists(getSession(), ""test_drop_if_exists""));
     }
 ",0
fix issue #569," 
 import org.ansj.dic.PathToStream;
 import org.ansj.exception.LibraryException;
+import org.nlpcn.commons.lang.util.IOUtil;
 import org.nlpcn.commons.lang.util.logging.Log;
 import org.nlpcn.commons.lang.util.logging.LogFactory;
 
 import java.io.*;
+import java.nio.charset.StandardCharsets;
 import java.util.Vector;
 
 /**
@@ -80,6 +82,10 @@
 
 		for (int i = 0; i < libs.length; i++) {
 			vector.add(new FileInputStream(libs[i]));
+
+            if (i < libs.length - 1) {
+                vector.add(new ByteArrayInputStream(IOUtil.LINE.getBytes(StandardCharsets.UTF_8)));
+            }
 		}
 
 		return new SequenceInputStream(vector.elements());",0
Fixed typo on README.md related to themes/style customization file on…," 
         result = result.withResizedFile(resized);
 
-        FileOutputStream fos;
-        try
+        try (FileOutputStream fos = new FileOutputStream(result.resized))
         {
-            fos = new FileOutputStream(result.resized);
-            fos.write(bytes.toByteArray());
+            bytes.writeTo(fos);
         }
         catch (IOException e)
         {",0
fix transaction report for truncated transaction," import org.codehaus.plexus.logging.LogEnabled;
 import org.codehaus.plexus.logging.Logger;
 import org.unidal.lookup.annotation.Inject;
+import org.unidal.tuple.Pair;
 
 import com.dianping.cat.analysis.AbstractMessageAnalyzer;
 import com.dianping.cat.consumer.transaction.model.entity.Duration;
@@ -15,6 +16,7 @@
 import com.dianping.cat.consumer.transaction.model.entity.TransactionName;
 import com.dianping.cat.consumer.transaction.model.entity.TransactionReport;
 import com.dianping.cat.consumer.transaction.model.entity.TransactionType;
+import com.dianping.cat.message.Event;
 import com.dianping.cat.message.Message;
 import com.dianping.cat.message.Transaction;
 import com.dianping.cat.message.spi.MessageTree;
@@ -31,6 +33,35 @@
 	@Inject
 	private TransactionDelegate m_delegate;
 
+	private Pair<Boolean, Long> checkForTruncatedMessage(MessageTree tree, Transaction t) {
+		Pair<Boolean, Long> pair = new Pair<Boolean, Long>(true, t.getDurationInMicros());
+		List<Message> children = t.getChildren();
+		int size = children.size();
+
+		if (tree.getMessage() == t && size > 0) { // root transaction with children
+			Message last = children.get(size - 1);
+
+			if (last instanceof Event) {
+				String type = last.getType();
+				String name = last.getName();
+
+				if (type.equals(""RemoteCall"") && name.equals(""Next"")) {
+					pair.setKey(false);
+				} else if (type.equals(""TruncatedTransaction"") && name.equals(""TotalDuration"")) {
+					try {
+						long delta = Long.parseLong(last.getData().toString());
+
+						pair.setValue(t.getDurationInMicros() + delta);
+					} catch (Exception e) {
+						// ignore it
+					}
+				}
+			}
+		}
+
+		return pair;
+	}
+
 	@Override
 	public void doCheckpoint(boolean atEnd) {
 		if (atEnd && !isLocalMode()) {
@@ -103,29 +134,41 @@
 		range.setSum(range.getSum() + d);
 	}
 
-	int processTransaction(TransactionReport report, MessageTree tree, Transaction t) {
+	void processTransaction(TransactionReport report, MessageTree tree, Transaction t) {
 		if (shouldDiscard(t)) {
-			return 0;
+			return;
 		}
 
 		String ip = tree.getIpAddress();
 		TransactionType type = report.findOrCreateMachine(ip).findOrCreateType(t.getType());
 		TransactionName name = type.findOrCreateName(t.getName());
 		String messageId = tree.getMessageId();
-		int count = 0;
+		Pair<Boolean, Long> pair = checkForTruncatedMessage(tree, t);
 
+		if (pair.getKey().booleanValue()) {
+			processTypeAndName(t, type, name, messageId, pair.getValue().doubleValue() / 1000d);
+		}
+
+		List<Message> children = t.getChildren();
+
+		for (Message child : children) {
+			if (child instanceof Transaction) {
+				processTransaction(report, tree, (Transaction) child);
+			}
+		}
+	}
+
+	protected void processTypeAndName(Transaction t, TransactionType type, TransactionName name, String messageId, double duration) {
 		type.incTotalCount();
 		name.incTotalCount();
 
 		if (t.isSuccess()) {
 			if (type.getSuccessMessageUrl() == null) {
 				type.setSuccessMessageUrl(messageId);
-				count++;
 			}
 
 			if (name.getSuccessMessageUrl() == null) {
 				name.setSuccessMessageUrl(messageId);
-				count++;
 			}
 		} else {
 			type.incFailCount();
@@ -133,17 +176,14 @@
 
 			if (type.getFailMessageUrl() == null) {
 				type.setFailMessageUrl(messageId);
-				count++;
 			}
 
 			if (name.getFailMessageUrl() == null) {
 				name.setFailMessageUrl(messageId);
-				count++;
 			}
 		}
 
 		// update statistics
-		double duration = t.getDurationInMicros() / 1000d;
 		Integer allDuration = new Integer((int) duration);
 
 		name.setMax(Math.max(name.getMax(), duration));
@@ -158,22 +198,11 @@
 		type.setSum2(type.getSum2() + duration * duration);
 		type.findOrCreateAllDuration(allDuration).incCount();
 
-		double d = t.getDurationInMicros() / 1000d;
 		long current = t.getTimestamp() / 1000 / 60;
 		int min = (int) (current % (60));
 
-		processNameGraph(t, name, min, d);
-		processTypeRange(t, type, min, d);
-
-		List<Message> children = t.getChildren();
-
-		for (Message child : children) {
-			if (child instanceof Transaction) {
-				count += processTransaction(report, tree, (Transaction) child);
-			}
-		}
-
-		return count;
+		processNameGraph(t, name, min, duration);
+		processTypeRange(t, type, min, duration);
 	}
 
 	private void processTypeRange(Transaction t, TransactionType type, int min, double d) {
@@ -182,6 +211,7 @@
 		if (!t.isSuccess()) {
 			range.incFails();
 		}
+
 		range.incCount();
 		range.setSum(range.getSum() + d);
 	}",0
Improve error message and exception when a missing type is specified …," /*
- * Copyright (c) 2012, Oracle and/or its affiliates. All rights reserved.
+ * Copyright (c) 2012, 2016, Oracle and/or its affiliates. All rights reserved.
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
  * This code is free software; you can redistribute it and/or modify it
@@ -457,15 +457,21 @@
                 String name = ElementUtils.firstLetterLowerCase(ElementUtils.getAnnotationValue(String.class, mirror, ""name""));
                 TypeMirror type = ElementUtils.getAnnotationValue(TypeMirror.class, mirror, ""type"");
 
+                if (type != null) {
                 NodeFieldData field = new NodeFieldData(typeElement, mirror, new CodeVariableElement(type, name), true);
                 if (name.isEmpty()) {
                     field.addError(ElementUtils.getAnnotationValue(mirror, ""name""), ""Field name cannot be empty."");
                 } else if (names.contains(name)) {
                     field.addError(ElementUtils.getAnnotationValue(mirror, ""name""), ""Duplicate field name '%s'."", name);
                 }
+
                 names.add(name);
 
                 fields.add(field);
+                } else {
+                    // Type is null here. This indicates that the type could not be resolved.
+                    // The Java compiler will subsequently raise the appropriate error.
+                }
             }
         }
 ",0
Fix #74 Add TreeExpansionListener to expand descendant tree nodes with only one member," import javax.swing.SwingUtilities;
 import javax.swing.event.ChangeEvent;
 import javax.swing.event.ChangeListener;
+import javax.swing.event.TreeExpansionEvent;
+import javax.swing.event.TreeExpansionListener;
 import javax.swing.tree.DefaultMutableTreeNode;
 import javax.swing.tree.DefaultTreeModel;
 import javax.swing.tree.TreeNode;
@@ -117,6 +119,7 @@
 		tree.setCellRenderer(new CellRenderer());
 		TreeListener tl = new TreeListener();
 		tree.addMouseListener(tl);
+		tree.addTreeExpansionListener(new FurtherExpandingTreeExpansionListener());
 		tree.addKeyListener(new KeyAdapter() {
 
 			@Override
@@ -246,6 +249,35 @@
 		}
 	}
 
+	private class FurtherExpandingTreeExpansionListener implements TreeExpansionListener {
+		@Override
+		public void treeExpanded(final TreeExpansionEvent event) {
+			final TreePath treePath = event.getPath();
+
+			final Object expandedTreePathObject = treePath.getLastPathComponent();
+			if (!(expandedTreePathObject instanceof TreeNode)) {
+				return;
+			}
+
+			final TreeNode expandedTreeNode = (TreeNode) expandedTreePathObject;
+			if (expandedTreeNode.getChildCount() == 1) {
+				final TreeNode descendantTreeNode = expandedTreeNode.getChildAt(0);
+
+				if (descendantTreeNode.isLeaf()) {
+					return;
+				}
+
+				final TreePath nextTreePath = treePath.pathByAddingChild(descendantTreeNode);
+				tree.expandPath(nextTreePath);
+			}
+		}
+
+		@Override
+		public void treeCollapsed(final TreeExpansionEvent event) {
+
+		}
+	}
+
 	public void openEntryByTreePath(TreePath trp) {
 		String name = """";
 		String path = """";",0
Fix NPE in ApiClientImpl,"                 final ListenableFuture<Response> future = context.listenableFuture;
                 try {
                     final Response response = future.get(timeoutValue, timeoutUnit);
+                    if(response == null) {
+                        LOG.error(""Didn't receive response from node {}"", node);
+                        node.markFailure();
+                        continue;
+                    }
                     node.touch();
                     final T result = handleResponse(context.request, response);
                     results.put(node, result);",0
fixing exception of updating layout from cameraKit thread on some dev…,"             // Request a layout pass for onMeasure() to do its stuff.
             // Potentially this will change CameraView size, which changes Surface size,
             // which triggers a new Preview size. But hopefully it will converge.
+            uiHandler.post(new Runnable() {
+                @Override
+                public void run() {
             requestLayout();
         }
+            });
+        }
 
 
         /**",0
[6.x] Fix potential non-threadsafe use of Cipher,"     private String secretKeyAlgorithm = ""AES"";
     private byte[] encryptionSecretKey;
 
+    private final String cipherAlgorithm = ""AES"";
+
     /**
      * Instantiates a new cryptic ticket cipher executor.
      *
@@ -60,7 +62,6 @@
         ensureSigningKeyExists(signingSecretKey, signingKeySize);
         ensureEncryptionKeyExists(encryptionSecretKey, encryptionKeySize);
         this.encryptionKey = new SecretKeySpec(this.encryptionSecretKey, this.secretKeyAlgorithm);
-        this.aesCipher = Cipher.getInstance(""AES"");
     }
 
     @SneakyThrows
@@ -73,8 +74,9 @@
     @Override
     @SneakyThrows
     public byte[] encode(final byte[] value, final Object[] parameters) {
-        this.aesCipher.init(Cipher.ENCRYPT_MODE, this.encryptionKey);
-        val result = this.aesCipher.doFinal(value);
+        val aesCipher = Cipher.getInstance(cipherAlgorithm); 
+        aesCipher.init(Cipher.ENCRYPT_MODE, this.encryptionKey);
+        val result = aesCipher.doFinal(value);
         return sign(result);
     }
 
@@ -82,7 +84,8 @@
     @SneakyThrows
     public byte[] decode(final byte[] value, final Object[] parameters) {
         val verifiedValue = verifySignature(value);
-        this.aesCipher.init(Cipher.DECRYPT_MODE, this.encryptionKey);
+        val aesCipher = Cipher.getInstance(cipherAlgorithm); 
+        aesCipher.init(Cipher.DECRYPT_MODE, this.encryptionKey);
         val bytePlainText = aesCipher.doFinal(verifiedValue);
         return bytePlainText;
     }",0
Fix for crash when using an image in Crouton,"       RelativeLayout.LayoutParams.WRAP_CONTENT);
     imageParams.addRule(RelativeLayout.ALIGN_PARENT_LEFT, RelativeLayout.TRUE);
     imageParams.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);
+    
+    image.setLayoutParams(imageParams);
+    
     return image;
   }
 ",0
timer memory leak bug fix,"     public static void releaseAllVideos() {
         if (!isClickFullscreen) {
             JCMediaManager.intance().mediaPlayer.stop();
+            JCMediaManager.intance().mediaPlayer = null;
             JCMediaManager.intance().setUuid("""");
             JCMediaManager.intance().setUuid("""");
             EventBus.getDefault().post(new VideoEvents().setType(VideoEvents.VE_MEDIAPLAYER_FINISH_COMPLETE));
+            if (mUpdateProgressTimer != null) {
+                mUpdateProgressTimer.cancel();
+            }
         }
     }
 ",0
Fix: launched apps share the same entry in Overview screen," 		mAM = (ActivityManager) VirtualCore.get().getContext().getSystemService(Context.ACTIVITY_SERVICE);
 	}
 
+	@SuppressWarnings(""deprecation"")
 	public Intent startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder resultTo, boolean fromHost, Bundle options) {
 		Intent newIntent = new Intent();
 		newIntent.setType(intent.getComponent().flattenToString());
 		String taskAffinity = ComponentUtils.getTaskAffinity(info, userId);
 		ActivityRecord sourceRecord = findRecord(resultTo);
         if (fromHost && findTask(taskAffinity) == null) {
+			if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP)
+				newIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_WHEN_TASK_RESET);
+			else
+				newIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_DOCUMENT);
             newIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
             newIntent.addFlags(Intent.FLAG_ACTIVITY_MULTIPLE_TASK);
         }",0
[PDI-13182] - Fix invalid message,"       ExtensionPointHandler.callExtensionPoint( log, KettleExtensionPoint.JobMetaLoaded.id, jobMeta );
       return jobMeta;
     } catch ( Exception e ) {
-      throw new KettleException( ""Unable to load transformation from path ["" + absPath + ""]"", e );
+      throw new KettleException( ""Unable to load job from path ["" + absPath + ""]"", e );
     }
   }
 ",0
2.x: Correctly dereference subscription before comparing against null.,"      * @return true if this TestSubscriber received a subscription
      */
     public final boolean hasSubscription() {
-        return subscription != null;
+        return subscription.get() != null;
     }
     
     /**
@@ -577,7 +577,7 @@
      * @return this;
      */
     public final TestObserver<T> assertSubscribed() {
-        if (subscription == null) {
+        if (subscription.get() == null) {
             fail(""Not subscribed!"");
         }
         return this;
@@ -588,7 +588,7 @@
      * @return this;
      */
     public final TestObserver<T> assertNotSubscribed() {
-        if (subscription != null) {
+        if (subscription.get() != null) {
             fail(""Subscribed!"");
         } else
         if (!errors.isEmpty()) {",0
Fix closing by Esc Navigate to File panel," 
   @Override
   public void hidePopup() {
+    if (suggestionsContainer != null) {
     suggestionsContainer.removeFromParent();
+    }
     suggestionsPanel.setVisible(false);
 
     suggestionsPanel.getElement().getStyle().setWidth(400, Style.Unit.PX);",0
[Bug Fix] Tabs of incorrect size,"             if (tabView.getParent() == null) {
                 tabContainer.addView(tabView);
             }
+
+            tabView.setLayoutParams(params);
         }
     }
 ",0
Fix bug which led to infinite retries of an indexing attempt,"                 indexShard.shardId(), item.opType(), item.id(), version, item.source().utf8ToString());
         }
         return indexShard.prepareIndexOnPrimary(
-            sourceToParse, version, item.versionType(), -1, request.isRetry());
+            // Do not use item.versionType() here, it might have been changed to VersionType.EXTERNAL
+            // for writing the version on the replica. We might end up here again because the ShardUpsertRequest
+            // failed before all items could be processed. The request will then be retried.
+            // For primaries, we always want to use VersionType.INTERNAL.
+            sourceToParse, version, VersionType.INTERNAL, -1, request.isRetry());
     }
 
     private Engine.Index updateMappingIfRequired(ShardUpsertRequest request,",0
Fixing migration to single dex after multidex.,"             if (extractedFile.isFile()) {
                 sourcePaths.add(extractedFile.getAbsolutePath());
                 //we ignore the verify zip part
-            } else {
-                throw new IOException(""Missing extracted secondary dex file '"" +
-                        extractedFile.getPath() + ""'"");
             }
         }
 ",0
publish: Fix another race between terminalEvent and the queue being empty.,"                         // may contain less than requested
                         int d = 0;
                         while (d < maxRequested) {
+                            term = terminalEvent;
                             Object v = queue.poll();
                             empty = v == null;
                             // let's check if there is a terminal event and the queue became empty just now
-                            if (checkTerminated(terminalEvent, empty)) {
+                            if (checkTerminated(term, empty)) {
                                 skipFinal = true;
                                 return;
                             }",0
Improved fix for Issue #4017 where tweak mode ignores some numbers in a second tab,"   List<List<Range>> scientificNotations;
 
   // currently is used to ignore numbers in 'setup' and 'settings' functions
-  List<Range> ignoreFunctions;
+  List<List<Range>> ignoreFunctions;
 
   List<List<Range>> commentBlocks;
   List<int[]> curlyScopes;
@@ -59,11 +59,15 @@
     }
 
     // add 'settings' and 'setup' to ignore list (to ignore all numbers there)
-    ignoreFunctions = new ArrayList<Range>();
-    ignoreFunctions.add(new Range(getVoidFunctionStart(codeTabs[0], ""settings""),
-                                  getVoidFunctionEnd(codeTabs[0], ""settings"")));
-    ignoreFunctions.add(new Range(getVoidFunctionStart(codeTabs[0], ""setup""),
-                                  getVoidFunctionEnd(codeTabs[0], ""setup"")));
+    ignoreFunctions = new ArrayList<>();
+    ignoreFunctions.add(Arrays.asList(new Range(getVoidFunctionStart(codeTabs[0], ""settings""),
+                                  				getVoidFunctionEnd(codeTabs[0], ""settings"")),
+                                  	  new Range(getVoidFunctionStart(codeTabs[0], ""setup""),
+                                  			  	getVoidFunctionEnd(codeTabs[0], ""setup""))));
+    
+    //Add empty lists for the other tabs so we do not get an index out of bounds error later
+    for(int i = 0; i < codeTabs.length-1; i++)
+    	ignoreFunctions.add(Collections.EMPTY_LIST);
 
     // build curly scope for every character in the code
     curlyScopes = new ArrayList<>();
@@ -102,7 +106,6 @@
     }
   }
 
-
   /**
    * Get a list of all the numbers in this sketch
    * @return
@@ -130,7 +133,7 @@
           continue;
         }
 
-        if (isInRangeList(start, ignoreFunctions)) {
+        if (isInRangeList(start, ignoreFunctions.get(i))) {
           // ignore numbers in predefined functions
           continue;
         }
@@ -222,7 +225,7 @@
           continue;
         }
 
-        if (isInRangeList(start, ignoreFunctions)) {
+        if (isInRangeList(start, ignoreFunctions.get(i))) {
           // ignore numbers in predefined functions
           continue;
         }
@@ -283,7 +286,7 @@
           continue;
         }
 
-        if (isInRangeList(start, ignoreFunctions)) {
+        if (isInRangeList(start, ignoreFunctions.get(i))) {
           // ignore numbers in predefined functions
           continue;
         }
@@ -387,7 +390,7 @@
           continue;
         }
 
-        if (isInRangeList(m.start(), ignoreFunctions)) {
+        if (isInRangeList(m.start(), ignoreFunctions.get(i))) {
           // ignore numbers in predefined functions
           continue;
         }
@@ -471,7 +474,7 @@
           continue;
         }
 
-        if (isInRangeList(m.start(), ignoreFunctions)) {
+        if (isInRangeList(m.start(), ignoreFunctions.get(i))) {
           // ignore numbers in predefined functions
           continue;
         }",0
Make boost overlay to change to yellow at threshold ," 			return new Color(238, 51, 51);
 		}
 
-		return boosted - base < config.boostThreshold() ? Color.YELLOW : Color.GREEN;
+		return boosted - base <= config.boostThreshold() ? Color.YELLOW : Color.GREEN;
 	}
 
 	@Override",0
Don't throw exception from notifyAboutChanges() if RxJava is not available,"         }
 
         @Override public void notifyAboutChanges(@NonNull Changes changes) {
-            if (changesBus == null) {
-                throw EnvironmentUtil.newRxJavaIsNotAvailableException(""Notifying about changes in StorIODb"");
-            }
-
+            // Notifying about changes requires RxJava, if RxJava is not available -> skip notification
+            if (changesBus != null) {
             changesBus.onNext(changes);
         }
+        }
 
         @Override public boolean transactionsSupported() {
             return true;",0
fix does not work on Samsung,"         try {
             cursor = contentResolver.query(mUri, CONTENT_PROJECTION, ""package=?"", new String[]{getContextPackageName()}, null);
             if (cursor != null) {
+                String entryActivityName = getEntryActivityName();
+                boolean entryActivityExist = false;
                 while (cursor.moveToNext()) {
                     int id = cursor.getInt(0);
                     ContentValues contentValues = getContentValues(badgeCount, false);
                     contentResolver.update(mUri, contentValues, ""_id=?"", new String[]{String.valueOf(id)});
+                    if (entryActivityName.equals(cursor.getString(cursor.getColumnIndex(""class"")))) {
+                        entryActivityExist = true;
                 }
-            } else {
+                }
+
+                if (!entryActivityExist) {
                 ContentValues contentValues = getContentValues(badgeCount, true);
                 contentResolver.insert(mUri, contentValues);
             }
+            }
         } finally {
             CloseHelper.close(cursor);
         }",0
REPL debugger:  fix display bug for frame with no slots,"             } else {
                 Integer frameNumber = replies[0].getIntValue(REPLMessage.FRAME_NUMBER);
                 context.selectFrameNumber(frameNumber);
+                if (replies[0].get(REPLMessage.SLOT_INDEX) == null) {
+                    context.displayReply(""Frame "" + frameNumber + "": <empty"");
+                } else {
                 context.displayReply(""Frame "" + frameNumber + "":"");
                 for (REPLMessage message : replies) {
                     final StringBuilder sb = new StringBuilder();
@@ -552,6 +555,7 @@
                 }
             }
         }
+        }
     };
 
     public static final REPLRemoteCommand KILL_CMD = new REPLRemoteCommand(""kill"", null, ""Stop program execution"") {",0
fix(BundleServiceComparator): use ternary operator instead of Integer#compare() that requires API level 19,"     String[] rightPath = right.scope.getPath().split(MortarScope.DIVIDER);
 
     if (leftPath.length != rightPath.length) {
-      return Integer.compare(leftPath.length, rightPath.length);
+      return leftPath.length < rightPath.length ? -1 : 1;
     }
 
     int segments = leftPath.length;",0
JENKINS-43462# Fixed erroneous 403 error for favorite API," 
     @Override
     public BlueFavoriteContainer getFavorites() {
-        String name = Jenkins.getAuthentication().getName();
-        if(!user.getId().equals(name)) {
-            throw new ForbiddenException(""This user '"" + name + ""' cannot access resource owned by '"" + user.getId() + ""'"");
+
+        /*
+         * Get the user id using authenticated user. User.current() returns authenticated user using security realm and
+         * associated IdStrategy to get a consistent id.
+         *
+         * @see IdStrategy#keyFor(String)
+         * @see IdStrategy.CaseInsensitive#keyFor(String)
+         *
+         */
+        User u = User.current();
+        String expectedUserId = u != null ? u.getId(): Jenkins.ANONYMOUS.getName();
+
+        if(!user.getId().equals(expectedUserId)) {
+            throw new ForbiddenException(""This user '"" + expectedUserId + ""' cannot access resource owned by '"" + user.getId() + ""'"");
         }
         return new FavoriteContainerImpl(this, this);
     }",0
obvious fix for header click handler,"         }
         mHeader = newHeader;
         addView(mHeader);
+        if (mOnHeaderClickListener != null) {
         mHeader.setOnClickListener(new OnClickListener() {
-
             @Override
             public void onClick(View v) {
-                if (mOnHeaderClickListener != null) {
                     mOnHeaderClickListener.onHeaderClick(
                             StickyListHeadersListView.this, mHeader,
                             mHeaderPosition, mHeaderId, true);
                 }
-            }
-
         });
     }
+        mHeader.setClickable(true);
+    }
 
     // hides the headers in the list under the sticky header.
     // Makes sure the other ones are showing
@@ -597,6 +596,17 @@
         if (mAdapter != null) {
             if (mOnHeaderClickListener != null) {
                 mAdapter.setOnHeaderClickListener(new AdapterWrapperHeaderClickHandler());
+
+                if (mHeader != null) {
+                    mHeader.setOnClickListener(new OnClickListener() {
+                        @Override
+                        public void onClick(View v) {
+                            mOnHeaderClickListener.onHeaderClick(
+                                    StickyListHeadersListView.this, mHeader,
+                                    mHeaderPosition, mHeaderId, true);
+                        }
+                    });
+                }
             } else {
                 mAdapter.setOnHeaderClickListener(null);
             }",0
fix: Restore support for AAR files (issue #95)," 			loadFromZip("".dex"");
 			return;
 		}
-		if (fileName.endsWith("".jar"")) {
-			// check if jar contains '.dex' files
+		if (fileName.endsWith("".jar"") || fileName.endsWith("".aar"")) {
+			// check if jar/aar contains '.dex' files
 			if (loadFromZip("".dex"")) {
 				return;
 			}",0
fix transaction error of synced Realm.,"         } finally {
             if (commitChanges) {
                 realm.commitTransaction(false);
+            } else {
+                realm.cancelTransaction();
             }
         }
     }",0
checkWriteBuffer可能分配不够的空间，存在潜在Bug," 		if (capacity > buffer.remaining()) {
 			if (writeSocketIfFull) {
 				writeNotSend(buffer);
-				return allocate();
+				int newSize=processor.getBufferPool().getChunkSize();
+				newSize=(newSize>capacity)?newSize:capacity;
+				return processor.getBufferPool().allocate(newSize);
 			} else {// Relocate a larger buffer
 				buffer.flip();
-				ByteBuffer newBuf = ByteBuffer.allocate(capacity);
+				ByteBuffer newBuf = processor.getBufferPool().allocate(capacity+buffer.limit()+1);
 				newBuf.put(buffer);
 				this.recycle(buffer);
 				return newBuf;",0
fix高并发npe和排序问题," import java.util.Map.Entry;
 import java.util.concurrent.ConcurrentLinkedQueue;
 import java.util.concurrent.LinkedTransferQueue;
+import java.util.concurrent.atomic.AtomicInteger;
 import java.util.concurrent.atomic.AtomicReferenceArray;
 import java.util.concurrent.locks.ReentrantLock;
 
@@ -69,6 +70,7 @@
 	private final MultiNodeQueryHandler multiQueryHandler;
 	private int fieldCount;
 	private final RouteResultset rrs;
+    private AtomicInteger rowBatchCount=new AtomicInteger(0);
 
 	public DataMergeService(MultiNodeQueryHandler queryHandler,
 			RouteResultset rrs) {
@@ -99,13 +101,34 @@
 		Runnable outPutJob = new Runnable() {
 			@Override
 			public void run() {
+                if(rowBatchCount.get()>0)
+                {
+                    jobQueue.offer(this);
+                    if(rowBatchCount.get()==0)
+                    {
+                        Runnable newJob = jobQueue.poll();
+                        if (newJob != null)
+                        {
+                            newJob.run();
+                        }
+                    }
+                } else
+                {
 				multiQueryHandler.outputMergeResult(session.getSource(), eof);
+
+                }
+
 			}
 		};
 		jobQueue.offer(outPutJob);
 		if (jobRuninng == false && !jobQueue.isEmpty()) {
+
+            Runnable job = jobQueue.poll();
+            if(job!=null)
+            {
 			MycatServer.getInstance().getBusinessExecutor()
-					.execute(jobQueue.poll());
+                        .execute(job);
+            }
 		}
 	}
 
@@ -271,6 +294,7 @@
 
 	private Runnable createJob(final String dnName,
 			AtomicReferenceArray<byte[]> batchedArray) {
+
 		final ArrayList<byte[]> rows = new ArrayList<byte[]>(
 				batchedArray.length());
 		for (int i = 0; i < batchedArray.length(); i++) {
@@ -281,6 +305,9 @@
 		}
 		if (rows.isEmpty()) {
 			return null;
+		}  else
+        {
+            rowBatchCount.incrementAndGet();
 		}
 		Runnable job = new Runnable() {
 			public void run() {
@@ -291,12 +318,13 @@
 							break;
 						}
 					}
-
+                    rowBatchCount.decrementAndGet();
 					// for next job
 					Runnable newJob = jobQueue.poll();
 					if (newJob != null) {
-						MycatServer.getInstance().getBusinessExecutor()
-								.execute(newJob);
+//						MycatServer.getInstance().getBusinessExecutor()
+//								.execute(newJob);
+                        newJob.run();
 					} else {
 						jobRuninng = false;
 					}
@@ -347,6 +375,7 @@
 		grouper = null;
 		sorter = null;
 		result = null;
+        rowBatchCount.set(-1);
 		jobQueue.clear();
 	}
 ",0
Fix NPE when starting the spider," import java.net.URL;
 import java.text.MessageFormat;
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.LinkedList;
 import java.util.List;
 
@@ -103,7 +104,7 @@
 	 * The list of excluded patterns of sites. Patterns are added here with the ExcludeFromSpider
 	 * Popup Menu.
 	 */
-	private List<String> excludeList = null;
+	private List<String> excludeList = Collections.emptyList();
 
 	private ZapMenuItem menuItemCustomScan = null;
 
@@ -260,6 +261,11 @@
 	 * @param ignoredRegexs the new exclude list
 	 */
 	public void setExcludeList(List<String> ignoredRegexs) {
+		if (ignoredRegexs == null || ignoredRegexs.isEmpty()) {
+			excludeList = Collections.emptyList();
+			return;
+		}
+
 		this.excludeList = ignoredRegexs;
 	}
 ",0
fix create database error," import java.io.IOException;
 import java.sql.Connection;
 import java.sql.DriverManager;
+import java.sql.ResultSet;
 import java.sql.SQLException;
 import java.sql.Statement;
 import java.util.regex.Pattern;
@@ -54,9 +55,12 @@
 	private boolean m_verbose = false;
 
 	private void createDatabase(Statement stmt) throws SQLException {
+		ResultSet result = null;
 		try {
+			result = stmt.executeQuery(""SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = 'cat'"");
+			if (!result.next()) {
 			stmt.executeUpdate(""create database cat"");
-
+			}
 		} catch (SQLException e) {
 			if (e.getErrorCode() == 1007) {
 				getLog().info(""Database 'cat' already exists, drop it first..."");
@@ -67,6 +71,8 @@
 			} else {
 				throw e;
 			}
+		} finally {
+			result.close();
 		}
 	}
 
@@ -217,7 +223,6 @@
 			      }
 		      });
 		m_user = PropertyProviders.fromConsole().forString(""jdbc.user"", ""Please input username:"", null, null, null);
-		m_password = PropertyProviders.fromConsole().forString(""jdbc.password"", ""Please input password:"", null, """",
-		      null);
+		m_password = PropertyProviders.fromConsole().forString(""jdbc.password"", ""Please input password:"", null, """", null);
 	}
 }
\ No newline at end of file",0
Fix for NEP when process start_user_id field is null,"   }
   
   public UserRepresentation(User user) {
+	if(user!=null){
     setId(user.getId());
     setFirstName(user.getFirstName());
     setLastName(user.getLastName());
     setFullName( (user.getFirstName() != null ? user.getFirstName() : """") + "" "" + (user.getLastName() != null ? user.getLastName() : """"));
     setEmail(user.getEmail());
   }
+  }
   
   public String getId() {
     return id;",0
Fix #780: NullPointerException on startScan(),"             } else if (!bluetoothAdapter.isEnabled()) {
                 LogManager.w(TAG, ""Failed to start background scan on Android O: BluetoothAdapter is not enabled"");
             } else {
-                int result = bluetoothAdapter.getBluetoothLeScanner().startScan(filters, settings, getScanCallbackIntent());
+                BluetoothLeScanner scanner = bluetoothAdapter.getBluetoothLeScanner();
+                if (scanner != null) {
+                    int result = scanner.startScan(filters, settings, getScanCallbackIntent());
                 if (result != 0) {
                     LogManager.e(TAG, ""Failed to start background scan on Android O.  Code: ""+result);
-                }
-                else {
+                    } else {
                     LogManager.d(TAG, ""Started passive beacon scan"");
                 }
+                } else {
+                    LogManager.e(TAG, ""Failed to start background scan on Android O: scanner is null"");
+                }
             }
         }
         catch (SecurityException e) {",0
Address issue where entities where getting incorrectly their updated date changed when browsing the site," 
     @PrePersist
     public void setAuditCreatedBy(Object entity) throws Exception {
+        BroadleafRequestContext brc = BroadleafRequestContext.getBroadleafRequestContext();
+        if (!brc.getAdmin()) {
+            return;
+        }
+
         if (entity.getClass().isAnnotationPresent(Entity.class)) {
             Field field = getSingleField(entity.getClass(), getAuditableFieldName());
             field.setAccessible(true);
@@ -56,6 +61,11 @@
 
     @PreUpdate
     public void setAuditUpdatedBy(Object entity) throws Exception {
+        BroadleafRequestContext brc = BroadleafRequestContext.getBroadleafRequestContext();
+        if (!brc.getAdmin()) {
+            return;
+        }
+
         if (entity.getClass().isAnnotationPresent(Entity.class)) {
             Field field = getSingleField(entity.getClass(), getAuditableFieldName());
             field.setAccessible(true);",0
Fixes fullscreen on windows (Issue #154),"             Display.setFullscreen(true);
         } else {
             Display.setDisplayMode((DisplayMode) SettingsManager.getInstance().getUserSetting(""Game.Graphics.displayMode""));
+            Display.setResizable(true);
         }
 
-        Display.setResizable(true);
         Display.setTitle(""Terasology"" + "" | "" + ""Pre Alpha"");
         Display.create((PixelFormat) SettingsManager.getInstance().getUserSetting(""Game.Graphics.pixelFormat""));
     }",0
Fix wrap-around issue with RoundRobinRule.," package com.netflix.loadbalancer;
 
 import java.util.List;
-import java.util.concurrent.atomic.AtomicInteger;
+import java.util.concurrent.atomic.AtomicLong;
 
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -32,12 +32,13 @@
  * 
  */
 public class RoundRobinRule extends AbstractLoadBalancerRule {
-    AtomicInteger nextIndexAI;
+    /** We use a long to never run into wraparound issues when this runs for a long time. */
+    private AtomicLong nextIndexAI;
 
     private static Logger log = LoggerFactory.getLogger(RoundRobinRule.class);
 
     public RoundRobinRule() {
-        nextIndexAI = new AtomicInteger(0);
+        nextIndexAI = new AtomicLong(0);
     }
 
     public RoundRobinRule(ILoadBalancer lb) {
@@ -70,7 +71,7 @@
                 return null;
             }
 
-            index = nextIndexAI.incrementAndGet() % serverCount;
+            index = (int) (nextIndexAI.incrementAndGet() % serverCount);
             server = allList.get(index);
 
             if (server == null) {",0
按月分片，范围查询跨头尾分片出现空指针的bug，类似pull request1024对按天分片的修改," 
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
-import java.util.Calendar;
+import java.util.*;
 
+import org.apache.log4j.Logger;
+import org.apache.log4j.pattern.IntegerPatternConverter;
 import org.opencloudb.config.model.rule.RuleAlgorithm;
 
 /**
@@ -14,6 +16,7 @@
  */
 public class PartitionByMonth extends AbstractPartitionAlgorithm implements
 		RuleAlgorithm {
+	private static final Logger LOGGER = Logger.getLogger(PartitionByDate.class);
 	private String sBeginDate;
 	private String dateFormat;
 	private String sEndDate;
@@ -45,6 +48,26 @@
 		}
 	}
 
+	/**
+	 * For circulatory partition, calculated value of target partition needs to be
+	 * rotated to fit the partition range
+	 */
+	private int reCalculatePartition(int targetPartition) {
+		/**
+		 * If target date is previous of start time of partition setting, shift
+		 * the delta range between target and start date to be positive value
+		 */
+		if (targetPartition < 0) {
+			targetPartition = nPartition - (-targetPartition) % nPartition;
+		}
+
+		if (targetPartition >= nPartition) {
+			targetPartition =  targetPartition % nPartition;
+		}
+
+		return targetPartition;
+	}
+
 	@Override
 	public Integer calculate(String columnValue) {
 		try {
@@ -60,17 +83,7 @@
 			 * rotated to fit the partition range
  			 */
 			if (nPartition > 0) {
-				/**
-				 * If target date is previous of start time of partition setting, shift
-				 * the delta range between target and start date to be positive value
-				 */
-				if (targetPartition < 0) {
-					targetPartition = nPartition - (-targetPartition) % nPartition;
-				}
-
-				if (targetPartition >= nPartition) {
-					targetPartition = targetPartition % nPartition;
-				}
+				targetPartition = reCalculatePartition(targetPartition);
 			}
 			return targetPartition;
 
@@ -81,8 +94,33 @@
 
 	@Override
 	public Integer[] calculateRange(String beginValue, String endValue) {
-		return AbstractPartitionAlgorithm.calculateSequenceRange(this,
-				beginValue, endValue);
+		try {
+			int startPartition, endPartition;
+			Calendar partitionTime = Calendar.getInstance();
+			SimpleDateFormat format = new SimpleDateFormat(dateFormat);
+			partitionTime.setTime(format.parse(beginValue));
+			startPartition = ((partitionTime.get(Calendar.YEAR) - beginDate.get(Calendar.YEAR))
+					* 12 + partitionTime.get(Calendar.MONTH)
+					- beginDate.get(Calendar.MONTH));
+			partitionTime.setTime(format.parse(endValue));
+			endPartition = ((partitionTime.get(Calendar.YEAR) - beginDate.get(Calendar.YEAR))
+					* 12 + partitionTime.get(Calendar.MONTH)
+					- beginDate.get(Calendar.MONTH));
+
+			List<Integer> list = new ArrayList<>();
+
+			while (startPartition <= endPartition) {
+				Integer nodeValue = reCalculatePartition(startPartition);
+				if (Collections.frequency(list, nodeValue) < 1)
+					list.add(nodeValue);
+				startPartition++;
+			}
+			int size = list.size();
+			return (list.toArray(new Integer[size]));
+		} catch (ParseException e) {
+			LOGGER.error(e);
+			return new Integer[0];
+		}
 	}
 
 	public void setsBeginDate(String sBeginDate) {",0
fix add return," 		lastReadTime = TimeUtil.currentTimeMillis();
 		if (got < 0) {
 			this.close(""stream closed"");
+            return;
 		} else if (got == 0) {
 			if (!this.channel.isOpen()) {
 				this.close(""socket closed"");",0
Fix explain help text,"         return """" +
                 ""Supported commands:\n"" +
                 ""QUIT\n"" +
-                ""EXPLAIN [FORMAT {TEXT | GRAPHVIZ}] <query>\n"" +
+                ""EXPLAIN [ ( option [, ...] ) ] <query>\n"" +
+                ""    options: FORMAT { TEXT | GRAPHVIZ }\n"" +
+                ""             TYPE { LOGICAL | DISTRIBUTED }\n"" +
                 ""DESCRIBE <table>\n"" +
                 ""SHOW COLUMNS FROM <table>\n"" +
                 ""SHOW FUNCTIONS\n"" +",0
fix fieldpacket填充值问题from执笔相思," 		buffer.put((byte) (type & 0xff));
 		BufferUtil.writeUB2(buffer, flags);
 		buffer.put(decimals);
-		buffer.position(buffer.position() + FILLER.length);
+        buffer.put((byte)0x00);
+        buffer.put((byte)0x00);
+		//buffer.position(buffer.position() + FILLER.length);
 		if (definition != null) {
 			BufferUtil.writeWithLength(buffer, definition);
 		}",0
bug modify,"         StringBuilder result = new StringBuilder(""Content-Type: "");
         if (TextUtils.isEmpty(contentType)) {
             if (value instanceof String) {
-                contentType = ""text/plain; charset:"" + charset;
+                contentType = ""text/plain; charset="" + charset;
             } else {
                 contentType = ""application/octet-stream"";
             }",0
bug修复，oldServer," 			Server oldServer =getServer(txTransactionLocal,servers,key);
 			if(oldServer != null){
 				logger.info(""LCNBalanceProxy - > load old server "");
-				return server;
+				return oldServer;
 			}
 
 			putServer(key, txTransactionLocal, server);",0
Fixes an issue associated with issue #543.,"             indent + INDENT + INDENT + ""_index = -1;\n"" +
             indent + INDENT + INDENT + ""_count = count;\n"" +
             indent + INDENT + INDENT + ""_blockLength = %3$d;\n"" +
+            indent + INDENT + INDENT + ""_actingVersion = SchemaVersion;\n"" +
             indent + INDENT + INDENT + ""parentMessage.Limit = parentMessage.Limit + SbeHeaderSize;\n"" +
             indent + INDENT + ""}\n"",
             parentMessageClassName,",0
[#114] Process ZK event from background thread to avoid deadlock on ZK sync operations," import static com.yahoo.pulsar.broker.web.PulsarWebResource.joinPath;
 import static com.yahoo.pulsar.common.naming.NamespaceBundleFactory.getBundlesData;
 import static java.lang.String.format;
+import static org.apache.bookkeeper.mledger.util.SafeRun.safeRun;
 
 import java.net.URI;
 import java.net.URL;
@@ -38,7 +39,6 @@
 import org.apache.commons.lang3.tuple.Pair;
 import org.apache.zookeeper.AsyncCallback.StatCallback;
 import org.apache.zookeeper.KeeperException;
-import org.apache.zookeeper.data.Stat;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -558,8 +558,8 @@
                 for (NamespaceBundle sBundle : splittedBundles.getRight()) {
                     checkNotNull(ownershipCache.tryAcquiringOwnership(sBundle));
                 }
-                updateNamespaceBundles(nsname, splittedBundles.getLeft(), new StatCallback() {
-                    public void processResult(int rc, String path, Object zkCtx, Stat stat) {
+                updateNamespaceBundles(nsname, splittedBundles.getLeft(),
+                        (rc, path, zkCtx, stat) -> pulsar.getOrderedExecutor().submit(safeRun(() -> {
                         if (rc == KeeperException.Code.OK.intValue()) {
                             // disable old bundle
                             try {
@@ -572,19 +572,20 @@
                                 loadManager.setLoadReportForceUpdateFlag();
                                 future.complete(null);
                             } catch (Exception e) {
-                                String msg = format(""failed to disable bundle %s under namespace [%s] with error %s"",
+                                    String msg1 = format(
+                                            ""failed to disable bundle %s under namespace [%s] with error %s"",
                                         nsname.toString(), bundle.toString(), e.getMessage());
-                                LOG.warn(msg, e);
-                                future.completeExceptionally(new ServiceUnitNotReadyException(msg));
+                                    LOG.warn(msg1, e);
+                                    future.completeExceptionally(new ServiceUnitNotReadyException(msg1));
                             }
                         } else {
-                            String msg = format(""failed to update namespace [%s] policies due to %s"", nsname.toString(),
+                                String msg2 = format(""failed to update namespace [%s] policies due to %s"",
+                                        nsname.toString(),
                                     KeeperException.create(KeeperException.Code.get(rc)).getMessage());
-                            LOG.warn(msg);
-                            future.completeExceptionally(new ServiceUnitNotReadyException(msg));
+                                LOG.warn(msg2);
+                                future.completeExceptionally(new ServiceUnitNotReadyException(msg2));
                         }
-                    }
-                });
+                        })));
             } catch (Exception e) {
                 String msg = format(""failed to aquire ownership of split bundle for namespace [%s], %s"",
                         nsname.toString(), e.getMessage());",0
fix #1154,"             }
         } else {
              c.writeErrMessage(ErrorCode.ER_NO_DB_ERROR,""No database selected"");
+             return;
         }
 
         //分库的schema，直接从SchemaConfig中获取所有表名",0
Fix typo of exception message in Reflector,"           if (methodType.equals(getterType)) {
             throw new ReflectionException(""Illegal overloaded getter method with ambiguous type for property ""
                 + propName + "" in class "" + firstMethod.getDeclaringClass()
-                + "".  This breaks the JavaBeans "" + ""specification and can cause unpredicatble results."");
+                + "".  This breaks the JavaBeans "" + ""specification and can cause unpredictable results."");
           } else if (methodType.isAssignableFrom(getterType)) {
             // OK getter type is descendant
           } else if (getterType.isAssignableFrom(methodType)) {
@@ -138,7 +138,7 @@
           } else {
             throw new ReflectionException(""Illegal overloaded getter method with ambiguous type for property ""
                 + propName + "" in class "" + firstMethod.getDeclaringClass()
-                + "".  This breaks the JavaBeans "" + ""specification and can cause unpredicatble results."");
+                + "".  This breaks the JavaBeans "" + ""specification and can cause unpredictable results."");
           }
         }
         addGetMethod(propName, getter);",0
Directory Bug,"   static Uri saveHistory(String history) {
     File bsRoot = new File(Environment.getExternalStorageDirectory(), ""BarcodeScanner"");
     File historyRoot = new File(bsRoot, ""History"");
-    if (!historyRoot.exists() && !historyRoot.mkdirs()) {
+    if (!historyRoot.mkdirs() && !historyRoot.isDirectory()) {
       Log.w(TAG, ""Couldn't make dir "" + historyRoot);
       return null;
     }",0
Fix crash with default resolution set to best and limited mobile data resolution,"                 : context.getString(R.string.best_resolution_key);
 
         String maxResolution = getResolutionLimit(context);
-        if (maxResolution != null && compareVideoStreamResolution(maxResolution, resolution) < 1){
+        if (maxResolution != null && (resolution.equals(context.getString(R.string.best_resolution_key))
+                || compareVideoStreamResolution(maxResolution, resolution) < 1)) {
             resolution = maxResolution;
         }
         return resolution;",0
fix zk npe 优化zk写入," 		
 		RouteStrategyFactory.init();
 //        new Thread(tableStructureCheck()).start();
-
+		if(isUseZkSwitch()) {
 		//首次启动如果发现zk上dnindex为空，则将本地初始化上zk
 		try {
 			File file = new File(SystemConfig.getHomePath(), ""conf"" + File.separator + ""dnindex.properties"");
@@ -461,6 +461,7 @@
 			}
 		}
 	}
+	}
 
 
 	public void reloadDnIndex()
@@ -623,10 +624,12 @@
 						ByteArrayOutputStream out=new ByteArrayOutputStream();
 						Properties properties=new Properties();
 						properties.load(new ByteArrayInputStream(data));
+						 if(!String.valueOf(curIndex).equals(properties.getProperty(dataHost))) {
 						properties.setProperty(dataHost,String.valueOf(curIndex)) ;
 						properties.store(out,""update"");
 						zk.setData().forPath(path,out.toByteArray());
 					}
+					}
 
 				}finally {
 				 dnindexLock.release();",0
fix url build bug," 
 		for (Entry<String, String> e : request.getProperties().entrySet()) {
 			if (e.getValue() != null) {
-				sb.append('&');
-				sb.append(e.getKey()).append('=').append(e.getValue());
-			}
-		}
-		String parameters = """";
 		try {
-			parameters = URLEncoder.encode(sb.toString(), ""utf-8"");
-		} catch (UnsupportedEncodingException e) {
-			Cat.logError(e);
+	            sb.append('&');
+	            sb.append(e.getKey()).append('=').append(URLEncoder.encode(e.getValue(), ""utf-8"") );
+            } catch (Exception ex) {
+            	Cat.logError(ex);
+            }
+			}
 		}
 		String url = String.format(""http://%s:%s%s/%s/%s/%s?op=xml%s"", m_host, m_port, m_serviceUri, m_name,
-		      request.getDomain(), request.getPeriod(), parameters);
+		      request.getDomain(), request.getPeriod(), sb.toString());
 
 		return new URL(url);
 	}",0
Fixbug: Mycat sql timeout and hang problem.," import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.LinkedBlockingQueue;
-import java.util.concurrent.atomic.AtomicInteger;
+import java.util.concurrent.atomic.AtomicBoolean;
 
 import org.apache.log4j.Logger;
 import org.opencloudb.MycatServer;
@@ -53,6 +53,10 @@
  * 
  * @author wuzhih /modify by coder_czp/2015/11/2
  * 
+ * Fixbug: mycat sql timeout and hang problem.
+ * @author Uncle-pan
+ * @since 2016-03-23
+ * 
  */
 public class DataMergeService implements Runnable {
 
@@ -63,14 +67,18 @@
 
 	}
 
+	// A flag that represents whether the service running in a business thread,
+	// should not a volatile variable!!
+	// @author Uncle-pan
+	// @since 2016-03-23
+	private final AtomicBoolean running = new AtomicBoolean(false);
+	// props
 	private int fieldCount;
 	private RouteResultset rrs;
 	private RowDataSorter sorter;
 	private RowDataPacketGrouper grouper;
-	private volatile boolean hasOrderBy = false;
 	private MultiNodeQueryHandler multiQueryHandler;
 	public PackWraper END_FLAG_PACK = new PackWraper();
-	private AtomicInteger areadyAdd = new AtomicInteger();
 	private List<RowDataPacket> result = new Vector<RowDataPacket>();
 	private static Logger LOGGER = Logger.getLogger(DataMergeService.class);
 	private BlockingQueue<PackWraper> packs = new LinkedBlockingQueue<PackWraper>();
@@ -86,7 +94,7 @@
 	}
 
 	public void outputMergeResult(NonBlockingSession session, byte[] eof) {
-		packs.add(END_FLAG_PACK);
+		addPack(END_FLAG_PACK);
 	}
 
 	public void onRowMetaData(Map<String, ColMeta> columToIndx, int fieldCount) {
@@ -163,12 +171,8 @@
 			// sorter = new RowDataPacketSorter(orderCols);
 			RowDataSorter tmp = new RowDataSorter(orderCols);
 			tmp.setLimit(rrs.getLimitStart(), rrs.getLimitSize());
-			hasOrderBy = true;
 			sorter = tmp;
-		} else {
-			hasOrderBy = false;
 		}
-		MycatServer.getInstance().getBusinessExecutor().execute(this);
 	}
 
 	/**
@@ -182,26 +186,23 @@
 	 * @param conn
 	 */
 	public boolean onNewRecord(String dataNode, byte[] rowData) {
-		// 对于无需排序的SQL,取前getLimitSize条就足够
-        //可能有聚合函数等场景会误判，所有先注释
-//		if (!hasOrderBy && areadyAdd.get() >= rrs.getLimitSize()&& rrs.getLimitSize()!=-1) {
-//			return true;
-//		}
 		// 对于需要排序的数据,由于mysql传递过来的数据是有序的,
 		// 如果某个节点的当前数据已经不会进入,后续的数据也不会入堆
 		if (canDiscard.size() == rrs.getNodes().length) {
-			LOGGER.error(""now we output to client"");
-			packs.add(END_FLAG_PACK);
+			// ""END_FLAG"" only should be added by MultiNodeHandler.rowEofResponse()
+			// @author Uncle-pan
+			// @since 2016-03-23
+			//LOGGER.info(""now we output to client"");
+			//addPack(END_FLAG_PACK);
 			return true;
 		}
 		if (canDiscard.get(dataNode) != null) {
 			return true;
 		}
-		PackWraper data = new PackWraper();
+		final PackWraper data = new PackWraper();
 		data.node = dataNode;
 		data.data = rowData;
-		packs.add(data);
-		areadyAdd.getAndIncrement();
+		addPack(data);
 		return false;
 	}
 
@@ -226,31 +227,51 @@
 	 */
 	public void clear() {
 		result.clear();
-		hasOrderBy = false;
 		grouper = null;
 		sorter = null;
 	}
 
 	@Override
 	public void run() {
-
-		int warningCount = 0;
-		EOFPacket eofp = new EOFPacket();
-		ByteBuffer eof = ByteBuffer.allocate(9);
+		// sort-or-group: no need for us to using multi-threads, because
+		//both sorter and grouper are synchronized!!
+		// @author Uncle-pan
+		// @since 2016-03-23
+		if(!running.compareAndSet(false, true)){
+			return;
+		}
+		// eof handler has been placed to ""if (pack == END_FLAG_PACK){}"" in for-statement
+		// @author Uncle-pan
+		// @since 2016-03-23
+		boolean nulpack = false;
+		try{
+			// loop-on-packs
+			for (; ; ) {
+				final PackWraper pack = packs.poll();
+				// async: handling row pack queue, this business thread should exit when no pack
+				// @author Uncle-pan
+				// @since 2016-03-23
+				if(pack == null){
+					nulpack = true;
+					break;
+				}
+				// eof: handling eof pack and exit
+				if (pack == END_FLAG_PACK) {
+					final int warningCount = 0;
+					final EOFPacket eofp   = new EOFPacket();
+					final ByteBuffer eof   = ByteBuffer.allocate(9);
 		BufferUtil.writeUB3(eof, eofp.calcPacketSize());
 		eof.put(eofp.packetId);
 		eof.put(eofp.fieldCount);
 		BufferUtil.writeUB2(eof, warningCount);
 		BufferUtil.writeUB2(eof, eofp.status);
-		ServerConnection source = multiQueryHandler.getSession().getSource();
-
-		while (!Thread.interrupted()) {
-			try {
-				PackWraper pack = packs.take();
-				if (pack == END_FLAG_PACK) {
+					final ServerConnection source = multiQueryHandler.getSession().getSource();
+					final byte[] array = eof.array();
+					multiQueryHandler.outputMergeResult(source, array, getResults(array));
 					break;
 				}
-				RowDataPacket row = new RowDataPacket(fieldCount);
+				// merge: sort-or-group, or simple add
+				final RowDataPacket row = new RowDataPacket(fieldCount);
 				row.read(pack.data);
 				if (grouper != null) {
 					grouper.addRow(row);
@@ -261,12 +282,37 @@
 				} else {
 					result.add(row);
 				}
-			} catch (Exception e) {
-				LOGGER.error(""Merge multi data error"", e);
+			}// rof
+		}catch(final Exception e){
+			multiQueryHandler.handleDataProcessException(e);
+		}finally{
+			running.set(false);
+		}
+		// try to check packs, it's possible that adding a pack after polling a null pack
+		//and before this time pointer!!
+		// @author Uncle-pan
+		// @since 2016-03-23
+		if(nulpack && !packs.isEmpty()){
+			this.run();
 			}
 		}
-		byte[] array = eof.array();
-		multiQueryHandler.outputMergeResult(source, array, getResults(array));
+	
+	/**
+	 * Add a row pack, and may be wake up a business thread to work if not running.
+	 * @param pack row pack
+	 * @return true wake up a business thread, otherwise false
+	 * 
+	 * @author Uncle-pan
+	 * @since 2016-03-23
+	 */
+	private final boolean addPack(final PackWraper pack){
+		packs.add(pack);
+		if(running.get()){
+			return false;
+		}
+		final MycatServer server = MycatServer.getInstance();
+		server.getBusinessExecutor().execute(this);
+		return true;
 	}
 
 	/**",0
Fix InputTopic Submission for Creating Sink,"             if (functionConfig.getTimeoutMs() != null
                     && functionConfig.getProcessingGuarantees() != null
                     && functionConfig.getProcessingGuarantees() != FunctionConfig.ProcessingGuarantees.ATLEAST_ONCE) {
-                throw new IllegalArgumentException(""Message timeout can only be specifed with processing guarantee is ""
+                throw new IllegalArgumentException(""Message timeout can only be specified with processing guarantee is ""
                         + FunctionConfig.ProcessingGuarantees.ATLEAST_ONCE.name());
             }
         }
@@ -817,6 +817,9 @@
 
         private static Collection<String> collectAllInputTopics(SinkConfig sinkConfig) {
             List<String> retval = new LinkedList<>();
+            if (sinkConfig.getInputs() != null) {
+                retval.addAll(sinkConfig.getInputs());
+            }
             if (sinkConfig.getTopicToSerdeClassName() != null) {
                 retval.addAll(sinkConfig.getTopicToSerdeClassName().keySet());
             }",0
loottracker: Don't build the panel 1000 times when downloading loot," 	 */
 	void addRecords(Collection<LootTrackerRecord> recs)
 	{
-		for (LootTrackerRecord r : recs)
-		{
-			records.add(r);
-			LootTrackerBox box = buildBox(r);
-			if (box != null)
-			{
-				box.rebuild();
-			}
-		}
-		updateOverall();
+		records.addAll(recs);
+		rebuild();
 	}
 
 	/**",0
Fix IgniteCheckException on startup due to duplicate cache names," 
     @Override
     protected void buildAndRegisterProxyTicketDefinition(final TicketCatalog plan, final TicketDefinition metadata) {
-        metadata.getProperties().setStorageName(""serviceTicketsCache"");
+        metadata.getProperties().setStorageName(""proxyTicketsCache"");
         metadata.getProperties().setStorageTimeout(casProperties.getTicket().getPt().getTimeToKillInSeconds());
         super.buildAndRegisterServiceTicketDefinition(plan, metadata);
     }",0
make FixedTupleSpout implement IRichSpout so it can be used for tests," package backtype.storm.testing;
 
-import backtype.storm.spout.ISpout;
 import backtype.storm.spout.SpoutOutputCollector;
 import backtype.storm.task.TopologyContext;
+import backtype.storm.topology.IRichSpout;
+import backtype.storm.topology.OutputFieldsDeclarer;
+import backtype.storm.tuple.Fields;
 import backtype.storm.utils.Utils;
 import java.util.ArrayList;
 import java.util.HashMap;
@@ -11,7 +13,7 @@
 import java.util.UUID;
 import static backtype.storm.utils.Utils.get;
 
-public class FixedTupleSpout implements ISpout {
+public class FixedTupleSpout implements IRichSpout {
     private static final Map<String, Integer> acked = new HashMap<String, Integer>();
     private static final Map<String, Integer> failed = new HashMap<String, Integer>();
 
@@ -40,8 +42,13 @@
     private Map<String, FixedTuple> _pending;
 
     private String _id;
+    private String _fieldName;
     
     public FixedTupleSpout(List tuples) {
+        this(tuples, null);
+    }
+
+    public FixedTupleSpout(List tuples, String fieldName) {
         _id = UUID.randomUUID().toString();
         synchronized(acked) {
             acked.put(_id, 0);
@@ -59,6 +66,7 @@
             }
             _tuples.add(ft);
         }
+        _fieldName = fieldName;
     }
 
     public List<FixedTuple> getSourceTuples() {
@@ -139,4 +147,16 @@
     @Override
     public void deactivate() {
     }
+
+    @Override
+    public void declareOutputFields(OutputFieldsDeclarer declarer) { 
+        if (_fieldName != null) {
+            declarer.declare(new Fields(_fieldName));
+        }
+    }
+
+    @Override
+    public Map<String, Object> getComponentConfiguration() {
+        return null;
+    }
 }",0
Simplify the GrammarAST constructors," 	}
     public GrammarAST(int type) { super(new CommonToken(type, ANTLRParser.tokenNames[type])); }
     public GrammarAST(int type, Token t) {
-		this(new CommonToken(type, t.getText()));
-		token.setInputStream(t.getInputStream());
-		token.setLine(t.getLine());
-		token.setCharPositionInLine(t.getCharPositionInLine());
-		token.setTokenIndex(t.getTokenIndex());
+		this(new CommonToken(t));
+		token.setType(type);
 	}
     public GrammarAST(int type, Token t, String text) {
-		this(new CommonToken(type, text));
-		token.setInputStream(t.getInputStream());
-		token.setLine(t.getLine());
-		token.setCharPositionInLine(t.getCharPositionInLine());
-		token.setTokenIndex(t.getTokenIndex());
+		this(new CommonToken(t));
+		token.setType(type);
+		token.setText(text);
     }
 
 	public GrammarAST[] getChildrenAsArray() {",0
set useLaxCookieEncoder in DefaultAHCConfig.Builder constructor,"       realm = config.getRealm();
       maxRequestRetry = config.getMaxRequestRetry();
       disableUrlEncodingForBoundRequests = config.isDisableUrlEncodingForBoundRequests();
+      useLaxCookieEncoder = config.isUseLaxCookieEncoder();
       disableZeroCopy = config.isDisableZeroCopy();
       keepEncodingHeader = config.isKeepEncodingHeader();
       proxyServerSelector = config.getProxyServerSelector();",0
[TEST] fix for check style change,"    * MappingInput and one MappingOutput step in the Mapping.
    */
   public boolean processRow( StepMetaInterface smi, StepDataInterface sdi ) throws KettleException {
-    SimpleMappingData simpleMappingData = getData();
-    try {
       meta = (SimpleMappingMeta) smi;
       setData( (SimpleMappingData) sdi );
+    SimpleMappingData simpleMappingData = getData();
+    try {
       if ( first ) {
         first = false;
         simpleMappingData.wasStarted = true;",0
Send from our full jid (fixes #60)," 		MessagePacket packet = new MessagePacket();
 		if (message.getConversation().getMode() == Conversation.MODE_SINGLE) {
 			packet.setType(MessagePacket.TYPE_CHAT);
+			packet.setFrom(account.getFullJid());
 			if (otrSession != null) {
 				try {
 					packet.setBody(otrSession.transformSending(message
@@ -831,11 +832,9 @@
 				packet.addChild(""no-copy"", ""urn:xmpp:hints"");
 				packet.setTo(otrSession.getSessionID().getAccountID() + ""/""
 						+ otrSession.getSessionID().getUserID());
-				packet.setFrom(account.getFullJid());
 			} else {
 				packet.setBody(message.getBody());
 				packet.setTo(message.getCounterpart());
-				packet.setFrom(account.getJid());
 			}
 			packet.addChild(""markable"", ""urn:xmpp:chat-markers:0"");
 		} else if (message.getConversation().getMode() == Conversation.MODE_MULTI) {",0
Fix for confirm dialog appearing behind main UI window," 			@Override
 			public void mousePressed(MouseEvent mouseEvent)
 			{
-				int confirm = JOptionPane.showConfirmDialog(null,
-					""Are you sure you want to permanenely delete this screen marker?"",
+				int confirm = JOptionPane.showConfirmDialog(ScreenMarkerPanel.this,
+					""Are you sure you want to permanently delete this screen marker?"",
 					""Warning"", JOptionPane.OK_CANCEL_OPTION);
 
 				if (confirm == 0)",0
[#noissue] fix incorrect log," 
     public boolean removeClusterPoint(T clusterPoint) {
         if (logger.isInfoEnabled()) {
-            logger.info(""addClusterPoint(clusterPoint = [{}])"", clusterPoint);
+            logger.info(""removeClusterPoint(clusterPoint = [{}])"", clusterPoint);
         }
 
         boolean isRemove = clusterPointRepository.remove(clusterPoint);",0
FIXED NullPointerException on execution select next value for MYCATSEQ_XXXX," 					charset, sc, tableId2DataNodeCache);
 		}
 
-		if (sqlType == ServerParse.SELECT && rrs.isCacheAble()) {
+		if (rrs!=null && sqlType == ServerParse.SELECT && rrs.isCacheAble()) {
 			sqlRouteCache.putIfAbsent(cacheKey, rrs);
 		}
 		return rrs;",0
JENKINS-48322# Fix replaceIfNotAtTopLevel warning," public class BlueOceanUrlObjectImpl extends BlueOceanUrlObject {
 
     private volatile String mappedUrl;
-    private final ModelObject modelObject;
+    private transient final ModelObject modelObject;
 
     public BlueOceanUrlObjectImpl(ModelObject modelObject) {
         this.modelObject = modelObject;",0
Allow for large times stamps fixing #330,"                     if (secondsString.isEmpty() //if nothing was got,
                             && minutesString.isEmpty()//treat as unlabelled seconds
                             && hoursString.isEmpty()) {
-                        secondsString = Parser.matchGroup1(""t=(\\d{1,3})"", timeStamp);
+                        secondsString = Parser.matchGroup1(""t=(\\d+)"", timeStamp);
                     }
                 }
 ",0
Fix migrations: only the first line in the migration script is executed,"     }
 
     private void executeScript(SQLiteDatabase db, String file) {
-        StringBuilder text = new StringBuilder();
         try {
             InputStream is = this.context.getAssets().open(""sugar_upgrades/"" + file);
             BufferedReader reader = new BufferedReader(new InputStreamReader(is));
             String line;
             while ((line = reader.readLine()) != null) {
-                text.append(line);
-                text.append(""\n"");
+                Log.i(""Sugar script"", line);
+                db.execSQL(line.toString());
             }
         } catch (IOException e) {
             Log.e(""Sugar"", e.getMessage());
         }
 
-        Log.i(""Sugar"", ""script : "" + text.toString());
-        db.execSQL(text.toString());
+        Log.i(""Sugar"", ""script executed"");
     }
 }",0
Fix hanging when connecting to FatBeacon," import android.os.Build.VERSION;
 import android.os.Build.VERSION_CODES;
 import android.support.v4.content.FileProvider;
-import android.util.Log;
 import android.widget.Toast;
 
 import java.io.File;
@@ -87,8 +86,13 @@
     progress.setTitle(progressTitle);
     progress.setMessage(activity.getString(R.string.page_loading_message));
     progress.show();
+    activity.runOnUiThread(new Runnable() {
+      @Override
+      public void run() {
     mBluetoothGatt = BluetoothAdapter.getDefaultAdapter().getRemoteDevice(deviceAddress)
-        .connectGatt(activity, false, this);
+            .connectGatt(activity, false, BluetoothSite.this);
+      }
+    });
   }
 
   /**
@@ -135,7 +139,7 @@
 
   @Override
   public void onConnectionStateChange(BluetoothGatt gatt, int status, int newState) {
-    if (newState == BluetoothProfile.STATE_CONNECTED) {
+    if (newState == BluetoothProfile.STATE_CONNECTED && status == gatt.GATT_SUCCESS) {
       Log.i(TAG, ""Connected to GATT server"");
       mBluetoothGatt = gatt;
       html = new StringBuilder("""");
@@ -149,6 +153,9 @@
       Log.i(TAG, ""Disconnected to GATT server"");
       // ensure progress dialog is removed and running is set false
       close();
+    } else if (status != gatt.GATT_SUCCESS){
+      Log.i(TAG, ""Status is "" + status);
+      close();
     }
   }
 ",0
Fix spelling mistake in error message,"     //2. step: construct data codewords
     if (sourceCodeWords + errorCorrectionCodeWords + 1 > 929) { // +1 for symbol length CW
       throw new WriterException(
-          ""Encoded message contains to many code words, message to big ("" + msg.length() + "" bytes)"");
+          ""Encoded message contains too many code words, message too big ("" + msg.length() + "" bytes)"");
     }
     int n = sourceCodeWords + pad + 1;
     StringBuilder sb = new StringBuilder(n);",0
Kotlin compatibility fix," /** Encapsulates a general vector. Allows chaining operations by returning a reference to itself in all modification methods. See
  * {@link Vector2} and {@link Vector3} for specific implementations.
  * @author Xoppa */
-public interface Vector<T extends Vector> {
+public interface Vector<T extends Vector<T>> {
 	/** @return a copy of this vector */
 	T cpy ();
 ",0
fix test failures by adding timezone support to PlainTestMessageCodec," import java.util.List;
 import java.util.Map;
 import java.util.Stack;
+import java.util.TimeZone;
 import java.util.concurrent.ArrayBlockingQueue;
 import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.ConcurrentHashMap;
@@ -463,6 +464,7 @@
 
 			if (format == null) {
 				format = new SimpleDateFormat(""yyyy-MM-dd HH:mm:ss.SSS"");
+				format.setTimeZone(TimeZone.getTimeZone(""GMT+8""));
 			}
 
 			try {
@@ -481,7 +483,10 @@
 
 			if (baseline == null) {
 				try {
-					baseline = new SimpleDateFormat(""yyyy-MM-dd"").parse(date).getTime();
+					SimpleDateFormat format = new SimpleDateFormat(""yyyy-MM-dd"");
+					
+					format.setTimeZone(TimeZone.getTimeZone(""GMT+8""));
+					baseline = format.parse(date).getTime();
 					m_map.put(date, baseline);
 				} catch (ParseException e) {
 					return -1;",0
[DOCS]:[fix comment statement and reformat code],"  * Dynamic configuration template class. The concrete implementation needs to provide implementation for three methods.
  *
  * @see AbstractDynamicConfiguration#getTargetConfig(String, String, long)
- * @see AbstractDynamicConfiguration#addConfigurationListener(String key, TargetListener, ConfigurationListener)
+ * @see AbstractDynamicConfiguration#addConfigurationListener(String, TargetListener, ConfigurationListener)
  * @see AbstractDynamicConfiguration#createTargetListener(String)
  */
 public abstract class AbstractDynamicConfiguration<TargetListener> extends AbstractConfiguration
@@ -36,8 +36,7 @@
     protected URL url;
 
     // One key can register multiple target listeners, but one target listener only maps to one configuration listener
-    protected ConcurrentMap<String, TargetListener> targetListeners =
-            new ConcurrentHashMap<>();
+    protected ConcurrentMap<String, TargetListener> targetListeners = new ConcurrentHashMap<>();
 
     public AbstractDynamicConfiguration() {
     }
@@ -96,7 +95,8 @@
     /**
      * Register a native listener to the backend config storage so that Dubbo has chance to get notified when the
      * value changes.
-     * @param key
+     *
+     * @param key                   property key
      * @param targetListener Implementation dependent listener, such as, zookeeper watcher, Apollo listener, ...
      * @param configurationListener Listener in Dubbo that will handle notification.
      */",0
Fix get incorrectly handling null bytes,"         while (need > 0) {
             ByteBuffer b = mBuffers.peek();
             int read = Math.min(b.remaining(), need);
-            if (bytes != null)
+            if (bytes != null){
                 b.get(bytes, offset, read);
+            } else {
+                //when bytes is null, just skip data.
+                b.position(b.position() + read);
+            }
             need -= read;
             offset += read;
             if (b.remaining() == 0) {",0
Fix possible repeated SuppressWarning with @EView,"  */
 package org.androidannotations.holder;
 
-import com.sun.codemodel.*;
-import org.androidannotations.process.ProcessHolder;
+import static com.sun.codemodel.JExpr.invoke;
+import static com.sun.codemodel.JMod.PRIVATE;
+import static com.sun.codemodel.JMod.PUBLIC;
+import static com.sun.codemodel.JMod.STATIC;
+import static javax.lang.model.element.ElementKind.CONSTRUCTOR;
+
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collection;
+import java.util.List;
 
 import javax.lang.model.element.Element;
 import javax.lang.model.element.ExecutableElement;
 import javax.lang.model.element.TypeElement;
 import javax.lang.model.element.VariableElement;
-import java.util.ArrayList;
-import java.util.List;
 
-import static com.sun.codemodel.JExpr.invoke;
-import static com.sun.codemodel.JMod.*;
-import static javax.lang.model.element.ElementKind.CONSTRUCTOR;
+import org.androidannotations.process.ProcessHolder;
+
+import com.sun.codemodel.JAnnotationArrayMember;
+import com.sun.codemodel.JAnnotationUse;
+import com.sun.codemodel.JBlock;
+import com.sun.codemodel.JClass;
+import com.sun.codemodel.JExpr;
+import com.sun.codemodel.JFieldVar;
+import com.sun.codemodel.JInvocation;
+import com.sun.codemodel.JMethod;
+import com.sun.codemodel.JType;
+import com.sun.codemodel.JVar;
 
 public class EViewHolder extends EComponentWithViewSupportHolder {
 
@@ -56,8 +71,21 @@
 	}
 
 	private void addSuppressWarning() {
-		generatedClass.annotate(SuppressWarnings.class).param(""value"", ""unused"");
 		generatedClass.javadoc().append(SUPPRESS_WARNING_COMMENT);
+
+		Collection<JAnnotationUse> annotations = getGeneratedClass().annotations();
+		for (JAnnotationUse annotationUse : annotations) {
+			if (annotationUse.getAnnotationClass().fullName().equals(SuppressWarnings.class.getCanonicalName())) {
+				if (!Arrays.asList(getAnnotatedElement().getAnnotation(SuppressWarnings.class).value()).contains(""unused"")) {
+					JAnnotationArrayMember value = (JAnnotationArrayMember) annotationUse.getAnnotationMembers().get(""value"");
+					value.param(""unused"");
+				}
+
+				return;
+			}
+		}
+
+		generatedClass.annotate(SuppressWarnings.class).param(""value"", ""unused"");
 	}
 
 	private void createConstructorAndBuilder() {",0
修复explain insert 执行的bug," 
 import java.nio.ByteBuffer;
 import java.sql.SQLNonTransientException;
+import java.util.List;
+import java.util.regex.Pattern;
 
+import com.alibaba.druid.sql.ast.SQLExpr;
+import com.alibaba.druid.sql.ast.SQLStatement;
+import com.alibaba.druid.sql.dialect.mysql.ast.statement.MySqlInsertStatement;
+import com.alibaba.druid.sql.dialect.mysql.parser.MySqlStatementParser;
+import com.alibaba.druid.sql.parser.SQLStatementParser;
 import org.apache.log4j.Logger;
 import org.opencloudb.MycatServer;
 import org.opencloudb.config.ErrorCode;
 import org.opencloudb.config.Fields;
 import org.opencloudb.config.model.SchemaConfig;
+import org.opencloudb.config.model.SystemConfig;
+import org.opencloudb.config.model.TableConfig;
 import org.opencloudb.mysql.PacketUtil;
 import org.opencloudb.net.mysql.EOFPacket;
 import org.opencloudb.net.mysql.FieldPacket;
@@ -48,6 +57,7 @@
 public class ExplainHandler {
 
 	private static final Logger logger = Logger.getLogger(ExplainHandler.class);
+    private final static Pattern pattern = Pattern.compile(""(?:(\\s*next\\s+value\\s+for\\s*MYCATSEQ_(\\w+))(,|\\)|\\s)*)+"", Pattern.CASE_INSENSITIVE);
 	private static final RouteResultsetNode[] EMPTY_ARRAY = new RouteResultsetNode[0];
 	private static final int FIELD_COUNT = 2;
 	private static final FieldPacket[] fields = new FieldPacket[FIELD_COUNT];
@@ -124,8 +134,14 @@
 		}
 		try {
 			int sqlType = ServerParse.parse(stmt) & 0xff;
+            if(ServerParse.INSERT==sqlType&&isMycatSeq(stmt, schema))
+            {
+                c.writeErrMessage(ErrorCode.ER_PARSE_ERROR, ""insert sql using mycat seq,you must provide primaryKey value for explain"");
+                return null;
+            }
+            SystemConfig system = MycatServer.getInstance().getConfig().getSystem();
 			return MycatServer.getInstance().getRouterservice()
-					.route(MycatServer.getInstance().getConfig().getSystem(),schema, sqlType, stmt, c.getCharset(), c);
+					.route(system,schema, sqlType, stmt, c.getCharset(), c);
 		} catch (Exception e) {
 			StringBuilder s = new StringBuilder();
 			logger.warn(s.append(c).append(stmt).toString()+"" error:""+ e);
@@ -136,4 +152,33 @@
 		}
 	}
 
+    private static boolean isMycatSeq(String stmt, SchemaConfig schema)
+    {
+        if(pattern.matcher(stmt).find())  return true;
+        SQLStatementParser parser =new MySqlStatementParser(stmt);
+        MySqlInsertStatement statement = (MySqlInsertStatement) parser.parseStatement();
+        String tableName=   statement.getTableName().getSimpleName();
+        TableConfig tableConfig= schema.getTables().get(tableName.toUpperCase());
+        if(tableConfig==null) return false;
+        if(tableConfig.isAutoIncrement())
+        {
+            boolean isHasIdInSql=false;
+            String primaryKey = tableConfig.getPrimaryKey();
+            List<SQLExpr> columns = statement.getColumns();
+            for (SQLExpr column : columns)
+            {
+                String columnName = column.toString();
+                if(primaryKey.equalsIgnoreCase(columnName))
+                {
+                    isHasIdInSql = true;
+                    break;
+                }
+            }
+            if(!isHasIdInSql) return true;
+        }
+
+
+        return false;
+    }
+
 }
\ No newline at end of file",0
fix(TopTabOptions): fixed attribute naming for parser,"     public static TopTabsOptions parse(@Nullable JSONObject json) {
         TopTabsOptions result = new TopTabsOptions();
         if (json == null) return result;
-        result.selectedTabColor = ColorParser.parse(json, ""selectedColor"");
+        result.selectedTabColor = ColorParser.parse(json, ""selectedTabColor"");
         result.unselectedTabColor = ColorParser.parse(json, ""unselectedTabColor"");
         result.fontSize = NumberParser.parse(json, ""fontSize"");
         result.visible = BoolParser.parse(json, ""visible"");",0
delete realm file before test,"                 .directory(externalFilesDir)
                 .name(""external.realm"")
                 .build();
+        Realm.deleteRealm(config);
 
         // test if it works when the namedPipeDir is empty.
         Realm realmOnExternalStorage = Realm.getInstance(config);",0
KYLIN-3597 fix sonar problems," 
 public class CuboidStatsUtil {
 
+    private CuboidStatsUtil() {
+        throw new IllegalStateException(""Class CuboidStatsUtil is an utility class !"");
+    }
+
     /**
      * According to the cuboid hit frequencies and query uncertainty ratio
      * calculate each cuboid hit probability
@@ -57,8 +61,11 @@
             for (Long cuboid : selectionCuboidSet) {
                 //Calculate hit probability for each cuboid
                 if (hitFrequencyMap.get(cuboid) != null) {
+                    if (totalHitFrequency != 0)
                     cuboidHitProbabilityMap.put(cuboid, unitUncertainProb
                             + (1 - queryUncertaintyRatio) * hitFrequencyMap.get(cuboid) / totalHitFrequency);
+                    else
+                        throw new ArithmeticException(""/ by zero"");
                 } else {
                     cuboidHitProbabilityMap.put(cuboid, unitUncertainProb);
                 }
@@ -119,7 +126,10 @@
                 }
             }
 
+            if (nEffective != 0)
             srcCuboidsStats.put(cuboid, totalEstRowCount / nEffective);
+            else
+                throw new ArithmeticException(""/ by zero"");
         }
         srcCuboidsStats.remove(0L);
         adjustCuboidStats(srcCuboidsStats, statistics);",0
Fix for #2794," 	Ois ois = new Ois(hwnd);
 	OisController[] controllers;
 
+	private static final boolean IS_MAC = System.getProperty(""os.name"").toLowerCase().contains(""mac"");
+
 	public OisControllers (final DesktopControllerManager manager) {
 		this.manager = manager;
 		ArrayList<OisJoystick> joysticks = ois.getJoysticks();
@@ -217,7 +219,7 @@
 	/** Returns the window handle from LWJGL needed by OIS. */
 	static public long getWindowHandle () {
 		// don't need a window handle for Mac OS X
-		if (System.getProperty(""os.name"").toLowerCase().contains(""mac"")) {
+		if (IS_MAC) {
 			return 0;
 		}
 ",0
fixed issue 587: added headers to async request," package com.github.scribejava.core.model;
 
+import com.github.scribejava.core.exceptions.OAuthException;
+import com.github.scribejava.core.oauth.OAuthService;
 import com.ning.http.client.AsyncCompletionHandler;
 import com.ning.http.client.AsyncHttpClient;
 import com.ning.http.client.FluentCaseInsensitiveStringsMap;
 import com.ning.http.client.ProxyServer;
+
 import java.io.IOException;
+import java.util.Collection;
 import java.util.HashMap;
 import java.util.List;
+import java.util.ArrayList;
 import java.util.Map;
 import java.util.concurrent.Future;
-import com.github.scribejava.core.exceptions.OAuthException;
-import com.github.scribejava.core.oauth.OAuthService;
 
 public class OAuthRequestAsync extends AbstractRequest {
 
@@ -53,10 +56,16 @@
         final AsyncHttpClient.BoundRequestBuilder boundRequestBuilder;
         switch (getVerb()) {
             case GET:
-                boundRequestBuilder = service.getAsyncHttpClient().prepareGet(completeUrl);
+                boundRequestBuilder = service.getAsyncHttpClient()
+                        .prepareGet(completeUrl)
+                        .setHeaders(mapHeaders());
+
                 break;
             case POST:
-                boundRequestBuilder = service.getAsyncHttpClient().preparePost(completeUrl).setBody(getBodyContents());
+                boundRequestBuilder = service.getAsyncHttpClient().preparePost(completeUrl)
+                        .setBody(getBodyContents())
+                        .setHeaders(mapHeaders());
+
                 break;
             default:
                 throw new IllegalArgumentException(""message build error: unknown verb type"");
@@ -67,6 +76,26 @@
         return boundRequestBuilder.execute(new OAuthAsyncCompletionHandler<>(callback, converter));
     }
 
+    public Future<Response> sendAsync(OAuthAsyncRequestCallback<Response> callback) {
+        return sendAsync(callback, RESPONSE_CONVERTER, null);
+    }
+
+    public Future<Response> sendAsync(OAuthAsyncRequestCallback<Response> callback, ProxyServer proxyServer) {
+        return sendAsync(callback, RESPONSE_CONVERTER, proxyServer);
+    }
+
+    private Map<String, Collection<String>> mapHeaders() {
+        final Map<String, String> headers = getHeaders();
+        final Map<String, Collection<String>> mapped = new HashMap<>();
+
+        for(Map.Entry<String, String> entry: headers.entrySet()) {
+            final ArrayList<String> list = new ArrayList<>();
+            list.add(entry.getValue());
+            mapped.put(entry.getKey(), list);
+        }
+        return mapped;
+    }
+
     private static class OAuthAsyncCompletionHandler<T> extends AsyncCompletionHandler<T> {
 
         private final OAuthAsyncRequestCallback<T> callback;
@@ -94,14 +123,6 @@
         }
     };
 
-    public Future<Response> sendAsync(OAuthAsyncRequestCallback<Response> callback) {
-        return sendAsync(callback, RESPONSE_CONVERTER, null);
-    }
-
-    public Future<Response> sendAsync(OAuthAsyncRequestCallback<Response> callback, ProxyServer proxyServer) {
-        return sendAsync(callback, RESPONSE_CONVERTER, proxyServer);
-    }
-
     public interface ResponseConverter<T> {
 
         T convert(com.ning.http.client.Response response) throws IOException;",0
Fixed parsing CDATA on XML,"     private static int endDocTag = 0x00100101;
     private static int startTag = 0x00100102;
     private static int endTag = 0x00100103;
+    private static int cDataTag = 0x00100104;
     private final File archiveFile;
     private String xml;
     private List<ELEMENT> xmlCode;
@@ -291,6 +292,13 @@
                         + ""-"" + lineNo + "")"");
                 // tr.parent(); // Step back up the NobTree
 
+            } else if (tag0 == cDataTag) {
+                String name = compXmlString(xml, sitOff, stOff, nameNsSi);
+                // Commented while the code highlighter doesn't support showing
+                // CDATA sections properly. It shouldn' matter to AndroidManifest.xml
+                System.err.printf(""Found CDATA tag %s. Ignoring it"", name);
+//                finalXML.append(""<![CDATA["").append(name).append(""]]>"");
+                off += 7 * 4;
             } else if (tag0 == endDocTag) { // END OF XML DOC TAG
                 break;
 ",0
Fix proxy authentication in ApacheAsyncHttpProvider," 
             if (proxyServer.getPrincipal() != null) {
                 Credentials defaultcreds = new UsernamePasswordCredentials(proxyServer.getPrincipal(), proxyServer.getPassword());
-                client.getState().setCredentials(new AuthScope(null, -1, AuthScope.ANY_REALM), defaultcreds);
+                client.getState().setProxyCredentials(new AuthScope(null, -1, AuthScope.ANY_REALM), defaultcreds);
             }
 
             ProxyHost proxyHost = proxyServer == null ? null : new ProxyHost(proxyServer.getHost(), proxyServer.getPort());",0
Fix precision issue with Nd4j.EPS_THRESHOLD that matters for cuDNN,"     public static IComplexNumber UNIT;
     public static IComplexNumber ZERO;
     public static IComplexNumber NEG_UNIT;
-    public static double EPS_THRESHOLD = 1e-5f;
+    public static double EPS_THRESHOLD = 1e-5;
     //number of elements to print in begin and end
     public static int MAX_ELEMENTS_PER_SLICE = 3;
     public static int MAX_SLICES_TO_PRINT = 3;",0
[v2] [Android] Fix Android title centering bug," 
     private TitleBarButtonController leftButtonController;
     private View component;
+    private Alignment mAlignment;
+    private CharSequence mTitle;
 
     public TitleBar(Context context) {
         super(context);
@@ -40,6 +42,10 @@
     public void setTitle(CharSequence title) {
         clearComponent();
         super.setTitle(title);
+        if (mTitle != title && mAlignment != null) {
+            this.setTitleAlignment(mAlignment);
+        }
+        mTitle = title;
     }
 
     public String getTitle() {
@@ -72,8 +78,9 @@
     }
 
     public void setTitleAlignment(Alignment alignment) {
+        mAlignment = alignment;
         TextView title = findTitleTextView();
-        if (title == null) return;
+        if (title == null || title == mTitle) return;
         alignTextView(alignment, title);
     }
 
@@ -94,9 +101,12 @@
     }
 
     private void alignTextView(Alignment alignment, TextView view) {
+        int width = view.getResources().getDisplayMetrics().widthPixels;
         view.post(() -> {
             if (alignment == Alignment.Center) {
-                view.setX((getWidth() - view.getWidth()) / 2);
+                view.measure(0, 0);
+                //noinspection IntegerDivisionInFloatingPointContext
+                view.setX((width - view.getWidth()) / 2);
             } else if (leftButtonController != null) {
                 view.setX(getContentInsetStartWithNavigation());
             } else {",0
Fix NPE in asNio*() methods when wrappedBuffer == null,"             throw new IllegalStateException(""Index out of bounds "" + offset());
 
         if(wrappedBuffer == null) {
+            if(pointer != null) {
+                return pointer.asByteBuffer().asIntBuffer();
+            }
+
             if(offset() > 0)
                 return (IntBuffer) IntBuffer.wrap(intData).position((int)offset());
             else
@@ -1172,6 +1176,10 @@
             throw new IllegalStateException(""Index out of bounds "" + offset());
 
         if(wrappedBuffer == null) {
+            if(pointer != null) {
+                return pointer.asByteBuffer().asDoubleBuffer();
+            }
+
             if(offset() == 0) {
                 return DoubleBuffer.wrap(doubleData);
             }
@@ -1195,6 +1203,10 @@
             throw new IllegalStateException(""Index out of bounds "" + offset());
 
         if(wrappedBuffer == null) {
+            if(pointer != null) {
+                return pointer.asByteBuffer().asFloatBuffer();
+            }
+
             if(offset() == 0) {
                 return FloatBuffer.wrap(floatData);
             }
@@ -1214,6 +1226,9 @@
 
     @Override
     public ByteBuffer asNio() {
+        if(wrappedBuffer == null && pointer != null) {
+            return pointer.asByteBuffer();
+        }
         return wrappedBuffer;
     }
 ",0
fix TGC generation,"     }
 
     @Override
+    public void setCookieDomain(final String cookieDomain) {
+        super.setCookieDomain(StringUtils.defaultIfEmpty(cookieDomain, null));
+    }
+
+    @Override
     protected Cookie createCookie(final String cookieValue) {
         final Cookie c = super.createCookie(cookieValue);
         c.setComment(""CAS Cookie"");",0
Fix for BiomeDictionary.getTypesForBiome throwing a ClassCastException when called.,"     {
         if(typeInfoList[type.ordinal()] != null)
         {
-            return (BiomeGenBase[])typeInfoList[type.ordinal()].toArray();
+            return (BiomeGenBase[])typeInfoList[type.ordinal()].toArray(new BiomeGenBase[0]);
         }
 
         return new BiomeGenBase[0];
@@ -116,7 +116,7 @@
 
         if(biomeList[biome.biomeID] != null)
         {
-            return (Type[])biomeList[biome.biomeID].typeList.toArray();
+            return (Type[])biomeList[biome.biomeID].typeList.toArray(new Type[0]);
         }
 
         return new Type[0];",0
Fix NPE when invoking context menu in Alerts tab," package org.zaproxy.zap.extension.alert;
 
 import java.awt.CardLayout;
+import java.awt.Component;
 import java.awt.Dimension;
 import java.awt.Event;
 import java.awt.EventQueue;
 import java.awt.GridBagConstraints;
 import java.awt.GridBagLayout;
-import java.awt.Rectangle;
+import java.awt.Point;
 import java.awt.Toolkit;
 import java.awt.event.KeyEvent;
-import java.awt.event.KeyListener;
+import java.awt.event.MouseEvent;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.SortedSet;
@@ -38,6 +39,7 @@
 import javax.swing.ImageIcon;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
+import javax.swing.JPopupMenu;
 import javax.swing.JScrollPane;
 import javax.swing.JSplitPane;
 import javax.swing.JToggleButton;
@@ -410,27 +412,64 @@
 	 */    
 	JTree getTreeAlert() {
 		if (treeAlert == null) {
-			treeAlert = new JTree();
+			treeAlert = new JTree() {
+
+				private static final long serialVersionUID = 1L;
+
+				@Override
+				public Point getPopupLocation(final MouseEvent event) {
+					if (event != null) {
+						// Select item on right click
+						TreePath tp = treeAlert.getPathForLocation(event.getX(), event.getY());
+						if (tp != null) {
+							// Only select a new item if the current item is not
+							// already selected - this is to allow multiple items
+							// to be selected
+							if (!treeAlert.getSelectionModel().isPathSelected(tp)) {
+								treeAlert.getSelectionModel().setSelectionPath(tp);
+							}
+						}
+					}
+					return super.getPopupLocation(event);
+				}
+			};
 			treeAlert.setName(ALERT_TREE_PANEL_NAME);
 			treeAlert.setShowsRootHandles(true);
 			treeAlert.setBorder(javax.swing.BorderFactory.createEmptyBorder(0,0,0,0));
+			treeAlert.setComponentPopupMenu(new JPopupMenu() {
+
+				private static final long serialVersionUID = 1L;
+
+				@Override
+				public void show(Component invoker, int x, int y) {
+					final int countSelectedNodes = treeAlert.getSelectionCount();
+					final ArrayList<HistoryReference> uniqueHistoryReferences = new ArrayList<>(countSelectedNodes);
+					if (countSelectedNodes > 0) {
+						SortedSet<Integer> historyReferenceIdsAdded = new TreeSet<>();
+						for (TreePath path : treeAlert.getSelectionPaths()) {
+							final AlertNode node = (AlertNode) path.getLastPathComponent();
+							final Object userObject = node.getUserObject();
+							if (userObject instanceof Alert) {
+								HistoryReference historyReference = ((Alert) userObject).getHistoryRef();
+								if (historyReference != null && !historyReferenceIdsAdded
+										.contains(Integer.valueOf(historyReference.getHistoryId()))) {
+									historyReferenceIdsAdded.add(Integer.valueOf(historyReference.getHistoryId()));
+									uniqueHistoryReferences.add(historyReference);
+								}
+							}
+						}
+						uniqueHistoryReferences.trimToSize();
+					}
+					SelectableHistoryReferencesContainer messageContainer = new DefaultSelectableHistoryReferencesContainer(
+							treeAlert.getName(),
+							treeAlert,
+							Collections.<HistoryReference> emptyList(),
+							uniqueHistoryReferences);
+					view.getPopupMenu().show(messageContainer, x, y);
+				}
+			});
+
 			treeAlert.addMouseListener(new java.awt.event.MouseAdapter() { 
-				@Override
-				public void mousePressed(java.awt.event.MouseEvent e) {
-					showPopupMenuIfTriggered(e);
-				}
-					
-				@Override
-				public void mouseReleased(java.awt.event.MouseEvent e) {
-					showPopupMenuIfTriggered(e);
-				}
-				
-				private void showPopupMenuIfTriggered(java.awt.event.MouseEvent e) {
-					// right mouse button action
-				    if (e.isPopupTrigger()) {
-				    	showPopupMenu(e.getX(), e.getY());
-				    }	
-				}
 
 				@Override
 				public void mouseClicked(java.awt.event.MouseEvent e) {
@@ -472,78 +511,10 @@
 				    }
 				}
 			});
-			treeAlert.addKeyListener(new KeyListener(){
-
-				@Override
-				public void keyTyped(KeyEvent e) {
-				}
-
-				@Override
-				public void keyPressed(KeyEvent e) {
-					if (e.getKeyCode() == KeyEvent.VK_CONTEXT_MENU) {
-						Rectangle rec = treeAlert.getUI().getPathBounds(treeAlert, treeAlert.getSelectionPath());
-						showPopupMenu(rec.x, rec.y);
-					}
-				}
-
-				@Override
-				public void keyReleased(KeyEvent e) {
-				}});
 		}
 		return treeAlert;
 	}
 	
-	private void showPopupMenu (int x, int y) {
-		// Note that in theory it would be better to use setComponentPopupMenu
-		// but for some reason that didnt work - for the content menu key it selected the wrong node :/
-		
-		// Select site list item on right click
-    	TreePath tp = treeAlert.getPathForLocation(x, y);
-    	if ( tp != null ) {
-    		boolean select = true;
-    		// Only select a new item if the current item is not
-    		// already selected - this is to allow multiple items
-    		// to be selected
-	    	if (treeAlert.getSelectionPaths() != null) {
-	    		for (TreePath t : treeAlert.getSelectionPaths()) {
-	    			if (t.equals(tp)) {
-	    				select = false;
-	    				break;
-	    			}
-	    		}
-	    	}
-	    	if (select) {
-	    		treeAlert.getSelectionModel().setSelectionPath(tp);
-	    	}
-    	}
-        final int countSelectedNodes = treeAlert.getSelectionCount();
-        final ArrayList<HistoryReference> uniqueHistoryReferences = new ArrayList<>(countSelectedNodes);
-        if (countSelectedNodes > 0) {
-            SortedSet<Integer> historyReferenceIdsAdded = new TreeSet<>();
-            for (TreePath path : treeAlert.getSelectionPaths()) {
-                final AlertNode node = (AlertNode) path.getLastPathComponent();
-                final Object userObject = node.getUserObject();
-                if (userObject instanceof Alert) {
-                    HistoryReference historyReference = ((Alert) userObject).getHistoryRef();
-                    if (historyReference != null
-                            && !historyReferenceIdsAdded.contains(Integer.valueOf(historyReference.getHistoryId()))) {
-                        historyReferenceIdsAdded.add(Integer.valueOf(historyReference.getHistoryId()));
-                        uniqueHistoryReferences.add(historyReference);
-                    }
-                }
-            }
-            uniqueHistoryReferences.trimToSize();
-        }
-        SelectableHistoryReferencesContainer messageContainer = new DefaultSelectableHistoryReferencesContainer(
-                treeAlert.getName(),
-                treeAlert,
-                Collections.<HistoryReference> emptyList(),
-                uniqueHistoryReferences);
-        view.getPopupMenu().show(messageContainer, x, y);
-
-	}
-	
-	
 	/**
 	 * This method initializes paneScroll	
 	 * 	",0
fix compile error,"             if (mIsZooming)
                 return true;
 
-            if ((mCurrentFlingDirection == Direction.HORIZONTAL && !mHorizontalFlingEnabled)
-                    || (mCurrentFlingDirection == Direction.VERTICAL && !mVerticalFlingEnabled)) {
-                return false;
+            if ((mCurrentFlingDirection == Direction.LEFT && !mHorizontalFlingEnabled) ||
+                    (mCurrentFlingDirection == Direction.RIGHT && !mHorizontalFlingEnabled) ||
+                    (mCurrentFlingDirection == Direction.VERTICAL && !mVerticalFlingEnabled)) {
+                return true;
             }
 
             mScroller.forceFinished(true);",0
Correctly release message in MemcacheClientHandler that is used in th…,"     public void channelRead(ChannelHandlerContext ctx, Object msg) {
         FullBinaryMemcacheResponse res = (FullBinaryMemcacheResponse) msg;
         System.out.println(res.content().toString(CharsetUtil.UTF_8));
+        res.release();
     }
 
     @Override",0
Fix wrong precision value,"         String input = percentString.replace(""%"", """");
         input = cleanDoubleInput(input);
         double value = Double.parseDouble(input);
-        return MathUtils.roundDouble(value / 100d, 2);
+        return MathUtils.roundDouble(value / 100d, 4);
     }
 
     public long parsePriceStringToLong(String currencyCode, String amount, int precision) {",0
Fixed JavaDoc typo,"  * static access to all sub systems. It is your responsiblity to keep things thread safe. Don't use Graphics in a thread that is
  * not the rendering thread or things will go crazy. Really.
  * <p>
- * There's also references to {@link GLCommon, {@link GL20} and {@link GL30}. The same rules as above apply. Don't
+ * There's also references to {@link GLCommon}, {@link GL20} and {@link GL30}. The same rules as above apply. Don't
  * mess with this or things will break!
  * <p>
  * This is kind of messy but better than throwing around Graphics and similar instances. I'm aware of the design faux pas.",0
Fix: NPE on http-lookup redirection," import javax.ws.rs.core.UriBuilder;
 import javax.ws.rs.core.UriInfo;
 
+import org.apache.commons.lang3.StringUtils;
 import org.apache.pulsar.broker.PulsarService;
 import org.apache.pulsar.broker.ServiceConfiguration;
 import org.apache.pulsar.broker.admin.AdminResource;
@@ -264,7 +265,8 @@
 
     private URI getRedirectionUrl(ClusterData differentClusterData) throws MalformedURLException {
         URL webUrl = null;
-        if (pulsar.getConfiguration().isTlsEnabled() && !differentClusterData.getServiceUrlTls().isEmpty()) {
+        if (isRequestHttps() && pulsar.getConfiguration().isTlsEnabled()
+                && StringUtils.isNotBlank(differentClusterData.getServiceUrlTls())) {
             webUrl = new URL(differentClusterData.getServiceUrlTls());
         } else {
             webUrl = new URL(differentClusterData.getServiceUrl());",0
Simple typo fixed in Color Colour," 
 	/** Creates a {@link MaterialAttribute} that is a pure {@link Color}.
 	 * 
-	 * @param color The {@link Colour} that you wish the attribute to represent.
+	 * @param color The {@link Color} that you wish the attribute to represent.
 	 * @param name The name of the uniform in the {@link ShaderProgram} that will have its value set to this color. (A 'name' does
 	 *           not matter for a game that uses {@link GL10}). */
 	public ColorAttribute (Color color, String name) {",0
Fix ExecutionData.merge JavaDoc," 	 * A or B
 	 * </pre>
 	 * 
-	 * For <code>flag==true</code> this can be considered as a subtraction
+	 * For <code>flag==false</code> this can be considered as a subtraction
 	 * 
 	 * <pre>
 	 * A and not B",0
fix bug of DiskCacheStrategy.RESOURCE,"   public static final DiskCacheStrategy RESOURCE = new DiskCacheStrategy() {
     @Override
     public boolean isDataCacheable(DataSource dataSource) {
-      return true;
+      return false;
     }
 
     @Override",0
Fix HttpResolution to follow entire location header uri,"         if (redirectPort == -1) {
           redirectPort = 80;
         }
+        // Use raw values from location header
+        String uri = redirectURI.getRawPath();
+        String query = redirectURI.getRawQuery();
+        if (query != null) {
+          uri = uri + ""?"" + query; // Include query in URL
+        }
         createClient(redirectURI.getScheme(), redirectURI.getHost(), redirectPort);
-        makeRequest(redirectURI.getScheme(), redirectURI.getHost(), redirectPort, redirectURI.getPath());
+        makeRequest(redirectURI.getScheme(), redirectURI.getHost(), redirectPort, uri);
       } catch (URISyntaxException e) {
         log.error(""Invalid redirect URI: "" + location);
       }",0
Fix synchronized issue,"         return encode(value);
     }
 
-    private String decode(ByteBuffer bytes) {
-        synchronized (chars) {
+    private synchronized String decode(ByteBuffer bytes) {
             chars.clear();
             bytes.mark();
 
@@ -63,7 +62,6 @@
 
             return chars.flip().toString();
         }
-    }
 
     private byte[] encode(String string) {
         return string.getBytes(charset);",0
BroadleafCommerce/QA#3403 - Evict environment prefixed cache key,"  */
 package org.broadleafcommerce.common.config.service;
 
+import net.sf.ehcache.Cache;
+import net.sf.ehcache.CacheManager;
+import net.sf.ehcache.Element;
+
 import org.apache.commons.lang3.BooleanUtils;
 import org.apache.commons.lang3.StringUtils;
 import org.broadleafcommerce.common.classloader.release.ThreadLocalManager;
@@ -33,10 +37,6 @@
 
 import javax.annotation.Resource;
 
-import net.sf.ehcache.Cache;
-import net.sf.ehcache.CacheManager;
-import net.sf.ehcache.Element;
-
 /**
  * Service that retrieves property settings from the database.   If not set in 
  * the DB then returns the value from property files.
@@ -182,13 +182,26 @@
         return buildKey(propertyName, siteId);
     }
 
+    protected String buildKey(SystemProperty systemProperty, boolean forceEnvPrefix) {
+        String propertyName = systemProperty.getName();
+        Long siteId = null;
+        if (systemProperty instanceof SiteDiscriminator && ((SiteDiscriminator) systemProperty).getSiteDiscriminator() != null) {
+            siteId = ((SiteDiscriminator) systemProperty).getSiteDiscriminator();
+        }
+        return buildKey(propertyName, siteId, forceEnvPrefix);
+    }
+
     protected String buildKey(String propertyName, Long siteId) {
+        return buildKey(propertyName, siteId, false);
+    }
+
+    protected String buildKey(String propertyName, Long siteId, boolean forceEnvPrefix) {
         String key = propertyName;
         if (siteId != null) {
             key = siteId + ""-"" + key;
         }
 
-        if (BooleanUtils.isTrue(originatedFromEnvironment.get())) {
+        if (forceEnvPrefix || BooleanUtils.isTrue(originatedFromEnvironment.get())) {
             key = ENV_CACHE_PREFIX + ""-"" + key;
         }
 
@@ -214,6 +227,12 @@
         //including the site (if applicable) from the systemProperty itself
         String key = buildKey(systemProperty);
         getSystemPropertyCache().remove(key);
+
+        // The system property could have been called from the environment,
+        // so we need to evict that cache key as well
+        key = buildKey(systemProperty, true);
+        getSystemPropertyCache().remove(key);
+
         systemPropertiesDao.removeFromCache(systemProperty);
     }
 ",0
Fix Javadoc,"     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2188,7 +2188,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2221,7 +2221,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2232,7 +2232,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2265,7 +2265,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2276,7 +2276,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2309,7 +2309,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override
@@ -2320,7 +2320,7 @@
     /**
      * In place addition of a column vector
      *
-     * @param rowVector the column vector to add
+     * @param rowVector the row vector to add
      * @return the result of the addition
      */
     @Override",0
GWT: Fixed coordinates for touch and mouse events with CSS scaling," 	}-*/;
 
 	/** Kindly borrowed from PlayN. **/
-	protected static float getRelativeX (NativeEvent e, Element target) {
-		return e.getClientX() - target.getAbsoluteLeft() + target.getScrollLeft() + target.getOwnerDocument().getScrollLeft();
+	protected int getRelativeX (NativeEvent e, CanvasElement target) {
+		float xScaleRatio = target.getWidth() * 1f / target.getClientWidth(); // Correct for canvas CSS scaling
+		return Math.round(xScaleRatio
+			* (e.getClientX() - target.getAbsoluteLeft() + target.getScrollLeft() + target.getOwnerDocument().getScrollLeft()));
 	}
 
 	/** Kindly borrowed from PlayN. **/
-	protected static float getRelativeY (NativeEvent e, Element target) {
-		return e.getClientY() - target.getAbsoluteTop() + target.getScrollTop() + target.getOwnerDocument().getScrollTop();
+	protected int getRelativeY (NativeEvent e, CanvasElement target) {
+		float yScaleRatio = target.getHeight() * 1f / target.getClientHeight(); // Correct for canvas CSS scaling
+		return Math.round(yScaleRatio
+			* (e.getClientY() - target.getAbsoluteTop() + target.getScrollTop() + target.getOwnerDocument().getScrollTop()));
+	}
+
+	protected int getRelativeX (Touch touch, CanvasElement target) {
+		float xScaleRatio = target.getWidth() * 1f / target.getClientWidth(); // Correct for canvas CSS scaling
+		return Math.round(xScaleRatio * touch.getRelativeX(target));
+	}
+
+	protected int getRelativeY (Touch touch, CanvasElement target) {
+		float yScaleRatio = target.getHeight() * 1f / target.getClientHeight(); // Correct for canvas CSS scaling
+		return Math.round(yScaleRatio * touch.getRelativeY(target));
 	}
 
 	private void hookEvents () {
@@ -488,8 +502,8 @@
 	private void handleEvent (NativeEvent e) {
 		if (e.getType().equals(""mousedown"")) {
 			if (!e.getEventTarget().equals(canvas) || touched[0]) {
-				float mouseX = (int)getRelativeX(e, canvas);
-				float mouseY = (int)getRelativeY(e, canvas);
+				float mouseX = getRelativeX(e, canvas);
+				float mouseY = getRelativeY(e, canvas);
 				if (mouseX < 0 || mouseX > Gdx.graphics.getWidth() || mouseY < 0 || mouseY > Gdx.graphics.getHeight()) {
 					hasFocus = false;
 				}
@@ -505,8 +519,8 @@
 				this.touchX[0] += getMovementXJSNI(e);
 				this.touchY[0] += getMovementYJSNI(e);
 			} else {
-				this.touchX[0] = (int)getRelativeX(e, canvas);
-				this.touchY[0] = (int)getRelativeY(e, canvas);
+				this.touchX[0] = getRelativeX(e, canvas);
+				this.touchY[0] = getRelativeY(e, canvas);
 			}
 			this.currentEventTimeStamp = TimeUtils.nanoTime();
 			if (processor != null) processor.touchDown(touchX[0], touchY[0], 0, getButton(e.getButton()));
@@ -519,10 +533,10 @@
 				this.touchX[0] += getMovementXJSNI(e);
 				this.touchY[0] += getMovementYJSNI(e);
 			} else {
-				this.deltaX[0] = (int)getRelativeX(e, canvas) - touchX[0];
-				this.deltaY[0] = (int)getRelativeY(e, canvas) - touchY[0];
-				this.touchX[0] = (int)getRelativeX(e, canvas);
-				this.touchY[0] = (int)getRelativeY(e, canvas);
+				this.deltaX[0] = getRelativeX(e, canvas) - touchX[0];
+				this.deltaY[0] = getRelativeY(e, canvas) - touchY[0];
+				this.touchX[0] = getRelativeX(e, canvas);
+				this.touchY[0] = getRelativeY(e, canvas);
 			}
 			this.currentEventTimeStamp = TimeUtils.nanoTime();
 			if (processor != null) {
@@ -543,10 +557,10 @@
 				this.touchX[0] += getMovementXJSNI(e);
 				this.touchY[0] += getMovementYJSNI(e);
 			} else {
-				this.deltaX[0] = (int)getRelativeX(e, canvas) - touchX[0];
-				this.deltaY[0] = (int)getRelativeY(e, canvas) - touchY[0];
-				this.touchX[0] = (int)getRelativeX(e, canvas);
-				this.touchY[0] = (int)getRelativeY(e, canvas);
+				this.deltaX[0] = getRelativeX(e, canvas) - touchX[0];
+				this.deltaY[0] = getRelativeY(e, canvas) - touchY[0];
+				this.touchX[0] = getRelativeX(e, canvas);
+				this.touchY[0] = getRelativeY(e, canvas);
 			}
 			this.currentEventTimeStamp = TimeUtils.nanoTime();
 			this.touched[0] = false;
@@ -606,8 +620,8 @@
 				Touch touch = touches.get(i);
 				int touchId = touch.getIdentifier();
 				touched[touchId] = true;
-				touchX[touchId] = touch.getRelativeX(canvas);
-				touchY[touchId] = touch.getRelativeY(canvas);
+				touchX[touchId] = getRelativeX(touch, canvas);
+				touchY[touchId] = getRelativeY(touch, canvas);
 				deltaX[touchId] = 0;
 				deltaY[touchId] = 0;
 				if (processor != null) {
@@ -622,10 +636,10 @@
 			for (int i = 0, j = touches.length(); i < j; i++) {
 				Touch touch = touches.get(i);
 				int touchId = touch.getIdentifier();
-				deltaX[touchId] = touch.getRelativeX(canvas) - touchX[touchId];
-				deltaY[touchId] = touch.getRelativeY(canvas) - touchY[touchId];
-				touchX[touchId] = touch.getRelativeX(canvas);
-				touchY[touchId] = touch.getRelativeY(canvas);
+				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
+				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
+				touchX[touchId] = getRelativeX(touch, canvas);
+				touchY[touchId] = getRelativeY(touch, canvas);
 				if (processor != null) {
 					processor.touchDragged(touchX[touchId], touchY[touchId], touchId);
 				}
@@ -639,10 +653,10 @@
 				Touch touch = touches.get(i);
 				int touchId = touch.getIdentifier();
 				touched[touchId] = false;
-				deltaX[touchId] = touch.getRelativeX(canvas) - touchX[touchId];
-				deltaY[touchId] = touch.getRelativeY(canvas) - touchY[touchId];				
-				touchX[touchId] = touch.getRelativeX(canvas);
-				touchY[touchId] = touch.getRelativeY(canvas);
+				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
+				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
+				touchX[touchId] = getRelativeX(touch, canvas);
+				touchY[touchId] = getRelativeY(touch, canvas);
 				if (processor != null) {
 					processor.touchUp(touchX[touchId], touchY[touchId], touchId, Buttons.LEFT);
 				}					
@@ -656,10 +670,10 @@
 				Touch touch = touches.get(i);
 				int touchId = touch.getIdentifier();
 				touched[touchId] = false;
-				deltaX[touchId] = touch.getRelativeX(canvas) - touchX[touchId];
-				deltaY[touchId] = touch.getRelativeY(canvas) - touchY[touchId];				
-				touchX[touchId] = touch.getRelativeX(canvas);
-				touchY[touchId] = touch.getRelativeY(canvas);
+				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
+				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
+				touchX[touchId] = getRelativeX(touch, canvas);
+				touchY[touchId] = getRelativeY(touch, canvas);
 				if (processor != null) {
 					processor.touchUp(touchX[touchId], touchY[touchId], touchId, Buttons.LEFT);
 				}					",0
Fix handling of MemberLeftException in cluster state change tx commit,"         try {
             tx.commit();
         } catch (Throwable  e) {
-            if (e instanceof TargetNotMemberException || e instanceof MemberLeftException) {
+            if (e instanceof TargetNotMemberException || e.getCause() instanceof MemberLeftException) {
                 // Member left while tx is being committed after prepare successful.
                 // We cannot rollback tx after this point. Cluster state change is done
                 // on other members.",0
BugFix for UBJsonReader : prev field of JsonValue was not being set in arrays and object fields," 		while (din.available() > 0 && type != ']') {
 			final JsonValue val = parse(din, type);
 			if (prev != null) {
+				val.prev = prev;
 				prev.next = val;
 				result.size++;
 			} else {
@@ -155,6 +156,7 @@
 			final JsonValue child = parse(din, valueType == 0 ? din.readByte() : valueType);
 			child.setName(key);
 			if (prev != null) {
+				child.prev = prev;
 				prev.next = child;
 				result.size++;
 			} else {",0
Fix java 6/7 compile error in GuiConfig," import java.io.IOException;
 import java.util.ArrayList;
 import java.util.Arrays;
+import java.util.Collections;
 import java.util.Comparator;
 import java.util.List;
 
@@ -125,7 +126,7 @@
                 toReturn.add(ConfigElement.from(clazz));
             }
         }
-        toReturn.sort(new Comparator<IConfigElement>(){
+        Collections.sort(toReturn, new Comparator<IConfigElement>(){
 
             @Override
             public int compare(IConfigElement e1, IConfigElement e2)",0
Display the current chunk in the debug overlay.," import org.terasology.input.cameraTarget.CameraTargetSystem;
 import org.terasology.logic.characters.CharacterComponent;
 import org.terasology.logic.players.LocalPlayer;
+import org.terasology.math.TeraMath;
+import org.terasology.math.Vector3i;
 import org.terasology.monitoring.PerformanceMonitor;
 import org.terasology.registry.In;
 import org.terasology.rendering.nui.CoreScreenLayer;
@@ -106,7 +108,8 @@
                     Vector3f pos = localPlayer.getPosition();
                     CharacterComponent character = localPlayer.getCharacterEntity().getComponent(CharacterComponent.class);
                     float yaw = (character != null) ? character.yaw : 0;
-                    return String.format(Locale.US, ""Pos (%.2f, %.2f, %.2f), Yaw %.2f"", pos.x, pos.y, pos.z, yaw);
+                    Vector3i chunkPos = TeraMath.calcChunkPos((int)pos.x, (int)pos.y, (int)pos.z);
+                    return String.format(Locale.US, ""Pos (%.2f, %.2f, %.2f), Chunk (%d, %d, %d), Yaw %.2f"", pos.x, pos.y, pos.z,chunkPos.x, chunkPos.y, chunkPos.z, yaw);
                 }
             });
         }",0
Fix ratio animation,"  */
 package com.lyft.android.scissorssample;
 
+import android.animation.Animator;
+import android.animation.Animator.AnimatorListener;
 import android.animation.ObjectAnimator;
+import android.annotation.TargetApi;
 import android.app.Activity;
 import android.content.Intent;
 import android.content.pm.ActivityInfo;
 import android.net.Uri;
+import android.os.Build;
 import android.os.Bundle;
 import android.view.MotionEvent;
 import android.view.View;
 import android.widget.Toast;
+
+import com.lyft.android.scissors.CropView;
+import com.squareup.leakcanary.RefWatcher;
+
+import java.io.File;
+import java.util.List;
+
 import butterknife.Bind;
 import butterknife.ButterKnife;
 import butterknife.OnClick;
 import butterknife.OnTouch;
-import com.lyft.android.scissors.CropView;
-import com.squareup.leakcanary.RefWatcher;
-import java.io.File;
-import java.util.List;
 import rx.Observable;
 import rx.functions.Action1;
 import rx.subscriptions.CompositeSubscription;
@@ -55,12 +62,28 @@
     @Bind(R.id.pick_fab)
     View pickButton;
 
-    @Bind(R.id.ratio_fab)
-    View ratioButton;
-
     CompositeSubscription subscriptions = new CompositeSubscription();
 
     private int selectedRatio = 0;
+    private AnimatorListener animatorListener = new AnimatorListener() {
+        @Override
+        public void onAnimationStart(Animator animation) {
+            ButterKnife.apply(buttons, VISIBILITY, View.INVISIBLE);
+        }
+
+        @Override
+        public void onAnimationEnd(Animator animation) {
+            ButterKnife.apply(buttons, VISIBILITY, View.VISIBLE);
+        }
+
+        @Override
+        public void onAnimationCancel(Animator animation) {
+        }
+
+        @Override
+        public void onAnimationRepeat(Animator animation) {
+        }
+    };
 
     @Override
     protected void onCreate(Bundle savedInstanceState) {
@@ -126,7 +149,11 @@
             newRatio = cropView.getImageRatio();
         }
 
-        ObjectAnimator.ofFloat(cropView, ""aspectRatio"", oldRatio, newRatio).start();
+        ObjectAnimator viewportRatioAnimator = ObjectAnimator.ofFloat(cropView, ""viewportRatio"", oldRatio, newRatio)
+                .setDuration(420);
+        autoCancel(viewportRatioAnimator);
+        viewportRatioAnimator.addListener(animatorListener);
+        viewportRatioAnimator.start();
 
         Toast.makeText(this, ASPECT_LABELS[selectedRatio], Toast.LENGTH_SHORT).show();
     }
@@ -171,4 +198,11 @@
             view.setVisibility(visibility);
         }
     };
+
+    @TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR2)
+    static void autoCancel(ObjectAnimator objectAnimator) {
+        if (Build.VERSION.SDK_INT > Build.VERSION_CODES.JELLY_BEAN_MR2) {
+            objectAnimator.setAutoCancel(true);
+        }
+    }
 }",0
"KYLIN-3483, fix the loss of precision in HLLCSerializer.","         int registerIndexSize = current().getRegisterIndexSize();
         int m = 1 << precision;
         if (!current().isDense((int) averageNumOfElementsInCounter)
-                || averageNumOfElementsInCounter < (m - 5) / (1 + registerIndexSize)) {
+                || averageNumOfElementsInCounter < (m - 5d) / (1d + registerIndexSize)) {
             // 5 = 1 + 4 for scheme and size
             // size * (getRegisterIndexSize + 1)
             return 5 + averageNumOfElementsInCounter * (registerIndexSize + 1);",0
Use correct field prefix," 
 public class MaskTransformation implements Transformation<Bitmap> {
 
-  private static Paint mMaskingPaint = new Paint();
+  private static Paint sMaskingPaint = new Paint();
   private Context mContext;
   private BitmapPool mBitmapPool;
   private int mMaskId;
 
   static {
-    mMaskingPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_IN));
+    sMaskingPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_IN));
   }
 
   /**
@@ -73,7 +73,7 @@
     Canvas canvas = new Canvas(result);
     mask.setBounds(0, 0, width, height);
     mask.draw(canvas);
-    canvas.drawBitmap(source, 0, 0, mMaskingPaint);
+    canvas.drawBitmap(source, 0, 0, sMaskingPaint);
 
     return BitmapResource.obtain(result, mBitmapPool);
   }",0
Fix NPE in Base,"         return editor;
 
       } catch (EditorException ee) {
-        if (!ee.getMessage().equals("""")) {  // blank if the user canceled
+        if (ee.getMessage() != null) {  // null if the user canceled
           Messages.showWarning(""Error opening sketch"", ee.getMessage(), ee);
         }
       } catch (NoSuchMethodError nsme) {",0
"Fix x86 blas warning (warning previously always displayed, unless blas is forced)","     public final static String FORCE_NATIVE = ""org.nd4j.linalg.cpu.force_native"";
     static {
         String forceNative = System.getProperty(FORCE_NATIVE,""false"");
-        boolean hasSetNative = false;
         if(Boolean.parseBoolean(forceNative)) {
             try {
                 Field blasInstance = BLAS.class.getDeclaredField(""INSTANCE"");
                 BLAS newInstance = (BLAS) Class.forName(""com.github.fommil.netlib.NativeSystemBLAS"").newInstance();
                 setFinalStatic(blasInstance, newInstance);
-                hasSetNative = true;
             } catch(ClassNotFoundException e) {
                 log.warn(""Native BLAS not available on classpath"");
             } catch (Exception e) {
@@ -56,11 +54,18 @@
             }
         }
 
+        boolean usingNative = false;
+        try{
+            usingNative = BLAS.getInstance() instanceof com.github.fommil.netlib.NativeSystemBLAS;
+        }catch(Throwable t){
+            //May throw a NoClassDefFoundError
+        }
+
         //Check that native system blas is used:
-        if(!hasSetNative){
+        if(!usingNative){
             System.out.println(""****************************************************************"");
             System.out.println(""WARNING: COULD NOT LOAD NATIVE SYSTEM BLAS"");
-            System.out.println(""ND4J performance WILL be reduced"");
+            System.out.println(""ND4J computational performance WILL be reduced"");
             System.out.println(""Please install native BLAS library such as OpenBLAS or IntelMKL"");
             System.out.println(""See http://nd4j.org/getstarted.html#open for further details"");
             System.out.println(""****************************************************************"");",0
Add message ID," 	
 	public static ResultMessage parseFromSource(SearchHit hit) {
 		ResultMessage m = new ResultMessage();
+        Map<String, Object> message;
+
         // There is no _source field if addFields is used for the request. Just use the returned fields in that case.
         if (hit.getSource() != null) {
-            m.setMessage(hit.getSource());
+            message = hit.getSource();
         } else {
-            Map<String, Object> map = Maps.newHashMap();
-
+            message = Maps.newHashMap();
             for (Map.Entry<String, SearchHitField> o : hit.fields().entrySet()) {
-                map.put(o.getKey(), o.getValue().getValue());
+                message.put(o.getKey(), o.getValue().getValue());
             }
-            m.setMessage(map);
-
         }
+        m.setMessage(hit.getId(), message);
 		m.setIndex(hit.getIndex());
         m.setHighlightRanges(hit.getHighlightFields());
 		return m;
@@ -67,13 +67,15 @@
 	
 	public static ResultMessage parseFromSource(GetResponse r) {
 		ResultMessage m = new ResultMessage();
-		m.setMessage(r.getSource());
+        m.setMessage(r.getId(), r.getSource());
 		m.setIndex(r.getIndex());
         return m;
 	}
 	
-	public void setMessage(Map<String, Object> message) {
+    public void setMessage(String id, Map<String, Object> message) {
         this.message = message;
+        this.message.put(""_id"", id);
+
         if (this.message.containsKey(""timestamp"")) {
             final Object tsField = this.message.get(""timestamp"");
             try {",0
Fix typo in RU error message," 
     void checkCompatibility(boolean maxIdleExists) {
         if (maxIdleExists && nodeEngine.getClusterService().getClusterVersion().isLessThan(Versions.V3_11)) {
-            throw new UnsupportedOperationException(""Settig MaxIdle is available when cluster version is 3.11 or higher"");
+            throw new UnsupportedOperationException(""Setting MaxIdle is available when cluster version is 3.11 or higher"");
         }
     }
 ",0
Fix NPE,"     public void onDataAvailable() {
         Util.emitAllData(this, pending);
 
-        if (mEnded && !pending.hasRemaining())
+        if (mEnded && !pending.hasRemaining() && mEndCallback != null)
             mEndCallback.onCompleted(mEndException);
     }
 ",0
Fix ground item swapped price values," 			final int price = itemPrice == null ? itemComposition.getPrice() : itemPrice.getPrice();
 			final int haPrice = Math.round(itemComposition.getPrice() * HIGH_ALCHEMY_CONSTANT) * quantity;
 			final int gePrice = quantity * price;
-			final Color hidden = getHidden(itemComposition.getName(), haPrice, gePrice, itemComposition.isTradeable());
-			final Color highlighted = getHighlighted(itemComposition.getName(), haPrice, gePrice);
+			final Color hidden = getHidden(itemComposition.getName(), gePrice, haPrice, itemComposition.isTradeable());
+			final Color highlighted = getHighlighted(itemComposition.getName(), gePrice, haPrice);
 			final Color color = getItemColor(highlighted, hidden);
 
 			if (color != null && hidden == null && !color.equals(config.defaultColor()))",0
Fix #4774 - Manually revert PR #4491,"                     vector[i] = readFloat(stream);
                 }
 
-                stream.readByte();
-
                 return Pair.makePair(element, vector);
             } catch (Exception e) {
                 throw new RuntimeException(e);",0
fix the skipping of the install-node-and-yarn execution in pom,"     /**
      * Skips execution of this mojo.
      */
-    @Parameter(property = ""skip.installyarn"", defaultValue = ""false"")
+    @Parameter(property = ""skip.installyarn"", alias = ""skip.installyarn"", defaultValue = ""false"")
     private Boolean skip;
 
     @Component(role = SettingsDecrypter.class)",0
Fixer format guesser to return format for N3/Turtle files,"                         return ""text/json"";
                     } else if (openAngleBrackets >= 5 && closeAngleBrackets >= 5) {
                         if (trailingPeriods > 0) {
-                            return ""text/rdf+n3"";
+                            return ""text/rdf/n3"";
                         } else if (firstChar == '<') {
                             return ""text/xml"";
                         }",0
fix some bugs in android 7.0,"     private static CopyOnWriteArrayList<RobustExtension> registerExtensionList=new CopyOnWriteArrayList<>();
     private static ThreadLocal<RobustExtension> robustExtensionThreadLocal =new ThreadLocal<>();
 
-
     public static boolean isSupport(Object[] paramsArray, Object current, ChangeQuickRedirect changeQuickRedirect, boolean isStatic, String methodNumber,Class[] paramsClassTypes,Class returnType) {
         //Robust补丁优先执行，其他功能靠后
         if (changeQuickRedirect == null) {
@@ -28,6 +27,10 @@
             }
             return false;
         }
+        //special check for android 7.0+
+        if(!(changeQuickRedirect instanceof ChangeQuickRedirect)){
+            return false;
+        }
         String classMethod = getClassMethod(isStatic, methodNumber);
         if (TextUtils.isEmpty(classMethod)) {
             return false;
@@ -52,6 +55,10 @@
             }
             return null;
         }
+        //special check for android 7.0+
+        if(!(changeQuickRedirect instanceof ChangeQuickRedirect)){
+            return null;
+        }
         String classMethod = getClassMethod(isStatic, methodNumber);
         if (TextUtils.isEmpty(classMethod)) {
             return null;
@@ -71,6 +78,10 @@
             }
             return;
         }
+        //special check for android 7.0+
+        if(!(changeQuickRedirect instanceof ChangeQuickRedirect)){
+            return ;
+        }
         notify(Constants.PATCH_EXECUTE);
         String classMethod = getClassMethod(isStatic, methodNumber);
         if (TextUtils.isEmpty(classMethod)) {
@@ -106,11 +117,11 @@
         String classMethod = """";
         try {
             //可能过于耗时，这部分需要请自己调用函数
-//            java.lang.StackTraceElement stackTraceElement = (new java.lang.Throwable()).getStackTrace()[2];
-//            String methodName = stackTraceElement.getMethodName();
-//            String className = stackTraceElement.getClassName();
-            String methodName="""";
-            String className="""";
+            java.lang.StackTraceElement stackTraceElement = (new java.lang.Throwable()).getStackTrace()[2];
+            String methodName = stackTraceElement.getMethodName();
+            String className = stackTraceElement.getClassName();
+//            String methodName="""";
+//            String className="""";
             classMethod = className + "":"" + methodName + "":"" + isStatic + "":"" + methodNumber;
         }catch (Exception e){
 ",0
 Issue 3553 solved. Can't go back after enabling Animated Menus option,"             event.consume();
         }
         if (networkSystem.getMode() == NetworkMode.NONE) {
-            if (nuiManager.isOpen(""engine:pauseMenu"")) {
+            if (!nuiManager.isOpen(""engine:pauseMenu"")) {
                 time.setPaused(true);
             } else {
                 time.setPaused(false);",0
fix NPE caused by null mime type,"     }
 
     public boolean isImage() {
+        if (mimeType == null) return false;
         return mimeType.equals(MimeType.JPEG.toString())
                 || mimeType.equals(MimeType.PNG.toString())
                 || mimeType.equals(MimeType.GIF.toString())
@@ -110,10 +111,12 @@
     }
 
     public boolean isGif() {
+        if (mimeType == null) return false;
         return mimeType.equals(MimeType.GIF.toString());
     }
 
     public boolean isVideo() {
+        if (mimeType == null) return false;
         return mimeType.equals(MimeType.MPEG.toString())
                 || mimeType.equals(MimeType.MP4.toString())
                 || mimeType.equals(MimeType.QUICKTIME.toString())
@@ -145,7 +148,9 @@
     public int hashCode() {
         int result = 1;
         result = 31 * result + Long.valueOf(id).hashCode();
+        if (mimeType != null) {
         result = 31 * result + mimeType.hashCode();
+        }
         result = 31 * result + uri.hashCode();
         result = 31 * result + Long.valueOf(size).hashCode();
         result = 31 * result + Long.valueOf(duration).hashCode();",0
Fix for skipping Runnables in RunnableHandler," 		final ArrayList<Runnable> runnables = this.mRunnables;
 		final int runnableCount = runnables.size();
 		for(int i = runnableCount - 1; i >= 0; i--) {
-			runnables.get(i).run();
+			runnables.remove(i).run();
 		}
-		runnables.clear();
 	}
 
 	@Override",0
Fix: Add ACTION_DELETE to uninstall action filter,"             if (handleInstallRequest(intent)) {
                 return 0;
             }
-        } else if (Intent.ACTION_UNINSTALL_PACKAGE.equals(intent.getAction())
+        } else if ((Intent.ACTION_UNINSTALL_PACKAGE.equals(intent.getAction())
+                || Intent.ACTION_DELETE.equals(intent.getAction()))
                 && ""package"".equals(intent.getScheme())) {
 
             if (handleUninstallRequest(intent)) {",0
fix unstack," import org.tensorflow.framework.GraphDef;
 import org.tensorflow.framework.NodeDef;
 
-import java.util.HashMap;
-import java.util.LinkedHashMap;
-import java.util.Map;
+import java.util.*;
 
 /**
  * Unstack op conversion
@@ -94,4 +92,24 @@
     public void initFromOnnx(OnnxProto3.NodeProto node, SameDiff initWith, Map<String, OnnxProto3.AttributeProto> attributesForNode, OnnxProto3.GraphProto graph) {
         throw new UnsupportedOperationException(""No analog found for onnx for "" + opName());
     }
+
+    /*
+    This is required because number of outputs depends on the input shape.
+     */
+    @Override
+    public List<int[]> calculateOutputShape() {
+        List<int[]> ret = new ArrayList<int[]>();
+        int[] inputShape = arg().getShape();
+        int[] outputShape = new int[inputShape.length - 1];
+        for (int i = 0; i < axis; i++) {
+            outputShape[i] = inputShape[i];
+        }
+        for (int i = axis + 1; i < inputShape.length; i++) {
+            outputShape[i - 1] = inputShape[i];
+        }
+        for (int i = 0; i < inputShape[axis]; i++) {
+            ret.add(outputShape);
+        }
+        return ret;
+    }
 }",0
Fix writePositionTo in RunLengthEncodedBlock,"     @Override
     public void writePositionTo(int position, BlockBuilder blockBuilder)
     {
-        value.writePositionTo(position, blockBuilder);
+        value.writePositionTo(0, blockBuilder);
     }
 
     @Override",0
Opt out of failing TP tests that are fixed in TP HEAD,"         test = ""org.apache.tinkerpop.gremlin.structure.VertexPropertyTest$VertexPropertyAddition"",
         method = ""shouldHandleSetVertexProperties"",
         reason = ""Titan can only handle SET cardinality for properties when defined in the schema"")
+@Graph.OptOut(
+        test = ""org.apache.tinkerpop.gremlin.groovy.jsr223.GremlinGroovyScriptEngineOverGraphTest"",
+        method = ""shouldProcessUTF8Query"",
+        reason = ""https://issues.apache.org/jira/browse/TINKERPOP3-629 (FIXED on HEAD)"")
+@Graph.OptOut(
+        test = ""org.apache.tinkerpop.gremlin.groovy.jsr223.GremlinGroovyScriptEngineOverGraphTest"",
+        method = ""shouldEvalGlobalClosuresEvenAfterEvictionOfClass"",
+        reason = ""https://issues.apache.org/jira/browse/TINKERPOP3-630 (FIXED on HEAD)"")
 //------------------------
 //@Graph.OptOut(
 //        test=""com.tinkerpop.gremlin.process.graph.step.branch.UnionTest$ComputerTest"",",0
Fix bug in polygon intersections," 					if (ua >= 0 && ua <= 1) {
 						 return true;
 					}
+			  }
 					x3 = x4;
 					y3 = y4;
 			  }
-		 }
 		 return false;
 	}
 
@@ -726,10 +726,10 @@
 								return true;
 						  }
 					 }
+				}
 					 x3 = x4;
 					 y3 = y4;
 				}
-		  }
 		  return false;
 	 }
 ",0
Fix options not getting properly applied to extracted lexer in combined ...," 				if ( Grammar.lexerOptions.contains(optionName) &&
 					 !Grammar.doNotCopyOptionsToLexer.contains(optionName) )
 				{
-					lexerOptionsRoot.addChild((Tree)adaptor.dupTree(o));
+					GrammarAST optionTree = (GrammarAST)adaptor.dupTree(o);
+					lexerOptionsRoot.addChild(optionTree);
+					lexerAST.setOption(optionName, (GrammarAST)optionTree.getChild(1));
 				}
 			}
 		}",0
CHE-1893; fix authorization flow during clone from private repo,"  *******************************************************************************/
 package org.eclipse.che.git.impl.jgit;
 
+import com.google.common.collect.ImmutableMap;
 import com.google.common.io.Files;
 import com.jcraft.jsch.JSch;
 import com.jcraft.jsch.JSchException;
@@ -51,6 +52,7 @@
 import org.eclipse.che.api.git.shared.MergeRequest;
 import org.eclipse.che.api.git.shared.MergeResult;
 import org.eclipse.che.api.git.shared.MoveRequest;
+import org.eclipse.che.api.git.shared.ProviderInfo;
 import org.eclipse.che.api.git.shared.PullRequest;
 import org.eclipse.che.api.git.shared.PullResponse;
 import org.eclipse.che.api.git.shared.PushRequest;
@@ -170,6 +172,8 @@
 import static java.nio.file.attribute.PosixFilePermission.OWNER_WRITE;
 import static java.util.concurrent.TimeUnit.MILLISECONDS;
 import static java.util.concurrent.TimeUnit.SECONDS;
+import static org.eclipse.che.api.git.shared.ProviderInfo.AUTHENTICATE_URL;
+import static org.eclipse.che.api.git.shared.ProviderInfo.PROVIDER_NAME;
 import static org.eclipse.che.dto.server.DtoFactory.newDto;
 
 /**
@@ -1564,12 +1568,12 @@
      */
     private Object executeRemoteCommand(String remoteUrl, TransportCommand command)
             throws GitException, GitAPIException, UnauthorizedException {
-        String sshKeyDirectoryPath = """";
+        File keyDirectory = null;
+        UserCredential credentials = null;
         try {
             if (GitUrlUtils.isSSH(remoteUrl)) {
-                File keyDirectory = Files.createTempDir();
-                sshKeyDirectoryPath = keyDirectory.getPath();
-                File sshKey = writePrivateKeyFile(remoteUrl, keyDirectory);
+                keyDirectory =  Files.createTempDir();
+                final File sshKey = writePrivateKeyFile(remoteUrl, keyDirectory);
 
                 SshSessionFactory sshSessionFactory = new JschConfigSessionFactory() {
                     @Override
@@ -1593,7 +1597,7 @@
                     }
                 });
             } else {
-                UserCredential credentials = credentialsLoader.getUserCredential(remoteUrl);
+                credentials = credentialsLoader.getUserCredential(remoteUrl);
                 if (credentials != null) {
                     command.setCredentialsProvider(new UsernamePasswordCredentialsProvider(credentials.getUserName(),
                                                                                            credentials.getPassword()));
@@ -1604,16 +1608,25 @@
 
             return command.call();
         } catch (GitException | TransportException exception) {
-            if (""Unable get private ssh key"".equals(exception.getMessage())
-                || exception.getMessage().contains(ERROR_AUTHENTICATION_REQUIRED)) {
-                throw new UnauthorizedException(exception.getMessage());
+            if (""Unable get private ssh key"".equals(exception.getMessage())) {
+                throw new UnauthorizedException(exception.getMessage(), ErrorCodes.UNABLE_GET_PRIVATE_SSH_KEY);
+            } else if (exception.getMessage().contains(ERROR_AUTHENTICATION_REQUIRED)) {
+                final ProviderInfo info = credentialsLoader.getProviderInfo(remoteUrl);
+                if (info != null) {
+                    throw new UnauthorizedException(exception.getMessage(),
+                                                    ErrorCodes.UNAUTHORIZED_GIT_OPERATION,
+                                                    ImmutableMap.of(PROVIDER_NAME, info.getProviderName(),
+                                                                    AUTHENTICATE_URL, info.getAuthenticateUrl(),
+                                                                    ""authenticated"", Boolean.toString(credentials != null)));
+                }
+                throw new UnauthorizedException(exception.getMessage(), ErrorCodes.UNAUTHORIZED_GIT_OPERATION);
             } else {
                 throw exception;
             }
         } finally {
-            if (!sshKeyDirectoryPath.isEmpty()) {
+            if (keyDirectory != null && keyDirectory.exists()) {
                 try {
-                    FileUtils.delete(new File(sshKeyDirectoryPath), FileUtils.RECURSIVE);
+                    FileUtils.delete(keyDirectory, FileUtils.RECURSIVE);
                 } catch (IOException exception) {
                     throw new GitException(""Can't remove SSH key directory"", exception);
                 }",0
Page field translations via admin ui persist with wrong entity type," /**
  * Handles admin operations for the {@link Page} entity. This entity has fields that are 
  * dependent on the value of the {@link Page#getPageTemplate()} field, and as such,
- * it deviates from the typical {@link AdminAbstractEntityController}.
+ * it deviates from the typical {@link AdminBasicEntityController}.
  * 
  * @author Andre Azzolini (apazzolini)
  */
@@ -93,6 +93,10 @@
         } else {
             dynamicForm = getEntityForm(info, null);
         }
+        if (dynamicForm.getCeilingEntityClassname().equals(PageTemplate.class.getName())) {
+            dynamicForm.setTranslationCeilingEntity(Page.class.getName());
+            dynamicForm.setTranslationId(id);
+        }
         ef.putDynamicFormInfo(""pageTemplate"", info);
         ef.putDynamicForm(""pageTemplate"", dynamicForm);
 ",0
Error in ClientHearbeatMonitor connection.close message,"         }
 
         final Connection connection = clientEndpoint.getConnection();
-        final long lastTimePackageReceived = connection.lastReadTimeMillis();
+        final long lastTimePacketReceived = connection.lastReadTimeMillis();
         final long timeoutInMillis = SECONDS.toMillis(heartbeatTimeoutSeconds);
         final long currentTimeMillis = Clock.currentTimeMillis();
-        if (lastTimePackageReceived + timeoutInMillis < currentTimeMillis) {
+        if (lastTimePacketReceived + timeoutInMillis < currentTimeMillis) {
             if (memberUuid.equals(clientEndpoint.getPrincipal().getOwnerUuid())) {
                 String message = ""Client heartbeat is timed out, closing connection to "" + connection
-                        + "". Now: "" + timeToString(lastTimePackageReceived)
-                        + "". LastTimePacketReceived: "" + timeToString(lastTimePackageReceived);
+                        + "". Now: "" + timeToString(currentTimeMillis)
+                        + "". LastTimePacketReceived: "" + timeToString(lastTimePacketReceived);
                 logger.log(Level.WARNING, message);
                 connection.close(message, null);
             }",0
bugfix: 修复在多层ViewGroup嵌套场景下，无法获取到子 View 的情况,"         if (UETool.getInstance().getFilterClasses().contains(view.getClass().getName())) return;
         if (view.getAlpha() == 0 || view.getVisibility() != View.VISIBLE) return;
         if (getResources().getString(R.string.uet_disable).equals(view.getTag())) return;
-        elements.add(new Element(view));
         if (view instanceof ViewGroup) {
+            elements.add(0, new Element(view));
             ViewGroup parent = (ViewGroup) view;
             for (int i = 0; i < parent.getChildCount(); i++) {
                 traverse(parent.getChildAt(i));
             }
+        } else {
+            elements.add(new Element(view));
         }
     }
 
@@ -181,7 +183,7 @@
                 } else if (parentElement != null) {
                     parentElement = parentElement.getParentElement();
                 }
-                target = parentElement;
+                target = parentElement == null ? element : parentElement;
                 break;
             }
         }",0
 fix provicer --> provider,"     protected String cluster;
 
     /**
-     * The {@link Filter} when the provicer side exposed a service or the customer side references a remote service used,
+     * The {@link Filter} when the provider side exposed a service or the customer side references a remote service used,
      * if there are more than one, you can use commas to separate them
      */
     protected String filter;",0
Fix casting android application to base interface," 		}
 
 		if (ldestroy) {
-			Array<LifecycleListener> listeners = ((AndroidApplication)app).lifecycleListeners;
+			Array<LifecycleListener> listeners = ((AndroidApplicationBase)app).getLifecycleListeners();
 			synchronized (listeners) {
 				for (LifecycleListener listener : listeners) {
 					listener.dispose();
 				}
 			}
-			app.getApplicationListener().dispose();
-			((AndroidApplication)app).audio.dispose();
-			((AndroidApplication)app).audio = null;
+			((AndroidApplicationBase)app).getApplicationListener().dispose();
+			((AndroidAudio)((AndroidApplicationBase)app).getAudio()).dispose();
 			Gdx.app.log(""AndroidGraphics"", ""destroyed"");
 		}
 ",0
fix bug when sample ratio=0.3," package com.dianping.cat.message.io;
 
+import java.util.Random;
 import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.LinkedBlockingQueue;
 import java.util.concurrent.TimeUnit;
-import java.util.concurrent.atomic.AtomicInteger;
 
 import com.dianping.cat.message.spi.MessageQueue;
 import com.dianping.cat.message.spi.MessageTree;
@@ -11,7 +11,7 @@
 public class DefaultMessageQueue implements MessageQueue {
 	private BlockingQueue<MessageTree> m_queue;
 
-	private AtomicInteger m_count = new AtomicInteger();
+	private Random rand = new Random();
 
 	public DefaultMessageQueue(int size) {
 		m_queue = new LinkedBlockingQueue<MessageTree>(size);
@@ -26,9 +26,7 @@
 	public boolean offer(MessageTree tree, double sampleRatio) {
 		if (tree.isSample() && sampleRatio < 1.0) {
 			if (sampleRatio > 0) {
-				int count = m_count.incrementAndGet();
-
-				if (count % (1 / sampleRatio) == 0) {
+				if (rand.nextInt(100) < 100 * sampleRatio) {
 					return offer(tree);
 				}
 			}",0
[#3131] Add alarm for deadlock occurrence,"             return new DataSourceConnectionUsageRateChecker((DataSourceDataCollector) dataCollector, rule);
         }
     },
-    DEADLOCK_OCCURRENCE(""DEADLOCK OCCURRENCE"", DataCollectorCategory.DATA_SOURCE_STAT) {
+    DEADLOCK_OCCURRENCE(""DEADLOCK OCCURRENCE"", DataCollectorCategory.AGENT_EVENT) {
         @Override
         public AlarmChecker createChecker(DataCollector dataCollector, Rule rule) {
             return new DeadlockChecker((AgentEventDataCollector) dataCollector, rule);",0
Show correct header when selected panel is removed," // ZAP: 2015/02/16 Issue 1528: Support user defined font size
 // ZAP: 2016/06/14 Issue 2578: Must click on text in Options column to select row
 // ZAP: 2016/08/23 Respect sort parameter when adding intermediate panels
+// ZAP: 2016/10/27 Explicitly show other panel when the selected panel is removed.
 
 package org.parosproxy.paros.view;
 
@@ -80,6 +81,7 @@
     
     // ZAP: show the last selected panel
     private String nameLastSelectedPanel = null;
+    private AbstractParamPanel currentShownPanel;
     private ShowHelpAction showHelpAction = null;
     
     // ZAP: Added logger
@@ -401,6 +403,19 @@
      * @param panel the panel that will be removed
      */
     public void removeParamPanel(AbstractParamPanel panel) {
+        if (currentShownPanel == panel) {
+            currentShownPanel = null;
+            nameLastSelectedPanel = null;
+            if (isShowing()) {
+                if (tablePanel.isEmpty()) {
+                    getTxtHeadline().setText("""");
+                    getHelpButton().setVisible(false);
+                } else {
+                    getTreeParam().setSelectionPath(new TreePath(getFirstAvailableNode().getPath()));
+                }
+            }
+        }
+
         DefaultMutableTreeNode node = this.getTreeNodeFromPanelName(panel.getName(), true);
         if (node != null) {
             getTreeModel().removeNodeFromParent(node);
@@ -410,6 +425,13 @@
         tablePanel.remove(panel.getName());
     }
 
+    private DefaultMutableTreeNode getFirstAvailableNode() {
+        if (((DefaultMutableTreeNode) getTreeModel().getRoot()).getChildCount() > 0) {
+            return (DefaultMutableTreeNode) ((DefaultMutableTreeNode) getTreeModel().getRoot()).getChildAt(0);
+        }
+        return getTreeNodeFromPanelName(tablePanel.keys().nextElement());
+    }
+
     // ZAP: Made public so that other classes can specify which panel is displayed
     public void showParamPanel(String parent, String child) {
         if (parent == null || child == null) {
@@ -458,15 +480,17 @@
      * @see AbstractParamPanel#onShow()
      */
     public void showParamPanel(AbstractParamPanel panel, String name) {
-        // ZAP: Notify previously shown panel that it was hidden
-        if (nameLastSelectedPanel != null) {
-            AbstractParamPanel currentPanel = tablePanel.get(nameLastSelectedPanel);
-            if (currentPanel != null) {
-                currentPanel.onHide();
+        if (currentShownPanel == panel) {
+            return;
             }
+
+        // ZAP: Notify previously shown panel that it was hidden
+        if (currentShownPanel != null) {
+            currentShownPanel.onHide();
         }
         
         nameLastSelectedPanel = name;
+        currentShownPanel = panel; 
 
         getPanelHeadline();
         getTxtHeadline().setText(name);
@@ -655,7 +679,11 @@
             int index = parent.getIndex(node);
             getTreeModel().removeNodeFromParent(node);
             getTreeModel().insertNodeInto(node, parent, index);
+
+            if (panel == currentShownPanel) {
             this.nameLastSelectedPanel = newPanelName;
+                this.currentShownPanel = null;
+            }
 
             this.getPanelParam().remove(panel);
 ",0
fix log format at WebSocketClient," 
     @Override
     public void onError(Exception e) {
-        log.error(String.format(""WebSocket connection to {} failed with error"", uri), e);
+        log.error(""WebSocket connection to {} failed with error"", uri, e);
         listener.onError(e);
     }
 ",0
"Make registries persist by default, fixes #3989","     private List<ClearCallback<T>> clearCallback = Lists.newArrayList();
     private List<CreateCallback<T>> createCallback = Lists.newArrayList();
     private List<SubstitutionCallback<T>> substitutionCallback = Lists.newArrayList();
-    private boolean saveToDisc;
+    private boolean saveToDisc = true;
 
     public RegistryBuilder<T> setName(ResourceLocation name)
     {",0
Not all result sets are processed when UPDATE or INSERT is performed in between.,"         // Crazy Standard JDBC way of determining if there are more results
         if (!((!stmt.getMoreResults()) && (stmt.getUpdateCount() == -1))) {
           ResultSet rs = stmt.getResultSet();
-          return rs != null ? new ResultSetWrapper(rs, configuration) : null;
+          if (rs == null) {
+            return getNextResultSet(stmt);
+          } else {
+            return new ResultSetWrapper(rs, configuration);
+          }
         }
       }
     } catch (Exception e) {",0
Fix rename for SMB folder/files (#1100)," 
         builder.onPositive((dialog, which) -> {
             String name1 = dialog.getInputEditText().getText().toString();
-            if (f.isSmb()){
-                if (f.isDirectory() && !name1.endsWith(""/""))
-                    name1 = name1 + ""/"";
-            }
             getMainActivity().mainActivityHelper.rename(openMode, f.getPath(),
                     CURRENT_PATH + ""/"" + name1, getActivity(), getMainActivity().isRootExplorer());
         });",0
1.x: Workaround for CHM.keySet bad type with Java 8 compiler," package rx.internal.schedulers;
 
 import java.lang.reflect.*;
-import java.util.Iterator;
+import java.util.*;
 import java.util.concurrent.*;
 import java.util.concurrent.atomic.AtomicReference;
 
@@ -110,10 +110,12 @@
     }
 
     /** Purges each registered executor and eagerly evicts shutdown executors. */
-    @SuppressAnimalSniffer // CHM.keySet returns KeySetView in Java 8+; false positive here
     static void purgeExecutors() {
         try {
-            Iterator<ScheduledThreadPoolExecutor> it = EXECUTORS.keySet().iterator();
+            // This prevents map.keySet to compile to a Java 8+ KeySetView return type
+            // and cause NoSuchMethodError on Java 6-7 runtimes.
+            Map<ScheduledThreadPoolExecutor, ScheduledThreadPoolExecutor> map = EXECUTORS;
+            Iterator<ScheduledThreadPoolExecutor> it = map.keySet().iterator();
             while (it.hasNext()) {
                 ScheduledThreadPoolExecutor exec = it.next();
                 if (!exec.isShutdown()) {",0
#218 enable cross fork compare,"     }
 
     public GHCompare getCompare(GHBranch id1, GHBranch id2) throws IOException {
+
+        GHRepository owner1 = id1.getOwner();
+        GHRepository owner2 = id2.getOwner();
+
+        // If the owner of the branches is different, we have a cross-fork compare.
+        if (owner1!=null && owner2!=null) {
+            String ownerName1 = owner1.getOwnerName();
+            String ownerName2 = owner2.getOwnerName();
+            if (!StringUtils.equals(ownerName1, ownerName2)) {
+                String qualifiedName1 = String.format(""%s:%s"", ownerName1, id1.getName());
+                String qualifiedName2 = String.format(""%s:%s"", ownerName2, id2.getName());
+                return getCompare(qualifiedName1, qualifiedName2);
+            }
+        }
+
         return getCompare(id1.getName(),id2.getName());
+
     }
 
     /**",0
Fix thread safety issue for writePos variable,"   }
 
   @Override
-  public AsyncFile write(Buffer buffer) {
+  public synchronized AsyncFile write(Buffer buffer) {
     int length = buffer.length();
     doWrite(buffer, writePos, null);
     writePos += length;",0
fixed an 'activity has leaked window'," 								jid.setError(getString(R.string.contact_already_exists));
 							} else {
 								xmppConnectionService.createContact(contact);
-								switchToConversation(contact);
 								dialog.dismiss();
+								switchToConversation(contact);
 							}
 						} else {
 							jid.setError(getString(R.string.invalid_jid));
@@ -421,6 +421,7 @@
 										xmppConnectionService
 												.joinMuc(conversation);
 									}
+									dialog.dismiss();
 									switchToConversation(conversation);
 								}
 							} else {
@@ -430,6 +431,7 @@
 								if (!conversation.getMucOptions().online()) {
 									xmppConnectionService.joinMuc(conversation);
 								}
+								dialog.dismiss();
 								switchToConversation(conversation);
 							}
 						} else {",0
Fix boolean checks in isFFmpegCommandRunning and killRunningProcesses," 
     @Override
     public boolean isFFmpegCommandRunning() {
-        return ffmpegExecuteAsyncTask != null && ffmpegExecuteAsyncTask.isProcessCompleted();
+        return ffmpegExecuteAsyncTask != null && !ffmpegExecuteAsyncTask.isProcessCompleted();
     }
 
     @Override
     public boolean killRunningProcesses() {
-        return Util.killAsync(ffmpegLoadLibraryAsyncTask) && Util.killAsync(ffmpegExecuteAsyncTask);
+        return Util.killAsync(ffmpegLoadLibraryAsyncTask) || Util.killAsync(ffmpegExecuteAsyncTask);
     }
 
     @Override",0
Brings back fix of PUBDEV-3401 that was reverted by incorrect merge,"     // only check header for 2nd file onward since guess setup is already done on first file.
     if ((fileIndex > 0) && (!checkFileNHeader(is, dout, din, cidx)))
       return new StreamInfo(zidx, nextChunk);  // header is bad, quit now
-    while (is.available() > 0) {
+    int streamAvailable = is.available();
+    while (streamAvailable > 0) {
+      parseChunk(cidx++, din, nextChunk);
+      streamAvailable = is.available(); // Can (also!) rollover to the next input chunk
       int xidx = bvs.read(null, 0, 0); // Back-channel read of chunk index
       if (xidx > zidx) {  // Advanced chunk index of underlying ByteVec stream?
         zidx = xidx;       // Record advancing of chunk
@@ -193,7 +196,6 @@
         }
         nextChunk = nextChunk.nextChunk();
       }
-      parseChunk(cidx++, din, nextChunk);
     }
     parseChunk(cidx, din, nextChunk);
     return new StreamInfo(zidx, nextChunk);",0
fix NPE,"     @Override
     protected void onDetachedFromWindow() {
         super.onDetachedFromWindow();
+        targetElement = null;
         if (dialog != null) {
             dialog.dismiss();
         }
-        targetElement = null;
     }
 
     public void setOnDragListener(OnDragListener onDragListener) {
@@ -185,9 +185,11 @@
                     dialog.setOnDismissListener(new DialogInterface.OnDismissListener() {
                         @Override
                         public void onDismiss(DialogInterface dialog) {
+                            if (targetElement != null) {
                             targetElement.reset();
                             invalidate();
                         }
+                        }
                     });
                 }
                 dialog.show(targetElement);",0
Fix network connection,"   @SuppressWarnings(""unchecked"")
   @Override
   public void setJsonParameters(Map<String, Object> allParameters) throws Exception {
-	  Map<String, Map<String, Object>> parameters = (Map<String, Map<String, Object>>)allParameters.get(""parameters"");
-	  Map<String, Object> typeMap = parameters.get(""type"");
-	  
-	  type = new ConnectionType(Boolean.parseBoolean(typeMap.get(""wifiEnabled"").toString()), 
-			  					Boolean.parseBoolean(typeMap.get(""dataEnabled"").toString()),
-			  					Boolean.parseBoolean(typeMap.get(""airplaneMode"").toString()));
+    Map<String, Object> parameters = (Map<String, Object>)allParameters.get(""parameters"");
+    Number bitmask = (Number) parameters.get(""type"");
+    type = new ConnectionType(bitmask.intValue());
   }
 
   @Override",0
fix 使用jdbc调用metaData.getColumnCount()函数无法获取正常列数信息的问题 #751,"  */
 public class ElasticSearchResultSetMetaDataBase extends ResultSetMetaDataBase {
 	
-    private final List<ColumnMetaData> columns = new ArrayList<ColumnMetaData>();
+    private final List<ColumnMetaData> columns = super.getColumns();
 
     public ElasticSearchResultSetMetaDataBase(List<String> headers) {
         for(String column:headers){",0
Fix BitmapFont parsing," 
 					// Expect ID to mean ""index"".
 					Matcher matcher = Pattern.compile("".*id=(\\d+)"").matcher(line);
-					if (matcher.matches()) {
+					if (matcher.find()) {
 						String id = matcher.group(1);
 						try {
-							int pageID = Integer.parseInt(id.substring(3));
-							if (pageID != p) throw new GdxRuntimeException(""Page IDs must be indices starting at 0: "" + id.substring(3));
+							int pageID = Integer.parseInt(id);
+							if (pageID != p) throw new GdxRuntimeException(""Page IDs must be indices starting at 0: "" + id);
 						} catch (NumberFormatException ex) {
-							throw new GdxRuntimeException(""Invalid page id: "" + id.substring(3), ex);
+							throw new GdxRuntimeException(""Invalid page id: "" + id, ex);
 						}
 					}
 
-					matcher = Pattern.compile("".*file=\""?([^\""]*+)\""?"").matcher(line);
-					if (!matcher.matches()) throw new GdxRuntimeException(""Missing: file"");
+					matcher = Pattern.compile("".*file=\""?([^\""]+)\""?"").matcher(line);
+					if (!matcher.find()) throw new GdxRuntimeException(""Missing: file"");
 					String fileName = matcher.group(1);
 
 					imagePaths[p] = fontFile.parent().child(fileName).path().replaceAll(""\\\\"", ""/"");",0
Created anonymous customer if no customer present in API calls.," import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.broadleafcommerce.common.util.StringUtil;
+import org.broadleafcommerce.common.web.BroadleafRequestContext;
 import org.broadleafcommerce.profile.core.domain.Customer;
 import org.broadleafcommerce.profile.core.service.CustomerService;
 import org.broadleafcommerce.profile.web.core.CustomerState;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.beans.factory.annotation.Qualifier;
 import org.springframework.core.Ordered;
+import org.springframework.web.context.request.ServletWebRequest;
 import org.springframework.web.filter.GenericFilterBean;
 
 import java.io.IOException;
@@ -38,6 +40,7 @@
 import javax.servlet.ServletRequest;
 import javax.servlet.ServletResponse;
 import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
 
 /**
  * This is a basic filter for finding the customer ID on the request and setting the customer object on the request.
@@ -111,9 +114,15 @@
                 }
             }
         }
+        if (CustomerState.getCustomer() == null) { //we need to create an anonymous customer for API calls
+            ServletWebRequest servletWebRequest = new ServletWebRequest(request, (HttpServletResponse)servletResponse);
+            BroadleafRequestContext.getBroadleafRequestContext().setWebRequest(servletWebRequest);
+            Customer customer = this.customerService.createCustomer();
+            CustomerState.setCustomer(customer);
+            setupCustomerForRuleProcessing(customer, request);
+        }
 
         filterChain.doFilter(request, servletResponse);
-
     }
 
     private void setupCustomerForRuleProcessing(Customer customer, HttpServletRequest request) {",0
Fix typo in DefaultResultSetHandler,"   private final Map<CacheKey, List<PendingRelation>> pendingRelations = new HashMap<CacheKey, List<PendingRelation>>();
 
   // Cached Automappings
-  private final Map<String, List<UnMappedColumAutoMapping>> autoMappingsCache = new HashMap<String, List<UnMappedColumAutoMapping>>();
+  private final Map<String, List<UnMappedColumnAutoMapping>> autoMappingsCache = new HashMap<String, List<UnMappedColumnAutoMapping>>();
   
   private static class PendingRelation {
     public MetaObject metaObject;
     public ResultMapping propertyMapping;
   }
 
-  private static class UnMappedColumAutoMapping {    
+  private static class UnMappedColumnAutoMapping {
     private final String column;   
     private final String property;    
     private final TypeHandler<?> typeHandler;
     private final boolean primitive;
-    public UnMappedColumAutoMapping(String column, String property, TypeHandler<?> typeHandler, boolean primitive) {
+    public UnMappedColumnAutoMapping(String column, String property, TypeHandler<?> typeHandler, boolean primitive) {
       this.column = column;
       this.property = property;
       this.typeHandler = typeHandler;
@@ -453,11 +453,11 @@
     }
   }
 
-  private List<UnMappedColumAutoMapping> createAutomaticMappings(ResultSetWrapper rsw, ResultMap resultMap, MetaObject metaObject, String columnPrefix) throws SQLException {
+  private List<UnMappedColumnAutoMapping> createAutomaticMappings(ResultSetWrapper rsw, ResultMap resultMap, MetaObject metaObject, String columnPrefix) throws SQLException {
     final String mapKey = resultMap.getId() + "":"" + columnPrefix;
-    List<UnMappedColumAutoMapping> autoMapping = autoMappingsCache.get(mapKey);
+    List<UnMappedColumnAutoMapping> autoMapping = autoMappingsCache.get(mapKey);
     if (autoMapping == null) {
-      autoMapping = new ArrayList<UnMappedColumAutoMapping>();
+      autoMapping = new ArrayList<UnMappedColumnAutoMapping>();
       final List<String> unmappedColumnNames = rsw.getUnmappedColumnNames(resultMap, columnPrefix);
       for (String columnName : unmappedColumnNames) {
         String propertyName = columnName;
@@ -475,7 +475,7 @@
           final Class<?> propertyType = metaObject.getSetterType(property);
           if (typeHandlerRegistry.hasTypeHandler(propertyType, rsw.getJdbcType(columnName))) {
             final TypeHandler<?> typeHandler = rsw.getTypeHandler(propertyType, columnName);
-            autoMapping.add(new UnMappedColumAutoMapping(columnName, property, typeHandler, propertyType.isPrimitive()));
+            autoMapping.add(new UnMappedColumnAutoMapping(columnName, property, typeHandler, propertyType.isPrimitive()));
           } else {
             configuration.getAutoMappingUnknownColumnBehavior()
                     .doAction(mappedStatement, columnName, property, propertyType);
@@ -491,10 +491,10 @@
   }
   
   private boolean applyAutomaticMappings(ResultSetWrapper rsw, ResultMap resultMap, MetaObject metaObject, String columnPrefix) throws SQLException {
-    List<UnMappedColumAutoMapping> autoMapping = createAutomaticMappings(rsw, resultMap, metaObject, columnPrefix);
+    List<UnMappedColumnAutoMapping> autoMapping = createAutomaticMappings(rsw, resultMap, metaObject, columnPrefix);
     boolean foundValues = false;
     if (autoMapping.size() > 0) {
-      for (UnMappedColumAutoMapping mapping : autoMapping) {
+      for (UnMappedColumnAutoMapping mapping : autoMapping) {
         final Object value = mapping.typeHandler.getResult(rsw.getResultSet(), mapping.column);
         // issue #377, call setter on nulls
         if (value != null || configuration.isCallSettersOnNulls()) {",0
bug fix-农历切换时，如果当前是闰月，WheelTime上月份显示错误,"         wv_month = (WheelView) view.findViewById(R.id.month);
         wv_month.setAdapter(new ArrayWheelAdapter(ChinaDate.getMonths(year)));
         wv_month.setLabel("""");
+        
+        int leapMonth = ChinaDate.leapMonth(year);
+        if (leapMonth != 0 && (month > leapMonth - 1 || isLeap)) { //选中月是闰月或大于闰月
+            wv_month.setCurrentItem(month + 1);
+        } else {
         wv_month.setCurrentItem(month);
+        }
+        
         wv_month.setGravity(gravity);
 
         // 日",0
#6284: fix SelectionWidget,"   }
 
   public Integer getSelectedOptionIndex(String option) {
-    for (int i = 0; options.length > 0 && i < options.length + 1; i++) {
+    for (int i = 0; options.length > 0 && i < options.length; i++) {
       if (options[i].equals(option)) {
         return i;
       }",0
CosmosDB DocumentDBConverter Fixed," package org.apereo.cas.cosmosdb;
 
 import com.microsoft.azure.spring.data.documentdb.core.mapping.PartitionKey;
-import lombok.extern.slf4j.Slf4j;
 import org.springframework.data.annotation.Id;
 import org.springframework.data.mongodb.core.mapping.Document;
 import lombok.Getter;
@@ -14,7 +13,6 @@
  * @since 5.2.0
  */
 @Document
-@Slf4j
 @Getter
 @Setter
 public class CosmosDbDocument {",0
Fix tar archive extraction," import java.io.BufferedOutputStream;
 import java.io.File;
 import java.io.FileInputStream;
+import java.io.IOException;
 import java.util.ArrayList;
 import java.util.Enumeration;
 import java.util.zip.GZIPInputStream;
@@ -436,12 +437,7 @@
 
                 ArrayList<TarArchiveEntry> archiveEntries = new ArrayList<>();
 
-                TarArchiveInputStream inputStream;
-
-                if (archive.getName().endsWith("".tar""))
-                    inputStream = new TarArchiveInputStream(new BufferedInputStream(new FileInputStream(archive)));
-                else
-                    inputStream = new TarArchiveInputStream(new GZIPInputStream(new FileInputStream(archive)));
+                TarArchiveInputStream inputStream = createTarInputStream(archive);
 
                 TarArchiveEntry tarArchiveEntry = inputStream.getNextTarEntry();
 
@@ -462,10 +458,13 @@
                 watcherUtil = new ServiceWatcherUtil(progressHandler, totalBytes);
                 watcherUtil.watch();
 
+                inputStream = createTarInputStream(archive);
+
                 for (TarArchiveEntry entry : archiveEntries) {
 
                     if (!progressHandler.getCancelled()) {
 
+                        inputStream.getNextTarEntry();
                         progressHandler.setFileName(entry.getName());
                         unzipTAREntry(inputStream, entry, destinationPath);
                     }
@@ -484,6 +483,14 @@
 
         }
 
+        private TarArchiveInputStream createTarInputStream(File archive) throws IOException {
+            if (archive.getName().endsWith("".tar"")) {
+                return new TarArchiveInputStream(new BufferedInputStream(new FileInputStream(archive)));
+            } else {
+                return new TarArchiveInputStream(new GZIPInputStream(new FileInputStream(archive)));
+            }
+        }
+
         private boolean extractRar(File archive, String destinationPath) {
 
             try {",0
2.x: fix SpscLinkedArrayQueue leaves 1 slot null just before growing,"             if (null == lvElement(buffer, lookAheadElementOffset)) {// LoadLoad
                 producerLookAhead = index + lookAheadStep - 1; // joy, there's plenty of room
                 return writeToQueue(buffer, e, index, offset);
-            } else if (null != lvElement(buffer, calcWrappedOffset(index + 1, mask))) { // buffer is not full
+            } else if (null == lvElement(buffer, calcWrappedOffset(index + 1, mask))) { // buffer is not full
                 return writeToQueue(buffer, e, index, offset);
             } else {
                 resize(buffer, index, offset, e, mask); // add a buffer and link old to new",0
Fix consul converter and construct props order," 
     final static String               UTF8_ENCODING    = ""UTF-8"";
 
-    final static String               UNIQUE_ID        = ""uniqueId"";
+    final static String               INTERFACE        = ""interface"";
 
     final static String               GROUP_KEY        = ""group"";
 
@@ -123,7 +123,7 @@
                     }
                 }
             }
-            interfaceId = parameters.get(UNIQUE_ID);
+            interfaceId = parameters.get(INTERFACE);
             group = parameters.get(GROUP_KEY);
             url = url.substring(0, i);
         }
@@ -159,7 +159,7 @@
         if (url.length() > 0) {
             host = url;
         }
-        return new ConsulURL(protocol, host, port, path, interfaceId, group, parameters);
+        return new ConsulURL(protocol, host, port, path, group, interfaceId, parameters);
     }
 
     public String getProtocol() {
@@ -257,8 +257,8 @@
             List<String> includes = (parameters == null || parameters.length == 0 ? null : Arrays.asList(parameters));
             boolean first = true;
             for (Map.Entry<String, String> entry : new TreeMap<String, String>(getParameters()).entrySet()) {
-                if (entry.getKey() != null && entry.getKey().length() > 0
-                    && (includes == null || includes.contains(entry.getKey()))) {
+                if (entry.getKey() != null && entry.getKey().length() > 0 &&
+                    (includes == null || includes.contains(entry.getKey()))) {
                     if (first) {
                         if (concat) {
                             buf.append(""?"");
@@ -334,18 +334,15 @@
     }
 
     public String getGroup() {
-        String group = getParameter(RpcConstants.CONFIG_KEY_UNIQUEID, RpcConstants.ADDRESS_DEFAULT_GROUP);
-        return group;
+        return getParameter(RpcConstants.CONFIG_KEY_UNIQUEID, RpcConstants.ADDRESS_DEFAULT_GROUP);
     }
 
     public String getVersion() {
-        String group = getParameter(RpcConstants.CONFIG_KEY_RPC_VERSION, ConsulConstants.DEFAULT_VERSION);
-        return group;
+        return getParameter(RpcConstants.CONFIG_KEY_RPC_VERSION, ConsulConstants.DEFAULT_VERSION);
     }
 
     public String getServiceInterface() {
-        String interfaceId = getParameter(RpcConstants.CONFIG_KEY_INTERFACE, """");
-        return interfaceId;
+        return getParameter(RpcConstants.CONFIG_KEY_INTERFACE, """");
     }
 
     public static String encode(String value) {",0
Fix and tweaks to DynamicFieldsPanel," import java.util.Map;
 import java.util.Map.Entry;
 
+import javax.swing.Box;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
 
@@ -34,10 +35,7 @@
 	 * @see #setFields(String[])
 	 */
 	public DynamicFieldsPanel() {
-		this.requiredFields = NO_FIELDS;
-		this.optionalFields = NO_FIELDS;
-
-		this.textFields = Collections.emptyMap();
+		this(NO_FIELDS, NO_FIELDS);
 	}
 
 	public DynamicFieldsPanel(String[] requiredFields) {
@@ -93,28 +91,29 @@
 
 		int fieldIndex = 0;
 		for (String fieldName : requiredFields) {
-			this.add(new JLabel(""* "" + fieldName + "": ""), LayoutHelper.getGBC(0, fieldIndex, 1, 0.0d, 0.0d));
-
-			ZapTextField tf = new ZapTextField();
-			this.add(tf, LayoutHelper.getGBC(1, fieldIndex, 1, 1.0d, 0.0d));
-			textFields.put(fieldName, tf);
-
+			addField(""* "" + fieldName, fieldIndex);
 			fieldIndex++;
 		}
 
 		for (String fieldName : optionalFields) {
-			this.add(new JLabel(fieldName + "": ""), LayoutHelper.getGBC(0, fieldIndex, 1, 0.0d, 0.0d));
-
-			ZapTextField tf = new ZapTextField();
-			this.add(tf, LayoutHelper.getGBC(1, fieldIndex, 1, 1.0d, 0.0d));
-			textFields.put(fieldName, tf);
-
+			addField(fieldName, fieldIndex);
 			fieldIndex++;
 		}
+		add(Box.createVerticalGlue(), LayoutHelper.getGBC(0, fieldIndex, 2, 0.0d, 1.0d));
 
 		validate();
 	}
 
+	private void addField(String fieldName, int fieldIndex) {
+		JLabel label = new JLabel(fieldName + "": "");
+		this.add(label, LayoutHelper.getGBC(0, fieldIndex, 1, 0.0d, 0.0d));
+
+		ZapTextField tf = new ZapTextField();
+		label.setLabelFor(tf);
+		this.add(tf, LayoutHelper.getGBC(1, fieldIndex, 1, 1.0d, 0.0d));
+		textFields.put(fieldName, tf);
+	}
+
 	/**
 	 * Clears all the fields, leaving an empty panel.
 	 *",0
 Fix spelling error.," 	private static final String NACOS_PROPERTY_SOURCE_NAME = ""NACOS"";
 	private static final String SEP1 = ""-"";
 	private static final String DOT = ""."";
-	private static final String SHARED_CONFIG_SEPRATOR_CHAR = ""[,]"";
+	private static final String SHARED_CONFIG_SEPARATOR_CHAR = ""[,]"";
 	private static final List<String> SUPPORT_FILE_EXTENSION = Arrays.asList(""properties"",
 			""yaml"", ""yml"");
 
@@ -106,7 +106,7 @@
 			return;
 		}
 
-		String[] sharedDataIdArry = sharedDataIds.split(SHARED_CONFIG_SEPRATOR_CHAR);
+		String[] sharedDataIdArry = sharedDataIds.split(SHARED_CONFIG_SEPARATOR_CHAR);
 		checkDataIdFileExtension(sharedDataIdArry);
 
 		for (int i = 0; i < sharedDataIdArry.length; i++) {
@@ -210,7 +210,7 @@
 			return false;
 		}
 
-		String[] refreshDataIdArry = refreshDataIds.split(SHARED_CONFIG_SEPRATOR_CHAR);
+		String[] refreshDataIdArry = refreshDataIds.split(SHARED_CONFIG_SEPARATOR_CHAR);
 		for (String refreshDataId : refreshDataIdArry) {
 			if (refreshDataId.equals(sharedDataId)) {
 				return true;",0
Fixed entity cache region," @Entity
 @Inheritance(strategy = InheritanceType.JOINED)
 @javax.persistence.Table(name = ""BLC_TRANSLATION"")
-@Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = ""blStandardElements"")
+@Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = ""blTranslationElements"")
 @AdminPresentationClass(populateToOneFields = PopulateToOneFieldsEnum.TRUE, friendlyName = ""baseProduct"")
 //multi-column indexes don't appear to get exported correctly when declared at the field level, so declaring here as a workaround
 @Table(appliesTo = ""BLC_TRANSLATION"", indexes = {",0
fix an ArrayIndexOutOfBoundsException that could occur if ESSearchTask fails," import io.crate.planner.symbol.Reference;
 import org.apache.lucene.util.BytesRef;
 import org.elasticsearch.action.ActionListener;
-import org.elasticsearch.action.search.SearchPhaseExecutionException;
-import org.elasticsearch.action.search.SearchRequest;
-import org.elasticsearch.action.search.SearchResponse;
-import org.elasticsearch.action.search.TransportSearchAction;
+import org.elasticsearch.action.search.*;
 import org.elasticsearch.common.logging.ESLogger;
 import org.elasticsearch.common.logging.Loggers;
 import org.elasticsearch.search.SearchHit;
@@ -188,12 +185,13 @@
         public void onFailure(Throwable e) {
             if (e instanceof SearchPhaseExecutionException) {
                 logger.error(""Error executing SELECT statement"", e);
-                result.setException(
-                        Throwables.getRootCause(((SearchPhaseExecutionException) e).shardFailures()[0].failure()));
-            } else {
+                ShardSearchFailure[] shardSearchFailures = ((SearchPhaseExecutionException) e).shardFailures();
+                if (shardSearchFailures.length > 0) {
+                    result.setException(Throwables.getRootCause(shardSearchFailures[0].failure()));
+                    return;
+                }
+            }
                 result.setException(e);
             }
         }
     }
-
-}",0
Fix NPE with scripts from custom directories," 	}
 	
 	public ScriptWrapper getScript(String name) {
-		ScriptWrapper script =  this.getTreeModel().getScript(name);
+		ScriptWrapper script = getScriptImpl(name);
+		if (script != null) {
 		refreshScript(script);
 		reloadIfChangedOnDisk(script);
+		}
 		return script;
 	}
 	
+	/**
+	 * Gets the script with the given name.
+	 * <p>
+	 * Internal method that does not perform any actions on the returned script.
+	 *
+	 * @param name the name of the script.
+	 * @return the script, or {@code null} if it doesn't exist.
+	 * @see #getScript(String)
+	 */
+	private ScriptWrapper getScriptImpl(String name) {
+		return this.getTreeModel().getScript(name);
+	}
+	
 	public ScriptNode addScript(ScriptWrapper script) {
 		return this.addScript(script, true);
 	}
@@ -876,7 +891,7 @@
 	 * Returns a unique name for the given script name
 	 */
 	private String getUniqueScriptName(String name, String ext) {
-		if (this.getScript(name) == null) {
+		if (this.getScriptImpl(name) == null) {
 			// Its unique
 			return name;
 		}
@@ -887,7 +902,7 @@
 			index++;
 			name = stub + ""("" + index + "")."" + ext;
 		}
-		while (this.getScript(name) != null);
+		while (this.getScriptImpl(name) != null);
 		
 		return name;
 	}",0
Fix indicator position of auto_center," 
       if (isLayoutRtl) {
         x = -Utils.getWidthWithMargin(selectedTab) / 2 + getWidth() / 2;
+        x -= Utils.getPaddingStart(this);
       } else {
         x = Utils.getWidthWithMargin(selectedTab) / 2 - getWidth() / 2;
+        x += Utils.getPaddingStart(this);
       }
 
     } else {",0
"Revert ""Fixes #4322: Restore window on correct monitor"""," 			Lwjgl3DisplayMode currentMode = (Lwjgl3DisplayMode) getDisplayMode();
 			int windowPosX = (currentMode.width - width) / 2;
 			int windowPosY = (currentMode.height - height) / 2;
-			GLFW.glfwSetWindowMonitor(window.getWindowHandle(), currentMode.getMonitor(),
+			GLFW.glfwSetWindowMonitor(window.getWindowHandle(), 0,
 					windowPosX, windowPosY, width, height, currentMode.refreshRate);
 		}
 		updateFramebufferInfo();",0
CODENVY-529: fix terminal uri usage,"             if (Constants.TERMINAL_REFERENCE.equals(descriptor.getRef())) {
                 String terminalUrl = descriptor.getUrl();
 
-                terminalUrl = terminalUrl.substring(terminalUrl.indexOf(':'), terminalUrl.length());
+                String uriWithoutProtocol = terminalUrl.substring(terminalUrl.indexOf(':'), terminalUrl.length());
+                String protocol = Window.Location.getProtocol().equals(""https:"") ? ""wss"" : ""ws"";
 
-                boolean isSecureConnection = Window.Location.getProtocol().equals(""https:"");
-
-                return (isSecureConnection ? ""wss"" : ""ws"") + terminalUrl + ""/pty"";
+                return protocol +
+                       uriWithoutProtocol +
+                       (terminalUrl.endsWith(""/"") ? ""pty"" : ""/pty"");
             }
         }
 ",0
5.1.x-Fix windowInHours checking.," import javax.servlet.http.HttpServletRequest;
 import java.math.BigDecimal;
 import java.time.ZonedDateTime;
+import java.time.ZoneOffset;
 import java.util.Collection;
 
 /**
@@ -31,14 +32,20 @@
     @Override
     protected BigDecimal calculateScore(final HttpServletRequest request, final Authentication authentication,
                                         final RegisteredService service, final Collection<CasEvent> events) {
-        final ZonedDateTime timestamp = ZonedDateTime.now();
+        final ZonedDateTime timestamp = ZonedDateTime.now(ZoneOffset.UTC);
         LOGGER.debug(""Filtering authentication events for timestamp [{}]"", timestamp);
+        long count = 0;
 
-        final long count = events.stream().filter(e -> e.getCreationTime().getHour() == timestamp.getHour()
-                || e.getCreationTime().plusHours(windowInHours).getHour() == timestamp.getHour()
-                || e.getCreationTime().minusHours(windowInHours).getHour() == timestamp.getHour()).count();
+        if (timestamp.getHour() <= timestamp.plusHours(windowInHours).getHour()
+                && timestamp.getHour() >= timestamp.minusHours(windowInHours).getHour()){
+            count = events.stream().filter(e->e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
+                && e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
+        } else {
+            count = events.stream().filter(e -> e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
+                || e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
+        }
         
-        LOGGER.debug(""Total authentication events found for [{}]: [{}]"", timestamp, count);
+        LOGGER.debug(""Total authentication events found for [{}] in a [{}]h window: [{}]"", timestamp, windowInHours, count);
         if (count == events.size()) {
             LOGGER.debug(""Principal [{}] has always authenticated from [{}]"", authentication.getPrincipal(), timestamp);
             return LOWEST_RISK_SCORE;",0
Fixed place of if check,"             return;
         }
 
-        if (invalidation instanceof SingleNearCacheInvalidation && canSendInvalidation(invalidation)) {
+        if (invalidation instanceof SingleNearCacheInvalidation) {
+            if (canSendInvalidation(invalidation)) {
             ClientMessage message = encodeSingleInvalidation(invalidation.getName(), invalidation.getKey(),
                     invalidation.getSourceUuid(), invalidation.getPartitionUuid(), invalidation.getSequence());
 
             sendMessageWithOrderKey(message, invalidation.getKey());
+            }
             return;
         }
 ",0
Fixes issue voldemort/voldemort#234,"                         if(hasTransform) {
                             int numTrans = inputStream.readInt();
                             for(int i = 0; i < numTrans; i++) {
+								readKey(inputStream);
                                 readTransforms(inputStream);
                             }
                         }",0
[#853] Fix connection leak when loading saga,"                 logger.debug(""Loaded saga id [{}] of type [{}]"", sagaIdentifier, loadedSaga.getClass().getName());
             }
 
-            Set<AssociationValue> associations = sqldef.readAssociationValues(sqldef.sql_findAssociations(conn, sagaIdentifier, sagaTypeName(sagaType)).executeQuery());
-
-            return new EntryImpl<>(associations, loadedSaga);
+            return new EntryImpl<>(loadAssociations(conn, sagaTypeName(sagaType), sagaIdentifier), loadedSaga);
         } catch (SQLException e) {
             throw new SagaStorageException(""Exception while loading a Saga"", e);
         } finally {
@@ -302,6 +300,19 @@
         }
     }
 
+    private Set<AssociationValue> loadAssociations(final Connection conn, final String sagaTypeName, final String sagaIdentifier) throws SQLException {
+        PreparedStatement statement = null;
+        ResultSet resultSet = null;
+        try {
+            statement = sqldef.sql_findAssociations(conn, sagaIdentifier, sagaTypeName);
+            resultSet = statement.executeQuery();
+            return sqldef.readAssociationValues(resultSet);
+        } finally {
+            closeQuietly(statement);
+            closeQuietly(resultSet);
+        }
+    }
+
     private static class EntryImpl<S> implements Entry<S> {
         private final Set<AssociationValue> associations;
         private final S loadedSaga;",0
hotfix / github editor test deflake,"     }
 
     public void clickCreatePipelineButton() {
-        click("".button-create"");
+        wait.click(By.cssSelector("".button-create""));
     }
 
     public By emptyRepositoryCreateButton = By.cssSelector("".jenkins-pipeline-create-missing-jenkinsfile > div > button"");",0
Fix TextField not respecting onlyFontChars," 			} else {
 				boolean delete = character == DELETE;
 				boolean backspace = character == BACKSPACE;
-				boolean add = style.font.containsCharacter(character)
+				boolean add = (!onlyFontChars || style.font.containsCharacter(character))
 					|| (writeEnters && (character == ENTER_ANDROID || character == ENTER_DESKTOP));
 				boolean remove = backspace || delete;
 				if (add || remove) {",0
Fix for Sybase ASE 15.7 identification string,"         }
 
 		//Sybase ASE support
-        if (databaseProductName.startsWith(""ASE"")) {
+        if (databaseProductName.startsWith(""ASE"") || databaseProductName.startsWith(""Adaptive"")) {
         	return new SybaseASEDbSupport(connection);
         }
         if (databaseProductName.startsWith(""HDB"")) {",0
fix embedded C* range slice tombstone identification,"         return Iterators.filter(rows.iterator(), new Predicate<Row>() {
             @Override
             public boolean apply(@Nullable Row row) {
-                return (row == null) ? false : !(row.cf == null || row.cf.isMarkedForDelete() || row.cf.getColumnCount() == 0);
+                return !(row == null || row.cf == null || row.cf.isMarkedForDelete() || row.cf.hasOnlyTombstones());
             }
         });
     }",0
If someone wants to register a CurrencyConversionService there is a exception beeing thrown into CurrencyConversionContext," 
 public class CurrencyConversionContext {
     
-    private static final ThreadLocal<CurrencyConversionService> currencyConversionService = ThreadLocalManager.createThreadLocal(CurrencyConversionService.class);
+    private static final ThreadLocal<CurrencyConversionService> currencyConversionService = ThreadLocalManager.createThreadLocal(CurrencyConversionService.class, false);
 
     private static final ThreadLocal<HashMap> currencyConversionContext = ThreadLocalManager.createThreadLocal(HashMap.class);
 ",0
Fix #3604 - missing enter after stopping exit event," 		Actor over = hit(tempCoords.x, tempCoords.y, true);
 		if (over == overLast) return overLast;
 
+		// Exit overLast.
+		if (overLast != null) {
 		InputEvent event = Pools.obtain(InputEvent.class);
 		event.setStage(this);
 		event.setStageX(tempCoords.x);
 		event.setStageY(tempCoords.y);
 		event.setPointer(pointer);
-		// Exit overLast.
-		if (overLast != null) {
 			event.setType(InputEvent.Type.exit);
 			event.setRelatedActor(over);
 			overLast.fire(event);
+			Pools.free(event);
 		}
 		// Enter over.
 		if (over != null) {
+			InputEvent event = Pools.obtain(InputEvent.class);
+			event.setStage(this);
+			event.setStageX(tempCoords.x);
+			event.setStageY(tempCoords.y);
+			event.setPointer(pointer);
 			event.setType(InputEvent.Type.enter);
 			event.setRelatedActor(overLast);
 			over.fire(event);
-		}
 		Pools.free(event);
+		}
 		return over;
 	}
 ",0
Fix race condition: broker not scheduling read for active consumer,"     private int readBatchSize;
     private final Backoff readFailureBackoff = new Backoff(15, TimeUnit.SECONDS, 1, TimeUnit.MINUTES, 0, TimeUnit.MILLISECONDS);
     private final ServiceConfiguration serviceConfig;
-    private ScheduledFuture<?> readOnActiveConsumerTask = null;
+    private volatile ScheduledFuture<?> readOnActiveConsumerTask = null;
 
     private final RedeliveryTracker redeliveryTracker;
 ",0
Fix for issue #3055.," 
 package org.terasology.logic.players;
 
+import java.util.Arrays;
+import java.util.List;
+
 import org.lwjgl.input.Mouse;
 import org.terasology.config.Config;
+import org.terasology.context.Context;
 import org.terasology.entitySystem.entity.EntityRef;
 import org.terasology.entitySystem.event.EventPriority;
 import org.terasology.entitySystem.event.ReceiveEvent;
 import org.terasology.entitySystem.systems.BaseComponentSystem;
 import org.terasology.entitySystem.systems.RegisterMode;
 import org.terasology.entitySystem.systems.RegisterSystem;
+import org.terasology.i18n.TranslationSystem;
+import org.terasology.i18n.TranslationSystemImpl;
 import org.terasology.input.Keyboard;
 import org.terasology.input.binds.general.HideHUDButton;
 import org.terasology.input.events.KeyDownEvent;
@@ -31,6 +37,7 @@
 import org.terasology.input.events.MouseAxisEvent;
 import org.terasology.logic.characters.CharacterComponent;
 import org.terasology.logic.debug.DebugProperties;
+import org.terasology.logic.notifications.NotificationMessageEvent;
 import org.terasology.network.ClientComponent;
 import org.terasology.registry.In;
 import org.terasology.rendering.nui.NUIManager;
@@ -50,15 +57,21 @@
     private Config config;
 
     @In
+    private Context context;
+
+    @In
     private NUIManager nuiManager;
 
     private DebugOverlay overlay;
 
+    private TranslationSystem translationSystem;
+    
     private boolean mouseGrabbed = true;
 
     @Override
     public void initialise() {
         overlay = nuiManager.addOverlay(""engine:debugOverlay"", DebugOverlay.class);
+        translationSystem = new TranslationSystemImpl(context);
     }
 
     @ReceiveEvent(components = ClientComponent.class)
@@ -74,24 +87,47 @@
         }
     }
 
+    /**
+     * Increases view distance upon receiving an increase view distance event.
+     * @param button The button or key pressed to increase view distance.
+     * @param entity The player entity that triggered the view distance increase.
+     */
     @ReceiveEvent(components = ClientComponent.class)
     public void onIncreaseViewDistance(IncreaseViewDistanceButton button, EntityRef entity) {
         int viewDistance = config.getRendering().getViewDistance().getIndex();
         int maxViewDistance = ViewDistance.values().length - 1;
 
+        //Ensuring that the view distance does not exceed its maximum value.
         if (viewDistance != maxViewDistance) {
-            config.getRendering().setViewDistance(ViewDistance.forIndex((viewDistance + 1)));
+            ViewDistance greaterViewDistance = ViewDistance.forIndex(viewDistance + 1);
+            String greaterViewDistanceStr = translationSystem.translate(greaterViewDistance.toString());
+            fireChangeEvent(""Increasing view distance to "" + greaterViewDistanceStr + ""."", Arrays.asList(entity));
+            //Presenting user with a warning if the view distance is set higher than recommended.
+            if (greaterViewDistance == ViewDistance.MEGA || greaterViewDistance == ViewDistance.EXTREME) {
+                fireChangeEvent(""Warning: Increasing view distance to "" + greaterViewDistanceStr
+            	                    + "" may result in performance issues."", Arrays.asList(entity));
+            }
+            config.getRendering().setViewDistance(greaterViewDistance);
         }
         button.consume();
     }
 
+    /**
+     * Decreases view distance upon receiving a decrease view distance event.
+     * @param button The button or key pressed to decrease view distance.
+     * @param entity The player entity that triggered the view distance decrease.
+     */
     @ReceiveEvent(components = ClientComponent.class)
     public void onDecreaseViewDistance(DecreaseViewDistanceButton button, EntityRef entity) {
         int viewDistance = config.getRendering().getViewDistance().getIndex();
         int minViewDistance = 0;
 
+        //Ensuring that the view distance does not fall below its minimum value.
         if (viewDistance != minViewDistance) {
-            config.getRendering().setViewDistance(ViewDistance.forIndex((viewDistance - 1)));
+            ViewDistance lesserViewDistance = ViewDistance.forIndex(viewDistance - 1);
+            String lesserViewDistanceStr = translationSystem.translate(lesserViewDistance.toString());
+            fireChangeEvent(""Decreasing view distance to "" + lesserViewDistanceStr + ""."", Arrays.asList(entity));
+            config.getRendering().setViewDistance(lesserViewDistance);
         }
         button.consume();
     }
@@ -176,4 +212,15 @@
         }
     }
 
+    /**
+     * Fires notification events upon changes to debug parameters.
+     * @param message Notification event message.
+     * @param entity  Entities which will receive the notification event.
+     */
+	private void fireChangeEvent(String message, List<EntityRef> entities) {
+    	for (EntityRef client : entities) {
+    		client.send(new NotificationMessageEvent(message, client));
+    	}
+    }
+
 }",0
Preference window fixes for Linux,"   String[] monoFontFamilies;
   JComboBox<String> fontSelectionBox;
 
+  JButton okButton;
+
   /** Base object so that updates can be applied to the list of editors. */
   Base base;
 
@@ -554,7 +556,7 @@
 
     // [  OK  ] [ Cancel ]  maybe these should be next to the message?
 
-    JButton okButton = new JButton(Preferences.PROMPT_OK);
+    okButton = new JButton(Preferences.PROMPT_OK);
     okButton.addActionListener(new ActionListener() {
         public void actionPerformed(ActionEvent e) {
           applyFrame();
@@ -710,6 +712,7 @@
 
     Toolkit.registerWindowCloseKeys(dialog.getRootPane(), disposer);
     Toolkit.setIcon(dialog);
+    dialog.setResizable(false);
     dialog.pack();
     dialog.setLocationRelativeTo(null);
 
@@ -912,6 +915,15 @@
     if (autoAssociateBox != null) {
       autoAssociateBox.setSelected(Preferences.getBoolean(""platform.auto_file_type_associations"")); //$NON-NLS-1$
     }
+    // The OK Button has to be set as the default button every time the 
+    // PrefWindow is to be displayed
+    dialog.getRootPane().setDefaultButton(okButton);
+
+    // The pack is called again here second time to fix layout bugs
+    // the bugs are not due to groupLayout but due to HTML rendering of components
+    // more info can be found here -> https://netbeans.org/bugzilla/show_bug.cgi?id=79967
+    dialog.pack();
+
     dialog.setVisible(true);
   }
 ",0
Upcast ConcurrentHashMap to Map to avoid compatibility issue," import java.util.concurrent.*;
 import java.util.concurrent.atomic.AtomicReference;
 
-import io.reactivex.internal.util.SuppressAnimalSniffer;
 import io.reactivex.plugins.RxJavaPlugins;
 
 /**
@@ -46,7 +45,9 @@
     static final AtomicReference<ScheduledExecutorService> PURGE_THREAD =
             new AtomicReference<ScheduledExecutorService>();
 
-    static final ConcurrentHashMap<ScheduledThreadPoolExecutor, Object> POOLS =
+    // Upcast to the Map interface here to avoid 8.x compatibility issues.
+    // See http://stackoverflow.com/a/32955708/61158
+    static final Map<ScheduledThreadPoolExecutor, Object> POOLS =
             new ConcurrentHashMap<ScheduledThreadPoolExecutor, Object>();
 
     /**
@@ -63,10 +64,9 @@
 
                 next.scheduleAtFixedRate(new Runnable() {
                     @Override
-                    @SuppressAnimalSniffer
                     public void run() {
                         try {
-                            for (ScheduledThreadPoolExecutor e : new ArrayList<ScheduledThreadPoolExecutor>(POOLS.keySet())) {  // CHM.keySet returns KeySetView in Java 8+; false positive here
+                            for (ScheduledThreadPoolExecutor e : new ArrayList<ScheduledThreadPoolExecutor>(POOLS.keySet())) {
                                 if (e.isShutdown()) {
                                     POOLS.remove(e);
                                 } else {",0
Fix how client certs are read and set to request," package io.undertow.servlet.handlers.security;
 
+import java.io.ByteArrayInputStream;
+import java.security.cert.X509Certificate;
+import javax.net.ssl.SSLPeerUnverifiedException;
 import javax.net.ssl.SSLSession;
 import javax.servlet.ServletRequest;
 
@@ -65,6 +68,38 @@
 
      /* ------------------------------------------------------------ */
 
+    /**
+     * <p>Return the chain of X509 certificates used to negotiate the SSL Session.</p>
+     *
+     * We convert JSSE's javax.security.cert.X509Certificate[]  to servlet's  java.security.cert.X509Certificate[]
+     *
+     * @param session the   javax.net.ssl.SSLSession to use as the source of the cert chain.
+     * @return the chain of java.security.cert.X509Certificates used to
+     *         negotiate the SSL connection. <br>
+     *         Will be null if the chain is missing or empty.
+     */
+    private X509Certificate[] getCerts(SSLSession session) {
+        try {
+            javax.security.cert.X509Certificate[] javaxCerts = session.getPeerCertificateChain();
+            if (javaxCerts == null || javaxCerts.length == 0) {
+                return null;
+            }
+            X509Certificate[] javaCerts = new X509Certificate[javaxCerts.length];
+            java.security.cert.CertificateFactory cf = java.security.cert.CertificateFactory.getInstance(""X.509"");
+            for (int i = 0; i < javaxCerts.length; i++) {
+                byte[] bytes = javaxCerts[i].getEncoded();
+                ByteArrayInputStream stream = new ByteArrayInputStream(bytes);
+                javaCerts[i] = (X509Certificate) cf.generateCertificate(stream);
+            }
+
+            return javaCerts;
+        } catch (SSLPeerUnverifiedException pue) {
+            return null;
+        } catch (Exception e) {
+            return null;
+        }
+    }
+
     @Override
     public void handleRequest(HttpServerExchange exchange) throws Exception {
         ServletRequest request = exchange.getAttachment(HttpServletRequestImpl.ATTACHMENT_KEY);
@@ -73,10 +108,12 @@
             request.setAttribute(""javax.servlet.request.cipher_suite"", ssl.getCipherSuite());
             request.setAttribute(""javax.servlet.request.key_size"", getKeyLenght(ssl.getCipherSuite()));
             request.setAttribute(""javax.servlet.request.ssl_session_id"", ssl.getId());
-            if (ssl.getPeerCertificateChain() != null) {
-                request.setAttribute(""javax.servlet.request.X509Certificate"", ssl.getPeerCertificateChain());
+            X509Certificate[] certs = getCerts(ssl);
+            if (certs != null) {
+                request.setAttribute(""javax.servlet.request.X509Certificate"", certs);
             }
         }
         HttpHandlers.executeHandler(next, exchange);
     }
+
 }",0
use Set instead of List in OnViewChangedNotifier,"  */
 package org.androidannotations.api.view;
 
-import java.util.LinkedList;
-import java.util.List;
+import java.util.LinkedHashSet;
+import java.util.Set;
 
 public class OnViewChangedNotifier {
 
@@ -34,7 +34,7 @@
 		}
 	}
 
-	private final List<OnViewChangedListener> listeners = new LinkedList<OnViewChangedListener>();
+	private final Set<OnViewChangedListener> listeners = new LinkedHashSet<OnViewChangedListener>();
 
 	public void notifyViewChanged(HasViews hasViews) {
 		for (OnViewChangedListener listener : listeners) {",0
Fix NPE on cleanup,"  */
 package com.squareup.leakcanary;
 
+import android.util.Log;
 import java.io.File;
 import java.io.FileFilter;
 import java.util.ArrayList;
@@ -57,6 +58,7 @@
 public final class HeapAnalyzer {
 
   private static final String ANONYMOUS_CLASS_NAME_PATTERN = ""^.+\\$\\d+$"";
+  private static final String TAG = ""HeapAnalyzer"";
 
   private final ExcludedRefs baseExcludedRefs;
   private final ExcludedRefs excludedRefs;
@@ -337,9 +339,13 @@
             .equals(heapDumpFileName);
       }
     });
+    if (toRemove != null) {
     for (File file : toRemove) {
       file.delete();
     }
+    } else {
+      Log.d(TAG, ""Could not find HAHA files to cleanup."");
+    }
   }
 
   private long since(long analysisStartNanoTime) {",0
Fix #465," 			System.out.println( ""process("" + socketBuffer.remaining() + ""): {"" + ( socketBuffer.remaining() > 1000 ? ""too big to display"" : new String( socketBuffer.array(), socketBuffer.position(), socketBuffer.remaining() ) ) + ""}"" );
 
 		if( readystate != READYSTATE.NOT_YET_CONNECTED ) {
+			if ( readystate == READYSTATE.OPEN ) {
 			decodeFrames( socketBuffer );
+			}
 		} else {
 			if( decodeHandshake( socketBuffer ) ) {
 				assert ( tmpHandshakeBytes.hasRemaining() != socketBuffer.hasRemaining() || !socketBuffer.hasRemaining() ); // the buffers will never have remaining bytes at the same time",0
Fixed S3 lock prefix issue,"             printHelp(options);
             return null;
         }
-        return new S3ConfigArguments(parts[0].trim(), parts[1].trim(), prefix, new S3ConfigAutoManageLockArguments(prefix + ""_lock_""));
+        return new S3ConfigArguments(parts[0].trim(), parts[1].trim(), prefix, new S3ConfigAutoManageLockArguments(prefix + ""-lock-""));
     }
 
     public ExhibitorMain(BackupProvider backupProvider, ConfigProvider configProvider, ExhibitorArguments arguments, int httpPort) throws Exception",0
Fix IllegalArgumentException in onRestoreInstanceState,"             this.selectedPosition = positionSavedState.getSelectedPosition();
             this.selectingPosition = positionSavedState.getSelectingPosition();
             this.lastSelectedPosition = positionSavedState.getLastSelectedPosition();
-        }
-
+            super.onRestoreInstanceState(positionSavedState.getSuperState());
+        } else {
         super.onRestoreInstanceState(state);
     }
+    }
 
     @SuppressWarnings(""UnnecessaryLocalVariable"")
     @Override",0
Fixed not closed Reader in OSGi module,"                 while ((line = reader.readLine()) != null) {
                     factoryCandidates.add(line.trim());
                 }
+                reader.close();
             }
         }
         //add java built in JavaScript ScriptEngineFactory's",0
Exit on fatal init errors when running with GUI,"                     View.getSingleton().hideSplashScreen();
 
                     logger.fatal(""Failed to initialise GUI: "", e);
-                    return;
+
+                    // We must exit otherwise EDT would keep ZAP running.
+                    System.exit(1);
                 }
 
                 warnAddOnsAndExtensionsNoLongerRunnable();",0
Fix initializing of project types with attributes inherited from its ancestors,"       myType.addAncestor(superTypeId);
 
       ProjectTypeDef supertype = validatedData.get(superTypeId);
-      for (Attribute attr : supertype.getAttributes()) {
+      for (Attribute supertypeAttr : supertype.getAttributes()) {
         // check attribute names
-        for (Attribute attr2 : myType.getAttributes()) {
-          if (attr.getName().equals(attr2.getName())
-              && !attr.getProjectType().equals(attr2.getProjectType())) {
+        for (Attribute attr : myType.getAttributes()) {
+          if (supertypeAttr.getName().equals(attr.getName())) {
+
+            ProjectTypeDef attrOriginProjectType = validatedData.get(attr.getProjectType());
+            // myType can't add attribute with the same name as one of its ancestors already has
+            if (attrOriginProjectType.getId().equals(myType.id)
+                // check whether the attribute isn't inherited from an ancestor PT
+                || !attrOriginProjectType.isTypeOf(supertypeAttr.getProjectType())) {
             throw new ProjectTypeConstraintException(
                 ""Attribute name conflict. Project type ""
                     + myType.getId()
@@ -265,7 +270,8 @@
                     + "" is duplicated in its ancestor(s)."");
           }
         }
-        myType.addAttributeDefinition(attr);
+        }
+        myType.addAttributeDefinition(supertypeAttr);
       }
       initRecursively(myType, superTypeId);
     }
@@ -286,7 +292,7 @@
       myType.attributes.put(
           old.getName(),
           new Variable(
-              old.getId(),
+              myType.getId(),
               old.getName(),
               old.getDescription(),
               old.isRequired(),",0
fixed #952 fixed,"             ""		EXA_ALL_CONSTRAINT_COLUMNS cc\r\n"" +
             ""	on\r\n"" +
             ""		c.table_name = cc.constraint_table and\r\n"" +
+            ""       c.table_schem = cc.constraint_schema and\r\n "" + 
             ""		cc.constraint_type = 'PRIMARY KEY' and\r\n"" +
             ""		cc.COLUMN_NAME = c.COLUMN_NAME\r\n"" +
             ""where\r\n"" +
@@ -109,6 +110,7 @@
         ""		EXA_ALL_CONSTRAINT_COLUMNS cc\r\n"" +
         ""	on\r\n"" +
         ""		c.table_name = cc.constraint_table and\r\n"" +
+        ""       c.table_schem = cc.constraint_schema and\r\n "" + 
         ""		cc.constraint_type = 'PRIMARY KEY' and\r\n"" +
         ""		cc.COLUMN_NAME = c.COLUMN_NAME\r\n"" +
         ""where\r\n"" +
@@ -157,7 +159,6 @@
     @Override
     protected ExasolTable fetchObject(@NotNull JDBCSession session, @NotNull ExasolSchema owner, @NotNull JDBCResultSet resultSet)
         throws SQLException, DBException {
-        // TODO Auto-generated method stub
         return new ExasolTable(session.getProgressMonitor(), owner, resultSet);
     }
 ",0
BUG: formatLabel is using the same NumberFormat for X and Y labels," 	private final View viewVerLabels;
 	private ScaleGestureDetector scaleDetector;
 	private boolean scalable;
-	private NumberFormat numberformatter;
+	private NumberFormat[] numberformatter = new NumberFormat[2];
 	private final List<GraphViewSeries> graphSeries;
 	private boolean showLegend = false;
 	private float legendWidth = 120;
@@ -399,23 +399,24 @@
 	 * @return value to display
 	 */
 	protected String formatLabel(double value, boolean isValueX) {
-		if (numberformatter == null) {
-			numberformatter = NumberFormat.getNumberInstance();
-			double highestvalue = getMaxY();
-			double lowestvalue = getMinY();
+		int i = isValueX ? 1 : 0;
+		if (numberformatter[i] == null) {
+			numberformatter[i] = NumberFormat.getNumberInstance();
+			double highestvalue = isValueX ? getMaxX(false) : getMaxY();
+			double lowestvalue = isValueX ? getMinX(false) : getMinY();
 			if (highestvalue - lowestvalue < 0.1) {
-				numberformatter.setMaximumFractionDigits(6);
+				numberformatter[i].setMaximumFractionDigits(6);
 			} else if (highestvalue - lowestvalue < 1) {
-				numberformatter.setMaximumFractionDigits(4);
+				numberformatter[i].setMaximumFractionDigits(4);
 			} else if (highestvalue - lowestvalue < 20) {
-				numberformatter.setMaximumFractionDigits(3);
+				numberformatter[i].setMaximumFractionDigits(3);
 			} else if (highestvalue - lowestvalue < 100) {
-				numberformatter.setMaximumFractionDigits(1);
+				numberformatter[i].setMaximumFractionDigits(1);
 			} else {
-				numberformatter.setMaximumFractionDigits(0);
+				numberformatter[i].setMaximumFractionDigits(0);
 			}
 		}
-		return numberformatter.format(value);
+		return numberformatter[i].format(value);
 	}
 
 	private String[] generateHorlabels(float graphwidth) {",0
Fixes issue #543 for mChildren in RajawaliRender. ," 
 		mCamera.updateFrustum(mPMatrix,mVMatrix); //update frustum plane
 
-		for (int i = 0, j = mChildren.size(); i < j; i++)
+		for (int i = 0; i < mChildren.size(); i++)
 			mChildren.get(i).render(mCamera, mPMatrix, mVMatrix, pickerInfo);
 
 		if (pickerInfo != null) {
@@ -270,7 +270,7 @@
 	}
 
 	private void reloadChildren() {
-		for (int i = 0, j = mChildren.size(); i < j; i++)
+		for (int i = 0; i < mChildren.size(); i++)
 			mChildren.get(i).reload();
 	}
 
@@ -288,7 +288,7 @@
 
 	protected void destroyScene() {
 		mSceneInitialized = false;
-		for (int i = 0, j = mChildren.size(); i < j; i++)
+		for (int i = 0; i < mChildren.size(); i++)
 			mChildren.get(i).destroy();
 		mChildren.clear();
 		for (int i = 0, j = mPlugins.size(); i < j; i++)
@@ -523,7 +523,7 @@
 
 	public void accept(INodeVisitor visitor) {
 		visitor.apply(this);
-		for (int i = 0, j = mChildren.size(); i < j; i++)
+		for (int i = 0; i < mChildren.size(); i++)
 			mChildren.get(i).accept(visitor);
 	}	
 
@@ -610,7 +610,7 @@
 
 	public int getNumTriangles() {
 		int triangleCount = 0;
-		for (int i=0,j=mChildren.size();i<j;i++) {
+		for (int i = 0; i < mChildren.size(); i++) {
 			if (mChildren.get(i).getGeometry() != null && mChildren.get(i).getGeometry().getVertices() != null && mChildren.get(i).isVisible())
 				triangleCount += mChildren.get(i).getGeometry().getVertices().limit() / 9;
 		}",0
Log at debug level time used in prepare steps,"                 preparation.distribute();
                 preparation.reloadDeployFileDistributor();
             }
+            log.log(LogLevel.DEBUG, () -> ""time used "" + params.getTimeoutBudget().timesUsed() +
+                    "" : "" + params.getApplicationId());
             return preparation.result();
         } catch (OutOfCapacityException e) {
             throw e;",0
Fix casMustChangePassView missing state.,"             } else {
                 createViewState(flow, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED);
                 createViewState(flow, CasWebflowConstants.VIEW_ID_EXPIRED_PASSWORD, CasWebflowConstants.VIEW_ID_EXPIRED_PASSWORD);
+                createViewState(flow, CasWebflowConstants.VIEW_ID_MUST_CHANGE_PASSWORD, CasWebflowConstants.VIEW_ID_MUST_CHANGE_PASSWORD);
             }
         }
     }",0
修复explain insert 执行的bug,"  */
 package io.mycat.server.sqlhandler;
 
+import com.alibaba.druid.sql.ast.SQLExpr;
+import com.alibaba.druid.sql.dialect.mysql.ast.statement.MySqlInsertStatement;
+import com.alibaba.druid.sql.dialect.mysql.parser.MySqlStatementParser;
+import com.alibaba.druid.sql.parser.SQLStatementParser;
 import io.mycat.MycatServer;
 import io.mycat.net.BufferArray;
 import io.mycat.net.NetSystem;
@@ -32,6 +36,7 @@
 import io.mycat.server.Fields;
 import io.mycat.server.MySQLFrontConnection;
 import io.mycat.server.config.node.SchemaConfig;
+import io.mycat.server.config.node.TableConfig;
 import io.mycat.server.packet.EOFPacket;
 import io.mycat.server.packet.FieldPacket;
 import io.mycat.server.packet.ResultSetHeaderPacket;
@@ -42,11 +47,14 @@
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import java.util.List;
+import java.util.regex.Pattern;
+
 /**
  * @author mycat
  */
 public class ExplainHandler {
-
+    private final static Pattern pattern = Pattern.compile(""(?:(\\s*next\\s+value\\s+for\\s*MYCATSEQ_(\\w+))(,|\\)|\\s)*)+"", Pattern.CASE_INSENSITIVE);
 	private static final Logger logger = LoggerFactory.getLogger(ExplainHandler.class);
 	private static final RouteResultsetNode[] EMPTY_ARRAY = new RouteResultsetNode[0];
 	private static final int FIELD_COUNT = 2;
@@ -124,6 +132,11 @@
 		}
 		try {
 			int sqlType = ServerParse.parse(stmt) & 0xff;
+            if(ServerParse.INSERT==sqlType&&isMycatSeq(stmt, schema))
+            {
+                c.writeErrMessage(ErrorCode.ER_PARSE_ERROR, ""insert sql using mycat seq,you must provide primaryKey value for explain"");
+                return null;
+            }
 			return MycatServer
 					.getInstance()
 					.getRouterservice()
@@ -138,5 +151,33 @@
 			return null;
 		}
 	}
+    private static boolean isMycatSeq(String stmt, SchemaConfig schema)
+    {
+        if(pattern.matcher(stmt).find())  return true;
+        SQLStatementParser parser =new MySqlStatementParser(stmt);
+        MySqlInsertStatement statement = (MySqlInsertStatement) parser.parseStatement();
+        String tableName=   statement.getTableName().getSimpleName();
+        TableConfig tableConfig= schema.getTables().get(tableName.toUpperCase());
+        if(tableConfig==null) return false;
+        if(tableConfig.isAutoIncrement())
+        {
+            boolean isHasIdInSql=false;
+            String primaryKey = tableConfig.getPrimaryKey();
+            List<SQLExpr> columns = statement.getColumns();
+            for (SQLExpr column : columns)
+            {
+                String columnName = column.toString();
+                if(primaryKey.equalsIgnoreCase(columnName))
+                {
+                    isHasIdInSql = true;
+                    break;
+                }
+            }
+            if(!isHasIdInSql) return true;
+        }
+
+
+        return false;
+    }
 
 }
\ No newline at end of file",0
[UNDERTOW-1142] fix of two minor typos in log messages,"     @Message(id = 38, value = ""Authentication failed, requested user name '%s'"")
     String authenticationFailed(final String userName);
 
-    @Message(id = 39, value = ""To many query parameters, cannot have more than %s query parameters"")
+    @Message(id = 39, value = ""Too many query parameters, cannot have more than %s query parameters"")
     BadRequestException tooManyQueryParameters(int noParams);
 
-    @Message(id = 40, value = ""To many headers, cannot have more than %s header"")
+    @Message(id = 40, value = ""Too many headers, cannot have more than %s header"")
     String tooManyHeaders(int noParams);
 
     @Message(id = 41, value = ""Channel is closed"")",0
Fix faulty channel name checking,"      */
     public EnumMap<Side,FMLEmbeddedChannel> newChannel(String name, ChannelHandler... handlers)
     {
-        if (channels.containsKey(name) || name.startsWith(""MC|"") || name.startsWith(""\u0001"") || name.startsWith(""FML""))
+        if (channels.get(Side.CLIENT).containsKey(name) || channels.get(Side.SERVER).containsKey(name) || name.startsWith(""MC|"") || name.startsWith(""\u0001"") || name.startsWith(""FML""))
         {
             throw new RuntimeException(""That channel is already registered"");
         }
@@ -187,7 +187,7 @@
      */
     public EnumMap<Side,FMLEmbeddedChannel> newChannel(ModContainer container, String name, ChannelHandler... handlers)
     {
-        if (channels.containsKey(name) || name.startsWith(""MC|"") || name.startsWith(""\u0001"") || (name.startsWith(""FML"") && !(""FML"".equals(container.getModId()))))
+        if (channels.get(Side.CLIENT).containsKey(name) || channels.get(Side.SERVER).containsKey(name) || name.startsWith(""MC|"") || name.startsWith(""\u0001"") || (name.startsWith(""FML"") && !(""FML"".equals(container.getModId()))))
         {
             throw new RuntimeException(""That channel is already registered"");
         }",0
fix leak with webview,"     @SuppressLint(""SetJavaScriptEnabled"")
     private void setUpWebView(int margin) {
         LinearLayout webViewContainer = new LinearLayout(getContext());
-        webView = new WebView(getContext()) {
+        webView = new WebView(getContext().getApplicationContext()) {
             /* Prevent NPE on Motorola 2.2 devices
              * See https://groups.google.com/forum/?fromgroups=#!topic/android-developers/ktbwY2gtLKQ
              */",0
Fix setImage,"         }
         
         Bitmap roundBitmap = ImageUtils.getCircleBitmap(bitmap, widthPX, heightPX);
+        image.setVisibility(View.VISIBLE);
         image.setImageBitmap(roundBitmap);
         
         invalidate();",0
Fixes all chat windows being closed...,"         }
         else
         {
+            if(ConfigurationUtils.isMultiChatWindowEnabled())
+            {
             GuiActivator
                 .getUIService().getChatWindowManager().closeAllChats(this, true);
         }
+            else
+            {
+                ChatPanel chatPanel = getCurrentChat();
+    
+                if(chatPanel == null
+                    || chatPanel.getChatConversationPanel() == null)
+                    return;
+                
+                GuiActivator
+                    .getUIService().getChatWindowManager().closeChat(chatPanel);
+            }
+        }
     }
 
     /**",0
Fixing focus issue," 				direction);
 		if (nextFocused != null && nextFocused != currentFocused) {
 			if (direction == View.FOCUS_LEFT) {
-				// If there is nothing to the left, or this is causing us to
-				// jump to the right, then what we really want to do is page left.
-				if (currentFocused != null && nextFocused.getLeft() >= currentFocused.getLeft()) {
-					handled = pageLeft();
-				} else {
 					handled = nextFocused.requestFocus();
-				}
 			} else if (direction == View.FOCUS_RIGHT) {
 				// If there is nothing to the right, or this is causing us to
 				// jump to the left, then what we really want to do is page right.",0
Fix of loading OrientDB in JBOSS env by avoiding direct use of com.sun package," import com.orientechnologies.orient.core.index.hashindex.local.cache.ODiskCache;
 import com.orientechnologies.orient.core.storage.OStorage;
 import com.orientechnologies.orient.core.storage.impl.local.paginated.OLocalPaginatedStorage;
-import com.sun.management.OperatingSystemMXBean;
 
 import java.io.PrintStream;
 import java.lang.management.ManagementFactory;
@@ -40,17 +39,11 @@
 import java.util.TimerTask;
 import java.util.concurrent.ConcurrentHashMap;
 
+import javax.management.MBeanServer;
+import javax.management.ObjectName;
+
 public abstract class OAbstractProfiler extends OSharedResourceAbstract implements OProfilerMBean {
 
-  protected static OperatingSystemMXBean                 osMgmtBean    = null;
-
-  static {
-    try {
-      osMgmtBean = (com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
-    } catch (Exception e) {
-      osMgmtBean = null;
-    }
-  }
   protected final Map<String, OProfilerHookValue>        hooks         = new ConcurrentHashMap<String, OProfilerHookValue>();
   protected final ConcurrentHashMap<String, String>      dictionary    = new ConcurrentHashMap<String, String>();
   protected final ConcurrentHashMap<String, METRIC_TYPE> types         = new ConcurrentHashMap<String, METRIC_TYPE>();
@@ -85,23 +78,31 @@
         stgs++;
       }
     }
-
-    if (osMgmtBean != null) {
-      final long osTotalMem = osMgmtBean.getTotalPhysicalMemorySize();
-      final long osUsedMem = osTotalMem - osMgmtBean.getFreePhysicalMemorySize();
+    try
+	{
+		MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();
+		ObjectName osMBeanName = ObjectName.getInstance(ManagementFactory.OPERATING_SYSTEM_MXBEAN_NAME);
+		if(mbs.isInstanceOf(osMBeanName, ""com.sun.management.OperatingSystemMXBean""))
+		{
+		  final long osTotalMem = ((Number)mbs.getAttribute(osMBeanName, ""TotalPhysicalMemorySize"")).longValue();
+		  final long osUsedMem = ((Number)mbs.getAttribute(osMBeanName, ""FreePhysicalMemorySize"")).longValue();
 
       out.printf(""OrientDB Memory profiler: Heap=%s of %s - DiskCache (%s dbs)=%s of %s - OS=%s of %s\n"",
           OFileUtils.getSizeAsString(runtime.totalMemory() - runtime.freeMemory()),
           OFileUtils.getSizeAsString(runtime.maxMemory()), stgs, OFileUtils.getSizeAsString(diskCacheUsed),
           OFileUtils.getSizeAsString(diskCacheTotal), OFileUtils.getSizeAsString(osUsedMem), OFileUtils.getSizeAsString(osTotalMem));
+		  return;
+		}
+	} catch (Exception e)
+	{
+		// Nothing to do. Proceed with default output
+	} 
 
-    } else {
       out.printf(""OrientDB Memory profiler: Heap=%s of %s - DiskCache (%s dbs)=%s of %s\n"",
           OFileUtils.getSizeAsString(runtime.totalMemory() - runtime.freeMemory()),
           OFileUtils.getSizeAsString(runtime.maxMemory()), stgs, OFileUtils.getSizeAsString(diskCacheUsed),
           OFileUtils.getSizeAsString(diskCacheTotal));
     }
-  }
 
   public void shutdown() {
     stopRecording();",0
Bugfix for crouton.cancel()," import android.os.Handler;
 import android.os.Message;
 import android.support.v4.view.accessibility.AccessibilityEventCompat;
-import android.util.Log;
 import android.view.View;
 import android.view.ViewGroup;
 import android.view.ViewParent;",0
fixing tiny bugs,"         try {
           finder = (Finder) typeFinder.newInstance();
           findersByType.put(type, finder);
-          return finder;
         } catch (InstantiationException e) {
           throw new RuntimeException(""Unable to instantiate generated finder instance."", e);
         } catch (IllegalAccessException e) {
           throw new RuntimeException(""Unable to instantiate generated finder instance."", e);
         }
+      } else {
+        finder = fallbackFinder;
       }
     }
-    return fallbackFinder;
+    return finder;
   }
 
   @Override public void register(Object object) {
@@ -224,8 +225,8 @@
       Subscriber original = subscribers.remove(subscriber);
       if (original != null) {
         original.invalidate();
-        return;
       }
+      return;
     }
     throw new IllegalArgumentException(
         ""Missing subscriber for an annotated method. Is "" + type + "" registered?"");",0
Fixed problem in starting ZK server for standalone mode,"  */
 @Aspect
 public class ZooKeeperServerAspect {
+    private static boolean metricsRegistered = false;
+
     @Pointcut(""execution(org.apache.zookeeper.server.ZooKeeperServer.new(..))"")
-    public void processRequest() {
+    public void zkServerConstructorPointCut() {
     }
 
-    @After(""processRequest()"")
-    public void timedProcessRequest(JoinPoint joinPoint) throws Throwable {
+    @After(""zkServerConstructorPointCut()"")
+    public void zkServerConstructor(JoinPoint joinPoint) throws Throwable {
         // ZooKeeperServer instance was created
         ZooKeeperServer zkServer = (ZooKeeperServer) joinPoint.getThis();
 
+        synchronized (ZooKeeperServerAspect.class) {
+            if (metricsRegistered) {
+                // We can only register the metrics a single time for the process
+                return;
+            }
+
+            metricsRegistered = true;
+        }
+
         Gauge.build().name(""zookeeper_server_znode_count"").help(""Number of z-nodes stored"").create()
                 .setChild(new Gauge.Child() {
                     @Override
@@ -80,5 +91,4 @@
                     }
                 }).register();
     }
-
 }",0
Fix Assembly failures," import water.rapids.ast.AstParameter;
 import water.rapids.ast.AstRoot;
 import water.rapids.ast.params.AstId;
+import water.rapids.ast.prims.mungers.AstColPySlice;
+
+import java.util.Arrays;
+import java.util.LinkedList;
+import java.util.Queue;
 
 public class H2OColOp extends Transform<H2OColOp> {
+
+  private static final String FRAME_ID_PLACEHOLDER = ""dummy"";
+
   protected final String _fun;
   private final String _oldCol;
   private String[] _newCol;
@@ -20,7 +28,7 @@
   public H2OColOp(String name, String ast, boolean inplace, String[] newNames) { // (op (cols fr cols) {extra_args})
     super(name,ast,inplace,newNames);
     _fun = _ast._asts[0].str();
-    _oldCol = ((AstExec)_ast._asts[1])._asts[2].str();
+    _oldCol = findOldName((AstExec)_ast._asts[1]);
     setupParams();
   }
 
@@ -38,7 +46,8 @@
 
   @Override public Transform<H2OColOp> fit(Frame f) { return this; }
   @Override protected Frame transformImpl(Frame f) {
-    ((AstExec)_ast._asts[1])._asts[1] = new AstId(f);
+    substitutePlaceholders(_ast, f);
+
     Session ses = new Session();
     Frame fr = ses.exec(_ast, null).getFrame();
     _newCol = _newNames==null?new String[fr.numCols()]:_newNames;
@@ -58,10 +67,52 @@
     return f;
   }
 
+  private void substitutePlaceholders(AstExec root, Frame f) {
+    Queue<AstExec> execs = new LinkedList<>();
+    execs.add(root);
+    while (! execs.isEmpty()) {
+      AstExec exec = execs.poll();
+      for (int i = 1; i < exec._asts.length; i++) {
+        AstRoot<?> ast = exec._asts[i];
+        if (ast instanceof AstExec)
+          execs.add((AstExec) ast);
+        else if (ast instanceof AstId) {
+          AstId id = (AstId) ast;
+          if (FRAME_ID_PLACEHOLDER.equals(id.str()))
+            exec._asts[i] = new AstId(f);
+        }
+      }
+    }
+  }
+
+  private static String findOldName(AstExec root) {
+    AstColPySlice py = new AstColPySlice();
+    Queue<AstExec> execs = new LinkedList<>();
+    execs.add(root);
+    String oldName = null;
+    while (! execs.isEmpty()) {
+      AstExec exec = execs.poll();
+      // (cols_py dummy <oldName>)
+      if (exec._asts.length == 3 && py.str().equals(exec._asts[0].str()) && FRAME_ID_PLACEHOLDER.equals(exec._asts[1].str())) {
+        oldName = exec._asts[2].str();
+        break;
+      }
+      for (int i = 1; i < exec._asts.length; i++) {
+        AstRoot<?> ast = exec._asts[i];
+        if (ast instanceof AstExec)
+          execs.add((AstExec) ast);
+      }
+    }
+    return oldName;
+  }
+
   @Override Frame inverseTransform(Frame f) { throw H2O.unimpl(); }
 
   @Override public String genClassImpl() {
-    String typeCast = _inTypes[ArrayUtils.indexOf(_inNames, _oldCol)].equals(""Numeric"")?""Double"":""String"";
+    final int typeId = ArrayUtils.indexOf(_inNames, _oldCol);
+    if (typeId < 0)
+      throw new IllegalStateException(""Unknown column "" + _oldCol + "" (known: "" + Arrays.toString(_inNames));
+    String typeCast = _inTypes[typeId].equals(""Numeric"")?""Double"":""String"";
 
     if( _multiColReturn ) {
       StringBuilder sb = new StringBuilder(",0
fix Nullpointer Exception when using -l jsp,"     	configuration.setSuppressMarker(params.getSuppressmarker());
     	configuration.setThreads(params.getThreads()); 
     	for ( LanguageVersion language : LanguageVersion.findVersionsForLanguageTerseName( params.getLanguage() ) ) {
-        	configuration.getLanguageVersionDiscoverer().setDefaultLanguageVersion(language.getLanguage().getVersion(params.getVersion()));    		
+        	LanguageVersion languageVersion = language.getLanguage().getVersion(params.getVersion());
+        	if (languageVersion == null) {
+            		languageVersion = language.getLanguage().getDefaultVersion();
+        	}
+        	configuration.getLanguageVersionDiscoverer().setDefaultLanguageVersion(languageVersion);
     	}
         try {
             configuration.prependClasspath(params.getAuxclasspath());",0
Use Path instead of string to check file exclusions to fix windows-on…," import java.io.Reader;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
+import java.nio.file.Path;
 import java.util.Arrays;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -277,7 +278,7 @@
         }
 
         final FilenameFilter languageFilter = language.getFileFilter();
-        final Set<String> exclusions = new HashSet<String>();
+        final Set<Path> exclusions = new HashSet<Path>();
 
         if (excludes != null) {
             FileFinder finder = new FileFinder();
@@ -285,10 +286,10 @@
                 if (excludedFile.isDirectory()) {
                     List<File> files = finder.findFilesFrom(excludedFile, languageFilter, true);
                     for (File f : files) {
-                        exclusions.add(f.getAbsolutePath());
+                        exclusions.add(f.toPath());
                     }
                 } else {
-                    exclusions.add(excludedFile.getAbsolutePath());
+                    exclusions.add(excludedFile.toPath());
                 }
             }
         }
@@ -296,7 +297,7 @@
         FilenameFilter filter = new FilenameFilter() {
             public boolean accept(File dir, String name) {
                 File f = new File(dir, name);
-                if (exclusions.contains(f.getAbsolutePath())) {
+                if (exclusions.contains(f.toPath())) {
                     System.err.println(""Excluding "" + f.getAbsolutePath());
                     return false;
                 }",0
fix FilterQuery constructor,"         this.count = count;
         this.follow = follow;
         this.track = track;
+        this.locations = locations;
         this.language = language;
     }
 ",0
Fix: Bottom Nav Icons disappear when getting a CodePush (Android),"     }
 
     private Drawable loadFile(String uri) {
-        Bitmap bitmap = BitmapFactory.decodeFile(uri);
+        Bitmap bitmap = BitmapFactory.decodeFile(Uri.parse(uri).getPath());
         return new BitmapDrawable(NavigationApplication.instance.getResources(), bitmap);
     }
 ",0
Long have to be compared using equals,"                 FulfillmentGroup fg = orderItem.getOrder().getFulfillmentGroups().get(0);
                 if (fg.getAddress() == null && fg.getFulfillmentOption() == null) {
                     for (FulfillmentGroupItem fgItem : fg.getFulfillmentGroupItems()) {
-                        if (fgItem.getOrderItem().getId() == orderItemId) {
+                        if (fgItem.getOrderItem().getId().equals(orderItemId)) {
                             qty += fgItem.getQuantity();
                         }
                     }",0
Fix IndexOutOfBoundsException," 
 
   public List<Photo> getCurrentPhotos() {
+    if (photoDirectories.size() >= currentDirectoryIndex) {
+      currentDirectoryIndex = photoDirectories.size() - 1;
+    }
     return photoDirectories.get(currentDirectoryIndex).getPhotos();
   }
 ",0
解决分享后删除按钮失灵的bug,"             }
             mActionButton.setVisibility(VISIBLE);
             mActionButton.setText(R.string.block_canary_delete);
+        }
             mActionButton.setOnClickListener(new View.OnClickListener() {
                 @Override
                 public void onClick(View v) {
@@ -307,7 +308,6 @@
                     }
                 }
             });
-        }
         adapter.update(blockInfo);
         setTitle(getString(R.string.block_canary_class_has_blocked, blockInfo.timeCost));
     }",0
fix #511," 	/**
 	 * consul block 查询时 block的最长时间,单位，分钟
 	 */
-	public static int CONSUL_BLOCK_TIME_MINUTES = 10;
+	public static int CONSUL_BLOCK_TIME_MINUTES = 9;
 	
 	/**
 	 * consul block 查询时 block的最长时间,单位，秒",0
fix 线程不断创建OOM," 		if (null != pruneTimer) {
 			shutdownNow();
 		}
-		this.pruneTimer = new ScheduledThreadPoolExecutor(Integer.MAX_VALUE, new ThreadFactory() {
+		this.pruneTimer = new ScheduledThreadPoolExecutor(16, new ThreadFactory() {
 			@Override
 			public Thread newThread(Runnable r) {
 				return ThreadUtil.newThread(r, StrUtil.format(""Pure-Timer-{}"", cacheTaskNumber.getAndIncrement()));",0
Use built in parameters of the establishThinRequestContext to ignore sandbox changes when getting theme," 
         if (brc.getNonPersistentSite() == null) {
             brc.setNonPersistentSite(siteResolver.resolveSite(wr, true));
+            if (includeSandBox) {
             brc.setSandBox(sbResolver.resolveSandBox(wr, brc.getNonPersistentSite()));
+            }
             brc.setDeployBehavior(deployBehaviorUtil.isProductionSandBoxMode() ? DeployBehavior.CLONE_PARENT : DeployBehavior.OVERWRITE_PARENT);
         }
 ",0
fix typo in EventHandler comment,"      * processed without having to wait for any new event to arrive.  This can be useful for event handlers that need
      * to do slower operations like I/O as they can group together the data from multiple events into a single
      * operation.  Implementations should ensure that the operation is always performed when endOfBatch is true as
-     * the time between that message an the next one is inderminate.
+     * the time between that message and the next one is indeterminate.
      *
      * @param event      published to the {@link RingBuffer}
      * @param sequence   of the event being processed",0
2.x: Avoid potential NPE when onError throws.,"             }
         } catch (Throwable e) {
             Exceptions.throwIfFatal(e);
+            if (t2 == null) {
+                t2 = new CompositeException(t, e);
+            } else {
             t2.suppress(e);
-            
+            }
             RxJavaPlugins.onError(t2);
         }
     }",0
Fix unused variable.,"     for (int i = 0; i < listSize; i++) {
       HlsUrl url = urls.get(i);
       MediaPlaylistBundle bundle = new MediaPlaylistBundle(url, currentTimeMs);
-      playlistBundles.put(urls.get(i), bundle);
+      playlistBundles.put(url, bundle);
     }
   }
 ",0
fix import," import io.mycat.util.FormatUtil;
 
 import java.io.Serializable;
-import java.util.HashMap;
-import java.util.LinkedHashMap;
-import java.util.Map;
-import java.util.Set;
+import java.util.*;
 
 /**
  * @author mycat",0
fixing auto configs to use names instead of .class references,"  */
 package org.activiti.spring.boot;
 
-import java.io.IOException;
-import java.util.Collections;
-import java.util.HashSet;
-import java.util.List;
-import java.util.Optional;
-import javax.sql.DataSource;
-
 import org.activiti.api.process.model.events.ProcessDeployedEvent;
 import org.activiti.api.process.runtime.events.listener.ProcessRuntimeEventListener;
-import org.activiti.engine.cfg.ProcessEngineConfigurator;
-import org.activiti.engine.impl.persistence.StrongUuidGenerator;
 import org.activiti.api.runtime.shared.identity.UserGroupManager;
 import org.activiti.engine.RepositoryService;
+import org.activiti.engine.cfg.ProcessEngineConfigurator;
+import org.activiti.engine.impl.persistence.StrongUuidGenerator;
 import org.activiti.runtime.api.model.impl.APIProcessDefinitionConverter;
 import org.activiti.spring.ProcessDeployedEventProducer;
 import org.activiti.spring.SpringAsyncExecutor;
@@ -36,8 +29,6 @@
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.boot.autoconfigure.AutoConfigureAfter;
 import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
-import org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
-import org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration;
 import org.springframework.boot.context.properties.EnableConfigurationProperties;
 import org.springframework.context.annotation.Bean;
 import org.springframework.context.annotation.Configuration;
@@ -45,8 +36,16 @@
 import org.springframework.core.io.support.ResourcePatternResolver;
 import org.springframework.transaction.PlatformTransactionManager;
 
+import javax.sql.DataSource;
+import java.io.IOException;
+import java.util.Collections;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Optional;
+
 @Configuration
-@AutoConfigureAfter({DataSourceAutoConfiguration.class, TaskExecutionAutoConfiguration.class})
+@AutoConfigureAfter(name = {""org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration"",
+        ""org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration""})
 @EnableConfigurationProperties(ActivitiProperties.class)
 public class ProcessEngineAutoConfiguration extends AbstractProcessEngineAutoConfiguration {
 ",0
Fix Possibly #4202 in distributed mode,"   private void convertToSbTree() {
     final ODatabaseDocumentInternal db = ODatabaseRecordThreadLocal.INSTANCE.get();
     final OIndexRIDContainerSBTree tree = new OIndexRIDContainerSBTree(fileId, durableNonTxMode,
-        (OAbstractPaginatedStorage) db.getStorage());
+        (OAbstractPaginatedStorage) db.getStorage().getUnderlying());
 
     tree.addAll(underlying);
 ",0
[#1034] Change ConditionalOnMissingBean annotation," package org.axonframework.springboot.autoconfig;
 
 import com.fasterxml.jackson.databind.ObjectMapper;
-import org.axonframework.axonserver.connector.command.AxonServerCommandBus;
 import org.axonframework.commandhandling.CommandBus;
 import org.axonframework.commandhandling.SimpleCommandBus;
-import org.axonframework.commandhandling.distributed.DistributedCommandBus;
 import org.axonframework.commandhandling.gateway.CommandGateway;
 import org.axonframework.commandhandling.gateway.DefaultCommandGateway;
 import org.axonframework.common.transaction.TransactionManager;
 import org.axonframework.config.Configuration;
 import org.axonframework.config.EventProcessingConfigurer;
-import org.axonframework.eventhandling.*;
+import org.axonframework.eventhandling.EventBus;
+import org.axonframework.eventhandling.EventMessage;
+import org.axonframework.eventhandling.SimpleEventBus;
+import org.axonframework.eventhandling.TrackedEventMessage;
+import org.axonframework.eventhandling.TrackingEventProcessorConfiguration;
 import org.axonframework.eventhandling.async.SequencingPolicy;
 import org.axonframework.eventhandling.async.SequentialPerAggregatePolicy;
 import org.axonframework.eventsourcing.eventstore.EmbeddedEventStore;
@@ -53,8 +55,18 @@
 import org.axonframework.messaging.correlation.CorrelationDataProvider;
 import org.axonframework.messaging.correlation.MessageOriginProvider;
 import org.axonframework.messaging.interceptors.CorrelationDataInterceptor;
-import org.axonframework.queryhandling.*;
-import org.axonframework.serialization.*;
+import org.axonframework.queryhandling.DefaultQueryGateway;
+import org.axonframework.queryhandling.LoggingQueryInvocationErrorHandler;
+import org.axonframework.queryhandling.QueryBus;
+import org.axonframework.queryhandling.QueryGateway;
+import org.axonframework.queryhandling.QueryInvocationErrorHandler;
+import org.axonframework.queryhandling.QueryUpdateEmitter;
+import org.axonframework.queryhandling.SimpleQueryBus;
+import org.axonframework.serialization.AnnotationRevisionResolver;
+import org.axonframework.serialization.ChainingConverter;
+import org.axonframework.serialization.JavaSerializer;
+import org.axonframework.serialization.RevisionResolver;
+import org.axonframework.serialization.Serializer;
 import org.axonframework.serialization.json.JacksonSerializer;
 import org.axonframework.serialization.xml.XStreamSerializer;
 import org.axonframework.spring.config.AxonConfiguration;
@@ -225,7 +237,8 @@
                         .andBatchSize(v.getBatchSize())
                         .andInitialSegmentsCount(v.getInitialSegmentCount())
                         .andTokenClaimInterval(v.getTokenClaimInterval(), v.getTokenClaimIntervalTimeUnit());
-                Function<Configuration, StreamableMessageSource<TrackedEventMessage<?>>> messageSource = resolveMessageSource(applicationContext, v);
+                Function<Configuration, StreamableMessageSource<TrackedEventMessage<?>>> messageSource =
+                        resolveMessageSource(applicationContext, v);
                 eventProcessingConfigurer.registerTrackingEventProcessor(k, messageSource, c -> config);
             } else {
                 if (v.getSource() == null) {
@@ -262,7 +275,13 @@
         return sequencingPolicy;
     }
 
-    @ConditionalOnMissingBean(ignored = {DistributedCommandBus.class, AxonServerCommandBus.class}, value = CommandBus.class)
+    @ConditionalOnMissingBean(
+            ignoredType = {
+                    ""org.axonframework.commandhandling.distributed.DistributedCommandBus"",
+                    ""org.axonframework.axonserver.connector.command.AxonServerCommandBus""
+            },
+            value = CommandBus.class
+    )
     @Qualifier(""localSegment"")
     @Bean
     public SimpleCommandBus commandBus(TransactionManager txManager, AxonConfiguration axonConfiguration) {",0
SerDe micro fix,"         }
     }
 
-    public void putByGlobalType(long i, Number element) {
-        if (DataTypeUtil.getDtypeFromContext() == Type.INT || type == Type.INT) {
+    public void putByGlobalType(long i, Number element, Type globalType) {
+        if (globalType == Type.INT || type == Type.INT) {
             int anElement = element.intValue();
             put(i, anElement);
-        } else if (DataTypeUtil.getDtypeFromContext() == Type.FLOAT || DataTypeUtil.getDtypeFromContext() == Type.HALF) {
+        } else if (globalType == Type.FLOAT || globalType == Type.HALF) {
             float anElement = element.floatValue();
             put(i, anElement);
-        } else if (DataTypeUtil.getDtypeFromContext() == Type.DOUBLE) {
+        } else if (globalType == Type.DOUBLE) {
             double anElement = element.doubleValue();
             put(i, anElement);
-        } else if (DataTypeUtil.getDtypeFromContext() == Type.LONG) {
+        } else if (globalType == Type.LONG) {
             long anElement = element.longValue();
             put(i, anElement);
         }
@@ -1303,7 +1303,7 @@
             pointerIndexerByGlobalType(currentType);
 
             if (currentType != Type.COMPRESSED)
-                readContent(s, currentType);
+                readContent(s, currentType, DataTypeUtil.getDtypeFromContext());
 
             //wrappedBuffer = pointer().asByteBuffer();
 
@@ -1312,15 +1312,15 @@
         }
     }
 
-    protected void readContent(DataInputStream s, Type currentType) {
+    protected void readContent(DataInputStream s, Type currentType, Type globalType) {
         try {
             if (currentType == Type.DOUBLE) {
                 for (int i = 0; i < length(); i++) {
-                    putByGlobalType(i, s.readDouble());
+                    putByGlobalType(i, s.readDouble(), globalType);
                 }
             } else if (currentType == Type.FLOAT) {
                 for (int i = 0; i < length(); i++) {
-                    putByGlobalType(i, s.readFloat());
+                    putByGlobalType(i, s.readFloat(), globalType);
                 }
             } else if (currentType == Type.COMPRESSED) {
                 String compressionAlgorithm = s.readUTF();
@@ -1338,11 +1338,11 @@
 
             } else if (currentType == Type.HALF) {
                 for (int i = 0; i < length(); i++) {
-                    putByGlobalType(i, toFloat(s.readShort()));
+                    putByGlobalType(i, toFloat(s.readShort()), globalType);
                 }
             } else {
                 for (int i = 0; i < length(); i++) {
-                    putByGlobalType(i, s.readInt());
+                    putByGlobalType(i, s.readInt(), globalType);
                 }
             }
         } catch (Exception e) {",0
Correctly register for EPOLLRDHUP when construct EpollSocketChannel f…," 
     protected AbstractEpollStreamChannel(FileDescriptor fd) {
         super(null, fd, Native.EPOLLIN, Native.getSoError(fd.intValue()) == 0);
+
+        // Add EPOLLRDHUP so we are notified once the remote peer close the connection.
+        flags |= Native.EPOLLRDHUP;
     }
 
     @Override",0
Long have to be compared using equals,"             //check email address to see if it is already in use by another customer
             Customer customerMatchingNewEmail = customerService.readCustomerByEmail(form.getEmailAddress());
 
-            if (customerMatchingNewEmail != null && CustomerState.getCustomer().getId() != customerMatchingNewEmail.getId()) {
+            if (customerMatchingNewEmail != null && !CustomerState.getCustomer().getId().equals(customerMatchingNewEmail.getId())) {
                 //customer found with new email entered, and it is not the current customer
                 errors.rejectValue(""emailAddress"", ""emailAddress.used"");
             }",0
fix bug log," 	private static class ExceptionHandler extends SimpleChannelHandler {
 		private Logger m_logger;
 
-		private volatile int m_error;
+		private volatile int m_error = -1;
 
 		public ExceptionHandler(Logger logger) {
 			m_logger = logger;
@@ -304,8 +304,8 @@
 
 		@Override
 		public void channelDisconnected(ChannelHandlerContext ctx, ChannelStateEvent e) throws Exception {
-			if (m_error % 1000 == 0) {
 				m_error++;
+			if (m_error % 1000 == 0) {
 				m_logger.warn(""Channel disconnected by remote address: "" + e.getChannel().getRemoteAddress());
 				e.getChannel().close();
 			}
@@ -313,8 +313,8 @@
 
 		@Override
 		public void exceptionCaught(ChannelHandlerContext ctx, ExceptionEvent e) {
-			if (m_error % 1000 == 0) {
 				m_error++;
+			if (m_error % 1000 == 0) {
 				m_logger.warn(""Channel disconnected by remote address: "" + e.getChannel().getRemoteAddress());
 				e.getChannel().close();
 			}",0
Fix the NullPointException when save sonic cache.," 
         if (!TextUtils.isEmpty(htmlString)) {
             long startTime = System.currentTimeMillis();
-            doSaveSonicCache(htmlString);
+            doSaveSonicCache(sonicServer, htmlString);
             SonicUtils.log(TAG, Log.INFO, ""session("" + sId + "") onClose:separate And save ache finish, cost "" + (System.currentTimeMillis() - startTime) + "" ms."");
         }
 
@@ -474,7 +474,7 @@
 
                     case FILE_THREAD_SAVE_CACHE_ON_SESSION_FINISHED: {
                         final String htmlString = (String)msg.obj;
-                        doSaveSonicCache(htmlString);
+                        doSaveSonicCache(server, htmlString);
                         return true;
                     }
                 }
@@ -1016,27 +1016,27 @@
         fileHandler.sendMessageDelayed(msg, 1500);
     }
 
-    protected void doSaveSonicCache(String htmlString) {
+    protected void doSaveSonicCache(SonicServer sonicServer, String htmlString) {
         // if the session has been destroyed, exit directly
-        if(isDestroyedOrWaitingForDestroy()) {
+        if(isDestroyedOrWaitingForDestroy() || server == null) {
             SonicUtils.log(TAG, Log.ERROR, ""session("" + sId + "") doSaveSonicCache: save session files fail. Current session is destroy!"");
             return;
         }
 
         long startTime = System.currentTimeMillis();
-        String template = server.getTemplate();
-        String updatedData = server.getUpdatedData();
+        String template = sonicServer.getTemplate();
+        String updatedData = sonicServer.getUpdatedData();
 
         if (!TextUtils.isEmpty(htmlString) && !TextUtils.isEmpty(template)) {
-            String newHtmlSha1 = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_HTML_SHA1);
+            String newHtmlSha1 = sonicServer.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_HTML_SHA1);
             if (TextUtils.isEmpty(newHtmlSha1)) {
                 newHtmlSha1 = SonicUtils.getSHA1(htmlString);
             }
 
-            String eTag = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_ETAG);
-            String templateTag = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_TEMPLATE_TAG);
+            String eTag = sonicServer.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_ETAG);
+            String templateTag = sonicServer.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_TEMPLATE_TAG);
 
-            Map<String, List<String>> headers = server.getResponseHeaderFields();
+            Map<String, List<String>> headers = sonicServer.getResponseHeaderFields();
             for (WeakReference<SonicSessionCallback> ref : sessionCallbackList) {
                 SonicSessionCallback callback = ref.get();
                 if (callback != null) {",0
JENKINS-36489# NPE fix,"         /**
          * TODO: this code need cleanup once MultiBranchProject exposes default branch. At present
          *
-         * At present we look for master as primary branch, if not found we find the latest build and return
-         * its score.
+         * At present we look for master as primary branch, if not found we find the latest build across all branches and
+         * return its score.
          *
          * If there are no builds taken place 0 score is returned.
          */
 
-        Job j = mbp.getBranch(""master"");
+        Job j = mbp.getItem(""master"");
         if(j == null) {
-            j = mbp.getBranch(""production"");
-            if(j == null){ //get latest
+            j = mbp.getItem(""production"");
+            /**
+             * If there are no master or production branch then we return weather score of
+             *
+             * - Sort latest build of all branches in ascending order
+             * - Return the latest
+             *
+             */
+            if(j == null){
                 Collection<Job>  jbs = mbp.getAllJobs();
                 if(jbs.size() > 0){
                     Job[] jobs = jbs.toArray(new Job[jbs.size()]);
                     Arrays.sort(jobs, new Comparator<Job>() {
                         @Override
                         public int compare(Job o1, Job o2) {
-                            long t1 = o1.getLastBuild().getTimeInMillis() + o1.getLastBuild().getDuration();
-                            long t2 = o2.getLastBuild().getTimeInMillis() + o2.getLastBuild().getDuration();
+                            long t1 = 0;
+                            if(o1.getLastBuild() != null){
+                                t1 = o1.getLastBuild().getTimeInMillis() + o1.getLastBuild().getDuration();
+                            }
+
+                            long t2 = 0;
+                            if(o2.getLastBuild() != null){
+                                t2 = o2.getLastBuild().getTimeInMillis() + o2.getLastBuild().getDuration();
+                            }
+
                             if(t1<2){
                                 return -1;
                             }else if(t1 > t2){",0
enter app then immediately swipe to refresh fix," 
   @Override
   public void onRefresh() {
+    if (mIsScanRunning) {
+      return;
+    }
     mSwipeRefreshWidget.setRefreshing(true);
     if (!mIsDemoMode) {
       mScanningAnimationDrawable.start();",0
Fix compilation on SDK < 9 ," import java.util.List;
 import java.util.Map;
 
+import android.text.TextUtils;
+
 import com.activeandroid.annotation.Column;
 import com.activeandroid.annotation.Table;
 import com.activeandroid.util.ReflectionUtils;
@@ -59,7 +61,7 @@
 		for (Field field : fields) {
 			final Column columnAnnotation = field.getAnnotation(Column.class);
 			String columnName = columnAnnotation.name();
-			if (columnName == null || columnName.isEmpty()) {
+			if (TextUtils.isEmpty(columnName)) {
 				columnName = field.getName();
 			}
 			",0
Fix debug log in SafeJobServiceEngineImpl," 
     @Override
     public boolean onStopJob(JobParameters params) {
-        if (DEBUG) Log.d(TAG, ""onStartJob: "" + params);
+        if (DEBUG) Log.d(TAG, ""onStopJob: "" + params);
         boolean result = mService.doStopCurrentWork();
         synchronized (mLock) {
             // Once we return, the job is stopped, so its JobParameters are no",0
Fixed scheduling events on metadata load,"  * @since Mar 28, 2013
  */
 public class OSchedulerImpl implements OScheduler {
-  private ConcurrentHashMap<String, OScheduledEvent> events = new ConcurrentHashMap<String, OScheduledEvent>();
+  private static ConcurrentHashMap<String, OScheduledEvent> events = new ConcurrentHashMap<String, OScheduledEvent>();
 
   public OSchedulerImpl() {
   }
@@ -113,9 +113,7 @@
       final Iterable<ODocument> result = db.browseClass(OScheduledEvent.CLASS_NAME);
       for (ODocument d : result) {
         final OScheduledEvent event = new OScheduledEvent(d);
-
-        if (events.putIfAbsent(event.getName(), event) == null)
-          this.scheduleEvent(event);
+        scheduleEvent(event);
       }
     }
   }",0
"Fixing Netapi32Util.getDomainTrusts() includes ""empty"" domain object","         public WString ClientSiteName;
         
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""DomainControllerName"", ""DomainControllerAddress"", ""DomainGuid"", ""DomainName"", ""DnsForestName"", ""Flags"", ""DcSiteName"", ""ClientSiteName""});
+            return Arrays.asList(new String[] { ""DomainControllerName"", ""DomainControllerAddress"", ""DomainControllerAddressType"", ""DomainGuid"", ""DomainName"", ""DnsForestName"", ""Flags"", ""DcSiteName"", ""ClientSiteName""});
         }
     }	
 	
@@ -214,6 +214,7 @@
 
         public DS_DOMAIN_TRUSTS(Pointer p) {
             super(p);
+            read();
         }
     };
 }",0
Fix/RajawaliRenderer:unProject()," 
         final double[] in = new double[4], out = new double[4];
 
-        Matrix4 MVPMatrix = getCurrentCamera().getProjectionMatrix().multiply(getCurrentCamera().getViewMatrix());
+        Matrix4 projectionMatrix = getCurrentCamera().getProjectionMatrix().clone();
+        Matrix4 MVPMatrix = projectionMatrix.multiply(getCurrentCamera().getViewMatrix());
         MVPMatrix.inverse();
 
         in[0] = (x / mDefaultViewportWidth) * 2 - 1;",0
fix deobfuscation," 		if (cachedPackageFullAlias == null) {
 			Stack<PackageNode> pp = getParentPackages();
 			StringBuilder result = new StringBuilder();
+
+			if (pp.size() > 0) {
 			result.append(pp.pop().getAlias());
 			while (pp.size() > 0) {
 				result.append(SEPARATOR_CHAR);
 				result.append(pp.pop().getAlias());
 			}
+			} else {
+				result.append(this.getAlias());
+			}
 			cachedPackageFullAlias = result.toString();
 		}
 		return cachedPackageFullAlias;",0
Change logic to fix regression in loading jackson modules with the ht…,"         ObjectMapper objectMapper = jsonFactory != null ? new ObjectMapper(jsonFactory) : new ObjectMapper();
 
         final boolean hasConfiguration = jacksonConfiguration != null;
-        if (hasConfiguration && jacksonConfiguration.isModuleScan()) {
+        if (!hasConfiguration || jacksonConfiguration.isModuleScan()) {
             objectMapper.findAndRegisterModules();
         }
         objectMapper.registerModules(jacksonModules);",0
Fix link to docs about encrypted keysets,"       // Read the cleartext keyset from disk.
       // WARNING: reading cleartext keysets is a bad practice. Tink supports reading/writing
       // encrypted keysets, see
-      // https://github.com/google/tink/blob/master/doc/JAVA-HOWTO.md#loading-existing-keysets.
+      // https://github.com/google/tink/blob/master/docs/JAVA-HOWTO.md#loading-existing-keysets.
       return CleartextKeysetHandle.read(JsonKeysetReader.withFile(keyset));
     }
     KeysetHandle handle = KeysetHandle.generateNew(AeadKeyTemplates.AES128_GCM);",0
解决使用自定义词典时的bug," 					tempBaseValue = baseValue;
 					return str;
 				} else {
-					i = start;
-					start++;
+					// i = start;
+					// start++;
+					// end = 0;
+					// baseValue = 0;
+					// break;
+					start=i;
+					i--;
 					end = 0;
 					baseValue = 0;
 					break;",0
Also remove the id from the DnsQueryContextManager if query fails due…,"         } else {
             parent.channelFuture.addListener(new GenericFutureListener<Future<? super Channel>>() {
                 @Override
-                public void operationComplete(Future<? super Channel> future) throws Exception {
+                public void operationComplete(Future<? super Channel> future) {
                     if (future.isSuccess()) {
                         writeQuery(query, writePromise);
                     } else {
+                        // Remove the id from the manager as we fail the query.
+                        parent.queryContextManager.remove(nameServerAddr(), id);
+
                         Throwable cause = future.cause();
                         promise.tryFailure(cause);
                         writePromise.setFailure(cause);",0
Use IntMap to store pointer against pointer UUID. Fixes #2516," import com.badlogic.gdx.backends.gwt.widgets.TextInputDialogBox;
 import com.badlogic.gdx.backends.gwt.widgets.TextInputDialogBox.TextInputDialogListener;
 import com.badlogic.gdx.graphics.Pixmap;
+import com.badlogic.gdx.utils.IntMap;
 import com.badlogic.gdx.utils.IntSet;
 import com.badlogic.gdx.utils.TimeUtils;
 import com.gargoylesoftware.htmlunit.javascript.host.Navigator;
@@ -39,6 +40,7 @@
 public class GwtInput implements Input {
 	static final int MAX_TOUCHES = 20;
 	boolean justTouched = false;
+	private IntMap<Integer> touchMap = new IntMap<Integer>(20);
 	private boolean[] touched = new boolean[MAX_TOUCHES];
 	private int[] touchX = new int[MAX_TOUCHES];
 	private int[] touchY = new int[MAX_TOUCHES];
@@ -618,7 +620,9 @@
 			JsArray<Touch> touches = e.getChangedTouches();
 			for (int i = 0, j = touches.length(); i < j; i++) {
 				Touch touch = touches.get(i);
-				int touchId = touch.getIdentifier();
+				int real = touch.getIdentifier();
+				int touchId;
+				touchMap.put(real, touchId = getAvailablePointer());
 				touched[touchId] = true;
 				touchX[touchId] = getRelativeX(touch, canvas);
 				touchY[touchId] = getRelativeY(touch, canvas);
@@ -635,7 +639,8 @@
 			JsArray<Touch> touches = e.getChangedTouches();
 			for (int i = 0, j = touches.length(); i < j; i++) {
 				Touch touch = touches.get(i);
-				int touchId = touch.getIdentifier();
+				int real = touch.getIdentifier();
+				int touchId = touchMap.get(real);
 				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
 				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
 				touchX[touchId] = getRelativeX(touch, canvas);
@@ -651,7 +656,9 @@
 			JsArray<Touch> touches = e.getChangedTouches();
 			for (int i = 0, j = touches.length(); i < j; i++) {
 				Touch touch = touches.get(i);
-				int touchId = touch.getIdentifier();
+				int real = touch.getIdentifier();
+				int touchId = touchMap.get(real);
+				touchMap.remove(real);
 				touched[touchId] = false;
 				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
 				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
@@ -668,7 +675,9 @@
 			JsArray<Touch> touches = e.getChangedTouches();
 			for (int i = 0, j = touches.length(); i < j; i++) {
 				Touch touch = touches.get(i);
-				int touchId = touch.getIdentifier();
+				int real = touch.getIdentifier();
+				int touchId = touchMap.get(real);
+				touchMap.remove(real);
 				touched[touchId] = false;
 				deltaX[touchId] = getRelativeX(touch, canvas) - touchX[touchId];
 				deltaY[touchId] = getRelativeY(touch, canvas) - touchY[touchId];
@@ -684,6 +693,13 @@
 // if(hasFocus) e.preventDefault();
 	}
 
+	private int getAvailablePointer () {
+		for (int i = 0; i < MAX_TOUCHES; i++) {
+			if (!touchMap.containsValue(i, false)) return i;
+		}
+		return -1;
+	}
+
 	/** borrowed from PlayN, thanks guys **/
 	private static int keyForCode (int keyCode) {
 		switch (keyCode) {",0
Fixing seekTo loop,"     private Runnable callback;
     private String TAG = ""JZExoPlayer"";
     private MediaSource videoSource;
+    private long previousSeek = 0;
+
 
     @Override
     public void start() {
         simpleExoPlayer.setPlayWhenReady(true);
-        simpleExoPlayer.getPlaybackState();
     }
 
     @Override
@@ -83,7 +84,7 @@
                 Util.getUserAgent(context, context.getResources().getString(R.string.app_name)));
 
         String currUrl = currentDataSource.toString();
-        if (currUrl.contains("".m3u8"") == true) {
+        if (currUrl.contains("".m3u8"")) {
             videoSource = new HlsMediaSource.Factory(dataSourceFactory)
                     .createMediaSource(Uri.parse(currUrl), mainHandler, null);
         } else {
@@ -139,7 +140,6 @@
     @Override
     public void pause() {
         simpleExoPlayer.setPlayWhenReady(false);
-        simpleExoPlayer.getPlaybackState();
     }
 
     @Override
@@ -149,7 +149,11 @@
 
     @Override
     public void seekTo(long time) {
+        if(time != previousSeek) {
         simpleExoPlayer.seekTo(time);
+            previousSeek = time;
+            JZVideoPlayerManager.getCurrentJzvd().seekToInAdvance = time;
+        }
     }
 
     @Override",0
pac4j-webflow: fix swf transition when delegation for authz returns a warn,"         transitionSet.add(createTransition(CasWebflowConstants.TRANSITION_ID_ERROR, getStartState(flow).getId()));
         transitionSet.add(createTransition(CasWebflowConstants.TRANSITION_ID_AUTHENTICATION_FAILURE, CasWebflowConstants.STATE_ID_STOP_WEBFLOW));
         transitionSet.add(createTransition(CasWebflowConstants.TRANSITION_ID_STOP, CasWebflowConstants.STATE_ID_STOP_WEBFLOW));
+        transitionSet.add(createTransition(CasWebflowConstants.TRANSITION_ID_WARN, CasWebflowConstants.STATE_ID_WARN));
         setStartState(flow, actionState);
     }
 ",0
fix comment,"     @Override
     public SofaResponse invoke(SofaRequest request) throws SofaRpcException {
         if (nextFilter == null && invoker == null) {
-            throw new SofaRpcException(RpcErrorType.SERVER_FILTER, ""Next filter or invoker is null!"");
+            throw new SofaRpcException(RpcErrorType.SERVER_FILTER, ""Next filter and invoker is null!"");
         }
         return nextFilter == null ?
             invoker.invoke(request) :",0
"Fix float precision issues and mixed usage of Math.sin, MathUtils.sin"," 			return idt();
 		d = 1f /d;
 		float l_ang = angle * MathUtils.degreesToRadians;
-		float l_sin = MathUtils.sin(l_ang / 2);
-		float l_cos = MathUtils.cos(l_ang / 2);
+		float l_sin = (float)Math.sin(l_ang / 2);
+		float l_cos = (float)Math.cos(l_ang / 2);
 		return this.set(d * x * l_sin, d * y * l_sin, d * z * l_sin, l_cos).nor();
 	}
 ",0
Added small delay before update presentation state this is need for correct UI initialization," import static com.google.gwt.dom.client.Style.Cursor.POINTER;
 
 import com.google.gwt.core.client.GWT;
-import com.google.gwt.event.dom.client.ClickEvent;
-import com.google.gwt.event.dom.client.ClickHandler;
-import com.google.gwt.event.dom.client.KeyUpEvent;
-import com.google.gwt.event.dom.client.KeyUpHandler;
-import com.google.gwt.event.logical.shared.ValueChangeEvent;
-import com.google.gwt.event.logical.shared.ValueChangeHandler;
 import com.google.gwt.uibinder.client.UiBinder;
 import com.google.gwt.uibinder.client.UiField;
 import com.google.gwt.user.client.Timer;
@@ -27,7 +21,6 @@
 import com.google.gwt.user.client.ui.CheckBox;
 import com.google.gwt.user.client.ui.FlowPanel;
 import com.google.gwt.user.client.ui.Label;
-import com.google.gwt.user.client.ui.SimplePanel;
 import com.google.gwt.user.client.ui.TextBox;
 import com.google.gwt.user.client.ui.Widget;
 import com.google.inject.Inject;
@@ -53,9 +46,7 @@
   @UiField(provided = true)
   final JavaLocalizationConstant locale;
 
-  @UiField FlowPanel headerPanelToHide;
   @UiField TextBox newName;
-  @UiField FlowPanel subSettings;
   @UiField CheckBox updateSubpackages;
   @UiField FlowPanel renameSubpackagesPanel;
   @UiField FlowPanel renameKeepOriginalMethodPanel;
@@ -65,9 +56,7 @@
   @UiField CheckBox updateSimilarlyVariables;
   @UiField CheckBox updateDelegateUpdating;
   @UiField CheckBox updateMarkDeprecated;
-  @UiField FlowPanel occurrencesPanel;
   @UiField FlowPanel fullNamePanel;
-  @UiField SimplePanel icon;
   @UiField TextBox patternField;
   @UiField CheckBox updateFullNames;
   @UiField CheckBox updateReferences;
@@ -90,44 +79,33 @@
 
     createButtons(locale);
 
-    updateFullNames.addValueChangeHandler(
-        new ValueChangeHandler<Boolean>() {
-          @Override
-          public void onValueChange(ValueChangeEvent<Boolean> event) {
-            patternField.setEnabled(event.getValue());
-          }
-        });
+    updateFullNames.addValueChangeHandler(event -> patternField.setEnabled(event.getValue()));
 
     updateDelegateUpdating.addValueChangeHandler(
-        new ValueChangeHandler<Boolean>() {
-          @Override
-          public void onValueChange(ValueChangeEvent<Boolean> event) {
-            updateMarkDeprecated.setEnabled(event.getValue());
-          }
-        });
+        event -> updateMarkDeprecated.setEnabled(event.getValue()));
 
     configureLabel.addClickHandler(
-        new ClickHandler() {
-          @Override
-          public void onClick(ClickEvent event) {
+        event -> {
             if (isUpdateSimilarlyVariables()) {
               similarNamesConfigurationPresenter.show();
             }
-          }
         });
 
     newName.addKeyUpHandler(
-        new KeyUpHandler() {
+        event -> {
+          // here need some delay to be sure input box initiated with given value
+          // in manually testing hard to reproduce this problem but it reproduced with selenium
+          // tests
+          new Timer() {
           @Override
-          public void onKeyUp(KeyUpEvent event) {
+            public void run() {
             delegate.validateName();
           }
+          }.schedule(300);
         });
 
     updateSimilarlyVariables.addValueChangeHandler(
-        new ValueChangeHandler<Boolean>() {
-          @Override
-          public void onValueChange(ValueChangeEvent<Boolean> event) {
+        event -> {
             if (event.getValue()) {
               configureLabel.getElement().getStyle().setCursor(POINTER);
               configureLabel.getElement().getStyle().setColor(Style.getPrimaryHighlightsColor());
@@ -135,7 +113,6 @@
               configureLabel.getElement().getStyle().setCursor(DEFAULT);
               configureLabel.getElement().getStyle().setColor(Style.getButtonDisabledFontColor());
             }
-          }
         });
   }
 
@@ -144,35 +121,22 @@
         createButton(
             locale.moveDialogButtonPreview(),
             ""move-preview-button"",
-            new ClickHandler() {
-              @Override
-              public void onClick(ClickEvent event) {
-                delegate.onPreviewButtonClicked();
-              }
-            });
+            event -> delegate.onPreviewButtonClicked());
 
     Button cancel =
         createButton(
             locale.moveDialogButtonCancel(),
             ""move-cancel-button"",
-            new ClickHandler() {
-              @Override
-              public void onClick(ClickEvent event) {
+            event -> {
                 hide();
                 delegate.onCancelButtonClicked();
-              }
             });
 
     accept =
         createButton(
             locale.moveDialogButtonOk(),
             ""move-accept-button"",
-            new ClickHandler() {
-              @Override
-              public void onClick(ClickEvent event) {
-                delegate.onAcceptButtonClicked();
-              }
-            });
+            event -> delegate.onAcceptButtonClicked());
 
     addButtonToFooter(accept);
     addButtonToFooter(cancel);",0
CHE-2564: Fix build,"     }
 
     @Override
-    public String getAgentName() {
+    public String getAgentId() {
         return ""org.eclipse.che.terminal"";
     }
 ",0
Bug fix: fix NOAUTH error...," 
             try {
                 RedisAsyncConnectionImpl<String, String> connection = client.connectAsyncImpl(redisURI.getResolvedAddress());
+                if (redisURI.getPassword() != null) {
+                    String password = new String(redisURI.getPassword());
+                    if (!"""".equals(password.trim())) {
+                        connection.auth(password);
+                    }
+                }
                 connections.put(redisURI, connection);
             } catch (RuntimeException e) {
                 logger.warn(""Cannot connect to "" + redisURI, e);",0
Fix typo in Future JavaDoc,"      * @param computation     A computation.
      * @param <T>             Type of the computation result.
      * @return A new Future instance.
-     * @throws NullPointerException if one of executorService of computation is null.
+     * @throws NullPointerException if one of executorService or computation is null.
      */
     static <T> Future<T> of(ExecutorService executorService, CheckedSupplier<? extends T> computation) {
         Objects.requireNonNull(executorService, ""executorService is null"");
@@ -373,7 +373,7 @@
      * @param executorService An executor service.
      * @param unit            A unit of work.
      * @return A new Future instance which results in nothing.
-     * @throws NullPointerException if one of executorService of unit is null.
+     * @throws NullPointerException if one of executorService or unit is null.
      */
     static Future<Void> run(ExecutorService executorService, CheckedRunnable unit) {
         Objects.requireNonNull(executorService, ""executorService is null"");",0
Fixed CalendarPager scrolling in nested ViewPager,"     public boolean onTouchEvent(MotionEvent ev) {
         return pagingEnabled && super.onTouchEvent(ev);
     }
+
+    @Override
+    public boolean canScrollVertically(int direction) {
+        /**
+         * disables scrolling vertically when paging disabled, fixes scrolling
+         * for nested {@link android.support.v4.view.ViewPager}
+         */
+        return pagingEnabled && super.canScrollVertically(direction);
+    }
+
+    @Override
+    public boolean canScrollHorizontally(int direction) {
+        /**
+         * disables scrolling horizontally when paging disabled, fixes scrolling
+         * for nested {@link android.support.v4.view.ViewPager}
+         */
+        return pagingEnabled && super.canScrollHorizontally(direction);
+    }
+
 }",0
HashSet.containsKey() fixed,"     }
 
     default boolean containsKey(K key) {
-        // TODO: what if the stored value is null? the result is ambiguous
-        return get(key) != null;
+        return ((AbstractNode<K, V>) this).lookup(0, key).isDefined();
     }
 
     default HashMap<K, V> put(K key, V value) {",0
fix #2279,"  */
 public class OCommandExecutorUtility {
   private static Method java8MethodIsArray;
-  private static Method java8MethodValues;
-
+  static {
+   try {
+     java8MethodIsArray = Class.forName(""jdk.nashorn.api.scripting.JSObject"").getDeclaredMethod(""isArray"",null);
+   } catch(Exception e) {}
+  }
   /**
    * Manages cross compiler compatibility issues.
    * 
@@ -41,26 +44,17 @@
    * @return
    */
   public static Object transformResult(Object result) {
+    if (java8MethodIsArray == null || !(result instanceof Map)) { 
+      return result;
+    }
     // PATCH BY MAT ABOUT NASHORN RETURNING VALUE FOR ARRAYS.
-    if (result!=null && result.getClass().getName().contains(""nashorn"") && result instanceof Map) {
       try {
-        if (isActuallyAnArray(result)) {
+      if ((Boolean) java8MethodIsArray.invoke(result)) {
           List<?> partial = new ArrayList(((Map) result).values());
           List<Object> finalResult = new ArrayList<Object>();
           for (Object o : partial) {
-            if (o instanceof Map) {
-              Map<Object, Object> innerMap = (Map) o;
-              Set<Object> keys = innerMap.keySet();
-              Map<Object, Object> newMap = new LinkedHashMap<Object, Object>();
-              for (Object key : keys) {
-                newMap.put(key, transformResult(innerMap.get(key)));
+          finalResult.add(transformResult(o));
               }
-              finalResult.add(newMap.values());
-            } else {
-              finalResult.add(o);
-            }
-          }
-
           return finalResult;
         }else{
           Map<Object, Object> mapResult = (Map) result;
@@ -70,18 +64,7 @@
           }
           return mapResult;
         }
-      } catch (Exception e) {
-      }
-    }
-
+    } catch (Exception e) {}
     return result;
   }
-
-  private static boolean isActuallyAnArray(Object iObject) {
-    try {
-      return Boolean.TRUE.equals(Class.forName(""jdk.nashorn.api.scripting.JSObject"").getDeclaredMethod(""isArray"", null).invoke(iObject));
-    }  catch(Exception e) {
-      return false;
-    }
-  }
 }",0
Fix RegionBootstrap broken default consructors,"         }
         this.context = context.getApplicationContext();
         this.monitorNotifier = monitorNotifier;
-
-        this.monitorNotifier = new BootstrapNotifier() {
-            public Context getApplicationContext() {
-                return context.getApplicationContext();
-            }
-
-            public void didEnterRegion(Region region) {
-                monitorNotifier.didEnterRegion(region);
-            }
-
-            public void didExitRegion(Region region) {
-                monitorNotifier.didExitRegion(region);
-            }
-
-            public void didDetermineStateForRegion(int state, Region region) {
-                monitorNotifier.didDetermineStateForRegion(state, region);
-            }
-        };
-
         regions = new ArrayList<Region>();
         regions.add(region);
 
@@ -97,24 +78,6 @@
         this.context = context.getApplicationContext();
         this.monitorNotifier = monitorNotifier;
 
-        this.monitorNotifier = new BootstrapNotifier() {
-            public Context getApplicationContext() {
-                return context.getApplicationContext();
-            }
-
-            public void didEnterRegion(Region region) {
-                monitorNotifier.didEnterRegion(region);
-            }
-
-            public void didExitRegion(Region region) {
-                monitorNotifier.didExitRegion(region);
-            }
-
-            public void didDetermineStateForRegion(int state, Region region) {
-                monitorNotifier.didDetermineStateForRegion(state, region);
-            }
-        };
-
         this.regions = regions;
 
         beaconManager = BeaconManager.getInstanceForApplication(context);
@@ -136,7 +99,7 @@
         this.context = application.getApplicationContext();
         regions = new ArrayList<Region>();
         regions.add(region);
-
+        this.monitorNotifier = application;
         beaconManager = BeaconManager.getInstanceForApplication(context);
         beaconConsumer = new InternalBeaconConsumer();
         beaconManager.bind(beaconConsumer);
@@ -156,7 +119,7 @@
 
         this.context = application.getApplicationContext();
         this.regions = regions;
-
+        this.monitorNotifier = application;
         beaconManager = BeaconManager.getInstanceForApplication(context);
         beaconConsumer = new InternalBeaconConsumer();
         beaconManager.bind(beaconConsumer);",0
"If the object name is blank, do not append the appName","  */
 package org.broadleafcommerce.common.jmx;
 
+import org.apache.commons.lang.StringUtils;
 import org.springframework.jmx.export.metadata.InvalidMetadataException;
 import org.springframework.jmx.export.metadata.ManagedResource;
 
@@ -39,7 +40,9 @@
         ManagedResource resource = super.getManagedResource(beanClass);
         if (resource != null && appName != null) {
             String objectName = resource.getObjectName();
+            if(StringUtils.isNotBlank(objectName)) {
             objectName += ""."" + appName;
+            }
             resource.setObjectName(objectName);
         }
         return resource;",0
Resolves a NPE caused by unexpected lifecycle events in a third party…,"         if (mRendererDelegate != null) {
             mRendererDelegate.mRenderer.onPause();
         }
+        if (mGLThread != null) {
         mGLThread.onPause();
     }
+    }
 
     /**
      * Inform the view that the activity is resumed. The owner of this view must",0
[doc] Fix typo in incremental analysis log message,"     
     public NoopAnalysisCache() {
         LOG.warning(""This analysis could be faster, please consider using Incremental Analysis: ""
-                + ""https://pmd.github.io/pmd/pmd_userdocs_getting_started.html#incremenal-analysis"");
+                + ""https://pmd.github.io/pmd/pmd_userdocs_getting_started.html#incremental-analysis"");
     }
     
     @Override",0
Fixes the issue where API cart fails due to ClassCastException," import org.broadleafcommerce.common.presentation.override.PropertyType;
 import org.broadleafcommerce.common.template.TemplatePathContainer;
 import org.broadleafcommerce.common.util.DateUtil;
+import org.broadleafcommerce.common.util.HibernateUtils;
 import org.broadleafcommerce.common.vendor.service.type.ContainerShapeType;
 import org.broadleafcommerce.common.vendor.service.type.ContainerSizeType;
 import org.broadleafcommerce.common.web.Locatable;
@@ -293,7 +294,7 @@
     @BatchSize(size = 50)
     @AdminPresentationCollection(friendlyName = ""ProductImpl_Additional_Skus"",
             tab = TabName.ProductOptions, order = 1000)
-    protected List<Sku> additionalSkus = new ArrayList<Sku>();
+    private List<Sku> additionalSkus = new ArrayList<>();
 
     @ManyToOne(targetEntity = CategoryImpl.class)
     @JoinColumn(name = ""DEFAULT_CATEGORY_ID"")
@@ -343,6 +344,9 @@
     @Transient
     protected List<String> allParentCategoryIds;
 
+    @Transient
+    private List<Sku> allAdditionalSkus;
+
     @Embedded
     protected ArchiveStatus archiveStatus = new ArchiveStatus();
 
@@ -601,7 +605,14 @@
 
     @Override
     public List<Sku> getAdditionalSkus() {
-        return additionalSkus;
+        if (allAdditionalSkus == null && additionalSkus != null) {
+            allAdditionalSkus = new ArrayList<>();
+            for (Sku sku : additionalSkus) {
+                allAdditionalSkus.add(HibernateUtils.deproxy(sku));
+
+            }
+        }
+        return allAdditionalSkus;
     }
 
     @Override",0
Ignore already existing required z-nodes in global zk," import org.apache.bookkeeper.meta.HierarchicalLedgerManagerFactory;
 import org.apache.bookkeeper.util.ZkUtils;
 import org.apache.zookeeper.CreateMode;
+import org.apache.zookeeper.KeeperException.NodeExistsException;
 import org.apache.zookeeper.ZooDefs;
 import org.apache.zookeeper.ZooKeeper;
 import org.slf4j.Logger;
@@ -44,14 +45,16 @@
         @Parameter(names = { ""-c"", ""--cluster"" }, description = ""Cluster name"", required = true)
         private String cluster;
 
-        @Parameter(names = { ""-uw"", ""--web-service-url"" }, description = ""Web-service URL for new cluster"", required = true)
+        @Parameter(names = { ""-uw"",
+                ""--web-service-url"" }, description = ""Web-service URL for new cluster"", required = true)
         private String clusterWebServiceUrl;
 
         @Parameter(names = { ""-tw"",
                 ""--web-service-url-tls"" }, description = ""Web-service URL for new cluster with TLS encryption"", required = false)
         private String clusterWebServiceUrlTls;
         
-        @Parameter(names = { ""-ub"", ""--broker-service-url"" }, description = ""Broker-service URL for new cluster"", required = false)
+        @Parameter(names = { ""-ub"",
+                ""--broker-service-url"" }, description = ""Broker-service URL for new cluster"", required = false)
         private String clusterBrokerServiceUrl;
 
         @Parameter(names = { ""-tb"",
@@ -103,10 +106,19 @@
         localZk.create(""/managed-ledgers"", new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
         localZk.create(""/namespace"", new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
 
+        try {
         ZkUtils.createFullPathOptimistic(globalZk, ""/admin/policies"", new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT);
+        } catch (NodeExistsException e) {
+            // Ignore
+        }
+
+        try {
         ZkUtils.createFullPathOptimistic(globalZk, ""/admin/clusters"", new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT);
+        } catch (NodeExistsException e) {
+            // Ignore
+        }
 
         ClusterData clusterData = new ClusterData(arguments.clusterWebServiceUrl, arguments.clusterWebServiceUrlTls,
                 arguments.clusterBrokerServiceUrl, arguments.clusterBrokerServiceUrlTls);
@@ -119,8 +131,12 @@
         ClusterData globalClusterData = new ClusterData(null, null);
         byte[] globalClusterDataJson = ObjectMapperFactory.getThreadLocal().writeValueAsBytes(globalClusterData);
 
+        try {
         globalZk.create(""/admin/clusters/global"", globalClusterDataJson, ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT);
+        } catch (NodeExistsException e) {
+            // Ignore
+        }
 
         log.info(""Cluster metadata for '{}' setup correctly"", arguments.cluster);
     }",0
bug in problem 32,"     for (int i = 0; i < w2.length() - 1; i++) {
       if (w2.charAt(i) == w1.charAt(0)) {
         for (int j = 0; j < w1.length(); j++) {
-          if (w1.charAt(j) == w2.charAt(i + j) && j == w1.length() - 1) {
+          if ((i + j) < w2.length() && w1.charAt(j) == w2.charAt(i + j) && j == w1.length() - 1) {
             contains = true;
             break;
           }",0
dupe quotes fix for category names,"             write(out, pad0, COMMENT_SEPARATOR, NEW_LINE);
         }
 
+        String displayName = name;
+
         if (!allowedProperties.matchesAllOf(name))
         {
-            name = '""' + name + '""';
+            displayName = '""' + name + '""';
         }
 
-        write(out, pad0, name, "" {"");
+        write(out, pad0, displayName, "" {"");
 
         Property[] props = getOrderedValues().toArray(new Property[] {});
 ",0
CAMEL-10520 fix the acknowledgment mechanism for lumberjack protocol v1,"  */
 final class LumberjackSessionHandler {
     private static final Logger LOG = LoggerFactory.getLogger(LumberjackSessionHandler.class);
+    private static final int ACK_UNSET = -1;
 
     private volatile int version = -1;
     private volatile int windowSize = 1;
+    private volatile int nextAck = ACK_UNSET;
 
     void versionRead(int version) {
         if (this.version == -1) {
@@ -50,10 +52,15 @@
     void windowSizeRead(int windowSize) {
         LOG.debug(""Lumberjack window size is {}"", windowSize);
         this.windowSize = windowSize;
+        nextAck = ACK_UNSET;
     }
 
     void notifyMessageProcessed(ChannelHandlerContext ctx, int sequenceNumber) {
-        if (sequenceNumber == windowSize) {
+        if (nextAck == ACK_UNSET) {
+            nextAck = sequenceNumber + windowSize - 1;
+        }
+
+        if (sequenceNumber == nextAck) {
             LOG.debug(""Sequence number is {}. Sending ACK"", sequenceNumber);
             ByteBuf response = ctx.alloc().heapBuffer(FRAME_ACKNOWLEDGE_LENGTH, FRAME_ACKNOWLEDGE_LENGTH);
             response.writeByte(version);",0
Clear last message if null in dialog list (Fix issue #189),"     }
 
     /**
+     * Upsert dialog in dialogs list or add it to then end of dialogs list
+     *
+     * @param item dialog item
+     */
+    public void upsertItem(DIALOG item) {
+        boolean updated = false;
+        for (int i = 0; i < items.size(); i++) {
+            if (items.get(i).getId().equals(item.getId())) {
+                items.set(i, item);
+                notifyItemChanged(i);
+                updated = true;
+                break;
+            }
+        }
+        if (!updated) {
+            addItem(item);
+        }
+    }
+
+    /**
      * Find an item by its id
      *
      * @param id the wanted item's id
@@ -631,6 +651,8 @@
                 tvDate.setText(formattedDate == null
                         ? getDateString(lastMessageDate)
                         : formattedDate);
+            } else {
+                tvDate.setText(null);
             }
 
             //Set Dialog avatar
@@ -643,11 +665,14 @@
                 imageLoader.loadImage(ivLastMessageUser, dialog.getLastMessage().getUser().getAvatar());
             }
             ivLastMessageUser.setVisibility(dialogStyle.isDialogMessageAvatarEnabled()
-                    && dialog.getUsers().size() > 1 ? VISIBLE : GONE);
+                    && dialog.getUsers().size() > 1
+                    && dialog.getLastMessage() != null ? VISIBLE : GONE);
 
             //Set Last message text
             if (dialog.getLastMessage() != null) {
                 tvLastMessage.setText(dialog.getLastMessage().getText());
+            } else {
+                tvLastMessage.setText(null);
             }
 
             //Set Unread message count bubble",0
Fix typo in Maven plugin help: surefore => surefire.,"  * </p>
  *
  * <p>
- * One of the ways to do this in case of maven-surefore-plugin - is to use
+ * One of the ways to do this in case of maven-surefire-plugin - is to use
  * syntax for <a href=""http://maven.apache.org/surefire/maven-surefire-plugin/faq.html#late-property-evaluation"">late property evaluation</a>:
  * </p>
  * ",0
Fix NPE for mouseMove without image,"     }
 
     public ClassNode getClassNodeAt(int x, int y) {
+        if (image == null) {
+            return null;
+        }
         int color = image.getRGB(x,y);
         return colorClassNodeMap.get(color);
     }",0
Fixed recycler view animation,"             for (Animator animatorChild : animators) {
                 Animator animatorCopy = animatorChild.clone();
                 animatorCopy.setTarget(childView.getView());
+                animatorCopy.start();
+                animatorCopy.cancel();
                 animatorCopy.setStartDelay(childView.getTimeOffset());
                 animatorsList.add(animatorCopy);
             }",0
Fix for Issue #2847," import java.util.Map;
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Executors;
-import java.util.concurrent.locks.Lock;
-import java.util.concurrent.locks.ReentrantLock;
 
 import com.badlogic.gdx.Net;
 import com.badlogic.gdx.Net.HttpMethods;
@@ -118,13 +116,11 @@
 	private final ExecutorService executorService;
 	final ObjectMap<HttpRequest, HttpURLConnection> connections;
 	final ObjectMap<HttpRequest, HttpResponseListener> listeners;
-	final Lock lock;
 
 	public NetJavaImpl () {
 		executorService = Executors.newCachedThreadPool();
 		connections = new ObjectMap<HttpRequest, HttpURLConnection>();
 		listeners = new ObjectMap<HttpRequest, HttpResponseListener>();
-		lock = new ReentrantLock();
 	}
 
 	public void sendHttpRequest (final HttpRequest httpRequest, final HttpResponseListener httpResponseListener) {
@@ -154,10 +150,7 @@
 			connection.setRequestMethod(method);
 			HttpURLConnection.setFollowRedirects(httpRequest.getFollowRedirects());
 
-			lock.lock();
-			connections.put(httpRequest, connection);
-			listeners.put(httpRequest, httpResponseListener);
-			lock.unlock();
+			putIntoConnectionsAndListeners(httpRequest, httpResponseListener, connection);
 
 			// Headers get set regardless of the method
 			for (Map.Entry<String, String> header : httpRequest.getHeaders().entrySet())
@@ -199,19 +192,13 @@
 
 						final HttpClientResponse clientResponse = new HttpClientResponse(connection);
 						try {
-							lock.lock();
-							HttpResponseListener listener = listeners.get(httpRequest);
+							HttpResponseListener listener = getFromListeners(httpRequest);
 
 							if (listener != null) {
-								lock.unlock();
 								listener.handleHttpResponse(clientResponse);
-								lock.lock();
-								listeners.remove(httpRequest);
 							}
-
-							connections.remove(httpRequest);
+							removeFromConnectionsAndListeners(httpRequest);
 						} finally {
-							lock.unlock();
 							connection.disconnect();
 						}
 					} catch (final Exception e) {
@@ -219,10 +206,7 @@
 						try {
 							httpResponseListener.failed(e);
 						} finally {
-							lock.lock();
-							connections.remove(httpRequest);
-							listeners.remove(httpRequest);
-							lock.unlock();
+							removeFromConnectionsAndListeners(httpRequest);
 						}
 					}
 				}
@@ -231,29 +215,34 @@
 			try {
 				httpResponseListener.failed(e);
 			} finally {
-				lock.lock();
-				connections.remove(httpRequest);
-				listeners.remove(httpRequest);
-				lock.unlock();
+				removeFromConnectionsAndListeners(httpRequest);
 			}
 			return;
 		}
 	}
 
 	public void cancelHttpRequest (HttpRequest httpRequest) {
-		try {
-			lock.lock();
-			HttpResponseListener httpResponseListener = listeners.get(httpRequest);
+		HttpResponseListener httpResponseListener = getFromListeners(httpRequest);
 
 			if (httpResponseListener != null) {
-				lock.unlock();
 				httpResponseListener.cancelled();
-				lock.lock();
+			removeFromConnectionsAndListeners(httpRequest);
+		}
+	}
+
+	synchronized void removeFromConnectionsAndListeners (final HttpRequest httpRequest) {
 				connections.remove(httpRequest);
 				listeners.remove(httpRequest);
 			}
-		} finally {
-			lock.unlock();
+
+	synchronized void putIntoConnectionsAndListeners (final HttpRequest httpRequest,
+		final HttpResponseListener httpResponseListener, final HttpURLConnection connection) {
+		connections.put(httpRequest, connection);
+		listeners.put(httpRequest, httpResponseListener);
 		}
+
+	synchronized HttpResponseListener getFromListeners (HttpRequest httpRequest) {
+		HttpResponseListener httpResponseListener = listeners.get(httpRequest);
+		return httpResponseListener;
 	}
 }",0
fixed issue that could lead to a NullPointerException,"         Collection<ExecutionPhase> localExecutionPhases = nodesByServer.remove(localNodeId);
 
         JobExecutionContext.Builder builder = jobContextService.newBuilder(jobId());
-        builder.addSubContext(mergeNode.executionPhaseId(), finalLocalMerge);
 
         if (localExecutionPhases == null || localExecutionPhases.isEmpty()) {
             // only the local merge happens locally so it is enough to just create that context.
+            builder.addSubContext(mergeNode.executionPhaseId(), finalLocalMerge);
             jobContextService.createOrMergeContext(builder);
         } else {
             for (ExecutionPhase executionPhase : localExecutionPhases) {
                 contextPreparer.prepare(jobId(), executionPhase, builder);
             }
+            builder.addSubContext(mergeNode.executionPhaseId(), finalLocalMerge);
             JobExecutionContext context = jobContextService.createOrMergeContext(builder);
             for (ExecutionPhase executionPhase : localExecutionPhases) {
                 executionNodeOperationStarter.startOperation(executionPhase, context);",0
Fix deserialization of Swagger with API-level vendor extensions,"     @JsonAnySetter
     public void setVendorExtension(String name, Object value) {
         if (name.startsWith(""x-"")) {
-            vendorExtensions.put(name, value);
+            vendorExtension(name, value);
         }
     }
 ",0
Fix max available stake for voting showing negative,"         Coin blindVoteFee = BlindVoteConsensus.getFee(daoStateService, daoStateService.getChainHeight());
         if (isBlindVotePhaseButNotLastBlock()) {
             Coin availableForVoting = availableConfirmedBalance.subtract(blindVoteFee);
+            if (availableForVoting.isNegative())
+                availableForVoting = Coin.valueOf(0);
             stakeInputTextField.setPromptText(Res.get(""dao.proposal.myVote.stake.prompt"",
                     bsqFormatter.formatCoinWithCode(availableForVoting)));
         } else",0
Partial fix for #437: Use compiler detections to guard pragmas to suppress excessive warnings,"             indent + ""    inline void wrapForEncode(char *buffer, const %3$s count,"" +
                 "" std::uint64_t *pos, const std::uint64_t actingVersion, const std::uint64_t bufferLength)\n"" +
             indent + ""    {\n"" +
+            indent + ""#if defined(__GNUG__) && !defined(__clang__)\n"" +
             indent + ""#pragma GCC diagnostic push\n"" +
             indent + ""#pragma GCC diagnostic ignored \""-Wtype-limits\""\n"" +
+            indent + ""#endif\n"" +
             indent + ""        if (count < %5$d || count > %6$d)\n"" +
             indent + ""        {\n"" +
             indent + ""            throw std::runtime_error(\""count outside of allowed range [E110]\"");\n"" +
             indent + ""        }\n"" +
+            indent + ""#if defined(__GNUG__) && !defined(__clang__)\n"" +
             indent + ""#pragma GCC diagnostic pop\n"" +
+            indent + ""#endif\n"" +
             indent + ""        m_buffer = buffer;\n"" +
             indent + ""        m_bufferLength = bufferLength;\n"" +
             indent + ""        m_dimensions.wrap(m_buffer, *pos, actingVersion, bufferLength);\n"" +
@@ -363,10 +367,14 @@
             indent + ""    }\n\n"" +
             indent + ""    bool %1$sInActingVersion()\n"" +
             indent + ""    {\n"" +
+            indent + ""#if defined(__clang__)\n"" +
             indent + ""#pragma clang diagnostic push\n"" +
             indent + ""#pragma clang diagnostic ignored \""-Wtautological-compare\""\n"" +
+            indent + ""#endif\n"" +
             indent + ""        return m_actingVersion >= %1$sSinceVersion();\n"" +
+            indent + ""#if defined(__clang__)\n"" +
             indent + ""#pragma clang diagnostic pop\n"" +
+            indent + ""#endif\n"" +
             indent + ""    }\n"",
             propertyName,
             token.version()));
@@ -522,10 +530,14 @@
             indent + ""    }\n\n"" +
             indent + ""    bool %1$sInActingVersion()\n"" +
             indent + ""    {\n"" +
+            indent + ""#if defined(__clang__)\n"" +
             indent + ""#pragma clang diagnostic push\n"" +
             indent + ""#pragma clang diagnostic ignored \""-Wtautological-compare\""\n"" +
+            indent + ""#endif\n"" +
             indent + ""        return m_actingVersion >= %1$sSinceVersion();\n"" +
+            indent + ""#if defined(__clang__)\n"" +
             indent + ""#pragma clang diagnostic pop\n"" +
+            indent + ""#endif\n"" +
             indent + ""    }\n\n"" +
             indent + ""    static SBE_CONSTEXPR std::uint16_t %1$sId()\n"" +
             indent + ""    {\n"" +
@@ -1414,10 +1426,14 @@
                     indent + ""    }\n\n"" +
                     indent + ""    bool %1$sInActingVersion()\n"" +
                     indent + ""    {\n"" +
+                    indent + ""#if defined(__clang__)\n"" +
                     indent + ""#pragma clang diagnostic push\n"" +
                     indent + ""#pragma clang diagnostic ignored \""-Wtautological-compare\""\n"" +
+                    indent + ""#endif\n"" +
                     indent + ""        return m_actingVersion >= %1$sSinceVersion();\n"" +
+                    indent + ""#if defined(__clang__)\n"" +
                     indent + ""#pragma clang diagnostic pop\n"" +
+                    indent + ""#endif\n"" +
                     indent + ""    }\n\n"",
                     propertyName,
                     signalToken.version()));",0
Fix incorrect conditional check," 
     public TomcatConfiguration(ProfilerConfig config) {
         this.tomcatHidePinpointHeader = config.readBoolean(""profiler.tomcat.hidepinpointheader"", true);
-        if (config.getTomcatExcludeProfileMethodFilter() == null) {
+        Filter<String> tomcatExcludeUrlFilter = config.getTomcatExcludeUrlFilter();
+        if (tomcatExcludeUrlFilter == null) {
             this.tomcatExcludeUrlFilter = new SkipFilter<String>();
         } else {
-            this.tomcatExcludeUrlFilter = config.getTomcatExcludeUrlFilter();
+            this.tomcatExcludeUrlFilter = tomcatExcludeUrlFilter;
         }
     }
 ",0
Delay count wasn't set to 0 when reset() was called.," 		setState(State.PAUSED);
 		mElapsedTime = 0;
 		mIsStarted = false;
+        mDelayCount = 0;
 	}
 	
 	/**",0
WIP: Debug visualizer improvements," import org.rajawali3d.materials.Material;
 import org.rajawali3d.math.Matrix4;
 import org.rajawali3d.math.vector.Vector3;
+import org.rajawali3d.primitives.Sphere;
 
 import java.nio.FloatBuffer;
 import java.util.Stack;
@@ -15,7 +16,11 @@
  * @author dennis.ippel
  */
 public class DebugCamera extends DebugObject3D {
+
     private Camera mCamera;
+    private Sphere mPositionBall;
+    private Material mMaterial;
+
     protected Vector3[] mFrustumCornersTransformed;
 
     public DebugCamera(Camera camera) {
@@ -24,13 +29,19 @@
 
     public DebugCamera(Camera camera, int color, int lineThickness) {
         super(color, lineThickness);
+        mMaterial = new Material();
         mCamera = camera;
+        mPositionBall = new Sphere(0.25f, 8, 8);
+        mPositionBall.setColor(color);
+        mPositionBall.setMaterial(mMaterial);
     }
 
     public void updateFrustum() {
         mCamera.setProjectionMatrix(mRenderer.getOverrideViewportWidth(), mRenderer.getOverrideViewportHeight());
         if (mPoints == null) {
-            if(!mCamera.isInitialized()) return;
+            if (!mCamera.isInitialized()) {
+                return;
+            }
 
             mPoints = new Stack<>();
             mFrustumCornersTransformed = new Vector3[8];
@@ -44,7 +55,7 @@
 
             getGeometry().changeBufferUsage(mGeometry.getVertexBufferInfo(), GLES20.GL_DYNAMIC_DRAW);
 
-            setMaterial(new Material());
+            setMaterial(mMaterial);
         }
 
         mCamera.getFrustumCorners(mFrustumCornersTransformed, true, true);
@@ -85,7 +96,8 @@
     public void render(Camera camera, final Matrix4 vpMatrix, final Matrix4 projMatrix,
                        final Matrix4 vMatrix, final Matrix4 parentMatrix, Material sceneMaterial) {
         updateFrustum();
-
+        mPositionBall.setPosition(mCamera.getPosition());
+        mPositionBall.render(camera, vpMatrix, projMatrix, vMatrix, parentMatrix, sceneMaterial);
         super.render(camera, vpMatrix, projMatrix, vMatrix, parentMatrix, sceneMaterial);
     }
 }",0
Fixed dropped Twitter error code 89 when using a revoked token,"     HttpResponseImpl(HttpURLConnection con, HttpClientConfiguration conf) throws IOException {
         super(conf);
         this.con = con;
+        try {
         this.statusCode = con.getResponseCode();
+        } catch (IOException e) {
+          /*
+           * If the user has revoked the access token in use, then Twitter naughtily returns a 401 with no ""WWW-Authenticate"" header.
+           *
+           * This causes an IOException in the getResponseCode() method call. See https://dev.twitter.com/issues/1114
+           * This call can, however, me made a second time without exception.
+           */
+          if (""Received authentication challenge is null"".equals(e.getMessage())) {
+            this.statusCode = con.getResponseCode();
+          } else {
+            throw e;
+          }
+        }
         if (null == (is = con.getErrorStream())) {
             is = con.getInputStream();
         }",0
Fix the Rhino autodetection feature,"       provideIfDesired(new Network(mContext));
       provideIfDesired(new Page(mContext));
       provideIfDesired(new Profiler());
-      provideIfDesired(new Runtime());
+      provideIfDesired(new Runtime(mContext));
       provideIfDesired(new Worker());
       if (Build.VERSION.SDK_INT >= DatabaseConstants.MIN_API_LEVEL) {
         provideIfDesired(new Database(mContext, new DefaultDatabaseFilesProvider(mContext)));",0
Fix Array index out of bounds exception in TextureManager," package org.rajawali3d.materials.textures;
 
 import java.util.Collections;
+import java.util.Iterator;
 import java.util.List;
 import java.util.concurrent.CopyOnWriteArrayList;
 
@@ -200,13 +201,12 @@
 	 * {@link Renderer}.
 	 */
 	public void taskReload() {
-		int len = mTextureList.size();
-		for (int i = 0; i < len; i++) {
-			ATexture texture = mTextureList.get(i);
+		Iterator<ATexture> iterator = mTextureList.iterator();
+
+		while (iterator.hasNext()) {
+			ATexture texture = iterator.next();
 			if (texture.willRecycle()) {
-				mTextureList.remove(i);
-				i -= 1;
-				len -= 1;
+				iterator.remove();
 			} else {
 				taskAdd(texture, true);
 			}",0
Fixes the grateful shutdown of cas,"     private CasConfigurationProperties casProperties;
 
     @Bean
-    public DelegatingAuditTrailManager auditTrailManager() {
+    public JdbcAuditTrailManager jdbcAuditTrailManager() {
         final AuditProperties.Jdbc jdbc = casProperties.getAudit().getJdbc();
         final JdbcAuditTrailManager t = new JdbcAuditTrailManager(inspektrAuditTransactionTemplate());
         t.setCleanupCriteria(auditCleanupCriteria());
@@ -55,7 +55,12 @@
             tableName = jdbc.getDefaultCatalog() + '.' + tableName;
         }
         t.setTableName(tableName);
-        return new DefaultDelegatingAuditTrailManager(t);
+        return t;
+    }
+
+    @Bean
+    public DelegatingAuditTrailManager auditTrailManager() {
+        return new DefaultDelegatingAuditTrailManager(jdbcAuditTrailManager());
     }
 
     @Lazy",0
Prevent NPE in recent clan chats when var is null," 	{
 		if (strChanged.getIndex() == VarClientStr.RECENT_CLAN_CHAT.getIndex() && config.recentChats())
 		{
-			updateRecentChat(Text.toJagexName(client.getVar(VarClientStr.RECENT_CLAN_CHAT)));
+			updateRecentChat(client.getVar(VarClientStr.RECENT_CLAN_CHAT));
 		}
 	}
 
@@ -215,6 +215,8 @@
 			return;
 		}
 
+		s = Text.toJagexName(s);
+
 		chats.removeIf(s::equalsIgnoreCase);
 		chats.add(s);
 ",0
Fix build,"     }
 
     public String getRecentlyPlayedCutoffText(Context context) {
-        return getCutoffText(LAST_PLAYED_CUTOFF, context);
+        return getCutoffText(RECENTLY_PLAYED_CUTOFF, context);
     }
 
     private String getCutoffText(final String cutoff, Context context) {",0
Fix logger.debug call to provide right number of arguments,"                     throw new RuntimeException(e);
                 }
                 if (logger.isDebugEnabled()) {
-                    logger.debug(""shardId={} failed to execute upsert for id={}"", e, request.shardId(), item.id());
+                    logger.debug(""Failed to execute upsert shardId={} id={} error={}"", request.shardId(), item.id(), e);
                 }
 
                 // *mark* the item as failed by setting the source to null",0
fix ,"         ThemeHelper.setCursorColor(editTextPassword, activity.getTextColor());
         editTextPassword.getBackground().mutate().setColorFilter(activity.getTextColor(), PorterDuff.Mode.SRC_ATOP);
         editTextPassword.setTextColor(activity.getTextColor());
-
+        fingerprintIcon.setColor(activity.getIconColor());
 
         builder.setView(view);
 
@@ -102,6 +102,7 @@
                 fingerprintHandler.setOnFingerprintResult(new FingerprintHandler.CallBack() {
                     @Override
                     public void onSuccess() {
+                        hideKeyboard(activity, editTextPassword.getWindowToken());
                         dialog.dismiss();
                         passwordInterface.onAuthenticated();
                     }",0
[BACKLOG-184] - Fixed bug with message.properties reference,"   }
 
   protected ObjectId renameJob( ObjectId objectId, RepositoryDirectory directory, String name ) throws Exception {
-    String comment = BaseMessages.getString( REPOSITORY_PKG, ""Repository.RenameFromTo"", super.getName(), name );
+    String comment = BaseMessages.getString( REPOSITORY_PKG, ""Repository.Rename"", super.getName(), name );
     return rep.renameJob( this.getObjectId(), comment, getRepositoryDirectory(), name );
   }
 ",0
Fixed getting the position in PulsarKafkaConsumer when we don't have an offset yet," 
     @Override
     public long position(TopicPartition partition) {
-        return lastReceivedOffset.get(partition);
+        Long offset = lastReceivedOffset.get(partition);
+        return offset != null ? offset : -1l;
     }
 
     @Override",0
Fix modifyList(Optional) infinite recursion,"     }
 
     private <N extends Node> NodeList<N> modifyList(Optional<NodeList<N>> list, A arg) {
-        return list.map( ns -> modifyList(list, arg)).orElse(null);
+        return list.map(ns -> modifyList(ns, arg)).orElse(null);
     }
 }
 ",0
Fix ASM SignatureReader choking on invalid lambda local var signatures emitted by JDT,"         String methodDescriptor = name+desc;
         return methodMap!=null && methodMap.containsKey(methodDescriptor) ? methodMap.get(methodDescriptor) : name;
     }
+    
+    @Override
+    public String mapSignature(String signature, boolean typeSignature)
+    {
+        // JDT decorates some lambdas with this and SignatureReader chokes on it
+        if (signature != null && signature.contains(""!*""))
+        {
+            return null;
+        }
+        return super.mapSignature(signature, typeSignature);
+    }
 
     private Map<String,String> getFieldMap(String className)
     {",0
Get the first empty in the loader threads SparseArray and use it as ID for the new thread.," import java.util.concurrent.Executors;
 import java.util.concurrent.ScheduledExecutorService;
 import java.util.concurrent.TimeUnit;
+import java.util.concurrent.atomic.AtomicInteger;
 
 import javax.microedition.khronos.egl.EGL10;
 import javax.microedition.khronos.egl.EGLConfig;
@@ -123,6 +124,11 @@
 
     private long mRenderStartTime;
 
+    /**
+     * Keep track of IDs in {@link Renderer#mLoaderThreads}
+     */
+    private AtomicInteger mLastLoaderId = new AtomicInteger();
+
     private final boolean mHaveRegisteredForResources;
 
     public static int getMaxLights() {
@@ -549,7 +555,7 @@
         loader.setTag(tag);
 
         try {
-            final int id = mLoaderThreads.size();
+            final int id = mLastLoaderId.getAndIncrement();
             final ModelRunnable runnable = new ModelRunnable(loader, id);
 
             mLoaderThreads.put(id, runnable);",0
Fix missing render update issue,"         int maxHeight = rowHeight * maxNumRows + headerHeight;
         checkArgument(maxHeight >= minHeight, ""maxHeight cannot be smaller as minHeight"");
         int height = Math.min(maxHeight, Math.max(minHeight, size * rowHeight + headerHeight));
-        tableView.setMaxHeight(-1);
-        tableView.setMinHeight(-1);
-        tableView.setMaxHeight(height);
-        tableView.setMinHeight(height);
+
+        tableView.setPrefHeight(-1);
+        tableView.setVisible(false);
+        // We need to delay the setter to the next render frame as otherwise views don' get updated in some cases
+        // Not 100% clear what causes that issue, but seems the requestLayout method is not called otherwise
+        UserThread.execute(() -> {
+            tableView.setPrefHeight(height);
+            tableView.setVisible(true);
+        });
     }
 
     public static Tuple2<ComboBox<TradeCurrency>, Integer> addRegionCountryTradeCurrencyComboBoxes(GridPane gridPane,",0
Fixed an invalid timeout in java.sql.Connection.isValid call,"      */
     private boolean isConnectionAlive(final Connection connection, long timeoutMs)
     {
-        // Set a realistic minimum timeout
-        if (timeoutMs < 500)
+        // java.sql.Connection.isValid timeout is seconds, and can't be zero for timeout to work
+        if (timeoutMs < 1000)
         {
-            timeoutMs = 500;
+            timeoutMs = 1000;
         }
 
         try
         {
             if (jdbc4ConnectionTest)
             {
-                return connection.isValid((int) timeoutMs * 1000);
+                return connection.isValid((int) timeoutMs / 1000);
             }
 
             Statement statement = connection.createStatement();",0
Use ItemVariations when using Reset option for shift-click," 
 	private void unsetSwapConfig(int itemId)
 	{
+		itemId = ItemVariationMapping.map(itemId);
 		configManager.unsetConfiguration(CONFIG_GROUP, ITEM_KEY_PREFIX + itemId);
 	}
 ",0
Fix mDNS," 
   public MdnsUrlDeviceDiscoverer(Context context) {
     mState = State.STOPPED;
-    resolver = new DiscoverResolver(context, MDNS_SERVICE_TYPE,
+    mResolver = new DiscoverResolver(context, MDNS_SERVICE_TYPE,
         new DiscoverResolver.Listener() {
       @Override
       public void onServicesChanged(Map<String, MDNSDiscover.Result> services) {
@@ -78,7 +78,7 @@
       return;
     }
     mState = State.WAITING;
-    resolver.start();
+    mResolver.start();
   }
 
   @Override
@@ -87,6 +87,6 @@
       return;
     }
     mState = State.WAITING;
-    resolver.stop();
+    mResolver.stop();
   }
 }",0
Fix jukebox message being too low,"             if (opacity > 0)
             {
                 GlStateManager.pushMatrix();
-                GlStateManager.translate((float)(width / 2), (float)(height - 48), 0.0F);
+                GlStateManager.translate((float)(width / 2), (float)(height - 68), 0.0F);
                 GlStateManager.enableBlend();
                 GlStateManager.tryBlendFuncSeparate(GL11.GL_SRC_ALPHA, GL11.GL_ONE_MINUS_SRC_ALPHA, 1, 0);
                 int color = (recordIsPlaying ? Color.HSBtoRGB(hue / 50.0F, 0.7F, 0.6F) & WHITE : WHITE);",0
"fix:when local is china or chinese, week name display fault!","             int calendarDay = (i + mWeekStart) % mNumDays;
             int x = (2 * i + 1) * dayWidthHalf + mEdgePadding;
             mDayLabelCalendar.set(Calendar.DAY_OF_WEEK, calendarDay);
-            canvas.drawText(mDayLabelCalendar.getDisplayName(Calendar.DAY_OF_WEEK, Calendar.SHORT,
-                    Locale.getDefault()).toUpperCase(Locale.getDefault()).substring(0,1), x, y,
-                    mMonthDayLabelPaint);
+            Locale locale = Locale.getDefault();
+            String localWeekDisplayName = mDayLabelCalendar.getDisplayName(Calendar.DAY_OF_WEEK, Calendar.SHORT, locale);
+            String weekString = localWeekDisplayName.toUpperCase(locale).substring(0, 1);
+            if (locale.equals(Locale.CHINA) || locale.equals(Locale.CHINESE) || locale.equals(Locale.SIMPLIFIED_CHINESE) || locale.equals(Locale.TRADITIONAL_CHINESE)) {
+                int len = localWeekDisplayName.length();
+                weekString = localWeekDisplayName.substring(len -1, len);
+            }
+            canvas.drawText(weekString, x, y, mMonthDayLabelPaint);
         }
     }
 ",0
signSafeMod while getting next-broker index in discovery service,"  */
 package com.yahoo.pulsar.discovery.service.web;
 
+import static org.apache.bookkeeper.util.MathUtils.signSafeMod;
+
 import java.io.IOException;
 import java.net.URI;
 import java.net.URISyntaxException;
@@ -151,7 +153,7 @@
             throw new RestException(Status.SERVICE_UNAVAILABLE, ""No active broker is available"");
         } else {
             int brokersCount = availableBrokers.size();
-            int nextIdx = Math.abs(counter.getAndIncrement()) % brokersCount;
+            int nextIdx = signSafeMod(counter.getAndIncrement(), brokersCount);
             return availableBrokers.get(nextIdx);
         }
     }",0
KEYCLOAK-8048 Fix testsuite compilation issue,"     @Override
     public void logout() {
         log.info(""performing logout from Google"");
-        navigateToUri(""https://www.google.com/accounts/Logout"", false);
+        navigateToUri(""https://www.google.com/accounts/Logout"");
     }
 }",0
Fix compile error in AsyncSagaEventProcessor,"                     // deadlock if a thread is waiting for the lock and we need its vote.
                     boolean owned = ownedByCurrentProcessor(entry.getNewSaga().getSagaIdentifier());
                     if (owned && !sagaInvoked) {
-                        persistBatch(sequence);
+                        persistSagasWithRetry(sequence);
                     }
                     boolean shouldCreate = entry.waitForSagaCreationVote(sagaInvoked, processorCount, owned);
                     if (shouldCreate) {",0
Fix a performance degradation introduced by PR #183,"             return;
         }
 
-        if (log != null) {
+        if (log != null && log.isDebugEnabled()) {
             log.debug(""going to scan these urls:\n{}"", Joiner.on(""\n"").join(configuration.getUrls()));
         }
 ",0
Android: fix cancellation handling," 
     // user cancel
     if (resultCode != Activity.RESULT_OK) {
-      responseHelper.invokeResponse(callback);
+      responseHelper.invokeCancel(callback);
       callback = null;
       return;
     }",0
Fix small derp,"     public static double getFlowDirection(IBlockAccess world, int x, int y, int z)
     {
         Block block = Block.blocksList[world.getBlockId(x, y, z)];
-        if (world.getBlockMaterial(x, y, z).isLiquid())
+        if (!world.getBlockMaterial(x, y, z).isLiquid())
         {
             return -1000.0;
         }",0
Better (more complete) fix for handling of MongoDb connection string (clientUri),"     }
 
     /**
-     * Build mongo template mongo template.
+     * Build mongo template.
      *
-     * @param mongo the mongo
+     * @param mongo the mongo properties settings
      * @return the mongo template
      */
     public MongoTemplate buildMongoTemplate(final BaseMongoDbProperties mongo) {
@@ -101,16 +101,13 @@
     }
 
     /**
-     * Build mongo template mongo template.
+     * Build mongo template.
      *
      * @param clientUri the client uri
      * @return the mongo template
      */
     public MongoTemplate buildMongoTemplate(final String clientUri) {
-        final MongoClientURI uri = buildMongoClientURI(clientUri);
-        final Mongo mongo = buildMongoDbClient(clientUri, buildMongoDbClientOptions());
-        final MongoDbFactory mongoDbFactory = mongoDbFactory(mongo, uri.getDatabase());
-        return new MongoTemplate(mongoDbFactory, mappingMongoConverter(mongoDbFactory));
+        return buildMongoTemplate(new ClientUriMongoDbProperties(clientUri));
     }
 
     /**
@@ -150,11 +147,15 @@
 
     private MongoDbFactory mongoDbFactory(final Mongo mongo, final BaseMongoDbProperties props) {
         final String dbName;
+        final String authDbName;
+
         if (StringUtils.isNotBlank(props.getClientUri())) {
-            final MongoClientURI uri = buildMongoClientURI(props.getClientUri());
+            final MongoClientURI uri = buildMongoClientURI(props.getClientUri(), buildMongoDbClientOptions(props));
+            authDbName = uri.getCredentials().getSource();
             dbName = uri.getDatabase();
             LOGGER.debug(""Using database [{}] from the connection client URI"", dbName);
         } else {
+            authDbName = props.getAuthenticationDatabaseName();
             dbName = props.getDatabaseName();
             LOGGER.debug(""Using database [{}] from individual settings"", dbName);
         }
@@ -163,11 +164,8 @@
             LOGGER.error(""Database name cannot be undefined. It must be specified as part of the client URI connection string if used, or ""
                 + ""as an individual setting for the MongoDb connection"");
         }
-        return new SimpleMongoDbFactory(mongo, dbName, null, props.getAuthenticationDatabaseName());
-    }
 
-    private MongoDbFactory mongoDbFactory(final Mongo mongo, final String databaseName) {
-        return new SimpleMongoDbFactory(mongo, databaseName, null, null);
+        return new SimpleMongoDbFactory(mongo, dbName, null, authDbName);
     }
 
     private Set<Class<?>> getInitialEntitySet() {
@@ -216,29 +214,87 @@
             : PropertyNameFieldNamingStrategy.INSTANCE;
     }
 
+    /**
+     * Create a MongoClientOptions object.
+     * <p>
+     * The object will be created from a collection of individual property
+     * settings, or a MongoDb client connection string (uri), or some
+     * combination of the two.
+     * <p>
+     * This is complicated by the fact that the default values provided by
+     * the CAS code in BaseMongoDbProperties.java are not the same as the
+     * default values for the corresponding options provided by the MongoDb
+     * Java driver when it creates a MongoClientOptions object.
+     * <p>
+     * To ensure predictable results in all cases, we initialize the client
+     * options from the individual property settings (even if just the CAS
+     * default values), and then use those values as the starting point to
+     * process the client uri (if one is provided). This way, any options
+     * in the uri will override the earlier ones, but any options missing
+     * from the uri will have the values (default or user-provided) from
+     * the individual property settings.
+     * <p>
+     * This behavior matches the comment in BaseMongoDbProperties.java for
+     * the clientUri property: ""If not specified, will fallback onto other
+     * individual settings. If specified, takes over all other settings
+     * where applicable.""
+     *
+     * @param mongo the property setttings (including, perhaps, a client uri)
+     * @return a bean containing the MongoClientOptions object
+     */
     @SneakyThrows
     private MongoClientOptionsFactoryBean buildMongoDbClientOptionsFactoryBean(final BaseMongoDbProperties mongo) {
 
-        final MongoClientOptionsFactoryBean bean = new MongoClientOptionsFactoryBean();
-        bean.setWriteConcern(WriteConcern.valueOf(mongo.getWriteConcern()));
-        bean.setHeartbeatConnectTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
-        bean.setHeartbeatSocketTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
-        bean.setMaxConnectionLifeTime(mongo.getConns().getLifetime());
-        bean.setSocketKeepAlive(mongo.isSocketKeepAlive());
-        bean.setMaxConnectionIdleTime((int) Beans.newDuration(mongo.getIdleTimeout()).toMillis());
-        bean.setConnectionsPerHost(mongo.getConns().getPerHost());
-        bean.setSocketTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
-        bean.setConnectTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
-        if (StringUtils.isNotBlank(mongo.getReplicaSet())) {
-            bean.setRequiredReplicaSetName(mongo.getReplicaSet());
-        }
-        bean.setSsl(mongo.isSslEnabled());
-        if (mongo.isSslEnabled()) {
-            bean.setSslSocketFactory((SSLSocketFactory) SSLSocketFactory.getDefault());
-        }
-        bean.afterPropertiesSet();
-        return bean;
+        final MongoClientOptionsFactoryBean bean1 = new MongoClientOptionsFactoryBean();
 
+        bean1.setWriteConcern(WriteConcern.valueOf(mongo.getWriteConcern()));
+        bean1.setHeartbeatConnectTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
+        bean1.setHeartbeatSocketTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
+        bean1.setMaxConnectionLifeTime(mongo.getConns().getLifetime());
+        bean1.setSocketKeepAlive(mongo.isSocketKeepAlive());
+        bean1.setMaxConnectionIdleTime((int) Beans.newDuration(mongo.getIdleTimeout()).toMillis());
+        bean1.setConnectionsPerHost(mongo.getConns().getPerHost());
+        bean1.setSocketTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
+        bean1.setConnectTimeout((int) Beans.newDuration(mongo.getTimeout()).toMillis());
+        if (StringUtils.isNotBlank(mongo.getReplicaSet())) {
+            bean1.setRequiredReplicaSetName(mongo.getReplicaSet());
+        }
+        bean1.setSsl(mongo.isSslEnabled());
+        if (mongo.isSslEnabled()) {
+            bean1.setSslSocketFactory((SSLSocketFactory) SSLSocketFactory.getDefault());
+        }
+
+        bean1.afterPropertiesSet();
+
+        if (StringUtils.isNotBlank(mongo.getClientUri())) {
+            final MongoClientOptionsFactoryBean bean2 = new MongoClientOptionsFactoryBean();
+
+            final MongoClientURI uri = buildMongoClientURI(mongo.getClientUri(), bean1.getObject());
+            final MongoClientOptions opts = uri.getOptions();
+
+            bean2.setWriteConcern(opts.getWriteConcern());
+            bean2.setHeartbeatConnectTimeout(opts.getHeartbeatConnectTimeout());
+            bean2.setHeartbeatSocketTimeout(opts.getHeartbeatSocketTimeout());
+            bean2.setMaxConnectionLifeTime(opts.getMaxConnectionLifeTime());
+            bean2.setSocketKeepAlive(opts.isSocketKeepAlive());
+            bean2.setMaxConnectionIdleTime(opts.getMaxConnectionIdleTime());
+            bean2.setConnectionsPerHost(opts.getConnectionsPerHost());
+            bean2.setSocketTimeout(opts.getSocketTimeout());
+            bean2.setConnectTimeout(opts.getConnectTimeout());
+            bean2.setRequiredReplicaSetName(opts.getRequiredReplicaSetName());
+            bean2.setSsl(opts.isSslEnabled());
+
+            if (opts.isSslEnabled()) {
+                bean2.setSslSocketFactory((SSLSocketFactory) SSLSocketFactory.getDefault());
+            }
+
+            bean2.afterPropertiesSet();
+            bean1.destroy();
+
+            return bean2;
+        }
+
+        return bean1;
     }
 
     @SneakyThrows
@@ -299,12 +355,16 @@
         return MongoCredential.createCredential(mongo.getUserId(), dbName, mongo.getPassword().toCharArray());
     }
 
-    private MongoClientURI buildMongoClientURI(final String clientUri) {
-        return new MongoClientURI(clientUri);
-    }
-
     private MongoClientURI buildMongoClientURI(final String clientUri, final MongoClientOptions clientOptions) {
         final MongoClientOptions.Builder builder = new MongoClientOptions.Builder(clientOptions);
         return new MongoClientURI(clientUri, builder);
     }
+
+    private static class ClientUriMongoDbProperties extends BaseMongoDbProperties {
+        private static final long serialVersionUID = -9182480568666563805L;
+
+        ClientUriMongoDbProperties(final String clientUri) {
+            setClientUri(clientUri);
+        }
+    }
 }",0
Fix broken headings in Markdown files," 		case VIEW:
 			break;
 		case CHECKPOINT:
+			if (""127.0.0.1"".equals(ctx.getHttpServletRequest().getRemoteAddr())) {
 			m_receiver.destory();
 			m_realtimeConsumer.doCheckpoint();
+			}
 			break;
 		default:
 			break;",0
Use correct parameter order to fix converter validation," 
 		boolean formConverterFound = false;
 
-		TypeElement formConverter = annotationHelper.getElementUtils().getTypeElement(FORM_HTTP_MESSAGE_CONVERTER);
+		TypeMirror formConverter = annotationHelper.getElementUtils().getTypeElement(FORM_HTTP_MESSAGE_CONVERTER).asType();
 
 		for (DeclaredType converter : converters) {
-			if (formConverter != null && annotationHelper.isSubtype(formConverter.asType(), converter)) {
+			if (formConverter != null && annotationHelper.isSubtype(converter, formConverter)) {
 				formConverterFound = true;
 				break;
 			}",0
Fixed docs,"    *
    * The {@code mapper} is called with the completed value and this mapper returns a value. This value will complete the result returned by this method call.<p>
    *
-   * If the {@code mapper} throws an exception, the returned future will be failed with this exception.<p>
-   *
-   * When this async result is failed, the failure will be propagated to the returned future and the {@code mapper}
-   * will not be called.
+   * When this async result is failed, the failure will be propagated to the returned async result and the {@code mapper} will not be called.
    *
    * @param mapper the mapper function
    * @return the mapped async result
@@ -139,10 +136,7 @@
    *
    * The {@code mapper} is called with the failure and this mapper returns a value. This value will complete the result returned by this method call.<p>
    *
-   * If the {@code mapper} throws an exception, the returned future will be failed with this exception.<p>
-   *
-   * When this async result is succeeded, the value will be propagated to the returned future and the {@code mapper}
-   * will not be called.
+   * When this async result is succeeded, the value will be propagated to the returned async result and the {@code mapper} will not be called.
    *
    * @param mapper the mapper function
    * @return the mapped async result",0
Fixed NPE with fat Jar and clean working folder,"     }
 
     public static void populateLibsDirectory() {
-        if (libsDir() != null)
+        if (libsDir() != null && libsDir().exists())
             for (File f : libsDir().listFiles()) {
                 libsList.add(f.getName());
                 libsFileList.add(f.getAbsolutePath());",0
Fix ground markers getting set at wrong position," 			return;
 		}
 
-		WorldPoint worldPoint = WorldPoint.fromLocalInstance(client, client.getLocalPlayer().getLocalLocation());
+		WorldPoint worldPoint = WorldPoint.fromLocalInstance(client, localPoint);
 
 		int regionId = worldPoint.getRegionID();
 		GroundMarkerPoint point = new GroundMarkerPoint(regionId, worldPoint.getX() & 0x3f, worldPoint.getY() & 0x3f, client.getPlane());",0
"fix the issue: ""Timeouts in CoordinatedBolt can cause NPE later on""","         public void ack(Tuple tuple) {
             Object id = tuple.getValue(0);
             synchronized(_tracked) {
-                _tracked.get(id).receivedTuples++;
+                TrackingInfo track = _tracked.get(id);
+                if (track != null)
+                    track.receivedTuples++;
             }
             boolean failed = checkFinishId(tuple);
             if(failed) {
@@ -98,7 +100,9 @@
         public void fail(Tuple tuple) {
             Object id = tuple.getValue(0);
             synchronized(_tracked) {
-                _tracked.get(id).failed = true;
+                TrackingInfo track = _tracked.get(id);
+                if (track != null)
+                    track.failed = true;
             }
             _delegate.fail(tuple);
         }
@@ -110,7 +114,9 @@
 
         private void updateTaskCounts(Object id, List<Integer> tasks) {
             synchronized(_tracked) {
-                Map<Integer, Integer> taskEmittedTuples = _tracked.get(id).taskEmittedTuples;
+                TrackingInfo track = _tracked.get(id);
+                if (track != null) {
+                    Map<Integer, Integer> taskEmittedTuples = track.taskEmittedTuples;
                 for(Integer task: tasks) {
                     int newCount = get(taskEmittedTuples, task, 0) + 1;
                     taskEmittedTuples.put(task, newCount);
@@ -118,6 +124,7 @@
             }
         }
     }
+    }
 
     private Map<String, SourceArgs> _sourceArgs;
     private IdStreamSpec _idStreamSpec;",0
Fixed AndroidVisibilityListener's Javadoc," import android.view.View;
 
 /**
- * Allows immersive mode support while maintaining Android 1.5 compatibility
+ * Allows immersive mode support while maintaining compatibility with Android versions before API Level 19 (4.4)
  * @author Unkn0wn0ne
  */
 public class AndroidVisibilityListener {",0
Keep all entries when decoding a user," 	 * @return the user
 	 */
 	protected static User decode(int contextId, String encodedString, ExtensionAuthentication authenticationExtension) {
-		String[] pieces = encodedString.split(FIELD_SEPARATOR);
+		String[] pieces = encodedString.split(FIELD_SEPARATOR, -1);
 		User user = null;
 		try {
 			int id = Integer.parseInt(pieces[0]);",0
Fix check that would always be false,"                 if (bs.isCancelled()) {
                     break;
                 }
-                if (o == BlockingSubscriber.TERMINATED
+                if (v == BlockingSubscriber.TERMINATED
                         || NotificationLite.acceptFull(v, subscriber)) {
                     break;
                 }",0
Patch 1," 
   public OCommandScript(final String iLanguage, final String iText) {
     super(iText);
-    language = iLanguage;
+    setLanguage(iLanguage);
     useCache = true;
   }
 
   public OCommandScript(final String iText) {
-    super(iText);
+    this(""sql"", iText);
   }
 
   public boolean isIdempotent() {
@@ -63,6 +63,9 @@
   }
 
   public OCommandScript setLanguage(String language) {
+    if (language == null || language.isEmpty()) {
+     throw new IllegalArgumentException(""Not a valid script language specified: "" + language);
+    }
     this.language = language;
     return this;
   }",0
Issue 2227 fix," 	}
 
 	private void parseMeshes (ModelData model, JsonValue json) {
-		JsonValue meshes = json.require(""meshes"");
+		JsonValue meshes = json.get(""meshes"");
+        if(meshes != null) {
 
 		model.meshes.ensureCapacity(meshes.size);
 		for (JsonValue mesh = meshes.child; mesh != null; mesh = mesh.next) {
@@ -120,6 +121,7 @@
 			model.meshes.add(jsonMesh);
 		}
 	}
+	}
 
 	private int parseType (String type) {
 		if (type.equals(""TRIANGLES"")) {
@@ -273,14 +275,13 @@
 
 	private Array<ModelNode> parseNodes (ModelData model, JsonValue json) {
 		JsonValue nodes = json.get(""nodes"");
-		if (nodes == null) {
-			throw new GdxRuntimeException(""At least one node is required."");
-		}
-
+		if (nodes != null) {
 		model.nodes.ensureCapacity(nodes.size);
 		for (JsonValue node = nodes.child; node != null; node = node.next) {
 			model.nodes.add(parseNodesRecursively(node));
 		}
+        }
+        
 		return model.nodes;
 	}
 ",0
Fix NPE in HeapAnalyzerService," import android.app.IntentService;
 import android.content.Context;
 import android.content.Intent;
+import android.util.Log;
 import com.squareup.leakcanary.AbstractAnalysisResultService;
 import com.squareup.leakcanary.AnalysisResult;
 import com.squareup.leakcanary.ExcludedRefs;
@@ -34,6 +35,7 @@
 
   private static final String LISTENER_CLASS_EXTRA = ""listener_class_extra"";
   private static final String HEAPDUMP_EXTRA = ""heapdump_extra"";
+  public static final String TAG = ""HeapAnalyzerService"";
 
   public static void runAnalysis(Context context, HeapDump heapDump,
       Class<? extends AbstractAnalysisResultService> listenerServiceClass) {
@@ -48,6 +50,10 @@
   }
 
   @Override protected void onHandleIntent(Intent intent) {
+    if (intent == null) {
+      Log.d(TAG, ""HeapAnalyzerService received a null intent, ignoring."");
+      return;
+    }
     String listenerClassName = intent.getStringExtra(LISTENER_CLASS_EXTRA);
     HeapDump heapDump = (HeapDump) intent.getSerializableExtra(HEAPDUMP_EXTRA);
 ",0
Add null response caching to CachingResourceResolver," @Component(""blCacheResourceResolver"")
 public class BroadleafCachingResourceResolver extends CachingResourceResolver implements Ordered {
 
+    public static final String RESOLVED_RESOURCE_CACHE_KEY_PREFIX_NULL = ""resolvedResourceNull:"";
+    public static final String RESOLVED_URL_PATH_CACHE_KEY_PREFIX_NULL = ""resolvedUrlPathNull:"";
+    private static final Object NULL_REFERENCE = new Object();
     protected static final Log LOG = LogFactory.getLog(BroadleafCachingResourceResolver.class);
     private int order = BroadleafResourceResolverOrder.BLC_CACHE_RESOURCE_RESOLVER;
     
@@ -73,7 +76,23 @@
     protected Resource resolveResourceInternal(HttpServletRequest request, String requestPath,
             List<? extends Resource> locations, ResourceResolverChain chain) {
         if (resourceCachingEnabled) {
-            return super.resolveResourceInternal(request, requestPath, locations, chain);
+            String key = RESOLVED_RESOURCE_CACHE_KEY_PREFIX_NULL + requestPath;
+            Object nullResource = getCache().get(key, Object.class);
+            if (nullResource != null) {
+                if (logger.isTraceEnabled()) {
+                    logger.trace(String.format(""Found null reference resource match for '%s'"", requestPath));
+                }
+                return null;
+            } else {
+                Resource response = super.resolveResourceInternal(request, requestPath, locations, chain);
+                if (response == null) {
+                    if (logger.isTraceEnabled()) {
+                        logger.trace(String.format(""Putting resolved null reference resource in cache for '%s'"", requestPath));
+                    }
+                    getCache().put(key, NULL_REFERENCE);
+                }
+                return response;
+            }
         } else {
             return chain.resolveResource(request, requestPath, locations);
         }
@@ -83,7 +102,23 @@
     protected String resolveUrlPathInternal(String resourceUrlPath,
             List<? extends Resource> locations, ResourceResolverChain chain) {
         if (resourceCachingEnabled) {
-            return super.resolveUrlPathInternal(resourceUrlPath, locations, chain);
+            String key = RESOLVED_URL_PATH_CACHE_KEY_PREFIX_NULL + resourceUrlPath;
+            Object nullResource = getCache().get(key, Object.class);
+            if (nullResource != null) {
+                if (logger.isTraceEnabled()) {
+                    logger.trace(String.format(""Found null reference url path match for '%s'"", resourceUrlPath));
+                }
+                return null;
+            } else {
+                String response = super.resolveUrlPathInternal(resourceUrlPath, locations, chain);
+                if (response == null) {
+                    if (logger.isTraceEnabled()) {
+                        logger.trace(String.format(""Putting resolved null reference url path in cache for '%s'"", resourceUrlPath));
+                    }
+                    getCache().put(key, NULL_REFERENCE);
+                }
+                return response;
+            }
         } else {
             return chain.resolveUrlPath(resourceUrlPath, locations);
         }",0
CAMEL-11198 Fix issue with propagating the trace context when using h…,"                 if (event instanceof ExchangeSendingEvent) {
                     ExchangeSendingEvent ese = (ExchangeSendingEvent) event;
                     SpanManager.ManagedSpan parent = spanManager.current();
+                    if (ese.getExchange().getProperties().containsKey(MANAGED_SPAN_PROPERTY)) {
+                        parent = (SpanManager.ManagedSpan)
+                                ese.getExchange().getProperty(MANAGED_SPAN_PROPERTY);
+                    }
                     SpanDecorator sd = getSpanDecorator(ese.getEndpoint());
                     if (!sd.newSpan()) {
                         return;
@@ -270,7 +274,6 @@
                 // Check if continuing exchange on same thread
                 if (exchange.getProperties().containsKey(MANAGED_SPAN_PROPERTY)) {
                     spanManager.activate((SpanManager.ManagedSpan)exchange.getProperty(MANAGED_SPAN_PROPERTY));
-                    exchange.setProperty(MANAGED_SPAN_PROPERTY, null);
                 }
                 SpanDecorator sd = getSpanDecorator(route.getEndpoint());
                 Span span = tracer.buildSpan(sd.getOperationName(exchange, route.getEndpoint()))
@@ -279,7 +282,7 @@
                     .withTag(Tags.SPAN_KIND.getKey(), sd.getReceiverSpanKind())
                     .start();
                 sd.pre(span, exchange, route.getEndpoint());
-                spanManager.activate(span);
+                exchange.setProperty(MANAGED_SPAN_PROPERTY, spanManager.activate(span));
                 if (LOG.isTraceEnabled()) {
                     LOG.trace(""OpenTracing: start server span="" + span);
                 }
@@ -301,6 +304,7 @@
                     sd.post(managedSpan.getSpan(), exchange, route.getEndpoint());
                     managedSpan.getSpan().finish();
                     managedSpan.deactivate();
+                    exchange.setProperty(MANAGED_SPAN_PROPERTY, null);
                 } else {
                     LOG.warn(""OpenTracing: could not find managed span for exchange="" + exchange);
                 }",0
Fix NPE when KeyedWeakReference not in dump," 
       // False alarm, weak reference was cleared in between key check and heap dump.
       if (leakingRef == null) {
-        String className = leakingRef.getClassObj().getClassName();
-        return noLeak(className, since(analysisStartNanoTime));
+        return noLeak(""UnknownNoKeyedWeakReference"", since(analysisStartNanoTime));
       }
       return findLeakTrace(analysisStartNanoTime, snapshot, leakingRef, computeRetainedSize);
     } catch (Throwable e) {",0
Fixed dex2jar with filenames containing dex or apk,"     public static synchronized void dex2Jar(File input, File output) {
         try {
             com.googlecode.dex2jar.tools.Dex2jarCmd.main(new String[]{input.getAbsolutePath()});
-            String realOutput = input.getName().replaceAll("".dex"", ""-dex2jar.jar"").replaceAll("".apk"", ""-dex2jar.jar"");
+            String realOutput = input.getName().replaceAll(""\\.dex"", ""-dex2jar.jar"").replaceAll(""\\.apk"", ""-dex2jar.jar"");
             File realOutputF = new File(realOutput);
             realOutputF.renameTo(output);
             File realOutputF2 = new File(realOutput);
@@ -57,7 +57,7 @@
     public static synchronized void saveAsDex(File input, File output) {
         try {
             com.googlecode.dex2jar.tools.Jar2Dex.main(new String[]{input.getAbsolutePath()});
-            String realOutput = input.getName().replaceAll("".jar"", ""-jar2dex.dex"");
+            String realOutput = input.getName().replaceAll(""\\.jar"", ""-jar2dex.dex"");
             File realOutputF = new File(realOutput);
             realOutputF.renameTo(output);
             File realOutputF2 = new File(realOutput);",0
Fix the TGC cookie expiration when remember me is enabled (5.2.x),"     private boolean isRememberMeAuthentication(final RequestContext requestContext) {
         final HttpServletRequest request = WebUtils.getHttpServletRequestFromExternalWebflowContext(requestContext);
         final String value = request.getParameter(RememberMeCredential.REQUEST_PARAMETER_REMEMBER_ME);
-        return StringUtils.isNotBlank(value) || WebUtils.isRememberMeAuthenticationEnabled(requestContext);
+        return StringUtils.isNotBlank(value) && WebUtils.isRememberMeAuthenticationEnabled(requestContext);
     }
 
     /**",0
fix #1308 修复mycat预处理对smallint类型转换出错的BUG," 	}
 
 	public static short getShort(byte[] bytes) {
-		return (short) ((0xff & bytes[0]) | (0xff00 & (bytes[1] << 8)));
+		return Short.parseShort(new String(bytes));
+//		return (short) ((0xff & bytes[0]) | (0xff00 & (bytes[1] << 8)));
 	}
 
 	public static char getChar(byte[] bytes) {",0
(*)fix SaxAsyncHttpResponseHandler charset bug,"                     SAXParser sparser = sfactory.newSAXParser();
                     XMLReader rssReader = sparser.getXMLReader();
                     rssReader.setContentHandler(handler);
-                    inputStreamReader = new InputStreamReader(instream, DEFAULT_CHARSET);
+                    inputStreamReader = new InputStreamReader(instream, getCharset());
                     rssReader.parse(new InputSource(inputStreamReader));
                 } catch (SAXException e) {
                     Log.e(LOG_TAG, ""getResponseData exception"", e);",0
Potential Tab menu fix,"       tab.textWidth = (int)
         font.getStringBounds(tab.text, g2.getFontRenderContext()).getWidth();
     }
-
+/* TODO eliminated 279-302 because it doesn't really work to reduce the tab size (by much anyways)
+ *      and makes it confusing to find the tab you want because the name is hidden
+ *      
     // make sure everything can fit
     if (!placeTabs(MARGIN_WIDTH, tabMax, null)) {
       //System.arraycopy(tabs, 0, visitOrder, 0, tabs.length);
@@ -297,14 +299,19 @@
           break;
         }
       }
-    }
+    }*/
 
     // now actually draw the tabs
-    placeTabs(MARGIN_WIDTH, tabMax, g2);
-
-    // draw the dropdown menu target
+    if(!placeTabs(MARGIN_WIDTH, tabMax - ARROW_TAB_WIDTH, g2)){
+      // draw the dropdown menu target at the right of the window
+      menuRight = tabMax;
+      menuLeft = menuRight - ARROW_TAB_WIDTH;
+    } else {
+      // draw the dropdown menu target next to the tabs
     menuLeft = tabs[tabs.length - 1].right + TAB_BETWEEN;
     menuRight = menuLeft + ARROW_TAB_WIDTH;
+    }
+    
     g.setColor(tabColor[UNSELECTED]);
     drawTab(g, menuLeft, menuRight);
 //    int arrowY = (getHeight() - TAB_HEIGHT - TAB_STRETCH) + (TAB_HEIGHT - ARROW_HEIGHT)/2;
@@ -370,7 +377,7 @@
 //      }
       tab.right = x;
 
-      if (g != null) {
+      if (g != null && tab.right < right) {
         g.setColor(tabColor[state]);
         drawTab(g, tab.left, tab.right);
 //        path.lineTo(x - NOTCH, top);",0
Fixes the initialization of state and remaining fields in case size is zero in the AjpServerRequestConduit constructor.,"         if (size == null) {
             state = STATE_SEND_REQUIRED;
             remaining = -1;
-        } else if (size.equals(0)) {
+        } else if (size.longValue() == 0L) {
             state = STATE_FINISHED;
             remaining = 0;
         } else {",0
Fixing Issue #1564 - Incorrect Version returned for Updated records ,"         case ORecordOperation.UPDATED:
           entry.getRecord().fill(rid, channel.readVersion(), channel.readBytes(), true);
 
-          // SAVE THE RECORD TO RETRIEVE THEM FOR THE NEW VERSIONS TO SEND BACK TO THE REQUESTER
-          updatedRecords.put(rid, entry.getRecord());
           break;
 
         case ORecordOperation.DELETED:
@@ -126,6 +124,10 @@
             ((ODocument) loadedRecord).merge((ODocument) record, false, false);
             loadedRecord.getRecordVersion().copyFrom(record.getRecordVersion());
             entry.getValue().record = loadedRecord;
+            
+            // SAVE THE RECORD TO RETRIEVE THEM FOR THE NEW VERSIONS TO SEND BACK TO THE REQUESTER
+            updatedRecords.put((ORecordId)entry.getKey(), entry.getValue().getRecord());
+            
           }
         }
 ",0
[BACKLOG-21184] Abort step UI fix,"     fdMessage = new FormData();
     fdMessage.left = new FormAttachment( 0, 0 );
     fdMessage.top = new FormAttachment( wlMessage, 5 );
-    fdMessage.right = new FormAttachment( 100, 15 );
+    fdMessage.right = new FormAttachment( 100, 0 );
     wMessage.setLayoutData( fdMessage );
 
     wAlwaysLogRows = new Button( wLoggingGroup, SWT.CHECK );",0
UX-415# Last branch was fetching rest of logs. fixed.,"                         PipelineNodeUtil.isStage(subStepRow.getNode())
                         ||
                         PipelineNodeUtil.isParallelBranch(node) &&
-                            PipelineNodeUtil.isParallelBranch(subStepRow.getNode())
+                            (PipelineNodeUtil.isParallelBranch(subStepRow.getNode()) || PipelineNodeUtil.isStage(subStepRow.getNode()))
                         ){
                         break;
                     }else{",0
Fix to hide uploader correctly," import android.widget.ImageView;
 import android.widget.TextView;
 
-import org.schabi.newpipe.extractor.AbstractVideoInfo;
-import org.schabi.newpipe.extractor.StreamPreviewInfo;
-
 import com.nostra13.universalimageloader.core.DisplayImageOptions;
 import com.nostra13.universalimageloader.core.ImageLoader;
 
+import org.schabi.newpipe.extractor.AbstractVideoInfo;
+import org.schabi.newpipe.extractor.StreamPreviewInfo;
+
 /**
  * Created by Christian Schabesberger on 24.10.15.
  *
@@ -72,7 +72,7 @@
         if(info.uploader != null && !info.uploader.isEmpty()) {
             holder.itemUploaderView.setText(info.uploader);
         } else {
-            holder.itemDurationView.setVisibility(View.INVISIBLE);
+            holder.itemUploaderView.setVisibility(View.INVISIBLE);
         }
         if(info.duration > 0) {
             holder.itemDurationView.setText(getDurationString(info.duration));",0
Now creating OrderItemPriceDetail and OrderItemQualifier in OrderItemDaoImp using entity configuration," 
     @Override
     public OrderItemPriceDetail createOrderItemPriceDetail() {
-        return new OrderItemPriceDetailImpl();
+        return (OrderItemPriceDetail) entityConfiguration.createEntityInstance(OrderItemPriceDetail.class.getName());
     }
 
     @Override
     public OrderItemQualifier createOrderItemQualifier() {
-        return new OrderItemQualifierImpl();
+        return (OrderItemQualifier) entityConfiguration.createEntityInstance(OrderItemQualifier.class.getName());
     }
 
     @Override",0
Bug fix - Relocated ambient light contribution in GouraudMaterial," 		""#endif\n"" +
 		
 		""	vec4 ambient = uAmbientIntensity * uAmbientColor;\n"" + 	    
-		""	gl_FragColor = diffuse + specular;\n"" +
+		""	gl_FragColor = diffuse + specular + ambient;\n"" +
 		
 		""#ifdef ALPHA_MAP\n"" +
 		""	float alpha = texture2D(uAlphaTexture, vTextureCoord).r;\n"" +
@@ -104,7 +104,6 @@
 		""#else\n"" +
 		""	gl_FragColor.a = diffuse.a;\n"" +
 		""#endif\n"" +
-		""	gl_FragColor += ambient;\n"" +
 		M_FOG_FRAGMENT_COLOR +
 		""}"";
 	",0
Changed the Pref Window a little to fix some bugs.,"     this.base = base;
     //dialog = new JDialog(editor, ""Preferences"", true);
     dialog = new JFrame(Language.text(""preferences""));
-    dialog.setResizable(false);
     Container pain = dialog.getContentPane();
     layout = new GroupLayout(pain);// pain ??
-//    layout.setAutoCreateGaps(true);
+    layout.setAutoCreateGaps(true);
     layout.setAutoCreateContainerGaps(true);
 
 //    pain.setLayout(null);
@@ -97,7 +96,8 @@
 //    final int GUI_BETWEEN = Preferences.GUI_BETWEEN;
 //    final int GUI_BIG = Preferences.GUI_BIG;
 //    final int GUI_SMALL = Preferences.GUI_SMALL;
-//    final int BUTTON_WIDTH = Preferences.BUTTON_WIDTH;
+    final int BUTTON_WIDTH = Preferences.BUTTON_WIDTH;
+    final int BORDER = Base.isMacOS() ? 20 : 13;
 
 //    int top = GUI_BIG;
 //    int left = GUI_BIG;
@@ -449,6 +449,7 @@
         memoryField.setEnabled(memoryOverrideBox.isSelected());
       }
     });
+    JLabel mbLabel = new JLabel(""MB"");
 //    memoryBox.add(memoryField);
 //    memoryBox.add(new JLabel("" MB""));
 //    pain.add(memoryBox);
@@ -582,11 +583,12 @@
 
 //    wide = right + GUI_BIG;
 //    high = top + GUI_SMALL;
-    layout.setHorizontalGroup(layout.createParallelGroup()
+    layout.setHorizontalGroup(layout.createSequentialGroup()
+      .addGap(BORDER)
+      .addGroup(layout.createParallelGroup()
       .addComponent(sketchbookLocationLabel)
       .addGroup(layout.createSequentialGroup()
                   .addComponent(sketchbookLocationField)
-                  .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                   .addComponent(browseButton))
       .addGroup(layout.createSequentialGroup()
                   .addComponent(languageLabel)
@@ -598,25 +600,25 @@
       .addGroup(layout.createSequentialGroup()
                   .addComponent(fontSizelabel)
                   .addComponent(fontSizeField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
-                  .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
                   .addComponent(consoleFontSizeLabel)
-                  .addComponent(consoleFontSizeField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
-      )
+                      .addComponent(consoleFontSizeField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
       .addGroup(layout.createSequentialGroup()
                   .addComponent(backgroundColorLabel)
                   .addComponent(hashLabel, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
+                      .addGap(0)
                   .addComponent(presentColorHex, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
-                  .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
                   .addComponent(presentColor, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
       .addComponent(editorAntialiasBox)
       .addComponent(inputMethodBox)
+          .addGroup(layout.createSequentialGroup()
       .addComponent(errorCheckerBox)
-      .addComponent(warningsCheckerBox)
+                      .addComponent(warningsCheckerBox))
       .addComponent(codeCompletionBox)
       .addComponent(importSuggestionsBox)
       .addGroup(layout.createSequentialGroup()
                     .addComponent(memoryOverrideBox)
-                    .addComponent(memoryField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE))
+                        .addComponent(memoryField, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
+                        .addComponent(mbLabel))
       .addComponent(deletePreviousBox)
       .addComponent(checkUpdatesBox)
       .addGroup(layout.createSequentialGroup()
@@ -625,81 +627,66 @@
       )
       .addComponent(autoAssociateBox)
       .addComponent(morePreferenceLabel)
-      .addGroup(layout.createSequentialGroup()
                   .addComponent(preferencePathLabel)
-                  .addGap(0, 100, 200)
-                  .addComponent(okButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
-                  .addPreferredGap(LayoutStyle.ComponentPlacement.UNRELATED)
-                  .addComponent(cancelButton, GroupLayout.PREFERRED_SIZE, GroupLayout.DEFAULT_SIZE, GroupLayout.PREFERRED_SIZE)
-      )
       .addComponent(preferenceHintLabel)
+          .addGroup(GroupLayout.Alignment.TRAILING ,layout.createSequentialGroup()
+                      .addComponent(okButton, BUTTON_WIDTH, GroupLayout.DEFAULT_SIZE, BUTTON_WIDTH) // Ok and CAncel buttton are now of size BUTTON_WIDTH
+                      .addComponent(cancelButton, BUTTON_WIDTH, GroupLayout.DEFAULT_SIZE, BUTTON_WIDTH)
+          ))
+      .addGap(BORDER)
     );
 
-    // Making sure that Ok and Cancel buttons are of the same size
-    layout.linkSize(okButton, cancelButton);
+    layout.linkSize(fontSizeField, consoleFontSizeField);// Not sure if this will fix the size bug on mac
 
-    layout.setVerticalGroup(layout
-      .createSequentialGroup()
+    layout.setVerticalGroup(layout.createSequentialGroup()
+      .addGap(BORDER)
       .addComponent(sketchbookLocationLabel)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup()
                   .addComponent(sketchbookLocationField)
                   .addComponent(browseButton))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                   .addComponent(languageLabel)
                   .addComponent(languageSelectionBox)
                   .addComponent(restartProcessingLabel))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER).
                   addComponent(fontLabel)
                   .addComponent(fontSelectionBox))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                   .addComponent(fontSizelabel)
                   .addComponent(fontSizeField)
                   .addComponent(consoleFontSizeLabel)
                   .addComponent(consoleFontSizeField))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                   .addComponent(backgroundColorLabel)
                   .addComponent(hashLabel)
                   .addComponent(presentColorHex)
                   .addComponent(presentColor))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addComponent(editorAntialiasBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addComponent(inputMethodBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
-      .addComponent(errorCheckerBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
-      .addComponent(warningsCheckerBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
-      .addComponent(codeCompletionBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
-      .addComponent(importSuggestionsBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup()
+                  .addComponent(errorCheckerBox)
+                  .addComponent(warningsCheckerBox))
+      .addComponent(codeCompletionBox)
+      .addComponent(importSuggestionsBox)
+      .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                 .addComponent(memoryOverrideBox)
-                .addComponent(memoryField))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
+                .addComponent(memoryField)
+                .addComponent(mbLabel))
       .addComponent(deletePreviousBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addComponent(checkUpdatesBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                   .addComponent(displayLabel)
                   .addComponent(displaySelectionBox))
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addComponent(autoAssociateBox)
-      .addPreferredGap(LayoutStyle.ComponentPlacement.RELATED)
       .addComponent(morePreferenceLabel)
+      .addGap(0)
       .addComponent(preferencePathLabel)
-      .addGroup(layout.createParallelGroup(GroupLayout.Alignment.LEADING)
+      .addGap(0)
                   .addComponent(preferenceHintLabel)
+      .addGroup(layout.createParallelGroup(GroupLayout.Alignment.CENTER)
                   .addComponent(okButton)
                   .addComponent(cancelButton))
-      .addContainerGap()
+      .addGap(BORDER) 
       );
     dialog.getRootPane().setDefaultButton(okButton);
 ",0
Fix error checker crash when className contains [ or ]," 
 
     static public String[] getImportSuggestions(ClassPath cp, String className) {
+      className = className.replace(""["", ""\\["").replace(""]"", ""\\]"");
       RegExpResourceFilter regf = new RegExpResourceFilter(
           Pattern.compile("".*""),
           Pattern.compile(""(.*\\$)?"" + className + ""\\.class"",",0
Issue #47 fix : added this feature into all the DB operation,"             tableName = getTableName(selectQuery);
         }
 
+        final String quotedTableName = getQuotedTableName(tableName);
+
         if (tableName != null) {
-            final String pragmaQuery = ""PRAGMA table_info("" + tableName + "")"";
+            final String pragmaQuery = ""PRAGMA table_info("" + quotedTableName + "")"";
             tableData.tableInfos = getTableInfo(db, pragmaQuery);
         }
         Cursor cursor = null;
         boolean isView = false;
         try {
-            cursor = db.rawQuery(""SELECT type FROM sqlite_master WHERE name=?"", new String[]{tableName});
+            cursor = db.rawQuery(""SELECT type FROM sqlite_master WHERE name=?"",
+                    new String[]{quotedTableName});
             if (cursor.moveToFirst()) {
                 isView = ""view"".equalsIgnoreCase(cursor.getString(0));
             }
@@ -93,7 +96,7 @@
 
 
         if (!TextUtils.isEmpty(tableName)) {
-            selectQuery = selectQuery.replace(tableName, ""["" + tableName + ""]"");
+            selectQuery = selectQuery.replace(tableName, quotedTableName);
         }
 
         try {
@@ -165,6 +168,11 @@
 
     }
 
+
+    private static String getQuotedTableName(String tableName) {
+        return String.format(""[%s]"", tableName);
+    }
+
     private static List<TableDataResponse.TableInfo> getTableInfo(SQLiteDatabase db, String pragmaQuery) {
 
         Cursor cursor;
@@ -220,6 +228,8 @@
             return updateRowResponse;
         }
 
+        tableName = getQuotedTableName(tableName);
+
         ContentValues contentValues = new ContentValues();
 
         for (RowDataRequest rowDataRequest : rowDataRequests) {
@@ -260,6 +270,8 @@
             return updateRowResponse;
         }
 
+        tableName = getQuotedTableName(tableName);
+
         ContentValues contentValues = new ContentValues();
 
         String whereClause = null;
@@ -314,6 +326,8 @@
             return updateRowResponse;
         }
 
+        tableName = getQuotedTableName(tableName);
+
 
         String whereClause = null;
         List<String> whereArgsList = new ArrayList<>();
@@ -353,6 +367,14 @@
         TableDataResponse tableDataResponse = new TableDataResponse();
         tableDataResponse.isSelectQuery = false;
         try {
+
+            String tableName = getTableName(sql);
+
+            if (!TextUtils.isEmpty(tableName)) {
+                String quotedTableName = getQuotedTableName(tableName);
+                sql = sql.replace(tableName, quotedTableName);
+            }
+
             database.execSQL(sql);
         } catch (Exception e) {
             e.printStackTrace();",0
Fix a bug in the rsdr program,"                 buf.clear();
                 long offset = recordSize * i;
                 int count = channel.read( buf, offset );
+                if ( count == -1 )
+                {
+                    break;
+                }
                 byte[] bytes = new byte[count];
                 buf.clear();
                 buf.get( bytes );",0
Fix comment to comply build requirements,"         case ITestResult.SKIP:
           LOG.warn(""Test {} skipped."", getCompletedTestLabel(result.getMethod()));
 
-          // don't capture test data if test is skipped because of previous test with higher priority
-          // failed
+          // don't capture test data if test is skipped because of previous test with higher
+          // priority failed
           if (testsWithFailure.containsKey(result.getMethod().getInstance().getClass().getName())) {
             return;
           }",0
fix HintHandlerFactory多线程安全问题和多次重复初始化的问题," import java.util.Map;
 
 public class HintHandlerFactory {
-	private static boolean isInit = false;
+	private static volatile boolean isInit = false;
 	 //sql注释的类型处理handler 集合，现在支持两种类型的处理：sql,schema
     private static Map<String,HintHandler> hintHandlerMap = new HashMap<String,HintHandler>();
 
@@ -12,12 +12,17 @@
         hintHandlerMap.put(""sql"",new HintSQLHandler());
         hintHandlerMap.put(""schema"",new HintSchemaHandler());
         hintHandlerMap.put(""catlet"",new HintCatletHandler());
+        isInit = true;	// 修复多次初始化的bug
     }
     
+    // 双重校验锁 fix 线程安全问题
     public static HintHandler getHintHandler(String hintType) {
     	if(!isInit) {
+    		synchronized(HintHandlerFactory.class){
+    			if(!isInit)
     		init();
     	}
+    	}
     	return hintHandlerMap.get(hintType);
     }
     ",0
 - fix issue where muteOnStart doesn't work when set in bigbluebutton…," 		Boolean muteOnStart = defaultMuteOnStart;
 		if (!StringUtils.isEmpty(params.get(""muteOnStart""))) {
         	muteOnStart = Boolean.parseBoolean(params.get(""muteOnStart""));
-			meeting.setMuteOnStart(muteOnStart);
         }
 
+		meeting.setMuteOnStart(muteOnStart);
         return meeting;
     }
 	",0
Fixed Travis build," public class Any implements ArgumentMatcher<Object>, VarargMatcher ,Serializable {
 
     public static final Any ANY = new Any();
-
-    private Any() {
-    }
 
     public boolean matches(Object actual) {
         return true;",0
Fix in Utils when getting constructor name,,0
Fixed documentation link," 	 *
 	 * <ol>
 	 * <li>Evaluate the precedence predicates for each configuration using
-	 * {@link SemanticContext.evalPrecedence}.</li>
+	 * {@link SemanticContext#evalPrecedence}.</li>
 	 * <li>Remove all configurations which predict an alternative greater than
 	 * 1, for which another configuration that predicts alternative 1 is in the
 	 * same ATN state. This transformation is valid for the following reasons:",0
fix findbugs in json deserializer,"   }
 
   static class CaseInsensitiveJsonNode {
-    JsonNode jsonNode;
     Map<String, String> keyMap = new HashMap<>();
 
     CaseInsensitiveJsonNode(JsonNode jsonNode) {
-      this.jsonNode = jsonNode;
       Iterator<String> fieldNames = jsonNode.fieldNames();
       while (fieldNames.hasNext()) {
         String fieldName = fieldNames.next();",0
Fix permission issue related to React Native Navigation permanently," import java.util.List;
 
 import com.facebook.react.modules.core.PermissionListener;
+import com.facebook.react.modules.core.PermissionAwareActivity;
 
 import static com.imagepicker.utils.MediaUtils.*;
 import static com.imagepicker.utils.MediaUtils.createNewFile;
@@ -601,6 +602,9 @@
         {
           ((ReactActivity) activity).requestPermissions(PERMISSIONS, requestCode, listener);
         }
+        else if (activity instanceof PermissionAwareActivity) {
+          ((PermissionAwareActivity) activity).requestPermissions(PERMISSIONS, requestCode, listener);
+        }
         else if (activity instanceof OnImagePickerPermissionsCallback)
         {
           ((OnImagePickerPermissionsCallback) activity).setPermissionListener(listener);
@@ -611,6 +615,8 @@
           final String errorDescription = new StringBuilder(activity.getClass().getSimpleName())
                   .append("" must implement "")
                   .append(OnImagePickerPermissionsCallback.class.getSimpleName())
+                  .append("" or "")
+                  .append(PermissionAwareActivity.class.getSimpleName())
                   .toString();
           throw new UnsupportedOperationException(errorDescription);
         }",0
"JPQL ""IN"" expression corrected to work with EclipseLink","                         ""SELECT e.globalIndex, e.type, e.aggregateIdentifier, e.sequenceNumber, e.eventIdentifier, ""
                                 + ""e.timeStamp, e.payloadType, e.payloadRevision, e.payload, e.metaData "" +
                                 ""FROM "" + domainEventEntryEntityName() + "" e "" +
-                                ""WHERE e.globalIndex > :token OR e.globalIndex IN (:gaps) ORDER BY e.globalIndex ASC"",
+                                ""WHERE e.globalIndex > :token OR e.globalIndex IN :gaps ORDER BY e.globalIndex ASC"",
                         Object[].class
                 ).setParameter(""gaps"", previousToken.getGaps());
             }",0
typo fix,"                     true));
     private final Server server;
     // heartbeat timer
-    private ScheduledFuture<?> heatbeatTimer;
+    private ScheduledFuture<?> heartbeatTimer;
     // heartbeat timeout (ms), default value is 0 , won't execute a heartbeat.
     private int heartbeat;
     private int heartbeatTimeout;
@@ -70,7 +70,7 @@
         if (heartbeatTimeout < heartbeat * 2) {
             throw new IllegalStateException(""heartbeatTimeout < heartbeatInterval * 2"");
         }
-        startHeatbeatTimer();
+        startHeartbeatTimer();
     }
 
     public Server getServer() {
@@ -134,7 +134,7 @@
                 if (channel.isConnected())
                     channel.send(request, getUrl().getParameter(Constants.CHANNEL_READONLYEVENT_SENT_KEY, true));
             } catch (RemotingException e) {
-                logger.warn(""send connot write messge error."", e);
+                logger.warn(""send cannot write message error."", e);
             }
         }
     }
@@ -205,7 +205,7 @@
                 if (h != heartbeat || t != heartbeatTimeout) {
                     heartbeat = h;
                     heartbeatTimeout = t;
-                    startHeatbeatTimer();
+                    startHeartbeatTimer();
                 }
             }
         } catch (Throwable t) {
@@ -232,10 +232,10 @@
         server.send(message, sent);
     }
 
-    private void startHeatbeatTimer() {
+    private void startHeartbeatTimer() {
         stopHeartbeatTimer();
         if (heartbeat > 0) {
-            heatbeatTimer = scheduled.scheduleWithFixedDelay(
+            heartbeatTimer = scheduled.scheduleWithFixedDelay(
                     new HeartBeatTask(new HeartBeatTask.ChannelProvider() {
                         public Collection<Channel> getChannels() {
                             return Collections.unmodifiableCollection(
@@ -248,14 +248,14 @@
 
     private void stopHeartbeatTimer() {
         try {
-            ScheduledFuture<?> timer = heatbeatTimer;
+            ScheduledFuture<?> timer = heartbeatTimer;
             if (timer != null && !timer.isCancelled()) {
                 timer.cancel(true);
             }
         } catch (Throwable t) {
             logger.warn(t.getMessage(), t);
         } finally {
-            heatbeatTimer = null;
+            heartbeatTimer = null;
         }
     }
 ",0
fix demo: displayed incorrectly when video total time > 1h,"     public void onTimerUpdate(int curr, int duration, int bufferPercentage) {
         if(!mTimerUpdateProgressEnable)
             return;
-        if(mTimeFormat==null){
+        if(mTimeFormat==null || duration != mSeekBar.getMax()){
             mTimeFormat = TimeUtil.getFormat(duration);
         }
         mBufferPercentage = bufferPercentage;",0
Vertica supports CREATE OR REPLACE,"             statementStart += "" "";
         }
 
-        if (statementStart.startsWith(""CREATE FUNCTION"")) {
+        if (statementStart.startsWith(""CREATE FUNCTION"")
+                || statementStart.startsWith(""CREATE OR REPLACE FUNCTION"")) {
             if (line.startsWith(""BEGIN"") || line.endsWith(""BEGIN"")) {
                 insideBeginEndBlock = true;
             }",0
Handle preDestroy when method defined on superclass.  Fixes #1272,"      * @return The executable element
      */
     Optional<ExecutableElement> findAccessibleNoArgumentInstanceMethod(TypeElement classElement, String methodName) {
-        return ElementFilter.methodsIn(classElement.getEnclosedElements())
+        return ElementFilter.methodsIn(elementUtils.getAllMembers(classElement))
                 .stream().filter(m -> m.getSimpleName().toString().equals(methodName) && !isPrivate(m) && !isStatic(m))
                 .findFirst();
     }",0
Fixing expansion of subitems during update (now works like expand all at startup)," 				int itemCount = newItems.size();
 				if (position < itemCount) {
 					newItems.addAll(position + 1, subItems);
-					position += subItems.size();
 				} else {
 					newItems.addAll(subItems);
-					position = itemCount;
 				}
 			}
 			// Display headers too",0
Fix for issue #285," 			mProjMatrix = projMatrix;
 			if (!mDoubleSided)
 				GLES20.glEnable(GLES20.GL_CULL_FACE);
-			if (mEnableBlending) {
+			if (mEnableBlending && !(pickerInfo != null && mIsPickingEnabled)) {
 				GLES20.glEnable(GLES20.GL_BLEND);
 				GLES20.glBlendFunc(mBlendFuncSFactor, mBlendFuncDFactor);
 			} else {",0
fix crash on Eclair and Froyo,"                 mList.setHorizontalScrollBarEnabled((scrollBars & 0x00000100) != 0);
 
                 // overscroll
+                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.GINGERBREAD) {
                 mList.setOverScrollMode(a.getInt(R.styleable.StickyListHeadersListView_android_overScrollMode, 0));
+                }
 
                 // -- ListView attributes --
                 mList.setFadingEdgeLength(a.getDimensionPixelSize(R.styleable.StickyListHeadersListView_android_fadingEdgeLength,",0
fix heartbeat spelling error,"     private final ExchangeChannel channel;
     // heartbeat timer
     private ScheduledFuture<?> heartbeatTimer;
+    // heartbeat(ms), default value is 0 , won't execute a heartbeat.
     private int heartbeat;
-    // heartbeat timeout (ms), default value is 0 , won't execute a heartbeat.
     private int heartbeatTimeout;
 
     public HeaderExchangeClient(Client client, boolean needHeartbeat) {
@@ -66,7 +66,7 @@
             throw new IllegalStateException(""heartbeatTimeout < heartbeatInterval * 2"");
         }
         if (needHeartbeat) {
-            startHeatbeatTimer();
+            startHeartbeatTimer();
         }
     }
 
@@ -160,7 +160,7 @@
         return channel.hasAttribute(key);
     }
 
-    private void startHeatbeatTimer() {
+    private void startHeartbeatTimer() {
         stopHeartbeatTimer();
         if (heartbeat > 0) {
             heartbeatTimer = scheduled.scheduleWithFixedDelay(",0
Fix wrong LruCache max size.," 
   /** Emulate the disk cache by storing the URLs in an LRU using its size as the value. */
   private final LruCache<String, Long> emulatedDiskCache =
-      new LruCache<String, Long>(((int) Math.max(DataModule.DISK_CACHE_SIZE, Integer.MAX_VALUE))) {
+      new LruCache<String, Long>(((int) Math.min(DataModule.DISK_CACHE_SIZE, Integer.MAX_VALUE))) {
         @Override protected int sizeOf(String key, Long value) {
           return (int) Math.min(value.longValue(), Integer.MAX_VALUE);
         }",0
Fix SMS warning message,"      */
     public boolean sms(final String from, final String to, final String text) {
         if (!isSmsSenderDefined() || StringUtils.isBlank(text) || StringUtils.isBlank(from)) {
-            LOGGER.warn(""Could not send email to [{}] because either no address/subject/text is found or email settings are not configured."", to);
+            LOGGER.warn(""Could not send SMS to [{}] because either no from/text is found or SMS settings are not configured."", to);
             return false;
         }
         return this.smsSender.send(from, to, text);",0
Fix too many end period marker," 
               readBuffer.flip();
               boolean hasMoreInStgBuffer = true;
+              boolean preEndPeriodEvent = false;
               while (hasMoreInStgBuffer && readPos.hasNext())
               {
                 writePos.startNewIteration();
@@ -3347,6 +3348,22 @@
                 {
                 case OK:
                 {
+                  if (readPos.getCurEvent().isEndOfPeriodMarker())
+                  {
+                    if (preEndPeriodEvent)
+                    {
+                      readPos.eventSkipped();
+                      break;
+                    }
+                    else
+                    {
+                      preEndPeriodEvent = true;
+                    }
+                  }
+                  else
+                  {
+                    preEndPeriodEvent = false;
+                  }
                   final int curEventSize = readPos.getCurEvent().size();
                   if (readPos.bytesProcessed() + curEventSize > contiguousCapacity)
                   {",0
Possible fix for inability to use on Android,"     private final boolean trackConnections;
     private final boolean useRawUrl;
     private final static NTLMEngine ntlmEngine = new NTLMEngine();
-    private final static SpnegoEngine spnegoEngine = new SpnegoEngine();
+    private static SpnegoEngine spnegoEngine = null;
     private final Protocol httpProtocol = new HttpProtocol();
     private final Protocol webSocketProtocol = new WebSocketProtocol();
 
@@ -555,6 +555,12 @@
         return construct(config, request, new HttpMethod(method), uri, buffer);
     }
 
+    private static SpnegoEngine getSpnegoEngine() {
+        if(spnegoEngine == null)
+            spnegoEngine = new SpnegoEngine();
+        return spnegoEngine;
+    }
+
     private static HttpRequest construct(AsyncHttpClientConfig config,
                                          Request request,
                                          HttpMethod m,
@@ -671,7 +677,7 @@
                     String challengeHeader = null;
                     String server = proxyServer == null ? host : proxyServer.getHost();
                     try {
-                        challengeHeader = spnegoEngine.generateToken(server);
+                        challengeHeader = getSpnegoEngine().generateToken(server);
                     } catch (Throwable e) {
                         IOException ie = new IOException();
                         ie.initCause(e);
@@ -1152,7 +1158,7 @@
         String host = request.getVirtualHost() == null ? AsyncHttpProviderUtils.getHost(uri) : request.getVirtualHost();
         String server = proxyServer == null ? host : proxyServer.getHost();
         try {
-            String challengeHeader = spnegoEngine.generateToken(server);
+            String challengeHeader = getSpnegoEngine().generateToken(server);
             headers.remove(HttpHeaders.Names.AUTHORIZATION);
             headers.add(HttpHeaders.Names.AUTHORIZATION, ""Negotiate "" + challengeHeader);
 ",0
fixed NPE when cache folder is empty," import java.io.FileFilter;
 import java.io.FilenameFilter;
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 
 import roboguice.util.temp.Ln;
@@ -108,6 +109,9 @@
                 return filename.startsWith(prefix);
             }
         });
+        if (cacheFileNameList == null) {
+            return Collections.emptyList();
+        }
         List<Object> result = new ArrayList<Object>(cacheFileNameList.length);
         for (String cacheFileName : cacheFileNameList) {
             String cacheKey = cacheFileName.substring(prefixLength);",0
[fixed] DefaultGroupStrategy now works with OpenGL 2.0," 	@Override
 	public void beforeGroup (int group, Array<Decal> contents) {
 		if (group == GROUP_BLEND) {
-			Gdx.gl10.glEnable(GL10.GL_BLEND);
+			Gdx.gl.glEnable(GL10.GL_BLEND);
 		}
 	}
 
 	@Override
 	public void afterGroup (int group) {
 		if (group == GROUP_BLEND) {
-			Gdx.gl10.glDisable(GL10.GL_BLEND);
+			Gdx.gl.glDisable(GL10.GL_BLEND);
 		}
 	}
 
 	@Override
 	public void beforeGroups () {
-		Gdx.gl10.glEnable(GL10.GL_TEXTURE_2D);
+		Gdx.gl.glEnable(GL10.GL_TEXTURE_2D);
 	}
 
 	@Override
 	public void afterGroups () {
-		Gdx.gl10.glDisable(GL10.GL_TEXTURE_2D);
+		Gdx.gl.glDisable(GL10.GL_TEXTURE_2D);
 	}
 
 	@Override",0
Fix code formatting," package org.eclipse.che.wsagent.server;
 
 import com.google.inject.AbstractModule;
-import org.eclipse.che.api.core.rest.LivenessProbeService;
 import org.eclipse.che.api.core.rest.ApiInfoService;
+import org.eclipse.che.api.core.rest.LivenessProbeService;
 import org.eclipse.che.inject.DynaModule;
 
 /**",0
Fix javadoc issue,"    *
    * @param key
    *          The key to be constrained.
-   * @param value
+   * @param points
    *          List<ParseGeoPoint> or ParsePolygon
    * @return this, so you can chain this call.
    */",0
minor fixes for copy,"         Main ma;
         String path;
         Boolean move;
-        ArrayList<String> ab, a, b;
+        ArrayList<String> ab, a, b, lol;
         int counter = 0;
 
         public CheckForFiles(Main main, String path, Boolean move) {
@@ -637,6 +637,7 @@
             this.move = move;
             a = new ArrayList<String>();
             b = new ArrayList<String>();
+            lol = new ArrayList<String>();
         }
 
         @Override
@@ -700,16 +701,29 @@
             return a;
         }
 
-        public void showDialog(final AlertDialog.Builder x, final String l) {
+        public void showDialog() {
 
-            x.setMessage(""File with same name already exists "" + new File(l).getName());
+
+            if (counter == a.size()) {
+                if (lol != null) {
+                    Intent intent = new Intent(con, CopyService.class);
+                    intent.putExtra(""FILE_PATHS"", lol);
+                    intent.putExtra(""COPY_DIRECTORY"", ma.current);
+                    startService(intent);
+                } else {
+                    Toast.makeText(MainActivity.this, ""No file was overwritten"", Toast.LENGTH_SHORT).show();
+                }
+            } else {
+
+                AlertDialog.Builder x = new AlertDialog.Builder(MainActivity.this);
+                x.setMessage(""File with same name already exists "" + new File(a.get(counter)).getName());
             x.setPositiveButton(""Skip"", new DialogInterface.OnClickListener() {
                 @Override
                 public void onClick(DialogInterface dialogInterface, int i) {
 
-                    counter++;
                     if (counter < a.size()) {
-                        showDialog(x, a.get(counter));
+                            counter++;
+                            showDialog();
                     }
                     dialogInterface.cancel();
                 }
@@ -717,18 +731,10 @@
             x.setNeutralButton(""Overwrite"", new DialogInterface.OnClickListener() {
                 @Override
                 public void onClick(DialogInterface dialogInterface, int i) {
-                    counter++;
                     if (counter < a.size()) {
-                        ArrayList<String> lol = new ArrayList<String>();
                         lol.add(a.get(counter));
-
-                        Intent intent = new Intent(con, CopyService.class);
-                        intent.putExtra(""FILE_PATHS"", lol);
-                        intent.putExtra(""COPY_DIRECTORY"", ma.current);
-                        startService(intent);
-
-                        lol.clear();
-                        showDialog(x, a.get(counter));
+                            counter++;
+                            showDialog();
                     }
                     dialogInterface.cancel();
                 }
@@ -742,6 +748,7 @@
             });
             x.show();
         }
+        }
 
         @Override
         protected void onPostExecute(ArrayList<String> strings) {
@@ -757,8 +764,7 @@
                 }
 
                 if (a != null) {
-                    AlertDialog.Builder x = new AlertDialog.Builder(con);
-                    showDialog(x, a.get(0));
+                    showDialog();
                 }
             } else {
                 // yet to be implemented",0
KYLIN-3836 fix Kylin StringUtil.join() may cause NPE if iterator is e…,"     }
 
     public static String join(Iterable<String> parts, String separator) {
-        StringBuilder buf = new StringBuilder();
-        Iterator<String> iterator = parts.iterator();
-        if (iterator == null || (!iterator.hasNext())) {
+        if (parts == null) {
             return null;
         }
+
+        Iterator<String> iterator = parts.iterator();
+
+        if (iterator == null) {
+            return null;
+        } else if (!iterator.hasNext()) {
+            return """";
+        } else {
+            StringBuilder buf = new StringBuilder();
         final String first = iterator.next();
         if (first != null) {
             buf.append(first);
@@ -96,6 +103,7 @@
 
         return buf.toString();
     }
+    }
 
     public static void toUpperCaseArray(String[] source, String[] target) {
         if (source != null) {",0
fix #935 Clarify documentation on default instance Schedulers factories," 	 * <p>
 	 * This scheduler is not restartable.
 	 *
-	 * @return a new {@link Scheduler} that hosts a fixed pool of single-threaded
+	 * @return default instance of a {@link Scheduler} that hosts a fixed pool of single-threaded
 	 * ExecutorService-based workers and is suited for parallel work
 	 */
 	public static Scheduler elastic() {
@@ -333,7 +333,7 @@
 	 * {@link Scheduler} that hosts a fixed pool of single-threaded ExecutorService-based
 	 * workers and is suited for parallel work.
 	 *
-	 * @return a reusable {@link Scheduler} that hosts a fixed pool of single-threaded
+	 * @return default instance of a {@link Scheduler} that hosts a fixed pool of single-threaded
 	 * ExecutorService-based workers
 	 */
 	public static Scheduler parallel() {
@@ -391,7 +391,7 @@
 	 * {@link Scheduler} that hosts a single-threaded ExecutorService-based worker and is
 	 * suited for parallel work. Will cache the returned schedulers for subsequent calls until dispose.
 	 *
-	 * @return a cached {@link Scheduler} that hosts a single-threaded
+	 * @return default instance of a {@link Scheduler} that hosts a single-threaded
 	 * ExecutorService-based worker
 	 */
 	public static Scheduler single() {",0
CHE-4626: prevent Processes dropdown list from opening/closing when Stop/Rerun button has been clicked,"         safeHtmlBuilder.appendHtmlConstant(FontAwesome.STOP);
 
         final ActionButton button = new ActionButton(safeHtmlBuilder.toSafeHtml());
-        button.addClickHandler(event -> handler.onStopProcess(process));
+        button.addClickHandler(event -> {
+            event.stopPropagation(); // prevent dropdown list from opening/closing
+            handler.onStopProcess(process);
+        });
         button.ensureDebugId(""dropdown-processes-stop"");
 
         Tooltip.create((Element)button.getElement(), BOTTOM, MIDDLE, ""Stop"");
@@ -133,7 +136,10 @@
         safeHtmlBuilder.appendHtmlConstant(FontAwesome.REPEAT);
 
         final ActionButton button = new ActionButton(safeHtmlBuilder.toSafeHtml());
-        button.addClickHandler(event -> handler.onRerunProcess(process));
+        button.addClickHandler(event -> {
+            event.stopPropagation(); // prevent dropdown list from opening/closing
+            handler.onRerunProcess(process);
+        });
         button.ensureDebugId(""dropdown-processes-rerun"");
 
         Tooltip.create((Element)button.getElement(), BOTTOM, MIDDLE, ""Re-run"");",0
1.x: update and bugfix to SubscribingPerf," import org.openjdk.jmh.annotations.*;
 import org.openjdk.jmh.infra.Blackhole;
 
+import rx.functions.Func1;
+
 /**
  * Benchmark the cost of subscription and initial request management.
  * <p>
@@ -38,64 +40,121 @@
     
     @Benchmark
     public void justDirect(Blackhole bh) {
-        just.subscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        DirectSubscriber<Integer> subscriber = new DirectSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.subscribe(subscriber);
     }
 
     @Benchmark
     public void justStarted(Blackhole bh) {
-        just.subscribe(new StartedSubscriber<Integer>(Long.MAX_VALUE, bh));
+        StartedSubscriber<Integer> subscriber = new StartedSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.subscribe(subscriber);
     }
 
     @Benchmark
     public void justUsual(Blackhole bh) {
-        just.subscribe(new UsualSubscriber<Integer>(Long.MAX_VALUE, bh));
+        UsualSubscriber<Integer> subscriber = new UsualSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.subscribe(subscriber);
     }
 
     @Benchmark
     public void rangeDirect(Blackhole bh) {
-        range.subscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        DirectSubscriber<Integer> subscriber = new DirectSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.subscribe(subscriber);
     }
 
     @Benchmark
     public void rangeStarted(Blackhole bh) {
-        range.subscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        StartedSubscriber<Integer> subscriber = new StartedSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.subscribe(subscriber);
     }
 
     @Benchmark
     public void rangeUsual(Blackhole bh) {
-        range.subscribe(new UsualSubscriber<Integer>(Long.MAX_VALUE, bh));
+        UsualSubscriber<Integer> subscriber = new UsualSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.subscribe(subscriber);
     }
 
     @Benchmark
     public void justDirectUnsafe(Blackhole bh) {
-        just.unsafeSubscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        DirectSubscriber<Integer> subscriber = new DirectSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.unsafeSubscribe(subscriber);
     }
 
     @Benchmark
     public void justStartedUnsafe(Blackhole bh) {
-        just.unsafeSubscribe(new StartedSubscriber<Integer>(Long.MAX_VALUE, bh));
+        StartedSubscriber<Integer> subscriber = new StartedSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.unsafeSubscribe(subscriber);
     }
 
     @Benchmark
     public void justUsualUnsafe(Blackhole bh) {
-        just.unsafeSubscribe(new UsualSubscriber<Integer>(Long.MAX_VALUE, bh));
+        UsualSubscriber<Integer> subscriber = new UsualSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        just.unsafeSubscribe(subscriber);
     }
 
     @Benchmark
     public void rangeDirectUnsafe(Blackhole bh) {
-        range.unsafeSubscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        DirectSubscriber<Integer> subscriber = new DirectSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.unsafeSubscribe(subscriber);
     }
 
     @Benchmark
     public void rangeStartedUnsafe(Blackhole bh) {
-        range.unsafeSubscribe(new DirectSubscriber<Integer>(Long.MAX_VALUE, bh));
+        StartedSubscriber<Integer> subscriber = new StartedSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.unsafeSubscribe(subscriber);
     }
 
     @Benchmark
     public void rangeUsualUnsafe(Blackhole bh) {
-        range.unsafeSubscribe(new UsualSubscriber<Integer>(Long.MAX_VALUE, bh));
+        UsualSubscriber<Integer> subscriber = new UsualSubscriber<Integer>(Long.MAX_VALUE, bh);
+        bh.consume(subscriber);
+        range.unsafeSubscribe(subscriber);
     }
 
+    @State(Scope.Thread)
+    public static class Chain {
+        @Param({""10"", ""1000"", ""1000000""})
+        public int times;
+        
+        @Param({""1"", ""2"", ""3"", ""4"", ""5""})
+        public int maps;
+        
+        Observable<Integer> source;
+        
+        @Setup
+        public void setup() {
+            Observable<Integer> o = Observable.range(1, times);
+            
+            for (int i = 0; i < maps; i++) {
+                o = o.map(new Func1<Integer, Integer>() {
+                    @Override
+                    public Integer call(Integer v) {
+                        return v + 1;
+                    }
+                });
+            }
+            
+            source = o;
+        }
+        
+        @Benchmark
+        public void mapped(Chain c, Blackhole bh) {
+            DirectSubscriber<Integer> subscriber = new DirectSubscriber<Integer>(Long.MAX_VALUE, bh);
+            bh.consume(subscriber);
+            c.source.subscribe(subscriber);
+        }
+    }
     
     static final class DirectSubscriber<T> extends Subscriber<T> {
         final long r;",0
Fix Gouraud shader compilation w/ multiple lights," 		""	vec3 L = vec3(0.0);\n"" +
 		""	float dist = 0.0;\n"" +
 		""	float attenuation = 1.0;\n"" +
+		""	float NdotL = 0.0;\n"" +
 
 		""%LIGHT_CODE%"" +
 		""	vSpecularIntensity = clamp(vSpecularIntensity, 0.0, 1.0);\n"" +
@@ -157,7 +158,7 @@
 			} else if(light.getLightType() == ALight.DIRECTIONAL_LIGHT) {
 				sb.append(""L = normalize(-uLightDirection"").append(i).append("");"");
 			}
-			sb.append(""float NdotL = max(dot(N, L), 0.1);\n"");
+			sb.append(""NdotL = max(dot(N, L), 0.1);\n"");
 			sb.append(""vDiffuseIntensity += NdotL * attenuation * uLightPower"").append(i).append("";\n"");
 			sb.append(""vSpecularIntensity += pow(NdotL, 6.0) * attenuation * uLightPower"").append(i).append("";\n"");
 		}",0
fix name of exported files (correct the time),"         throws IOException
     {
         SimpleDateFormat dateFormat = DateFormats.getBackupDateFormat();
-        String date = dateFormat.format(DateUtils.getStartOfToday());
+        String date = dateFormat.format(DateUtils.getLocalTime());
         String format = ""%s/Loop Habits Backup %s.db"";
         String filename = String.format(format, dir.getAbsolutePath(), date);
 ",0
Add Missing hex prefix,"     @Override
     public Request<?, org.web3j.protocol.core.methods.response.EthSendTransaction> ethSendRawTransaction(
             String signedTransactionData) {
+        if (!signedTransactionData.startsWith(""0x"")) {
+            signedTransactionData = ""0x"" + signedTransactionData;
+        }
         return new Request<>(
                 ""eth_sendRawTransaction"",
                 Arrays.asList(signedTransactionData),",0
setOffsetToRefresh float div bug,"     }
 
     public void setOffsetToRefresh(int offset) {
-        mRatioOfHeaderHeightToRefresh = mHeaderHeight / offset;
+        mRatioOfHeaderHeightToRefresh = mHeaderHeight * 1f / offset;
         mOffsetToRefresh = offset;
     }
 ",0
Fix for memory leak,"         }
         mPaint.setTextSize(mValuesOnTopSize);
 
+        resetDataPoints();
+        
         // get data
         double maxX = graphView.getViewport().getMaxX(false);
         double minX = graphView.getViewport().getMinX(false);",0
Fix amulet of glory item requirement for elite clue scroll," 		new EmoteClue(""Beckon in the combat ring of Shayzien. Show your anger before you talk to me. Equip an adamant platebody, adamant full helm and adamant platelegs."", new WorldPoint(1545, 3594, 0), BECKON, ANGRY, item(ADAMANT_PLATELEGS), item(ADAMANT_PLATEBODY), item(ADAMANT_FULL_HELM)),
 		new EmoteClue(""Bow near Lord Iorwerth. Beware of double agents! Equip a new imbued crystal bow."", new WorldPoint(2205, 3252, 0), BOW, any(""Imbued crystal bow"", item(NEW_CRYSTAL_BOW_I), item(CRYSTAL_BOW_FULL_I), item(CRYSTAL_BOW_910_I), item(CRYSTAL_BOW_810_I), item(CRYSTAL_BOW_710_I), item(CRYSTAL_BOW_610_I), item(CRYSTAL_BOW_510_I), item(CRYSTAL_BOW_410_I), item(CRYSTAL_BOW_310_I), item(CRYSTAL_BOW_210_I), item(CRYSTAL_BOW_110_I))),
 		new EmoteClue(""Bow outside the entrance to the Legends' Guild. Equip iron platelegs, an emerald amulet and an oak longbow."", new WorldPoint(2729, 3349, 0), BOW, item(IRON_PLATELEGS), item(OAK_LONGBOW), item(EMERALD_AMULET)),
-		new EmoteClue(""Bow on the ground floor of the Legend's guild. Equip Legend's cape, a dragon battleaxe and an amulet of glory."", new WorldPoint(2728, 3377, 0), BOW, item(CAPE_OF_LEGENDS), item(DRAGON_BATTLEAXE), item(AMULET_OF_GLORY)),
+		new EmoteClue(""Bow on the ground floor of the Legend's guild. Equip Legend's cape, a dragon battleaxe and an amulet of glory."", new WorldPoint(2728, 3377, 0), BOW, item(CAPE_OF_LEGENDS), item(DRAGON_BATTLEAXE), any(""Any amulet of glory"", item(AMULET_OF_GLORY), item(AMULET_OF_GLORY1), item(AMULET_OF_GLORY2), item(AMULET_OF_GLORY3), item(AMULET_OF_GLORY4), item(AMULET_OF_GLORY5), item(AMULET_OF_GLORY6))),
 		new EmoteClue(""Bow in the ticket office of the Duel Arena. Equip an iron chain body, leather chaps and coif."", new WorldPoint(3314, 3241, 0), BOW, item(IRON_CHAINBODY), item(LEATHER_CHAPS), item(COIF)),
 		new EmoteClue(""Bow at the top of the lighthouse. Beware of double agents! Equip a blue dragonhide body, blue dragonhide vambraces and no jewelry."", new WorldPoint(2511, 3641, 2), BOW, item(BLUE_DHIDE_BODY), item(BLUE_DHIDE_VAMB), emptySlot(""No jewelry"", AMULET, RING)),
 		new EmoteClue(""Blow a kiss between the tables in Shilo Village bank. Beware of double agents! Equip a blue mystic hat, bone spear and rune platebody."", new WorldPoint(2851, 2954, 0), BLOW_KISS, item(MYSTIC_HAT), item(BONE_SPEAR), item(RUNE_PLATEBODY)),",0
[SP-4519] Backport of BACKLOG-24282 - Minor fix to the MDI analyzer -…,"     }
   }
 
-  @Override public IClonableStepAnalyzer cloneAnalyzer() {
+  @Override protected IClonableStepAnalyzer newInstance() {
     return new MetaInjectAnalyzer();
   }
 ",0
Bugfix for #198," 
 import org.terasology.components.actions.TunnelActionComponent;
 import org.terasology.entityFactory.DroppedBlockFactory;
-import org.terasology.entitySystem.EntityManager;
-import org.terasology.entitySystem.EntityRef;
-import org.terasology.entitySystem.EventHandlerSystem;
-import org.terasology.entitySystem.ReceiveEvent;
-import org.terasology.entitySystem.RegisterComponentSystem;
+import org.terasology.entitySystem.*;
 import org.terasology.events.ActivateEvent;
 import org.terasology.game.CoreRegistry;
 import org.terasology.math.Vector3i;
@@ -61,7 +57,7 @@
     public void shutdown() {
     }
 
-    @ReceiveEvent(components = TunnelActionComponent.class)
+    @ReceiveEvent(components = TunnelActionComponent.class, priority = EventPriority.PRIORITY_HIGH)
     public void onActivate(ActivateEvent event, EntityRef entity) {
 
         Vector3f dir = new Vector3f(event.getDirection());
@@ -111,5 +107,8 @@
                 }
             }
         }
+        //If no blocks were destroyed, cancel the event
+        if(blockCounter == MAX_DESTROYED_BLOCKS)
+            event.cancel();
     }
 }",0
Fix the conversion of Geometry Point in PlaceJSONImpl,"                 JSONArray array = geometryJSON.getJSONArray(""coordinates"");
                 if (geometryType.equals(""Point"")) {
                     geometryCoordinates = new GeoLocation[1][1];
-                    geometryCoordinates[0][0] = new GeoLocation(array.getDouble(0), array.getDouble(1));
+                    geometryCoordinates[0][0] = new GeoLocation(array.getDouble(1), array.getDouble(0));
                 } else if (geometryType.equals(""Polygon"")) {
                     geometryCoordinates = JSONImplFactory.coordinatesAsGeoLocationArray(array);
                 } else {",0
Fix bugs in ScalarMin," 
     @Override
     public String name() {
-        return ""max_scalar"";
+        return ""min_scalar"";
     }
 
     @Override
     public IComplexNumber op(IComplexNumber origin, double other) {
-        if (origin.absoluteValue().doubleValue() > complexNumber.absoluteValue().doubleValue())
+        if (origin.absoluteValue().doubleValue() < complexNumber.absoluteValue().doubleValue())
             return origin;
         return complexNumber;
     }
 
     @Override
     public IComplexNumber op(IComplexNumber origin, float other) {
-        if (origin.absoluteValue().doubleValue() > complexNumber.absoluteValue().doubleValue())
+        if (origin.absoluteValue().doubleValue() < complexNumber.absoluteValue().doubleValue())
             return origin;
         return complexNumber;
     }
 
     @Override
     public IComplexNumber op(IComplexNumber origin, IComplexNumber other) {
-        if (origin.absoluteValue().doubleValue() > complexNumber.absoluteValue().doubleValue())
+        if (origin.absoluteValue().doubleValue() < complexNumber.absoluteValue().doubleValue())
             return origin;
         return complexNumber;
     }
 
     @Override
     public float op(float origin, float other) {
-        return FastMath.max(origin, num.floatValue());
+        return FastMath.min(origin, num.floatValue());
     }
 
     @Override
     public double op(double origin, double other) {
-        return FastMath.max(origin, num.doubleValue());
+        return FastMath.min(origin, num.doubleValue());
     }
 
     @Override
     public double op(double origin) {
-        return FastMath.max(origin, num.doubleValue());
+        return FastMath.min(origin, num.doubleValue());
 
     }
 
     @Override
     public float op(float origin) {
-        return FastMath.max(origin, num.floatValue());
+        return FastMath.min(origin, num.floatValue());
 
     }
 
     @Override
     public IComplexNumber op(IComplexNumber origin) {
-        if (origin.absoluteValue().doubleValue() > complexNumber.absoluteValue().doubleValue())
+        if (origin.absoluteValue().doubleValue() < complexNumber.absoluteValue().doubleValue())
             return origin;
         return complexNumber;
     }",0
1.x: Completable.mergeDelayError check unsafe availability," 
 import rx.*;
 import rx.Completable.OnSubscribe;
-import rx.internal.util.unsafe.MpscLinkedQueue;
+import rx.internal.util.atomic.MpscLinkedAtomicQueue;
+import rx.internal.util.unsafe.*;
 import rx.subscriptions.CompositeSubscription;
 
 public final class CompletableOnSubscribeMergeDelayErrorIterable implements OnSubscribe {
@@ -53,7 +54,13 @@
 
         final AtomicInteger wip = new AtomicInteger(1);
 
-        final Queue<Throwable> queue = new MpscLinkedQueue<Throwable>();
+        final Queue<Throwable> queue;
+
+        if (UnsafeAccess.isUnsafeAvailable()) {
+            queue = new MpscLinkedQueue<Throwable>();
+        } else {
+            queue = new MpscLinkedAtomicQueue<Throwable>();
+        }
 
         for (;;) {
             if (set.isUnsubscribed()) {",0
"fix http://jira.codehaus.org/browse/ACT-2123, add sequence label","         
         Collection<Point2D> intersections = eventCircle.intersections(firstLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
       
       } else if (DI_RECTANGLES.contains(sourceRefStencilId)) {
         Polyline2D rectangle = createRectangle(sourceInfo);
         
         Collection<Point2D> intersections = rectangle.intersections(firstLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
       
       } else if (DI_GATEWAY.contains(sourceRefStencilId)) {
         Polyline2D gatewayRectangle = createGateway(sourceInfo);
         
         Collection<Point2D> intersections = gatewayRectangle.intersections(firstLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
       }
       
       Line2D lastLine = null;
@@ -940,7 +940,7 @@
         
         Collection<Point2D> intersections = rectangle.intersections(lastLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
         
       } else if (DI_CIRCLES.contains(targetRefStencilId)) {
         
@@ -952,17 +952,21 @@
         
         Collection<Point2D> intersections = eventCircle.intersections(lastLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
         
       } else if (DI_GATEWAY.contains(targetRefStencilId)) {
         Polyline2D gatewayRectangle = createGateway(targetInfo);
         
         Collection<Point2D> intersections = gatewayRectangle.intersections(lastLine);
         Point2D intersection = intersections.iterator().next();
-        graphicInfoList.add(createGraphicInfo(intersection.getX(), intersection.getY()));
+        graphicInfoList.add(createGraphicInfo(intersection.x(), intersection.y()));
       }
       
       bpmnModel.addFlowGraphicInfoList(edgeId, graphicInfoList);
+      // if sequence has a name, just add a label graphic info
+      if (!"""".equals(edgeNode.get(""properties"").get(""name""))) {
+        bpmnModel.addLabelGraphicInfo(edgeId, createGraphicInfo(0D, 0D));
+      }
     }
   }
   ",0
Fixed Eclipse warnings," 		 * 
 		 * @param optionalData A Map of optional key/value pairs which provide additional information. */
 		@Override
-		public void onFailure (int arg0, String e, Bundle arg2) {
+		public void onFailure (int errorCode, String errorMessage, Bundle optionalData) {
 			// TODO: inform observer 
 			showMessage(LOGTYPEERROR, ""PurchaseListener: onFailure :("");
 		}",0
fixes Bug #1294," import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import java.security.AccessController;
+import java.security.PrivilegedAction;
 import java.util.Comparator;
 import java.util.concurrent.BlockingQueue;
 import java.util.concurrent.ExecutorService;
@@ -95,6 +97,9 @@
                 logger.error(""Failed to enqueue shutdown request"", e);
             }
         }
+        AccessController.doPrivileged(new PrivilegedAction<Object>() {
+            @Override
+            public Object run() {
         executorService.shutdown();
         try {
             if (!executorService.awaitTermination(20, TimeUnit.SECONDS)) {
@@ -105,6 +110,9 @@
             logger.warn(""Interrupted awaiting chunk thread termination"");
             executorService.shutdownNow();
         }
+                return null;
+            }
+        });
         running = false;
     }
 ",0
FIX: Can't swich to previous track with long click,"     }
 
     public void back(boolean force) {
-        if (getSongProgressMillis() > 2000) {
+        if (getSongProgressMillis() > 5000) {
             seek(0);
         } else {
             playPreviousSong(force);",0
修复新内存模式decimal列进行聚合的bug," 					case ColMeta.COL_TYPE_NEWDECIMAL:
 //						key.setDouble(i,
 //								BytesTools.getDouble(row.getBinary(curColMeta.colIndex)));
-						unsafeRowWriter.write(curColMeta.colIndex, 
-								new BigDecimal(new String(row.getBinary(i))));
+						unsafeRowWriter.write(i, 
+								new BigDecimal(new String(row.getBinary(curColMeta.colIndex))));
 						break;
 					case ColMeta.COL_TYPE_LONGLONG:
 						key.setLong(i,",0
Authentication header includes `NTLM' auth-scheme. fixes #175,"                     break;
                 case NTLM:
                     try {
-                        nettyRequest.setHeader(HttpHeaders.Names.AUTHORIZATION,
-                                ntlmEngine.generateType1Msg(""NTLM "" + domain, authHost));
+                        String msg = ntlmEngine.generateType1Msg(""NTLM "" + domain, authHost);
+                        nettyRequest.setHeader(HttpHeaders.Names.AUTHORIZATION, ""NTLM "" + msg);
                     } catch (NTLMEngineException e) {
                         IOException ie = new IOException();
                         ie.initCause(e);
@@ -2472,4 +2472,3 @@
         return isSecure(uri.getScheme());
     }
 }
-",0
Fixed bug where ESC would not close Join Game Screen. Fixes #3034,"     }
 
     public boolean onKeyEvent(NUIKeyEvent event) {
-        if (event.isDown() && event.getKey() == Keyboard.Key.R) {
+        if (event.isDown()) {
+            if (event.getKey() == Keyboard.Key.ESCAPE) {
+                if (isEscapeToCloseAllowed()) {
+                    triggerBackAnimation();
+                    return true;
+                }
+            }
+            else if (event.getKey() == Keyboard.Key.R) {
             refresh();
         }
+        }
         return false;
     }
 ",0
Fix issue when following symlinks across hdfs instances,"                         InputSplit[] splits = inputFormat.getSplits(jobConf, 0);
                         for (InputSplit rawSplit : splits) {
                             FileSplit split = ((SymlinkTextInputSplit) rawSplit).getTargetSplit();
-                            chunkPoisoner.writeChunks(createHivePartitionChunks(partitionName, fs.getFileStatus(split.getPath()),
+
+                            // get the filesystem for the target path -- it may be a different hdfs instance
+                            FileSystem targetFilesystem = split.getPath().getFileSystem(hdfsEnvironment.getConfiguration());
+                            chunkPoisoner.writeChunks(createHivePartitionChunks(partitionName, targetFilesystem.getFileStatus(split.getPath()),
                                     split.getStart(),
                                     split.getLength(),
                                     schema,
                                     partitionKeys,
-                                    fs,
+                                    targetFilesystem,
                                     false));
                         }
                         chunkPoisoner.finish();
@@ -560,8 +563,9 @@
                     }
                 });
             }
-            catch (IOException e) {
-                throw Throwables.propagate(e);
+            catch (Throwable e) {
+                partitionChunkQueue.fail(e);
+                Throwables.propagateIfInstanceOf(e, Error.class);
             }
         }
 
@@ -691,18 +695,18 @@
             private void fail(Throwable e)
             {
                 throwable.set(e);
+                queue.add(FINISHED_MARKER);
             }
 
             @Override
             protected PartitionChunk computeNext()
             {
-                if (throwable.get() != null) {
-                    throw Throwables.propagate(throwable.get());
-                }
-
                 try {
                     PartitionChunk chunk = queue.take();
                     if (chunk == FINISHED_MARKER) {
+                        if (throwable.get() != null) {
+                            throw Throwables.propagate(throwable.get());
+                        }
                         return endOfData();
                     }
                     if (outstandingChunkCount.getAndDecrement() == maxOutstandingChunks) {",0
"Fixed sound issues, when Alt+Tabbed"," import org.terasology.audio.openAL.OpenALException;
 
 public abstract class OpenALStreamingSound implements Sound {
-    private final static int BUFFER_POOL_SIZE = 3;
+    private final static int BUFFER_POOL_SIZE = 8;
 
     private final AssetUri uri;
     protected final URL audioSource;",0
possibly bug fix," 
     public String getAuthority() {
         if (StringUtils.isEmpty(username)
-                && StringUtils.isEmpty(parameter)) {
+                && StringUtils.isEmpty(password)) {
             return null;
         }
         return (username == null ? """" : username)",0
Fixed," 
 
   public List<Photo> getCurrentPhotos() {
-    if (photoDirectories.size() >= currentDirectoryIndex) {
+    if (photoDirectories.size() <= currentDirectoryIndex) {
       currentDirectoryIndex = photoDirectories.size() - 1;
     }
     return photoDirectories.get(currentDirectoryIndex).getPhotos();",0
"Revert ""[SP-4947] - Fixed missing error message in Abort step""","  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2019 by Hitachi Vantara : http://www.pentaho.com
+ * Copyright (C) 2002-2018 by Hitachi Vantara : http://www.pentaho.com
  *
  *******************************************************************************
  *
@@ -859,7 +859,7 @@
         buffer.append( getString( row, i ) );
         buffer.append( ""]"" );
       }
-      return buffer.toString().equals( """" ) ? ""No data in row"" : buffer.toString();
+      return buffer.toString();
     } finally {
       lock.readLock().unlock();
     }",0
fix issue #1648,"     protected final String DIFFUSE_COLOR = ""Kd"";
     protected final String DIFFUSE_TEX_MAP = ""map_Kd"";
 
+    private boolean mNeedToRenameMtl = true;
+
     public LoaderOBJ(Renderer renderer, String fileOnSDCard) {
     	super(renderer, fileOnSDCard);
+
+        mNeedToRenameMtl = false;
     }
 
     public LoaderOBJ(Renderer renderer, int resourceId) {
@@ -265,7 +269,8 @@
 					currObjIndexData.targetObj.setName(objName);
 				} else if(type.equals(MATERIAL_LIB)) {
 					if(!parts.hasMoreTokens()) continue;
-					String materialLibPath = parts.nextToken().replace(""."", ""_"");
+                    String materialLibPath = mNeedToRenameMtl ? parts.nextToken().replace(""."", ""_"") : parts.nextToken();
+
 					RajLog.d(""Found Material Lib: "" + materialLibPath);
 					if(mFile != null)
 						matLib.parse(materialLibPath, null, null);",0
Fixed error key in doPost(),"       return;
     } catch (IOException ioe) {
       log.info(ioe.toString());
-      errorResponse(request, response, ""badurl"");
+      errorResponse(request, response, ""badimage"");
       return;
     }
     Part fileUploadPart = null;",0
Fix empty veiw issue," package com.malinskiy.superrecyclerview;
 
-import com.malinskiy.superrecyclerview.swipe.SwipeDismissRecyclerViewTouchListener;
-import com.malinskiy.superrecyclerview.util.FloatUtil;
-
 import android.content.Context;
 import android.content.res.TypedArray;
 import android.support.annotation.ColorRes;
@@ -17,6 +14,9 @@
 import android.view.ViewStub;
 import android.widget.FrameLayout;
 
+import com.malinskiy.superrecyclerview.swipe.SwipeDismissRecyclerViewTouchListener;
+import com.malinskiy.superrecyclerview.util.FloatUtil;
+
 public class SuperRecyclerView extends FrameLayout {
 
     protected int ITEM_LEFT_TO_LOAD_MORE = 10;
@@ -375,6 +375,11 @@
      */
     public void showRecycler() {
         hideProgress();
+        if (mRecycler.getAdapter().getItemCount() == 0 && mEmptyId != 0) {
+            mEmpty.setVisibility(View.VISIBLE);
+        } else if (mEmptyId != 0) {
+            mEmpty.setVisibility(View.GONE);
+        }
         mRecycler.setVisibility(View.VISIBLE);
     }
 ",0
Fixed eventUpdate bug," 	 * @param deltaTime
 	 */
 	public void update(final double deltaTime) {
-		if (mPaused || !mPlaying)
+		if (mPaused)
 			return;
 
 		// Do not run the animation until the delay is over
@@ -306,7 +306,6 @@
 
 		// Update the elapsed time
 		mElapsedTime += deltaTime;
-		eventUpdate(deltaTime);
 
 		// End of animation reached
 		if (mElapsedTime >= mDuration && !mEnded) {
@@ -361,6 +360,7 @@
 			mInterpolatedTime = 1 - mInterpolatedTime;
 
 		applyTransformation();
+		eventUpdate(mInterpolatedTime);
 	}
 
 	/**",0
Fix for xiaomi devices with custom launcher,"             ResolveInfo resolveInfo = context.getPackageManager().resolveActivity(intent, PackageManager.MATCH_DEFAULT_ONLY);
             String currentHomePackage = resolveInfo.activityInfo.packageName;
 
-            if (Build.MANUFACTURER.equalsIgnoreCase(""Xiaomi"")) {
-                sShortcutBadger = new XiaomiHomeBadger();
-                return;
-            }
-
             for (Class<? extends Badger> badger : BADGERS) {
                 Badger shortcutBadger = badger.newInstance();
                 if (shortcutBadger.getSupportLaunchers().contains(currentHomePackage)) {
@@ -112,6 +107,11 @@
                     break;
                 }
             }
+
+            if (sShortcutBadger == null && Build.MANUFACTURER.equalsIgnoreCase(""Xiaomi"")) {
+                sShortcutBadger = new XiaomiHomeBadger();
+                return;
+            }
         } catch (Exception e) {
             Log.e(LOG_TAG, e.getMessage(), e);
         }",0
Ticket serialization performance fix for 5.2.x,"     private static final Map<String, Class> TICKET_TYPE_CACHE = new ConcurrentHashMap<>();
     private static final PrettyPrinter MINIMAL_PRETTY_PRINTER = new MinimalPrettyPrinter();
 
-    /**
-     * Gets proxy granting ticket serializer.
-     *
-     * @return the proxy granting ticket serializer
-     */
-    public static StringSerializer<ProxyGrantingTicket> getProxyGrantingTicketSerializer() {
-        return new AbstractJacksonBackedStringSerializer<ProxyGrantingTicket>(MINIMAL_PRETTY_PRINTER) {
+    private static final StringSerializer<ProxyGrantingTicket> PROXY_GRANTING_TICKET_SERIALIZER
+        = new AbstractJacksonBackedStringSerializer<ProxyGrantingTicket>(MINIMAL_PRETTY_PRINTER) {
             private static final long serialVersionUID = 7089208351327601379L;
 
             @Override
@@ -41,6 +36,54 @@
                 return ProxyGrantingTicket.class;
             }
         };
+
+    private static final StringSerializer<ProxyTicket> PROXY_TICKET_SERIALIZER
+        = new AbstractJacksonBackedStringSerializer<ProxyTicket>(MINIMAL_PRETTY_PRINTER) {
+            private static final long serialVersionUID = -6343596853082798477L;
+
+            @Override
+            protected Class<ProxyTicket> getTypeToSerialize() {
+                return ProxyTicket.class;
+            }
+        };
+
+    private static final StringSerializer<TicketGrantingTicket> TICKET_GRANTING_TICKET_SERIALIZER
+        = new AbstractJacksonBackedStringSerializer<TicketGrantingTicket>(MINIMAL_PRETTY_PRINTER) {
+            private static final long serialVersionUID = 1527874389457723545L;
+
+            @Override
+            protected Class<TicketGrantingTicket> getTypeToSerialize() {
+                return TicketGrantingTicket.class;
+            }
+        };
+
+    private static final StringSerializer<ServiceTicket> SERVICE_TICKET_SERIALIZER
+        = new AbstractJacksonBackedStringSerializer<ServiceTicket>(MINIMAL_PRETTY_PRINTER) {
+            private static final long serialVersionUID = 8959617299162115085L;
+
+            @Override
+            protected Class<ServiceTicket> getTypeToSerialize() {
+                return ServiceTicket.class;
+            }
+        };
+
+    private static final StringSerializer<EncodedTicket> ENCODED_TICKET_SERIALIZER
+        = new AbstractJacksonBackedStringSerializer<EncodedTicket>(MINIMAL_PRETTY_PRINTER) {
+            private static final long serialVersionUID = 8959835299162115085L;
+
+            @Override
+            protected Class<EncodedTicket> getTypeToSerialize() {
+                return EncodedTicket.class;
+            }
+        };
+
+    /**
+     * Gets proxy granting ticket serializer.
+     *
+     * @return the proxy granting ticket serializer
+     */
+    public static StringSerializer<ProxyGrantingTicket> getProxyGrantingTicketSerializer() {
+        return PROXY_GRANTING_TICKET_SERIALIZER;
     }
 
     /**
@@ -49,14 +92,7 @@
      * @return the proxy ticket serializer
      */
     public static StringSerializer<ProxyTicket> getProxyTicketSerializer() {
-        return new AbstractJacksonBackedStringSerializer<ProxyTicket>(MINIMAL_PRETTY_PRINTER) {
-            private static final long serialVersionUID = -6343596853082798477L;
-
-            @Override
-            protected Class<ProxyTicket> getTypeToSerialize() {
-                return ProxyTicket.class;
-            }
-        };
+        return PROXY_TICKET_SERIALIZER;
     }
 
     /**
@@ -65,14 +101,7 @@
      * @return the ticket granting ticket serializer
      */
     public static StringSerializer<TicketGrantingTicket> getTicketGrantingTicketSerializer() {
-        return new AbstractJacksonBackedStringSerializer<TicketGrantingTicket>(MINIMAL_PRETTY_PRINTER) {
-            private static final long serialVersionUID = 1527874389457723545L;
-
-            @Override
-            protected Class<TicketGrantingTicket> getTypeToSerialize() {
-                return TicketGrantingTicket.class;
-            }
-        };
+        return TICKET_GRANTING_TICKET_SERIALIZER;
     }
 
     /**
@@ -81,25 +110,11 @@
      * @return the service ticket serializer
      */
     public static StringSerializer<ServiceTicket> getServiceTicketSerializer() {
-        return new AbstractJacksonBackedStringSerializer<ServiceTicket>(MINIMAL_PRETTY_PRINTER) {
-            private static final long serialVersionUID = 8959617299162115085L;
-
-            @Override
-            protected Class<ServiceTicket> getTypeToSerialize() {
-                return ServiceTicket.class;
-            }
-        };
+        return SERVICE_TICKET_SERIALIZER;
     }
 
     public static StringSerializer<EncodedTicket> getEncodedTicketSerializer() {
-        return new AbstractJacksonBackedStringSerializer<EncodedTicket>(MINIMAL_PRETTY_PRINTER) {
-            private static final long serialVersionUID = 8959835299162115085L;
-
-            @Override
-            protected Class<EncodedTicket> getTypeToSerialize() {
-                return EncodedTicket.class;
-            }
-        };
+        return ENCODED_TICKET_SERIALIZER;
     }
     
     /**",0
fix keep alive timer starting when sending node could not be determined,"         } else {
             String nodeId = nodeId(request.remoteAddress());
             final KeepAliveTimers.ResettableTimer keepAliveTimer;
-            if (nodeId != null) {
+            if (nodeId == null) {
+                // assuming local node in this case
+                LOGGER.debug(""Could not determine direct response node for address [{}]. Assuming local node. Not starting keep alive timer."", request.remoteAddress());
+                keepAliveTimer = null;
+            } else {
                 keepAliveTimer = keepAliveTimers.forJobOnNode(request.jobId(), nodeId);
                 keepAliveTimer.start();
-            } else {
-                LOGGER.warn(""could not determine direct response node for address {}. not starting keepalive timer."", request.remoteAddress());
-                keepAliveTimer = null;
             }
-
             Futures.addCallback(Futures.allAsList(directResponseFutures), new FutureCallback<List<Bucket>>() {
                 @Override
                 public void onSuccess(List<Bucket> buckets) {",0
fix argument validation,"     public int addScopedInterceptor(MethodFilter filter, String interceptorClassName, Object[] constructorArgs, String scopeName, ExecutionPolicy executionPolicy) throws InstrumentException {
         Asserts.notNull(filter, ""filter"");
         Asserts.notNull(interceptorClassName, ""interceptorClassName"");
+        Asserts.notNull(constructorArgs, ""constructorArgs"");
         Asserts.notNull(scopeName, ""scopeName"");
         Asserts.notNull(executionPolicy, ""executionPolicy"");
         final InterceptorScope interceptorScope = pluginContext.getInterceptorScope(scopeName);",0
Fix the condition of handling Xiaomi phone,"      * @see #hasSelfPermissions(Context, String...)
      */
     private static boolean hasSelfPermission(Context context, String permission) {
-        if (Build.VERSION.SDK_INT > Build.VERSION_CODES.M && ""Xiaomi"".equalsIgnoreCase(Build.MANUFACTURER)) {
+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && ""Xiaomi"".equalsIgnoreCase(Build.MANUFACTURER)) {
             return hasSelfPermissionForXiaomi(context, permission);
         }
         try {",0
Fix ArrayIndexOutOfBoundsException on DumpVisitor#printOrphanCommentsEnding," 
        int commentsAtEnd = 0;
        boolean findingComments = true;
-       while (findingComments){
+       while (findingComments&&commentsAtEnd<everything.size()){
            Node last = everything.get(everything.size()-1-commentsAtEnd);
            findingComments = (last instanceof Comment);
            if (findingComments) commentsAtEnd++;",0
backport - fix issue with inherited fields not getting config metadata," import com.fasterxml.jackson.databind.ObjectMapper;
 import com.github.javaparser.JavaParser;
 import com.github.javaparser.ast.CompilationUnit;
+import com.github.javaparser.ast.Modifier;
+import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;
 import com.github.javaparser.ast.body.FieldDeclaration;
 import com.github.javaparser.ast.body.VariableDeclarator;
 import com.github.javaparser.ast.expr.BooleanLiteralExpr;
@@ -37,6 +39,7 @@
 import org.springframework.boot.bind.RelaxedNames;
 import org.springframework.boot.configurationmetadata.ConfigurationMetadataProperty;
 import org.springframework.boot.configurationmetadata.ValueHint;
+import org.springframework.core.io.Resource;
 import org.springframework.util.ReflectionUtils;
 
 import java.io.File;
@@ -96,7 +99,9 @@
      * @throws Exception the exception
      */
     public static void main(final String[] args) throws Exception {
-        new ConfigurationMetadataGenerator(args[0], args[1]).execute();
+        final String buildDir = args[0];
+        final String projectDir = args[1];
+        new ConfigurationMetadataGenerator(buildDir, projectDir).execute();
     }
 
     /**
@@ -159,6 +164,17 @@
         try (InputStream is = new FileInputStream(typePath)) {
             final CompilationUnit cu = JavaParser.parse(is);
             new FieldVisitor(collectedProps, collectedGroups, indexNameWithBrackets, typeName).visit(cu, p);
+            if (cu.getTypes().size() > 0) {
+                final ClassOrInterfaceDeclaration decl = ClassOrInterfaceDeclaration.class.cast(cu.getType(0));
+                for (int i = 0; i < decl.getExtendedTypes().size(); i++) {
+                    final ClassOrInterfaceType parentType = decl.getExtendedTypes().get(i);
+                    final Class parentClazz = locatePropertiesClassForType(parentType);
+                    final String parentTypePath = buildTypeSourcePath(parentClazz.getName());
+
+                    parseCompilationUnit(collectedProps, collectedGroups, p,
+                        parentTypePath, parentClazz.getName(), indexNameWithBrackets);
+                }
+            }
         } catch (final Exception e) {
             throw new RuntimeException(e.getMessage(), e);
         }
@@ -184,17 +200,19 @@
             if (field.getVariables().isEmpty()) {
                 throw new IllegalArgumentException(""Field "" + field + "" has no variable definitions"");
             }
+            final VariableDeclarator var = field.getVariable(0);
+            if (field.getModifiers().contains(Modifier.STATIC)) {
+                LOGGER.debug(""Field [{}] is static and will be ignored for metadata generation"", var.getNameAsString());
+                return;
+            }
 
             if (field.getJavadoc().isPresent()) {
                 final ConfigurationMetadataProperty prop = createConfigurationProperty(field, property);
                 processNestedClassOrInterfaceTypeIfNeeded(field, prop);
             } else {
-                final VariableDeclarator var = field.getVariable(0);
-                if (!var.getNameAsString().matches(""serialVersionUID"")) {
                     LOGGER.error(""Field "" + field + "" has no Javadoc defined"");
                 }
             }
-        }
 
         private ConfigurationMetadataProperty createConfigurationProperty(final FieldDeclaration n,
                                                                           final ConfigurationMetadataProperty arg) {
@@ -214,7 +232,6 @@
             prop.setName(indexedName);
             prop.setId(indexedName);
 
-
             final String elementType = n.getElementType().asString();
             if (elementType.equals(String.class.getSimpleName())
                     || elementType.equals(Integer.class.getSimpleName())
@@ -259,11 +276,13 @@
         }
 
         private boolean shouldTypeBeExcluded(final ClassOrInterfaceType type) {
-            return type.getNameAsString().matches(String.class.getSimpleName() + ""|""
+            return type.getNameAsString().matches(
+                String.class.getSimpleName() + ""|""
                     + Integer.class.getSimpleName() + ""|""
                     + Double.class.getSimpleName() + ""|""
                     + Long.class.getSimpleName() + ""|""
                     + Float.class.getSimpleName() + ""|""
+                    + Boolean.class.getSimpleName() + ""|""
                     + PrincipalTransformationProperties.CaseConversion.class.getSimpleName() + ""|""
                     + QueryType.class.getSimpleName() + ""|""
                     + AbstractLdapProperties.LdapType.class.getSimpleName() + ""|""
@@ -271,6 +290,7 @@
                     + PasswordPolicyProperties.PasswordPolicyHandlingOptions.class.getSimpleName() + ""|""
                     + LdapSearchEntryHandlersProperties.SearchEntryHandlerTypes.class.getSimpleName() + ""|""
                     + Map.class.getSimpleName() + ""|""
+                    + Resource.class.getSimpleName() + ""|""
                     + List.class.getSimpleName() + ""|""
                     + Set.class.getSimpleName());
         }",0
two fix issues #106 and #108," import java.net.Socket;
 import java.net.URI;
 import java.nio.ByteBuffer;
-import java.nio.channels.ClosedByInterruptException;
-import java.nio.channels.NotYetConnectedException;
-import java.nio.channels.SelectionKey;
-import java.nio.channels.Selector;
-import java.nio.channels.SocketChannel;
-import java.nio.channels.UnresolvedAddressException;
+import java.nio.channels.*;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
@@ -257,6 +252,10 @@
 		} catch ( IOException e ) {
 			onError( e );
 			conn.close( CloseFrame.ABNORMAL_CLOSE );
+        } catch ( CancelledKeyException e ) {
+            // remote peer closed the channel abnormally, probably caused by server crash or network issue
+            onError( e );
+            conn.close( CloseFrame.ABNORMAL_CLOSE );
 		} catch ( RuntimeException e ) {
 			// this catch case covers internal errors only and indicates a bug in this websocket implementation
 			onError( e );
@@ -312,6 +311,9 @@
 	 * @return Returns '0 = CONNECTING', '1 = OPEN', '2 = CLOSING' or '3 = CLOSED'
 	 */
 	public int getReadyState() {
+        if (conn == null) {
+            return WebSocket.READY_STATE_CONNECTING;
+        }
 		return conn.getReadyState();
 	}
 ",0
Fix wrong badge position in shifting mode (#708)," package com.roughike.bottombar;
 
-import android.animation.Animator;
-import android.animation.AnimatorListenerAdapter;
 import android.animation.ArgbEvaluator;
 import android.animation.ValueAnimator;
 import android.content.Context;
@@ -493,15 +491,19 @@
                 setLayoutParams(params);
             }
         });
-        animator.addListener(new AnimatorListenerAdapter() {
+
+        // Workaround to avoid using faulty onAnimationEnd() listener
+        postDelayed(new Runnable() {
             @Override
-            public void onAnimationEnd(Animator animation) {
+            public void run() {
                 if (!isActive && badge != null) {
+                    clearAnimation();
                     badge.adjustPositionAndSize(BottomBarTab.this);
                     badge.show();
                 }
             }
-        });
+        }, animator.getDuration());
+
         animator.start();
     }
 ",0
HHH-8406 - fix for EntityManagerFactoryRegistry not being thread safe (any feedback on this change?)," 		if (entityManagerFactorySet == null) {
 			throw new HibernateException( ""registry does not contain entity manager factory: "" + name);
 		}
-
+		synchronized (entityManagerFactorySet) {
 		if (entityManagerFactorySet.size() > 1) {
 			throw new HibernateException( ""registry contains more than one ("" + entityManagerFactorySet.size()+ "") entity manager factories: "" + name);
 		}
 		return entityManagerFactorySet.iterator().next();
 	}
 }
+}",0
fix used diskspace,"             childImplementations.put(USED, new ChildExpression<Long>(USED) {
                 @Override
                 public Long value() {
-                    return usage.getUsed();
+                    return usage.getUsed()*1024;
                 }
             });
             childImplementations.put(AVAILABLE, new ChildExpression<Long>(AVAILABLE) {",0
[3.7] ILock expiry operation should be able run both owner and backup,"         try {
             submit(operation, key);
         } catch (Throwable t) {
-            ILogger logger = nodeEngine.getLogger(getClass());
             logger.warning(t);
         }
     }
@@ -77,6 +76,7 @@
         OperationAccessor.setCallerAddress(operation, nodeEngine.getThisAddress());
         operation.setCallerUuid(nodeEngine.getLocalMember().getUuid());
         operation.setOperationResponseHandler(unlockResponseHandler);
+        operation.setValidateTarget(false);
         operation.setAsyncBackup(true);
 
         operationService.executeOperation(operation);",0
fix rendering height of non-liquid fluids,"     {
         if (world.getBlock(x, y, z) == block)
         {
-            if (world.getBlock(x, y - block.densityDir, z).getMaterial().isLiquid())
+            Block verticalOrigin = world.getBlock(x, y - block.densityDir, z);
+            if (verticalOrigin.getMaterial().isLiquid() || verticalOrigin instanceof IFluidBlock)
             {
                 return 1;
             }",0
[java] Avoid runtime errors on incomplete classpath,"         Class<?> contextClass = context.getType();
 
         // search the class
+        try {
         for (Method method : contextClass.getDeclaredMethods()) {
             if (isMethodApplicable(method, methodName, argArity, accessingClass, typeArguments)) {
                 result.add(getTypeDefOfMethod(context, method, typeArguments));
             }
         }
+        } catch (final LinkageError ignored) {
+            // TODO : This is an incomplete classpath, report the missing class
+        }
 
         // search it's supertype
         if (!contextClass.equals(Object.class)) {",0
Fix setting of hiscore stats after combat level," 				label.setText(Integer.toString(level));
 			}
 
-			label.setToolTipText(detailsHtml(skill));
+			label.setToolTipText(detailsHtml(result, skill));
 			index++;
 		}
 	}
@@ -521,15 +521,13 @@
 	/*
 		Builds a html string to display on tooltip (when hovering a skill).
 	 */
-	private String detailsHtml(HiscoreSkill skill)
+	private String detailsHtml(HiscoreResult result, HiscoreSkill skill)
 	{
 		String openingTags = ""<html><body style = 'padding: 5px;color:#989898'>"";
 		String closingTags = ""</html><body>"";
 
 		String content = """";
 
-		if (result != null)
-		{
 			if (skill == null)
 			{
 				double combatLevel = Experience.getCombatLevelPrecise(
@@ -632,14 +630,16 @@
 					}
 				}
 			}
-		}
 
 		/**
 		 * Adds a html progress bar to the hover information
 		 */
 		if (SKILLS.contains(skill))
 		{
-			int currentLevel = Experience.getLevelForXp((int) result.getSkill(skill).getExperience());
+			long experience = result.getSkill(skill).getExperience();
+			if (experience >= 0)
+			{
+				int currentLevel = Experience.getLevelForXp((int) experience);
 			int currentXp = (int) result.getSkill(skill).getExperience();
 			int xpForCurrentLevel = Experience.getXpForLevel(currentLevel);
 			int xpForNextLevel = currentLevel + 1 <= Experience.MAX_VIRT_LEVEL ? Experience.getXpForLevel(currentLevel + 1) : -1;
@@ -656,6 +656,7 @@
 				+ ""</div>""
 				+ ""</div>"";
 		}
+		}
 
 		return openingTags + content + closingTags;
 	}",0
Fix to reduce memory usage,"  * @author Clinton Begin
  * @author Eduardo Macarron
  * @author Iwao AVE!
+ * @author Kazuki Shimizu
  */
 public class DefaultResultSetHandler implements ResultSetHandler {
 
@@ -92,6 +93,9 @@
   // Cached Automappings
   private final Map<String, List<UnMappedColumnAutoMapping>> autoMappingsCache = new HashMap<String, List<UnMappedColumnAutoMapping>>();
   
+  // temporary marking flag that indicate using constructor mapping (use field to reduce memory usage)
+  private boolean useConstructorMappings;
+  
   private static class PendingRelation {
     public MetaObject metaObject;
     public ResultMapping propertyMapping;
@@ -376,11 +380,10 @@
 
   private Object getRowValue(ResultSetWrapper rsw, ResultMap resultMap) throws SQLException {
     final ResultLoaderMap lazyLoader = new ResultLoaderMap();
-    final ResultObject resultObject = createResultObject(rsw, resultMap, lazyLoader, null);
-    Object rowValue = resultObject.getValue();
+    Object rowValue = createResultObject(rsw, resultMap, lazyLoader, null);
     if (rowValue != null && !hasTypeHandlerForResultObject(rsw, resultMap.getType())) {
       final MetaObject metaObject = configuration.newMetaObject(rowValue);
-      boolean foundValues = resultObject.isUseConstructorMappings();
+      boolean foundValues = this.useConstructorMappings;
       if (shouldApplyAutomaticMappings(resultMap, false)) {
         foundValues = applyAutomaticMappings(rsw, resultMap, metaObject, null) || foundValues;
       }
@@ -568,7 +571,8 @@
   // INSTANTIATION & CONSTRUCTOR MAPPING
   //
 
-  private ResultObject createResultObject(ResultSetWrapper rsw, ResultMap resultMap, ResultLoaderMap lazyLoader, String columnPrefix) throws SQLException {
+  private Object createResultObject(ResultSetWrapper rsw, ResultMap resultMap, ResultLoaderMap lazyLoader, String columnPrefix) throws SQLException {
+    this.useConstructorMappings = false; // reset previous mapping result
     final List<Class<?>> constructorArgTypes = new ArrayList<Class<?>>();
     final List<Object> constructorArgs = new ArrayList<Object>();
     Object resultObject = createResultObject(rsw, resultMap, constructorArgTypes, constructorArgs, columnPrefix);
@@ -582,8 +586,8 @@
         }
       }
     }
-    final boolean useConstructorMappings = (resultObject != null && !constructorArgTypes.isEmpty());
-    return new ResultObject(resultObject, useConstructorMappings);
+    this.useConstructorMappings = (resultObject != null && !constructorArgTypes.isEmpty()); // set current mapping result
+    return resultObject;
   }
 
   private Object createResultObject(ResultSetWrapper rsw, ResultMap resultMap, List<Class<?>> constructorArgTypes, List<Object> constructorArgs, String columnPrefix)
@@ -852,11 +856,10 @@
       ancestorObjects.remove(resultMapId);
     } else {
       final ResultLoaderMap lazyLoader = new ResultLoaderMap();
-      final ResultObject resultObject = createResultObject(rsw, resultMap, lazyLoader, columnPrefix);
-      rowValue = resultObject.getValue();
+      rowValue = createResultObject(rsw, resultMap, lazyLoader, columnPrefix);
       if (rowValue != null && !hasTypeHandlerForResultObject(rsw, resultMap.getType())) {
         final MetaObject metaObject = configuration.newMetaObject(rowValue);
-        boolean foundValues = resultObject.isUseConstructorMappings();
+        boolean foundValues = this.useConstructorMappings;
         if (shouldApplyAutomaticMappings(resultMap, true)) {
           foundValues = applyAutomaticMappings(rsw, resultMap, metaObject, columnPrefix) || foundValues;
         }
@@ -1101,19 +1104,4 @@
     return typeHandlerRegistry.hasTypeHandler(resultType);
   }
 
-  private static class ResultObject {
-    private final Object value;
-    private final boolean useConstructorMappings;
-    private ResultObject(Object value, boolean useConstructorMappings) {
-      this.value = value;
-      this.useConstructorMappings = useConstructorMappings;
-    }
-    private Object getValue() {
-      return value;
-    }
-    private boolean isUseConstructorMappings() {
-      return useConstructorMappings;
-    }
-  }
-
 }",0
Fixed: iOS can't input unicode characters.," 	private UITextFieldDelegate textDelegate = new UITextFieldDelegateAdapter() {
 		@Override
 		public boolean shouldChangeCharacters(UITextField textField, NSRange range, String string) {
-			//""cheating"" to detect backspace without overriding method
-			if (range.length() > 0 && string.isEmpty()) {
+			for (int i = 0; i < range.length(); i++) {
 				app.input.inputProcessor.keyTyped((char) 8);
+			}
+
+			if (string.isEmpty()) {
 				return false;
 			}
 
 			char[] chars = new char[string.length()];
 			string.getChars(0, string.length(), chars, 0);
+
 			for (int i = 0; i < chars.length; i++) {
 				app.input.inputProcessor.keyTyped(chars[i]);
 			}
-			return false;
+
+			return true;
+		}
+
+		@Override
+		public boolean shouldEndEditing(UITextField textField) {
+			//Text field needs to have at least one symbol - so we can use backspace
+			textField.setText(""x"");
+
+			return true;
 		}
 
 		@Override",0
ACT-2217 - JPAEntityScanner fix - Method.isBridge() check in getIdMethod,"     Id idAnnotation = null;
     for(Method method : methods) {
       idAnnotation = method.getAnnotation(Id.class);
-      if(idAnnotation != null) {
+      if(idAnnotation != null && !method.isBridge()) {
         idMethod = method;
         break;
       }",0
Fixed issue with center last item in always in center tablayout,"     super.onSizeChanged(w, h, oldw, oldh);
     if (tabStrip.isIndicatorAlwaysInCenter() && tabStrip.getChildCount() > 0) {
       View firstTab = tabStrip.getChildAt(0);
-      View lastTab = tabStrip.getChildAt(getChildCount() - 1);
+      View lastTab = tabStrip.getChildAt(tabStrip.getChildCount() - 1);
       int start = (w - Utils.getMeasuredWidth(firstTab)) / 2 - Utils.getMarginStart(firstTab);
       int end = (w - Utils.getMeasuredWidth(lastTab)) / 2 - Utils.getMarginEnd(lastTab);
       tabStrip.setMinimumWidth(tabStrip.getMeasuredWidth());",0
Fix texture error message for broken textures,"         logger.error(Strings.repeat(""+="", 25));
         logger.error(""The following texture errors were found."");
         Map<String,FallbackResourceManager> resManagers = ObfuscationReflectionHelper.getPrivateValue(SimpleReloadableResourceManager.class, (SimpleReloadableResourceManager)Minecraft.getMinecraft().getResourceManager(), ""domainResourceManagers"", ""field_110548""+""_a"");
-        for (String resourceDomain : missingTextures.keySet())
+        for (String resourceDomain : badTextureDomains)
         {
             Set<ResourceLocation> missing = missingTextures.get(resourceDomain);
             logger.error(Strings.repeat(""="", 50));
@@ -964,12 +964,13 @@
                 }
             }
             logger.error(Strings.repeat(""-"", 25));
+            if (missingTextures.containsKey(resourceDomain)) {
             logger.error(""    The missing resources for domain {} are:"",resourceDomain);
-            for (ResourceLocation rl : missing)
-            {
+                for (ResourceLocation rl : missing) {
                 logger.error(""      {}"",rl.getResourcePath());
             }
             logger.error(Strings.repeat(""-"", 25));
+            }
             if (!brokenTextures.containsRow(resourceDomain))
             {
                 logger.error(""    No other errors exist for domain {}"", resourceDomain);",0
Fix typo in logging statement,"                     Thread.currentThread().interrupt();
                 }
             } catch (Exception e) {
-                logger.warn(""Unexpected exception while attemting to retrieve token and open stream. "" +
+                logger.warn(""Unexpected exception while attempting to retrieve token and open stream. "" +
                                     ""Retrying in 5 seconds."", e);
                 tx.rollback();
             }",0
Fix issue 4670,"     if (this.useLightWeigthEdges == null) {
       final List<OStorageEntryConfiguration> custom = (List<OStorageEntryConfiguration>) db.get(ODatabase.ATTRIBUTES.CUSTOM);
       for (OStorageEntryConfiguration c : custom) {
-        if (c.name.equals(""useLightweightEdges"")) {
+        if (c.name.equalsIgnoreCase(""useLightweightEdges"")) {
           this.useLightWeigthEdges = Boolean.parseBoolean(c.value);
           break;
         }",0
Fixed tiny bug with huge performance impact on world rendering.,"                     c.setPendingMesh(null);
                 }
 
-                if ((c.isDirty() || mesh == null) && isChunkValidForRender(c)) {
+                if ((c.isDirty() || c.getMesh() == null) && isChunkValidForRender(c)) {
                     statDirtyChunks++;
                     chunkUpdateManager.queueChunkUpdate(c, ChunkUpdateManager.UPDATE_TYPE.DEFAULT);
                 }",0
Potential null pointer exception when using the CategoriesProcessor," import org.thymeleaf.dom.Element;
 
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.List;
 
 import javax.annotation.Resource;
@@ -86,18 +87,20 @@
         if (categories != null && categories.size() > 0) {
             // gets child categories in order ONLY if they are in the xref table and active
             List<CategoryXref> subcategories = categories.get(0).getChildCategoryXrefs();
+            List<Category> results = Collections.emptyList();
             if (subcategories != null && !subcategories.isEmpty()) {
+                results = new ArrayList<Category>(subcategories.size());
                 if (StringUtils.isNotEmpty(unparsedMaxResults)) {
                     int maxResults = Integer.parseInt(unparsedMaxResults);
                     if (subcategories.size() > maxResults) {
                         subcategories = subcategories.subList(0, maxResults);
                     }
                 }
-            }
-            List<Category> results = new ArrayList<Category>(subcategories.size());
+                
             for (CategoryXref xref : subcategories) {
                 results.add(xref.getSubCategory());
             }
+            }
             
             addToModel(arguments, resultVar, results);
         }",0
Fix conditional packing  for issue #2883," 
 	/** @return true if the output file does not yet exist or its last modification date is before the last modification date of the
 	 *         input file */
-	static public boolean isModified (String input, String output, String packFileName) {
+	static public boolean isModified (String input, String output, String packFileName, Settings settings) {
 		String packFullFileName = output;
-		if (!packFullFileName.endsWith(""/"")) packFullFileName += ""/"";
+
+		if (!packFullFileName.endsWith(""/"")) {
+			packFullFileName += ""/"";
+		}
+
+		// Check against the only file we know for sure will exist and will be changed if any asset changes:
+		// the atlas file
 		packFullFileName += packFileName;
+		packFullFileName += settings.atlasExtension;
 		File outputFile = new File(packFullFileName);
-		if (!outputFile.exists()) return true;
+
+		if (!outputFile.exists()) {
+			return true;
+		}
 
 		File inputFile = new File(input);
-		if (!inputFile.exists()) throw new IllegalArgumentException(""Input file does not exist: "" + inputFile.getAbsolutePath());
+		if (!inputFile.exists()) {
+			throw new IllegalArgumentException(""Input file does not exist: "" + inputFile.getAbsolutePath());
+		}
+
 		return inputFile.lastModified() > outputFile.lastModified();
 	}
 
 	static public void processIfModified (String input, String output, String packFileName) {
-		if (isModified(input, output, packFileName)) process(input, output, packFileName);
+		// Default settings (Needed to access the default atlas extension string)
+		Settings settings = new Settings();
+
+		if (isModified(input, output, packFileName, settings)) {
+			process(settings, input, output, packFileName);
+		}
 	}
 
 	static public void processIfModified (Settings settings, String input, String output, String packFileName) {
-		if (isModified(input, output, packFileName)) process(settings, input, output, packFileName);
+		if (isModified(input, output, packFileName, settings)) {
+			 process(settings, input, output, packFileName);
+		}
 	}
 
 	static public interface Packer {",0
Fix for null drawable," 
     @Override
     protected void onDraw(Canvas canvas) {
-        if (!mPaused) {
             Drawable d = getDrawable();
+        if (!mPaused && d != null) {
             updateDrawableBounds();
 
             // No drawable to animate or bounds are yet to be set? We're done for now.",0
"Bugfix for JDK API, using proxies","             }
         }
 
-        HttpURLConnection urlConnection = null;
-        if (proxy == null) {
-            urlConnection = (HttpURLConnection) request.getURI().toURL().openConnection(Proxy.NO_PROXY);
-        } else {
-            urlConnection = (HttpURLConnection) proxyServer.getURI().toURL().openConnection(proxy);
-        }
+        HttpURLConnection urlConnection = (HttpURLConnection)
+            request.getURI().toURL().openConnection(proxy == null ? Proxy.NO_PROXY : proxy);
 
         if (request.getUrl().startsWith(""https"")) {
             HttpsURLConnection secure = (HttpsURLConnection) urlConnection;",0
little typo fix,"     @Message(id = 11, value = ""Session manager must not be null"")
     IllegalStateException sessionManagerMustNotBeNull();
 
-    @Message(id = 12, value = ""Session manager was not attached to the request. Make sure that the SessionAttachmentHander is installed in the handler chain"")
+    @Message(id = 12, value = ""Session manager was not attached to the request. Make sure that the SessionAttachmentHandler is installed in the handler chain"")
     IllegalStateException sessionManagerNotFound();
 
     @Message(id = 13, value = ""Argument %s cannot be null"")",0
Fixed polygon facet bug for front-face culling mode," 			mProjMatrix = projMatrix;
 			if (!mDoubleSided) {
 				GLES20.glEnable(GLES20.GL_CULL_FACE);
-				if (mBackSided)
+				if (mBackSided) {
 					GLES20.glCullFace(GLES20.GL_FRONT);
-				else
+					GLES20.glFrontFace(GLES20.GL_CW);
+				} else {
 					GLES20.glCullFace(GLES20.GL_BACK);
+					GLES20.glFrontFace(GLES20.GL_CCW);
+				}
 			}
 			if (mEnableBlending && !(pickerInfo != null && mIsPickingEnabled)) {
 				GLES20.glEnable(GLES20.GL_BLEND);",0
Added a null check when determining correct AdminSection,"                 sectionId = getSectionKey(true);
             }
 
+            if (sectionId != null) {
             if (!sectionId.startsWith(""/"")) {
                 sectionId = ""/"" + sectionId;
             }
@@ -123,6 +124,7 @@
                     break;
                 }
             }
+            }
 
             return returnSection;
         }",0
Keras Import Fix - TimeDistributed,"         Map<String, Object> outerConfig = getInnerLayerConfigFromConfig(layerConfig, conf);
         Map<String, Object> innerLayer = (Map<String, Object>) outerConfig.get(conf.getLAYER_FIELD_LAYER());
         layerConfig.put(conf.getLAYER_FIELD_CLASS_NAME(), innerLayer.get(conf.getLAYER_FIELD_CLASS_NAME()));
-        layerConfig.put(conf.getLAYER_FIELD_NAME(), innerLayer.get(conf.getLAYER_FIELD_CLASS_NAME()));
         Map<String, Object> innerConfig = getInnerLayerConfigFromConfig(innerLayer, conf);
+        innerConfig.put(conf.getLAYER_FIELD_NAME(), outerConfig.get(conf.getLAYER_FIELD_NAME()));
         outerConfig.putAll(innerConfig);
         outerConfig.remove(conf.getLAYER_FIELD_LAYER());
         return layerConfig;",0
Fix performance regression in SourcePartitionedScheduler,"                 splitAssignment = splitPlacementResult.getAssignments();
 
                 // remove splits with successful placements
-                pendingSplits.removeAll(splitAssignment.values());
+                splitAssignment.values().forEach(pendingSplits::remove); // AbstractSet.removeAll performs terribly here.
                 overallSplitAssignmentCount += splitAssignment.size();
 
                 // if not completed placed, mark scheduleGroup as blocked on placement",0
"further enhancement for pull request #3297, also fix an issue introduced in this pull request"," import org.apache.dubbo.common.logger.LoggerFactory;
 import org.apache.dubbo.common.serialize.Cleanable;
 import org.apache.dubbo.common.serialize.ObjectInput;
+import org.apache.dubbo.common.utils.ArrayUtils;
 import org.apache.dubbo.common.utils.Assert;
 import org.apache.dubbo.common.utils.StringUtils;
 import org.apache.dubbo.remoting.Channel;
@@ -79,19 +80,21 @@
             case DubboCodec.RESPONSE_NULL_VALUE:
                 break;
             case DubboCodec.RESPONSE_VALUE:
-                setResponseResult(in, true, false, false);
+                handleValue(in);
                 break;
             case DubboCodec.RESPONSE_WITH_EXCEPTION:
-                setResponseResult(in, false, true, false);
+                handleException(in);
                 break;
             case DubboCodec.RESPONSE_NULL_VALUE_WITH_ATTACHMENTS:
-                setResponseResult(in, false, false, true);
+                handleAttachment(in);
                 break;
             case DubboCodec.RESPONSE_VALUE_WITH_ATTACHMENTS:
-                setResponseResult(in, true, false, true);
+                handleValue(in);
+                handleAttachment(in);
                 break;
             case DubboCodec.RESPONSE_WITH_EXCEPTION_WITH_ATTACHMENTS:
-                setResponseResult(in, false, true, false);
+                handleException(in);
+                handleAttachment(in);
                 break;
             default:
                 throw new IOException(""Unknown result flag, expect '0' '1' '2', get "" + flag);
@@ -119,28 +122,44 @@
         }
     }
 
-    private void setResponseResult(ObjectInput in, boolean hasValue, boolean hasException, boolean hasAttachments) throws IOException {
+    private void handleValue(ObjectInput in) throws IOException {
         try {
-            if (hasValue) {
-                Type[] returnType = RpcUtils.getReturnTypes(invocation);
-                setValue(returnType == null || returnType.length == 0 ? in.readObject() :
-                        (returnType.length == 1 ? in.readObject((Class<?>) returnType[0])
-                                : in.readObject((Class<?>) returnType[0], returnType[1])));
+            Type[] returnTypes = RpcUtils.getReturnTypes(invocation);
+            Object value = null;
+            if (ArrayUtils.isEmpty(returnTypes)) {
+                value = in.readObject();
+            } else if (returnTypes.length == 1) {
+                value = in.readObject((Class<?>) returnTypes[0]);
+            } else {
+                value = in.readObject((Class<?>) returnTypes[0], returnTypes[1]);
             }
-            if (hasException) {
+            setValue(value);
+        } catch (ClassNotFoundException e) {
+            rethrow(e);
+        }
+    }
+
+    private void handleException(ObjectInput in) throws IOException {
+        try {
                 Object obj = in.readObject();
-                if (obj instanceof Throwable == false) {
+            if (!(obj instanceof Throwable)) {
                     throw new IOException(""Response data error, expect Throwable, but get "" + obj);
                 }
                 setException((Throwable) obj);
-            }
-            if (hasAttachments) {
-                setAttachments((Map<String, String>) in.readObject(Map.class));
-            }
         } catch (ClassNotFoundException e) {
+            rethrow(e);
+        }
+    }
+
+    private void handleAttachment(ObjectInput in) throws IOException {
+        try {
+            setAttachments((Map<String, String>) in.readObject(Map.class));
+        } catch (ClassNotFoundException e) {
+            rethrow(e);
+        }
+    }
+
+    private void rethrow(Exception e) throws IOException {
             throw new IOException(StringUtils.toString(""Read response data failed."", e));
         }
-
-    }
-
 }",0
Fix for breakpoints causing a reload prompt,"     List<LineBreakpoint> bps = debugger.getBreakpoints(tab.getFileName());
 
     // load the source file
-    File sourceFile = new File(sketch.getFolder(), tab.getFileName());
+    ////switched to using methods provided by the SketchCode class
+    // File sourceFile = new File(sketch.getFolder(), tab.getFileName());
     //System.out.println(""file: "" + sourceFile);
     try {
-      String code = Base.loadFile(sourceFile);
+      tab.load();
+      String code = tab.getProgram();
       //System.out.println(""code: "" + code);
       String lines[] = code.split(""\\r?\\n""); // newlines not included
       for (LineBreakpoint bp : bps) {
@@ -1674,7 +1676,8 @@
       }
       code = PApplet.join(lines, ""\n"");
       //System.out.println(""new code: "" + code);
-      Base.saveFile(code, sourceFile);
+      tab.setProgram(code);
+      tab.save();
     } catch (IOException ex) {
       Logger.getLogger(JavaEditor.class.getName()).log(Level.SEVERE, null, ex);
     }",0
Fix NPE in BenchmarkQueryResult," 
     public static BenchmarkQueryResult passResult(Suite suite, BenchmarkQuery benchmarkQuery, Stat wallTimeNanos, Stat processCpuTimeNanos, Stat queryCpuTimeNanos)
     {
-        return new BenchmarkQueryResult(suite, benchmarkQuery, Status.PASS, null, wallTimeNanos, processCpuTimeNanos, queryCpuTimeNanos);
+        return new BenchmarkQueryResult(suite, benchmarkQuery, Status.PASS, Optional.empty(), wallTimeNanos, processCpuTimeNanos, queryCpuTimeNanos);
     }
 
     public static BenchmarkQueryResult failResult(Suite suite, BenchmarkQuery benchmarkQuery, String errorMessage)",0
fixed clone rotation and scale cloning," 	public Object3D clone(boolean copyMaterial, boolean cloneChildren) {
 		Object3D clone = new Object3D();
 		cloneTo(clone, copyMaterial);
-		clone.setRotation(getRotation());
-		clone.setScale(getScale());
+        clone.setRotation(getRotation().clone());
+        clone.setScale(getScale().clone());
 		
 		if(cloneChildren)
 		{",0
fix:修复 client timeout 没设置的问题,"                     if (logger.isInfoEnabled()) {
                         logger.info(""Close dubbo connect: "" + client.getLocalAddress() + ""-->"" + client.getRemoteAddress());
                     }
-                    client.close();
+                    client.close(getServerShutdownTimeout());
                 } catch (Throwable t) {
                     logger.warn(t.getMessage(), t);
                 }
@@ -412,7 +412,7 @@
                     if (logger.isInfoEnabled()) {
                         logger.info(""Close dubbo connect: "" + client.getLocalAddress() + ""-->"" + client.getRemoteAddress());
                     }
-                    client.close();
+                    client.close(getServerShutdownTimeout());
                 } catch (Throwable t) {
                     logger.warn(t.getMessage(), t);
                 }",0
bugfix and update doc.,"  * @since 16/8/16 14:39
  */
 final class _ARouter {
-    static ILogger logger = new DefaultLogger(Consts.TAG); // 日志工具
+    static ILogger logger = new DefaultLogger(Consts.TAG);
     private volatile static boolean monitorMode = false;
     private volatile static boolean debuggable = false;
     private volatile static boolean autoInject = false;
@@ -64,10 +64,6 @@
         hasInit = true;
         mHandler = new Handler(Looper.getMainLooper());
 
-        // It's not a good idea.
-        // if (Build.VERSION.SDK_INT > Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
-        //     application.registerActivityLifecycleCallbacks(new AutowiredLifecycleCallback());
-        // }
         return true;
     }
 
@@ -285,11 +281,17 @@
         } catch (NoRouteFoundException ex) {
             logger.warning(Consts.TAG, ex.getMessage());
 
-            if (debuggable()) { // Show friendly tips for user.
+            if (debuggable()) {
+                // Show friendly tips for user.
+                runInMainThread(new Runnable() {
+                    @Override
+                    public void run() {
                 Toast.makeText(mContext, ""There's no route matched!\n"" +
                         "" Path = ["" + postcard.getPath() + ""]\n"" +
                         "" Group = ["" + postcard.getGroup() + ""]"", Toast.LENGTH_LONG).show();
             }
+                });
+            }
 
             if (null != callback) {
                 callback.onLost(postcard);
@@ -364,16 +366,12 @@
                 }
 
                 // Navigation in main looper.
-                if (Looper.getMainLooper().getThread() != Thread.currentThread()) {
-                    mHandler.post(new Runnable() {
+                runInMainThread(new Runnable() {
                         @Override
                         public void run() {
                             startActivity(requestCode, currentContext, intent, postcard, callback);
                         }
                     });
-                } else {
-                    startActivity(requestCode, currentContext, intent, postcard, callback);
-                }
 
                 break;
             case PROVIDER:
@@ -403,6 +401,28 @@
         return null;
     }
 
+    /**
+     * Be sure execute in main thread.
+     *
+     * @param runnable code
+     */
+    private void runInMainThread(Runnable runnable) {
+        if (Looper.getMainLooper().getThread() != Thread.currentThread()) {
+            mHandler.post(runnable);
+        } else {
+            runnable.run();
+        }
+    }
+
+    /**
+     * Start activity
+     *
+     * @param requestCode
+     * @param currentContext
+     * @param intent
+     * @param postcard
+     * @param callback
+     */
     private void startActivity(int requestCode, Context currentContext, Intent intent, Postcard postcard, NavigationCallback callback) {
         if (requestCode >= 0) {  // Need start for result
             ActivityCompat.startActivityForResult((Activity) currentContext, intent, requestCode, postcard.getOptionsBundle());",0
fix #89: removing unused fields from CommentsParser.State," 
     private enum State {
         CODE,
-        WAITING_FOR_LINE_COMMENT,
         IN_LINE_COMMENT,
-        WAITING_FOR_BLOCK_COMMENT,
         IN_BLOCK_COMMENT,
-        WAITING_TO_LEAVE_BLOCK_COMMENT,
         IN_STRING;
     }
 ",0
Fixed a typo in a comment,"               }
             } else if (param.isRegExp()) {
               if (""replace"".equals(method)) {
-                // Assume anything but a string constant has a side-effects
+                // Assume anything but a string constant has side-effects
                 return !param.getNext().isString();
               } else if (STRING_REGEXP_METHODS.contains(method)) {
                 return false;",0
Fixing mutual tls on the server side," import org.xnio.IoUtils;
 import org.xnio.OptionMap;
 import org.xnio.Options;
+import org.xnio.SslClientAuthMode;
 
 import javax.net.ssl.*;
 import java.io.BufferedInputStream;
@@ -216,6 +217,10 @@
                 builder.setServerOption(UndertowOptions.ENABLE_HTTP2, true);
             }
 
+            if (config.isEnableTwoWayTls()) {
+               builder.setSocketOption(Options.SSL_CLIENT_AUTH_MODE, SslClientAuthMode.REQUIRED);
+            }            
+
             server = builder.setBufferSize(1024 * 16).setIoThreads(Runtime.getRuntime().availableProcessors() * 2)
                     // above seems slightly faster in some configurations
                     .setSocketOption(Options.BACKLOG, 10000)
@@ -361,7 +366,7 @@
 
     private static TrustManager[] buildTrustManagers(final KeyStore trustStore) {
         TrustManager[] trustManagers = null;
-        if (trustStore == null) {
+        if (trustStore != null) {
             try {
                 TrustManagerFactory trustManagerFactory = TrustManagerFactory
                         .getInstance(KeyManagerFactory.getDefaultAlgorithm());
@@ -372,6 +377,7 @@
                 throw new RuntimeException(""Unable to initialise TrustManager[]"", e);
             }
         } else {
+            logger.warn(""Unable to find server truststore while Mutual TLS is enabled. Falling back to trust all certs."");
             trustManagers = TRUST_ALL_CERTS;
         }
         return trustManagers;",0
Fix NPE in TextFileInput step added recently,"       // If there are missing files, fail if we don't ignore errors
       //
       Result previousResult = getTrans().getPreviousResult();
-      Map<String, ResultFile> resultFiles = previousResult.getResultFiles();
+      Map<String, ResultFile> resultFiles = ( previousResult != null ) ? previousResult.getResultFiles() : null;
 
       if ( ( previousResult == null || resultFiles == null || resultFiles.size() == 0 )
           && data.files.nrOfMissingFiles() > 0 && !meta.isAcceptingFilenames() && !meta.isErrorIgnored() ) {",0
Fix proxy classes generation reproducibility," import java.sql.ResultSet;
 import java.sql.Statement;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.HashSet;
+import java.util.LinkedHashSet;
 import java.util.List;
 import java.util.Set;
 
@@ -142,8 +142,7 @@
       }
 
       Set<String> methods = new HashSet<>();
-      Set<Class<?>> interfaces = getAllInterfaces(primaryInterface);
-      for (Class<?> intf : interfaces) {
+      for (Class<?> intf : getAllInterfaces(primaryInterface)) {
          CtClass intfCt = classPool.getCtClass(intf.getName());
          targetCt.addInterface(intfCt);
          for (CtMethod intfMethod : intfCt.getDeclaredMethods()) {
@@ -222,13 +221,13 @@
          paramTypes.add(toJavaClass(pt));
       }
 
-      return intf.getDeclaredMethod(intfMethod.getName(), paramTypes.toArray(new Class[paramTypes.size()])).toString().contains(""default "");
+      return intf.getDeclaredMethod(intfMethod.getName(), paramTypes.toArray(new Class[0])).toString().contains(""default "");
    }
 
    private static Set<Class<?>> getAllInterfaces(Class<?> clazz)
    {
-      Set<Class<?>> interfaces = new HashSet<>();
-      for (Class<?> intf : Arrays.asList(clazz.getInterfaces())) {
+      Set<Class<?>> interfaces = new LinkedHashSet<>();
+      for (Class<?> intf : clazz.getInterfaces()) {
          if (intf.getInterfaces().length > 0) {
             interfaces.addAll(getAllInterfaces(intf));
          }",0
Fix for unexpected behaviour from Geometry3D.addFromGeometry3D," 
     public static float[] getFloatArrayFromBuffer(FloatBuffer buffer) {
         float[] array = null;
+        if(buffer != null) {
         if (buffer.hasArray()) {
             array = buffer.array();
         } else {
@@ -201,11 +202,13 @@
             array = new float[buffer.capacity()];
             buffer.get(array);
         }
+        }
         return array;
     }
 
     public static int[] getIntArrayFromBuffer(Buffer buffer) {
         int[] array = null;
+        if(buffer != null) {
         if (buffer.hasArray()) {
             array = (int[]) buffer.array();
         } else {
@@ -221,6 +224,7 @@
                 }
             }
         }
+        }
         return array;
     }
 
@@ -302,10 +306,15 @@
         float[] addColors = getFloatArrayFromBuffer(geometry.getColors());
         float[] addTextureCoords = getFloatArrayFromBuffer(geometry.getTextureCoords());
         int[] addIndices = getIntArrayFromBuffer(geometry.getIndices());
-        int index_offset = (mVerticesArray.length / 3);
+        int index_offset = 0;
+        if(mVerticesArray != null) {
+            index_offset = (mVerticesArray.length / 3);
+        }
+        if(addIndies != null) {
         for (int i = 0, j = addIndices.length; i < j; ++i) {
             addIndices[i] += index_offset;
         }
+        }
 
         //Concatenate the old and new data
         newVertices = concatAllFloat(mVerticesArray, addVertices);",0
Minor compilation fix for YOLO2 model post PR merge,"         // reorg
         graphBuilder
                 .addLayer(""rearrange_21"",
-                        new SpaceToDepthLayer.Builder(new int[] {2, 2}).build(),
+                        new SpaceToDepthLayer.Builder(2).build(),
                         ""activation_21"")
         // route
                 .addVertex(""concatenate_21"", new MergeVertex(),",0
Fix wince-arm detection (affects only unittests),"         C_LIBRARY_NAME = osType == WINDOWS ? ""msvcrt"" : osType == WINDOWSCE ? ""coredll"" : ""c"";
         MATH_LIBRARY_NAME = osType == WINDOWS ? ""msvcrt"" : osType == WINDOWSCE ? ""coredll"" : ""m"";
         HAS_DLL_CALLBACKS = osType == WINDOWS;
-	ARCH = getCanonicalArchitecture(System.getProperty(""os.arch""));
+	ARCH = getCanonicalArchitecture(System.getProperty(""os.arch""), osType);
         RESOURCE_PREFIX = getNativeLibraryResourcePrefix();
     }
     private Platform() { }
@@ -236,7 +236,7 @@
         return false;
     }
 
-    static String getCanonicalArchitecture(String arch) {
+    static String getCanonicalArchitecture(String arch, int platform) {
 	arch = arch.toLowerCase().trim();
         if (""powerpc"".equals(arch)) {
             arch = ""ppc"";
@@ -256,7 +256,7 @@
 	    arch = ""ppc64le"";
 	}
         // Map arm to armel if the binary is running as softfloat build
-        if(""arm"".equals(arch) && isSoftFloat()) {
+        if(""arm"".equals(arch) && platform == Platform.LINUX && isSoftFloat()) {
             arch = ""armel"";
         }
         
@@ -300,7 +300,7 @@
     */
     static String getNativeLibraryResourcePrefix(int osType, String arch, String name) {
         String osPrefix;
-        arch = getCanonicalArchitecture(arch);
+        arch = getCanonicalArchitecture(arch, osType);
         switch(osType) {
         case Platform.ANDROID:
             if (arch.startsWith(""arm"")) {",0
Fixed issue that could lead to unclosed contexts,"         while (true) {
             JobExecutionContext existing = activeContexts.putIfAbsent(jobId, newContext);
             if (existing == null) {
+                synchronized (newContext.mergeLock) {
                 newContext.contextCallback(new RemoveContextCallback(jobId));
+                }
                 return newContext;
             } else {
                 LOGGER.trace(""context for job {} already existed. Merging them "", jobId);
-                ContextCallback callback = existing.contextCallback;
                 synchronized (existing.mergeLock) {
+                    ContextCallback callback = existing.contextCallback;
                     existing.contextCallback = null;
                     existing.merge(newContext);
-                }
+
                 JobExecutionContext context = activeContexts.putIfAbsent(jobId, existing);
                 if (context == null || existing == context) {
-                    synchronized (existing.mergeLock) {
                         existing.contextCallback = callback;
-                    }
                     return existing;
                 }
             }
         }
     }
+    }
 
     private class RemoveContextCallback implements ContextCallback {
         private final UUID jobId;",0
Fixed possible file handle leak,"             }
         } catch (FileNotFoundException e) {
             // a file must have been deleted manually!
+            for (int i = 0; i < valueCount; i++) {
+                if (ins[i] != null) {
+                    IoUtils.closeQuietly(ins[i]);
+                } else {
+                    break;
+                }
+            }
             return null;
         }
 ",0
Release ping/pong command buffer," import io.netty.buffer.ByteBuf;
 import io.netty.buffer.PooledByteBufAllocator;
 import io.netty.buffer.RecyclableDuplicateByteBuf;
+import io.netty.buffer.Unpooled;
 import io.netty.buffer.UnpooledByteBufAllocator;
 import io.netty.buffer.UnpooledHeapByteBuf;
 import io.netty.util.Recycler;
@@ -531,18 +532,34 @@
         return res;
     }
 
-    private final static ByteBuf cmdPing = serializeWithSize(
-            BaseCommand.newBuilder().setType(Type.PING).setPing(CommandPing.getDefaultInstance()));
+    private final static ByteBuf cmdPing;
 
-    static ByteBuf newPing() {
-        return RecyclableDuplicateByteBuf.create(cmdPing).retain();
+    static {
+        ByteBuf serializedCmdPing = serializeWithSize(
+                   BaseCommand.newBuilder()
+                       .setType(Type.PING)
+                       .setPing(CommandPing.getDefaultInstance()));
+        cmdPing = Unpooled.copiedBuffer(serializedCmdPing);
+        serializedCmdPing.release();
     }
 
-    private final static ByteBuf cmdPong = serializeWithSize(
-            BaseCommand.newBuilder().setType(Type.PONG).setPong(CommandPong.getDefaultInstance()));
+    static ByteBuf newPing() {
+    	return RecyclableDuplicateByteBuf.create(cmdPing);
+    }
+
+    private final static ByteBuf cmdPong;
+
+    static {
+        ByteBuf serializedCmdPong = serializeWithSize(
+                   BaseCommand.newBuilder()
+                       .setType(Type.PONG)
+                       .setPong(CommandPong.getDefaultInstance()));
+        cmdPong = Unpooled.copiedBuffer(serializedCmdPong);
+        serializedCmdPong.release();
+    }
 
     static ByteBuf newPong() {
-        return RecyclableDuplicateByteBuf.create(cmdPong).retain();
+    	return RecyclableDuplicateByteBuf.create(cmdPong);
     }
 
     private static ByteBuf serializeWithSize(BaseCommand.Builder cmdBuilder) {",0
Fix logical error in null check.,"           return;
         }
 
-        if (key == null) {
+        if (key != null) {
           mDocument.setElementStyle(elementForNodeId, ruleName, key, value);
         }
 ",0
[BACKLOG-6041] Reducing log message from basic to debug,"         }
       } catch ( ClassCastException cce ) {
         // Not all Lifecycle plugins implement GUIOption, keep calm and carry on
-        LogChannel.GENERAL.logBasic( ""Plugin "" + plugin.getIds()[0]
+        LogChannel.GENERAL.logDebug( ""Plugin "" + plugin.getIds()[0]
             + "" does not implement GUIOption, it will not be editable"" );
       } catch ( Exception e ) {
         LogChannel.GENERAL.logError( ""Unexpected error loading class for plugin "" + plugin.getName(), e );",0
Fix a trailing whitespace in CompilerExecutor.java,,0
Fix JIRA BLC-864 Wrong friendlyType in FulfillmentType," 
     public static final FulfillmentType DIGITAL = new FulfillmentType(""DIGITAL"", ""Digital"");
     public static final FulfillmentType PHYSICAL_SHIP = new FulfillmentType(""PHYSICAL_SHIP"", ""Physical Ship"");
-    public static final FulfillmentType PHYSICAL_PICKUP = new FulfillmentType(""PHYSICAL_PICKUP"", ""Physical Ship"");
+    public static final FulfillmentType PHYSICAL_PICKUP = new FulfillmentType(""PHYSICAL_PICKUP"", ""Physical Pickup"");
     public static final FulfillmentType PHYSICAL_PICKUP_OR_SHIP = new FulfillmentType(""PHYSICAL_PICKUP_OR_SHIP"", ""Physical Pickup or Ship"");
     @Deprecated
     public static final FulfillmentType SHIPPING = new FulfillmentType(""SHIPPING"", ""Shipping"");",0
Fix #1955,"             if (!entry.getKey().isPlaying()) {
                 iterator.remove();
 
+                try {
                 entry.getValue().onAudioEnd();
+                } catch (Exception e) {
+                    logger.error(""onAudioEnd() notification failed for {}"", entry.getValue(), e);
+                }
             }
         }
     }",0
make RawMessageEvent's fields volatile to guard against cross-cpu vis…," public class RawMessageEvent {
 
     // the rawmessage will get be nulled as soon as the encoded raw message is being generated
-    private RawMessage rawMessage;
+    private volatile RawMessage rawMessage;
 
     // once these fields are set, do NOT rely on rawMessage still being non-null!
-    private byte[] messageIdBytes;
-    private byte[] encodedRawMessage;
+    private volatile byte[] messageIdBytes;
+    private volatile byte[] encodedRawMessage;
 
     public static final EventFactory<RawMessageEvent> FACTORY = new EventFactory<RawMessageEvent>() {
         @Override",0
fix queryintentservice & readme add install flags," 
 		List<ResolveInfo> pluginResult = LocalPackageManager.getInstance().queryIntentServices((Intent) args[0],
 				(String) args[1], (Integer) args[2]);
-		if (result == null) {
+
+		if (result == null) {//貌似不会为null
 			result = new ArrayList<ResolveInfo>();
 		}
-		if (pluginResult != null && !pluginResult.isEmpty()) {
-			result.addAll(pluginResult);
+
+		if (!result.isEmpty()) {//双开模式下返回系统获取的
+			return result;
 		}
 
+		if (pluginResult != null && !pluginResult.isEmpty()) {//如果系统没有安装,单开模式下返回从apk中解析的,一般情况下只有一个
+//            result.addAll(pluginResult);
+			return pluginResult;
+		}
 		return result;
 	}
 }",0
"Fix icon handling in vote result table, fix #2141","             public TableCell<ProposalListItem, ProposalListItem> call(TableColumn<ProposalListItem,
                     ProposalListItem> column) {
                 return new TableCell<>() {
-                    Label myVoteIcon;
-
                     @Override
                     public void updateItem(final ProposalListItem item, boolean empty) {
                         super.updateItem(item, empty);
 
                         if (item != null && !empty) {
-                            if (myVoteIcon == null) {
-                                myVoteIcon = item.getMyVoteIcon();
-                                setGraphic(myVoteIcon);
-                            }
+                            setGraphic(item.getMyVoteIcon());
                         } else {
                             setGraphic(null);
-                            if (myVoteIcon != null)
-                                myVoteIcon = null;
                         }
                     }
                 };
@@ -734,21 +727,17 @@
             public TableCell<ProposalListItem, ProposalListItem> call(TableColumn<ProposalListItem,
                     ProposalListItem> column) {
                 return new TableCell<>() {
-                    Label icon;
-
                     @Override
                     public void updateItem(final ProposalListItem item, boolean empty) {
                         super.updateItem(item, empty);
 
                         if (item != null && !empty) {
-                            icon = new Label();
+                            Label icon = new Label();
                             AwesomeDude.setIcon(icon, item.getIcon());
                             icon.getStyleClass().add(item.getColorStyleClass());
                             setGraphic(icon);
                         } else {
                             setGraphic(null);
-                            if (icon != null)
-                                icon = null;
                         }
                     }
                 };",0
Keras Import Fix - Embedding + Convolution," 
     @Override
     public InputType getOutputType(InputType inputType) throws InvalidInputTypeException {
-
         val shape = hasMiniBatchDimension ? targetShape : prependMiniBatchSize(targetShape, 0);
         switch (shape.length) {
             case 2:
@@ -131,10 +130,11 @@
             case 3:
                 return InputType.recurrent(shape[2], shape[1]);
             case 4:
-                if (inputShape.length == 1)
+                if (inputShape.length == 1 || inputType.getType() == InputType.Type.RNN){
                     return InputType.convolutional(shape[1], shape[2], shape[3]);
-                else
+                }else {
                     return InputType.convolutional(shape[2], shape[3], shape[1]);
+                }
             default:
                 throw new UnsupportedOperationException(
                         ""Cannot infer input type for reshape array "" + Arrays.toString(shape));",0
"Made CharSeq.repeat(CharSequence, int) an instance method. Fixes #620","     }
 
     /**
-     * Returns a singleton {@code CharSeq}, i.e. a {@code CharSeq} of one element.
+     * Returns a singleton {@code CharSeq}, i.e. a {@code CharSeq} of one character.
      *
-     * @param element An element.
+     * @param character A character.
      * @return A new {@code CharSeq} instance containing the given element
      */
-    public static CharSeq of(Character element) {
-        return new CharSeq(new java.lang.String(new char[] { element }));
+    public static CharSeq of(char character) {
+        return new CharSeq(new java.lang.String(new char[] { character }));
     }
 
     /**
-     * Creates a String of the given elements.
+     * Creates a String of the given characters.
      *
-     * @param elements Zero or more elements.
-     * @return A string containing the given elements in the same order.
+     * @param characters Zero or more characters.
+     * @return A string containing the given characters in the same order.
      * @throws NullPointerException if {@code elements} is null
      */
-    public static CharSeq of(Character... elements) {
-        Objects.requireNonNull(elements, ""elements is null"");
-        final char[] chrs = new char[elements.length];
-        for (int i = 0; i < elements.length; i++) {
-            chrs[i] = elements[i];
+    public static CharSeq of(char... characters) {
+        Objects.requireNonNull(characters, ""characters is null"");
+        final char[] chrs = new char[characters.length];
+        for (int i = 0; i < characters.length; i++) {
+            chrs[i] = characters[i];
         }
         return new CharSeq(new java.lang.String(chrs));
     }
@@ -90,8 +90,12 @@
      */
     public static CharSeq of(CharSequence sequence) {
         Objects.requireNonNull(sequence, ""sequence is null"");
+        if (sequence instanceof CharSeq) {
+            return (CharSeq) sequence;
+        } else {
         return sequence.length() == 0 ? empty() : new CharSeq(sequence.toString());
     }
+    }
 
     /**
      * Creates a String of the given elements.
@@ -204,18 +208,17 @@
     }
 
     /**
-     * Repeats a character sequences {@code times} times.
+     * Repeats this CharSeq {@code times} times.
+     * <p>
+     * Example: {@code CharSeq.of(""ja"").repeat(13) = ""jajajajajajajajajajajajaja""}
      *
-     * @param characters A character sequence
      * @param times Repetition count
-     * @return A CharSeq representing {@code characters * times}
-     * @throws NullPointerException if characters is null
+     * @return A CharSeq representing {@code this * times}
      */
-    public static CharSeq repeat(CharSequence characters, int times) {
-        Objects.requireNonNull(characters, ""characters is null"");
+    public CharSeq repeat(int times) {
         final StringBuilder builder = new StringBuilder();
         for (int i = 0; i < times; i++) {
-            builder.append(characters);
+            builder.append(back);
         }
         return new CharSeq(builder.toString());
     }",0
Fixed memory leak in message throttle mechanism,"                             .collect(Collectors.toList()).toString());
                 }
             }
-            // we limit to max 1000 (MSG_THROTTLE_PER_10SEC) entries
-            messageTimeStamps.remove(0);
         }
+        // we limit to max 1000 (MSG_THROTTLE_PER_10SEC) entries
+        while(messageTimeStamps.size() > MSG_THROTTLE_PER_10_SEC)
+            messageTimeStamps.remove(0);
 
         messageTimeStamps.add(new Tuple2<>(now, networkEnvelope));
         return violated;",0
"fixed typos 'ad' , 'application'"," // NOTE:
 // This class emulates a server for the purposes of this sample,
 // but it's not meant to serve as an example for a production app server.
-// This class should also not be included in the client (Android) applicaiton
+// This class should also not be included in the client (Android) application
 // since it includes the server's API key. For information on GCM server
 // implementation see: https://developers.google.com/cloud-messaging/server
 public class GcmSender {",0
Fix isColumnVector() for 1x1 arrays,"      */
     @Override
     public boolean isVector() {
-
-        boolean ret =   isRowVector() || isColumnVector();
-        return ret;
+        return isRowVector() || isColumnVector();
     }
 
     @Override
@@ -4468,7 +4466,7 @@
      */
     @Override
     public boolean isRowVector() {
-        return rank == 1 || rank == 2 && rows == 1;
+        return rank == 2 && rows == 1;
     }
 
     /**
@@ -4476,8 +4474,7 @@
      */
     @Override
     public boolean isColumnVector() {
-        if(length == 1 || rank > 2) return false;
-        return columns == 1;
+        return rank == 2 && columns == 1;
     }
 
     /**",0
Fixed typo in a cryptic clue solution," 		new CrypticClue(""One of the sailors in Port Sarim is your next destination."", ""Captain Tobias"", new WorldPoint(3026, 3216, 0), ""Speak to Captain Tobias on the docks of Port Sarim.""),
 		new CrypticClue(""THEY'RE EVERYWHERE!!!! But they were here first. Dig for treasure where the ground is rich with ore."", new WorldPoint(3081, 3421, 0), ""Dig at Barbarian Village, next to the Stronghold of Security.""),
 		new CrypticClue(""Talk to the mother of a basement dwelling son."", ""Doris"", new WorldPoint(3079, 3493, 0), ""Evil Dave's mother, Doris is located in the house west of Edgeville bank.""),
-		new CrypticClue(""Speak to Ned in Draynor Village."", ""Ned"", new WorldPoint(3098, 3258, 0), ""Ned is found north or the Draynor bank.""),
+		new CrypticClue(""Speak to Ned in Draynor Village."", ""Ned"", new WorldPoint(3098, 3258, 0), ""Ned is found north of the Draynor bank.""),
 		new CrypticClue(""Speak to Hans to solve the clue."", ""Hans"", new WorldPoint(3211, 3219, 0), ""Hans can be found at Lumbridge Castle.""),
 		new CrypticClue(""Search the crates in Canifis."", CRATE_24344, new WorldPoint(3509, 3497, 0), ""Search inside the shop, Rufus' Meat Emporium.""),
 		new CrypticClue(""Search the crates in the Dwarven mine."", CRATE_357, new WorldPoint(3035, 9849, 0), ""Search the crate in the room east of the Ice Mountain ladder entrance in the Drogo's Mining Emporium.""),",0
Fix unlikely yet theoretically possible NPE," 			nextIsType(Opcodes.NEW, ""java/lang/IllegalStateException"");
 			nextIs(Opcodes.DUP);
 			nextIs(Opcodes.LDC);
+			if (cursor == null) {
+				return;
+			}
 			if (!((LdcInsnNode) cursor).cst.equals(
 					""call to 'resume' before 'invoke' with coroutine"")) {
 				return;",0
fix dirty value," 	 * @param lights The lights collection
 	 */
 	public void setLights(List<ALight> lights) {
-		boolean hasChanged = false;
 		if(mLights != null)
 		{
 			for(ALight light : lights)
 			{
 				if (!mLights.contains(light))
 				{
-					hasChanged = true;
 					break;
 				}
 			}
 		} else {
-			hasChanged = true;
+			mIsDirty = true;
 			mLights = lights;
 		}
 	}",0
This pull request fixes my last one and adds a new fix.," 
     }
 
+    private static boolean isProxyServer(AsyncHttpClientConfig config, Request request) {
+    	return request.getProxyServer() != null || config.getProxyServer() != null;
+    }
+
     protected final static HttpRequest buildRequest(AsyncHttpClientConfig config, Request request, URI uri,
                                                     boolean allowConnect, ChannelBuffer buffer) throws IOException {
 
         String method = request.getMethod();
-        if (allowConnect && ((request.getProxyServer() != null || config.getProxyServer() != null) && HTTPS.equalsIgnoreCase(uri.getScheme()))) {
+        if (allowConnect && (isProxyServer(config, request) && HTTPS.equalsIgnoreCase(uri.getScheme()))) {
             method = HttpMethod.CONNECT.toString();
         }
         return construct(config, request, new HttpMethod(method), uri, buffer);
@@ -520,10 +524,15 @@
         if (m.equals(HttpMethod.CONNECT)) {
             nettyRequest = new DefaultHttpRequest(HttpVersion.HTTP_1_0, m, AsyncHttpProviderUtils.getAuthority(uri));
         } else {
-            StringBuilder path = new StringBuilder(uri.getRawPath());
+            StringBuilder path = null;
+            if(isProxyServer(config, request))
+            	path = new StringBuilder(uri.toString());
+            else {
+            	path = new StringBuilder(uri.getRawPath());
             if (uri.getQuery() != null) {
                 path.append(""?"").append(uri.getRawQuery());
             }
+            }
             nettyRequest = new DefaultHttpRequest(HttpVersion.HTTP_1_1, m, path.toString());
         }
 
@@ -631,7 +640,7 @@
             }
 
             if (proxyServer.getPrincipal() != null) {
-                if (proxyServer.getNtlmDomain() != """") {
+                if (proxyServer.getNtlmDomain() != null && proxyServer.getNtlmDomain().length() > 0) {
 
                     List<String> auth = request.getHeaders().get(HttpHeaders.Names.PROXY_AUTHORIZATION);
                     if (!(auth != null && auth.size() > 0 && auth.get(0).startsWith(""NTLM""))) {",0
Ensure that dynamic forms in the admin respect field ordering in their field definitions,"         fieldMetadata.setVisibility(definition.getHiddenFlag()?VisibilityEnum.HIDDEN_ALL:VisibilityEnum.VISIBLE_ALL);
         fieldMetadata.setTab(""General"");
         fieldMetadata.setTabOrder(100);
+        fieldMetadata.setOrder(definition.getFieldOrder());
         fieldMetadata.setExplicitFieldType(SupportedFieldType.UNKNOWN);
         fieldMetadata.setLargeEntry(definition.getTextAreaFlag());
         fieldMetadata.setProminent(false);
@@ -119,21 +120,15 @@
      */
     public Property[] buildDynamicPropertyList(List<FieldGroup> fieldGroups, Class<?> inheritedType) {
         List<Property> propertiesList = new ArrayList<Property>();
-        int groupCount = 1;
-        int fieldCount = 0;
         for (FieldGroup group : fieldGroups) {
             List<FieldDefinition> definitions = group.getFieldDefinitions();
             for (FieldDefinition def : definitions) {
                 Property property = buildDynamicProperty(def, inheritedType);
                 BasicFieldMetadata fieldMetadata = (BasicFieldMetadata) property.getMetadata();
-                fieldMetadata.setOrder(fieldCount++);
                 fieldMetadata.setGroup(group.getName());
-                fieldMetadata.setGroupOrder(groupCount);
                 fieldMetadata.setGroupCollapsed(group.getInitCollapsedFlag());
                 propertiesList.add(property);
             }
-            groupCount++;
-            fieldCount = 0;
         }
         Property property = new Property();
         property.setName(""id"");",0
Fix path for newLabelTokenStore," 
     public LabelTokenStore newLabelTokenStore( File baseFile )
     {
-        return newLabelTokenStore( new File( baseFile.getParent() + NAMES_PART ), baseFile );
+        return newLabelTokenStore( new File( baseFile + NAMES_PART ), baseFile );
     }
 
     private LabelTokenStore newLabelTokenStore( File labelTokenNamesStore, File labelTokenStore )",0
Fix argument names in RoboSpiceDatabaseHelper.onUpdate,"     }
 
     @Override
-    public void onUpgrade(SQLiteDatabase arg0, ConnectionSource arg1, int arg2, int arg3) {
+    public void onUpgrade(SQLiteDatabase database, ConnectionSource connectionSource, int oldVersion, int newVersion) {
         // override if needed
     }
 ",0
"word2vec, fix MOJO writer - it needs to return a concrete implementation","   }
 
   @Override
-  public ModelMojoWriter getMojo() {
+  public Word2VecMojoWriter getMojo() {
     return new Word2VecMojoWriter(this);
   }
 ",0
Little fix to reduce crashes," import android.support.annotation.DrawableRes;
 import android.support.annotation.NonNull;
 import android.support.v4.content.ContextCompat;
+import android.support.v7.content.res.AppCompatResources;
 import android.view.View;
 
 /**
@@ -51,7 +52,7 @@
     }
 
     static Drawable getDrawable(@NonNull Context context, @DrawableRes int id) {
-        return ContextCompat.getDrawable(context, id);
+        return AppCompatResources.getDrawable(context, id);
     }
 
     static int getColor(@NonNull Context context, @ColorRes int color){",0
Update frame config when needed," 			return;
 		}
 
-		SwingUtilities.invokeLater(this::updateFrameConfig);
+		SwingUtilities.invokeLater(() -> updateFrameConfig(event.getKey().equals(""lockWindowSize"")));
 	}
 
 	@Subscribe
@@ -338,7 +338,7 @@
 			keyManager.registerKeyListener(uiKeyListener);
 
 			// Update config
-			updateFrameConfig();
+			updateFrameConfig(true);
 
 			// Decorate window with custom chrome and titlebar if needed
 			final boolean withTitleBar = config.enableCustomChrome();
@@ -692,7 +692,7 @@
 		}
 	}
 
-	private void updateFrameConfig()
+	private void updateFrameConfig(boolean updateResizable)
 	{
 		if (frame == null)
 		{
@@ -704,7 +704,11 @@
 			frame.setAlwaysOnTop(config.gameAlwaysOnTop());
 		}
 
+		if (updateResizable)
+		{
 		frame.setResizable(!config.lockWindowSize());
+		}
+
 		frame.setExpandResizeType(config.automaticResizeType());
 		frame.setContainedInScreen(config.containInScreen() && config.enableCustomChrome());
 ",0
Fix for #1851,"                 chunk.setBlock(pos, stone);
             } else if (density >= 0) {
                 int depth = TeraMath.floorToInt(surfaceFacet.get(pos2d)) - posY;
-                Block block = getSurfaceBlock(depth, posY, biome);
+                Block block = getSurfaceBlock(depth, posY, biome, seaLevel);
                 chunk.setBlock(pos, block);
             } else {
                 // fill up terrain up to sealevel height with water or ice
@@ -94,15 +94,15 @@
         }
     }
 
-    private Block getSurfaceBlock(int depth, int height, CoreBiome type) {
+    private Block getSurfaceBlock(int depth, int height, CoreBiome type, int seaLevel) {
         switch (type) {
             case FOREST:
             case PLAINS:
             case MOUNTAINS:
                 // Beach
-                if (depth == 0 && height > 32 && height < 128) {
+                if (depth == 0 && height > seaLevel && height < seaLevel + 96) {
                     return grass;
-                } else if (depth == 0 && height >= 128) {
+                } else if (depth == 0 && height >= seaLevel + 96) {
                     return snow;
                 } else if (depth > 32) {
                     return stone;
@@ -110,7 +110,7 @@
                     return dirt;
                 }
             case SNOW:
-                if (depth == 0 && height > 32) {
+                if (depth == 0 && height > seaLevel) {
                     // Snow on top
                     return snow;
                 } else if (depth > 32) {",0
0-length dimension fix," 
     @Override
     public Pair<DataBuffer, DataBuffer> getTADOnlyShapeInfo(INDArray array, int[] dimension) {
-        if (dimension == null || dimension[0] == Integer.MAX_VALUE) {
+        if (dimension == null || dimension.length == 0 || dimension[0] == Integer.MAX_VALUE) {
             return new Pair<DataBuffer, DataBuffer>(array.shapeInfoDataBuffer(), null);
         } else {
             Arrays.sort(dimension);",0
Fix tracking of time for splitSource.getNextBatch,"             throws InterruptedException
     {
         AtomicInteger nextTaskId = new AtomicInteger(0);
-        long getSplitStart = System.nanoTime();
 
         SplitSource splitSource = this.dataSource.get();
         while (!splitSource.isFinished()) {
-            getSplitDistribution.add(System.nanoTime() - getSplitStart);
 
             // if query has been canceled, exit cleanly; query will never run regardless
             if (getState().isDone()) {
                 break;
             }
 
+            long start = System.nanoTime();
             Set<Split> pendingSplits = ImmutableSet.copyOf(splitSource.getNextBatch(splitBatchSize));
+            getSplitDistribution.add(System.nanoTime() - start);
+
             while (!pendingSplits.isEmpty() && !getState().isDone()) {
                 Multimap<Node, Split> splitAssignment = nodeSelector.computeAssignments(pendingSplits);
                 pendingSplits = ImmutableSet.copyOf(Sets.difference(pendingSplits, ImmutableSet.copyOf(splitAssignment.values())));",0
fix a bug: add delta feature for some metrics in heartbeat's history part," 
 	private static final int MINUTE_ONE_DAY = 1440;
 
+	private Set<String> m_extensionMetrics = new HashSet<String>();
+
 	private void addMachineDataToMap(Map<String, double[]> datas, Machine machine) {
 		for (Period period : machine.getPeriods()) {
 			int minute = period.getMinute();
@@ -63,9 +65,11 @@
 			}
 			dealWithExtensions(datas, minute, period);
 		}
+		convertToDeltaArray(datas);
 	}
 
 	private Map<String, double[]> buildHeartbeatDatas(HeartbeatReport report, String ip) {
+		m_extensionMetrics = new HashSet<String>();
 		Map<String, double[]> datas = new HashMap<String, double[]>();
 		Machine machine = report.findMachine(ip);
 
@@ -75,11 +79,43 @@
 		return datas;
 	}
 
+	private void convertToDeltaArray(Map<String, double[]> datas) {
+		convertToDeltaArrayPerHour(datas, ""TotalStartedThread"");
+		convertToDeltaArrayPerHour(datas, ""StartedThread"");
+		convertToDeltaArrayPerHour(datas, ""NewGcCount"");
+		convertToDeltaArrayPerHour(datas, ""OldGcCount"");
+		convertToDeltaArrayPerHour(datas, ""CatMessageSize"");
+		convertToDeltaArrayPerHour(datas, ""CatMessageOverflow"");
+		for (String metric : m_extensionMetrics) {
+			convertToDeltaArrayPerHour(datas, metric);
+		}
+	}
+
+	private void convertToDeltaArrayPerHour(Map<String, double[]> datas, String metric) {
+		double[] values = datas.get(metric);
+
+		if (values != null) {
+			double[] targets = new double[MINUTE_ONE_DAY];
+
+			for (int i = 1; i < MINUTE_ONE_DAY; i++) {
+				if (values[i - 1] > 0) {
+					double delta = values[i] - values[i - 1];
+
+					if (delta >= 0) {
+						targets[i] = delta;
+					}
+				}
+			}
+			datas.put(metric, targets);
+		}
+	}
+
 	private void dealWithExtensions(Map<String, double[]> datas, int minute, Period period) {
 		for (String group : period.getExtensions().keySet()) {
 			Extension currentExtension = period.findExtension(group);
 
 			for (String metric : currentExtension.getDetails().keySet()) {
+				m_extensionMetrics.add(metric);
 				double value = currentExtension.findDetail(metric).getValue();
 				int unit = m_manager.queryUnit(metric);
 				double actualValue = value / unit;",0
ChromeDevToolsServer.java - update link to debugger protocol," import org.json.JSONObject;
 
 /**
- * Implements a limited version of the WebKit Inspector WebSocket protocol (using JSON-RPC 2.0).
- * The most up-to-date documentation can be found in the WebKit source code:
- * <a href=""https://github.com/WebKit/webkit/blob/master/Source/WebCore/inspector/protocol"">https://github.com/WebKit/webkit/blob/master/Source/WebCore/inspector/protocol</a>
+ * Implements a limited version of the Chrome Debugger WebSocket protocol (using JSON-RPC 2.0).
+ * The most up-to-date documentation can be found in the Blink source code:
+ * <a href=""https://code.google.com/p/chromium/codesearch#chromium/src/third_party/WebKit/Source/devtools/protocol.json&q=protocol.json&sq=package:chromium&type=cs"">protocol.json</a>
  */
 public class ChromeDevtoolsServer implements SimpleEndpoint {
   private static final String TAG = ""ChromeDevtoolsServer"";",0
fix tagview bug,"                         dip2px(getContext(), 5));
                 tagViewContainer.setLayoutParams(lp);
             }
+            tagView.setLayoutParams(new FrameLayout.LayoutParams(tagView.getLayoutParams().width,
+                    tagView.getLayoutParams().height));
             tagViewContainer.addView(tagView);
             addView(tagViewContainer);
 ",0
Fixed crash if list is empty," 		// It is not a mistake to call getFirstVisiblePosition() here.
 		// Most of the time getFixedFirstVisibleItem() should be called
 		// but that does not work great together with getChildAt()
-		final boolean isFirstViewBelowTop = mList.getFirstVisiblePosition() == 0
+		final boolean doesListHaveChildren = mList.getChildCount() != 0;
+		final boolean isFirstViewBelowTop = doesListHaveChildren && mList.getFirstVisiblePosition() == 0
 				&& mList.getChildAt(0).getTop() > 0;
 		final boolean isFirstVisibleItemOutsideAdapterRange = realFirstVisibleItem > adapterCount - 1
 				|| realFirstVisibleItem < 0;
-		final boolean doesListHaveChildren = mList.getChildCount() != 0;
 		if (!doesListHaveChildren || isFirstVisibleItemOutsideAdapterRange
 				|| isFirstViewBelowTop) {
 			clearHeader();",0
proper pw averaging fix,"         double score = 0.0;
 
         List<INDArray> params = new ArrayList<>();
-        for (int cnt = 1; cnt < workers && cnt < locker.get(); cnt++) {
+        for (int cnt = 0; cnt < workers && cnt < locker.get(); cnt++) {
             params.add(zoo[cnt].getModel().params());
             score += zoo[cnt].getModel().score();
         }
 
-        Nd4j.averageAndPropagate(model.params(), params);
+        Nd4j.averageAndPropagate(null, params);
 
 
         score /= Math.min(workers, locker.get());
@@ -344,7 +344,7 @@
                         batchSize += workerModel.batchSize();
                     }
 
-                    Nd4j.averageAndPropagate(updater.getStateViewArray(), updaters);
+                    Nd4j.averageAndPropagate(null, updaters);
                 }
             }
 
@@ -361,7 +361,7 @@
                         updaters.add(workerModel.getUpdater().getStateViewArray());
                         batchSize += workerModel.batchSize();
                     }
-                    Nd4j.averageAndPropagate(updater.getStateViewArray(), updaters);
+                    Nd4j.averageAndPropagate(null, updaters);
                 }
             }
 ",0
Fix spelling in OAuthException message.,"     }
     else
     {
-      throw new OAuthException(""Cannot extract an acces token. Response was: "" + response);
+      throw new OAuthException(""Cannot extract an access token. Response was: "" + response);
     }
   }
 ",0
Fix another draw method.," 		if (!adjustNeeded) {
 			super.draw(texture, x, y, srcX, srcY, srcWidth, srcHeight);
 		} else {
-			drawAdjusted(texture, x, y, 0, 0, texture.getWidth(), texture.getHeight(), 1, 1, 0, srcX, srcY, srcWidth, srcHeight,
+			drawAdjusted(texture, x, y, 0, 0, srcWidth, srcHeight, 1, 1, 0, srcX, srcY, srcWidth, srcHeight,
 				false, false);
 		}
 	}",0
Fix BlockStmt.getNodeLists," import com.github.javaparser.ast.visitor.GenericVisitor;
 import com.github.javaparser.ast.visitor.VoidVisitor;
 
+import java.util.Arrays;
+import java.util.List;
+
 import static com.github.javaparser.utils.Utils.assertNotNull;
 
 /**
@@ -72,5 +75,9 @@
         return this;
     }
 
+    @Override
+    public List<NodeList<?>> getNodeLists() {
+        return Arrays.asList(statements);
+    }
 
 }",0
Fixes the contacts 'message button' disappearing on offline contacts,"             if(JabberActivator.getConfigurationService()
                 .getBoolean(
                     PROP_XMPP_USE_ALL_RESOURCES_FOR_CAPABILITIES,
-                    USE_ALL_RESOURCES_FOR_CAPABILITIES_DEFAULT))
+                    USE_ALL_RESOURCES_FOR_CAPABILITIES_DEFAULT)
+                && !fullJids.isEmpty())
             {
                 String bareJid = StringUtils.parseBareAddress(user);
                 Contact contact = opsetPresence.findContactByID(bareJid);",0
Fix error message regarding missing error View,"     if (errorView == null) {
       throw new NullPointerException(
           ""Error view is null! Have you specified a content view in your layout xml file?""
-              + "" You have to give your error View the id R.id.contentView"");
+              + "" You have to give your error View the id R.id.errorView"");
     }
 
     errorView.setOnClickListener(new View.OnClickListener() {",0
[HOTFIX] Fixed executing java commands.,"               j.outputObject.finished(pname+"".""+cname);
             } catch (CompilationException e) {
               j.outputObject.error(buildErrorMessage(e, lineNumbersMapping));
-            } catch(Exception e) { j.outputObject.error(""ERROR: ""+e.toString()); }
+            } catch(Exception e) { j.outputObject.error(""ERROR: ""+e.toString()); } finally {
+              if (j.outputObject != null) {
+                j.outputObject.executeCodeCallback();
+              }
+            }
           } else {
             String ret = ""void"";
             if (codev[codev.length-1].matches(""(^|.*\\s+)return\\s+.*""))",0
"Fix NPE in CalendarDatePickerDialog when dialog is not created, as in #57","     public View onCreateView(LayoutInflater inflater, ViewGroup container,
             Bundle savedInstanceState) {
         Log.d(TAG, ""onCreateView: "");
+        if (getShowsDialog()) {
         getDialog().getWindow().requestFeature(Window.FEATURE_NO_TITLE);
+        }
 
         View view = inflater.inflate(R.layout.calendar_date_picker_dialog, null);
 ",0
Fix transpose import,"     @Override
     public void initFromTensorFlow(NodeDef nodeDef, SameDiff initWith, Map<String, AttrValue> attributesForNode, GraphDef graph) {
         super.initFromTensorFlow(nodeDef, initWith, attributesForNode, graph);
-        //permute dimensions re not specified as second input
+        //permute dimensions are not specified as second input
         if (nodeDef.getInputCount() < 2)
             return;
         NodeDef permuteDimsNode = null;
@@ -126,7 +126,6 @@
             return;
         }
 
-
         INDArray arr = sameDiff.getArrForVarName(arg().getVarName());
         if (arr == null) {
             val arrVar = sameDiff.getVariable(arg().getVarName());
@@ -156,6 +155,9 @@
 
     @Override
     public List<long[]> calculateOutputShape() {
+        if (args().length > 1){
+            return super.calculateOutputShape();
+        }
         if (permuteDims == null && arg() != null && arg().getShape() != null) {
             this.permuteDims = ArrayUtil.reverseCopy(ArrayUtil.range(0, arg().getShape().length));
             val permutedShape = ArrayUtil.permute(arg().getShape(), permuteDims);",0
Bugfix: Exception from JDBC was not propagated as cause in the EventStoreException,"                 () -> executeQuery(getConnection(),
                                    connection -> connection.prepareStatement(sql),
                                    resultSet -> nextAndExtract(resultSet, 1, Long.class),
-                                   e -> new EventStoreException(""Failed to get tail token"")));
+                                   e -> new EventStoreException(""Failed to get tail token"", e)));
         return Optional.ofNullable(index)
                        .map(seq -> GapAwareTrackingToken.newInstance(seq, Collections.emptySet()))
                        .orElse(null);
@@ -323,7 +323,7 @@
                 () -> executeQuery(getConnection(),
                                    connection -> connection.prepareStatement(sql),
                                    resultSet -> nextAndExtract(resultSet, 1, Long.class),
-                                   e -> new EventStoreException(""Failed to get head token"")));
+                                   e -> new EventStoreException(""Failed to get head token"", e)));
         return Optional.ofNullable(index)
                        .map(seq -> GapAwareTrackingToken.newInstance(seq, Collections.emptySet()))
                        .orElse(null);
@@ -341,7 +341,7 @@
                                        return stmt;
                                    },
                                    resultSet -> nextAndExtract(resultSet, 1, Long.class),
-                                   e -> new EventStoreException(format(""Failed to get token at [%s]"", dateTime))));
+                                   e -> new EventStoreException(format(""Failed to get token at [%s]"", dateTime), e)));
         if (index == null) {
             return null;
         }",0
Fix Net library buffer sizes,"  */
 public class Client implements Runnable {
 
-  protected static final int MAX_BUFFER_SIZE = 2 << 27; // 128 MB
+  protected static final int MAX_BUFFER_SIZE = 1 << 27; // 128 MB
 
   PApplet parent;
   Method clientEventMethod;
@@ -222,7 +222,7 @@
     byte[] readBuffer;
     { // make the read buffer same size as socket receive buffer so that
       // we don't waste cycles calling listeners when there is more data waiting
-      int readBufferSize = 2 << 16; // 64 KB (default socket receive buffer size)
+      int readBufferSize = 1 << 16; // 64 KB (default socket receive buffer size)
       try {
         readBufferSize = socket.getReceiveBufferSize();
       } catch (SocketException ignore) { }",0
Fix JavaDoc reference in HttpSender,"      *
      * @param statusCode the status code that will be checked
      * @return {@code true} if a redirection is needed, {@code false} otherwise
-     * @see #isRequestRewriteNeeded(int)
+     * @see #isRequestRewriteNeeded(HttpMessage)
      */
     private static boolean isRedirectionNeeded(int statusCode) {
         switch (statusCode) {",0
Fix demo to prevent memory leak on device orientation change,"     }
 
     @Override
+    protected void onStop() {
+        // To prevent a memory leak on rotation, make sure to call stopAutoCycle() on the slider before activity or fragment is destroyed
+        mDemoSlider.stopAutoCycle();
+        super.onStop();
+    }
+
+    @Override
     public void onSliderClick(BaseSliderView slider) {
         Toast.makeText(this,slider.getBundle().get(""extra"") + """",Toast.LENGTH_SHORT).show();
     }",0
Fix missing guice bindings for MessageOutput.Factory2,"         install(new GrokModule());
         install(new LookupModule());
         install(new FieldTypesModule());
+
+        // Just to create the binders so they are present in the injector. Prevents a server startup error when no
+        // outputs are bound that implement MessageOutput.Factory2.
+        outputsMapBinder2();
     }
 
     private void bindProviders() {",0
Do not track 'fileWatcherIgnore' file by File Watcher," import static java.nio.charset.StandardCharsets.UTF_8;
 import static java.nio.file.Files.createDirectories;
 import static java.nio.file.Files.exists;
-import static java.nio.file.Files.isDirectory;
 import static java.nio.file.Files.lines;
 import static java.nio.file.Files.write;
 import static java.nio.file.StandardOpenOption.APPEND;
@@ -30,7 +29,6 @@
 import java.io.File;
 import java.io.IOException;
 import java.nio.file.Path;
-import java.nio.file.PathMatcher;
 import java.util.Collection;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -38,10 +36,8 @@
 import java.util.Map;
 import java.util.Set;
 import java.util.concurrent.ConcurrentHashMap;
-import java.util.function.Consumer;
 import java.util.stream.Stream;
 import javax.annotation.PostConstruct;
-import javax.annotation.PreDestroy;
 import javax.inject.Inject;
 import javax.inject.Named;
 import javax.inject.Provider;
@@ -53,7 +49,6 @@
 import org.eclipse.che.api.core.jsonrpc.commons.RequestTransmitter;
 import org.eclipse.che.api.project.server.FolderEntry;
 import org.eclipse.che.api.project.server.ProjectManager;
-import org.eclipse.che.api.project.server.RegisteredProject;
 import org.eclipse.che.api.project.server.VirtualFileEntry;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -84,7 +79,6 @@
   private final Provider<ProjectManager> projectManagerProvider;
   private final RequestHandlerConfigurator configurator;
   private final Path root;
-  private int fileWatchingOperationID;
 
   @Inject
   public FileWatcherIgnoreFileTracker(
@@ -103,16 +97,10 @@
   @PostConstruct
   public void initialize() {
     configureHandlers();
-    startTrackingIgnoreFile();
     readExcludesFromIgnoreFiles();
     addFileWatcherExcludesMatcher();
   }
 
-  @PreDestroy
-  public void stopWatching() {
-    fileWatcherManager.unRegisterByMatcher(fileWatchingOperationID);
-  }
-
   private void configureHandlers() {
     configurator
         .newConfiguration()
@@ -137,15 +125,14 @@
         .methodName(ADD_TO_EXCLUDES)
         .paramsAsListOfString()
         .resultAsBoolean()
-        .withFunction((endpointId, pathsToExclude) -> addExcludesToIgnoreFile(pathsToExclude));
+        .withFunction((endpointId, pathsToExclude) -> addExcludes(pathsToExclude));
 
     configurator
         .newConfiguration()
         .methodName(REMOVE_FROM_EXCLUDES)
         .paramsAsListOfString()
         .resultAsBoolean()
-        .withFunction(
-            (endpointId, excludesToRemove) -> removeExcludesFromIgnoreFile(excludesToRemove));
+        .withFunction((endpointId, excludesToRemove) -> removeExcludes(excludesToRemove));
   }
 
   private void readExcludesFromIgnoreFiles() {
@@ -153,60 +140,20 @@
       projectManagerProvider
           .get()
           .getProjects()
-          .stream()
-          .map(this::getFileWatcherIgnoreFileLocation)
-          .forEach(this::fillUpExcludesFromIgnoreFile);
+          .forEach(
+              project -> {
+                FolderEntry baseFolder = project.getBaseFolder();
+                if (baseFolder != null) {
+                  String ignoreFileLocation =
+                      baseFolder.getPath().toString() + FILE_WATCHER_IGNORE_FILE_PATH;
+                  fillUpExcludesFromIgnoreFile(ignoreFileLocation);
+                }
+              });
     } catch (ServerException e) {
       LOG.debug(""Can not fill up file watcher excludes: "" + e.getLocalizedMessage());
     }
   }
 
-  private String getFileWatcherIgnoreFileLocation(RegisteredProject project) {
-    FolderEntry baseFolder = project.getBaseFolder();
-    return baseFolder == null
-        ? """"
-        : baseFolder.getPath().toString() + FILE_WATCHER_IGNORE_FILE_PATH;
-  }
-
-  private void startTrackingIgnoreFile() {
-    fileWatcherManager.addIncludeMatcher(getIgnoreFileMatcher());
-    fileWatchingOperationID =
-        fileWatcherManager.registerByMatcher(
-            getIgnoreFileMatcher(), getCreateConsumer(), getModifyConsumer(), getDeleteConsumer());
-  }
-
-  private PathMatcher getIgnoreFileMatcher() {
-    return path ->
-        !isDirectory(path)
-            && FILE_WATCHER_IGNORE_FILE_NAME.equals(path.getFileName().toString())
-            && CHE_DIR.equals(path.getParent().getFileName().toString());
-  }
-
-  private Consumer<String> getCreateConsumer() {
-    return getModifyConsumer();
-  }
-
-  private Consumer<String> getModifyConsumer() {
-    return location -> {
-      Path path = toNormalPath(root, location);
-      if (getIgnoreFileMatcher().matches(path)) {
-        fillUpExcludesFromIgnoreFile(location);
-        notifyAboutIgnoreFileChanges();
-      }
-    };
-  }
-
-  private Consumer<String> getDeleteConsumer() {
-    return location -> {
-      Path path = toNormalPath(root, location);
-      if (getIgnoreFileMatcher().matches(path)) {
-        Path projectPath = path.getParent().getParent();
-        excludes.remove(projectPath);
-        notifyAboutIgnoreFileChanges();
-      }
-    };
-  }
-
   private void addFileWatcherExcludesMatcher() {
     fileWatcherManager.addExcludeMatcher(
         path -> excludes.values().stream().flatMap(Collection::stream).anyMatch(path::startsWith));
@@ -248,39 +195,76 @@
     }
   }
 
-  private boolean addExcludesToIgnoreFile(List<String> pathsToExclude) {
-    boolean isRemoved =
-        pathsToExclude.removeIf(
-            location -> {
-              Path pathToExclude = toNormalPath(root, location);
-              return excludes
-                  .values()
-                  .stream()
-                  .flatMap(Collection::stream)
-                  .anyMatch(path -> path.equals(pathToExclude));
-            });
-
+  private boolean addExcludes(List<String> pathsToExclude) {
+    Map<Path, Set<Path>> groupedExcludes = groupExcludes(pathsToExclude);
     if (pathsToExclude.isEmpty()) {
       return false;
     }
 
-    Map<Path, Set<String>> excludesToWrite = groupExcludes(pathsToExclude);
-    excludesToWrite
+    groupedExcludes
         .keySet()
         .forEach(
-            ignoreFilePath ->
-                writeExcludesToIgnoreFile(ignoreFilePath, excludesToWrite.get(ignoreFilePath)));
-    return !isRemoved;
+            projectPath -> {
+              excludes.putIfAbsent(projectPath, new HashSet<>());
+
+              Set<Path> projectExcludes = excludes.get(projectPath);
+              Set<Path> excludesForAdding = groupedExcludes.get(projectPath);
+
+              excludesForAdding.removeIf(projectExcludes::contains);
+              projectExcludes.addAll(excludesForAdding);
+
+              writeExcludesToIgnoreFile(projectPath, excludesForAdding);
+            });
+
+    notifyAboutIgnoreFileChanges();
+    return true;
   }
 
-  private void writeExcludesToIgnoreFile(Path ignoreFilePath, Set<String> locationsToExclude) {
+  private boolean removeExcludes(List<String> pathsToRemove) {
+    Map<Path, Set<Path>> groupedExcludes = groupExcludes(pathsToRemove);
+    if (groupedExcludes.isEmpty()) {
+      return false;
+    }
+
+    groupedExcludes
+        .keySet()
+        .forEach(
+            projectPath -> {
+              excludes.putIfAbsent(projectPath, new HashSet<>());
+
+              Set<Path> excludesToRemove = groupedExcludes.get(projectPath);
+              Set<Path> projectExcludes = excludes.get(projectPath);
+
+              projectExcludes.removeIf(excludesToRemove::contains);
+
+              removeExcludes(projectPath, excludesToRemove);
+            });
+
+    notifyAboutIgnoreFileChanges();
+    return true;
+  }
+
+  private Set<String> prepareToWrite(Path projectPath, Set<Path> pathsToExclude) {
+    return pathsToExclude
+        .stream()
+        .map(
+            pathToExclude ->
+                pathToExclude.equals(projectPath)
+                    ? ""/""
+                    : projectPath.relativize(pathToExclude).toString())
+        .collect(toSet());
+  }
+
+  private void writeExcludesToIgnoreFile(Path projectPath, Set<Path> pathsToExclude) {
+    Path ignoreFilePath = toNormalPath(projectPath, FILE_WATCHER_IGNORE_FILE_PATH);
     try {
       Path cheDir = ignoreFilePath.getParent();
       if (!exists(cheDir)) {
         createDirectories(cheDir);
       }
 
-      write(ignoreFilePath, locationsToExclude, UTF_8, CREATE, APPEND);
+      Set<String> excludesToWrite = prepareToWrite(projectPath, pathsToExclude);
+      write(ignoreFilePath, excludesToWrite, UTF_8, CREATE, APPEND);
     } catch (IOException e) {
       String errorMessage = ""Can not add paths to File Watcher excludes "";
 
@@ -290,39 +274,24 @@
     }
   }
 
-  private boolean removeExcludesFromIgnoreFile(List<String> pathsToRemove) {
-    Map<Path, Set<String>> excludesToRemove = groupExcludes(pathsToRemove);
-    if (excludesToRemove.isEmpty()) {
-      return false;
-    }
-
-    excludesToRemove
-        .keySet()
-        .forEach(
-            ignoreFilePath ->
-                removeExcludesFromIgnoreFile(ignoreFilePath, excludesToRemove.get(ignoreFilePath)));
-    return true;
-  }
-
-  private void removeExcludesFromIgnoreFile(Path ignoreFilePath, Set<String> pathsToExclude) {
+  private void removeExcludes(Path projectPath, Set<Path> pathsToExclude) {
+    Path ignoreFilePath = toNormalPath(projectPath, FILE_WATCHER_IGNORE_FILE_PATH);
     if (!exists(ignoreFilePath)) {
-      throw new JsonRpcException(
-          400,
-          ""Can not remove paths from File Watcher excludes: ignore file is not found by path ""
-              + ignoreFilePath);
+      return;
     }
 
+    Set<String> excludesToRemove = prepareToWrite(projectPath, pathsToExclude);
     try (Stream<String> lines = lines(ignoreFilePath)) {
-      Set<String> projectExcludes =
+      Set<String> excludesToWrite =
           lines
               .filter(
                   line -> {
                     String location = line.trim();
-                    return !location.isEmpty() && !pathsToExclude.contains(location);
+                    return !location.isEmpty() && !excludesToRemove.contains(location);
                   })
               .collect(toSet());
 
-      write(ignoreFilePath, projectExcludes, UTF_8);
+      write(ignoreFilePath, excludesToWrite, UTF_8);
     } catch (IOException e) {
       String errorMessage = ""Can not remove paths from File Watcher excludes "";
 
@@ -332,8 +301,8 @@
     }
   }
 
-  private Map<Path, Set<String>> groupExcludes(List<String> locationsToExclude) {
-    Map<Path, Set<String>> groupedExcludes = new HashMap<>();
+  private Map<Path, Set<Path>> groupExcludes(List<String> locationsToExclude) {
+    Map<Path, Set<Path>> groupedExcludes = new HashMap<>();
     try {
       for (String location : locationsToExclude) {
         if (isNullOrEmpty(location)) {
@@ -353,15 +322,9 @@
 
         Path pathToExclude = toNormalPath(root, location);
         Path projectPath = toNormalPath(root, projectLocation);
-        Path ignoreFilePath = toNormalPath(root, projectLocation + FILE_WATCHER_IGNORE_FILE_PATH);
 
-        Set<String> excludesToWrite =
-            groupedExcludes.computeIfAbsent(ignoreFilePath, k -> new HashSet<>());
-        String excludeToWrite =
-            pathToExclude.equals(projectPath)
-                ? ""/""
-                : projectPath.relativize(pathToExclude).toString();
-        excludesToWrite.add(excludeToWrite);
+        groupedExcludes.putIfAbsent(projectPath, new HashSet<>());
+        groupedExcludes.get(projectPath).add(pathToExclude);
       }
     } catch (NotFoundException e) {
       String errorMessage = ""Can not add path to File Watcher excludes: "" + e.getLocalizedMessage();",0
fix for zip empty dir,"             return;
         }
         if (fileToZip.isDirectory()) {
+            if (fileName.endsWith(""/"")) {
+                zipOut.putNextEntry(new ZipEntry(fileName));
+                zipOut.closeEntry();
+            } else {
+                zipOut.putNextEntry(new ZipEntry(fileName + ""/""));
+                zipOut.closeEntry();
+            }
             final File[] children = fileToZip.listFiles();
             for (final File childFile : children) {
                 zipFile(childFile, fileName + ""/"" + childFile.getName(), zipOut);",0
Fix for loading classes in ReflectionUtils when using RetroLambda,"             while (urls.hasMoreElements()) {
                 List<String> fileNames = new ArrayList<String>();
                 String classDirectoryName = urls.nextElement().getFile();
-                if (classDirectoryName.contains(""bin"") || classDirectoryName.contains(""classes"")) {
+                if (classDirectoryName.contains(""bin"") || classDirectoryName.contains(""classes"")
+                        || classDirectoryName.contains(""retrolambda"")) {
                     File classDirectory = new File(classDirectoryName);
                     for (File filePath : classDirectory.listFiles()) {
                         populateFiles(filePath, fileNames, """");",0
Try to fix #2160 by adding a delayed retry.," 
 import java.io.IOException;
 import java.nio.file.AtomicMoveNotSupportedException;
+import java.nio.file.DirectoryNotEmptyException;
 import java.nio.file.FileVisitResult;
 import java.nio.file.Files;
 import java.nio.file.Path;
@@ -100,7 +101,23 @@
 
             @Override
             public FileVisitResult postVisitDirectory(Path dir, IOException exc) throws IOException {
+                try {
                 Files.delete(dir);
+                }catch (DirectoryNotEmptyException e) {
+                    /**
+                     * Happens rarely for some players on windows (See issue #2160). Exact reason for this behavior is
+                     * unknown. Maybe they have some kind of background task that processes that creates a temporary
+                     * files in new directories to store some intermediate scan result.
+                     */
+                    logger.warn(""The save job could not cleanup a temporarly created directory, it will retry once in one second"");
+                    try {
+                        Thread.sleep(1000L);
+                    } catch (InterruptedException e1) {
+                        // Reset flag and ignore it
+                        Thread.currentThread().interrupt();
+                    }
+                    Files.delete(dir);
+                }
                 return FileVisitResult.CONTINUE;
             }
         });",0
Fix JavaDocs typo in expand function documentation," 	 *  A
 	 *  B
 	 *  AA
-	 *  AB
+	 *  BB
 	 *  aa1
 	 *  bb1
 	 * </pre>
@@ -4012,7 +4012,7 @@
 	 *  A
 	 *  B
 	 *  AA
-	 *  AB
+	 *  BB
 	 *  aa1
 	 *  bb1
 	 * </pre>",0
Fix: Add messages to Notifications for Android Auto on Android M and older," import android.text.style.StyleSpan;
 import android.util.DisplayMetrics;
 import android.util.Log;
+import android.util.Pair;
 
 import java.io.FileNotFoundException;
 import java.util.ArrayList;
@@ -433,8 +434,6 @@
 			for (Message message : messages) {
 				String sender = message.getStatus() == Message.STATUS_RECEIVED ? UIHelper.getMessageDisplayName(message) : null;
 				messagingStyle.addMessage(UIHelper.getMessagePreview(mXmppConnectionService,message).first, message.getTimeSent(), sender);
-				uBuilder.addMessage(UIHelper.getMessagePreview(mXmppConnectionService,message).first);
-				uBuilder.setLatestTimestamp(message.getTimeSent());
 			}
 			builder.setStyle(messagingStyle);
 		} else {
@@ -462,6 +461,15 @@
 				}
 			}
 		}
+		/** message preview for Android Auto **/
+		for (Message message : messages) {
+			Pair<String,Boolean> preview = UIHelper.getMessagePreview(mXmppConnectionService, message);
+			// only show user written text
+			if (preview.second == false) {
+				uBuilder.addMessage(preview.first);
+				uBuilder.setLatestTimestamp(message.getTimeSent());
+			}
+		}
 	}
 
 	private Message getImage(final Iterable<Message> messages) {",0
Fix wrong javadoc comments,"     <T> T decode(Argument<T> type, InputStream inputStream) throws CodecException;
 
     /**
-     * Encode the given type from the given {@link InputStream}.
+     * Encode the given type to the given {@link OutputStream}.
      *
      * @param object       The object to encode
-     * @param outputStream The input stream
+     * @param outputStream The output stream
      * @param <T>          The generic type
-     * @throws CodecException When the result cannot be decoded
+     * @throws CodecException When the result cannot be encoded
      */
     <T> void encode(T object, OutputStream outputStream) throws CodecException;
 
@@ -66,7 +66,7 @@
      * @param object The object to encode
      * @param <T>    The generic type
      * @return The decoded result
-     * @throws CodecException When the result cannot be decoded
+     * @throws CodecException When the result cannot be encoded
      */
     <T> byte[] encode(T object) throws CodecException;
 
@@ -77,7 +77,7 @@
      * @param allocator The allocator
      * @param <T>       The generic type
      * @return The decoded result
-     * @throws CodecException When the result cannot be decoded
+     * @throws CodecException When the result cannot be encoded
      */
     <T> ByteBuffer encode(T object, ByteBufferFactory allocator) throws CodecException;
 ",0
Ensure that the max image upload check is case insensitive when checking the file extension,"     }
 
     protected long getMaxUploadSizeForFile(String fileName) {
-        String extension = getFileExtension(fileName);
-        if (getAdminImageFileExtensions().contains(extension)) {
+        if (isImageFile(fileName)) {
             return getMaxUploadableImageSize();
         }
+
         return getMaxUploadableFileSize();
     }
 
+    protected boolean isImageFile(String fileName) {
+        String extension = getFileExtension(fileName);
+
+        for (String imageFileExtension : getAdminImageFileExtensions()) {
+            if (imageFileExtension.equalsIgnoreCase(extension)) {
+                return true;
+            }
+        }
+
+        return false;
+    }
+
     protected String getFileExtension(String assetPath) {
         int extensionStartIndex = assetPath.lastIndexOf(""."") + 1;
         return assetPath.substring(extensionStartIndex);",0
Debug log for handshake reject," 	@Override
 	public HandshakeState acceptHandshakeAsServer( ClientHandshake handshakedata ) throws InvalidHandshakeException {
 		int v = readVersion( handshakedata );
-		if( v != 13 )
+		if( v != 13 ) {
+			logDebug(""acceptHandshakeAsServer - Wrong websocket version."");
 			return HandshakeState.NOT_MATCHED;
+		}
 		HandshakeState extensionState= HandshakeState.NOT_MATCHED;
 		String requestedExtension = handshakedata.getFieldValue( ""Sec-WebSocket-Extensions"" );
 		for( IExtension knownExtension : knownExtensions ) {
 			if( knownExtension.acceptProvidedExtensionAsServer( requestedExtension ) ) {
 				extension = knownExtension;
 				extensionState = HandshakeState.MATCHED;
+				logDebug(""acceptHandshakeAsServer - Matching extension found: "" + extension.toString());
 				break;
 			}
 		}
@@ -166,29 +169,36 @@
 			if( knownProtocol.acceptProvidedProtocol( requestedProtocol ) ) {
 				protocol = knownProtocol;
 				protocolState = HandshakeState.MATCHED;
+				logDebug(""acceptHandshakeAsServer - Matching protocol found: "" + protocol.toString());
 				break;
 			}
 		}
 		if (protocolState == HandshakeState.MATCHED && extensionState == HandshakeState.MATCHED) {
 			return HandshakeState.MATCHED;
 		}
+		logDebug(""acceptHandshakeAsServer - No matching extension or protocol found."");
 		return HandshakeState.NOT_MATCHED;
 	}
 
 	@Override
 	public HandshakeState acceptHandshakeAsClient( ClientHandshake request, ServerHandshake response ) throws InvalidHandshakeException {
 		if (! basicAccept( response )) {
+			logDebug(""acceptHandshakeAsClient - Missing/wrong upgrade or connection in handshake."");
 			return HandshakeState.NOT_MATCHED;
 		}
-		if( !request.hasFieldValue( ""Sec-WebSocket-Key"" ) || !response.hasFieldValue( ""Sec-WebSocket-Accept"" ) )
+		if( !request.hasFieldValue( ""Sec-WebSocket-Key"" ) || !response.hasFieldValue( ""Sec-WebSocket-Accept"" ) ) {
+			logDebug(""acceptHandshakeAsClient - Missing Sec-WebSocket-Key or Sec-WebSocket-Accept"");
 			return HandshakeState.NOT_MATCHED;
+		}
 
 		String seckey_answere = response.getFieldValue( ""Sec-WebSocket-Accept"" );
 		String seckey_challenge = request.getFieldValue( ""Sec-WebSocket-Key"" );
 		seckey_challenge = generateFinalKey( seckey_challenge );
 
-		if( !seckey_challenge.equals( seckey_answere ) )
+		if( !seckey_challenge.equals( seckey_answere ) ) {
+			logDebug(""acceptHandshakeAsClient - Wrong key for Sec-WebSocket-Key."");
 			return HandshakeState.NOT_MATCHED;
+		}
 
 		HandshakeState extensionState= HandshakeState.NOT_MATCHED;
 		String requestedExtension = response.getFieldValue( ""Sec-WebSocket-Extensions"" );
@@ -196,6 +206,7 @@
 			if( knownExtension.acceptProvidedExtensionAsClient( requestedExtension ) ) {
 				extension = knownExtension;
 				extensionState = HandshakeState.MATCHED;
+				logDebug(""acceptHandshakeAsClient - Matching extension found: "" + extension.toString());
 				break;
 			}
 		}
@@ -205,12 +216,14 @@
 			if( knownProtocol.acceptProvidedProtocol( requestedProtocol ) ) {
 				protocol = knownProtocol;
 				protocolState = HandshakeState.MATCHED;
+				logDebug(""acceptHandshakeAsClient - Matching protocol found: "" + protocol.toString());
 				break;
 			}
 		}
 		if (protocolState == HandshakeState.MATCHED && extensionState == HandshakeState.MATCHED) {
 			return HandshakeState.MATCHED;
 		}
+		logDebug(""acceptHandshakeAsClient - No matching extension or protocol found."");
 		return HandshakeState.NOT_MATCHED;
 	}
 
@@ -761,4 +774,10 @@
 		resultingByteBuffer.flip();
 		return resultingByteBuffer;
 	}
+
+	private static void logDebug(Object object) {
+		if (WebSocketImpl.DEBUG) {
+			System.out.println(object);
+		}
+	}
 }",0
Fixed NPE in some rare combinations of JSON files,"     }
 
     ContributedPlatform obj1 = (ContributedPlatform) obj;
-    return getParentPackage().getName().equals(obj1.getParentPackage().getName()) && getArchitecture().equals(obj1.getArchitecture()) && getVersion().equals(obj1.getVersion()) && getName().equals(obj1.getName());
+
+    ContributedPackage parentPackage = getParentPackage();
+    ContributedPackage parentPackage1 = obj1.getParentPackage();
+    if (parentPackage == null) {
+      if (parentPackage1 != null)
+        return false;
+    } else {
+      if (parentPackage1 == null)
+        return false;
+      if (!parentPackage.getName().equals(parentPackage1.getName()))
+        return false;
+    }
+    if (!getArchitecture().equals(obj1.getArchitecture())) {
+      return false;
+    }
+    if (!getVersion().equals(obj1.getVersion())) {
+      return false;
+    }
+    return getName().equals(obj1.getName());
   }
 }",0
Fix playlist re-order crash (fixes #46),"         if (canEdit()) {
             itemTouchHelper = new ItemTouchHelper(new ItemTouchHelperCallback(
                     (from, to) ->
-                            adapter.moveItem(from, to),
+                    {
+                        long songViewCount = Stream.of(adapter.items)
+                                .filter(adaptableItem -> adaptableItem instanceof SongView).count();
+                        int offset = (int) (adapter.getItemCount() - songViewCount);
+                        if(to >= offset) {
+                            adapter.moveItem(from, to);
+                        }
+                    },
                     (from, to) ->
                     {
                         // The 'offset' here is the number of items in the list which are not
@@ -268,8 +275,8 @@
                         long songViewCount = Stream.of(adapter.items)
                                 .filter(adaptableItem -> adaptableItem instanceof SongView).count();
                         int offset = (int) (adapter.getItemCount() - songViewCount);
-                        from = from - offset;
-                        to = to - offset;
+                        from -= offset;
+                        to -= offset;
 
                         try {
                             MediaStore.Audio.Playlists.Members.moveItem(getActivity().getContentResolver(), playlist.id, from, to);",0
Fix for StrictMode," import java.net.InetAddress;
 import java.net.ServerSocket;
 import java.net.Socket;
-import java.util.ArrayList;
 import java.util.HashMap;
+import java.util.List;
 import java.util.Map.Entry;
+import java.util.concurrent.CopyOnWriteArrayList;
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Executors;
 import java.util.concurrent.locks.ReentrantReadWriteLock;
@@ -63,17 +64,17 @@
  *     public void onCreate(Bundle savedInstanceState) {
  *         super.onCreate(savedInstanceState);
  *         // Set content view, etc.
- *         ViewServer.get().addWindow(this);
+ *         ViewServer.get(this).addWindow(this);
  *     }
  *       
  *     public void onDestroy() {
  *         super.onDestroy();
- *         ViewServer.get().removeWindow(this);
+ *         ViewServer.get(this).removeWindow(this);
  *     }
  *   
  *     public void onResume() {
  *         super.onResume();
- *         ViewServer.get().setFocusedWindow(this);
+ *         ViewServer.get(this).setFocusedWindow(this);
  *     }
  * }
  * </pre>
@@ -110,8 +111,8 @@
     private Thread mThread;
     private ExecutorService mThreadPool;
     
-    private final ArrayList<WindowListener> mListeners =
-        new ArrayList<ViewServer.WindowListener>();
+    private final List<WindowListener> mListeners =
+        new CopyOnWriteArrayList<ViewServer.WindowListener>();
 
     private final HashMap<View, String> mWindows = new HashMap<View, String>();
     private final ReentrantReadWriteLock mWindowsLock = new ReentrantReadWriteLock();
@@ -187,7 +188,6 @@
             return false;
         }
 
-        mServer = new ServerSocket(mPort, VIEW_SERVER_MAX_CONNECTIONS, InetAddress.getLocalHost());
         mThread = new Thread(this, ""Local View Server [port="" + mPort + ""]"");
         mThreadPool = Executors.newFixedThreadPool(VIEW_SERVER_MAX_CONNECTIONS);
         mThread.start();
@@ -354,6 +354,12 @@
      * Main server loop.
      */
     public void run() {
+    	try {
+			mServer = new ServerSocket(mPort, VIEW_SERVER_MAX_CONNECTIONS, InetAddress.getLocalHost());
+		} catch (Exception e) {
+			Log.w(LOG_TAG, ""Starting ServerSocket error: "", e);
+		}
+		
         while (Thread.currentThread() == mThread) {
             // Any uncaught exception will crash the system process
             try {
@@ -809,3 +815,4 @@
         }
     }
 }
+",0
KEYCLOAK-648 Fix removing role from composite role,"     @Override
     public boolean equals(Object o) {
         if (this == o) return true;
-        if (o == null || getClass() != o.getClass()) return false;
+        if (!(o instanceof RoleEntity)) return false;
 
         RoleEntity that = (RoleEntity) o;
 
-        if (!id.equals(that.id)) return false;
+        if (!id.equals(that.getId())) return false;
 
         return true;
     }",0
Fix the issue that Switch GC all the time," 
 import com.gc.materialdesign.R;
 import com.gc.materialdesign.utils.Utils;
-import com.gc.materialdesign.views.CheckBox.OnCheckListener;
+import com.nineoldandroids.animation.Animator;
+import com.nineoldandroids.animation.AnimatorListenerAdapter;
 import com.nineoldandroids.animation.ObjectAnimator;
 import com.nineoldandroids.view.ViewHelper;
 
@@ -83,6 +84,7 @@
 	public boolean onTouchEvent(MotionEvent event) {
 		isLastTouch = true;
 		if (event.getAction() == MotionEvent.ACTION_DOWN) {
+			startRedraw();
 			press = true;
 		}else if(event.getAction() == MotionEvent.ACTION_MOVE) {
 			float x = event.getX();
@@ -112,6 +114,8 @@
 			if((event.getX()<= getWidth() && event.getX() >= 0) && 
 					(event.getY()<= getHeight() && event.getY() >= 0)){
 				ball.animateCheck();
+			}else{
+				stopRedraw();
 			}
 		}
 		return true;
@@ -143,11 +147,23 @@
 			paint.setColor((check)?makePressColor():Color.parseColor(""#446D6D6D""));
 			canvas.drawCircle(ViewHelper.getX(ball)+ball.getWidth()/2, getHeight()/2, getHeight()/2, paint);
 		}
+		if (canRedraw) {
 		invalidate();
+		}
 		
 	}
 	
+	boolean canRedraw = false;
 	
+	private void startRedraw() {
+		canRedraw = true;
+		invalidate();
+	}
+
+	private void stopRedraw() {
+		canRedraw = false;
+		invalidate();
+	}
 	
 	/**
 	 * Make a dark color to press effect
@@ -216,6 +232,7 @@
 			}else{
 				objectAnimator = ObjectAnimator.ofFloat(this, ""x"", ball.xIni);
 			}
+			objectAnimator.addListener(animatorListener);
 			objectAnimator.setDuration(300);
 			objectAnimator.start();
 		}
@@ -224,6 +241,12 @@
 	
 	}
 	
+	private AnimatorListenerAdapter animatorListener = new AnimatorListenerAdapter() {
+		public void onAnimationEnd(Animator animation) {
+			stopRedraw();
+		};
+	};
+	
 	public void setOncheckListener(OnCheckListener onCheckListener){
 		this.onCheckListener = onCheckListener;
 	}",0
[java] Make BasicProjectMemoizer thread safe.,"     private Map<QualifiedName, MetricMemoizer<T>> classes = new WeakHashMap<>();
     private Map<QualifiedName, MetricMemoizer<O>> operations = new WeakHashMap<>();
 
+    private final Object classesSynchronizer = new Object();
+    private final Object operationsSynchronizer = new Object();
 
     /** Clears all memoizers. Used for tests. */
     public void reset() {
@@ -38,9 +40,11 @@
 
     @Override
     public MetricMemoizer<O> getOperationMemoizer(QualifiedName qname) {
+        synchronized (operationsSynchronizer) {
         if (!operations.containsKey(qname)) {
             operations.put(qname, new BasicMetricMemoizer<O>());
         }
+        }
 
         return operations.get(qname);
     }
@@ -48,9 +52,11 @@
 
     @Override
     public MetricMemoizer<T> getClassMemoizer(QualifiedName qname) {
+        synchronized (classesSynchronizer) {
         if (!classes.containsKey(qname)) {
             classes.put(qname, new BasicMetricMemoizer<T>());
         }
+        }
 
         return classes.get(qname);
     }",0
Fix uninstalling producer.,"   <T> void uninstallSubscriber(Class<T> type, Subscriber<T> subscriber) {
     Set<Subscriber> subscribers = handlersByType.get(type);
     if (subscribers == null || !subscribers.remove(subscriber)) {
-      throw new IllegalArgumentException(""Missing producer for an annotated method. Is "" + subscriber + "" registered?"");
+      throw new IllegalArgumentException(""Missing subscriber for an annotated method. Is ""
+              + subscriber + "" registered?"");
     }
   }
 
   <T> void uninstallProducer(Class<T> type) {
-    if (producersByType.remove(type) != null) {
-      throw new IllegalArgumentException(""Missing subscriber for an annotated method. Is "" + type + "" registered?"");
+    if (producersByType.remove(type) == null) {
+      throw new IllegalArgumentException(""Missing producer for an annotated method. Is "" + type + "" registered?"");
     }
   }
 ",0
Fix GELF HTTP input to accept compressed payloads again (#5513),"         }
 
         handlers.put(""decoder"", () -> new HttpRequestDecoder(DEFAULT_MAX_INITIAL_LINE_LENGTH, DEFAULT_MAX_HEADER_SIZE, maxChunkSize));
+        handlers.put(""decompressor"", HttpContentDecompressor::new);
         handlers.put(""aggregator"", () -> new HttpObjectAggregator(maxChunkSize));
         handlers.put(""encoder"", HttpResponseEncoder::new);
-        handlers.put(""decompressor"", HttpContentDecompressor::new);
         handlers.put(""http-handler"", () -> new HttpHandler(enableCors));
         handlers.putAll(super.getCustomChildChannelHandlers(input));
 ",0
"Revert ""CHE-10480: Fix NullPointerException (#11857)""","             if (hover != null) {
               Either<List<Either<String, MarkedString>>, MarkupContent> contents =
                   hover.getContents();
-              // getContents() method can return null, in spite of @NonNull annotation,
-              // see https://github.com/eclipse/lsp4j/issues/284
-              if (contents == null) {
-                return false;
-              }
               if (contents.isLeft()) {
                 for (Either<String, MarkedString> part : contents.getLeft()) {
                   if (content.length() > 0) {",0
Fix for Issue 1109: TextField - Pasting Does Not Pass Through TextFieldFilter ," 			StringBuilder builder = new StringBuilder();
 			for (int i = 0; i < content.length(); i++) {
 				char c = content.charAt(i);
-				if (style.font.containsCharacter(c)) builder.append(c);
+				if (style.font.containsCharacter(c) && (filter == null || filter.acceptChar(this, c))) builder.append(c);
 			}
 			content = builder.toString();
 
@@ -641,7 +641,7 @@
 		StringBuffer buffer = new StringBuffer();
 		for (int i = 0; i < text.length(); i++) {
 			char c = text.charAt(i);
-			if (font.containsCharacter(c)) buffer.append(c);
+			if (font.containsCharacter(c) && (filter == null || filter.acceptChar(this, c))) buffer.append(c);
 		}
 
 		this.text = buffer.toString();",0
修复7.0以上的手机插件输入框无法输入文字的bug,"     protected void init() {
         sHookedMethodHandlers.put(""startInput"", new startInput(mHostContext));
         sHookedMethodHandlers.put(""windowGainedFocus"", new windowGainedFocus(mHostContext));
+        sHookedMethodHandlers.put(""startInputOrWindowGainedFocus"", new startInputOrWindowGainedFocus(mHostContext));
     }
 
     private class IInputMethodManagerHookedMethodHandler extends HookedMethodHandler {
@@ -78,4 +79,10 @@
             super(hostContext);
         }
     }
+
+    private class startInputOrWindowGainedFocus extends IInputMethodManagerHookedMethodHandler {
+        public startInputOrWindowGainedFocus(Context hostContext) {
+            super(hostContext);
+        }
+    }
 }",0
Fix SHOW PARTITIONS," import com.facebook.presto.metadata.FunctionInfo;
 import com.facebook.presto.metadata.InternalTable;
 import com.facebook.presto.metadata.Metadata;
+import com.facebook.presto.metadata.OperatorInfo;
+import com.facebook.presto.metadata.OperatorNotFoundException;
 import com.facebook.presto.metadata.Partition;
 import com.facebook.presto.metadata.PartitionResult;
 import com.facebook.presto.metadata.QualifiedTableName;
@@ -26,17 +28,19 @@
 import com.facebook.presto.operator.AlignmentOperator;
 import com.facebook.presto.operator.Operator;
 import com.facebook.presto.operator.OperatorContext;
-import com.facebook.presto.spi.ConnectorColumnHandle;
 import com.facebook.presto.spi.ColumnMetadata;
+import com.facebook.presto.spi.ConnectorColumnHandle;
 import com.facebook.presto.spi.ConnectorSplit;
 import com.facebook.presto.spi.SchemaTableName;
 import com.facebook.presto.spi.TupleDomain;
 import com.facebook.presto.spi.type.Type;
+import com.facebook.presto.spi.type.VarcharType;
 import com.facebook.presto.split.ConnectorDataStreamProvider;
 import com.facebook.presto.split.SplitManager;
 import com.google.common.base.Function;
 import com.google.common.base.Joiner;
 import com.google.common.base.Optional;
+import com.google.common.base.Throwables;
 import com.google.common.collect.ImmutableBiMap;
 import com.google.common.collect.ImmutableList;
 import io.airlift.slice.Slice;
@@ -227,7 +231,20 @@
             for (Entry<ColumnHandle, Comparable<?>> entry : partition.getTupleDomain().extractFixedValues().entrySet()) {
                 ColumnHandle columnHandle = entry.getKey();
                 String columnName = columnHandles.get(columnHandle);
-                String value = entry.getValue() != null ? String.valueOf(entry.getValue()) : null;
+                String value = null;
+                if (entry.getValue() != null) {
+                    ColumnMetadata columnMetadata  = metadata.getColumnMetadata(tableHandle.get(), columnHandle);
+                    try {
+                        OperatorInfo operator = metadata.getExactOperator(OperatorInfo.OperatorType.CAST, VarcharType.VARCHAR, ImmutableList.of(columnMetadata.getType()));
+                        value = ((Slice) operator.getMethodHandle().invokeWithArguments(entry.getValue())).toStringUtf8();
+                    }
+                    catch (OperatorNotFoundException e) {
+                        value = ""<UNREPRESENTABLE VALUE>"";
+                    }
+                    catch (Throwable throwable) {
+                        throw Throwables.propagate(throwable);
+                    }
+                }
                 table.add(
                         catalogName,
                         tableName.getSchemaName(),",0
This commit should fix issue AHC-116,"             }
 
             if (proxyServer.getPrincipal() != null) {
-                if (proxyServer.getNtlmDomain() != null) {
+                if (proxyServer.getNtlmDomain() != """") {
 
                     List<String> auth = request.getHeaders().get(HttpHeaders.Names.PROXY_AUTHORIZATION);
                     if (!(auth != null && auth.size() > 0 && auth.get(0).startsWith(""NTLM""))) {",0
Fix history showing even when disabled,"         if (mHistoryIsEnabled) {
             mRecyclerView.setVisibility(View.VISIBLE);
         } else {
+            mRecyclerView.setVisibility(View.GONE);
             mDisabledView.setVisibility(View.VISIBLE);
         }
 ",0
add loadProperties()," 
 package com.weibo.motan.benchmark;
 
+import org.springframework.context.ApplicationContext;
+import org.springframework.context.support.ClassPathXmlApplicationContext;
+
+import java.io.IOException;
 import java.lang.reflect.InvocationTargetException;
 import java.util.Properties;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.CyclicBarrier;
 
-import org.springframework.context.ApplicationContext;
-import org.springframework.context.support.ClassPathXmlApplicationContext;
-
 public class MotanBenchmarkClient extends AbstractBenchmarkClient {
+
     static Properties properties = new Properties();
-    private static boolean isMultiClient; //并发的Runable线程，是否使用相同的client进行调用。
-                    // true：并发线程只使用一个client（bean实例）调用服务。
-                    // false: 每个并发线程使用不同的Client调用服务
+    /**
+     * 并发的Runable线程，是否使用相同的client进行调用。
+     * true：并发线程只使用一个client（bean实例）调用服务。
+     * false: 每个并发线程使用不同的Client调用服务
+     */
     private static BenchmarkService benchmarkService;
+    private static boolean isMultiClient;
 
 
     public static void main(String[] args) {
+        loadProperties();
         int concurrents = Integer.parseInt(properties.getProperty(""concurrents""));
         int runtime = Integer.parseInt(properties.getProperty(""runtime""));
         String classname = properties.getProperty(""classname"");
@@ -46,14 +52,24 @@
             isMultiClient = Boolean.parseBoolean(args[4]);
         }
 
-        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(new String[]{""classpath*:motan-benchmark-client.xml""});
+        ApplicationContext applicationContext = new ClassPathXmlApplicationContext(
+                new String[]{""classpath*:motan-benchmark-client.xml""});
         benchmarkService = (BenchmarkService) applicationContext.getBean(""motanBenchmarkReferer"");
 
         new MotanBenchmarkClient().start(concurrents, runtime, classname, params);
     }
 
+    private static void loadProperties() {
+        try {
+            properties.load(ClassLoader.getSystemResourceAsStream(""benchmark.properties""));
+        } catch (IOException e) {
+            e.printStackTrace();
+        }
+    }
+
     @Override
-    public ClientRunnable getClientRunnable(String classname, String params, CyclicBarrier barrier, CountDownLatch latch, long startTime, long endTime) {
+    public ClientRunnable getClientRunnable(String classname, String params, CyclicBarrier barrier,
+            CountDownLatch latch, long startTime, long endTime) {
         BenchmarkService service;
         if (isMultiClient) {
             ApplicationContext applicationContext = new ClassPathXmlApplicationContext(new String[]{""classpath*:motan-benchmark-client.xml""});",0
Fix scheduler handling of partial cancel," import io.airlift.concurrent.SetThreadName;
 
 import java.util.ArrayList;
+import java.util.HashSet;
 import java.util.List;
 import java.util.Map;
 import java.util.Optional;
@@ -53,6 +54,8 @@
 import static com.facebook.presto.execution.StageState.CANCELED;
 import static com.facebook.presto.execution.StageState.FAILED;
 import static com.facebook.presto.execution.StageState.FINISHED;
+import static com.facebook.presto.execution.StageState.RUNNING;
+import static com.facebook.presto.execution.StageState.SCHEDULED;
 import static com.facebook.presto.spi.StandardErrorCode.INTERNAL_ERROR;
 import static com.facebook.presto.spi.StandardErrorCode.USER_CANCELED;
 import static com.facebook.presto.util.ImmutableCollectors.toImmutableList;
@@ -279,6 +282,7 @@
     private void schedule()
     {
         try (SetThreadName ignored = new SetThreadName(""Query-%s"", queryStateMachine.getQueryId())) {
+            Set<StageId> completedStages = new HashSet<>();
             ExecutionSchedule executionSchedule = executionPolicy.createExecutionSchedule(stages.values());
             while (!executionSchedule.isFinished()) {
                 List<CompletableFuture<?>> blockedStages = new ArrayList<>();
@@ -300,6 +304,15 @@
                             .processScheduleResults(stage.getState(), result.getNewTasks());
                 }
 
+                // make sure to update stage linkage at least once per loop to catch async state changes (e.g., partial cancel)
+                for (SqlStageExecution stage : stages.values()) {
+                    if (!completedStages.contains(stage.getStageId()) && stage.getState().isDone()) {
+                        stageLinkages.get(stage.getStageId())
+                                .processScheduleResults(stage.getState(), ImmutableSet.of());
+                        completedStages.add(stage.getStageId());
+                    }
+                }
+
                 // wait for a state change and then schedule again
                 if (!blockedStages.isEmpty()) {
                     tryGetFutureValue(firstCompletedFuture(blockedStages), 100, MILLISECONDS);
@@ -308,6 +321,13 @@
                     }
                 }
             }
+
+            for (SqlStageExecution stage : stages.values()) {
+                StageState state = stage.getState();
+                if (state != SCHEDULED && state != RUNNING && !state.isDone()) {
+                    throw new PrestoException(INTERNAL_ERROR, format(""Scheduling is complete, but stage %s is in state %s"", stage.getStageId(), state));
+                }
+            }
         }
         catch (Throwable t) {
             queryStateMachine.transitionToFailed(t);",0
Ports are Integer not String,"     public String getSecureHost() {
         StringBuffer sb = new StringBuffer();
         sb.append(serverName);
-        if (!securePort.equals(""443"")) {
+        if (!securePort.equals(443)) {
             sb.append("":"");
             sb.append(securePort);
         }
@@ -47,7 +47,7 @@
     public String getHost() {
         StringBuffer sb = new StringBuffer();
         sb.append(serverName);
-        if (!serverPort.equals(""80"")) {
+        if (!serverPort.equals(80)) {
             sb.append("":"");
             sb.append(serverPort);
         }",0
findbugs - volatile items updated via atomic field updater," import io.undertow.util.AttachmentKey;
 import io.undertow.util.AttachmentList;
 import io.undertow.util.HeaderMap;
+import io.undertow.util.HttpString;
 import org.xnio.Bits;
 import org.xnio.ChannelExceptionHandler;
 import org.xnio.ChannelListener;
 import org.xnio.ChannelListeners;
 import org.xnio.IoUtils;
 import org.xnio.OptionMap;
-import io.undertow.util.HttpString;
 import org.xnio.StreamConnection;
 import org.xnio.channels.StreamSinkChannel;
 import org.xnio.ssl.SslConnection;
@@ -57,6 +57,7 @@
 import java.util.Random;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.TimeUnit;
+import java.util.concurrent.atomic.AtomicIntegerFieldUpdater;
 import javax.net.ssl.SSLSession;
 
 /**
@@ -147,6 +148,11 @@
     private final int maxHeaders;
     private final int maxHeaderListSize;
 
+    private final AtomicIntegerFieldUpdater<Http2Channel> sendConcurrentStreamsAtomicUpdater = AtomicIntegerFieldUpdater.newUpdater(
+            Http2Channel.class, ""sendConcurrentStreams"");
+
+    private final AtomicIntegerFieldUpdater<Http2Channel> receiveConcurrentStreamsAtomicUpdater = AtomicIntegerFieldUpdater.newUpdater(
+            Http2Channel.class, ""receiveConcurrentStreams"");
 
     private boolean thisGoneAway = false;
     private boolean peerGoneAway = false;
@@ -234,7 +240,7 @@
             if(fromUpgrade) {
                 StreamHolder streamHolder = new StreamHolder((Http2StreamSinkChannel) null);
                 streamHolder.sinkClosed = true;
-                sendConcurrentStreams++;
+                sendConcurrentStreamsAtomicUpdater.getAndIncrement(this);
                 currentStreams.put(1, streamHolder);
             }
         } else if(fromUpgrade) {
@@ -413,7 +419,7 @@
 
                 StreamHolder holder = currentStreams.get(frameParser.streamId);
                 if(holder == null) {
-                    receiveConcurrentStreams++;
+                    receiveConcurrentStreamsAtomicUpdater.getAndIncrement(this);
                     currentStreams.put(frameParser.streamId, holder = new StreamHolder((Http2StreamSourceChannel) channel));
                 } else {
                     holder.sourceChannel = (Http2StreamSourceChannel) channel;
@@ -425,7 +431,7 @@
                     if(!isClient() || !""100"".equals(parser.getHeaderMap().getFirst(STATUS))) {
                         holder.sourceClosed = true;
                         if(holder.sinkClosed) {
-                            receiveConcurrentStreams--;
+                            receiveConcurrentStreamsAtomicUpdater.getAndDecrement(this);
                             currentStreams.remove(frameParser.streamId);
                         }
                     }
@@ -871,7 +877,7 @@
         if (!isOpen()) {
             throw UndertowMessages.MESSAGES.channelIsClosed();
         }
-        ++sendConcurrentStreams;
+        sendConcurrentStreamsAtomicUpdater.incrementAndGet(this);
         if(sendMaxConcurrentStreams > 0 && sendConcurrentStreams > sendMaxConcurrentStreams) {
             throw UndertowMessages.MESSAGES.streamLimitExceeded();
         }
@@ -890,7 +896,7 @@
         if (isClient()) {
             throw UndertowMessages.MESSAGES.pushPromiseCanOnlyBeCreatedByServer();
         }
-        ++sendConcurrentStreams;
+        sendConcurrentStreamsAtomicUpdater.incrementAndGet(this);
         if(sendMaxConcurrentStreams > 0 && sendConcurrentStreams > sendMaxConcurrentStreams) {
             throw UndertowMessages.MESSAGES.streamLimitExceeded();
         }
@@ -944,9 +950,9 @@
         existing.sinkChannel = null;
         if(existing.sourceClosed) {
             if(streamId % 2 == (isClient() ? 1 : 0)) {
-                sendConcurrentStreams--;
+                sendConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             } else {
-                receiveConcurrentStreams--;
+                receiveConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             }
             currentStreams.remove(streamId);
         }
@@ -1050,9 +1056,9 @@
         StreamHolder holder = currentStreams.remove(streamId);
         if(holder != null) {
             if(streamId % 2 == (isClient() ? 1 : 0)) {
-                sendConcurrentStreams--;
+                sendConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             } else {
-                receiveConcurrentStreams--;
+                receiveConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             }
             if (holder.sinkChannel != null) {
                 holder.sinkChannel.rstStream();
@@ -1077,7 +1083,7 @@
         StreamHolder streamHolder = new StreamHolder(stream);
         streamHolder.sourceClosed = true;
         currentStreams.put(1, streamHolder);
-        receiveConcurrentStreams++;
+        receiveConcurrentStreamsAtomicUpdater.getAndIncrement(this);
         return stream;
 
     }
@@ -1104,9 +1110,9 @@
         existing.sourceChannel = null;
         if(existing.sinkClosed) {
             if(streamId % 2 == (isClient() ? 1 : 0)) {
-                sendConcurrentStreams--;
+                sendConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             } else {
-                receiveConcurrentStreams--;
+                receiveConcurrentStreamsAtomicUpdater.getAndDecrement(this);
             }
             currentStreams.remove(streamId);
         }",0
Fix possibly outdated adapter position,"   public TrendingAdapter(Picasso picasso, RepositoryClickListener repositoryClickListener) {
     this.picasso = picasso;
     this.repositoryClickListener = repositoryClickListener;
+    setHasStableIds(true);
   }
 
   @Override public void call(List<Repository> repositories) {
@@ -52,20 +53,19 @@
 
   public final class ViewHolder extends RecyclerView.ViewHolder {
     public final TrendingItemView itemView;
-    private Repository repository;
 
     public ViewHolder(TrendingItemView itemView) {
       super(itemView);
       this.itemView = itemView;
       this.itemView.setOnClickListener(new View.OnClickListener() {
         @Override public void onClick(View v) {
+          Repository repository = repositories.get(getAdapterPosition());
           repositoryClickListener.onRepositoryClick(repository);
         }
       });
     }
 
     public void bindTo(Repository repository) {
-      this.repository = repository;
       itemView.bindTo(repository, picasso);
     }
   }",0
Fix for issue 1157," 			super.onCreate(surfaceHolder);
 			this.app = new AndroidLiveWallpaper(AndroidLiveWallpaperService.this, this);
 			AndroidApplicationConfiguration config = createConfig();
-			this.app.initialize(createListener(isPreview()), config);
+			listener = createListener(isPreview());
+			this.app.initialize(listener, config);
 			this.view = ((AndroidGraphicsLiveWallpaper)app.getGraphics()).getView();
 
 			if (config.getTouchEventsForLiveWallpaper && Integer.parseInt(android.os.Build.VERSION.SDK) < 9)",0
"Fix typo in doc: ""stor the server"" -> ""stop the server"""," import java.util.Map;
 
 /**
- * <p>Exposes an {@link Endpoint} to stor the server.</p>
+ * <p>Exposes an {@link Endpoint} to stop the server.</p>
  *
  * @author James Kleeh
  * @since 1.0",0
Fix comparison for computationThreadPoolSize," 
         if (builder.eventExecutorGroup == null) {
             int computationThreadPoolSize = builder.computationThreadPoolSize;
-            if (computationThreadPoolSize < MIN_IO_THREADS) {
+            if (computationThreadPoolSize < MIN_COMPUTATION_THREADS) {
 
                 logger.info(""computationThreadPoolSize is less than {} ({}), setting to: {}"", MIN_COMPUTATION_THREADS,
                         computationThreadPoolSize, MIN_COMPUTATION_THREADS);",0
Avoid creating empty action methods in lexer (fixes #202)," 		RuleActionFunction raf = lexer.actionFuncs.get(r);
 		if ( raf==null ) {
 			raf = new RuleActionFunction(delegate, r, ctxType);
-			lexer.actionFuncs.put(r, raf);
 		}
+
 		for (ActionAST a : r.actions) {
 			if ( a instanceof PredAST ) {
 				PredAST p = (PredAST)a;
@@ -332,6 +332,11 @@
 				raf.actions.put(g.lexerActions.get(a), new Action(delegate, a));
 			}
 		}
+
+		if (!raf.actions.isEmpty() && !lexer.actionFuncs.containsKey(r)) {
+			// only add to lexer if the function actually contains actions
+			lexer.actionFuncs.put(r, raf);
+		}
 	}
 
 	public RuleFunction rule(Rule r) {",0
Fix GELF HTTP input to accept compressed payloads again,"         }
 
         handlers.put(""decoder"", () -> new HttpRequestDecoder(DEFAULT_MAX_INITIAL_LINE_LENGTH, DEFAULT_MAX_HEADER_SIZE, maxChunkSize));
+        handlers.put(""decompressor"", HttpContentDecompressor::new);
         handlers.put(""aggregator"", () -> new HttpObjectAggregator(maxChunkSize));
         handlers.put(""encoder"", HttpResponseEncoder::new);
-        handlers.put(""decompressor"", HttpContentDecompressor::new);
         handlers.put(""http-handler"", () -> new HttpHandler(enableCors));
         handlers.putAll(super.getCustomChildChannelHandlers(input));
 ",0
[3.9.5] Fix Channel closing behavior in NioChannelWriter,"         urgentWriteQueue.clear();
 
         CloseTask closeTask = new CloseTask();
-        write(new TaskFrame(closeTask));
+        NioThread owner = this.ioThread;
+        Thread currentThread = Thread.currentThread();
+        if (currentThread instanceof NioThread) {
+            if (currentThread == owner) {
+                // we don't schedule the task, we execute it immediately
+                // This will prevent waiting on a task this thread is
+                // supposed to execute, but can't. And therefor runs into
+                // a temporary stall.
+                closeTask.run();
+            }
+
+            // if the currentThread isn't the owner, there
+            // is a migration happening and we can't close
+        } else {
+            // closing is executed from a non-io thread, so we can block
+            owner.addTaskAndWakeup(closeTask);
         closeTask.awaitCompletion();
     }
+    }
 
     @Override
     public void requestMigration(NioThread newOwner) {",0
Fixed the bouncing probem.,"     private int mRefreshOriginalTopPadding;
     private int mLastMotionY;
 
+    private boolean mBounceHack;
+
     public PullToRefreshListView(Context context) {
         super(context);
         init(context);
@@ -190,6 +192,7 @@
     @Override
     public boolean onTouchEvent(MotionEvent event) {
         final int y = (int) event.getY();
+        mBounceHack = false;
 
         switch (event.getAction()) {
             case MotionEvent.ACTION_UP:
@@ -365,6 +368,9 @@
                 && firstVisibleItem == 0
                 && mRefreshState != REFRESHING) {
             setSelection(1);
+            mBounceHack = true;
+        } else if (mBounceHack && mCurrentState == SCROLL_STATE_FLING) {
+            setSelected(1);
         }
 
         if (mOnScrollListener != null) {
@@ -377,6 +383,10 @@
     public void onScrollStateChanged(AbsListView view, int scrollState) {
         mCurrentScrollState = scrollState;
 
+        if (mCurrentScrollState == SCROLL_STATE_IDLE) {
+            mBounceHack = false;
+        }
+
         if (mOnScrollListener != null) {
             mOnScrollListener.onScrollStateChanged(view, scrollState);
         }",0
Fixed #879: ArgumentMatchers grammar fix,"  * <p>
  * Matcher methods like <code>anyObject()</code>, <code>eq()</code> <b>do not</b> return matchers.
  * Internally, they record a matcher on a stack and return a dummy value (usually null).
- * This implementation is due static type safety imposed by java compiler.
+ * This implementation is due to static type safety imposed by java compiler.
  * The consequence is that you cannot use <code>anyObject()</code>, <code>eq()</code> methods outside of verified/stubbed method.
  * </p>
  *",0
Enable and Disable ping/pong,"     private int connectionLostTimeout = 60;
 
     /**
+	 * Attribute to keep track if the WebSocket Server/Client is running/connected
+	 * @since 1.3.9
+	 */
+	private boolean websocketRunning = false;
+
+    /**
      * Get the interval checking for lost connections
      * Default is 60 seconds
      * @return the interval
@@ -87,11 +93,23 @@
     public void setConnectionLostTimeout( int connectionLostTimeout ) {
         this.connectionLostTimeout = connectionLostTimeout;
         if (this.connectionLostTimeout <= 0) {
-            stopConnectionLostTimer();
+			if( WebSocketImpl.DEBUG )
+				System.out.println( ""Connection lost timer stopped"" );
+			cancelConnectionLostTimer();
+            return;
         }
-        if (connectionLostTimer != null || connectionLostTimerTask != null) {
+        if (this.websocketRunning) {
 			if( WebSocketImpl.DEBUG )
 				System.out.println( ""Connection lost timer restarted"" );
+			//Reset all the pings
+			ArrayList<WebSocket> connections = new ArrayList<WebSocket>( getConnections() );
+			WebSocketImpl webSocketImpl;
+			for( WebSocket conn : connections ) {
+				if( conn instanceof WebSocketImpl ) {
+					webSocketImpl = ( WebSocketImpl ) conn;
+					webSocketImpl.updateLastPong();
+				}
+			}
 			restartConnectionLostTimer();
 		}
     }
@@ -102,6 +120,7 @@
      */
     protected void stopConnectionLostTimer() {
         if (connectionLostTimer != null ||connectionLostTimerTask != null) {
+			this.websocketRunning = false;
             if( WebSocketImpl.DEBUG )
                 System.out.println( ""Connection lost timer stopped"" );
             cancelConnectionLostTimer();
@@ -119,6 +138,7 @@
         }
         if (WebSocketImpl.DEBUG)
             System.out.println(""Connection lost timer started"");
+        this.websocketRunning = true;
        	restartConnectionLostTimer();
     }
 ",0
Compression fix,"     private final Attribute<HttpTransactionContext> REQUEST_STATE_ATTR =
             Grizzly.DEFAULT_ATTRIBUTE_BUILDER.createAttribute(HttpTransactionContext.class.getName());
 
+    private final BodyHandlerFactory bodyHandlerFactory = new BodyHandlerFactory();
+
     private final TCPNIOTransport clientTransport;
     private final AsyncHttpClientConfig clientConfig;
     private final ConnectionManager connectionManager;
@@ -131,6 +133,7 @@
     private DelayedExecutor timeoutExecutor;
 
 
+
     // ------------------------------------------------------------ Constructors
 
 
@@ -164,12 +167,43 @@
         final GrizzlyResponseFuture<T> future =
                 new GrizzlyResponseFuture<T>(this, request, handler);
         future.setDelegate(SafeFutureImpl.<T>create());
-        final Connection c;
+        final CompletionHandler<Connection>  connectHandler = new CompletionHandler<Connection>() {
+            @Override
+            public void cancelled() {
+                future.cancel(true);
+            }
+
+            @Override
+            public void failed(final Throwable throwable) {
+                future.abort(throwable);
+            }
+
+            @Override
+            public void completed(final Connection c) {
         try {
-            c = connectionManager.obtainTrackedConnection(request, future);
             execute(c, request, handler, future);
         } catch (Exception e) {
             if (e instanceof RuntimeException) {
+                        failed(e);
+                    } else if (e instanceof IOException) {
+                        failed(e);
+                    }
+                    if (LOGGER.isWarnEnabled()) {
+                        LOGGER.warn(e.toString(), e);
+                    }
+                }
+            }
+
+            @Override
+            public void updated(final Connection c) {
+                // no-op
+            }
+        };
+
+        try {
+            connectionManager.doAsyncTrackedConnection(request, future, connectHandler);
+        } catch (Exception e) {
+            if (e instanceof RuntimeException) {
                 throw (RuntimeException) e;
             } else if (e instanceof IOException) {
                 throw (IOException) e;
@@ -182,9 +216,6 @@
         return future;
     }
 
-
-
-
     /**
      * {@inheritDoc}
      */
@@ -420,7 +451,7 @@
 
         if (requestHasEntityBody(request)) {
             final HttpTransactionContext context = getHttpTransactionContext(ctx.getConnection());
-            BodyHandler handler = BodyHandlerFactory.getBodyHandler(request);
+            BodyHandler handler = bodyHandlerFactory.getBodyHandler(request);
             if (requestPacket.getHeaders().contains(Header.Expect)
                     && requestPacket.getHeaders().getValue(1).equalsIgnoreCase(""100-Continue"")) {
                 handler = new ExpectHandler(handler);
@@ -1453,9 +1484,9 @@
     } // END BodyHandler
 
 
-    private static final class BodyHandlerFactory {
+    private final class BodyHandlerFactory {
 
-        private static final BodyHandler[] HANDLERS = new BodyHandler[] {
+        private final BodyHandler[] HANDLERS = new BodyHandler[] {
             new StringBodyHandler(),
             new ByteArrayBodyHandler(),
             new ParamsBodyHandler(),
@@ -1466,7 +1497,7 @@
             new BodyGeneratorBodyHandler()
         };
 
-        public static BodyHandler getBodyHandler(final Request request) {
+        public BodyHandler getBodyHandler(final Request request) {
             for (final BodyHandler h : HANDLERS) {
                 if (h.handlesBodyType(request)) {
                     return h;
@@ -1515,7 +1546,7 @@
     } // END ContinueHandler
 
 
-    private static final class ByteArrayBodyHandler implements BodyHandler {
+    private final class ByteArrayBodyHandler implements BodyHandler {
 
 
         // -------------------------------------------- Methods from BodyHandler
@@ -1537,7 +1568,11 @@
             final byte[] data = new String(request.getByteData(), charset).getBytes(charset);
             final MemoryManager mm = ctx.getMemoryManager();
             final Buffer gBuffer = Buffers.wrap(mm, data);
+            if (requestPacket.getContentLength() == -1) {
+                    if (!clientConfig.isCompressionEnabled()) {
             requestPacket.setContentLengthLong(data.length);
+                    }
+                }
             final HttpContent content = requestPacket.httpContentBuilder().content(gBuffer).build();
             content.setLast(true);
             ctx.write(content, ((!requestPacket.isCommitted()) ? ctx.getTransportContext().getCompletionHandler() : null));
@@ -1545,7 +1580,7 @@
     }
 
 
-    private static final class StringBodyHandler implements BodyHandler {
+    private final class StringBodyHandler implements BodyHandler {
 
 
         // -------------------------------------------- Methods from BodyHandler
@@ -1568,7 +1603,11 @@
             final byte[] data = request.getStringData().getBytes(charset);
             final MemoryManager mm = ctx.getMemoryManager();
             final Buffer gBuffer = Buffers.wrap(mm, data);
+            if (requestPacket.getContentLength() == -1) {
+                if (!clientConfig.isCompressionEnabled()) {
             requestPacket.setContentLengthLong(data.length);
+                }
+            }
             final HttpContent content = requestPacket.httpContentBuilder().content(gBuffer).build();
             content.setLast(true);
             ctx.write(content, ((!requestPacket.isCommitted()) ? ctx.getTransportContext().getCompletionHandler() : null));
@@ -1601,7 +1640,8 @@
     } // END StringBodyHandler
 
 
-    private static final class ParamsBodyHandler implements BodyHandler {
+    private final class ParamsBodyHandler implements BodyHandler {
+
 
         // -------------------------------------------- Methods from BodyHandler
 
@@ -1646,7 +1686,11 @@
                 final MemoryManager mm = ctx.getMemoryManager();
                 final Buffer gBuffer = Buffers.wrap(mm, data);
                 final HttpContent content = requestPacket.httpContentBuilder().content(gBuffer).build();
+                if (requestPacket.getContentLength() == -1) {
+                    if (!clientConfig.isCompressionEnabled()) {
                 requestPacket.setContentLengthLong(data.length);
+                    }
+                }
                 content.setLast(true);
                 ctx.write(content, ((!requestPacket.isCommitted()) ? ctx.getTransportContext().getCompletionHandler() : null));
             }
@@ -1910,7 +1954,25 @@
             return ((canCache != null) ? canCache : false);
         }
 
+        private void doAsyncTrackedConnection(final Request request,
+                                              final GrizzlyResponseFuture requestFuture,
+                                              final CompletionHandler<Connection> connectHandler)
+        throws IOException, ExecutionException, InterruptedException {
+            final String url = request.getUrl();
+            Connection c = pool.poll(AsyncHttpProviderUtils.getBaseUrl(url));
+            if (c == null) {
+                if (!connectionMonitor.acquire()) {
+                    throw new IOException(""Max connections exceeded"");
+                }
+                doAsyncConnect(url, request, requestFuture, connectHandler);
+            } else {
+                provider.touchConnection(c, request);
+                connectHandler.completed(c);
+            }
 
+        }
+
+        /*
         Connection obtainTrackedConnection(final Request request,
                                            final GrizzlyResponseFuture requestFuture)
         throws IOException, ExecutionException, InterruptedException {
@@ -1929,7 +1991,7 @@
             return c;
 
         }
-
+        */
 
         Connection obtainConnection(final Request request,
                                     final GrizzlyResponseFuture requestFuture)
@@ -1943,6 +2005,23 @@
 
         }
 
+        private void doAsyncConnect(final String url,
+                                    final Request request,
+                                    final GrizzlyResponseFuture requestFuture,
+                                    final CompletionHandler<Connection> connectHandler)
+        throws IOException, ExecutionException, InterruptedException {
+
+            final URI uri = AsyncHttpProviderUtils.createUri(url);
+            ProxyServer proxy = getProxyServer(request);
+            if (ProxyUtils.avoidProxy(proxy, request)) {
+                proxy = null;
+            }
+            String host = ((proxy != null) ? proxy.getHost() : uri.getHost());
+            int port = ((proxy != null) ? proxy.getPort() : uri.getPort());
+            connectionHandler.connect(new InetSocketAddress(host, getPort(uri, port)),
+                    createConnectionCompletionHandler(request, requestFuture, connectHandler));
+
+        }
 
         private Connection obtainConnection0(final String url,
                                              final Request request,
@@ -1957,7 +2036,7 @@
             String host = ((proxy != null) ? proxy.getHost() : uri.getHost());
             int port = ((proxy != null) ? proxy.getPort() : uri.getPort());
             return connectionHandler.connect(new InetSocketAddress(host, getPort(uri, port)),
-                                             createConnectionCompletionHandler(request, requestFuture)).get();
+                                             createConnectionCompletionHandler(request, requestFuture, null)).get();
 
         }
 
@@ -1996,23 +2075,38 @@
         }
 
         CompletionHandler<Connection> createConnectionCompletionHandler(final Request request,
-                                                                        final GrizzlyResponseFuture future) {
+                                                                        final GrizzlyResponseFuture future,
+                                                                        final CompletionHandler<Connection> wrappedHandler) {
             return new CompletionHandler<Connection>() {
                 public void cancelled() {
+                    if (wrappedHandler != null) {
+                        wrappedHandler.cancelled();
+                    } else {
                     future.cancel(true);
                 }
+                }
 
                 public void failed(Throwable throwable) {
+                    if (wrappedHandler != null) {
+                        wrappedHandler.failed(throwable);
+                    } else {
                     future.abort(throwable);
                 }
+                }
 
                 public void completed(Connection connection) {
                     future.setConnection(connection);
                     provider.touchConnection(connection, request);
+                    if (wrappedHandler != null) {
+                        connection.addCloseListener(connectionMonitor);
+                        wrappedHandler.completed(connection);
+                    }
                 }
 
                 public void updated(Connection result) {
-                    // no-op
+                    if (wrappedHandler != null) {
+                        wrappedHandler.updated(result);
+                    }
                 }
             };
         }",0
Fix NPE in DebugOverlay. ,"             });
         }
         UILabel saveStatusLabel = find(""saveStatusLabel"", UILabel.class);
-        if (saveStatusLabel != null) {
+        // clients do not have a storage manager
+        if (saveStatusLabel != null && storageManager != null) {
             saveStatusLabel.bindText(new ReadOnlyBinding<String>() {
                 @Override
                 public String get() {",0
Fix elliptical badge form,"         setTranslationY(10);
 
         int size = Math.max(getWidth(), getHeight());
-        getLayoutParams().width = size;
-        getLayoutParams().height = size;
+
+        ViewGroup.LayoutParams params = getLayoutParams();
+        params.width = size;
+        params.height = size;
+        setLayoutParams(params);
     }
 
     @SuppressWarnings(""deprecation"")",0
Correct request rewrite when following redirection,"             redirectMessage.setRequestingUser(requestingUser);
             redirectMessage.getRequestHeader().setURI(newLocation);
 
-            if (isRequestRewriteNeeded(redirectMessage.getResponseHeader().getStatusCode())) {
+            if (isRequestRewriteNeeded(redirectMessage)) {
                 redirectMessage.getRequestHeader().setMethod(HttpRequestHeader.GET);
                 redirectMessage.getRequestHeader().setHeader(HttpHeader.CONTENT_TYPE, null);
                 redirectMessage.getRequestHeader().setHeader(HttpHeader.CONTENT_LENGTH, null);
@@ -1018,18 +1018,24 @@
     }
 
     /**
-     * Tells whether or not the (original) request of the redirection with the given status code, should be rewritten.
+     * Tells whether or not the (original) request of the redirection, should be rewritten.
      * <p>
-     * For status codes 301, 302 and 303 the request should be changed from POST to GET when following redirections (mimicking
-     * the behaviour of browsers, which per <a href=""https://tools.ietf.org/html/rfc7231#section-6.4"">RFC 7231, Section 6.4</a>
-     * is now OK).
+     * For status codes 301 and 302 the request should be changed from POST to GET when following redirections, for status code
+     * 303 it should be changed to GET for all methods except GET/HEAD (mimicking the behaviour of browsers, which per
+     * <a href=""https://tools.ietf.org/html/rfc7231#section-6.4"">RFC 7231, Section 6.4</a> is now OK).
      *
-     * @param statusCode the status code that will be checked
+     * @param message the message with the redirection.
      * @return {@code true} if the request should be rewritten, {@code false} otherwise
      * @see #isRedirectionNeeded(int)
      */
-    private static boolean isRequestRewriteNeeded(int statusCode) {
-        return statusCode == 301 || statusCode == 302 || statusCode == 303;
+    private static boolean isRequestRewriteNeeded(HttpMessage message) {
+        int statusCode = message.getResponseHeader().getStatusCode();
+        String method = message.getRequestHeader().getMethod();
+        if (statusCode == 301 || statusCode == 302) {
+            return HttpRequestHeader.POST.equalsIgnoreCase(method);
+        }
+        return statusCode == 303
+                && !(HttpRequestHeader.GET.equalsIgnoreCase(method) || HttpRequestHeader.HEAD.equalsIgnoreCase(method));
     }
 
     /**",0
Fix typo: incompatibile should be incompatible," 			int lhsColumnSpan = getColumnSpan( lhsType, sessionFactory );
 			if ( lhsColumnSpan != getColumnSpan( rhsType, sessionFactory ) ) {
 				throw new TypeMismatchException(
-						""left and right hand sides of a binary logic operator were incompatibile ["" +
+						""left and right hand sides of a binary logic operator were incompatible ["" +
 								lhsType.getName() + "" : "" + rhsType.getName() + ""]""
 				);
 			}",0
remove unused fields and fix warnings in ExpressionAnalyzer,"  */
 public class ExpressionAnalyzer {
 
-    private final static String _SCORE = ""_score"";
-
     private final static Map<ComparisonExpression.Type, ComparisonExpression.Type> SWAP_OPERATOR_TABLE =
             ImmutableMap.<ComparisonExpression.Type, ComparisonExpression.Type>builder()
             .put(ComparisonExpression.Type.GREATER_THAN, ComparisonExpression.Type.LESS_THAN)
@@ -300,7 +298,8 @@
     private Object[] normalizeObjectArrayValue(Object[] value, ReferenceInfo arrayInfo, boolean forWrite) {
         for (Object arrayItem : value) {
             Preconditions.checkArgument(arrayItem instanceof Map, ""invalid value for object array type"");
-            arrayItem = normalizeObjectValue((Map<String, Object>)arrayItem, arrayInfo, forWrite);
+            // return value not used and replaced in value as arrayItem is a map that is mutated
+            normalizeObjectValue((Map<String, Object>)arrayItem, arrayInfo, forWrite);
         }
         return value;
     }
@@ -359,8 +358,6 @@
 
     class InnerExpressionAnalyzer extends AstVisitor<Symbol, ExpressionAnalysisContext> {
 
-        private boolean insideNotPredicate;
-
         @Override
         protected Symbol visitExpression(Expression node, ExpressionAnalysisContext context) {
             throw new UnsupportedOperationException(String.format(
@@ -506,9 +503,7 @@
 
         @Override
         protected Symbol visitNotExpression(NotExpression node, ExpressionAnalysisContext context) {
-            insideNotPredicate = true;
             Symbol argument = process(node.getValue(), context);
-            insideNotPredicate = false;
 
             DataType dataType = argument.valueType();
             if (!dataType.equals(DataTypes.BOOLEAN) && !dataType.equals(DataTypes.UNDEFINED)) {",0
Fix layout_width is parsed incorrectly," 		
 		int layoutWidth = 0;
 		if(a.getString(R.styleable.BootstrapButton_android_layout_width) != null) {
-			layoutWidth = a.getInt(R.styleable.BootstrapButton_android_layout_width, 0);
+			layoutWidth = a.getLayoutDimension(R.styleable.BootstrapButton_android_layout_width, 0);
 		}
 		
 		//works even if it's fill_parent or match_parent ",0
fixes ecj issue (eclipse luna sr2),"         this.hash = Lazy.of(() -> Traversable.hash(trie::iterator));
     }
 
-    private static <K, V> HashMap<K, V> of(HashArrayMappedTrie<K, V> trie) {
-        if (trie.isEmpty()) {
-            return empty();
-        } else {
-            return new HashMap<>(trie);
-        }
-    }
-
     /**
      * Returns a {@link java.util.stream.Collector} which may be used in conjunction with
      * {@link java.util.stream.Stream#collect(java.util.stream.Collector)} to obtain a {@link javaslang.collection.HashMap}.
@@ -217,7 +209,7 @@
     @Override
     public <U> Seq<U> flatMap(Function<? super Entry<K, V>, ? extends java.lang.Iterable<? extends U>> mapper) {
         Objects.requireNonNull(mapper, ""mapper is null"");
-        return (Seq<U>) iterator().flatMap(mapper).toStream();
+        return iterator().flatMap(mapper).toStream();
     }
 
     @Override
@@ -347,7 +339,7 @@
     @Override
     public <U> Seq<U> map(Function<? super Entry<K, V>, ? extends U> mapper) {
         Objects.requireNonNull(mapper, ""mapper is null"");
-        return (Seq<U>) iterator().map(mapper).toStream();
+        return iterator().map(mapper).toStream();
     }
 
     @Override
@@ -436,7 +428,7 @@
         for (K key : keys) {
             result = result.remove(key);
         }
-        return HashMap.of(result);
+        return result.isEmpty() ? empty() : new HashMap<>(result);
     }
 
     @Override
@@ -460,7 +452,7 @@
                 tree = tree.put(entry.key, entry.value);
             }
         }
-        return new HashMap<>(tree);
+        return tree.isEmpty() ? empty() : new HashMap<>(tree);
     }
 
     @Override",0
Fixed put to nearcache,"         }
 
         ReplicatedMapGetResponse response = invoke(new ClientReplicatedMapGetRequest(getName(), key));
-        // TODO add near caching
+        if (nearCache != null) {
+            nearCache.put(key, response.getValue());
+        }
         return (V) response.getValue();
     }
 ",0
Fix Jython1 Breaking Java 6," package ysoserial.payloads;
 
+import org.apache.commons.io.FileUtils;
 import org.python.core.*;
 
 import java.math.BigInteger;
-import java.nio.file.Files;
-import java.nio.file.Paths;
+import java.io.File;
 import java.lang.reflect.Proxy;
 import java.util.Arrays;
 import java.util.Comparator;
@@ -51,7 +51,7 @@
         }
 
         // Set payload parameters
-        String python_code = new String(Files.readAllBytes(Paths.get(paths[0])));
+        String python_code = FileUtils.readFileToString(new File(paths[0]), ""UTF-8"");
 
         // Python bytecode to write a file on disk and execute it
         String code =",0
Fix Android issue 58602,"         public void onTabUnselected(android.app.ActionBar.Tab tab,
                 android.app.FragmentTransaction ft) {
             mTabListener.onTabUnselected(this, ft != null ? getActiveTransaction() : null);
+            commitActiveTransaction();
         }
 
         @Override",0
Fix crash when a beacon transmits multiple URLs,"     if (beacon == null || !URLUtil.isNetworkUrl(beacon.getUrl())) {
       return;
     }
-    UrlDevice urlDevice = createUrlDeviceBuilder(TAG + device.getAddress(), beacon.getUrl())
+    UrlDevice urlDevice = createUrlDeviceBuilder(TAG + device.getAddress() + beacon.getUrl(),
+                                                 beacon.getUrl())
         .setRssi(rssi)
         .setTxPower(beacon.getTxPowerLevel())
         .setDeviceType(Utils.BLE_DEVICE_TYPE)",0
Fix error message for lambda import,"             layer = new KerasCropping2D(layerConfig, enforceTrainingConfig);
         } else if (layerClassName.equals(conf.getLAYER_CLASS_NAME_CROPPING_1D())) {
             layer = new KerasCropping1D(layerConfig, enforceTrainingConfig);
-        } else if (layerClassName.equals(conf.getLAYER_CLASS_NAME_LAMBDA()) && !lambdaLayers.isEmpty()) {
+        } else if (layerClassName.equals(conf.getLAYER_CLASS_NAME_LAMBDA())) {
             String lambdaLayerName = KerasLayerUtils.getLayerNameFromConfig(layerConfig, conf);
             SameDiffLambdaLayer lambdaLayer;
             if (lambdaLayers.containsKey(lambdaLayerName)) {
                 lambdaLayer = lambdaLayers.get(lambdaLayerName);
             } else {
                 throw new UnsupportedKerasConfigurationException(""No SameDiff Lambda layer found for Lambda"" +
-                        ""layer "" + lambdaLayerName);
+                        ""layer "" + lambdaLayerName + "". You can register a SameDiff Lambda layer using KerasLayer."" +
+                        ""registerLambdaLayer(lambdaLayerName, sameDiffLambdaLayer);"");
             }
             layer = new KerasLambda(layerConfig, enforceTrainingConfig, lambdaLayer);
         } else {",0
Fix a possible overflow in the counting condition profile.,"         @CompilationFinal private int trueCount;
         @CompilationFinal private int falseCount;
 
+        /**
+         * A constant holding the maximum value an {@code int} can have, 2<sup>30</sup>-1. The sum
+         * of the true and false count must not overflow. This constant is used to check whether one
+         * of the counts does not exceed the required maximum value.
+         */
+        public static final int MAX_VALUE = 0x3fffffff;
+
         Counting() {
             /* package protected constructor */
         }
@@ -134,13 +141,13 @@
                 if (value) {
                     // local required to guarantee no overflow in multi-threaded environments
                     int t = trueCount;
-                    if (t < Integer.MAX_VALUE) {
+                    if (t < MAX_VALUE) {
                         trueCount = t + 1;
                     }
                 } else {
                     // local required to guarantee no overflow in multi-threaded environments
                     int f = falseCount;
-                    if (f < Integer.MAX_VALUE) {
+                    if (f < MAX_VALUE) {
                         falseCount = f + 1;
                     }
                 }
@@ -153,15 +160,14 @@
                 if (value) {
                     if (t == 0) {
                         CompilerDirectives.transferToInterpreterAndInvalidate();
-                        t = 1;
                     }
                 } else {
                     if (f == 0) {
                         CompilerDirectives.transferToInterpreterAndInvalidate();
-                        f = 1;
                     }
                 }
-                return CompilerDirectives.injectBranchProbability((double) t / (double) (t + f), value);
+                int sum = t + f;
+                return CompilerDirectives.injectBranchProbability((double) t / (double) sum, value);
             }
         }
 
@@ -177,8 +183,9 @@
         public String toString() {
             int t = trueCount;
             int f = falseCount;
-            return toString(ConditionProfile.class, trueCount == 0 && falseCount == 0, false, //
-                            String.format(""trueProbability=%s (trueCount=%s, falseCount=%s)"", (double) t / (double) (t + f), t, f));
+            int sum = t + f;
+            String details = String.format(""trueProbability=%s (trueCount=%s, falseCount=%s)"", (double) t / (double) sum, t, f);
+            return toString(ConditionProfile.class, sum == 0, false, details);
         }
 
         /* Needed for lazy class loading. */",0
Fix the bug about template always refresh when cache-offline is store  in LocalServer mode.,"             // When cache-offline is ""http"": which means sonic server is in bad condition, need feed back to run standard http request.
             return SonicConstants.ERROR_CODE_SUCCESS;
         }
+
+        if (TextUtils.isEmpty(cacheOffline)) {
         addResponseHeaderFields(SonicSessionConnection.CUSTOM_HEAD_FILED_CACHE_OFFLINE, OFFLINE_MODE_TRUE);
+        }
 
         if (isFirstLoadRequest()) { // first load case
             return SonicConstants.ERROR_CODE_SUCCESS;",0
Dead players alive-d on join,"             characterComp.controller = entity;
             character.saveComponent(characterComp);
             character.setOwner(entity);
+            if (!character.hasComponent(AliveCharacterComponent.class)) {
+                character.addComponent(new AliveCharacterComponent());
+            }
             Location.attachChild(character, entity, new Vector3f(), new Quat4f(0, 0, 0, 1));
         } else {
             character.destroy();",0
Fix for NullPointerException with repoTags,"         for (Map.Entry<String, Image> entry : dockerImagesByImageId.entrySet()) {
             String[] repoTags = entry.getValue().getRepoTags();
             // If no tags present, fall back to image ID
-            if (repoTags.length == 0 || repoTags[0].isEmpty()) {
+            if (repoTags == null || repoTags.length == 0) {
                 dockerImageByImageTags.put(entry.getKey(), entry.getValue());
             } else {
                 for (String tag : repoTags) {
-                    if (!tag.isEmpty()) {
+                    if (tag != null && !tag.isEmpty()) {
                         dockerImageByImageTags.put(tag, entry.getValue());
                     }
                 }
@@ -332,6 +332,28 @@
         List<Image> images = dockerClient.listImagesCmd().withShowAll(true).exec();
         Map<String, Image> dockerImageByImageId = images.stream().collect(Collectors.toMap(Image::getId, img -> img));
 
+        // TODO: Remove remove this after all cases of repo tags have been found
+        for (Image image : dockerImageByImageId.values()) {
+            if (image.getRepoTags() == null) {
+                logger.info(""^^^ Repo tags are null: "" + image.getId());
+            } else if (image.getRepoTags().length == 0) {
+                logger.info(""^^^ Repo tags array is empty: "" + image.getId());
+            } else {
+                List<String> repoTagsList = Arrays.asList(image.getRepoTags());
+                if (repoTagsList.contains(null)) {
+                    logger.info(""^^^ Repo tags array contained null tag: "" + image.getId());
+                } else if (repoTagsList.contains("""")) {
+                    logger.info(""^^^ Repo tags array contained empty tag: "" + image.getId());
+                }
+            }
+
+            if (image.getParentId() == null) {
+                logger.info(""^^^ Parent ID is null"");
+            } else if (image.getParentId().isEmpty()) {
+                logger.info(""^^^ Parent ID is empty"");
+            }
+        }
+
         List<com.github.dockerjava.api.model.Container> containers = dockerClient.listContainersCmd().withShowAll(true).exec();
         Map<String, Image> unusedImagesByContainers = filterOutImagesUsedByContainers(dockerImageByImageId, containers);
         Map<String, Image> unusedImagesByExcept = filterOutExceptImages(unusedImagesByContainers, except);",0
fixed off-by-1 error in MD2Loader.loadFrame()," 		int len = 0;
 		for (int i = 0; i < charBuffer.length; i++)
 			if (charBuffer[i] == 0) {
-				len = i - 1;
+				len = i;
 				break;
 			}
 ",0
small typo fix in VersionMismatchException message," 		String coreVersion = getAAProcessorVersion();
 
 		if (!apiVersion.equals(coreVersion)) {
-			throw new VersionMismatchException(""AndroidAnnotation version for API ("" + apiVersion + "") and core ("" + coreVersion + "" doesn't match. Please check your classpath)"");
+			throw new VersionMismatchException(""AndroidAnnotation version for API ("" + apiVersion + "") and core ("" + coreVersion + "") doesn't match. Please check your classpath"");
 		}
 	}
 ",0
Fix ScreenUtils.," 	 * accessed via {@link TextureRegion#getTexture}. The texture is not managed and has to be reloaded manually on a context loss.
 	 * The returned TextureRegion is flipped along the Y axis by default. */
 	public static TextureRegion getFrameBufferTexture () {
-		final int w = Gdx.graphics.getWidth();
-		final int h = Gdx.graphics.getHeight();
+		final int w = Gdx.graphics.getBackBufferWidth();
+		final int h = Gdx.graphics.getBackBufferHeight();
 		return getFrameBufferTexture(0, 0, w, h);
 	}
 
@@ -84,8 +84,8 @@
 	 * 
 	 * @param flipY whether to flip pixels along Y axis */
 	public static byte[] getFrameBufferPixels (boolean flipY) {
-		final int w = Gdx.graphics.getWidth();
-		final int h = Gdx.graphics.getHeight();
+		final int w = Gdx.graphics.getBackBufferWidth();
+		final int h = Gdx.graphics.getBackBufferHeight();
 		return getFrameBufferPixels(0, 0, w, h, flipY);
 	}
 
@@ -93,7 +93,7 @@
 	 * equal to the specified width * height * 4. The byte[] will always contain RGBA8888 data. If the width and height specified
 	 * are larger than the framebuffer dimensions, the Texture will be padded accordingly. Pixels that fall outside of the current
 	 * screen will have RGBA values of 0. Because of differences in screen and image origins the framebuffer contents should be
-	 * flipped along the Y axis if you intend save them to disk as a bitmap. Flipping is not cheap operation, so use this
+	 * flipped along the Y axis if you intend save them to disk as a bitmap. Flipping is not a cheap operation, so use this
 	 * functionality wisely.
 	 * 
 	 * @param flipY whether to flip pixels along Y axis */",0
Fix generated includes,"             ""#if !defined(__STDC_LIMIT_MACROS)\n"" +
             ""#  define __STDC_LIMIT_MACROS 1\n"" +
             ""#endif\n"" +
-            ""#include <string.h>\n"" +
-            ""#include <stdint.h>\n"" +
-            ""#include <limits.h>\n"" +
-            ""#include <stdexcept>\n"" +
             ""#include <cstdint>\n"" +
-            ""#include <limits>\n\n"" +
+            ""#include <cstring>\n"" +
+            ""#include <limits>\n"" +
+            ""#include <stdexcept>\n\n"" +
             ""#if defined(WIN32) || defined(_WIN32)\n"" +
             ""#  define SBE_BIG_ENDIAN_ENCODE_16(v) _byteswap_ushort(v)\n"" +
             ""#  define SBE_BIG_ENDIAN_ENCODE_32(v) _byteswap_ulong(v)\n"" +",0
Long have to be compared using equals,"             // if parameter customerPhone is set as default, unset all other default phones
             if (customerPhone.getPhone().isDefault()) {
                 for (CustomerPhone activeCustomerPhone : activeCustomerPhones) {
-                    if (activeCustomerPhone.getId() != customerPhone.getId() && activeCustomerPhone.getPhone().isDefault()) {
+                    if (!activeCustomerPhone.getId().equals(customerPhone.getId()) && activeCustomerPhone.getPhone().isDefault()) {
                         activeCustomerPhone.getPhone().setDefault(false);
                         customerPhoneDao.save(activeCustomerPhone);
                     }",0
[UNDERTOW-1050] minor: just a fix of a typo in name of JettyAlpnProvider," 
     @Override
     public String toString() {
-        return ""JettyAlpnProvider{}"";
+        return ""JettyAlpnProvider"";
     }
 }",0
Fixes #5059. Sounds randomly not being played on Android," 
 package com.badlogic.gdx.backends.android;
 
-import java.io.FileDescriptor;
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.List;
-
 import android.app.Activity;
 import android.content.Context;
 import android.content.res.AssetFileDescriptor;
+import android.media.AudioAttributes;
 import android.media.AudioManager;
 import android.media.MediaPlayer;
 import android.media.SoundPool;
+import android.os.Build;
 
 import com.badlogic.gdx.Audio;
 import com.badlogic.gdx.Files.FileType;
@@ -37,6 +34,11 @@
 import com.badlogic.gdx.files.FileHandle;
 import com.badlogic.gdx.utils.GdxRuntimeException;
 
+import java.io.FileDescriptor;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
+
 /** An implementation of the {@link Audio} interface for Android.
  * 
  * @author mzechner */
@@ -47,7 +49,15 @@
 
 	public AndroidAudio (Context context, AndroidApplicationConfiguration config) {
 		if (!config.disableAudio) {
-			soundPool = new SoundPool(config.maxSimultaneousSounds, AudioManager.STREAM_MUSIC, 100);
+			if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+				AudioAttributes audioAttrib = new AudioAttributes.Builder()
+						.setUsage(AudioAttributes.USAGE_GAME)
+						.setContentType(AudioAttributes.CONTENT_TYPE_SONIFICATION)
+						.build();
+				soundPool = new SoundPool.Builder().setAudioAttributes(audioAttrib).setMaxStreams(config.maxSimultaneousSounds).build();
+			}else {
+				soundPool = new SoundPool(config.maxSimultaneousSounds, AudioManager.STREAM_MUSIC, 0);// srcQuality: the sample-rate converter quality. Currently has no effect. Use 0 for the default.
+			}
 			manager = (AudioManager)context.getSystemService(Context.AUDIO_SERVICE);
 			if (context instanceof Activity) {
 				((Activity)context).setVolumeControlStream(AudioManager.STREAM_MUSIC);",0
Apply PR#3090 from 5.2.x (fix clientUri handling in MongoDbConnectionFactory)," import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collection;
-import java.util.Collections;
 import java.util.HashSet;
 import java.util.List;
 import java.util.Set;
@@ -286,13 +285,8 @@
     }
 
     private Mongo buildMongoDbClient(final String clientUri, final MongoClientOptions clientOptions) {
-        final MongoClientURI uri = buildMongoClientURI(clientUri);
-        final MongoCredential credential = buildMongoCredential(uri);
-
-        final String hostUri = uri.getHosts().get(0);
-        final String[] host = hostUri.split("":"");
-        final ServerAddress addr = new ServerAddress(host[0], host.length > 1 ? Integer.parseInt(host[1]) : DEFAULT_PORT);
-        return new MongoClient(addr, Collections.singletonList(credential), clientOptions);
+        final MongoClientURI uri = buildMongoClientURI(clientUri, clientOptions);
+        return new MongoClient(uri);
     }
 
     private MongoCredential buildMongoCredential(final MongoClientURI uri) {
@@ -307,4 +301,9 @@
     private MongoClientURI buildMongoClientURI(final String clientUri) {
         return new MongoClientURI(clientUri);
     }
+
+    private MongoClientURI buildMongoClientURI(final String clientUri, final MongoClientOptions clientOptions) {
+        final MongoClientOptions.Builder builder = new MongoClientOptions.Builder(clientOptions);
+        return new MongoClientURI(clientUri, builder);
+    }
 }",0
Fixed GoogleUniversalAnalyticsProcessor adding order items to javascript output 3.0.x,"         }
         sb.append(""});"");
         
-        getItemJs(order, trackerPrefix);
+        sb.append(getItemJs(order, trackerPrefix));
         
         sb.append(""ga('"" + trackerPrefix + ""ecommerce:send');"");
         return sb.toString();",0
Fixes #2255,"         out.writeUTF(name);
         out.writeInt(getItemQueue().size());
         for (QueueItem item : getItemQueue()) {
-            item.writeData(out);
+            out.writeObject(item);
         }
         out.writeInt(txMap.size());
         for (TxQueueItem item : txMap.values()) {
@@ -699,8 +699,7 @@
         name = in.readUTF();
         int size = in.readInt();
         for (int j = 0; j < size; j++) {
-            QueueItem item = new QueueItem(this, -1, null);
-            item.readData(in);
+            QueueItem item = in.readObject();
             getItemQueue().offer(item);
             setId(item.getItemId());
         }",0
[pulsar-broker] fix ClassCastException at ZkIsolatedBookieEnsemblePlacementPolicy,"                 if (!clientIsolationZkCache.compareAndSet(null, zkc)) {
                     zkc.stop();
                 }
-                bkConf.setProperty(ZooKeeperCache.ZK_CACHE_INSTANCE, this.clientIsolationZkCache);
+                bkConf.setProperty(ZooKeeperCache.ZK_CACHE_INSTANCE, this.clientIsolationZkCache.get());
             }
         }
 ",0
Fix typos," 
   /**
    * @return the type for channel
-   * @param domain wether to create a unix domain channel or a socket channel
+   * @param domain whether to create a unix domain channel or a socket channel
    */
   public Class<? extends Channel> channelType(boolean domain) {
     if (domain) {
@@ -165,7 +165,7 @@
 
   /**
    * @return the type for server channel
-   * @param domain wether to create a server unix domain channel or a regular server socket channel
+   * @param domain whether to create a server unix domain channel or a regular server socket channel
    */
   public Class<? extends ServerChannel> serverChannelType(boolean domain) {
     if (domain) {",0
Memory leak fix in the subscribers cache,"               } else {
                 sids = new ChoosableSet<>(0);
               }
+              //SBKD-322 Quick fix for memory leak that has been caused by adding to subscribers cache
+              //empty sets. When no subscribers are present just omit caching it.
+              if (!sids.isEmpty()) {
               ChoosableSet<V> prev = cache.putIfAbsent(k, sids);
               if (prev != null) {
                 // Merge them
                 prev.merge(sids);
                 sids = prev;
               }
+              }
               sids.setInitialised();
               sresult.setResult(sids);
             } else {",0
Add missing payment type to payment request DTO," 
         //Will set the full amount to be charged on the transaction total/subtotal and not worry about shipping/tax breakdown
         PaymentRequestDTO requestDTO = new PaymentRequestDTO()
+                .paymentType(paymentTransaction.getOrderPayment().getType())
                 .transactionTotal(transactionAmount.getAmount().toPlainString())
                 .orderSubtotal(transactionAmount.getAmount().toPlainString())
                 .shippingTotal(ZERO_TOTAL)",0
Fix #372: JsonParserSequence overrides skipChildren(),"         return t;
     }
 
+    /**
+     * Need to override, re-implement similar to how method defined in
+     * {@link com.fasterxml.jackson.core.base.ParserMinimalBase}, to keep
+     * state correct here.
+     */
+    @Override
+    public JsonParser skipChildren() throws IOException
+    {
+        if ((delegate.currentToken() != JsonToken.START_OBJECT)
+            && (delegate.currentToken() != JsonToken.START_ARRAY)) {
+            return this;
+        }
+        int open = 1;
+
+        // Since proper matching of start/end markers is handled
+        // by nextToken(), we'll just count nesting levels here
+        while (true) {
+            JsonToken t = nextToken();
+            if (t == null) { // not ideal but for now, just return
+                return this;
+            }
+            if (t.isStructStart()) {
+                ++open;
+            } else if (t.isStructEnd()) {
+                if (--open == 0) {
+                    return this;
+                }
+            }
+        }
+    }
+
     /*
     /*******************************************************
     /* Additional extended API",0
"Fix when quick click button twice time,the animation view are not clear","         } else {
             this.currentRadius2 = maxInnerDotsRadius;
         }
-
-        if (currentProgress < 0.2) {
+        if (currentProgress == 0) {
+            this.currentDotSize2 = 0;
+        } else if (currentProgress < 0.2) {
             this.currentDotSize2 = maxDotSize;
         } else if (currentProgress < 0.5) {
             this.currentDotSize2 = (float) Utils.mapValueFromRangeToRange(currentProgress, 0.2f, 0.5f, maxDotSize, 0.3 * maxDotSize);
@@ -138,8 +139,9 @@
         } else {
             this.currentRadius1 = (float) Utils.mapValueFromRangeToRange(currentProgress, 0.3f, 1f, 0.8f * maxOuterDotsRadius, maxOuterDotsRadius);
         }
-
-        if (currentProgress < 0.7) {
+        if (currentProgress == 0) {
+            this.currentDotSize1 = 0;
+        } else if (currentProgress < 0.7) {
             this.currentDotSize1 = maxDotSize;
         } else {
             this.currentDotSize1 = (float) Utils.mapValueFromRangeToRange(currentProgress, 0.7f, 1f, maxDotSize, 0);",0
Fix Wi-Fi Direct results showing up when disabled,"     }
     mUrlDeviceDiscoverers.add(new SsdpUrlDeviceDiscoverer(this));
     mUrlDeviceDiscoverers.add(new BleUrlDeviceDiscoverer(this));
-    mUrlDeviceDiscoverers.add(new WifiUrlDeviceDiscoverer(this));
     for (UrlDeviceDiscoverer urlDeviceDiscoverer : mUrlDeviceDiscoverers) {
       urlDeviceDiscoverer.setCallback(this);
     }",0
CubeMapTexture update texture bug fix.,"             if(mHasCompressedTextures) {
                 for (int i = 0; i < 6; i++) {
                     ACompressedTexture tex = mCompressedTextures[i];
+                    tex.add();
                     int w = tex.getWidth(), h = tex.getHeight();
                     for (int j = 0; j < tex.getByteBuffers().length; j++) {
                         GLES20.glCompressedTexSubImage2D(CUBE_FACES[i], j, 0, 0, w, h, tex.getCompressionFormat(),",0
"order by ,group by 别名/字段的bug"," import com.alibaba.druid.sql.ast.SQLOrderingSpecification;
 import com.alibaba.druid.sql.ast.SQLStatement;
 import com.alibaba.druid.sql.ast.expr.SQLAggregateExpr;
+import com.alibaba.druid.sql.ast.expr.SQLAllColumnExpr;
+import com.alibaba.druid.sql.ast.expr.SQLIdentifierExpr;
 import com.alibaba.druid.sql.ast.expr.SQLIntegerExpr;
+import com.alibaba.druid.sql.ast.expr.SQLMethodInvokeExpr;
+import com.alibaba.druid.sql.ast.expr.SQLPropertyExpr;
 import com.alibaba.druid.sql.ast.statement.SQLSelectItem;
 import com.alibaba.druid.sql.ast.statement.SQLSelectOrderByItem;
 import com.alibaba.druid.sql.ast.statement.SQLSelectQuery;
@@ -39,6 +43,8 @@
 		if(sqlSelectQuery instanceof MySqlSelectQueryBlock) {
 			MySqlSelectQueryBlock mysqlSelectQuery = (MySqlSelectQueryBlock)selectStmt.getSelect().getQuery();
 
+			Map<String, String> aliaColumns = new HashMap<String, String>();//sohudo 2015-2-5 解决了下面这个坑
+			//以下注释的代码没准以后有用，rrs.setMergeCols(aggrColumns);目前就是个坑，设置了反而报错，得不到正确结果
 			//setHasAggrColumn ,such as count(*)
 			Map<String, Integer> aggrColumns = new HashMap<String, Integer>();
 			for(SQLSelectItem item : mysqlSelectQuery.getSelectList()) {
@@ -52,6 +58,16 @@
 					}
 					rrs.setHasAggrColumn(true);
 				}
+				else{
+					if (!(item.getExpr() instanceof SQLAllColumnExpr)) {
+						String alia=item.getAlias();
+						String field=getFieldName(item);
+						if (alia==null){
+						  alia=field;	
+						}
+					    aliaColumns.put(field,alia);				
+					}
+				}
 
 			}
 			if(aggrColumns.size() > 0) {
@@ -61,14 +77,14 @@
 			//setGroupByCols
 			if(mysqlSelectQuery.getGroupBy() != null) {
 				List<SQLExpr> groupByItems = mysqlSelectQuery.getGroupBy().getItems();
-				String[] groupByCols = buildGroupByCols(groupByItems);
+				String[] groupByCols = buildGroupByCols(groupByItems,aliaColumns);
 				rrs.setGroupByCols(groupByCols);
 			}
 			
 			//setOrderByCols
 			if(mysqlSelectQuery.getOrderBy() != null) {
 				List<SQLSelectOrderByItem> orderByItems = mysqlSelectQuery.getOrderBy().getItems();
-				rrs.setOrderByCols(buildOrderByCols(orderByItems));
+				rrs.setOrderByCols(buildOrderByCols(orderByItems,aliaColumns));
 			}
 
 			//更改canRunInReadDB属性
@@ -83,7 +99,14 @@
 //			System.out.println();
 		}
 	}
-	
+	private String getFieldName(SQLSelectItem item){
+		if ((item.getExpr() instanceof SQLPropertyExpr)||(item.getExpr() instanceof SQLMethodInvokeExpr)
+				|| (item.getExpr() instanceof SQLIdentifierExpr)) {			
+			return item.getExpr().toString();//字段别名
+		}
+		else
+		  return item.toString();
+	}
 	/**
 	 * 改写sql：需要加limit的加上
 	 */
@@ -239,27 +262,49 @@
 		}
 		
 	}
+	private String getAliaColumn(Map<String, String> aliaColumns,String column ){
+		String alia=aliaColumns.get(column);
+		if (alia==null){
+			return column;
+		}
+		else {
+			return alia;
+		}
+	}
 	
-	private String[] buildGroupByCols(List<SQLExpr> groupByItems) {
+	private String[] buildGroupByCols(List<SQLExpr> groupByItems,Map<String, String> aliaColumns) {
 		String[] groupByCols = new String[groupByItems.size()]; 
 		for(int i= 0; i < groupByItems.size(); i++) {
-			SQLName expr = (SQLName) ((MySqlSelectGroupByExpr)groupByItems.get(i)).getExpr();
-			String column = removeBackquote(expr.getSimpleName().toUpperCase());
-			groupByCols[i] = column;
+			SQLExpr expr = ((MySqlSelectGroupByExpr)groupByItems.get(i)).getExpr();			
+			String column; 
+			if (expr instanceof SQLName) {
+				column= removeBackquote(((SQLName)expr).getSimpleName());//不要转大写 2015-2-10 sohudo removeBackquote(expr.getSimpleName().toUpperCase());
+			}
+			else {
+				column= removeBackquote(expr.toString());
+			}
+			groupByCols[i] = getAliaColumn(aliaColumns,column);//column;
 		}
 		return groupByCols;
 	}
 	
-	private LinkedHashMap<String, Integer> buildOrderByCols(List<SQLSelectOrderByItem> orderByItems) {
+	private LinkedHashMap<String, Integer> buildOrderByCols(List<SQLSelectOrderByItem> orderByItems,Map<String, String> aliaColumns) {
 		LinkedHashMap<String, Integer> map = new LinkedHashMap<String, Integer>();
 		for(int i= 0; i < orderByItems.size(); i++) {
 			SQLOrderingSpecification type = orderByItems.get(i).getType();
             //orderColumn只记录字段名称,因为返回的结果集是不带表名的。
-			SQLName expr = (SQLName) orderByItems.get(i).getExpr();
-			String col = expr.getSimpleName();
+			SQLExpr expr =  orderByItems.get(i).getExpr();
+			String col;
+			if (expr instanceof SQLName) {
+			   col = ((SQLName)expr).getSimpleName();
+			}
+			else {
+				col =expr.toString();
+			}
 			if(type == null) {
 				type = SQLOrderingSpecification.ASC;
 			}
+			col=getAliaColumn(aliaColumns,col);
 			map.put(col, type == SQLOrderingSpecification.ASC ? OrderCol.COL_ORDER_TYPE_ASC : OrderCol.COL_ORDER_TYPE_DESC);
 		}
 		return map;",0
修复使用mycat自增序列插入时values中包含函数bug,"         String valueStr = origSQL.substring(valuesIndex + 6);// 6 values 长度为6
         String preStr = origSQL.substring(0, valuesIndex );// 6 values 长度为6
         int pos = 0 ;
-        int flag  = -1;
+        int flag  = 4;
         int len = valueStr.length();
         StringBuilder currentValue = new StringBuilder();
 //        int colNum = 2; //
         char c ;
         List<String> curList = new ArrayList<>();
+		int parenCount = 0;
         for( ;pos < len; pos ++) {
             c = valueStr.charAt(pos);
             if(flag == 1  || flag == 2) {
@@ -804,12 +805,25 @@
                 currentValue.append(c);
                 flag = 2;
             } else if (c == '(') {
+            	if (flag == 4) {
                 curList = new ArrayList<>();
                 flag = 0;
+				} else {
+					currentValue.append(c);
+					flag = 6;
+					parenCount++;
+				}
             } else if(flag == 4 ) {
-                if(c == ',') {
-                    flag = 0;
                     continue;
+			} else if (flag == 6) {
+				currentValue.append(c);
+				if (c == '(') {
+					parenCount++;
+				} else if (c == ')') {
+					parenCount--;
+				}
+				if (parenCount == 0) {
+					flag = 0;
                 }
             } else if(c == ',') {
 //                System.out.println(currentValue);",0
Fixes drag-scroll regions," import java.lang.StringBuilder;
 
 import android.content.Context;
-import android.content.res.Resources;
 import android.content.res.TypedArray;
-import android.database.DataSetObservable;
-import android.database.DataSetObserver;
-import android.graphics.Canvas;
 import android.graphics.Bitmap;
 import android.graphics.PixelFormat;
 import android.graphics.Rect;
@@ -54,14 +50,11 @@
 import android.widget.BaseAdapter;
 import android.widget.HeaderViewListAdapter;
 import android.widget.ImageView;
-import android.widget.LinearLayout;
 import android.widget.RelativeLayout;
 import android.widget.ListAdapter;
 import android.widget.ListView;
 import android.widget.AbsListView;
 
-import android.os.Debug;
-
 
 /**
  * ListView subclass that mediates drag and drop resorting of items.
@@ -269,7 +262,7 @@
 
       } else {
         AbsListView.LayoutParams params =
-          new AbsListView.LayoutParams(ViewGroup.LayoutParams.FILL_PARENT,
+          new AbsListView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT,
             ViewGroup.LayoutParams.WRAP_CONTENT);
         v = new RelativeLayout(getContext());
         v.setLayoutParams(params);
@@ -976,6 +969,10 @@
 		}
 		if ((mDragListener != null || mDropListener != null) && mFloatView != null) {
 			int action = ev.getAction(); 
+
+			final int x = (int) ev.getX();
+			final int y = (int) ev.getY();
+
 			switch (action & MotionEvent.ACTION_MASK) {
 			case MotionEvent.ACTION_UP:
 			case MotionEvent.ACTION_CANCEL:
@@ -995,8 +992,6 @@
 				//doExpansion();
 				break;
 			case MotionEvent.ACTION_MOVE:
-				int x = (int) ev.getX();
-				int y = (int) ev.getY();
 				
 				// make src item invisible on first move away from pickup
 				// point. Reduces flicker.
@@ -1032,40 +1027,42 @@
 					}
 				}
 				
-        //Log.d(""mobeta"", ""down scroll start=""+mDownScrollStartY);
-        //Log.d(""mobeta"", ""up scroll start=""+mUpScrollStartY);
-				// start or stop drag scrolling
-				if (y > mDownScrollStartY) {
+				// get the current scroll direction
+				int currentScrollDir = mDragScroller.getScrollDir();
 
-					if (mLastY <= mDownScrollStartY) {
-						if (mDragScroller.isScrolling()) {
+				if (y > mLastY && y > mDownScrollStartY && currentScrollDir != DragScroller.DOWN) {
+					// dragged down, it is below the down scroll start and it is not scrolling up
+
+					if (currentScrollDir != DragScroller.STOP) {
 							// moved directly from upscroll to down scroll
 							mDragScroller.stopScrolling(true);
 						}
-						//Log.d(""mobeta"", ""start drag scrolling down"");
-						// just entered lower drag-scroll region
-						mLastY = y;
+
+					// start scrolling down
 						mDragScroller.startScrolling(DragScroller.DOWN);
 					}
-				} else if (y < mUpScrollStartY) {
-					if (mLastY >= mUpScrollStartY) {
-						// just entered upper drag-scroll region
-						if (mDragScroller.isScrolling()) {
-							// moved directly from down-scroll to up-scroll
+				else if (y < mLastY && y < mUpScrollStartY && currentScrollDir != DragScroller.UP) {
+					// dragged up, it is above the up scroll start and it is not scrolling up
+
+					if (currentScrollDir != DragScroller.STOP) {
+						// moved directly from down scroll to up scroll
 							mDragScroller.stopScrolling(true);
 						}
-						mLastY = y;
+
+					// start scrolling up
 						mDragScroller.startScrolling(DragScroller.UP);
 					}
-				} else if (mLastY > mDownScrollStartY || mLastY < mUpScrollStartY) {
-					//mDragScroller.stopScrolling(false);
+				else if (y >= mUpScrollStartY && y <= mDownScrollStartY && mDragScroller.isScrolling()) {
+					// not in the upper nor in the lower drag-scroll regions but it is still scrolling
+
 					mDragScroller.stopScrolling(true);
 				}
+				break;
+			}
 				
 				mLastX = x;
 				mLastY = y;
-				break;
-			}
+
 			return true;
 		}
 		return super.onTouchEvent(ev);
@@ -1297,6 +1294,7 @@
 		private long tStart;
 		private int scrollDir;
 		
+		public final static int STOP = -1;
 		public final static int UP = 0;
 		public final static int DOWN = 1;
 		
@@ -1313,6 +1311,10 @@
 			return mScrolling;
 		}
 
+		public int getScrollDir() {
+			return mScrolling ? scrollDir : STOP;
+		}
+
 		public DragScroller() {
 			if (mTrackDragScroll) {
 				Log.d(""mobeta"", ""state tracker created"");",0
Memory Leak fix in Slider," package com.gc.materialdesign.views;
 
-import com.gc.materialdesign.R;
-import com.gc.materialdesign.utils.Utils;
-import com.nineoldandroids.view.ViewHelper;
-
 import android.app.Dialog;
 import android.content.Context;
 import android.graphics.Bitmap;
@@ -23,71 +19,75 @@
 import android.widget.RelativeLayout;
 import android.widget.TextView;
 
+import com.gc.materialdesign.R;
+import com.gc.materialdesign.utils.Utils;
+import com.nineoldandroids.view.ViewHelper;
+
 public class Slider extends CustomView {
 
-	// Event when slider change value
-	public interface OnValueChangedListener {
-		public void onValueChanged(int value);
-	}
-
-	int backgroundColor = Color.parseColor(""#4CAF50"");
-
-	Ball ball;
-	NumberIndicator numberIndicator;
-
-	boolean showNumberIndicator = false;
-	boolean press = false;
-
-	int value = 0;
-	int max = 100;
-	int min = 0;
-
-	OnValueChangedListener onValueChangedListener;
+    private int backgroundColor = Color.parseColor(""#4CAF50"");
+    private Ball   ball;
+    private Bitmap bitmap;
+    private int max = 100;
+    private int min = 0;
+    private NumberIndicator        numberIndicator;
+    private OnValueChangedListener onValueChangedListener;
+    private boolean placedBall          = false;
+    private boolean press               = false;
+    private boolean showNumberIndicator = false;
+    private int     value               = 0;
 
 	public Slider(Context context, AttributeSet attrs) {
 		super(context, attrs);
 		setAttributes(attrs);
 	}
 
-	// Set atributtes of XML to View
-	protected void setAttributes(AttributeSet attrs) {
-
-		setBackgroundResource(R.drawable.background_transparent);
-
-		// Set size of view
-		setMinimumHeight(Utils.dpToPx(48, getResources()));
-		setMinimumWidth(Utils.dpToPx(80, getResources()));
-
-		// Set background Color
-		// Color by resource
-		int bacgroundColor = attrs.getAttributeResourceValue(ANDROIDXML,
-				""background"", -1);
-		if (bacgroundColor != -1) {
-			setBackgroundColor(getResources().getColor(bacgroundColor));
-		} else {
-			// Color by hexadecimal
-			int background = attrs.getAttributeIntValue(ANDROIDXML, ""background"", -1);
-			if (background != -1)
-				setBackgroundColor(background);
+    public int getMax() {
+        return max;
 		}
 
-		showNumberIndicator = attrs.getAttributeBooleanValue(MATERIALDESIGNXML,
-				""showNumberIndicator"", false);
-		min = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""min"", 0);
-		max = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""max"", 0);
-		value = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""value"", min);
+    public void setMax(int max) {
+        this.max = max;
+    }
 
-		ball = new Ball(getContext());
-		RelativeLayout.LayoutParams params = new LayoutParams(Utils.dpToPx(20,
-				getResources()), Utils.dpToPx(20, getResources()));
-		params.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);
-		ball.setLayoutParams(params);
-		addView(ball);
+    public int getMin() {
+        return min;
+    }
 
-		// Set if slider content number indicator
-		// TODO
-		if (showNumberIndicator) {
-			numberIndicator = new NumberIndicator(getContext());
+    public void setMin(int min) {
+        this.min = min;
+    }
+
+    public OnValueChangedListener getOnValueChangedListener() {
+        return onValueChangedListener;
+    }
+
+    public void setOnValueChangedListener(
+            OnValueChangedListener onValueChangedListener) {
+        this.onValueChangedListener = onValueChangedListener;
+    }
+
+    // GETERS & SETTERS
+
+    public int getValue() {
+        return value;
+    }
+
+    public void setValue(final int value) {
+        if (placedBall == false)
+            post(new Runnable() {
+
+                @Override
+                public void run() {
+                    setValue(value);
+                }
+            });
+        else {
+            this.value = value;
+            float division = (ball.xFin - ball.xIni) / max;
+            ViewHelper.setX(ball,
+                    value * division + getHeight() / 2 - ball.getWidth() / 2);
+            ball.changeBackground();
 		}
 
 	}
@@ -98,55 +98,14 @@
 		super.invalidate();
 	}
 
-	@Override
-	protected void onDraw(Canvas canvas) {
-		super.onDraw(canvas);
-		if (!placedBall)
-			placeBall();
-
-		if (value == min) {
-			// Crop line to transparent effect
-			Bitmap bitmap = Bitmap.createBitmap(canvas.getWidth(),
-					canvas.getHeight(), Bitmap.Config.ARGB_8888);
-			Canvas temp = new Canvas(bitmap);
-			Paint paint = new Paint();
-			paint.setColor(Color.parseColor(""#B0B0B0""));
-			paint.setStrokeWidth(Utils.dpToPx(2, getResources()));
-			temp.drawLine(getHeight() / 2, getHeight() / 2, getWidth()
-					- getHeight() / 2, getHeight() / 2, paint);
-			Paint transparentPaint = new Paint();
-			transparentPaint.setColor(getResources().getColor(
-					android.R.color.transparent));
-			transparentPaint.setXfermode(new PorterDuffXfermode(
-					PorterDuff.Mode.CLEAR));
-			temp.drawCircle(ViewHelper.getX(ball) + ball.getWidth() / 2,
-					ViewHelper.getY(ball) + ball.getHeight() / 2,
-					ball.getWidth() / 2, transparentPaint);
-
-			canvas.drawBitmap(bitmap, 0, 0, new Paint());
-		} else {
-			Paint paint = new Paint();
-			paint.setColor(Color.parseColor(""#B0B0B0""));
-			paint.setStrokeWidth(Utils.dpToPx(2, getResources()));
-			canvas.drawLine(getHeight() / 2, getHeight() / 2, getWidth()
-					- getHeight() / 2, getHeight() / 2, paint);
-			paint.setColor(backgroundColor);
-			float division = (ball.xFin - ball.xIni) / (max-min);
-			int value = this.value - min;
-			canvas.drawLine(getHeight() / 2, getHeight() / 2, value * division
-					+ getHeight() / 2, getHeight() / 2, paint);
-
+    public boolean isShowNumberIndicator() {
+        return showNumberIndicator;
 		}
 
-		if (press && !showNumberIndicator) {
-			Paint paint = new Paint();
-			paint.setColor(backgroundColor);
-			paint.setAntiAlias(true);
-			canvas.drawCircle(ViewHelper.getX(ball) + ball.getWidth() / 2,
-					getHeight() / 2, getHeight() / 3, paint);
-		}
-		invalidate();
-
+    public void setShowNumberIndicator(boolean showNumberIndicator) {
+        this.showNumberIndicator = showNumberIndicator;
+        numberIndicator = (showNumberIndicator) ? new NumberIndicator(
+                getContext()) : null;
 	}
 
 	@Override
@@ -211,6 +170,13 @@
 		return true;
 	}
 
+    @Override
+    public void setBackgroundColor(int color) {
+        backgroundColor = color;
+        if (isEnabled())
+            beforeBackground = backgroundColor;
+    }
+
 	/**
 	 * Make a dark color to press effect
 	 * 
@@ -226,6 +192,105 @@
 		return Color.argb(70, r, g, b);
 	}
 
+    @Override
+    protected void onDraw(Canvas canvas) {
+        super.onDraw(canvas);
+
+        if (!placedBall) {
+            placeBall();
+        }
+
+        Paint paint = new Paint();
+
+        if (value == min) {
+            // Crop line to transparent effect
+
+            if (bitmap == null) {
+                bitmap = Bitmap.createBitmap(canvas.getWidth(),
+                        canvas.getHeight(), Bitmap.Config.ARGB_8888);
+            }
+            Canvas temp = new Canvas(bitmap);
+            paint.setColor(Color.parseColor(""#B0B0B0""));
+            paint.setStrokeWidth(Utils.dpToPx(2, getResources()));
+            temp.drawLine(getHeight() / 2, getHeight() / 2, getWidth()
+                    - getHeight() / 2, getHeight() / 2, paint);
+            Paint transparentPaint = new Paint();
+            transparentPaint.setColor(getResources().getColor(
+                    android.R.color.transparent));
+            transparentPaint.setXfermode(new PorterDuffXfermode(
+                    PorterDuff.Mode.CLEAR));
+            temp.drawCircle(ViewHelper.getX(ball) + ball.getWidth() / 2,
+                    ViewHelper.getY(ball) + ball.getHeight() / 2,
+                    ball.getWidth() / 2, transparentPaint);
+
+            canvas.drawBitmap(bitmap, 0, 0, new Paint());
+        } else {
+
+            paint.setColor(Color.parseColor(""#B0B0B0""));
+            paint.setStrokeWidth(Utils.dpToPx(2, getResources()));
+            canvas.drawLine(getHeight() / 2, getHeight() / 2, getWidth()
+                    - getHeight() / 2, getHeight() / 2, paint);
+            paint.setColor(backgroundColor);
+            float division = (ball.xFin - ball.xIni) / (max - min);
+            int value = this.value - min;
+
+            canvas.drawLine(getHeight() / 2, getHeight() / 2, value * division
+                    + getHeight() / 2, getHeight() / 2, paint);
+
+        }
+
+        if (press && !showNumberIndicator) {
+            paint.setColor(backgroundColor);
+            paint.setAntiAlias(true);
+            canvas.drawCircle(ViewHelper.getX(ball) + ball.getWidth() / 2,
+                    getHeight() / 2, getHeight() / 3, paint);
+        }
+        invalidate();
+    }
+
+    // Set atributtes of XML to View
+    protected void setAttributes(AttributeSet attrs) {
+
+        setBackgroundResource(R.drawable.background_transparent);
+
+        // Set size of view
+        setMinimumHeight(Utils.dpToPx(48, getResources()));
+        setMinimumWidth(Utils.dpToPx(80, getResources()));
+
+        // Set background Color
+        // Color by resource
+        int bacgroundColor = attrs.getAttributeResourceValue(ANDROIDXML,
+                ""background"", -1);
+        if (bacgroundColor != -1) {
+            setBackgroundColor(getResources().getColor(bacgroundColor));
+        } else {
+            // Color by hexadecimal
+            int background = attrs.getAttributeIntValue(ANDROIDXML, ""background"", -1);
+            if (background != -1)
+                setBackgroundColor(background);
+        }
+
+        showNumberIndicator = attrs.getAttributeBooleanValue(MATERIALDESIGNXML,
+                ""showNumberIndicator"", false);
+        min = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""min"", 0);
+        max = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""max"", 0);
+        value = attrs.getAttributeIntValue(MATERIALDESIGNXML, ""value"", min);
+
+        ball = new Ball(getContext());
+        RelativeLayout.LayoutParams params = new LayoutParams(Utils.dpToPx(20,
+                getResources()), Utils.dpToPx(20, getResources()));
+        params.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);
+        ball.setLayoutParams(params);
+        addView(ball);
+
+        // Set if slider content number indicator
+        // TODO
+        if (showNumberIndicator) {
+            numberIndicator = new NumberIndicator(getContext());
+        }
+
+    }
+
 	private void placeBall() {
 		ViewHelper.setX(ball, getHeight() / 2 - ball.getWidth() / 2);
 		ball.xIni = ViewHelper.getX(ball);
@@ -234,75 +299,11 @@
 		placedBall = true;
 	}
 
-	// GETERS & SETTERS
-
-	public OnValueChangedListener getOnValueChangedListener() {
-		return onValueChangedListener;
+    // Event when slider change value
+    public interface OnValueChangedListener {
+        public void onValueChanged(int value);
 	}
 
-	public void setOnValueChangedListener(
-			OnValueChangedListener onValueChangedListener) {
-		this.onValueChangedListener = onValueChangedListener;
-	}
-
-	public int getValue() {
-		return value;
-	}
-
-	public void setValue(final int value) {
-		if (placedBall == false)
-			post(new Runnable() {
-
-				@Override
-				public void run() {
-					setValue(value);
-				}
-			});
-		else {
-			this.value = value;
-			float division = (ball.xFin - ball.xIni) / max;
-			ViewHelper.setX(ball,
-					value * division + getHeight() / 2 - ball.getWidth() / 2);
-			ball.changeBackground();
-		}
-
-	}
-
-	public int getMax() {
-		return max;
-	}
-
-	public void setMax(int max) {
-		this.max = max;
-	}
-
-	public int getMin() {
-		return min;
-	}
-
-	public void setMin(int min) {
-		this.min = min;
-	}
-
-	public boolean isShowNumberIndicator() {
-		return showNumberIndicator;
-	}
-
-	public void setShowNumberIndicator(boolean showNumberIndicator) {
-		this.showNumberIndicator = showNumberIndicator;
-		numberIndicator = (showNumberIndicator) ? new NumberIndicator(
-				getContext()) : null;
-	}
-
-	@Override
-	public void setBackgroundColor(int color) {
-		backgroundColor = color;
-		if (isEnabled())
-			beforeBackground = backgroundColor;
-	}
-
-	boolean placedBall = false;
-
 	class Ball extends View {
 
 		float xIni, xFin, xCen;
@@ -328,67 +329,19 @@
 
 	// Slider Number Indicator
 
-	class NumberIndicator extends Dialog {
-
-		Indicator indicator;
-		TextView numberIndicator;
-
-		public NumberIndicator(Context context) {
-			super(context, android.R.style.Theme_Translucent);
-		}
-
-		@Override
-		protected void onCreate(Bundle savedInstanceState) {
-			requestWindowFeature(Window.FEATURE_NO_TITLE);
-			super.onCreate(savedInstanceState);
-			setContentView(R.layout.number_indicator_spinner);
-			setCanceledOnTouchOutside(false);
-
-			RelativeLayout content = (RelativeLayout) this
-					.findViewById(R.id.number_indicator_spinner_content);
-			indicator = new Indicator(this.getContext());
-			content.addView(indicator);
-
-			numberIndicator = new TextView(getContext());
-			numberIndicator.setTextColor(Color.WHITE);
-			numberIndicator.setGravity(Gravity.CENTER);
-			content.addView(numberIndicator);
-
-			indicator.setLayoutParams(new RelativeLayout.LayoutParams(
-					RelativeLayout.LayoutParams.FILL_PARENT,
-					RelativeLayout.LayoutParams.FILL_PARENT));
-		}
-
-		@Override
-		public void dismiss() {
-			super.dismiss();
-			indicator.y = 0;
-			indicator.size = 0;
-			indicator.animate = true;
-		}
-
-		@Override
-		public void onBackPressed() {
-		}
-
-	}
-
 	class Indicator extends RelativeLayout {
 
+        boolean animate               = true;
+        // Final size after animation
+        float   finalSize             = 0;
+        // Final y position after animation
+        float   finalY                = 0;
+        boolean numberIndicatorResize = false;
+        // Size of number indicator
+        float   size                  = 0;
 		// Position of number indicator
 		float x = 0;
 		float y = 0;
-		// Size of number indicator
-		float size = 0;
-
-		// Final y position after animation
-		float finalY = 0;
-		// Final size after animation
-		float finalSize = 0;
-
-		boolean animate = true;
-
-		boolean numberIndicatorResize = false;
 
 		public Indicator(Context context) {
 			super(context);
@@ -439,4 +392,49 @@
 
 	}
 
+    class NumberIndicator extends Dialog {
+
+        Indicator indicator;
+        TextView  numberIndicator;
+
+        public NumberIndicator(Context context) {
+            super(context, android.R.style.Theme_Translucent);
+        }
+
+        @Override
+        public void dismiss() {
+            super.dismiss();
+            indicator.y = 0;
+            indicator.size = 0;
+            indicator.animate = true;
+        }
+
+        @Override
+        public void onBackPressed() {
+        }
+
+        @Override
+        protected void onCreate(Bundle savedInstanceState) {
+            requestWindowFeature(Window.FEATURE_NO_TITLE);
+            super.onCreate(savedInstanceState);
+            setContentView(R.layout.number_indicator_spinner);
+            setCanceledOnTouchOutside(false);
+
+            RelativeLayout content = (RelativeLayout) this
+                    .findViewById(R.id.number_indicator_spinner_content);
+            indicator = new Indicator(this.getContext());
+            content.addView(indicator);
+
+            numberIndicator = new TextView(getContext());
+            numberIndicator.setTextColor(Color.WHITE);
+            numberIndicator.setGravity(Gravity.CENTER);
+            content.addView(numberIndicator);
+
+            indicator.setLayoutParams(new RelativeLayout.LayoutParams(
+                    RelativeLayout.LayoutParams.FILL_PARENT,
+                    RelativeLayout.LayoutParams.FILL_PARENT));
+        }
+
+    }
+
 }",0
fix issue #2755,"             }
             WidgetInfo target = contentLookup.get(id);
             if (target != null) {
+                try {
                 Rect2i region = getRegion(target, canvas);
                 loopDetectionId = """";
                 return region;
+                } catch (StackOverflowError e){
+                    logger.error(""Stack Overflow detected resolving layout of element {}, unable to render"", loopDetectionId);
+                }
             }
         }
         loopDetectionId = """";",0
Overrode default Hibernate naming strategies,"     protected String blPUHibernateHbm2ddlImport_files;
     @Value(""${blPU.hibernate.hbm2ddl.import_files_sql_extractor}"")
     protected String blPUHibernateHbm2ddlImport_files_sql_extractor;
+    @Value(""${blPU.hibernate.implicit_naming_strategy}"")
+    protected String blPUHibernateNamingImplicitStrategy;
+    @Value(""${blPU.hibernate.physical_naming_strategy}"")
+    protected String blPUHibernateNamingPhysicalStrategy;
 
     @Value(""${blCMSStorage.hibernate.hbm2ddl.auto}"")
     protected String blCMSStorageHibernateHbm2ddlAuto;
@@ -108,6 +112,10 @@
     protected String blCMSStorageHibernateHbm2ddlImport_files;
     @Value(""${blCMSStorage.hibernate.hbm2ddl.import_files_sql_extractor}"")
     protected String blCMSStorageHibernateHbm2ddlImport_files_sql_extractor;
+    @Value(""${blCMSStorage.hibernate.implicit_naming_strategy}"")
+    protected String blCMSStorageHibernateNamingImplicitStrategy;
+    @Value(""${blCMSStorage.hibernate.physical_naming_strategy}"")
+    protected String blCMSStorageHibernateNamingPhysicalStrategy;
 
     @Value(""${blSecurePU.hibernate.hbm2ddl.auto}"")
     protected String blSecurePUHibernateHbm2ddlAuto;
@@ -123,6 +131,10 @@
     protected String blSecurePUHibernateHbm2ddlImport_files;
     @Value(""${blSecurePU.hibernate.hbm2ddl.import_files_sql_extractor}"")
     protected String blSecurePUHibernateHbm2ddlImport_files_sql_extractor;
+    @Value(""${blSecurePU.hibernate.implicit_naming_strategy}"")
+    protected String blSecurePUHibernateNamingImplicitStrategy;
+    @Value(""${blSecurePU.hibernate.physical_naming_strategy}"")
+    protected String blSecurePUHibernateNamingPhysicalStrategy;
 
     @PostConstruct
     public void populatePresetProperties() {
@@ -151,6 +163,8 @@
             }
         }
         if (!blPUHibernateHbm2ddlImport_files_sql_extractor.startsWith(""${"")) persistenceUnitProperties.put(""blPU.hibernate.hbm2ddl.import_files_sql_extractor"", blPUHibernateHbm2ddlImport_files_sql_extractor);
+        if (!blPUHibernateNamingImplicitStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blPU.hibernate.implicit_naming_strategy"", blPUHibernateNamingImplicitStrategy);
+        if (!blPUHibernateNamingPhysicalStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blPU.hibernate.physical_naming_strategy"", blPUHibernateNamingPhysicalStrategy);
 
         if (!blCMSStorageHibernateHbm2ddlAuto.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.hbm2ddl.auto"", blCMSStorageHibernateHbm2ddlAuto);
         if (!blCMSStorageHibernateDialect.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.dialect"", blCMSStorageHibernateDialect);
@@ -159,6 +173,8 @@
         if (!blCMSStorageHibernateCacheUse_query_cache.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.cache.use_query_cache"", blCMSStorageHibernateCacheUse_query_cache);
         if (!blCMSStorageHibernateHbm2ddlImport_files.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.hbm2ddl.import_files"", blCMSStorageHibernateHbm2ddlImport_files);
         if (!blCMSStorageHibernateHbm2ddlImport_files_sql_extractor.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.hbm2ddl.import_files_sql_extractor"", blCMSStorageHibernateHbm2ddlImport_files_sql_extractor);
+        if (!blCMSStorageHibernateNamingImplicitStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.implicit_naming_strategy"", blCMSStorageHibernateNamingImplicitStrategy);
+        if (!blCMSStorageHibernateNamingPhysicalStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blCMSStorage.hibernate.physical_naming_strategy"", blCMSStorageHibernateNamingPhysicalStrategy);
 
         if (!blSecurePUHibernateHbm2ddlAuto.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.hbm2ddl.auto"", blSecurePUHibernateHbm2ddlAuto);
         if (!blSecurePUHibernateDialect.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.dialect"", blSecurePUHibernateDialect);
@@ -167,6 +183,8 @@
         if (!blSecurePUHibernateCacheUse_query_cache.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.cache.use_query_cache"", blSecurePUHibernateCacheUse_query_cache);
         if (!blSecurePUHibernateHbm2ddlImport_files.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.hbm2ddl.import_files"", blSecurePUHibernateHbm2ddlImport_files);
         if (!blSecurePUHibernateHbm2ddlImport_files_sql_extractor.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.hbm2ddl.import_files_sql_extractor"", blSecurePUHibernateHbm2ddlImport_files_sql_extractor);
+        if (!blSecurePUHibernateNamingImplicitStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.implicit_naming_strategy"", blSecurePUHibernateNamingImplicitStrategy);
+        if (!blSecurePUHibernateNamingPhysicalStrategy.startsWith(""${"")) persistenceUnitProperties.put(""blSecurePU.hibernate.physical_naming_strategy"", blSecurePUHibernateNamingPhysicalStrategy);
 
         persistenceUnitProperties.putAll(overrideProperties);
     }",0
Fix MoveToAction with alignment," 	private int alignment = Align.bottomLeft;
 
 	protected void begin () {
-		startX = target.getX();
-		startY = target.getY();
+		startX = target.getX(alignment);
+		startY = target.getY(alignment);
 	}
 
 	protected void update (float percent) {",0
Fix issue #77,,0
Fixed issue #182 of original project,"             // fallback to use round robin
             if (maxTotalWeight < 0.001d) {
                 server =  super.choose(getLoadBalancer(), key); 
+                if(server == null) {
+                    return server;
+                }
             } else {
                 // generate a random weight between 0 (inclusive) to maxTotalWeight (exclusive)
                 double randomWeight = random.nextDouble() * maxTotalWeight;",0
Fix ExcludedRefs creation.,"     DebuggerControl debuggerControl = new AndroidDebuggerControl();
     AndroidHeapDumper heapDumper = new AndroidHeapDumper();
     heapDumper.cleanup();
-    ExcludedRefs excludedRefs = AndroidExcludedRefs.createAndroidDefaults().build();
+    ExcludedRefs excludedRefs = AndroidExcludedRefs.createAppDefaults().build();
     return new RefWatcher(new AndroidWatchExecutor(), debuggerControl, GcTrigger.DEFAULT,
         heapDumper, heapDumpListener, excludedRefs);
   }",0
Fix StubPendingService: use realIntent to start service," package com.lody.virtual.client.stub;
 
+import com.lody.virtual.client.ipc.VActivityManager;
+
 import android.app.Service;
 import android.content.Intent;
 import android.os.IBinder;
@@ -18,7 +20,13 @@
     @Override
     public int onStartCommand(Intent intent, int flags, int startId) {
         // _VA_|_from_inner_ marked
-        startService(intent);
+        if (intent != null) {
+            Intent realIntent = intent.getParcelableExtra(""_VA_|_intent_"");
+            int userId = intent.getIntExtra(""_VA_|_user_id_"", 0);
+            if (realIntent != null) {
+                VActivityManager.get().startService(null, realIntent, null, userId);
+            }
+        }
         stopSelf();
         return START_NOT_STICKY;
     }",0
Fix typo in readme,"     private NotificationManager mNotificationManager;
 
     @Override
+    public void onCreate() {
+        super.onCreate();
+        mNotificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
+    }
+    
+    @Override
     public void onStart(Intent intent, int startId) {
         super.onStart(intent, startId);
-        mNotificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
     }
 
     @Override",0
createMachineLogsDir fix for issue #366,"     }
 
     private void createMachineLogsDir(String machineId) throws MachineException {
-        if (!new File(machineLogsDir, machineId).mkdirs()) {
+        File dir = new File(machineLogsDir, machineId);
+        if (!dir.exists() && !dir.mkdirs()) {
             throw new MachineException(""Can't create folder for the logs of machine"");
         }
     }",0
Fix IndexOutOfBoundsException when using ANTLR with Java 8 (fixes #337)," import java.util.ArrayList;
 import java.util.LinkedHashMap;
 import java.util.List;
+import java.util.Map;
 
 /** I need the get-element-i functionality so I'm subclassing
  *  LinkedHashMap.
@@ -52,6 +53,13 @@
 	}
 
 	@Override
+	public void putAll(Map<? extends K, ? extends V> m) {
+		for (Map.Entry<? extends K, ? extends V> entry : m.entrySet()) {
+			put(entry.getKey(), entry.getValue());
+		}
+	}
+
+	@Override
 	public V remove(Object key) {
 		throw new UnsupportedOperationException();
 	}",0
Fix a memory leak by properly clearing recorded data about temporary block entities,"         return EntityRef.NULL;
     }
 
+    /**
+     * Creates the entity without sending any events. The entity life cycle subscriber will however be informed.
+     */
     @Override
     public EntityRef createEntityWithoutLifecycleEvents(Iterable<Component> components) {
-        return createEntity(components);
+        EntityRef entity = createEntity(components);
+        for (Component component: components) {
+            notifyComponentAdded(entity, component.getClass());
+        }
+        return entity;
     }
 
+    /**
+     * Creates the entity without sending any events. The entity life cycle subscriber will however be informed.
+     */
     @Override
     public EntityRef createEntityWithoutLifecycleEvents(String prefabName) {
         return createEntityWithoutLifecycleEvents(getPrefabManager().getPrefab(prefabName));
     }
 
+    /**
+     * Creates the entity without sending any events. The entity life cycle subscriber will however be informed.
+     */
     @Override
     public EntityRef createEntityWithoutLifecycleEvents(Prefab prefab) {
         if (prefab != null) {
@@ -405,9 +418,13 @@
         }
     }
 
+    /**
+     * Destroys the entity without sending any events. The entity life cycle subscriber will however be informed.
+     */
     @Override
     public void destroyEntityWithoutEvents(EntityRef entity) {
         if (entity.isActive()) {
+            notifyComponentRemovalAndEntityDestruction(entity.getId(), entity);
             destroy(entity);
         }
     }
@@ -538,13 +555,17 @@
             eventSystem.send(ref, BeforeDeactivateComponent.newInstance());
             eventSystem.send(ref, BeforeRemoveComponent.newInstance());
         }
+        notifyComponentRemovalAndEntityDestruction(entityId, ref);
+        destroy(ref);
+    }
+
+    private void notifyComponentRemovalAndEntityDestruction(long entityId, EntityRef ref) {
         for (Component comp : store.iterateComponents(entityId)) {
             notifyComponentRemoved(ref, comp.getClass());
         }
         for (EntityDestroySubscriber destroySubscriber : destroySubscribers) {
             destroySubscriber.onEntityDestroyed(ref);
         }
-        destroy(ref);
     }
 
     private void destroy(EntityRef ref) {",0
#930 - Fix timestamp issue.," 
 package com.thoughtworks.go.remote.work;
 
-import java.io.File;
-import java.io.IOException;
-import java.net.SocketTimeoutException;
-import java.text.SimpleDateFormat;
-import java.util.Date;
-import java.util.List;
-
 import com.thoughtworks.go.config.ArtifactPropertiesGenerator;
 import com.thoughtworks.go.config.RunIfConfig;
 import com.thoughtworks.go.domain.*;
-import com.thoughtworks.go.domain.GoControlLog;
 import com.thoughtworks.go.domain.materials.MaterialAgentFactory;
 import com.thoughtworks.go.plugin.access.packagematerial.PackageAsRepositoryExtension;
 import com.thoughtworks.go.plugin.access.pluggabletask.TaskExtension;
@@ -36,7 +28,6 @@
 import com.thoughtworks.go.remote.BuildRepositoryRemote;
 import com.thoughtworks.go.server.service.AgentBuildingInfo;
 import com.thoughtworks.go.server.service.AgentRuntimeInfo;
-import com.thoughtworks.go.util.GoConstants;
 import com.thoughtworks.go.util.SystemEnvironment;
 import com.thoughtworks.go.util.TimeProvider;
 import com.thoughtworks.go.util.command.EnvironmentVariableContext;
@@ -48,6 +39,13 @@
 import org.apache.commons.logging.LogFactory;
 import org.jdom.Element;
 
+import java.io.File;
+import java.io.IOException;
+import java.net.SocketTimeoutException;
+import java.text.SimpleDateFormat;
+import java.util.Date;
+import java.util.List;
+
 import static com.thoughtworks.go.util.ExceptionUtils.bomb;
 import static com.thoughtworks.go.util.ExceptionUtils.messageOf;
 import static java.lang.String.format;
@@ -55,8 +53,6 @@
 public class BuildWork implements Work {
     private static final Log LOGGER = LogFactory.getLog(BuildWork.class);
 
-    private final SimpleDateFormat dateFormat = new SimpleDateFormat(""yyyy-MM-dd HH:mm:ss"");
-
     private final BuildAssignment assignment;
 
     private DefaultGoPublisher goPublisher;
@@ -135,7 +131,7 @@
             return null;
         }
 
-        goPublisher.consumeLineWithPrefix(format(""Job Started: %s\n"", dateFormat.format(timeProvider.currentTime())));
+        goPublisher.consumeLineWithPrefix(format(""Job Started: %s\n"", new SimpleDateFormat(""yyyy-MM-dd HH:mm:ss z"").format(timeProvider.currentTime())));
 
         prepareJob(agentIdentifier, packageAsRepositoryExtension, scmExtension);
         setupEnvrionmentContext(environmentVariableContext);",0
Fixed removeAll bug in RedissonSet,"         args.add(getName());
         args.addAll(c);
         
-        return commandExecutor.writeAsync(getName(), codec, RedisCommands.SREM_SINGLE, c.toArray());
+        return commandExecutor.writeAsync(getName(), codec, RedisCommands.SREM_SINGLE, args.toArray());
     }
 
     @Override",0
Fix JERSEY-2938 JAX-RS resource marked as @Stateless EJB JNDI failure,"             final List<String> tempLibNames = new LinkedList<>();
             for (ModuleInfo moduleInfo : appInfo.getModuleInfos()) {
                 final String jarName = moduleInfo.getName();
-                if (jarName.endsWith("".jar"")) {
+                if (jarName.endsWith("".jar"") || jarName.endsWith("".war"")) {
                     final String moduleName = jarName.substring(0, jarName.length() - 4);
                     tempLibNames.add(moduleName);
                     final Object bundleDescriptor = moduleInfo.getMetaData(EjbBundleDescriptorImpl.class.getName());",0
Fix condition for showing header," 				headersShown = true;
 			}
 			IHeader header = getHeaderOf(item);
-			if (header != null && header.equals(sameHeader) && !isExpandable((T) header)) {
+			if (header != null && !header.equals(sameHeader) && !isExpandable((T) header)) {
 				header.setHidden(false);
 				sameHeader = header;
 				newItems.add(position, (T) header);",0
added missing geoCode method and doc fixes,"      *
      * @param location geo location
      * @param radius   radius
-     * @param unit     Query.MILES or Query.KILOMETERS
+     * @param unit     Use ""mi"" for miles or ""km"" for kilometers
      * @deprecated use {@link #setGeoCode(GeoLocation, double, twitter4j.Query.Unit)} instead
      */
     public void setGeoCode(GeoLocation location, double radius
@@ -372,7 +372,22 @@
      * @param radius   radius
      * @param unit     Query.MILES or Query.KILOMETERS
      * @return the instance
+     */
+    public Query geoCode(GeoLocation location, double radius
+            , Unit unit) {
+        setGeoCode(location, radius, unit);
+        return this;
+    }
+
+    /**
+     * returns tweets by users located within a given radius of the given latitude/longitude, where the user's location is taken from their Twitter profile
+     *
+     * @param location geo location
+     * @param radius   radius
+     * @param unit     Use ""mi"" for miles or ""km"" for kilometers
+     * @return the instance
      * @since Twitter4J 2.1.0
+     * @deprecated use {@link #geoCode(GeoLocation, double, twitter4j.Query.Unit)} instead
      */
     public Query geoCode(GeoLocation location, double radius
             , String unit) {",0
Fixed timestamp issue with SQL Server DDL Creation,"     @Column(name = ""APPLIC_CD"")
     private String applicationCode;
 
-    @Column(name = ""AUD_DATE"", nullable = false, columnDefinition = ""TIMESTAMP"")
+    @Column(name = ""AUD_DATE"", nullable = false)
     private ZonedDateTime recordDate;
 
     public AuditTrailEntity() {",0
Fix for android L,"         return;
       }
     }
-    closeUriBeacon();
     try {
       // If we don't sleep here the write works only 20% of the time.
       Thread.sleep(20);",0
Fix #3340. TextField ignores input on mac if command is pressed.," 
 			Stage stage = getStage();
 			if (stage == null || stage.getKeyboardFocus() != TextField.this) return false;
+			
+			if (UIUtils.isMac && Gdx.input.isKeyPressed(Keys.SYM)) return true;
 
 			if ((character == TAB || character == ENTER_ANDROID) && focusTraversal) {
 				next(UIUtils.shift());",0
Null-check equipment container in item stats plugin," import net.runelite.api.Client;
 import net.runelite.api.InventoryID;
 import net.runelite.api.Item;
+import net.runelite.api.ItemContainer;
 import net.runelite.api.MenuEntry;
 import net.runelite.api.widgets.Widget;
 import net.runelite.api.widgets.WidgetInfo;
@@ -186,9 +187,10 @@
 		ItemStats other = null;
 		final ItemEquipmentStats currentEquipment = s.getEquipment();
 
-		if (s.isEquipable() && currentEquipment != null)
+		ItemContainer c = client.getItemContainer(InventoryID.EQUIPMENT);
+		if (s.isEquipable() && currentEquipment != null && c != null)
 		{
-			final Item[] items = client.getItemContainer(InventoryID.EQUIPMENT).getItems();
+			final Item[] items = c.getItems();
 
 			if (currentEquipment.getSlot() != -1 && currentEquipment.getSlot() < items.length)
 			{",0
Fixing binding to dynamic ports,"             server.start();
             System.out.println(""HOST IP "" + System.getenv(STATUS_HOST_IP));
         } catch (Exception e) {
-            System.out.println(""Failed to bind to port "" + port);
-            e.printStackTrace(System.out);
+            System.out.println(""Failed to bind to port "" + port + "". Trying "" + ++port);
             if (logger.isInfoEnabled())
-                logger.info(""Failed to bind to port "" + port);
-            throw new RuntimeException(e.getMessage());
+                logger.info(""Failed to bind to port "" + port + "". Trying "" + ++port);
+            return false;
         }
         // application level service registry. only be used without docker container.
         if (config.enableRegistry) {",0
pop-up player crash fixed,"         Player.EventListener, PlaybackListener, ImageLoadingListener {
 
     public static final boolean DEBUG = !BuildConfig.BUILD_TYPE.equals(""release"");
-    @NonNull public static final String TAG = ""BasePlayer"";
+    @NonNull
+    public static final String TAG = ""BasePlayer"";
 
-    @NonNull final protected Context context;
+    @NonNull
+    final protected Context context;
 
-    @NonNull final protected BroadcastReceiver broadcastReceiver;
-    @NonNull final protected IntentFilter intentFilter;
+    @NonNull
+    final protected BroadcastReceiver broadcastReceiver;
+    @NonNull
+    final protected IntentFilter intentFilter;
 
-    @NonNull final protected HistoryRecordManager recordManager;
+    @NonNull
+    final protected HistoryRecordManager recordManager;
 
-    @NonNull final protected CustomTrackSelector trackSelector;
-    @NonNull final protected PlayerDataSource dataSource;
+    @NonNull
+    final protected CustomTrackSelector trackSelector;
+    @NonNull
+    final protected PlayerDataSource dataSource;
 
-    @NonNull final private LoadControl loadControl;
-    @NonNull final private RenderersFactory renderFactory;
+    @NonNull
+    final private LoadControl loadControl;
+    @NonNull
+    final private RenderersFactory renderFactory;
 
-    @NonNull final private SerialDisposable progressUpdateReactor;
-    @NonNull final private CompositeDisposable databaseUpdateReactor;
+    @NonNull
+    final private SerialDisposable progressUpdateReactor;
+    @NonNull
+    final private CompositeDisposable databaseUpdateReactor;
     /*//////////////////////////////////////////////////////////////////////////
     // Intent
     //////////////////////////////////////////////////////////////////////////*/
 
-    @NonNull public static final String REPEAT_MODE = ""repeat_mode"";
-    @NonNull public static final String PLAYBACK_PITCH = ""playback_pitch"";
-    @NonNull public static final String PLAYBACK_SPEED = ""playback_speed"";
-    @NonNull public static final String PLAYBACK_SKIP_SILENCE = ""playback_skip_silence"";
-    @NonNull public static final String PLAYBACK_QUALITY = ""playback_quality"";
-    @NonNull public static final String PLAY_QUEUE_KEY = ""play_queue_key"";
-    @NonNull public static final String APPEND_ONLY = ""append_only"";
-    @NonNull public static final String SELECT_ON_APPEND = ""select_on_append"";
+    @NonNull
+    public static final String REPEAT_MODE = ""repeat_mode"";
+    @NonNull
+    public static final String PLAYBACK_PITCH = ""playback_pitch"";
+    @NonNull
+    public static final String PLAYBACK_SPEED = ""playback_speed"";
+    @NonNull
+    public static final String PLAYBACK_SKIP_SILENCE = ""playback_skip_silence"";
+    @NonNull
+    public static final String PLAYBACK_QUALITY = ""playback_quality"";
+    @NonNull
+    public static final String PLAY_QUEUE_KEY = ""play_queue_key"";
+    @NonNull
+    public static final String APPEND_ONLY = ""append_only"";
+    @NonNull
+    public static final String SELECT_ON_APPEND = ""select_on_append"";
 
     /*//////////////////////////////////////////////////////////////////////////
     // Playback
@@ -137,13 +156,18 @@
     protected PlayQueue playQueue;
     protected PlayQueueAdapter playQueueAdapter;
 
-    @Nullable protected MediaSourceManager playbackManager;
+    @Nullable
+    protected MediaSourceManager playbackManager;
 
-    @Nullable private PlayQueueItem currentItem;
-    @Nullable private MediaSourceTag currentMetadata;
-    @Nullable private Bitmap currentThumbnail;
+    @Nullable
+    private PlayQueueItem currentItem;
+    @Nullable
+    private MediaSourceTag currentMetadata;
+    @Nullable
+    private Bitmap currentThumbnail;
 
-    @Nullable protected Toast errorToast;
+    @Nullable
+    protected Toast errorToast;
 
     /*//////////////////////////////////////////////////////////////////////////
     // Player
@@ -213,7 +237,8 @@
         registerBroadcastReceiver();
     }
 
-    public void initListeners() {}
+    public void initListeners() {
+    }
 
     public void handleIntent(Intent intent) {
         if (DEBUG) Log.d(TAG, ""handleIntent() called with: intent = ["" + intent + ""]"");
@@ -297,7 +322,6 @@
         databaseUpdateReactor.clear();
         progressUpdateReactor.set(null);
 
-        simpleExoPlayer = null;
     }
 
     /*//////////////////////////////////////////////////////////////////////////
@@ -425,13 +449,15 @@
         if (!isProgressLoopRunning()) startProgressLoop();
     }
 
-    public void onBuffering() {}
+    public void onBuffering() {
+    }
 
     public void onPaused() {
         if (isProgressLoopRunning()) stopProgressLoop();
     }
 
-    public void onPausedSeek() {}
+    public void onPausedSeek() {
+    }
 
     public void onCompleted() {
         if (DEBUG) Log.d(TAG, ""onCompleted() called"");
@@ -602,19 +628,19 @@
     /**
      * Processes the exceptions produced by {@link com.google.android.exoplayer2.ExoPlayer ExoPlayer}.
      * There are multiple types of errors: <br><br>
-     *
+     * <p>
      * {@link ExoPlaybackException#TYPE_SOURCE TYPE_SOURCE}: <br><br>
-     *
+     * <p>
      * {@link ExoPlaybackException#TYPE_UNEXPECTED TYPE_UNEXPECTED}: <br><br>
      * If a runtime error occurred, then we can try to recover it by restarting the playback
      * after setting the timestamp recovery. <br><br>
-     *
+     * <p>
      * {@link ExoPlaybackException#TYPE_RENDERER TYPE_RENDERER}: <br><br>
      * If the renderer failed, treat the error as unrecoverable.
      *
      * @see #processSourceError(IOException)
      * @see Player.EventListener#onPlayerError(ExoPlaybackException)
-     *  */
+     */
     @Override
     public void onPlayerError(ExoPlaybackException error) {
         if (DEBUG) Log.d(TAG, ""ExoPlayer - onPlayerError() called with: "" +
@@ -1075,7 +1101,9 @@
                 currentThumbnail;
     }
 
-    /** Checks if the current playback is a livestream AND is playing at or beyond the live edge */
+    /**
+     * Checks if the current playback is a livestream AND is playing at or beyond the live edge
+     */
     @SuppressWarnings(""BooleanMethodIsAlwaysInverted"")
     public boolean isLiveEdge() {
         if (simpleExoPlayer == null || !isLive()) return false;",0
 Fixed an incompatible cast in the equals method of ProratedOrderItemAdjustmentImpl,"         if (!getClass().isAssignableFrom(obj.getClass())) {
             return false;
         }
-        OrderItemAdjustmentImpl other = (OrderItemAdjustmentImpl) obj;
+        ProratedOrderItemAdjustmentImpl other = (ProratedOrderItemAdjustmentImpl) obj;
 
         if (id != null && other.id != null) {
             return id.equals(other.id);",0
Ensure that item attributes and child items are copied over for non-discrete order items when going from wishlists to carts,"         if (item instanceof DiscreteOrderItem) {
             DiscreteOrderItem doi = (DiscreteOrderItem) item;
             orderItemRequest = new OrderItemRequestDTO();
-            orderItemRequest.setQuantity(doi.getQuantity());
             
             if (doi.getCategory() != null) {
                 orderItemRequest.setCategoryId(doi.getCategory().getId());
@@ -450,33 +449,33 @@
                 orderItemRequest.setSkuId(doi.getSku().getId());
             }
             
-            if (doi.getOrderItemAttributes() != null) {
-                for (Entry<String, OrderItemAttribute> entry : item.getOrderItemAttributes().entrySet()) {
-                    orderItemRequest.getItemAttributes().put(entry.getKey(), entry.getValue().getValue());
-                }
-            }
-
             if (doi.getAdditionalAttributes() != null) {
                 for (Entry<String, String> entry : doi.getAdditionalAttributes().entrySet()) {
                     orderItemRequest.getAdditionalAttributes().put(entry.getKey(), entry.getValue());
                 }
             }
-
-            if (CollectionUtils.isNotEmpty(doi.getChildOrderItems())) {
-                for (OrderItem childItem : doi.getChildOrderItems()) {
-                    orderItemRequest.getChildOrderItems().add(buildOrderItemRequestDTOFromOrderItem(childItem));
-                }
-            }
         } else {
             orderItemRequest = new NonDiscreteOrderItemRequestDTO();
             NonDiscreteOrderItemRequestDTO ndr = (NonDiscreteOrderItemRequestDTO) orderItemRequest;
             
             ndr.setItemName(item.getName());
-            ndr.setQuantity(item.getQuantity());
             ndr.setOverrideRetailPrice(item.getRetailPrice());
             ndr.setOverrideSalePrice(item.getSalePrice());
         }
         
+        orderItemRequest.setQuantity(item.getQuantity());
+        if (item.getOrderItemAttributes() != null) {
+            for (Entry<String, OrderItemAttribute> entry : item.getOrderItemAttributes().entrySet()) {
+                orderItemRequest.getItemAttributes().put(entry.getKey(), entry.getValue().getValue());
+            }
+        }
+
+        if (CollectionUtils.isNotEmpty(item.getChildOrderItems())) {
+            for (OrderItem childItem : item.getChildOrderItems()) {
+                orderItemRequest.getChildOrderItems().add(buildOrderItemRequestDTOFromOrderItem(childItem));
+            }
+        }
+
         return orderItemRequest;
     }
 
@@ -616,10 +615,12 @@
         extensionManager.getProxy().mergeOrderItemRequest(itemRequest, orderItem);
     }
 
+    @Override
     public List<OrderItem> findOrderItemsForCustomersInDateRange(List<Long> customerIds, Date startDate, Date endDate) {
         return orderItemDao.readOrderItemsForCustomersInDateRange(customerIds, startDate, endDate);
     }
 
+    @Override
     public List<OrderItem> readBatchOrderItems(int start, int count, List<OrderStatus> orderStatusList) {
         return orderItemDao.readBatchOrderItems(start, count, orderStatusList);
     }",0
Close WebSocketFactory when updated," 	}
 
 	public final void setWebSocketFactory( WebSocketServerFactory wsf ) {
+		if (this.wsf != null)
+			this.wsf.close();
 		this.wsf = wsf;
 	}
 ",0
Fix RequestBodyHelper body inflation," import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.OutputStream;
-import java.util.zip.DeflaterOutputStream;
+import java.util.zip.InflaterOutputStream;
 
 /**
  * Helper which manages provides computed request sizes as well as transparent decompression.
@@ -44,7 +44,7 @@
     if (DecompressionHelper.GZIP_ENCODING.equals(contentEncoding)) {
       deflatingOutput = GunzippingOutputStream.create(deflatedOutput);
     } else if (DecompressionHelper.DEFLATE_ENCODING.equals(contentEncoding)) {
-      deflatingOutput = new DeflaterOutputStream(deflatedOutput);
+      deflatingOutput = new InflaterOutputStream(deflatedOutput);
     } else {
       deflatingOutput = deflatedOutput;
     }",0
SystemPropertiesServiceImpl uses the Spring Environment inefficiently,"             if (envOrigination) {
                 result = null;
             } else {
+                result = getPropertyFromCache(name);
+                if (result == null) {
                 result = env.getProperty(name);
             }
+            }
         } else {
             if (""_blank_"".equals(property.getValue())) {
                 result = """";",0
Fix potential NPE in NodeImpl," 
     @Override
     public DateTime getLastSeen() {
-        return new DateTime(((Integer) fields.get(""last_seen"")) * 1000L, DateTimeZone.UTC);
+        return new DateTime(((Integer) fields.getOrDefault(""last_seen"", 0)) * 1000L, DateTimeZone.UTC);
     }
 
     @Override",0
fix: MviDialogFragment extends DialogFragment," import android.support.annotation.CallSuper;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.support.v4.app.DialogFragment;
 import android.support.v4.app.Fragment;
 import android.util.Log;
 import android.view.LayoutInflater;
@@ -55,7 +56,7 @@
  * @author Hannes Dorfmann
  * @since 3.0.0
  */
-public abstract class MviDialogFragment<V extends MvpView, P extends MviPresenter<V, ?>> extends Fragment
+public abstract class MviDialogFragment<V extends MvpView, P extends MviPresenter<V, ?>> extends DialogFragment
     implements MvpView, MviDelegateCallback<V, P> {
 
   private boolean isRestoringViewState = false;",0
Set existing Plugin instance as completed," // ZAP: 2015/11/02 Issue 1969: Issues with installation of scanners
 // ZAP: 2015/12/21 Issue 2112: Wrong policy on active Scan
 // ZAP: 2016/01/26 Fixed findbugs warning
+// ZAP: 2016/05/04 Use existing Plugin instances when setting them as completed
 
 package org.parosproxy.paros.core.scanner;
 
@@ -637,9 +638,11 @@
     }
 
     synchronized void setRunningPluginCompleted(Plugin plugin) {
-        listRunning.remove(plugin);
-        listCompleted.add(plugin);
-        plugin.setTimeFinished();
+        if (listRunning.remove(plugin)) {
+            Plugin completedPlugin = mapAllPlugin.get(plugin.getId());
+            listCompleted.add(completedPlugin);
+            completedPlugin.setTimeFinished();
+        }
     }
 
     boolean isRunning(Plugin plugin) {",0
Fix netty warning spam when sending >1MB packets,"             else
             {
                 List<Packet<INetHandlerPlayClient>> parts = ((FMLProxyPacket)msg).toS3FPackets();
-                for (Packet<INetHandlerPlayClient> pkt : parts)
+                int sizeMinusOne = parts.size() - 1;
+                for (int i = 0; i < sizeMinusOne; i++)
                 {
-                    ctx.write(pkt, promise);
+                    ctx.write(parts.get(i), ctx.voidPromise());
                 }
+                ctx.write(parts.get(sizeMinusOne), promise);
             }
         }
         else",0
Minor fix on temp directory name for nd4j kernels,"         String[] commands = {""bash"",""-c"",""make && /usr/bin/make install""};
         ProcessBuilder probuilder = new ProcessBuilder(commands);
         //You can set up your work directory
-        probuilder.directory(new File(""/tmp/nd4j-kernels""));
+        probuilder.directory(new File(System.getProperty(""java.io.tmpdir"") + File.separator + ""nd4j-kernels""));
 
         Process process = probuilder.start();
         //Read out dir output",0
Fix exception in ShapedOreRecipe.checkMatch for non-3x3 recipes,"                     {
                         target = input.get(subX + subY * width);
                     }
-                }
 
                 if (!target.apply(inv.getStackInRowAndColumn(x, y)))
                 {
@@ -133,6 +132,7 @@
                 }
             }
         }
+        }
 
         return true;
     }",0
Fix issue567,"     }
 
     public boolean remove(Node node) {
-        notifyElementRemoved(innerList.indexOf(node), node);
-        boolean remove = innerList.remove(node);
+        int index = innerList.indexOf(node);
+        if (index != -1) {
+            notifyElementRemoved(index, node);
         node.setParentNode(null);
+        }
+        boolean remove = innerList.remove(node);
         return remove;
     }
 ",0
fixed issue that could lead to NPE,"         Collection<ExecutionPhase> localExecutionPhases = nodesByServer.remove(localNodeId);
 
         JobExecutionContext.Builder builder = jobContextService.newBuilder(jobId());
-        builder.addSubContext(localMergeExecutionNodeId, finalLocalMerge);
-
         if (localExecutionPhases != null) {
             for (ExecutionPhase executionPhase : localExecutionPhases) {
                 contextPreparer.prepare(jobId(), executionPhase, builder);
             }
         }
+        builder.addSubContext(localMergeExecutionNodeId, finalLocalMerge);
         JobExecutionContext context = jobContextService.createContext(builder);
         context.start();
     }",0
Issue 1174: fix for java.util.IllegalFormatConversionException,"         }
 
         throw new TemporaryLockingException(String.format(""Reached timeout %d (%s elapsed) when attempting to allocate id block on partition(%d)-namespace(%d)"",
-                timeout, methodTime.toString(), partition, idNamespace));
+                                            timeout.getNano(), methodTime.toString(), partition, idNamespace));
     }
 
 ",0
fix:修复添加用户头像时，使用本地上传会报路径目录不存在错误," 
 import javax.imageio.ImageIO;
 import java.awt.image.BufferedImage;
-import java.io.ByteArrayOutputStream;
-import java.io.FileOutputStream;
-import java.io.IOException;
-import java.io.OutputStream;
+import java.io.*;
 import java.util.*;
 import java.util.regex.Pattern;
 
@@ -487,6 +484,10 @@
                             user.put(UserExt.USER_AVATAR_URL, Symphonys.get(""qiniu.domain"") + ""/avatar/"" + ret + ""?"" + new Date().getTime());
                         } else {
                             String fileName = UUID.randomUUID().toString().replaceAll(""-"", """") + "".jpg"";
+                            File dir = new File(FileUploadProcessor.UPLOAD_DIR+fileName.substring(0,fileName.lastIndexOf(File.separator)));
+                            if (!dir.exists()) {
+                                dir.mkdirs();
+                            }
                             fileName = FileUploadProcessor.genFilePath(fileName);
                             try (final OutputStream output = new FileOutputStream(FileUploadProcessor.UPLOAD_DIR + fileName)) {
                                 IOUtils.write(avatarData, output);",0
Fix received data for last vertex format element not being recorded,"     public void put(int element, float... data)
     {
         System.arraycopy(data, 0, quadData[element][vertices], 0, data.length);
-        if(element == getVertexFormat().getElementCount() - 1) vertices++;
         if(vertices == 0)
         {
             dataLength[element] = (byte)data.length;
         }
-        else if(vertices == 4)
+        if (element == getVertexFormat().getElementCount() - 1)
+        {
+            vertices++;
+        }
+        if (vertices == 4)
         {
             vertices = 0;
             processQuad();",0
Fixes Vanilla Fluid Still Icon Setters,"     {
         MinecraftForge.EVENT_BUS.post(new TextureStitchEvent.Post(map));
 
-        FluidRegistry.WATER.setIcons(BlockFluid.func_94424_b(""water""), BlockFluid.func_94424_b(""water_flow""));
-        FluidRegistry.LAVA.setIcons(BlockFluid.func_94424_b(""lava""), BlockFluid.func_94424_b(""lava_flow""));
+        FluidRegistry.WATER.setIcons(BlockFluid.func_94424_b(""water_still""), BlockFluid.func_94424_b(""water_flow""));
+        FluidRegistry.LAVA.setIcons(BlockFluid.func_94424_b(""lava_still""), BlockFluid.func_94424_b(""lava_flow""));
     }
 
     /**",0
Fix for issue #532.,"     public void useDefaultHomePath() {
         switch (LWJGLUtil.getPlatform()) {
             case LWJGLUtil.PLATFORM_LINUX:
-                homePath = new File(""~"" + TERASOLOGY_HIDDEN_FOLDER_NAME);
+                homePath = new File(System.getProperty(""user.home"") + TERASOLOGY_HIDDEN_FOLDER_NAME);
                 break;
             case LWJGLUtil.PLATFORM_MACOSX:
                 homePath = new File(System.getProperty(""user.home"") + ""/Library/Application Support/"" + TERASOLOGY_FOLDER_NAME);",0
Fixed typo in comment," 
 	private static final char[] JID_ESCAPING_CHARS = {' ','""','&','\'','/',':','<','>','@','\\'};
 
-	// It's much more efficient to store the ful JID as well as the parts instead of figuring them
+	// It's much more efficient to store the full JID as well as the parts instead of figuring them
 	// all out every time (since some characters are displayed but aren't used for comparisons).
 	private final String displayjid;
 ",0
Fix NullPointerException on instigator access on server.,"  */
 @ServerEvent(lagCompensate = true)
 public class ActivationRequest extends NetworkEvent {
-    private EntityRef instigator;
     /**
      * The field is used to preserve the fact that an item got used, even when the item is no more at the target server.
      */
@@ -50,7 +49,7 @@
     public ActivationRequest(EntityRef instigator, boolean ownedEntityUsage, EntityRef usedOwnedEntity,
                              boolean eventWithTarget, EntityRef target, Vector3f origin, Vector3f direction,
                              Vector3f hitPosition, Vector3f hitNormal, int activationId) {
-        this.instigator = instigator;
+        super(instigator);
         this.ownedEntityUsage = ownedEntityUsage;
         this.usedOwnedEntity = usedOwnedEntity;
         this.eventWithTarget = eventWithTarget;
@@ -62,11 +61,6 @@
         this.activationId = activationId;
     }
 
-    @Override
-    public EntityRef getInstigator() {
-        return instigator;
-    }
-
     public boolean isOwnedEntityUsage() {
         return ownedEntityUsage;
     }",0
Merge #192 fix to master," 
     public TriggerKey getRecoveringTriggerKey() {
         if (isRecovering()) {
-            return new TriggerKey(jobDataMap.getString(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_GROUP),
-                                  jobDataMap.getString(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_NAME));
+            return new TriggerKey(jobDataMap.getString(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_NAME),
+                                  jobDataMap.getString(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_GROUP));
         } else {
             throw new IllegalStateException(""Not a recovering job"");
         }",0
Fix upsampling 1D backprop," import lombok.extern.slf4j.Slf4j;
 import org.deeplearning4j.nn.conf.NeuralNetConfiguration;
 import org.deeplearning4j.nn.conf.layers.BaseUpsamplingLayer;
+import org.deeplearning4j.nn.gradient.DefaultGradient;
 import org.deeplearning4j.nn.gradient.Gradient;
 import org.nd4j.linalg.api.ndarray.INDArray;
+import org.nd4j.linalg.api.ops.CustomOp;
+import org.nd4j.linalg.api.ops.DynamicCustomOp;
+import org.nd4j.linalg.factory.Nd4j;
 import org.nd4j.linalg.primitives.Pair;
 
+import java.util.Arrays;
+
 
 /**
  * 1D Upsampling layer.
@@ -60,15 +66,35 @@
         INDArray originalInput = input;
         input = input.reshape(input.size(0), input.size(1), input.size(2), 1);
 
-        Pair<Gradient, INDArray> gradientEpsNext = super.backpropGradient(epsilon);
-        INDArray epsNext = gradientEpsNext.getSecond();
-        Gradient gradient = gradientEpsNext.getFirst();
+        int miniBatch = input.size(0);
+        int inDepth = input.size(1);
+        int inH = input.size(2);
+        int inW = input.size(3);
 
-        epsNext = epsNext.slice(0, 3);
+
+        INDArray outEpsilon = Nd4j.create(miniBatch * inDepth * inH * inW);
+        INDArray reshapedEpsilon = outEpsilon.reshape('c', miniBatch, inDepth, inH, inW);
+
+        INDArray forwardOutput  = preOutput(true, true);
+        forwardOutput = forwardOutput.reshape(
+                forwardOutput.size(0), forwardOutput.size(1), forwardOutput.size(2), 1);
+        forwardOutput = forwardOutput.repeat(3, size);
+
+        CustomOp op = DynamicCustomOp.builder(""upsampling_bp"")
+                .addIntegerArguments(size)
+                .addInputs(forwardOutput, epsilon)
+                .addOutputs(reshapedEpsilon)
+                .callInplace(false)
+                .build();
+        Nd4j.getExecutioner().exec(op);
+
+        Gradient gradient = new DefaultGradient();
+
+        reshapedEpsilon = reshapedEpsilon.slice(0, 3);
         input = originalInput;
 
         // Since we aggregate the gradient across ""size"" slices, we need to normalize afterwards.
-        return new Pair<>(gradient, epsNext.divi(size));
+        return new Pair<>(gradient, reshapedEpsilon.divi(size));
     }
 
     @Override",0
Fix #5580 Missing jcenter repo," 		write(wr, ""repositories {"");
 		write(wr, DependencyBank.mavenLocal);
 		write(wr, DependencyBank.mavenCentral);
+		write(wr, DependencyBank.jCenter);
 		write(wr, DependencyBank.google);
 		write(wr, ""maven { url \"""" + DependencyBank.libGDXSnapshotsUrl + ""\"" }"");
 		write(wr, ""maven { url \"""" + DependencyBank.libGDXReleaseUrl + ""\"" }"");",0
Crtical fix inside run() loop,"         }
       } catch (IOException ex) {
     	  onIOError(conn, ex);
-      } catch (NoSuchAlgorithmException ex) {
+      } catch (Exception ex) {
+    	// NullPointerException is the most common error that can happen here
+    	// (e.g.when connection closes immediately)
+    	// TODO: user should handle that kind of events my himself
         ex.printStackTrace();
       }
     }",0
Bugfix/timeout queue full," import java.util.Locale;
 import java.util.Queue;
 import java.util.Set;
-import java.util.concurrent.ArrayBlockingQueue;
 import java.util.concurrent.CountDownLatch;
 import java.util.concurrent.Executors;
+import java.util.concurrent.LinkedBlockingQueue;
 import java.util.concurrent.RejectedExecutionException;
 import java.util.concurrent.ThreadFactory;
 import java.util.concurrent.TimeUnit;
@@ -109,8 +109,8 @@
     private final HashedWheelBucket[] wheel;
     private final int mask;
     private final CountDownLatch startTimeInitialized = new CountDownLatch(1);
-    private final Queue<HashedWheelTimeout> timeouts = new ArrayBlockingQueue<HashedWheelTimeout>(1024);
-    private final Queue<HashedWheelTimeout> cancelledTimeouts = new ArrayBlockingQueue<HashedWheelTimeout>(1024);
+    private final Queue<HashedWheelTimeout> timeouts = new LinkedBlockingQueue<>();
+    private final Queue<HashedWheelTimeout> cancelledTimeouts = new LinkedBlockingQueue<>();
     private final AtomicLong pendingTimeouts = new AtomicLong(0);
     private final long maxPendingTimeouts;
 ",0
"Description of MBeanClient example should refer to agent option ""jmx=true"" instead of removed output mode ""mbean"""," import javax.management.remote.JMXServiceURL;
 
 /**
- * This example connects to a coverage agent that run in output mode
- * <code>mbean</code> and requests execution data. The collected data is dumped
- * to a local file.
+ * This example connects to a JaCoCo agent that runs with the option
+ * <code>jmx=yes</code> and requests execution data. The collected data is
+ * dumped to a local file.
  */
 public final class MBeanClient {
 ",0
Fixed typo on Jersery Resource method name,"         try
         {
             RemoteInstanceRequest           request = new RemoteInstanceRequest(exhibitor, spec.getHostname());
-            RemoteInstanceRequest.Result    result = request.makeRequest(exhibitor.getRemoteInstanceRequestClient(), ""state"");
+            RemoteInstanceRequest.Result    result = request.makeRequest(exhibitor.getRemoteInstanceRequestClient(), ""getStatus"");
 
             ObjectMapper                    mapper = new ObjectMapper();
             JsonNode                        value = mapper.readTree(mapper.getJsonFactory().createJsonParser(result.remoteResponse));",0
UNDERTOW-209. Allow specification of suffix for access log file name,"  * @author Stuart Douglas
  */
 public class DefaultAccessLogReceiver implements AccessLogReceiver, Runnable, Closeable {
+    private static final String DEFAULT_LOG_SUFFIX = "".log"";
 
     private final Executor logWriteExecutor;
 
@@ -50,15 +51,21 @@
     private final File defaultLogFile;
 
     private final String logBaseName;
+    private final String logNameSuffix;
 
     private Writer writer = null;
 
     public DefaultAccessLogReceiver(final Executor logWriteExecutor, final File outputDirectory, final String logBaseName) {
+        this(logWriteExecutor, outputDirectory, logBaseName, null);
+    }
+
+    public DefaultAccessLogReceiver(final Executor logWriteExecutor, final File outputDirectory, final String logBaseName, final String logNameSuffix) {
         this.logWriteExecutor = logWriteExecutor;
         this.outputDirectory = outputDirectory;
         this.logBaseName = logBaseName;
+        this.logNameSuffix = (logNameSuffix != null) ? logNameSuffix : DEFAULT_LOG_SUFFIX;
         this.pendingMessages = new ConcurrentLinkedDeque<String>();
-        this.defaultLogFile = new File(outputDirectory, logBaseName + "".log"");
+        this.defaultLogFile = new File(outputDirectory, logBaseName + logNameSuffix);
         calculateChangeOverPoint();
     }
 
@@ -161,11 +168,11 @@
                 writer.close();
                 writer = null;
             }
-            File newFile = new File(outputDirectory, logBaseName + ""_"" + currentDateString + "".log"");
+            File newFile = new File(outputDirectory, logBaseName + ""_"" + currentDateString + logNameSuffix);
             int count = 0;
             while (newFile.exists()) {
                 ++count;
-                newFile = new File(outputDirectory, logBaseName + ""_"" + currentDateString + ""-"" + count + "".log"");
+                newFile = new File(outputDirectory, logBaseName + ""_"" + currentDateString + ""-"" + count + logNameSuffix);
             }
             if (!defaultLogFile.renameTo(newFile)) {
                 UndertowLogger.ROOT_LOGGER.errorRotatingAccessLog(new IOException());",0
Minor fixes to RippleView.java," import android.content.res.TypedArray;
 import android.graphics.Bitmap;
 import android.graphics.Canvas;
+import android.graphics.Color;
 import android.graphics.Paint;
 import android.graphics.PorterDuff;
 import android.graphics.PorterDuffXfermode;
 import android.graphics.Rect;
 import android.os.Handler;
+import android.support.annotation.NonNull;
 import android.util.AttributeSet;
 import android.view.GestureDetector;
 import android.view.MotionEvent;
@@ -41,12 +43,13 @@
 import android.widget.ListView;
 import android.widget.RelativeLayout;
 
+
 /**
  * Author :    Chutaux Robin
  * Date :      10/8/2014
  */
-public class RippleView extends RelativeLayout
-{
+public class RippleView extends RelativeLayout {
+
     private int WIDTH;
     private int HEIGHT;
     private int FRAME_RATE = 10;
@@ -71,34 +74,28 @@
     private int rippleColor;
     private int ripplePadding;
     private GestureDetector gestureDetector;
-    private final Runnable runnable = new Runnable()
-    {
+    private final Runnable runnable = new Runnable() {
         @Override
-        public void run()
-        {
+        public void run() {
             invalidate();
         }
     };
 
-    public RippleView(Context context)
-    {
+    public RippleView(Context context) {
         super(context);
     }
 
-    public RippleView(Context context, AttributeSet attrs)
-    {
+    public RippleView(Context context, AttributeSet attrs) {
         super(context, attrs);
         init(context, attrs);
     }
 
-    public RippleView(Context context, AttributeSet attrs, int defStyle)
-    {
+    public RippleView(Context context, AttributeSet attrs, int defStyle) {
         super(context, attrs, defStyle);
         init(context, attrs);
     }
 
-    private void init(final Context context, final AttributeSet attrs)
-    {
+    private void init(final Context context, final AttributeSet attrs) {
         if (isInEditMode())
             return;
 
@@ -114,6 +111,7 @@
         canvasHandler = new Handler();
         zoomScale = typedArray.getFloat(R.styleable.RippleView_rv_zoomScale, 1.03f);
         zoomDuration = typedArray.getInt(R.styleable.RippleView_rv_zoomDuration, 200);
+        typedArray.recycle();
         paint = new Paint();
         paint.setAntiAlias(true);
         paint.setStyle(Paint.Style.FILL);
@@ -121,25 +119,21 @@
         paint.setAlpha(PAINT_ALPHA);
         this.setWillNotDraw(false);
 
-        gestureDetector = new GestureDetector(context, new GestureDetector.SimpleOnGestureListener()
-        {
+        gestureDetector = new GestureDetector(context, new GestureDetector.SimpleOnGestureListener() {
             @Override
-            public void onLongPress(MotionEvent event)
-            {
+            public void onLongPress(MotionEvent event) {
                 super.onLongPress(event);
                 animateRipple(event);
                 sendClickEvent(true);
             }
 
             @Override
-            public boolean onSingleTapConfirmed(MotionEvent e)
-            {
+            public boolean onSingleTapConfirmed(MotionEvent e) {
                 return true;
             }
 
             @Override
-            public boolean onSingleTapUp(MotionEvent e)
-            {
+            public boolean onSingleTapUp(MotionEvent e) {
                 return true;
             }
         });
@@ -150,13 +144,10 @@
 
 
     @Override
-    public void draw(Canvas canvas)
-    {
+    public void draw(@NonNull Canvas canvas) {
         super.draw(canvas);
-        if (animationRunning)
-        {
-            if (DURATION <= timer * FRAME_RATE)
-            {
+        if (animationRunning) {
+            if (DURATION <= timer * FRAME_RATE) {
                 animationRunning = false;
                 timer = 0;
                 durationEmpty = -1;
@@ -164,8 +155,7 @@
                 canvas.restore();
                 invalidate();
                 return;
-            }
-            else
+            } else
                 canvasHandler.postDelayed(runnable, FRAME_RATE);
 
             if (timer == 0)
@@ -174,10 +164,9 @@
 
             canvas.drawCircle(x, y, (radiusMax * (((float) timer * FRAME_RATE) / DURATION)), paint);
 
-            paint.setColor(getResources().getColor(android.R.color.holo_red_light));
+            paint.setColor(Color.parseColor(""#ffff4444""));
 
-            if (rippleType == 1 && originBitmap != null && (((float) timer * FRAME_RATE) / DURATION) > 0.4f)
-            {
+            if (rippleType == 1 && originBitmap != null && (((float) timer * FRAME_RATE) / DURATION) > 0.4f) {
                 if (durationEmpty == -1)
                     durationEmpty = DURATION - timer * FRAME_RATE;
 
@@ -189,8 +178,7 @@
 
             paint.setColor(rippleColor);
 
-            if (rippleType == 1)
-            {
+            if (rippleType == 1) {
                 if ((((float) timer * FRAME_RATE) / DURATION) > 0.6f)
                     paint.setAlpha((int) (PAINT_ALPHA - ((PAINT_ALPHA) * (((float) timerEmpty * FRAME_RATE) / (durationEmpty)))));
                 else
@@ -204,8 +192,7 @@
     }
 
     @Override
-    protected void onSizeChanged(int w, int h, int oldw, int oldh)
-    {
+    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
         super.onSizeChanged(w, h, oldw, oldh);
         WIDTH = w;
         HEIGHT = h;
@@ -216,20 +203,16 @@
         scaleAnimation.setRepeatCount(1);
     }
 
-    public void animateRipple(MotionEvent event)
-    {
+    public void animateRipple(MotionEvent event) {
         createAnimation(event.getX(), event.getY());
     }
 
-    public void animateRipple(final float x, final float y)
-    {
+    public void animateRipple(final float x, final float y) {
         createAnimation(x, y);
     }
 
-    private void createAnimation(final float x, final float y)
-    {
-        if (!animationRunning)
-        {
+    private void createAnimation(final float x, final float y) {
+        if (!animationRunning) {
             if (hasToZoom)
                 this.startAnimation(scaleAnimation);
 
@@ -240,13 +223,10 @@
 
             radiusMax -= ripplePadding;
 
-            if (isCentered || rippleType == 1)
-            {
+            if (isCentered || rippleType == 1) {
                 this.x = getMeasuredWidth() / 2;
                 this.y = getMeasuredHeight() / 2;
-            }
-            else
-            {
+            } else {
                 this.x = x;
                 this.y = y;
             }
@@ -262,10 +242,8 @@
 
 
     @Override
-    public boolean onTouchEvent(MotionEvent event)
-    {
-        if (gestureDetector.onTouchEvent(event))
-        {
+    public boolean onTouchEvent(@NonNull MotionEvent event) {
+        if (gestureDetector.onTouchEvent(event)) {
             animateRipple(event);
             sendClickEvent(false);
         }
@@ -273,25 +251,19 @@
     }
 
     @Override
-    public boolean onInterceptTouchEvent(MotionEvent event)
-    {
+    public boolean onInterceptTouchEvent(MotionEvent event) {
         this.onTouchEvent(event);
         return super.onInterceptTouchEvent(event);
     }
 
-    private void sendClickEvent(final Boolean isLongClick)
-    {
-        if (getParent() instanceof ListView)
-        {
+    private void sendClickEvent(final Boolean isLongClick) {
+        if (getParent() instanceof ListView) {
             final int position = ((ListView) getParent()).getPositionForView(this);
             final long id = ((ListView) getParent()).getItemIdAtPosition(position);
-            if (isLongClick)
-            {
+            if (isLongClick) {
                 if (((ListView) getParent()).getOnItemLongClickListener() != null)
                     ((ListView) getParent()).getOnItemLongClickListener().onItemLongClick(((ListView) getParent()), this, position, id);
-            }
-            else
-            {
+            } else {
                 if (((ListView) getParent()).getOnItemClickListener() != null)
                     ((ListView) getParent()).getOnItemClickListener().onItemClick(((ListView) getParent()), this, position, id);
             }",0
Fixed minor issue with new file creation,"                     public void run() {
                         if(toast!=null)toast.cancel();
                         mainActivity.oppathe = path.getPath();
-                        mainActivity.operation = DataUtils.NEW_FOLDER;
+                        mainActivity.operation = DataUtils.NEW_FILE;
                         guideDialogForLEXA(mainActivity.oppathe);
                     }});
 ",0
Fix schema name in SHOW TABLES error message,"         if (schema.isPresent()) {
             List<String> parts = schema.get().getParts();
             if (parts.size() > 2) {
-                throw new SemanticException(INVALID_SCHEMA_NAME, showTables, ""Too many parts in schema name: %s"", schema);
+                throw new SemanticException(INVALID_SCHEMA_NAME, showTables, ""Too many parts in schema name: %s"", schema.get());
             }
             if (parts.size() == 2) {
                 catalogName = parts.get(0);",0
Fix typo in GraphView," 
 /**
  * GraphView is a Android View for creating zoomable and scrollable graphs.
- * This is the abstract base class for all graphs. Extend this class and implement {@link #drawSeries(Canvas, float, float, float, double, double, double, double, float)} to display a custom graph.
+ * This is the abstract base class for all graphs. Extend this class and implement {@link #drawSeries(Canvas, GraphViewData[], float, float, float, double, double, double, double, float)} to display a custom graph.
  * Use {@link LineGraphView} for creating a line chart.
  *
  * @author jjoe64 - jonas gehring - http://www.jjoe64.com",0
Fix URIBuilder compare method for IPv6 hosts,"         }
     }
     
+    private static String trimIpv6Brackets(String host) {
+        if (host.startsWith(""["") && host.endsWith(""]"")) {
+            return host.substring(1, host.length() - 1);
+        }
+        return host;
+    }
+
     public static boolean compare(InetSocketAddress entryAddr, URI addr) {
-        if (((entryAddr.getHostName() != null && entryAddr.getHostName().equals(addr.getHost()))
-                || entryAddr.getAddress().getHostAddress().equals(addr.getHost()))
+        if (((entryAddr.getHostName() != null && entryAddr.getHostName().equals(trimIpv6Brackets(addr.getHost())))
+                || entryAddr.getAddress().getHostAddress().equals(trimIpv6Brackets(addr.getHost())))
                 && entryAddr.getPort() == addr.getPort()) {
             return true;
         }",0
Fix issue that can hide slow network requests,"       params.timestamp = stethoNow() / 1000.0;
       params.initiator = initiatorJSON;
       params.redirectResponse = null;
+      params.type = Page.ResourceType.OTHER;
       peerManager.sendNotificationToPeers(""Network.requestWillBeSent"", params);
     }
   }",0
Reduce UI module log level (info -> debug) for service loader,"         List<UIModule> l = new ArrayList<>();
         while (iter.hasNext()) {
             UIModule m = iter.next();
-            log.info(""Loaded UI module via service loader: {}"", m.getClass());
+            log.debug(""Loaded UI module via service loader: {}"", m.getClass());
             l.add(m);
         }
 ",0
Fix AsyncEpoxyController constructor to correctly use boolean setting,"    *                    both on the main thread.
    */
   public AsyncEpoxyController(boolean enableAsync) {
-    this(true, true);
+    this(enableAsync, enableAsync);
   }
 
   /**",0
Fix #55: Adding the ModifierSet.hasPackageLevelAccess method,"     }
 
     /**
+     * Is the element accessible from within the package?
+     * It is the level of access which is applied if no modifiers are chosen,
+     * it is sometimes called ""default"".
+     */
+    public static boolean hasPackageLevelAccess(int modifiers) {
+        return !isPublic(modifiers) && !isProtected(modifiers) && !isPrivate(modifiers);
+    }
+
+    /*
      * A set of accessors that indicate whether the specified modifier is in the
      * set.
      */",0
Empty graph hack fixes #4722 and fixes #5316,"       minY = Double.POSITIVE_INFINITY;
       maxY = Double.NEGATIVE_INFINITY;
       for(Graph g : graphs) {
+        if (!g.buffer.isEmpty()) {
         minY = Math.min(g.buffer.min(), minY);
         maxY = Math.max(g.buffer.max(), maxY);
       }
+      }
 
       final double MIN_DELTA = 10.0;
       if (maxY - minY < MIN_DELTA) {
@@ -239,7 +241,7 @@
       for(int i = 0; i < parts.length; ++i) {
         try {          
           double value = Double.valueOf(parts[i]);
-          if(i >= graphs.size()) {
+          if(validParts >= graphs.size()) {
             graphs.add(new Graph(validParts));
           }
           graphs.get(validParts).buffer.add(value);",0
KSQL-305 - fixing key issue with DataGen," 
       GenericRow genericRow = new GenericRow(genericRowValues);
 
-      String keyString = genericRowValues.iterator().next().toString();// randomAvroMessage.get(key).toString();
+      String keyString = randomAvroMessage.get(key).toString();
 
       ProducerRecord<String, GenericRow> producerRecord = new ProducerRecord<>(kafkaTopicName, keyString, genericRow);
       producer.send(producerRecord);",0
Use deterministic prefix in loggerName so level can be configured,"   // Must be synchronized since called directly from different thread
   private synchronized void addVerticle(Deployment deployment, Verticle verticle,
                                         VerticleFactory factory) {
-    String loggerName = deployment.name + ""-"" + deployment.verticles.size();
+    String loggerName = ""org.vertx.deployments."" + deployment.name + ""-"" + deployment.verticles.size();
     Logger logger = LoggerFactory.getLogger(loggerName);
     Context context = Context.getContext();
     VerticleHolder holder = new VerticleHolder(deployment, context, verticle,",0
Fix https://issues.jboss.org/browse/KEYCLOAK-5636 NPE," 
 
     private PublicKey lookupCachedKey(int publicKeyCacheTtl, int currentTime, String kid) {
-        if (lastRequestTime + publicKeyCacheTtl > currentTime) {
+        if (lastRequestTime + publicKeyCacheTtl > currentTime && kid != null) {
             return currentKeys.get(kid);
         } else {
             return null;",0
Fix crash If device is not supported flash mode setting.,"         mFocusMode = parameters.getFocusMode();
 
         if (mFlashMode != null) {
+            if (parameters.getSupportedFlashModes() != null) {
             if (parameters.getSupportedFlashModes().contains(
                     mFlashMode)) {
                 parameters.setFlashMode(mFlashMode);
@@ -792,6 +793,7 @@
                 Log.i(TAG, ""Camera flash mode: "" + mFlashMode + "" is not supported on this device."");
             }
         }
+        }
 
         // setting mFlashMode to the one set in the params
         mFlashMode = parameters.getFlashMode();
@@ -1006,7 +1008,7 @@
         int displayAngle;
         if (cameraInfo.facing == Camera.CameraInfo.CAMERA_FACING_FRONT) {
             angle = (cameraInfo.orientation + degrees) % 360;
-            displayAngle = (360 - angle); // compensate for it being mirrored
+            displayAngle = (360 - angle) % 360; // compensate for it being mirrored
         } else {  // back-facing
             angle = (cameraInfo.orientation - degrees + 360) % 360;
             displayAngle = angle;",0
#827 Fixes auto rotation bug with useAsFrontPage on by preserving the…,"     protected Button errorButtonRetry;
     protected TextView errorTextView;
 
+    @State
     protected boolean useAsFrontPage = false;
 
     @Override",0
Fix issue that prevented extended classes from participating in tab and field creation,"     public Map<String, TabMetadata> getTabAndGroupMetadata(Class<?>[] entities, ClassMetadata cmd) {
         Class<?>[] superClassEntities = getSuperClassHierarchy(entities[entities.length-1]);
 
-        Map<String, TabMetadata> mergedTabAndGroupMetadata = metadata.getBaseTabAndGroupMetadata(superClassEntities);
+        Map<String, TabMetadata> mergedTabAndGroupMetadata = metadata.getBaseTabAndGroupMetadata(entities);
         metadata.applyTabAndGroupMetadataOverrides(superClassEntities, mergedTabAndGroupMetadata);
         metadata.buildAdditionalTabAndGroupMetadataFromCmdProperties(cmd, mergedTabAndGroupMetadata);
 ",0
Fix Hive TupleDomain compaction," import com.facebook.presto.spi.Domain;
 import com.facebook.presto.spi.FixedSplitSource;
 import com.facebook.presto.spi.PrestoException;
-import com.facebook.presto.spi.Range;
 import com.facebook.presto.spi.RecordSink;
 import com.facebook.presto.spi.SchemaNotFoundException;
 import com.facebook.presto.spi.SchemaTableName;
@@ -1389,8 +1388,14 @@
         ImmutableMap.Builder<HiveColumnHandle, Domain> builder = ImmutableMap.builder();
         for (Entry<ConnectorColumnHandle, Domain> entry : effectivePredicate.getDomains().entrySet()) {
             HiveColumnHandle hiveColumnHandle = checkType(entry.getKey(), HiveColumnHandle.class, ""ColumnHandle"");
-            Range span = entry.getValue().getRanges().getSpan();
-            builder.put(hiveColumnHandle, new Domain(SortedRangeSet.of(span), entry.getValue().isNullAllowed()));
+
+            SortedRangeSet ranges = entry.getValue().getRanges();
+            if (!ranges.isNone()) {
+                // compact the range to a single span
+                ranges = SortedRangeSet.of(entry.getValue().getRanges().getSpan());
+            }
+
+            builder.put(hiveColumnHandle, new Domain(ranges, entry.getValue().isNullAllowed()));
         }
         return TupleDomain.withColumnDomains(builder.build());
     }",0
fixed #32 TypeDecoder.decodeBytes to respect offset,"         } else if (Bool.class.isAssignableFrom(type)) {
             return (T) decodeBool(input);
         } else if (Bytes.class.isAssignableFrom(type)) {
-            return (T) decodeBytes(input, (Class<Bytes>) type);
+            return (T) decodeBytes(input, offset, (Class<Bytes>) type);
         } else if (DynamicBytes.class.isAssignableFrom(type)) {
             return (T) decodeDynamicBytes(input, offset);
         } else if (Utf8String.class.isAssignableFrom(type)) {
@@ -132,13 +132,17 @@
     }
 
     static <T extends Bytes> T decodeBytes(String input, Class<T> type) {
+    	return decodeBytes(input, 0, type);
+    }
+    
+    static <T extends Bytes> T decodeBytes(String input, int offset, Class<T> type) {
         try {
             String simpleName = type.getSimpleName();
             String[] splitName = simpleName.split(Bytes.class.getSimpleName());
             int length = Integer.parseInt(splitName[1]);
             int hexStringLength = length << 1;
 
-            byte[] bytes = Numeric.hexStringToByteArray(input.substring(0, hexStringLength));
+            byte[] bytes = Numeric.hexStringToByteArray(input.substring(offset, offset+hexStringLength));
             return type.getConstructor(byte[].class).newInstance(bytes);
         } catch (NoSuchMethodException | SecurityException |
                 InstantiationException | IllegalAccessException |",0
Correct state of adv option in Spider dialogue,"         this.addCheckBoxField(0, FIELD_RECURSE, true);
         this.addCheckBoxField(0, FIELD_SUBTREE_ONLY, subtreeOnlyPreviousCheckedState);
         // This option is always read from the 'global' options
-        this.addCheckBoxField(0, FIELD_ADVANCED, getSpiderParam().isShowAdvancedDialog());
+        this.addCheckBoxField(0, FIELD_ADVANCED, extension.getSpiderParam().isShowAdvancedDialog());
         this.addPadding(0);
 
         // Advanced options",0
Fix ForeignAccess of ComplexNumbersB,"     }
 
     public ForeignAccess getForeignAccess() {
-        return ComplexNumbersAForeign.ACCESS;
+        return ComplexNumbersBForeign.ACCESS;
     }
 
     public static boolean isInstance(TruffleObject obj) {",0
Fix validation of @SupposeXXX,"  */
 package org.androidannotations.handler;
 
+import javax.annotation.processing.ProcessingEnvironment;
+import javax.lang.model.element.Element;
+
 import org.androidannotations.holder.EComponentHolder;
 import org.androidannotations.model.AnnotationElements;
 import org.androidannotations.process.IsValid;
 
-import javax.annotation.processing.ProcessingEnvironment;
-import javax.lang.model.element.Element;
-
 public abstract class SupposeThreadHandler extends BaseAnnotationHandler<EComponentHolder> {
 
 	public SupposeThreadHandler(Class<?> targetClass, ProcessingEnvironment processingEnvironment) {
@@ -32,6 +32,7 @@
 	protected void validate(Element element, AnnotationElements validatedElements, IsValid valid) {
 		validatorHelper.enclosingElementHasEnhancedComponentAnnotation(element, validatedElements, valid);
 		validatorHelper.isNotPrivate(element, valid);
+		validatorHelper.isNotFinal(element, valid);
 	}
 
 }",0
fix compile error," 
 package com.navercorp.pinpoint.collector.receiver.tcp;
 
+import java.net.InetAddress;
 import java.net.SocketAddress;
 import java.net.UnknownHostException;
 import java.util.ArrayList;
@@ -50,7 +51,6 @@
 import com.navercorp.pinpoint.rpc.server.ServerMessageListener;
 import com.navercorp.pinpoint.rpc.util.MapUtils;
 import com.navercorp.pinpoint.thrift.io.DeserializerFactory;
-import com.navercorp.pinpoint.thrift.io.Header;
 import com.navercorp.pinpoint.thrift.io.HeaderTBaseDeserializer;
 import com.navercorp.pinpoint.thrift.io.HeaderTBaseDeserializerFactory;
 import com.navercorp.pinpoint.thrift.io.HeaderTBaseSerializer;",0
:bug: 胜利之后session不清除," import org.b3log.latke.Keys;
 import org.b3log.latke.ioc.LatkeBeanManager;
 import org.b3log.latke.ioc.Lifecycle;
+import org.b3log.latke.ioc.inject.Inject;
 import org.b3log.latke.logging.Logger;
 import org.b3log.latke.model.User;
 import org.b3log.latke.service.ServiceException;
@@ -29,14 +30,20 @@
 import org.json.JSONException;
 import org.json.JSONObject;
 
-import org.b3log.latke.ioc.inject.Inject;;
-import javax.websocket.*;
+import javax.websocket.CloseReason;
+import javax.websocket.OnClose;
+import javax.websocket.OnError;
+import javax.websocket.OnMessage;
+import javax.websocket.OnOpen;
+import javax.websocket.Session;
 import javax.websocket.server.ServerEndpoint;
 import java.util.Map;
 import java.util.Queue;
 import java.util.concurrent.ConcurrentHashMap;
 import java.util.concurrent.ConcurrentLinkedQueue;
 
+;
+
 /**
  * Gobang game channel.
  * <p>
@@ -261,8 +268,8 @@
                     if (flag) {
                         final ActivityMgmtService activityMgmtService = beanManager.getReference(ActivityMgmtService.class);
                         activityMgmtService.collectGobang(player, Pointtransfer.TRANSFER_SUM_C_ACTIVITY_GOBANG_START * 2);
-
-                        chessPlaying.remove(chessGame);
+                        SESSIONS.remove(player);
+                        SESSIONS.remove(anti);
                     }
                 }
                 break;
@@ -282,6 +289,8 @@
                     activityMgmtService.collectGobang(anti, Pointtransfer.TRANSFER_SUM_C_ACTIVITY_GOBANG_START);
                     SESSIONS.get(player).getAsyncRemote().sendText(sendText.toString());
                     SESSIONS.get(anti).getAsyncRemote().sendText(sendText.toString());
+                    SESSIONS.remove(player);
+                    SESSIONS.remove(anti);
                 }else if(""no"".equals(jsonObject.optString(""drawType""))){
                     sendText.put(""type"", 6);
                     sendText.put(""message"", ""【系统】：对手拒绝和棋，请继续下棋"");",0
JsonMappingException fix when compiling a solidity contract with eth_compileSolidity,"         public Code() {
         }
 
+        public Code(String code) {
+            this.code = code;
+        }
+
         public Code(String code, SolidityInfo info) {
             this.code = code;
             this.info = info;",0
fix typo for map put exception message as array add,"             if(configuration.jsonProvider().isMap(parent)){
                 configuration.jsonProvider().setProperty(parent, key, newVal);
             } else {
-                throw new InvalidModificationException(""Invalid add operation. $ is not an array"");
+                throw new InvalidModificationException(""Invalid put operation. $ is not a map"");
             }
         }
     }",0
[FIXED JENKINS-26382] Allow admin signup from /manage as well,"         public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
             HttpServletRequest req = (HttpServletRequest) request;
 
-            if(req.getRequestURI().equals(req.getContextPath()+""/"")) {
+            /* allow signup from the Jenkins home page, or /manage, which is where a /configureSecurity form redirects to */
+            if(req.getRequestURI().equals(req.getContextPath()+""/"") || req.getRequestURI().equals(req.getContextPath() + ""/manage"")) {
                 if (needsToCreateFirstUser()) {
                     ((HttpServletResponse)response).sendRedirect(""securityRealm/firstUser"");
                 } else {// the first user already created. the role of this filter is over.",0
fix #1074,"             settings.getFormat().setQuoteEscape(loadData.getEscape().charAt(0));
             }
             settings.getFormat().setNormalizedNewline(loadData.getLineTerminatedBy().charAt(0));
+            /*
+             *  fix bug #1074 : LOAD DATA local INFILE导入的所有Boolean类型全部变成了false
+             *  不可见字符将在CsvParser被当成whitespace过滤掉, 使用settings.trimValues(false)来避免被过滤掉
+             *  TODO : 设置trimValues(false)之后, 会引起字段值前后的空白字符无法被过滤!
+             */
+            settings.trimValues(false);
             CsvParser parser = new CsvParser(settings);
             try
             {
@@ -689,6 +695,12 @@
             settings.getFormat().setQuoteEscape(loadData.getEscape().charAt(0));
         }
         settings.getFormat().setNormalizedNewline(loadData.getLineTerminatedBy().charAt(0));
+        /*
+         *  fix #1074 : LOAD DATA local INFILE导入的所有Boolean类型全部变成了false
+         *  不可见字符将在CsvParser被当成whitespace过滤掉, 使用settings.trimValues(false)来避免被过滤掉
+         *  TODO : 设置trimValues(false)之后, 会引起字段值前后的空白字符无法被过滤!
+         */
+        settings.trimValues(false);
         CsvParser parser = new CsvParser(settings);
         InputStreamReader reader = null;
         FileInputStream fileInputStream = null;",0
Fixes #205 reactor.core.publisher.FluxPeekFuseable.PeekFuseableSubscr…," 					parent.onNextCall().accept(v);
 				}
 				catch (Throwable e) {
-					onError(Operators.onOperatorError(s, e, v));
+					throw Exceptions.propagate(Operators.onOperatorError(s, e, v));
 				}
 			}
 			if (v == null && sourceMode == SYNC) {
@@ -498,7 +498,7 @@
 					parent.onNextCall().accept(v);
 				}
 				catch (Throwable e) {
-					onError(Operators.onOperatorError(s, e, v));
+					throw Exceptions.propagate(Operators.onOperatorError(s, e, v));
 				}
 			}
 			if (v == null && sourceMode == SYNC) {",0
ChunkedWriteHandler: avoid writing two times the same message,"                 ctx.flush();
                 requiresFlush = false;
             } else {
-                ctx.write(pendingMessage, currentWrite.promise);
                 this.currentWrite = null;
+                ctx.write(pendingMessage, currentWrite.promise);
                 requiresFlush = true;
             }
 ",0
add prefix when initialize the s3endpoint and bucket check. ,"         String bucketName = getConfiguration().getBucketName();
         LOG.trace(""Querying whether bucket [{}] already exists..."", bucketName);
 
+        String prefix = getConfiguration().getPrefix();
+
         try {
-            s3Client.listObjects(new ListObjectsRequest(bucketName, null, null, null, 0));
+            s3Client.listObjects(new ListObjectsRequest(bucketName, prefix, null, null, 0));
             LOG.trace(""Bucket [{}] already exists"", bucketName);
             return;
         } catch (AmazonServiceException ase) {",0
fix method name typo," 	 */
 
 	public ArrayList<WebElement> getWebElementsFromWebViews(){
-		waitForWebElementsToBeCreted();
+		waitForWebElementsToBeCreated();
 		return new ArrayList<WebElement>(webElements);
 	}
 
@@ -164,7 +164,7 @@
 	 * @return true if successfully created before timout
 	 */
 
-	private boolean waitForWebElementsToBeCreted(){
+	private boolean waitForWebElementsToBeCreated(){
 		final long endTime = SystemClock.uptimeMillis() + 5000;
 
 		while(SystemClock.uptimeMillis() < endTime){",0
Pick a suitable config (8888) when background is transparent,"         final int glesMajorVersion = Capabilities.getGLESMajorVersion();
         setEGLContextClientVersion(glesMajorVersion);
 
-        setEGLConfigChooser(new RajawaliEGLConfigChooser(glesMajorVersion, mAntiAliasingConfig, mMultiSampleCount,
-            mBitsRed, mBitsGreen, mBitsBlue, mBitsAlpha, mBitsDepth));
-
         if (mIsTransparent) {
+            setEGLConfigChooser(new RajawaliEGLConfigChooser(glesMajorVersion, mAntiAliasingConfig, mMultiSampleCount,
+                    8, 8, 8, 8, mBitsDepth));
+
             getHolder().setFormat(PixelFormat.TRANSLUCENT);
             setZOrderOnTop(true);
         } else {
+            setEGLConfigChooser(new RajawaliEGLConfigChooser(glesMajorVersion, mAntiAliasingConfig, mMultiSampleCount,
+                    mBitsRed, mBitsGreen, mBitsBlue, mBitsAlpha, mBitsDepth));
+
             getHolder().setFormat(PixelFormat.RGBA_8888);
             setZOrderOnTop(false);
         }",0
Make layout processor use SourceVersion.latest to avoid warnings duri…,"  */
 package com.oracle.truffle.object.dsl.processor;
 
-import com.oracle.truffle.api.object.dsl.Layout;
-import com.oracle.truffle.object.dsl.processor.model.LayoutModel;
-
-import javax.annotation.processing.AbstractProcessor;
-import javax.annotation.processing.RoundEnvironment;
-import javax.annotation.processing.SupportedAnnotationTypes;
-import javax.annotation.processing.SupportedSourceVersion;
-import javax.lang.model.SourceVersion;
-import javax.lang.model.element.Element;
-import javax.lang.model.element.TypeElement;
-import javax.tools.JavaFileObject;
-import javax.tools.Diagnostic.Kind;
-
 import java.io.IOException;
 import java.io.PrintStream;
 import java.util.Set;
 
+import javax.annotation.processing.AbstractProcessor;
+import javax.annotation.processing.RoundEnvironment;
+import javax.annotation.processing.SupportedAnnotationTypes;
+import javax.lang.model.SourceVersion;
+import javax.lang.model.element.Element;
+import javax.lang.model.element.TypeElement;
+import javax.tools.Diagnostic.Kind;
+import javax.tools.JavaFileObject;
+
+import com.oracle.truffle.api.object.dsl.Layout;
+import com.oracle.truffle.object.dsl.processor.model.LayoutModel;
+
 @SupportedAnnotationTypes(""com.oracle.truffle.api.object.dsl.Layout"")
-@SupportedSourceVersion(SourceVersion.RELEASE_7)
 public class LayoutProcessor extends AbstractProcessor {
 
     @Override
@@ -52,6 +50,11 @@
         return true;
     }
 
+    @Override
+    public SourceVersion getSupportedSourceVersion() {
+        return SourceVersion.latest();
+    }
+
     private void processLayout(TypeElement layoutElement) {
         try {
             final LayoutParser parser = new LayoutParser(this);",0
Fix tracking of input rows/bytes for JOIN stages," import com.facebook.presto.execution.StateMachine.StateChangeListener;
 import com.facebook.presto.spi.ErrorCode;
 import com.facebook.presto.spi.PrestoException;
+import com.facebook.presto.sql.planner.plan.TableScanNode;
 import com.google.common.base.Preconditions;
 import com.google.common.base.Predicate;
 import com.google.common.base.Predicates;
 import com.google.common.collect.FluentIterable;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableSet;
+import com.google.common.collect.Iterables;
 import io.airlift.log.Logger;
 import io.airlift.units.DataSize;
 import io.airlift.units.Duration;
@@ -190,7 +192,7 @@
                 totalUserTime += stageStats.getTotalUserTime().roundTo(NANOSECONDS);
                 totalBlockedTime += stageStats.getTotalBlockedTime().roundTo(NANOSECONDS);
 
-                if (stageInfo.getSubStages().isEmpty()) {
+                if (Iterables.any(stageInfo.getPlan().getSources(), Predicates.instanceOf(TableScanNode.class))) {
                     rawInputDataSize += stageStats.getRawInputDataSize().toBytes();
                     rawInputPositions += stageStats.getRawInputPositions();
 ",0
Small fix for LocalAddress.compareTo,"                 }
 
                 int a = System.identityHashCode(this);
-                int b = System.identityHashCode(this);
+                int b = System.identityHashCode(o);
                 if (a < b) {
                     return -1;
                 } else if (a > b) {",0
Added debug and info log messages that I found missing.,"             digestString(md, securityKey);
             ssalt = md.digest();
         }
+
+        UndertowLogger.ROOT_LOGGER.infof(""Undertow starts mod_cluster proxy advertisements on %s with frequency %d ms."", address, config.getAdvertiseFrequency());
     }
 
     private static final String CRLF = ""\r\n"";
@@ -159,9 +161,10 @@
 
             final String payload = builder.toString();
             final ByteBuffer byteBuffer = ByteBuffer.wrap(payload.getBytes());
+            UndertowLogger.ROOT_LOGGER.debugf(""Gonna send payload: \n%s"", payload);
             channel.sendTo(address, byteBuffer);
         } catch (Exception e) {
-            UndertowLogger.ROOT_LOGGER.errorf(e, ""Cannot send advertise message"");
+            UndertowLogger.ROOT_LOGGER.errorf(e, ""Cannot send advertise message. address: %s"", address);
         }
     }
 ",0
Fixed #998: javadoc of Lazy,"  * <pre>
  * <code>
  * final Lazy&lt;Double&gt; l = Lazy.of(Math::random);
- * l.isDefined(); // = false
+ * l.isEvaluated(); // = false
  * l.get();       // = 0.123 (random generated)
- * l.isDefined(); // = true
+ * l.isEvaluated(); // = true
  * l.get();       // = 0.123 (memoized)
  * </code>
  * </pre>",0
Fix issues loading fail,"                 })
                 .flatMap(issue -> getAllComments(repo.owner().login(), repo.name(), issue)
                         .zipWith(Single.just(issue),
-                                (comments, issue1) -> new FullIssue(issue1, comments, null)))
+                                (comments, issue1) -> new FullIssue(issue1, comments, Collections.emptyList())))
                 .zipWith(getAllEvents(repo.owner().login(), repo.name(), issueNumber),
                         (fullIssue, issueEvents) -> new FullIssue(fullIssue.getIssue(),
                                 fullIssue.getComments(), issueEvents))",0
FIX: Don't start the Smack Debugger UI by default.,"      */
     public void start(BundleContext context) throws Exception
     {
-        SmackConfiguration.DEBUG = true;
         // Disables unused class, throwing some errors on login (disco-info)
         SmackConfiguration.addDisabledSmackClass(
             ""org.jivesoftware.smackx.httpfileupload.HttpFileUploadManager"");",0
fix the default log file name to crate.log," public class CrateSettingsPreparer {
 
     public static Environment prepareEnvironment(Map<String, String> cmdLineSettings, Path configPath) throws UserException {
+        // just create enough settings to build the environment, to get the config dir
         Settings.Builder settingsBuilder = Settings.builder();
         settingsBuilder.putProperties(cmdLineSettings, Function.identity());
         settingsBuilder.replacePropertyPlaceholders();
         Environment env = new Environment(settingsBuilder.build(), configPath);
 
-        try {
-            // Logging needs to be initialized before any Crate logging code runs
+        // add error listener before everything else
             LogConfigurator.registerErrorListener();
-            LogConfigurator.configure(env);
-        } catch (IOException e) {
-            throw new UserException(1, ""Couldn't read log4j2.properties configuration file."", e);
-        }
 
         Path path = env.configFile().resolve(""crate.yml"");
         if (Files.exists(path)) {
@@ -80,15 +76,23 @@
             }
         }
 
-        // Override settings with settings from the command-line
+        // re-initialize settings now that the config file has been loaded
         settingsBuilder.putProperties(cmdLineSettings, Function.identity());
         settingsBuilder.replacePropertyPlaceholders();
 
-        validateKnownSettings(settingsBuilder);
+        // apply Crate defaults BEFORE configuring logging, because the default cluster name influences the log file name
         applyCrateDefaults(settingsBuilder);
-
         env = new Environment(settingsBuilder.build(), env.configFile());
 
+        try {
+            LogConfigurator.configure(env);
+        } catch (IOException e) {
+            throw new UserException(1, ""Couldn't read log4j2.properties configuration file."", e);
+        }
+
+        // validating settings initializes loggers in the Crate code, therefore we must do it only AFTER configuration
+        validateKnownSettings(settingsBuilder);
+
         // we put back the path.logs so we can use it in the logging configuration file
         settingsBuilder.put(
             Environment.PATH_LOGS_SETTING.getKey(),",0
	Fix issue #77," import android.app.Activity;
 import android.app.Application;
 import android.app.Instrumentation;
+import android.content.ActivityNotFoundException;
 import android.content.ComponentName;
 import android.content.ContextWrapper;
 import android.content.pm.ActivityInfo;
@@ -395,6 +396,20 @@
         } else if (activityName.startsWith(""."")) {
             activityName = bundle.getPackageName() + activityName;
         }
+        if (!sLoadedActivities.containsKey(activityName)) {
+            if (!activityName.endsWith(""Activity"")) {
+                throw new ActivityNotFoundException(""Unable to find explicit activity class { "" +
+                        activityName + ""}"");
+            }
+
+            String tempActivityName = activityName + ""Activity"";
+            if (!sLoadedActivities.containsKey(tempActivityName)) {
+                throw new ActivityNotFoundException(""Unable to find explicit activity class { "" +
+                        activityName + ""or"" + tempActivityName + ""}"");
+            }
+
+            activityName = tempActivityName;
+        }
         intent.setComponent(new ComponentName(Small.getContext(), activityName));
         // Intent extras - params
         String query = bundle.getQuery();",0
JENKINS-37429# Fix circular dependency that cause errors during plugi…," package io.jenkins.blueocean.rest;
 
-import com.google.inject.Inject;
 import hudson.Extension;
 import hudson.ExtensionList;
 import io.jenkins.blueocean.BlueOceanUI;
@@ -10,6 +9,7 @@
 import io.jenkins.blueocean.rest.pageable.Pageable;
 import io.jenkins.blueocean.rest.pageable.Pageables;
 import io.jenkins.blueocean.rest.pageable.PagedResponse;
+import jenkins.model.Jenkins;
 import org.kohsuke.stapler.QueryParameter;
 import org.kohsuke.stapler.Stapler;
 import org.kohsuke.stapler.StaplerRequest;
@@ -27,8 +27,7 @@
 @Extension
 public final class ApiHead implements RootRoutable, Reachable  {
 
-    @Inject
-    private BlueOceanUI blueOceanUI;
+    private volatile BlueOceanUI blueOceanUI;
 
     private final Map<String,ApiRoutable> apis = new HashMap<>();
 
@@ -85,6 +84,7 @@
 
     @Override
     public Link getLink() {
+        setBlueOceanUI(); //lazily initialize BlueOceanUI
         return new Link(""/""+blueOceanUI.getUrlBase()).rel(getUrlName());
     }
 
@@ -100,4 +100,18 @@
 
         return null;
     }
+
+    // Lazy initialize BlueOcean UI via injection
+    // Fix for: https://issues.jenkins-ci.org/browse/JENKINS-37429
+    private void setBlueOceanUI(){
+        BlueOceanUI boui = blueOceanUI;
+        if(boui == null){
+            synchronized (this){
+                boui = blueOceanUI;
+                if(boui == null){
+                    blueOceanUI = boui = Jenkins.getInstance().getInjector().getInstance(BlueOceanUI.class);
+                }
+            }
+        }
+    }
 }",0
Export - fix java not being embedded on 64bit,"           }
           // export the 64-bit version
           folder = new File(sketch.getFolder(), ""application."" + platformName + ""64"");
-          if (!exportApplication(folder, platform, ""64"", embedJava && Platform.getNativeBits() == 64 && ""x86"".equals(Platform.getNativeArch()))) {
+          if (!exportApplication(folder, platform, ""64"", embedJava && Platform.getNativeBits() == 64 && ""amd64"".equals(Platform.getNativeArch()))) {
             return false;
           }
           if (platform == PConstants.LINUX) {",0
Fixing substring-index in ProxyPeerAddress Handler,"             if (index == -1) {
                 value = forwardedFor;
             } else {
-                value = forwardedFor.substring(0, index - 1);
+                value = forwardedFor.substring(0, index);
             }
             InetAddress address = InetAddress.getByName(value);
             //we have no way of knowing the port",0
Fixes onKey ArrayIndexOutOfBoundsException on negative keycodes," 			char character = (char)e.getUnicodeChar();
 			// Android doesn't report a unicode char for back space. hrm...
 			if (keyCode == 67) character = '\b';
-			if (e.getKeyCode() >= SUPPORTED_KEYS) return false;
+			if (e.getKeyCode() < 0 || e.getKeyCode() >= SUPPORTED_KEYS) {
+				return false;
+			}
 			
 			switch (e.getAction()) {
 			case android.view.KeyEvent.ACTION_DOWN:",0
Fixed: PullToRefreshListView would scroll to position 1 even if mRefreshView was not visible.,"     @Override
     public void setAdapter(ListAdapter adapter) {
         super.setAdapter(adapter);
-
         setSelection(1);
     }
 
@@ -372,7 +371,7 @@
 
         // If refresh view is visible when loading completes, scroll down to
         // the next item.
-        if (mRefreshView.getBottom() > 0) {
+        if (getFirstVisiblePosition() == 0) {
             invalidateViews();
             setSelection(1);
         }",0
Fix a rare NPE crash in Android 2.x,"                 }
             }
         }
+        catch (NullPointerException e) {
+            throw new AsyncSelectorException(e);
+        }
         catch (IOException e) {
             throw new AsyncSelectorException(e);
         }",0
[java] Fix BooleanInstantiationRule for Java 8,"  */
 package net.sourceforge.pmd.lang.java.rule.basic;
 
+import net.sourceforge.pmd.lang.ast.Node;
 import net.sourceforge.pmd.lang.java.ast.ASTAllocationExpression;
 import net.sourceforge.pmd.lang.java.ast.ASTArrayDimsAndInits;
 import net.sourceforge.pmd.lang.java.ast.ASTBooleanLiteral;
@@ -63,7 +64,9 @@
 	        if (node.hasDescendantOfType(ASTArrayDimsAndInits.class)) {
 	            return super.visit(node, data);
 	        }
-	        if (TypeHelper.isA((ASTClassOrInterfaceType) node.jjtGetChild(0), Boolean.class)) {
+	        
+	        Node n1 = node.getFirstChildOfType(ASTClassOrInterfaceType.class);
+	    	if (TypeHelper.isA((ASTClassOrInterfaceType) n1, Boolean.class)) {
                 super.addViolation(data, node);
                 return data;
             }",0
Fix memory leak in task queue space listeners," import com.google.common.collect.ImmutableSetMultimap;
 import com.google.common.collect.Multimap;
 import com.google.common.util.concurrent.ListenableFuture;
+import com.google.common.util.concurrent.MoreExecutors;
 import io.airlift.stats.CounterStat;
 
 import javax.annotation.PreDestroy;
@@ -313,7 +314,7 @@
         if (blockedFutures.isEmpty()) {
             return immediateFuture(null);
         }
-        return whenAnyComplete(blockedFutures);
+        return getFirstCompleteAndCancelOthers(blockedFutures);
     }
 
     public static ListenableFuture<?> toWhenHasSplitQueueSpaceFuture(List<RemoteTask> existingTasks, int spaceThreshold)
@@ -324,6 +325,20 @@
         List<ListenableFuture<?>> stateChangeFutures = existingTasks.stream()
                 .map(remoteTask -> remoteTask.whenSplitQueueHasSpace(spaceThreshold))
                 .collect(toImmutableList());
-        return whenAnyComplete(stateChangeFutures);
+        return getFirstCompleteAndCancelOthers(stateChangeFutures);
+    }
+
+    private static ListenableFuture<?> getFirstCompleteAndCancelOthers(List<ListenableFuture<?>> blockedFutures)
+    {
+        // wait for the first task to unblock and then cancel all futures to free up resources
+        ListenableFuture<?> result = whenAnyComplete(blockedFutures);
+        result.addListener(
+                () -> {
+                    for (ListenableFuture<?> blockedFuture : blockedFutures) {
+                        blockedFuture.cancel(true);
+                    }
+                },
+                MoreExecutors.directExecutor());
+        return result;
     }
 }",0
remove the from attribute from sendStartStream() fixes #1419," 
 	private void sendStartStream() throws IOException {
 		final Tag stream = Tag.start(""stream:stream"");
-		stream.setAttribute(""from"", account.getJid().toBareJid().toString());
 		stream.setAttribute(""to"", account.getServer().toString());
 		stream.setAttribute(""version"", ""1.0"");
 		stream.setAttribute(""xml:lang"", ""en"");",0
[WIP] Fix typo/build issue in CnnSentenceDataSetIterator,"                     features.put(indices, vector);
                 }
             }
-
-            F {
         }
 
         DataSet ds = new DataSet(features, labels, featuresMask, null);",0
Fix for the eclipse compiler.," 
     public static CollectionType collectionTypeFor(TypeMirror typeMirror, TypeMirror genericClassTypeMirror, Elements elements, Types types) {
         CollectionType collectionType = null;
-        switch (genericClassTypeMirror.toString()) {
+        
+        String typeMirrorInfo = genericClassTypeMirror.toString().replaceAll(""<.*>"", """");
+        
+        switch (typeMirrorInfo) {
             case ""java.util.List"":
             case ""java.util.ArrayList"":
-                collectionType = new ArrayListCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new ArrayListCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.LinkedList"":
-                collectionType = new LinkedListCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new LinkedListCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.Map"":
             case ""java.util.HashMap"":
-                collectionType = new HashMapCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new HashMapCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.TreeMap"":
-                collectionType = new TreeMapCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new TreeMapCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.LinkedHashMap"":
-                collectionType = new LinkedHashMapCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new LinkedHashMapCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.Set"":
             case ""java.util.HashSet"":
-                collectionType = new SetCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new SetCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
             case ""java.util.Queue"":
             case ""java.util.Deque"":
             case ""java.util.ArrayDeque"":
-                collectionType = new QueueCollectionType(ClassName.bestGuess(genericClassTypeMirror.toString()));
+                collectionType = new QueueCollectionType(ClassName.bestGuess(typeMirrorInfo));
                 break;
         }
 ",0
Fix: issue-579," import java.util.ArrayList;
 import java.util.Date;
 import java.util.concurrent.CountDownLatch;
+import java.util.concurrent.TimeUnit;
 import com.robotium.solo.Solo.Config;
 import com.robotium.solo.Solo.Config.ScreenshotFileType;
 import android.graphics.Bitmap;
@@ -32,6 +33,8 @@
 
 class ScreenshotTaker {
 
+    private static final long TIMEOUT_SCREENSHOT_MUTEX = TimeUnit.SECONDS.toMillis(2);
+    private final Object screenshotMutex = new Object();
 	private final Config config;
 	private final ActivityUtils activityUtils;
 	private final String LOG_TAG = ""Robotium"";
@@ -73,7 +76,14 @@
 
 		initScreenShotSaver();
 		ScreenshotRunnable runnable = new ScreenshotRunnable(decorView, name, quality);
+
+        synchronized (screenshotMutex) {
 		activityUtils.getCurrentActivity(false).runOnUiThread(runnable);
+            try {
+                screenshotMutex.wait(TIMEOUT_SCREENSHOT_MUTEX);
+            } catch (InterruptedException ignored) {
+            }
+        }
 	}
 
 	/**
@@ -351,10 +361,18 @@
 				if(b != null) {
 					screenShotSaver.saveBitmap(b, name, quality);
 					b = null;
+                    // Return here so that the screenshotMutex is not unlocked,
+                    // since this is handled by save bitmap
+                    return;
 				}
 				else 
 					Log.d(LOG_TAG, ""NULL BITMAP!!"");
 			}
+
+            // Make sure the screenshotMutex is unlocked
+            synchronized (screenshotMutex) {
+                screenshotMutex.notify();
+            }
 		}
 	}
 
@@ -395,6 +413,7 @@
 		 * @param message A Message containing the bitmap to save, and some metadata.
 		 */
 		public void handleMessage(Message message) {
+            synchronized (screenshotMutex) {
 			String name = message.getData().getString(""name"");
 			int quality = message.arg1;
 			Bitmap b = (Bitmap)message.obj;
@@ -405,6 +424,9 @@
 			else {
 				Log.d(LOG_TAG, ""NULL BITMAP!!"");
 			}
+
+                screenshotMutex.notify();
+            }
 		}
 
 		/**",0
JENKINS-45589 Fix NPE when matching queued items,"     public static BlueQueueItem getQueuedItem(final hudson.model.Queue.Item item, Job job) {
 
         for(BlueQueueItem qi: getQueuedItems(job)){
-            if(qi.getId().equalsIgnoreCase(Long.toString(item.getId()))){
+            if(qi.getId() != null && qi.getId().equalsIgnoreCase(Long.toString(item.getId()))){
                 return qi;
             }
         }",0
Small fix in RequestHandle class.," /**
  * A Handle to an AsyncRequest which can be used to cancel a running request.
  */
-public class RequestHandle {
+class RequestHandle {
     private final WeakReference<AsyncHttpRequest> request;
 
     public RequestHandle(AsyncHttpRequest request) {
-        this.request = new WeakReference<AsyncHttpRequest>(request);
+        this.request = new WeakReference(request);
     }
 
     /**",0
Fix LazyLoading Lists Breaking DumpVisitor," 		printer.print(""enum "");
 		printer.print(n.getName());
 
-		if (n.getImplements() != null) {
+		if (!n.getImplements().isEmpty()) {
 			printer.print("" implements "");
 			for (final Iterator<ClassOrInterfaceType> i = n.getImplements().iterator(); i.hasNext();) {
 				final ClassOrInterfaceType c = i.next();
@@ -1275,7 +1275,7 @@
 			printArguments(n.getArgs(), arg);
 		}
 
-		if (n.getClassBody() != null) {
+		if (!n.getClassBody().isEmpty()) {
 			printer.printLn("" {"");
 			printer.indent();
 			printMembers(n.getClassBody(), arg);
@@ -1596,7 +1596,7 @@
         }
 
         printer.print(""::"");
-        if (n.getTypeParameters() != null) {
+        if (!n.getTypeParameters().isEmpty()) {
             printer.print(""<"");
             for (Iterator<TypeParameter> i = n.getTypeParameters().iterator(); i
                     .hasNext();) {",0
Fixed modules filter,"                                                     sortedModules.add(m);
                                                 }
                                         }
-                                    moduleList.update(0.1f);
                                 }
                         });
                 }
@@ -513,6 +512,8 @@
                     int pos = Collections.binarySearch(sortedModules, info, moduleInfoComparator);
                     if (pos < 0) {                             // not yet in the (sorted) list
                         sortedModules.add(-pos - 1, info);     // use ""insertion point"" to keep the list sorted
+                        allSortedModules.clear();
+                        allSortedModules.addAll(sortedModules);
                     }
                 }
                 info.setOnlineVersion(remote);",0
[python] Fixes and improvements to enum handling,"                     ""    def get%1$s(self):\n"" +
                     ""        sizeOfLengthField = %3$d\n"" +
                     ""        lengthPosition = self.getPosition()\n"" +
-                    ""        dataLength = struct.unpack_from('%5$s', self.buffer_, lengthPosition[0])[0]\n"" +
-                    ""        self.setPosition(lengthPosition[0] + sizeOfLengthField)\n"" +
+                    ""        dataLength = struct.unpack_from('%5$s', self.buffer_, lengthPosition)[0]\n"" +
+                    ""        self.setPosition(lengthPosition + sizeOfLengthField)\n"" +
                     ""        pos = self.getPosition()\n"" +
-                    ""        fmt = '"" + byteOrder + ""'+str(dataLength)+'c'\n"" +
-                    ""        data = struct.unpack_from(fmt, self.buffer_, lengthPosition[0])\n"" +
-                    ""        self.setPosition(pos[0] + dataLength)\n"" +
+                    ""        fmt = '"" + byteOrder + ""' + str(dataLength) + 's'\n"" +
+                    ""        data = struct.unpack_from(fmt, self.buffer_, pos)[0]\n"" +
+                    ""        self.setPosition(pos + dataLength)\n"" +
                     ""        return data\n\n"",
                     propertyName,
                     generateArrayFieldNotPresentCondition(token.version(), BASE_INDENT),
@@ -332,13 +332,12 @@
                     ""    def set%1$s(self, buffer):\n"" +
                     ""        sizeOfLengthField = %2$d\n"" +
                     ""        lengthPosition = self.getPosition()\n"" +
-                    ""        struct.pack_into('%3$s', self.buffer_, lengthPosition[0], len(buffer))\n"" +
-                    ""        self.setPosition(lengthPosition[0] + sizeOfLengthField)\n"" +
+                    ""        struct.pack_into('%3$s', self.buffer_, lengthPosition, len(buffer))\n"" +
+                    ""        self.setPosition(lengthPosition + sizeOfLengthField)\n"" +
                     ""        pos = self.getPosition()\n"" +
-                    ""        fmt = '"" + byteOrder + ""c'\n"" +
-                    ""        for i in range(0,len(buffer)):\n"" +
-                    ""           struct.pack_into(fmt, self.buffer_, lengthPosition[0]+i, buffer[i])\n"" +
-                    ""        self.setPosition(pos[0] + len(buffer))\n\n"",
+                    ""        fmt = '"" + byteOrder + ""' + str(len(buffer)) + 's'\n"" +
+                    ""        struct.pack_into(fmt, self.buffer_, pos, buffer)\n"" +
+                    ""        self.setPosition(pos + len(buffer))\n\n"",
                     propertyName,
                     sizeOfLengthField,
                     lengthPythonType,
@@ -394,7 +393,7 @@
 
         sb.append(String.format(
             ""    def %1$sLength(self):\n"" +
-            ""        return struct.unpack_from('%4$s', self.buffer_, position())[0]\n\n"",
+            ""        return struct.unpack_from('%4$s', self.buffer_, getPosition())[0]\n\n"",
             formatPropertyName(propertyName),
             generateArrayFieldNotPresentCondition(token.version(), BASE_INDENT),
             formatByteOrderEncoding(lengthToken.encoding().byteOrder(), lengthToken.encoding().primitiveType()),
@@ -432,9 +431,9 @@
         try (final Writer out = outputManager.createOutput(enumName))
         {
             out.append(generateFileHeader(ir.applicableNamespace().replace('.', '_'), null));
-            out.append(generateEnumDeclaration(enumName));
+            out.append(generateClassDeclaration(enumName));
             out.append(generateEnumValues(tokens.subList(1, tokens.size() - 1), enumToken));
-            out.append(generateEnumLookupMethod(tokens.subList(1, tokens.size() - 1), enumToken));
+            out.append(generateEnumMethods(enumName));
         }
     }
 
@@ -514,55 +513,65 @@
         final StringBuilder sb = new StringBuilder();
         final Encoding encoding = encodingToken.encoding();
 
-        sb.append(""    class Value:\n"");
-
         for (final Token token : tokens)
         {
+            if (encoding.primitiveType() == PrimitiveType.CHAR)
+            {
+                final char constVal = (char) token.encoding().constValue().longValue();
+                sb.append(""    "").append(token.name()).append("" = '"").append(constVal).append(""'\n"");
+            }
+            else
+            {
             final CharSequence constVal = generateLiteral(
                 token.encoding().primitiveType(), token.encoding().constValue().toString());
             sb.append(""        "").append(token.name()).append("" = "").append(constVal).append(""\n"");
         }
+        }
 
+        // generate the null value
+
+        if (encoding.primitiveType() == PrimitiveType.CHAR)
+        {
+            sb.append(""    NULL_VALUE = '\\0'"");
+        }
+        else
+        {
         sb.append(String.format(
             ""        NULL_VALUE = %1$s"",
             generateLiteral(encoding.primitiveType(), encoding.applicableNullValue().toString())
         ));
-
+        }
         sb.append(""\n\n"");
 
+        sb.append(""    VALID_VALUES = {\n"");
+        for (final Token token : tokens)
+        {
+            sb.append(""        "").append(token.name()).append("",\n"");
+        }
+        sb.append(""        NULL_VALUE,\n    }\n\n"");
+
+        sb.append(""    AS_TEXT = {\n"");
+
+        for (final Token token : tokens)
+        {
+            sb.append(""        "").append(token.name()).append("" : '"").append(token.name()).append(""',\n"");
+        }
+        sb.append(""        NULL_VALUE : 'NULL_VALUE',\n    }\n\n"");
+
         return sb;
     }
 
-    private CharSequence generateEnumLookupMethod(final List<Token> tokens, final Token encodingToken)
+    private CharSequence generateEnumMethods(final String name)
     {
-        final String enumName = formatClassName(encodingToken.name());
         final StringBuilder sb = new StringBuilder();
 
-        sb.append(
-            ""    @staticmethod\n"" +
-            ""    def get(value):\n"" +
-            ""        values = {\n"");
-
-        for (final Token token : tokens)
-        {
-            sb.append(String.format(
-                ""            %1$s : %3$s.Value.%2$s,\n"",
-                token.encoding().constValue().toString(),
-                token.name(),
-                enumName)
-            );
-        }
-
-        sb.append(String.format(
-            ""            %1$s : %2$s.Value.NULL_VALUE\n"" +
-            ""        }\n"" +
-            ""        if type(value) is int:\n"" +
-            ""            return values[value]\n"" +
-            ""        else:\n"" +
-            ""            return values[ord(value)]\n"",
-            encodingToken.encoding().applicableNullValue().toString(),
-            enumName
-        ));
+        sb.append(""    def __init__(self, value):\n"");
+        sb.append(""        self.value = value\n"");
+        sb.append(""        if self.value not in "").append(name).append("".VALID_VALUES:\n"");
+        sb.append(""            raise ValueError('Invalid value for "").append(name).append("": {}'.format(value))\n"");
+        sb.append(""\n"");
+        sb.append(""    def __str__(self):\n"");
+        sb.append(""        return "").append(name).append("".AS_TEXT[self.value]\n"");
 
         return sb;
     }
@@ -624,11 +633,6 @@
         return ""class "" + name + "":\n"";
     }
 
-    private CharSequence generateEnumDeclaration(final String name)
-    {
-        return ""class "" + name + "":\n"";
-    }
-
     private CharSequence generatePrimitivePropertyEncodings(
         final String containingClassName, final List<Token> tokens, final String indent)
     {
@@ -784,12 +788,12 @@
         ));
 
         sb.append(String.format(
-            indent + ""    def set%1$s(self, index, value):\n"" +
+            indent + ""    def set%2$s(self, index, value):\n"" +
             indent + ""        if index < 0 or index >= %3$d:\n"" +
-            indent + ""            raise Exception('index out of range for %1$s')\n"" +
-            indent + ""        struct.pack_into('%2$s', self.buffer_, self.offset_ + %4$d + (index * %5$d), value)\n"",
-            propertyName,
-            toUpperFirstChar(pythonTypeName),
+            indent + ""            raise Exception('index out of range for %2$s')\n"" +
+            indent + ""        struct.pack_into('%1$s', self.buffer_, self.offset_ + %4$d + (index * %5$d), value)\n"",
+            pythonTypeName,
+            toUpperFirstChar(propertyName),
             token.arrayLength(),
             offset,
             token.encoding().primitiveType().size(),
@@ -928,7 +932,7 @@
             ""        return self\n\n"" +
 
             ""    def getPosition(self):\n"" +
-            ""        return self.position_\n\n"" +
+            ""        return self.position_[0]\n\n"" +
 
             ""    def setPosition(self, position):\n"" +
             ""        if position > self.bufferLength_:\n"" +
@@ -936,7 +940,7 @@
             ""        self.position_[0] = position\n\n"" +
 
             ""    def encodedLength(self):\n"" +
-            ""        return self.position() - self.offset_\n\n"" +
+            ""        return self.getPosition() - self.offset_\n\n"" +
 
             ""    def buffer(self):\n"" +
             ""        return self.buffer_\n\n"" +
@@ -1054,7 +1058,7 @@
         sb.append(String.format(
             ""\n"" +
             indent + ""    def get%2$s(self):\n"" +
-            indent + ""        return %1$s.%1$s.get(struct.unpack_from( '%5$s', self.buffer_, self.offset_ + %6$d)[0])\n\n"",
+            indent + ""        return %1$s.%1$s(struct.unpack_from( '%5$s', self.buffer_, self.offset_ + %6$d)[0])\n\n"",
             enumName,
             toUpperFirstChar(propertyName),
             generateEnumFieldNotPresentCondition(token.version(), enumName, indent),",0
Closing file stream before moving file to destination," package org.broadleafcommerce.cms.file.service;
 
 import org.apache.commons.io.FileUtils;
+import org.apache.commons.io.IOUtils;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.broadleafcommerce.cms.common.AssetNotFoundException;
@@ -158,7 +159,6 @@
     }
     
     protected void createLocalFileFromInputStream(InputStream is, File baseLocalFile) throws IOException {
-        BufferedOutputStream bos = null;
         FileWorkArea workArea = null;
         try {
             if (!baseLocalFile.getParentFile().exists()) {
@@ -177,29 +177,17 @@
             }
             
             workArea = broadleafFileService.initializeWorkArea();
-            File tmpFile = new File(appendTrailingSlash(workArea.getFilePathLocation()) +
-                    baseLocalFile.getName());
+            File tmpFile = new File(workArea.getFilePathLocation(), baseLocalFile.getName());
 
-            bos = new BufferedOutputStream(new FileOutputStream(tmpFile));
+            FileOutputStream tos = new FileOutputStream(tmpFile);
             
-            boolean eof = false;
-            int temp;
-            while (!eof) {
-                temp = is.read();
-                if (temp < 0) {
-                    eof = true;
-                } else {
-                    bos.write(temp);
-                }
-            }
+            IOUtils.copy(is, tos);
+            IOUtils.closeQuietly(is);
+            IOUtils.closeQuietly(tos);
 
             FileUtils.moveFile(tmpFile, baseLocalFile);
         } finally {
             try {
-                if (bos != null) {
-                    bos.flush();
-                    bos.close();
-                }
                 if (workArea != null) {
                     broadleafFileService.closeWorkArea(workArea);
                 }",0
fix zoom issue,"         float middleOfScreenY = (-currentYOffset + getHeight() / 2);
         float middleOfScreenPageX;
         float middleOfScreenPageY;
-        if (swipeVertical) {
+        if (!swipeVertical) {
         	middleOfScreenPageX = middleOfScreenX - userPage * toCurrentScale(optimalPageWidth);
         	middleOfScreenPageY = middleOfScreenY;
         } else {",0
Correct command line args shown on error,"     public static void main(String[] args) throws Exception {
         CommandLine cmdLine = null;
         try {
-            cmdLine = new CommandLine(args);
+            cmdLine = new CommandLine(args != null ? Arrays.copyOf(args, args.length) : null);
 
         } catch (final Exception e) {
         	// Cant use the CommandLine help here as the ",0
Fix render colour on bottom of fluids,"                 tessellator.setBrightness(block.getMixedBrightnessForBlock(world, x, y - 1, z));
                 if (!rises)
                 {
-                    tessellator.setColorOpaque_F(LIGHT_Y_NEG, LIGHT_Y_NEG, LIGHT_Y_NEG);
+                    tessellator.setColorOpaque_F(LIGHT_Y_NEG * red, LIGHT_Y_NEG * green, LIGHT_Y_NEG * blue);
                     renderer.renderFaceYNeg(block, x, y + RENDER_OFFSET, z, block.getIcon(0, bMeta));
                 }
                 else
                 {
-                    tessellator.setColorOpaque_F(LIGHT_Y_POS, LIGHT_Y_POS, LIGHT_Y_POS);
+                    tessellator.setColorOpaque_F(LIGHT_Y_POS * red, LIGHT_Y_POS * green, LIGHT_Y_POS * blue);
                     renderer.renderFaceYPos(block, x, y + RENDER_OFFSET, z, block.getIcon(1, bMeta));
                 }
             }",0
TcpIpConnectionManager shutdown scheduler,"         shutdownAcceptorThread();
         closeServerSocket();
         stop();
+        scheduler.shutdownNow();
         connectionListeners.clear();
     }
 ",0
Fix last request timestamp in price feed service,"     }
 
     public Date getLastRequestTimeStampBtcAverage() {
-        return new Date(epochInSecondAtLastRequest * 1000);
+        return new Date(epochInSecondAtLastRequest);
     }
 
     public Date getLastRequestTimeStampPoloniex() {
         Long ts = timeStampMap.get(""btcAverageTs"");
         if (ts != null) {
-            return new Date(ts * 1000);
+            return new Date(ts);
         } else
             return new Date();
     }
@@ -294,7 +294,7 @@
     public Date getLastRequestTimeStampCoinmarketcap() {
         Long ts = timeStampMap.get(""coinmarketcapTs"");
         if (ts != null) {
-            return new Date(ts * 1000);
+            return new Date(ts);
         } else
             return new Date();
     }",0
Fixed getRunningAverageRssi Beacon class method,"     }
 
     /**
-     * Returns the running average rssi
-     * @param rssi
-     * @return
+     * @deprecated To be removed in a future release. Use
+     * {@link org.altbeacon.beacon.Beacon#getRunningAverageRssi()}
+     * instead.
      */
+    @Deprecated
     public double getRunningAverageRssi(double rssi) {
         return mRunningAverageRssi = rssi;
     }
 
+    /**
+     * Returns the running average rssi
+     * @return double
+     */
+    public double getRunningAverageRssi() {
+        if (mRunningAverageRssi != null){
+            return mRunningAverageRssi;
+        }
+        return mRssi;
+    }
 
     /**
      * Sets the most recently measured rssi for use in distance calculations if a running average is",0
Change API JS script to check if method is defined," 			""  var url = '/' + format + '/' + component + '/' + type + '/' + name + '/'\n"" +
 			""  var form=document.getElementById('zapform');\n"" +
 			""  form.action = url;\n"" +
+			""  if (form.elements[\""formMethod\""]) {\n"" +
 			""  form.method = form.elements[\""formMethod\""].value;\n"" +
+			""  }\n"" +
 			""  form.submit();\n"" +
 			""}\n"" +
 			""document.addEventListener('DOMContentLoaded', function () {\n"" +",0
Fix wrong analytics event send for tile removed,"     Timber.i(""Quick tile removed"");
     analytics.send(new HitBuilders.EventBuilder() //
         .setCategory(Analytics.CATEGORY_QUICK_TILE)
-        .setAction(Analytics.ACTION_QUICK_TILE_ADDED)
+        .setAction(Analytics.ACTION_QUICK_TILE_REMOVED)
         .build());
   }
 }",0
copy-paste mistake in javadoc,"             public enum ExpiryPolicyType {
 
                 /**
-                 * Expiry policy type for the ""javax.cache.expiry.AccessedExpiryPolicy""
+                 * Expiry policy type for the ""javax.cache.expiry.CreatedExpiryPolicy""
                  */
                 CREATED,
                 /**",0
slideBy() javadoc fixes,"  * <ul>
  * <li>{@link #grouped(int)}</li>
  * <li>{@link #iterator()}</li>
+ * <li>{@link #slideBy(Function)}</li>
  * <li>{@link #sliding(int)}</li>
  * <li>{@link #sliding(int, int)}</li>
  * </ul>
@@ -1056,13 +1057,11 @@
      * first element of the next window.
      * <p>
      * Examples:
-     * <pre>
-     * <code>
+     * <pre>{@code
      * [].slideBy(Function.identity()) = []
      * [1,2,3,4,4,5].slideBy(Function.identity()) = [[1],[2],[3],[4,4],[5]]
      * [1,2,3,10,12,5,7,20,29].slideBy(x -> x/10) = [[1,2,3],[10,12],[5,7],[20,29]]
-     * </code>
-     * </pre>
+     * }</pre>
      *
      * @param classifier A function which classifies elements into classes
      * @return A new Iterator of windows of the grouped elements",0
Log duplicated default accelerators just once," 	private KeyboardAPI api = null;
 
 	/**
-	 * The menus with duplicated default accelerator.
+	 * The identifiers of the menus with duplicated default accelerators.
+	 * <p>
+	 * Lazily initialised.
 	 * 
 	 * @see #getDefaultAccelerator(ZapMenuItem)
 	 */
-	private List<JMenuItem> menusDupDefaultAccelerator;
+	private List<String> menusDupDefaultAccelerator;
 
 	public ExtensionKeyboard() {
 		super(NAME);
@@ -123,10 +125,17 @@
 			return;
 		}
 
+		if (isIdentifierWithDuplicatedAccelerator(zme.getIdentifier())) {
+			return;
+		}
+
 		for (Object obj : map.values()) {
 			KeyboardMapping km = (KeyboardMapping) obj;
-			KeyStroke kmKs = km.getDefaultKeyStroke();
-			if (kmKs != null && kmKs.getKeyCode() == ks.getKeyCode() && kmKs.getModifiers() == ks.getModifiers()) {
+			if (isIdentifierWithDuplicatedAccelerator(km.getIdentifier())) {
+				continue;
+			}
+
+			if (hasSameDefaultAccelerator(km, ks) && !zme.getIdentifier().equals(km.getIdentifier())) {
 				String msg = String.format(
 						""Menus %s and %s use the same default accelerator: %s"",
 						zme.getIdentifier(),
@@ -136,15 +145,40 @@
 				if (menusDupDefaultAccelerator == null) {
 					menusDupDefaultAccelerator = new ArrayList<>();
 				}
-				menusDupDefaultAccelerator.add(zme);
+				menusDupDefaultAccelerator.add(zme.getIdentifier());
 				if (zme.getDefaultAccelerator().equals(zme.getAccelerator())) {
 					zme.setAccelerator(null);
 				}
-				return;
 			}
 		}
 	}
 
+	/**
+	 * Tells whether or not the given keyboard mapping has the given default accelerator.
+	 *
+	 * @param km the keyboard mapping to check.
+	 * @param ks the accelerator.
+	 * @return {@code true} if the keyboard mapping has the given default accelerator, {@code false} otherwise.
+	 */
+	private static boolean hasSameDefaultAccelerator(KeyboardMapping km, KeyStroke ks) {
+		KeyStroke kmKs = km.getDefaultKeyStroke();
+		if (kmKs == null) {
+			return false;
+		}
+		return kmKs.getKeyCode() == ks.getKeyCode() && kmKs.getModifiers() == ks.getModifiers();
+	}
+
+	/**
+	 * Tells whether or not the given identifier is of a menu with duplicated default accelerator.
+	 *
+	 * @param identifier the menu identifier to check.
+	 * @return {@code true} if it's a menu with duplicated default accelerator, {@code false} otherwise.
+	 * @see #menusDupDefaultAccelerator
+	 */
+	private boolean isIdentifierWithDuplicatedAccelerator(String identifier) {
+		return menusDupDefaultAccelerator != null && menusDupDefaultAccelerator.contains(identifier);
+	}
+
 	private void initAllMenuItems(JMenu menu) {
 		for (Component c: menu.getMenuComponents()) {
 			if (c instanceof ZapMenuItem) {
@@ -230,7 +264,7 @@
 	 * @return the KeyStroke or {@code null} if duplicated or does not have a default.
 	 */
 	private KeyStroke getDefaultAccelerator(ZapMenuItem menuItem) {
-		if (menusDupDefaultAccelerator != null && menusDupDefaultAccelerator.contains(menuItem)) {
+		if (isIdentifierWithDuplicatedAccelerator(menuItem.getIdentifier())) {
 			return null;
 		}
 		return menuItem.getDefaultAccelerator();",0
tad offset fix,"             ews = -1;
 
         // we create new shapeInfo with possibly new ews & order
-        baseNDArray.setShapeInformation(Nd4j.getShapeInfoProvider().createShapeInformation(shape, stride, 0, ews, newOrder));
+        baseNDArray.setShapeInformation(Nd4j.getShapeInfoProvider().createShapeInformation(shape, stride, offset, ews, newOrder));
 
         return toTad;
     }",0
Fix layout for Find-Replace dialog (round 2)," import java.awt.event.*;
 
 import javax.swing.*;
+import javax.swing.border.Border;
 
 import processing.app.helpers.OSUtils;
 
@@ -50,68 +51,51 @@
 @SuppressWarnings(""serial"")
 public class FindReplace extends JFrame implements ActionListener {
 
-  static final int EDGE = OSUtils.isMacOS() ? 20 : 13;
-  static final int SMALL = 6;
-  static final int BUTTONGAP = 12; // 12 is correct for Mac, other numbers may be required for other platofrms
+  private Editor editor;
 
-  Editor editor;
+  private JTextField findField;
+  private JTextField replaceField;
+  private static String findString;
+  private static String replaceString;
 
-  JTextField findField;
-  JTextField replaceField;
-  static String findString;
-  static String replaceString;
+  private JButton replaceButton;
+  private JButton replaceAllButton;
+  private JButton replaceFindButton;
+  private JButton previousButton;
+  private JButton findButton;
 
-  JButton replaceButton;
-  JButton replaceAllButton;
-  JButton replaceFindButton;
-  JButton previousButton;
-  JButton findButton;
+  private JCheckBox ignoreCaseBox;
+  private static boolean ignoreCase = true;
 
-  JCheckBox ignoreCaseBox;
-  static boolean ignoreCase = true;
+  private JCheckBox wrapAroundBox;
+  private static boolean wrapAround = true;
 
-  JCheckBox wrapAroundBox;
-  static boolean wrapAround = true;
-
-  JCheckBox searchAllFilesBox;
-  static boolean searchAllFiles = false;
+  private JCheckBox searchAllFilesBox;
+  private static boolean searchAllFiles = false;
 
   public FindReplace(Editor editor) {
-    super(""Find"");
-    setResizable(false);
+    super(_(""Find""));
     this.editor = editor;
     
-    FlowLayout searchLayout = new FlowLayout(FlowLayout.RIGHT,5,0);
-    Container pane = getContentPane();
-    pane.setLayout(searchLayout);
+    JPanel contentPanel = new JPanel();
+    Border padding = BorderFactory.createEmptyBorder(10, 10, 10, 10);
+    contentPanel.setBorder(padding);
+    setContentPane(contentPanel);
 
     JLabel findLabel = new JLabel(_(""Find:""));
+    findField = new JTextField(20);
     JLabel replaceLabel = new JLabel(_(""Replace with:""));
-    Dimension labelDimension = replaceLabel.getPreferredSize();
-    
-    JPanel find = new JPanel();
-    find.add(findLabel);
-    find.add(findField = new JTextField(20));
-    pane.add(find);
-    
-    JPanel replace = new JPanel();
-    replace.add(replaceLabel);
-    replace.add(replaceField = new JTextField(20));
-    pane.add(replace);
-    
-    int fieldHeight = findField.getPreferredSize().height;
-
-    JPanel checkbox = new JPanel();
+    replaceField = new JTextField(20);
     
     // Fill the findString with selected text if no previous value
-    if (editor.getSelectedText() != null &&
-        editor.getSelectedText().length() > 0)
+    if (editor.getSelectedText() != null
+        && editor.getSelectedText().length() > 0)
       findString = editor.getSelectedText();
     
-    if (findString != null) findField.setText(findString);
-    if (replaceString != null) replaceField.setText(replaceString);
-    //System.out.println(""setting find str to "" + findString);
-    //findField.requestFocusInWindow();
+    if (findString != null)
+      findField.setText(findString);
+    if (replaceString != null)
+      replaceField.setText(replaceString);
 
     ignoreCaseBox = new JCheckBox(_(""Ignore Case""));
     ignoreCaseBox.addActionListener(new ActionListener() {
@@ -120,7 +104,6 @@
         }
       });
     ignoreCaseBox.setSelected(ignoreCase);
-    checkbox.add(ignoreCaseBox);
 
     wrapAroundBox = new JCheckBox(_(""Wrap Around""));
     wrapAroundBox.addActionListener(new ActionListener() {
@@ -129,7 +112,6 @@
         }
       });
     wrapAroundBox.setSelected(wrapAround);
-    checkbox.add(wrapAroundBox);
     
     searchAllFilesBox = new JCheckBox(_(""Search all Sketch Tabs""));
     searchAllFilesBox.addActionListener(new ActionListener() {
@@ -138,119 +120,105 @@
         }
       });
     searchAllFilesBox.setSelected(searchAllFiles);
-    checkbox.add(searchAllFilesBox);
 
-    pane.add(checkbox);
+    JPanel checkboxPanel = new JPanel();
+    checkboxPanel.setLayout(new BoxLayout(checkboxPanel, BoxLayout.PAGE_AXIS));
+    checkboxPanel.add(ignoreCaseBox);
+    checkboxPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+    checkboxPanel.add(wrapAroundBox);
+    checkboxPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+    checkboxPanel.add(searchAllFilesBox);
     
-    JPanel buttons = new JPanel();
-    buttons.setLayout(new FlowLayout(FlowLayout.CENTER, BUTTONGAP, 0));
+    replaceAllButton = new JButton(_(""Replace All""));
+    replaceAllButton.addActionListener(this);
+    replaceButton = new JButton(_(""Replace""));
+    replaceButton.addActionListener(this);
+    replaceFindButton = new JButton(_(""Replace & Find""));
+    replaceFindButton.addActionListener(this);
+    previousButton = new JButton(_(""Previous""));
+    previousButton.addActionListener(this);
+    findButton = new JButton(_(""Find""));
+    findButton.addActionListener(this);
 
-    // ordering is different on mac versus pc
+    JPanel buttonPanel = new JPanel();
+    buttonPanel.setLayout(new BoxLayout(buttonPanel, BoxLayout.LINE_AXIS));
+
+    // ordering of buttons is different on mac versus pc
     if (OSUtils.isMacOS()) {
-      buttons.add(replaceAllButton = new JButton(_(""Replace All"")));
-      buttons.add(replaceButton = new JButton(_(""Replace"")));
-      buttons.add(replaceFindButton = new JButton(_(""Replace & Find"")));
-      buttons.add(previousButton = new JButton(_(""Previous"")));
-      buttons.add(findButton = new JButton(_(""Find"")));
+      buttonPanel.add(replaceAllButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(replaceButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(replaceFindButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(previousButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(findButton);
 
     } else {
-      buttons.add(findButton = new JButton(_(""Find"")));
-      buttons.add(previousButton = new JButton(_(""Previous""))); // is this the right position for non-Mac?
-      buttons.add(replaceFindButton = new JButton(_(""Replace & Find"")));
-      buttons.add(replaceButton = new JButton(_(""Replace"")));
-      buttons.add(replaceAllButton = new JButton(_(""Replace All"")));
+      buttonPanel.add(findButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(previousButton); // is this the right position for
+                                       // non-Mac?
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(replaceFindButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(replaceButton);
+      buttonPanel.add(Box.createRigidArea(new Dimension(8, 0)));
+      buttonPanel.add(replaceAllButton);
     }
-    pane.add(buttons);
 
     // to fix ugliness.. normally macosx java 1.3 puts an
     // ugly white border around this object, so turn it off.
     if (OSUtils.isMacOS()) {
-      buttons.setBorder(null);
+      buttonPanel.setBorder(null);
     }
 
-    /*
-    findField.addFocusListener(new FocusListener() {
-        public void focusGained(FocusEvent e) {
-          System.out.println(""Focus gained "" + e.getOppositeComponent());
-        }
+    // Put all components onto the dialog window
+    GridBagLayout searchLayout = new GridBagLayout();
+    GridBagConstraints gbc = new GridBagConstraints();
+    Container pane = getContentPane();
+    pane.setLayout(searchLayout);
 
-        public void focusLost(FocusEvent e) {
-          System.out.println(""Focus lost ""); // + e.getOppositeComponent());
-          if (e.getOppositeComponent() == null) {
-            requestFocusInWindow();
-          }
-        }
-      });
-    */
-
-    Dimension buttonsDimension = buttons.getPreferredSize();
-    int visibleButtonWidth = buttonsDimension.width - 2 * BUTTONGAP;
-    int fieldWidth = visibleButtonWidth - (labelDimension.width + SMALL);
-
-   // +1 since it's better to tend downwards
-    int yoff = (1 + fieldHeight - labelDimension.height) / 2;
-
-    int ypos = EDGE;
-    
-    int labelWidth = findLabel.getPreferredSize().width;
-    findLabel.setBounds(EDGE + (labelDimension.width-labelWidth), ypos + yoff, //  + yoff was added to the wrong field
-                        labelWidth, labelDimension.height);
-    findField.setBounds(EDGE + labelDimension.width + SMALL, ypos,
-                        fieldWidth, fieldHeight);
-                        
-    ypos += fieldHeight + SMALL;
-    
-    labelWidth = replaceLabel.getPreferredSize().width;
-    replaceLabel.setBounds(EDGE + (labelDimension.width-labelWidth), ypos + yoff,
-                           labelWidth, labelDimension.height);
-    replaceField.setBounds(EDGE + labelDimension.width + SMALL, ypos,
-                           fieldWidth, fieldHeight);
-
-    ypos += fieldHeight + SMALL;
-
-    ignoreCaseBox.setBounds(EDGE + labelDimension.width + SMALL,
-                            ypos,
-                            (fieldWidth-SMALL)/4, fieldHeight);
-
-    wrapAroundBox.setBounds(EDGE + labelDimension.width + SMALL + (fieldWidth-SMALL)/4 + SMALL,
-                            ypos,
-                            (fieldWidth-SMALL)/4, fieldHeight);
-
-	searchAllFilesBox.setBounds(EDGE + labelDimension.width + SMALL + (int)((fieldWidth-SMALL)/1.9) + SMALL,
-                            ypos,
-                            (fieldWidth-SMALL)/2, fieldHeight);
-
-    ypos += fieldHeight + SMALL;
-
-    buttons.setBounds(EDGE-BUTTONGAP, ypos,
-                      buttonsDimension.width, buttonsDimension.height);
-
-    ypos += buttonsDimension.height;
-
-//    Dimension screen = Toolkit.getDefaultToolkit().getScreenSize();
-
-    int wide = visibleButtonWidth + EDGE*2;
-    int high = ypos; // butt.y + butt.height + EDGE*2 + SMALL;
+    gbc.insets = new Insets(4, 4, 4, 4);
+    gbc.gridx = 0;
+    gbc.weightx = 0.0;
+    gbc.weighty = 0.0;
+    gbc.fill = GridBagConstraints.NONE;
+    gbc.anchor = GridBagConstraints.LINE_END;
+    pane.add(findLabel, gbc);
+    gbc.gridx = 1;
+    gbc.weightx = 1.0;
+    gbc.fill = GridBagConstraints.HORIZONTAL;
+    gbc.anchor = GridBagConstraints.LINE_START;
+    pane.add(findField, gbc);
+    gbc.gridx = 0;
+    gbc.gridy = 1;
+    gbc.weightx = 0.0;
+    gbc.fill = GridBagConstraints.NONE;
+    gbc.anchor = GridBagConstraints.LINE_END;
+    pane.add(replaceLabel, gbc);
+    gbc.gridx = 1;
+    gbc.weightx = 1.0;
+    gbc.fill = GridBagConstraints.HORIZONTAL;
+    gbc.anchor = GridBagConstraints.LINE_START;
+    pane.add(replaceField, gbc);
+    gbc.gridx = 1;
+    gbc.gridy = 2;
+    gbc.weighty = 0.0;
+    gbc.fill = GridBagConstraints.NONE;
+    pane.add(checkboxPanel, gbc);
+    gbc.anchor = GridBagConstraints.CENTER;
+    gbc.gridwidth = 2;
+    gbc.gridx = 0;
+    gbc.gridy = 3;
+    gbc.insets = new Insets(12, 4, 4, 4);
+    pane.add(buttonPanel, gbc);
 
     pack();
-    Insets insets = getInsets();
-    //System.out.println(""Insets = "" + insets);
-    setSize(wide + insets.left + insets.right,high + insets.top + insets.bottom); 
-
-    setLocationRelativeTo( null ); // center
- //   setBounds((screen.width - wide) / 2, (screen.height - high) / 2, wide, high);
-
-    replaceButton.addActionListener(this);
-    replaceAllButton.addActionListener(this);
-    replaceFindButton.addActionListener(this);
-    findButton.addActionListener(this);
-    previousButton.addActionListener(this);
-
-    // you mustn't replace what you haven't found, my son
-    // semantics of replace are ""replace the current selection with the replace field""
-    // so whether we have found before or not is irrelevent
-    // replaceButton.setEnabled(false);
-    // replaceFindButton.setEnabled(false);
+    setResizable(false);
+    // centers the dialog on thew screen
+    setLocationRelativeTo(null);
 
     // make the find button the blinky default
     getRootPane().setDefaultButton(findButton);
@@ -280,7 +248,6 @@
       });
   }
 
-
   public void handleClose() {
     //System.out.println(""handling close now"");
     findString = findField.getText();
@@ -290,7 +257,6 @@
     setVisible(false);
   }
 
-
   /*
   public void show() {
     findField.requestFocusInWindow();
@@ -321,17 +287,18 @@
     }
   }
 
-
   // look for the next instance of the find string to be found
   // once found, select it (and go to that line)
 
-  private boolean find(boolean wrap,boolean backwards,boolean searchTabs,int originTab) {
+  private boolean find(boolean wrap, boolean backwards, boolean searchTabs,
+                       int originTab) {
     //System.out.println(""Find: "" + originTab);
 	boolean wrapNeeded = false;
     String search = findField.getText();
     //System.out.println(""finding for "" + search + "" "" + findString);
     // this will catch ""find next"" being called when no search yet
-    if (search.length() == 0) return false;
+    if (search.length() == 0)
+      return false;
 
     String text = editor.getText();
 
@@ -378,8 +345,8 @@
               originTab = realCurrentTab;
 
             if (!wrap)
-              if ((!backwards && realCurrentTab + 1 >= sketch.getCodeCount()) ||
-                  (backwards && realCurrentTab - 1 < 0))
+              if ((!backwards && realCurrentTab + 1 >= sketch.getCodeCount())
+                  || (backwards && realCurrentTab - 1 < 0))
                 return false; // Can't continue without wrap
 
             if (backwards) {
@@ -399,7 +366,8 @@
       }
       
       if (wrapNeeded)
-        nextIndex = backwards ? text.lastIndexOf(search) : text.indexOf(search, 0);
+        nextIndex = backwards ? text.lastIndexOf(search) : text.indexOf(search,
+                                                                        0);
     }
    	
    	if (nextIndex != -1) {
@@ -410,10 +378,9 @@
     return false;
   }
 
-
   /**
-   * Replace the current selection with whatever's in the
-   * replacement text field.
+   * Replace the current selection with whatever's in the replacement text
+   * field.
    */
   public void replace() {
     if (findField.getText().length() == 0)
@@ -439,8 +406,8 @@
   }
 
   /**
-   * Replace the current selection with whatever's in the
-   * replacement text field, and then find the next match
+   * Replace the current selection with whatever's in the replacement text
+   * field, and then find the next match
    */
   public void replaceAndFindNext() {
     replace();
@@ -448,8 +415,8 @@
   }
 
   /**
-   * Replace everything that matches by doing find and replace
-   * alternately until nothing more found.
+   * Replace everything that matches by doing find and replace alternately until
+   * nothing more found.
    */
   public void replaceAll() {
     if (findField.getText().length() == 0)",0
fix miui 8 developer version issue,"                     Field mResourcesImpl = Resources.class.getDeclaredField(""mResourcesImpl"");
                     mResourcesImpl.setAccessible(true);
                     Object resourceImpl = mResourcesImpl.get(resources);
-                    Field implAssets = resourceImpl.getClass().getDeclaredField(""mAssets"");
+                    //check if rom change resourceImpl may be a subclass of resourceImpl like miui8
+                    Field implAssets;
+                    try {
+                        implAssets = resourceImpl.getClass().getDeclaredField(""mAssets"");
+                    } catch (NoSuchFieldException e) {
+                        implAssets = resourceImpl.getClass().getSuperclass().getDeclaredField(""mAssets"");
+                    }
                     implAssets.setAccessible(true);
                     implAssets.set(resourceImpl, newAssetManager);
                 }",0
	fix too much logs when lvs or haproxy be used," 					c.register();
 				} catch (Exception e) {
 					c.close(""register err"" + e.toString());
-					LOGGER.error(""register err"", e);
 				}
 			}
 		}",0
Fix ACM group.," 
 	private static final String DIAMOND_PROPERTY_SOURCE_NAME = ""diamond"";
 
-	private static String defaultDiamondGroup = ""DEFAULT_GROUP"";
-
 	private AcmPropertySourceBuilder acmPropertySourceBuilder = new AcmPropertySourceBuilder();
 
 	@Autowired
@@ -45,14 +43,14 @@
 				DIAMOND_PROPERTY_SOURCE_NAME);
 
 		for (String dataId : acmIntegrationProperties.getGroupConfigurationDataIds()) {
-			loadDiamondDataIfPresent(compositePropertySource, dataId, defaultDiamondGroup,
-					true);
+			loadDiamondDataIfPresent(compositePropertySource, dataId,
+					acmIntegrationProperties.getAcmProperties().getGroup(), true);
 		}
 
 		for (String dataId : acmIntegrationProperties
 				.getApplicationConfigurationDataIds()) {
-			loadDiamondDataIfPresent(compositePropertySource, dataId, defaultDiamondGroup,
-					false);
+			loadDiamondDataIfPresent(compositePropertySource, dataId,
+					acmIntegrationProperties.getAcmProperties().getGroup(), false);
 		}
 
 		return compositePropertySource;",0
Fixed an issue where we can not remove the item from the cart,"                     fulfillmentGroupItem = fulfillmentGroupItemDao.create();
                     fulfillmentGroupItem.setFulfillmentGroup(fg);
                     fulfillmentGroupItem.setOrderItem(orderItem);
-                    fulfillmentGroupItem.setQuantity(1);
+                    fulfillmentGroupItem.setQuantity(orderItem.getQuantity());
                     fulfillmentGroupItem = fulfillmentGroupItemDao.save(fulfillmentGroupItem);
                     fg.getFulfillmentGroupItems().add(fulfillmentGroupItem);
                 } else {",0
Fixed minimal version for FileProvider,"                                                  @NonNull final File file)
   {
     Uri result = null;
-    if (Build.VERSION.SDK_INT < 19)
+    if (Build.VERSION.SDK_INT < 21)
     {
       result = Uri.fromFile(file);
     }",0
Fix broken AStarPathFinder," 
 		final LongSparseArray<Node> visitedNodes = new LongSparseArray<Node>();
 		final LongSparseArray<Node> openNodes = new LongSparseArray<Node>();
-		final IQueue<Node> sortedOpenNodes = new UniqueQueue<Node>(new SortedQueue<Node>(new ShiftList<Node>()));
+		final IQueue<Node> sortedOpenNodes = new SortedQueue<Node>(new ShiftList<Node>());
 
 		final boolean allowDiagonalMovement = pAllowDiagonal;
 ",0
Fixes a race condition in PersistenceWindowPool,"         {
             refreshBricks();
         }
+        BrickElement theBrick = null;
         while ( window == null )
         {
             if ( brickSize > 0 )
@@ -138,17 +139,8 @@
                 {
                     expandBricks( brickIndex + 1 );
                 }
-                BrickElement brick = brickArray[brickIndex];
-                window = brick.getWindow();
-                if ( window != null && !window.markAsInUse() )
-                {
-                    // Oops, a refreshBricks call from another thread just closed
-                    // this window, treat it as if we hadn't even found it.
-                    window = null;
-                }
-
-                // assert window == null || window.encapsulates( position );
-                brick.setHit();
+                theBrick = brickArray[brickIndex];
+                window = theBrick.getAndMarkWindow();
             }
             if ( window == null )
             {
@@ -185,6 +177,7 @@
                     // which was unnecessarily opened. The next go in this loop
                     // will get that one instead.
                     dpw.close();
+                    theBrick.unLock();
                 }
             }
             else
@@ -230,13 +223,15 @@
             if ( window instanceof PersistenceRow )
             {
                 PersistenceRow dpw = (PersistenceRow) window;
-
+                try
+                {
                 // If the corresponding window has been instantiated while we had
                 // this active row we need to hand over the changes to that
                 // window if the window isn't memory mapped.
                 if ( brickSize > 0 && dpw.isDirty() )
+                    {
                     applyChangesToWindowIfNecessary( dpw );
-
+                    }
                 if ( dpw.writeOutAndCloseIfFree( readOnly ) )
                 {
                     activeRowWindows.remove( dpw.position(), dpw );
@@ -246,6 +241,16 @@
                     dpw.reset();
                 }
             }
+                finally
+                {
+                    if ( brickSize > 0 )
+                    {
+                        int brickIndex = positionToBrickIndex( dpw.position() );
+                        BrickElement theBrick = brickArray[brickIndex];
+                        theBrick.unLock();
+                    }
+                }
+            }
         }
         finally
         {
@@ -620,7 +625,24 @@
                 dpw.readFullWindow();
                 window = dpw;
             }
+            while ( true )
+            {
+                /*
+                 * This is a busy wait, given that rows are kept for a very short time. What we do is lock the brick so
+                 * no rows can be mapped over it, then we wait for every row mapped over it to be released (which can
+                 * happen because releasing the row does not acquire a lock). When that happens, we can go ahead and
+                 * map the window here. If a thread was waiting for this lock, after it acquires it, it will discover
+                 * the window in place, so it will never allocate a row.
+                 */
+                synchronized ( brick )
+                {
+                    if ( brick.lockCount.get() == 0 )
+                    {
             brick.setWindow( window );
+                        break;
+                    }
+                }
+            }
             memUsed += brickSize;
             return true;
         }
@@ -676,6 +698,7 @@
         private int hitCount;
         private int hitCountSnapshot;
         private volatile LockableWindow window;
+        private final AtomicInteger lockCount = new AtomicInteger();
 
         BrickElement( int index )
         {
@@ -733,6 +756,63 @@
             return hitCountSnapshot;
         }
 
+        public LockableWindow getAndMarkWindow()
+        {
+            LockableWindow candidate = window;
+
+            if ( candidate != null && !candidate.markAsInUse() )
+            {
+                // Oops, a refreshBricks call from another thread just closed
+                // this window, treat it as if we hadn't even found it.
+                candidate = null;
+            }
+            else
+            {
+                return candidate;
+            }
+
+            /*
+             * We may have to allocate a row over this position, so we first need to increase the row count over
+             * this brick to make sure that if a refreshBricks() runs at the same time it won't map a window
+             * under this row. Locking has to happen before we get the window, otherwise we open up for a race
+             * between checking for the window and a refreshBricks().
+             */
+            incrementRowCount();
+            candidate = window;
+            if ( candidate != null && !candidate.markAsInUse() )
+            {
+                // Oops, a refreshBricks call from another thread just closed
+                // this window, treat it as if we hadn't even found it.
+                candidate = null;
+            }
+            if ( candidate != null )
+            {
+                // This means the position is in a window and not in a row. Reduce the counter.
+                unLock();
+            }
+            /*
+             * If the if above does not execute, it happens because we are going to map a row over this. So the brick
+             * must remain locked until we are done with the row. That means that from now on refreshBricks() calls
+             * will block until the row we'll grab in the if that follows is released.
+             */
+            setHit();
+
+            return candidate;
+        }
+
+        private synchronized void incrementRowCount()
+        {
+            lockCount.incrementAndGet();
+        }
+
+        /**
+         * Not synchronized on purpose. See {@link #allocateNewWindow(BrickElement)} for details.
+         */
+        public void unLock()
+        {
+            lockCount.decrementAndGet();
+        }
+
         @Override
         public String toString()
         {",0
Fixed a wrong word in the documentation,"    * allowReplacingDelegate = false as parameter.
    *
    * @param viewType the view type integer if you want to assign manually the view type. Otherwise
-   * use {@link #addDelegate(AdapterDelegate)} where a viewtype will be assigned manually.
+   * use {@link #addDelegate(AdapterDelegate)} where a viewtype will be assigned automatically.
    * @param delegate the delegate to add
    * @return self
    * @throws NullPointerException if passed delegate is null",0
Fix ClassLoader&Upgrade Bundle,"         paths[0] = app.getPackageResourcePath(); // add host asset path
         int i = 1;
         for (ApkElement apk : mApks) {
+            if (Small.getBundleUpgraded(apk.packageName)) {
+                // If upgraded, delete the opt dex file for recreating
+                File optDexFile = new File(apk.optDexPath);
+                if (optDexFile.exists()){
+                    optDexFile.delete();
+                }
+                Small.setBundleUpgraded(apk.packageName, false);
+            }
             if (apk.nonResources) continue; // ignores the empty entry to fix #62
 
             paths[i++] = apk.path; // add plugin asset path
@@ -156,6 +164,11 @@
     }
 
     @Override
+    protected Class<?> findClass(String name) throws ClassNotFoundException {
+        return super.findClass(name);
+    }
+
+    @Override
     protected String findLibrary(String libraryName) {
         String fileName = System.mapLibraryName(libraryName);
 
@@ -288,7 +301,7 @@
                 }
             }
 
-            return null;
+            return super.findClass(name);
         }
 
     }",0
GWT: Fixed SuperJumper compile error," import com.badlogic.gdx.graphics.g2d.SpriteBatch;
 import com.badlogic.gdx.math.Rectangle;
 import com.badlogic.gdx.math.Vector3;
+import com.badlogic.gdx.utils.TimeUtils;
 
 public class MainMenuScreen implements Screen {
 	Game game;
@@ -80,7 +81,8 @@
 		}
 	}
 
-	long last = System.nanoTime();
+	long last = TimeUtils.nanoTime();
+
 	public void draw () {
 		GLCommon gl = Gdx.gl;
 		gl.glClearColor(1, 0, 0, 1);
@@ -100,14 +102,14 @@
 		batcher.draw(Settings.soundEnabled ? Assets.soundOn : Assets.soundOff, 0, 0, 64, 64);
 		batcher.end();
 		
-		if(System.nanoTime() - last > 2000000000) {
-			Gdx.app.log(""SuperJumper"", ""version: "" + Gdx.app.getVersion() + 
-												"", memory: "" + Gdx.app.getJavaHeap() + "", "" + Gdx.app.getNativeHeap() + 
-												"", native orientation:"" + Gdx.input.getNativeOrientation() + 
-												"", orientation: "" + Gdx.input.getRotation() + 
-												"", accel: "" + (int)Gdx.input.getAccelerometerX() + "", "" + (int)Gdx.input.getAccelerometerY() + "", "" + (int)Gdx.input.getAccelerometerZ() +
-												"", apr: "" + (int)Gdx.input.getAzimuth() + "", "" + (int)Gdx.input.getPitch() + "", "" + (int)Gdx.input.getRoll());
-			last = System.nanoTime();
+		if (TimeUtils.nanoTime() - last > 2000000000) {
+			Gdx.app.log(""SuperJumper"",
+				""version: "" + Gdx.app.getVersion() + "", memory: "" + Gdx.app.getJavaHeap() + "", "" + Gdx.app.getNativeHeap()
+					+ "", native orientation:"" + Gdx.input.getNativeOrientation() + "", orientation: "" + Gdx.input.getRotation()
+					+ "", accel: "" + (int)Gdx.input.getAccelerometerX() + "", "" + (int)Gdx.input.getAccelerometerY() + "", ""
+					+ (int)Gdx.input.getAccelerometerZ() + "", apr: "" + (int)Gdx.input.getAzimuth() + "", "" + (int)Gdx.input.getPitch()
+					+ "", "" + (int)Gdx.input.getRoll());
+			last = TimeUtils.nanoTime();
 		}
 	}
 ",0
Fixed JavaDoc problem on master,"  * This context object can be used to contain key values that can be useful as ""context"" when executing
  * {@link graphql.schema.DataFetcher}s
  *
- * {@code
  * <pre>
+ * {@code
  *     DataFetcher df = new DataFetcher() {
  *        public Object get(DataFetchingEnvironment env) {
  *            GraphQLContext ctx = env.getContext()
  *            User currentUser = ctx.getOrDefault(""userKey"",new AnonymousUser())
  *            ...
  *        }
- * </pre>
  * }
+ * }
+ * </pre>
  *
  * You can set this up via {@link ExecutionInput.Builder#context(graphql.GraphQLContext.Builder)}
  */",0
Fix Javadoc tag. Avoid needless object creation.,"    * Invokes the wrapped handler method to handle {@code event}.
    *
    * @param event  event to handle
-   * @Throws java.lang.IllegalStateException  if previously invalidated.
+   * @throws java.lang.IllegalStateException  if previously invalidated.
    * @throws java.lang.reflect.InvocationTargetException  if the wrapped method throws any {@link Throwable} that is not
    *     an {@link Error} ({@code Error}s are propagated as-is).
    */
@@ -86,7 +86,7 @@
       throw new IllegalStateException(toString() + "" has been invalidated and can no longer handle events."");
     }
     try {
-      method.invoke(target, new Object[] {event});
+      method.invoke(target, event);
     } catch (IllegalAccessException e) {
       throw new AssertionError(e);
     } catch (InvocationTargetException e) {",0
Fixing Typo!,"  * PrimitiveSet is an auxiliary class used for supporting key rotation: primitives in a set
  * correspond to keys in a keyset.  Users will usually work with primitive instances,
  * which essentially wrap primitive sets.  For example an instance of an Aead-primitive
- * for a given keyset holds a set of Aead-primitivies corresponding to the keys in the keyset,
+ * for a given keyset holds a set of Aead-primitives corresponding to the keys in the keyset,
  * and uses the set members to do the actual crypto operations: to encrypt data the primary
  * Aead-primitive from the set is used, and upon decryption the ciphertext's prefix
  * determines the id of the primitive from the set. <p>",0
Fix Map Lookup feature for Log4j 2," import io.vertx.core.spi.logging.LogDelegate;
 import org.apache.logging.log4j.Level;
 import org.apache.logging.log4j.message.FormattedMessage;
+import org.apache.logging.log4j.message.Message;
 import org.apache.logging.log4j.spi.ExtendedLogger;
 
 /**
@@ -150,8 +151,12 @@
   }
 
   private void log(Level level, Object message, Throwable t) {
+    if (message instanceof Message) {
+      logger.logIfEnabled(FQCN, level, null, (Message) message, t);
+    } else {
     logger.logIfEnabled(FQCN, level, null, message, t);
   }
+  }
 
   private void log(Level level, String message, Object... params) {
     logger.logIfEnabled(FQCN, level, null, message, params);",0
"Send replay entries read callback from background thread, to avoid recursive stack calls","     private static final double MB = 1024 * 1024;
 
     private static final Weighter<EntryImpl> entryWeighter = new Weighter<EntryImpl>() {
+        @Override
         public long getSize(EntryImpl entry) {
             return entry.getLength();
         }
@@ -176,7 +177,7 @@
             manager.mlFactoryMBean.recordCacheHit(cachedEntry.getLength());
             callback.readEntryComplete(cachedEntry, ctx);
         } else {
-            ReadCallback readCallback = (rc, ledgerHandle, sequence, obj) -> {
+            lh.asyncReadEntries(position.getEntryId(), position.getEntryId(), (rc, ledgerHandle, sequence, obj) -> {
                 if (rc != BKException.Code.OK) {
                     ml.invalidateLedgerHandle(ledgerHandle, rc);
                     callback.readEntryFailed(new ManagedLedgerException(BKException.create(rc)), obj);
@@ -193,13 +194,14 @@
                     manager.mlFactoryMBean.recordCacheMiss(1, returnEntry.getLength());
                     ml.mbean.addReadEntriesSample(1, returnEntry.getLength());
 
+                    ml.getExecutor().submitOrdered(ml.getName(), safeRun(() -> {
                     callback.readEntryComplete(returnEntry, obj);
+                    }));
                 } else {
                     // got an empty sequence
                     callback.readEntryFailed(new ManagedLedgerException(""Could not read given position""), obj);
                 }
-            };
-            lh.asyncReadEntries(position.getEntryId(), position.getEntryId(), readCallback, ctx);
+            }, ctx);
         }
     }
 ",0
FIxes #1810,"     }
 
     public void setColors(float[] colors) {
-        setTextureCoords(colors, false);
+        setColors(colors, false);
     }
 
     public void setColors(float[] colors, boolean override) {",0
KEYCLOAK-1928 Fix kerberos with adapter on JDK7," 
 
     public GSSCredential kerberosTicketToGSSCredential(KerberosTicket kerberosTicket) {
-        return kerberosTicketToGSSCredential(kerberosTicket, GSSCredential.DEFAULT_LIFETIME, GSSCredential.INITIATE_AND_ACCEPT);
+        return kerberosTicketToGSSCredential(kerberosTicket, GSSCredential.DEFAULT_LIFETIME, GSSCredential.INITIATE_ONLY);
     }
 
     // Actually same on both JDKs",0
Fix AES decryption of HLS streams.,"           segmentEncryptionKeyUri = HlsParserUtil.parseStringAttr(line, URI_ATTR_REGEX,
               URI_ATTR);
           segmentEncryptionIV = HlsParserUtil.parseOptionalStringAttr(line, IV_ATTR_REGEX);
-          if (segmentEncryptionIV == null) {
-            segmentEncryptionIV = Integer.toHexString(segmentMediaSequence);
-          }
         }
       } else if (line.startsWith(BYTERANGE_TAG)) {
         String byteRange = HlsParserUtil.parseStringAttr(line, BYTERANGE_REGEX, BYTERANGE_TAG);
@@ -247,13 +244,21 @@
       } else if (line.equals(DISCONTINUITY_TAG)) {
         segmentDiscontinuity = true;
       } else if (!line.startsWith(""#"")) {
+        String thisSegmentEncryptionIV;
+        if (segmentEncryptionIV != null) {
+          thisSegmentEncryptionIV = segmentEncryptionIV;
+        } else if (HlsMediaPlaylist.ENCRYPTION_METHOD_AES_128.equals(segmentEncryptionMethod)) {
+          thisSegmentEncryptionIV = Integer.toHexString(segmentMediaSequence);
+        } else {
+          thisSegmentEncryptionIV = null;
+        }
         segmentMediaSequence++;
         if (segmentByterangeLength == C.LENGTH_UNBOUNDED) {
           segmentByterangeOffset = 0;
         }
         segments.add(new Segment(line, segmentDurationSecs, segmentDiscontinuity,
             segmentStartTimeUs, segmentEncryptionMethod, segmentEncryptionKeyUri,
-            segmentEncryptionIV, segmentByterangeOffset, segmentByterangeLength));
+            thisSegmentEncryptionIV, segmentByterangeOffset, segmentByterangeLength));
         segmentStartTimeUs += (long) (segmentDurationSecs * C.MICROS_PER_SECOND);
         segmentDiscontinuity = false;
         segmentDurationSecs = 0.0;",0
IOSServerSocket Bugfix: Local IP Address Resolution," import cli.System.IAsyncResult;
 import cli.System.Net.Dns;
 import cli.System.Net.IPAddress;
+import cli.System.Net.NetworkInformation.NetworkInterface;
+import cli.System.Net.NetworkInformation.NetworkInterfaceType;
 import cli.System.Net.Sockets.AddressFamily;
 import cli.System.Net.Sockets.TcpClient;
 import cli.System.Net.Sockets.TcpListener;
@@ -59,17 +61,17 @@
 				if (listeners.get(port) == null) {
 					// get local IP to connect with
 					IPAddress ipAddress = null;
-					String host = Dns.GetHostName(); 
-					if (cli.MonoTouch.ObjCRuntime.Runtime.Arch.Value == Arch.DEVICE) {
-						// the "".local"" is not added on the simulator!
-						host = host + "".local""; 
+					NetworkInterface netInterfaces[] = NetworkInterface.GetAllNetworkInterfaces();
+					for (int i = 0; i < netInterfaces.length; i++) {
+						NetworkInterface netInterface = netInterfaces[i];
+						if (netInterface.get_NetworkInterfaceType().Value == NetworkInterfaceType.Wireless80211 ||
+						    netInterface.get_NetworkInterfaceType().Value == NetworkInterfaceType.Ethernet) {
+							for (int k = 0; k < netInterface.GetIPProperties().get_UnicastAddresses().get_Count(); k++) {
+								IPAddress address = netInterface.GetIPProperties().get_UnicastAddresses().get_Item(k).get_Address();
+								if (address.get_AddressFamily().Value == AddressFamily.InterNetwork) {
+									ipAddress = address;
 					}
-					IPAddress[] ips = Dns.GetHostAddresses(host);
-					for (int i = 0; i < ips.length; i++) {
-						IPAddress ip = ips[i];
-						if (ip.get_AddressFamily().Value == AddressFamily.InterNetwork) {
-							ipAddress = ip;
-							break;
+							}
 						}
 					}
 					Gdx.app.debug(""IOSServerSocket"", ""Binding server to "" + ipAddress.ToString() + "":"" + port);",0
[FIXED JENKINS-23127] Allow loading classes from plugins.,"             final JSONObject strategyObject = optJSONObject.getJSONObject(""namingStrategy"");
             final String className = strategyObject.getString(""stapler-class"");
             try {
-                Class clazz = Class.forName(className);
+                Class clazz = Class.forName(className, true, Jenkins.getInstance().getPluginManager().uberClassLoader);
                 final ProjectNamingStrategy strategy = (ProjectNamingStrategy) req.bindJSON(clazz, strategyObject);
                 j.setProjectNamingStrategy(strategy);
             } catch (ClassNotFoundException e) {",0
Fixed condition for setChoiceMode," 				}
 				mList.setCacheColorHint(a.getColor(R.styleable.StickyListHeadersListView_android_cacheColorHint,
 						mList.getCacheColorHint()));
-                if (Build.VERSION.SDK_INT > Build.VERSION_CODES.HONEYCOMB) {
+                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {
                     mList.setChoiceMode(a.getInt(R.styleable.StickyListHeadersListView_android_choiceMode,
                             mList.getChoiceMode()));
                 }",0
Fix mta dragonstone hint arrow not clearing," 		{
 			client.setHintArrow(nearest);
 		}
+		else
+		{
+			client.clearHintArrow();
+		}
 	}
 
 	private WorldPoint findNearestStone()",0
"Fixing TreeProvider to extend the borders of BiomeFacet, as it is needed...","  */
 package org.terasology.core.world.generator.facetProviders;
 
+import org.terasology.core.world.generator.facets.BiomeFacet;
 import org.terasology.core.world.generator.facets.TreeFacet;
 import org.terasology.entitySystem.Component;
 import org.terasology.math.Rect2i;
@@ -34,7 +35,8 @@
 @Requires({@Facet(SeaLevelFacet.class),
         @Facet(value = SurfaceHeightFacet.class, border = @FacetBorder(bottom = 15, sides = 10)),
         @Facet(value = SurfaceHeightFacet.class, border = @FacetBorder(bottom = 15, sides = 10)),
-        @Facet(value = DensityFacet.class, border = @FacetBorder(bottom = 15, sides = 10))})
+        @Facet(value = DensityFacet.class, border = @FacetBorder(bottom = 15, sides = 10)),
+        @Facet(value = BiomeFacet.class, border = @FacetBorder(bottom = 15, sides = 10))})
 public class TreeProvider implements ConfigurableFacetProvider {
 
     private NoiseTable treeNoise;",0
HTTPS requests over HTTP CONNECT proxies should send relative URI,"             // proxy tunnelling, connect need host and explicit port
             return getAuthority(uri);
 
-        else if (proxyServer != null)
+        else if (proxyServer != null && !uri.isSecured())
             // proxy over HTTP, need full url
             return uri.toUrl();
 ",0
Toast text fix.,"                     public void onClick(View v) {
                         try {
                             new Futils().copyToClipboard(c, md5);
-                            Toast.makeText(c, c.getResources().getString(R.string.pathcopied), Toast.LENGTH_SHORT).show();
+                            Toast.makeText(c, c.getResources().getString(R.string.md5copied), Toast.LENGTH_SHORT).show();
                         } catch (Exception e) {
                             e.printStackTrace();
                         }",0
Correctly highlight Juna for cryptic clue step," 		new CrypticClue(""Scattered coins and gems fill the floor. The chest you seek is in the north east."", ""King Black Dragon"", CLOSED_CHEST_375, new WorldPoint(2288, 4702, 0), ""Kill the King Black Dragon for a key (elite), and then open the closed chest in the NE corner of the lair.""),
 		new CrypticClue(""A ring of water surrounds 4 powerful rings, dig above the ladder located there."", new WorldPoint(1910, 4367, 0), ""Dig by the ladder leading to the Dagannoth Kings room in the Waterbirth Island Dungeon.""),
 		new CrypticClue(""This place sure is a mess."", ""Ewesey"", new WorldPoint(1646, 3631, 0), ""Ewesey is located in the Hosidius House mess hall in Great Kourend.""),
-		new CrypticClue(""Here, there are tears, but nobody is crying. Speak to the guardian and show off your alignment to balance."", ""Juna"", new WorldPoint(3252, 9517, 2), ""Talk to Juna while wearing three Guthix related items.""),
+		new CrypticClue(""Here, there are tears, but nobody is crying. Speak to the guardian and show off your alignment to balance."", ""Juna"", JUNA, new WorldPoint(3252, 9517, 2), ""Talk to Juna while wearing three Guthix related items.""),
 		new CrypticClue(""You might have to turn over a few stones to progress."", null, ""Kill a rock crab.""),
 		new CrypticClue(""Dig under Razorlor's toad batta."", new WorldPoint(3139, 4554, 0), ""Dig on the toad batta spawn in Tarn's Lair.""),
 		new CrypticClue(""Talk to Cassie in Falador."", ""Cassie"", new WorldPoint(2975, 3383, 0), ""Cassie is found just south-east of the northern Falador gate.""),",0
fix forgotten spelling.," public class MessageAdapter extends ArrayAdapter<Message> {
 
 	private static final int SENT = 0;
-	private static final int RECIEVED = 1;
+	private static final int RECEIVED = 1;
 	private static final int STATUS = 2;
 
 	private ConversationActivity activity;
@@ -82,7 +82,7 @@
 		if (getItem(position).getType() == Message.TYPE_STATUS) {
 			return STATUS;
 		} else if (getItem(position).getStatus() <= Message.STATUS_RECEIVED) {
-			return RECIEVED;
+			return RECEIVED;
 		} else {
 			return SENT;
 		}
@@ -319,7 +319,7 @@
 						.findViewById(R.id.message_time);
 				view.setTag(viewHolder);
 				break;
-			case RECIEVED:
+			case RECEIVED:
 				view = (View) activity.getLayoutInflater().inflate(
 						R.layout.message_received, parent, false);
 				viewHolder.message_box = (LinearLayout) view
@@ -386,7 +386,7 @@
 			return view;
 		}
 
-		if (type == RECIEVED) {
+		if (type == RECEIVED) {
 			if (item.getConversation().getMode() == Conversation.MODE_MULTI) {
 				Contact contact = item.getContact();
 				if (contact != null) {",0
Fixes #175 - DirectBuffer.CheckLimit() checks previous value not the value being set,"             ""        }\n"" +
             ""        set\n"" +
             ""        {\n"" +
-            ""            _buffer.CheckLimit(_limit);\n"" +
+            ""            _buffer.CheckLimit(value);\n"" +
             ""            _limit = value;\n"" +
             ""        }\n"" +
             ""    }\n\n"",",0
partial fab hide fix,"         timer=new CountDownTimer(5000,1000) {
             @Override
             public void onTick(long l) {
-                Animation animation = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_hide);
-                fab.setAnimation(animation);
-                fab.setVisibility(View.INVISIBLE);
             }
             @Override
             public void onFinish() {
@@ -213,7 +210,7 @@
                 add();
             }
         });
-        getActivity().findViewById(R.id.fabbutton).setVisibility(View.VISIBLE);
+        //getActivity().findViewById(R.id.fabbutton).setVisibility(View.VISIBLE);
 
         utils = new Futils();
 
@@ -258,6 +255,7 @@
         pathbar.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View view) {
+
                 crossfade();
                 timer.cancel();
                 timer.start();
@@ -1242,6 +1240,11 @@
         buttons.setAlpha(0f);
         buttons.setVisibility(View.VISIBLE);
 
+
+        Animation animation = AnimationUtils.loadAnimation(getActivity(), R.anim.fab_hide);
+        fab.setAnimation(animation);
+        fab.setVisibility(View.INVISIBLE);
+
         // Animate the content view to 100% opacity, and clear any animation
         // listener set on the view.
         buttons.animate()",0
Fix for FileUtils.recursiveDelete() when dealing with symbolic links,"         recursiveDelete(current);
       }
     }
-    deleteIfExists(file);
+    file.delete();
   }
 
   public static File createTempFolder() throws IOException {
@@ -274,10 +274,6 @@
       return true;
     }
 
-    if (!file.exists()) {
-      return false;
-    }
-
     return file.delete();
   }
 ",0
Fix compilation error," import com.fasterxml.jackson.annotation.JsonIgnore;
 import com.fasterxml.jackson.annotation.JsonProperty;
 import com.google.common.io.ByteSource;
+import lombok.Getter;
+import lombok.NoArgsConstructor;
 import lombok.SneakyThrows;
+import lombok.ToString;
 import lombok.extern.slf4j.Slf4j;
 import org.apache.commons.lang3.StringUtils;
 import org.apache.commons.lang3.builder.EqualsBuilder;
@@ -16,10 +19,6 @@
 
 import java.time.ZonedDateTime;
 
-import lombok.ToString;
-import lombok.Getter;
-import lombok.NoArgsConstructor;
-
 /**
  * Ticket implementation that encodes a source ticket and stores the encoded
  * representation internally.
@@ -61,7 +60,6 @@
     @SneakyThrows
     @JsonCreator
     public EncodedTicket(@JsonProperty(""encoded"") final String encodedTicket, @JsonProperty(""id"") final String encodedTicketId) {
-        try {
             this.id = encodedTicketId;
             this.encodedTicket = EncodingUtils.decodeBase64(encodedTicket);
     }",0
Remove the currency prefix from the value based on the current currency," 
 
 import java.math.BigDecimal;
+import java.text.DecimalFormat;
 import java.text.NumberFormat;
 import java.text.ParseException;
 import java.util.Date;
@@ -205,6 +206,10 @@
             customCriteria = persistencePackage.getCustomCriteria()[0];
         }
 
+        Locale locale =  BroadleafRequestContext.getBroadleafRequestContext().getLocale();
+        BroadleafCurrency currency =  BroadleafRequestContext.getBroadleafRequestContext().getBroadleafCurrency();
+        NumberFormat nf = BroadleafCurrencyUtils.getNumberFormatFromCache(locale.getJavaLocale(), currency.getJavaCurrency());
+
         for (Entity entity : resultSet.getRecords()) {
             Property discountType = entity.findProperty(""discountType"");
             Property discountValue = entity.findProperty(""value"");
@@ -216,9 +221,6 @@
                 value = !value.contains(""."") ? value : value.replaceAll(""0*$"", """").replaceAll(""\\.$"", """");
                 discountValue.setValue(value + ""%"");
             } else if (discountType.getValue().equals(""AMOUNT_OFF"")) {
-                Locale locale =  BroadleafRequestContext.getBroadleafRequestContext().getLocale();
-                BroadleafCurrency currency =  BroadleafRequestContext.getBroadleafRequestContext().getBroadleafCurrency();
-                NumberFormat nf = BroadleafCurrencyUtils.getNumberFormatFromCache(locale.getJavaLocale(), currency.getJavaCurrency());
                 discountValue.setValue(nf.format(new BigDecimal(value)));
             }
 
@@ -233,8 +235,9 @@
             entity.addProperty(buildStackableProperty(offerItemTargetRuleType));
 
             if (!""listGridView"".equals(customCriteria)) {
+                String moneyPrefix = ((DecimalFormat) nf).getPositivePrefix();
                 String setValue = discountValue.getValue();
-                setValue = setValue.replaceAll(""\\%"", """").replaceAll(""\\$"", """");
+                setValue = setValue.replaceAll(""\\%"", """").replaceAll(moneyPrefix, """");
                 discountValue.setValue(setValue);
             }
 ",0
Bank tags: tag search should be startsWith not contains," 
 		Collection<String> tags = getTags(itemId, false);
 		tags.addAll(getTags(itemId, true));
-		return tags.stream().anyMatch(tag -> tag.contains(Text.standardize(search)));
+		return tags.stream().anyMatch(tag -> tag.startsWith(Text.standardize(search)));
 	}
 
 	public List<Integer> getItemsForTag(String tag)",0
Fix bug: FTP tile not work with wifi hotspot,"         mTile = getQsTile();
 
         if (!FTPService.isRunning()) {
-            if (FTPService.isConnectedToWifi(getApplicationContext())) {
+            if (FTPService.isConnectedToWifi(getApplicationContext())
+                    || FTPService.isConnectedToLocalNetwork(getApplicationContext())
+                    || FTPService.isEnabledWifiHotspot(getApplicationContext())) {
                 startServer();
                 mTile.setState(Tile.STATE_ACTIVE);
                 mTile.updateTile();",0
fix HttpSender icon," 		this.registerScriptType(new ScriptType(TYPE_STANDALONE, ""script.type.standalone"", createIcon(""/resource/icon/16/script-standalone.png""), false,
 				new String[] {ScriptType.CAPABILITY_APPEND}));
 		this.registerScriptType(new ScriptType(TYPE_TARGETED, ""script.type.targeted"", createIcon(""/resource/icon/16/script-targeted.png""), false));
-		this.registerScriptType(new ScriptType(TYPE_HTTP_SENDER, ""script.type.httpsender"", createIcon(""/resource/icon/16/script-targeted.png""), true));
+		this.registerScriptType(new ScriptType(TYPE_HTTP_SENDER, ""script.type.httpsender"", createIcon(""/resource/icon/16/script-httpsender.png""), true));
 
 		extensionHook.addSessionListener(new ClearScriptVarsOnSessionChange());
 ",0
Fix typo,,0
"Added missing break in ElasticSearchIndex, that now not all fields are stored analysed and not_analysed","                         break;
                     case TEXT:
                         //default, do nothing
+                    	break;
                     case TEXTSTRING:
                         mapping.endObject();
                         //add string mapping",0
Fixed bug #640 - Screen timeout in case of video playing in pop-up mode.,"             videoPlayPause.setBackgroundResource(R.drawable.ic_pause_white);
             lockManager.acquireWifiAndCpu();
 
-            hideControls(DEFAULT_CONTROLS_DURATION, DEFAULT_CONTROLS_HIDE_TIME);
+            windowLayoutParams.flags = WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON;
+            windowManager.updateViewLayout(playerImpl.getRootView(), windowLayoutParams);
         }
 
         @Override
@@ -677,6 +678,9 @@
             updateNotification(R.drawable.ic_play_arrow_white);
             videoPlayPause.setBackgroundResource(R.drawable.ic_play_arrow_white);
             lockManager.releaseWifiAndCpu();
+
+            windowLayoutParams.flags = 0;
+            windowManager.updateViewLayout(playerImpl.getRootView(), windowLayoutParams);
         }
 
         @Override",0
"Revert ""Revert ""CHE-10480: Fix NullPointerException (#11857)"" (#11908)""","             if (hover != null) {
               Either<List<Either<String, MarkedString>>, MarkupContent> contents =
                   hover.getContents();
+              // getContents() method can return null, in spite of @NonNull annotation,
+              // see https://github.com/eclipse/lsp4j/issues/284
+              if (contents == null) {
+                return false;
+              }
               if (contents.isLeft()) {
                 for (Either<String, MarkedString> part : contents.getLeft()) {
                   if (content.length() > 0) {",0
Fixed ad-hoc Java compilation," 
 package org.vertx.java.deploy.impl.java;
 
-import javax.tools.SimpleJavaFileObject;
 import java.io.IOException;
 import java.io.InputStream;
+import java.io.OutputStream;
+import java.io.OutputStreamWriter;
+import java.io.Reader;
+import java.io.Writer;
 import java.net.URI;
 
+import javax.lang.model.element.Modifier;
+import javax.lang.model.element.NestingKind;
+import javax.tools.JavaFileObject;
+
 /**
  * @author Janne Hietam&auml;ki
  */
-public class CustomJavaFileObject extends SimpleJavaFileObject {
+public class CustomJavaFileObject implements JavaFileObject {
   private final String binaryName;
+  private Kind kind;
+  private URI uri;
 
   protected CustomJavaFileObject(URI uri, Kind kind, String binaryName) {
-    super(uri, kind);
+    this.uri = uri;
+    this.kind = kind;
     this.binaryName = binaryName;
   }
 
@@ -40,4 +50,59 @@
   public InputStream openInputStream() throws IOException {
     return uri.toURL().openStream();
   }
+
+  public Kind getKind() {
+    return kind;
+  }
+
+  public NestingKind getNestingKind() {
+    return null;
+  }
+
+  @Override
+  public URI toUri() {
+    return uri;
+  }
+
+  public String getName() {
+    return toUri().getPath();
+  }
+
+  public OutputStream openOutputStream() throws IOException {
+    throw new UnsupportedOperationException();
+  }
+
+  public Reader openReader(boolean ignoreEncodingErrors) throws IOException {
+    throw new UnsupportedOperationException();
+  }
+
+  public CharSequence getCharContent(boolean ignoreEncodingErrors) throws IOException {
+    throw new UnsupportedOperationException();
+  }
+
+  public Writer openWriter() throws IOException {
+    return new OutputStreamWriter(openOutputStream());
+  }
+
+  public long getLastModified() {
+    return 0L;
+  }
+
+  public boolean delete() {
+    return false;
+  }
+
+  public boolean isNameCompatible(String simpleName, Kind kind) {
+    String name = simpleName + kind.extension;
+    return (name.equals(toUri().getPath()) || toUri().getPath().endsWith(""/"" + name)) && kind.equals(getKind());
+  }
+
+  public Modifier getAccessLevel() {
+    return null;
+  }
+
+  @Override
+  public String toString() {
+    return getClass().getName() + ""["" + toUri() + ""]"";
+  }
 }
\ No newline at end of file",0
Fixes #5246 by overriding getPreferredSize and setting height to 0.," 
 package processing.app.ui;
 
-import java.awt.Component;
-import java.awt.EventQueue;
+import java.awt.*;
+import java.util.Optional;
 
 import javax.swing.JTree;
 import javax.swing.tree.DefaultTreeCellRenderer;
@@ -37,6 +37,12 @@
     setFont(mode.getFont(""tree.font""));
   }
 
+  @Override
+  public Dimension getPreferredSize() {
+    return Optional.ofNullable(super.getPreferredSize())
+            .map(d -> new Dimension(d.width, (int) (d.height * 1.15f)))
+            .orElse(null);
+  }
 
   @Override
   public Component getTreeCellRendererComponent(JTree tree, Object value,
@@ -48,21 +54,9 @@
     // Adjust height for magnified displays. The font is scaled properly,
     // but the rows don't automatically use the scaled preferred size.
     // https://github.com/processing/processing/issues/4936
-    int high = getPreferredSize().height;
-    if (high != 0) {
-      // Source Sans leading too short, so also add 15% for nicer spacing
-      final int targetHeight = (int) (high * 1.15f);
-      int currentHeight = getSize().height;
-      if (currentHeight != targetHeight) {
-        // Using invokeLater() to avoid infinite loop on Windows
-        // https://github.com/processing/processing/issues/5246
-        EventQueue.invokeLater(new Runnable() {
-          public void run() {
-            tree.setRowHeight(targetHeight);
-          }
-        });
-      }
-    }
+    // Using setRowHeight(0) to force using this cell renderer's preferred height
+    // https://github.com/processing/processing/issues/5246#issuecomment-379503233
+    tree.setRowHeight(0);
     return super.getTreeCellRendererComponent(tree, value, selected,
                                               expanded, leaf, row, hasFocus);
   }",0
Unassigned entities log fix,"         if (!pool.isPresent()) {
             if (id != NULL_ID) {
                 if (isExistingEntity(id)) {
-                    logger.error(""Entity {} doesn't have an assigned pool"", id);
+                    // TODO: Entity pools assignment is not needed as of now, can be enabled later on when necessary.
+                    // logger.error(""Entity {} doesn't have an assigned pool"", id);
                 } else {
                     logger.error(""Entity {} doesn't exist"", id);
                 }",0
Fix hasObservers conditional for Output class,"         }
 
         boolean hasObservers() {
-            return valueRelay.hasObservers() || valueRelay.hasObservers();
+            return valueRelay.hasObservers() || errorRelay.hasObservers();
         }
     }
 }",0
Log the update count with DEBUG priority after running a SQL script,"                     warning = warning.getNextWarning();
                 }
                 // retrieve all results to ensure all errors are detected
-                while (hasResults || statement.getUpdateCount() != -1) {
+                int updateCount = -1;
+                while (hasResults || (updateCount = statement.getUpdateCount()) != -1) {
+                    if (updateCount != -1) {
+                        LOG.debug(""Update Count: "" + updateCount);
+                    }
                     hasResults = statement.getMoreResults();
                 }
             }",0
Fix ActionBar overlay problem.," import android.view.ViewGroup;
 import android.view.ViewParent;
 import android.view.ViewTreeObserver;
+import android.view.Window;
 import android.view.WindowManager;
 import android.view.accessibility.AccessibilityEvent;
 import android.view.accessibility.AccessibilityManager;
@@ -212,6 +213,7 @@
           return;
         }
         handleTranslucentActionBar((ViewGroup.MarginLayoutParams) params, activity);
+        handleActionBarOverlay((ViewGroup.MarginLayoutParams) params, activity);
 
         activity.addContentView(croutonView, params);
       }
@@ -261,6 +263,23 @@
     }
   }
 
+  @TargetApi(11)
+  private void handleActionBarOverlay(ViewGroup.MarginLayoutParams params, Activity activity) {
+    // ActionBar overlay is only available as of Android 3.0 Honeycomb.
+    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {
+      final boolean flags = activity.getWindow().hasFeature(Window.FEATURE_ACTION_BAR_OVERLAY);
+      if (flags) {
+        final int actionBarContainerId = Resources.getSystem().getIdentifier(""action_bar_container"", ""id"", ""android"");
+        final View actionBarContainer = activity.findViewById(actionBarContainerId);
+        // The action bar is present: the app is using a Holo theme.
+        if (actionBarContainer != null) {
+          final ViewGroup.MarginLayoutParams marginParams = (ViewGroup.MarginLayoutParams) params;
+          marginParams.topMargin = actionBarContainer.getBottom();
+        }
+      }
+    }
+  }
+
   /**
    * Removes the {@link Crouton}'s view after it's display
    * durationInMilliseconds.",0
Fix modules names in documentation," 
     private String viewLocation(final String name) {
         final StringBuilder sb = new StringBuilder();
-        if (templateResolver.getPrefix() != null) {
-            sb.append(templateResolver.getPrefix());
+        String prefix = templateResolver.getPrefix();
+        if (prefix != null) {
+            sb.append(prefix);
+            if (!prefix.endsWith(FILE_SEPARATOR)) {
             sb.append(FILE_SEPARATOR);
         }
+        }
         sb.append(name.replace(""/"", FILE_SEPARATOR));
         if (templateResolver.getSuffix() != null) {
             sb.append(templateResolver.getSuffix());",0
Fix: regression bug when relaunching app in VA," 		return marked;
 	}
 
+	/**
+	 * App started in VA may be removed in OverView screen, then AMS.removeTask will be invoked,
+	 * all data struct about the task in AMS are released, while the client's process is still alive.
+	 * So remove related data in VA as well. A new TaskRecord will be recreated in `onActivityCreated`
+	 *
+	 *  @see ActivityManager#removeTask(int)
+	 */
 	private void optimizedTasksLocked() {
+		@SuppressWarnings(""deprecation"")
 		ArrayList<ActivityManager.RecentTaskInfo> recentTask = new ArrayList<>(mAM.getRecentTasks(Integer.MAX_VALUE,
 				ActivityManager.RECENT_WITH_EXCLUDED | ActivityManager.RECENT_IGNORE_UNAVAILABLE));
 		int N = mHistory.size();
@@ -191,7 +199,7 @@
 				}
 			}
 			if (!taskAlive) {
-				mHistory.remove(N);
+				mHistory.removeAt(N);
 			}
 		}
 	}
@@ -272,6 +280,9 @@
 		if (sourceTask == null && reuseTarget == ReuseTarget.CURRENT) {
 			reuseTarget = ReuseTarget.AFFINITY;
 		}
+
+		optimizedTasksLocked();
+
 		String affinity = ComponentUtils.getTaskAffinity(info);
 		TaskRecord reuseTask = null;
 		switch (reuseTarget) {
@@ -288,7 +299,6 @@
 				break;
 		}
 
-		optimizedTasksLocked();
 		boolean taskMarked = false;
 		if (reuseTask == null) {
 			destIntent = startActivityProcess(userId, null, intent, info);",0
Fix to print all maps in a cache for heath endpoint,"             }
 
             Arrays.stream(statistics).forEach(s -> {
-                builder.withDetail(""size"", s.getSize())
-                    .withDetail(""capacity"", s.getCapacity())
-                    .withDetail(""evictions"", s.getEvictions())
-                    .withDetail(""percentFree"", s.getPercentFree())
-                    .withDetail(""percentFree"", s.toString(new StringBuilder()))
-                    .withDetail(""name"", s.getName());
+                Map<String, Object> map = new HashMap<>();
+                map.put(""size"", s.getSize());
+                map.put(""capacity"", s.getCapacity());
+                map.put(""evictions"", s.getEvictions());
+                map.put(""percentFree"", s.getPercentFree());
+                builder.withDetail(s.getName(), map);
             });
         } catch (final Exception e) {
             LOGGER.error(e.getMessage(), e);",0
Fix for encoding issue,"  */
 package com.ning.http.client.oauth;
 
+import com.ning.http.util.UTF8UrlEncoder;
 import com.ning.http.util.UTF8Codec;
 
 import javax.crypto.Mac;
@@ -36,7 +37,7 @@
     private final Mac mac;
 
     public ThreadSafeHMAC(ConsumerKey consumerAuth, RequestToken userAuth) {
-        byte[] keyBytes = UTF8Codec.toUTF8(consumerAuth.getSecret() + ""&"" + userAuth.getSecret());
+        byte[] keyBytes = UTF8Codec.toUTF8(UTF8UrlEncoder.encode(consumerAuth.getSecret()) + ""&"" + UTF8UrlEncoder.encode(userAuth.getSecret()));
         SecretKeySpec signingKey = new SecretKeySpec(keyBytes, HMAC_SHA1_ALGORITHM);
 
         // Get an hmac_sha1 instance and initialize with the signing key",0
The new task system didn't create the render targets. Fixed this by addi...,"         final AFrameTask task = new AFrameTask() {
             @Override
             protected void doTask() {
+                renderTarget.create();
                 mRenderTargets.add(renderTarget);
             }
         };",0
PDI-10451: Fixed bad imports," import java.util.HashMap;
 import java.util.List;
 
-import javax.tools.FileObject;
-
+import org.apache.commons.lang.StringUtils;
+import org.apache.commons.vfs.FileObject;
 import org.pentaho.di.core.Const;
 import org.pentaho.di.core.ResultFile;
 import org.pentaho.di.core.compress.CompressionProvider;
@@ -64,7 +64,6 @@
 import org.pentaho.di.trans.step.errorhandling.FileErrorHandlerContentLineNumber;
 import org.pentaho.di.trans.step.errorhandling.FileErrorHandlerMissingFiles;
 
-import com.sun.xml.internal.ws.util.StringUtils;
 
 /**
  * Read all sorts of text files, convert them to rows and writes these to one or more output streams.",0
fix(#1156): illegal reflective access on java 9," /**
- *    Copyright 2009-2017 the original author or authors.
+ *    Copyright 2009-2018 the original author or authors.
  *
  *    Licensed under the Apache License, Version 2.0 (the ""License"");
  *    you may not use this file except in compliance with the License.
@@ -313,7 +313,7 @@
   private Method[] getClassMethods(Class<?> cls) {
     Map<String, Method> uniqueMethods = new HashMap<String, Method>();
     Class<?> currentClass = cls;
-    while (currentClass != null) {
+    while (currentClass != null && currentClass != Object.class) {
       addUniqueMethods(uniqueMethods, currentClass.getDeclaredMethods());
 
       // we also need to look for interface methods -",0
HHH-12631 Fix invalid tracev calls in DefaultResolveNaturalIdEventListener," 		final boolean traceEnabled = LOG.isTraceEnabled();
 		if ( traceEnabled ) {
 			LOG.tracev(
-					""Attempting to resolve: {0}"",
-					MessageHelper.infoString( persister, event.getNaturalIdValues(), event.getSession().getFactory() )
+					""Attempting to resolve: {0}#{1}"",
+					MessageHelper.infoString( persister ),
+					event.getNaturalIdValues()
 			);
 		}
 
@@ -66,8 +67,9 @@
 		if ( entityId != null ) {
 			if ( traceEnabled ) {
 				LOG.tracev(
-						""Resolved object in cache: {0}"",
-						MessageHelper.infoString( persister, event.getNaturalIdValues(), event.getSession().getFactory() )
+						""Resolved object in cache: {0}#{1}"",
+						MessageHelper.infoString( persister ),
+						event.getNaturalIdValues()
 				);
 			}
 			return entityId;
@@ -75,8 +77,9 @@
 
 		if ( traceEnabled ) {
 			LOG.tracev(
-					""Object not resolved in any cache: {0}"",
-					MessageHelper.infoString( persister, event.getNaturalIdValues(), event.getSession().getFactory() )
+					""Object not resolved in any cache: {0}#{1}"",
+					MessageHelper.infoString( persister ),
+					event.getNaturalIdValues()
 			);
 		}
 ",0
Ensure we always encode all data in JdkZlibEncoder.,"         }
 
         deflater.setInput(inAry, offset, len);
-        while (!deflater.needsInput()) {
+        for (;;) {
             deflate(out);
+            if (deflater.needsInput()) {
+                // Consumed everything
+                break;
+            } else {
+                if (!out.isWritable()) {
+                    // We did not consume everything but the buffer is not writable anymore. Increase the capacity to
+                    // make more room.
+                    out.ensureWritable(out.writerIndex());
+                }
+            }
         }
     }
 ",0
Fix miniscule typo," 
     /**
      * This is called by the graphql engine to fetch the value.  The {@link graphql.schema.DataFetchingEnvironment} is a composite
-     * context object that tells you all you need to know about who to fetch a data value in graphql type terms.
+     * context object that tells you all you need to know about how to fetch a data value in graphql type terms.
      *
      * @param environment this is the data fetching environment which contains all the context you need to fetch a value
      *",0
修复执行 DDL 语句，中间件会将结构转为大写的方式执行的BUG," import com.google.common.util.concurrent.Futures;
 import com.google.common.util.concurrent.ListenableFuture;
 import io.mycat.MycatServer;
-import io.mycat.backend.PhysicalDBNode;
 import io.mycat.cache.LayerCachePool;
 import io.mycat.route.RouteResultset;
 import io.mycat.route.RouteResultsetNode;
@@ -161,8 +160,8 @@
     public static int[] getCreateTablePos(String upStmt, int start) {
         String token1 = ""CREATE "";
         String token2 = "" TABLE "";
-        int createInd = upStmt.indexOf(token1, start);
-        int tabInd = upStmt.indexOf(token2, start);
+        int createInd = upStmt.toUpperCase().indexOf(token1, start);
+        int tabInd = upStmt.toUpperCase().indexOf(token2, start);
         // 既包含CREATE又包含TABLE，且CREATE关键字在TABLE关键字之前
         if (createInd >= 0 && tabInd > 0 && tabInd > createInd) {
             return new int[] { tabInd, token2.length() };
@@ -184,8 +183,8 @@
     public static int[] getSpecPos(String upStmt, int start) {
         String token1 = "" FROM "";
         String token2 = "" IN "";
-        int tabInd1 = upStmt.indexOf(token1, start);
-        int tabInd2 = upStmt.indexOf(token2, start);
+        int tabInd1 = upStmt.toUpperCase().indexOf(token1, start);
+        int tabInd2 = upStmt.toUpperCase().indexOf(token2, start);
         if (tabInd1 > 0) {
             if (tabInd2 < 0) {
                 return new int[] { tabInd1, token1.length() };
@@ -208,9 +207,9 @@
      * @author mycat
      */
     public static int getSpecEndPos(String upStmt, int start) {
-        int tabInd = upStmt.indexOf("" LIKE "", start);
+        int tabInd = upStmt.toUpperCase().indexOf("" LIKE "", start);
         if (tabInd < 0) {
-            tabInd = upStmt.indexOf("" WHERE "", start);
+            tabInd = upStmt.toUpperCase().indexOf("" WHERE "", start);
         }
         if (tabInd < 0) {
             return upStmt.length();
@@ -368,7 +367,7 @@
     public static String getFixedSql(String stmt){
         if (stmt.endsWith("";""))
             stmt = stmt.substring(0,stmt.length()-2);
-        return stmt = stmt.trim().toUpperCase().replace(""`"","""");
+        return stmt = stmt.trim().replace(""`"","""");  
     }
 
     /**
@@ -384,8 +383,8 @@
     public static int[] getAlterTablePos(String upStmt, int start) {
         String token1 = ""ALTER "";
         String token2 = "" TABLE "";
-        int createInd = upStmt.indexOf(token1, start);
-        int tabInd = upStmt.indexOf(token2, start);
+        int createInd = upStmt.toUpperCase().indexOf(token1, start);
+        int tabInd = upStmt.toUpperCase().indexOf(token2, start);
         // 既包含CREATE又包含TABLE，且CREATE关键字在TABLE关键字之前
         if (createInd >= 0 && tabInd > 0 && tabInd > createInd) {
             return new int[] { tabInd, token2.length() };
@@ -406,11 +405,11 @@
      */
     public static int[] getDropTablePos(String upStmt, int start) {
         //增加 if exists判断
-        if(upStmt.contains(""EXISTS"")){
+        if(upStmt.toUpperCase().contains(""EXISTS"")){
             String token1 = ""IF "";
             String token2 = "" EXISTS "";
-            int ifInd = upStmt.indexOf(token1, start);
-            int tabInd = upStmt.indexOf(token2, start);
+            int ifInd = upStmt.toUpperCase().indexOf(token1, start);
+            int tabInd = upStmt.toUpperCase().indexOf(token2, start);
             if (ifInd >= 0 && tabInd > 0 && tabInd > ifInd) {
                 return new int[] { tabInd, token2.length() };
             } else {
@@ -419,8 +418,8 @@
         }else {
             String token1 = ""DROP "";
             String token2 = "" TABLE "";
-            int createInd = upStmt.indexOf(token1, start);
-            int tabInd = upStmt.indexOf(token2, start);
+            int createInd = upStmt.toUpperCase().indexOf(token1, start);
+            int tabInd = upStmt.toUpperCase().indexOf(token2, start);
 
             if (createInd >= 0 && tabInd > 0 && tabInd > createInd) {
                 return new int[] { tabInd, token2.length() };
@@ -444,8 +443,8 @@
     public static int[] getTruncateTablePos(String upStmt, int start) {
         String token1 = ""TRUNCATE "";
         String token2 = "" TABLE "";
-        int createInd = upStmt.indexOf(token1, start);
-        int tabInd = upStmt.indexOf(token2, start);
+        int createInd = upStmt.toUpperCase().indexOf(token1, start);
+        int tabInd = upStmt.toUpperCase().indexOf(token2, start);
         // 既包含CREATE又包含TABLE，且CREATE关键字在TABLE关键字之前
         if (createInd >= 0 && tabInd > 0 && tabInd > createInd) {
             return new int[] { tabInd, token2.length() };",0
Fix race condition between Breakpoint construction and access from listeners,"         if (breakpoint == null) {
             final SourceSectionFilter query = SourceSectionFilter.newBuilder().sourceIs(lineLocation.getSource()).lineStartsIn(IndexRange.byLength(lineLocation.getLineNumber(), 1)).tagIs(
                             StandardTags.StatementTag.class).build();
-            breakpoint = new BreakpointImpl(lineLocation, query, ignoreCount, oneShot);
+            breakpoint = createBreakpoint(lineLocation, query, ignoreCount, oneShot);
             if (TRACE) {
                 trace(""NEW "" + breakpoint.getShortDescription());
             }
@@ -192,7 +192,7 @@
         BreakpointImpl breakpoint = breakpoints.get(tag);
         if (breakpoint == null) {
             final SourceSectionFilter query = SourceSectionFilter.newBuilder().tagIs(tag).build();
-            breakpoint = new BreakpointImpl(tag, query, ignoreCount, oneShot);
+            breakpoint = createBreakpoint(tag, query, ignoreCount, oneShot);
             if (TRACE) {
                 trace(""NEW "" + breakpoint.getShortDescription());
             }
@@ -253,6 +253,16 @@
         breakpoints.remove(breakpoint.getKey());
     }
 
+    BreakpointImpl createBreakpoint(Object key, SourceSectionFilter query, int ignoreCount, boolean isOneShot) {
+        BreakpointImpl breakpoint = new BreakpointImpl(key, query, ignoreCount, isOneShot);
+        // Register listener after breakpoint has been constructed and JMM
+        // allows for safe publication. Otherwise, we can't be sure that the
+        // assumption fields are visible by other threads, which would lead to
+        // a race with object initialization.
+        breakpoint.binding = instrumenter.attachListener(breakpoint.locationQuery, new BreakpointListener(breakpoint));
+        return breakpoint;
+    }
+
     private final class BreakpointImpl extends Breakpoint implements ExecutionEventNodeFactory {
 
         private static final String SHOULD_NOT_HAPPEN = ""BreakpointImpl:  should not happen"";
@@ -266,24 +276,24 @@
         @SuppressWarnings(""rawtypes"") private EventBinding binding;
 
         // Cached assumption that the global status of line breakpoint activity has not changed.
-        private Assumption breakpointsActiveAssumption;
+        @CompilationFinal private Assumption breakpointsActiveAssumption;
 
         // Whether this breakpoint is enable/disabled
         @CompilationFinal private boolean isEnabled;
-        private Assumption enabledUnchangedAssumption;
+        @CompilationFinal private Assumption enabledUnchangedAssumption;
 
         private Source conditionSource;
         @SuppressWarnings(""rawtypes"") private Class<? extends TruffleLanguage> condLangClass;
 
-        BreakpointImpl(Object key, SourceSectionFilter query, int ignoreCount, boolean isOneShot) {
+        private BreakpointImpl(Object key, SourceSectionFilter query, int ignoreCount, boolean isOneShot) {
             super();
             this.ignoreCount = ignoreCount;
             this.isOneShot = isOneShot;
             this.locationKey = key;
             this.locationQuery = query;
-            this.binding = instrumenter.attachListener(locationQuery, new BreakpointListener());
-            this.breakpointsActiveAssumption = BreakpointFactory.this.breakpointsActiveUnchanged.getAssumption();
             this.isEnabled = true;
+
+            this.breakpointsActiveAssumption = BreakpointFactory.this.breakpointsActiveUnchanged.getAssumption();
             this.enabledUnchangedAssumption = Truffle.getRuntime().createAssumption(""Breakpoint enabled state unchanged"");
         }
 
@@ -347,7 +357,7 @@
             binding.dispose();
             if (expr == null) {
                 conditionSource = null;
-                binding = instrumenter.attachListener(locationQuery, new BreakpointListener());
+                binding = instrumenter.attachListener(locationQuery, new BreakpointListener(this));
             } else {
                 conditionSource = Source.fromText(expr, ""breakpoint condition from text: "" + expr);
                 binding = instrumenter.attachFactory(locationQuery, this);
@@ -482,31 +492,6 @@
             warningLog.addWarning(String.format(""Exception in %s:  %s"", getShortDescription(), ex.getMessage()));
         }
 
-        /** Attached to implement an unconditional breakpoint. */
-        private final class BreakpointListener implements ExecutionEventListener {
-
-            @Override
-            public void onEnter(EventContext context, VirtualFrame frame) {
-                if (TRACE) {
-                    trace(""hit breakpoint "" + getShortDescription());
-                }
-                BreakpointImpl.this.nodeEnter(context, frame);
-            }
-
-            @Override
-            public void onReturnValue(EventContext context, VirtualFrame frame, Object result) {
-            }
-
-            @Override
-            public void onReturnExceptional(EventContext context, VirtualFrame frame, Throwable exception) {
-            }
-
-            @Override
-            public String toString() {
-                return getShortDescription();
-            }
-        }
-
         /** Attached to implement a conditional breakpoint. */
         private class BreakpointConditionEventNode extends ExecutionEventNode {
             @Child DirectCallNode callNode;
@@ -551,4 +536,35 @@
             return sb.toString();
         }
     }
+
+    /** Attached to implement an unconditional breakpoint. */
+    private static final class BreakpointListener implements ExecutionEventListener {
+
+        private final BreakpointImpl breakpoint;
+
+        BreakpointListener(BreakpointImpl breakpoint) {
+            this.breakpoint = breakpoint;
+        }
+
+        @Override
+        public void onEnter(EventContext context, VirtualFrame frame) {
+            if (TRACE) {
+                trace(""hit breakpoint "" + breakpoint.getShortDescription());
+            }
+            breakpoint.nodeEnter(context, frame);
+        }
+
+        @Override
+        public void onReturnValue(EventContext context, VirtualFrame frame, Object result) {
+        }
+
+        @Override
+        public void onReturnExceptional(EventContext context, VirtualFrame frame, Throwable exception) {
+        }
+
+        @Override
+        public String toString() {
+            return breakpoint.getShortDescription();
+        }
+    }
 }",0
Fixed KTXProcessor in gdx-tools never exiting.," 				}
 
 				out.close();
+				System.out.println(""Finished"");
 			} catch (Exception e) {
 				Gdx.app.error(""KTXProcessor"", ""Error writing to file: "" + output.getName(), e);
 			}
+
+			Gdx.app.exit();
 		}
 	}
 ",0
TextField#getSelection fix," 	public void setText (String str) {
 		if (str == null) throw new IllegalArgumentException(""text cannot be null."");
 
-		BitmapFont font = style.font;
 		clearSelection();
 		text = """";
 		paste(str, onlyFontChars);
@@ -705,7 +704,7 @@
 	}
 
 	public String getSelection () {
-		return text.substring(selectionStart, cursor);
+		return hasSelection ? text.substring(Math.min(selectionStart, cursor), Math.max(selectionStart, cursor)) : """";
 	}
 
 	/** Sets the selected text. */",0
配置默认节点路由bug修复," 	public static boolean isAllGlobalTable(DruidShardingParseInfo ctx, SchemaConfig schema) {
 		boolean isAllGlobal = false;
 		for(String table : ctx.getTables()) {
-			if(schema.getTables().get(table).isGlobalTable()) {
+			TableConfig tableConfig = schema.getTables().get(table);
+			if(tableConfig!=null && tableConfig.isGlobalTable()) {
 				isAllGlobal = true;
-			} else {
-				return false;
+				break;
 			}
 		}
 		return isAllGlobal;",0
Unbreak index range calculation,"     }
 
     public SearchHit firstOfIndex(String index) {
-        return oneOfIndex(index, matchAllQuery(), SortOrder.DESC);
-    }
-
-    public SearchHit lastOfIndex(String index) {
         return oneOfIndex(index, matchAllQuery(), SortOrder.ASC);
     }
 ",0
Ensure the confirm password field is ordered directly after the password,"             addMetadataFromFieldTypeRequest.getDynamicEntityDao().getDefaultFieldMetadataProvider().addMetadataFromFieldType(addMetadataFromFieldTypeRequest, metadata);
             ((BasicFieldMetadata)addMetadataFromFieldTypeRequest.getPresentationAttribute()).setFieldType(SupportedFieldType.PASSWORD);
             
+            BasicFieldMetadata originalMd = (BasicFieldMetadata) addMetadataFromFieldTypeRequest.getPresentationAttribute();
+
             //clone the password field and add in a custom one
-            BasicFieldMetadata confirmMd = (BasicFieldMetadata) addMetadataFromFieldTypeRequest.getPresentationAttribute().cloneFieldMetadata();
+            BasicFieldMetadata confirmMd = (BasicFieldMetadata) originalMd.cloneFieldMetadata();
             confirmMd.setFieldName(""passwordConfirm"");
             confirmMd.setFriendlyName(""AdminUserImpl_Admin_Password_Confirm"");
             confirmMd.setExplicitFieldType(SupportedFieldType.PASSWORD_CONFIRM);
             confirmMd.setValidationConfigurations(new HashMap<String, List<Map<String,String>>>());
+            confirmMd.setOrder(originalMd.getOrder() + 1);
             metadata.put(""passwordConfirm"", confirmMd);
             return MetadataProviderResponse.HANDLED;
         } else {",0
Change to how clones change their scale and a bug fix," 		clone.getGeometry().copyFromGeometry3D(mGeometry);
 		clone.isContainer(mIsContainerOnly);
 		clone.setMaterial(mMaterial);
-		clone.setScale(mScale);
+		//clone.setScale(mScale);
 		return clone;
 	}
 
@@ -630,7 +630,7 @@
 	}
 
 	public void setRotation(Number3D rotation) {
-		mPosition = rotation;
+		mRotation = rotation;
 	}
 	
 	public float[] getRotationMatrix() {",0
fixed jdk 8 KeySetView compatibility," 
 package com.navercorp.pinpoint.collector.cluster.connection;
 
+import com.google.common.collect.Lists;
 import com.navercorp.pinpoint.rpc.PinpointSocket;
 
 import java.net.SocketAddress;
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Set;
 import java.util.concurrent.ConcurrentHashMap;
 
 /**
@@ -46,7 +48,9 @@
     }
 
     public List<SocketAddress> getAddressList() {
-        return new ArrayList<>(clusterConnectionRepository.keySet());
+        // fix jdk 8 KeySetView compatibility
+        Set<SocketAddress> socketAddresses = clusterConnectionRepository.keySet();
+        return new ArrayList<>(socketAddresses);
     }
 
     public List<PinpointSocket> getClusterSocketList() {",0
Attempt to fix an IllegalArgumentException in the MemcachedTicketRegistry," import org.apereo.cas.authentication.DefaultAuthenticationHandlerExecutionResult;
 import org.apereo.cas.authentication.PreventedException;
 import org.apereo.cas.authentication.UsernamePasswordCredential;
+import org.apereo.cas.authentication.RememberMeUsernamePasswordCredential;
 import org.apereo.cas.authentication.exceptions.AccountDisabledException;
 import org.apereo.cas.authentication.exceptions.InvalidLoginLocationException;
 import org.apereo.cas.authentication.exceptions.InvalidLoginTimeException;
@@ -188,6 +189,7 @@
         kryo.register(DefaultAuthenticationHandlerExecutionResult.class);
         kryo.register(DefaultAuthentication.class);
         kryo.register(UsernamePasswordCredential.class);
+        kryo.register(RememberMeUsernamePasswordCredential.class);
         kryo.register(SimplePrincipal.class);
         kryo.register(PublicKeyFactoryBean.class);
         kryo.register(ReturnAllowedAttributeReleasePolicy.class);",0
Just added a fix to setCurrent item for TabPageIndicator,"             throw new IllegalStateException(""ViewPager has not been bound."");
         }
         mSelectedTabIndex = item;
+        mViewPager.setCurrentItem(item);
+        
         final int tabCount = mTabLayout.getChildCount();
         for (int i = 0; i < tabCount; i++) {
             final View child = mTabLayout.getChildAt(i);",0
compile fix for java 1.6,"         final long start = System.nanoTime();
         final Future<Boolean> f = putIfAbsentAsyncInternal(key, value, expiryPolicy, true, false);
         try {
-            boolean saved = toObject(f.get());
+            boolean saved = f.get();
             if (statisticsEnabled) {
                 handleStatisticsOnPutIfAbsent(start, saved);
             }
@@ -361,7 +361,7 @@
         final long start = System.nanoTime();
         final Future<Boolean> f = replaceAsyncInternal(key, oldValue, newValue, expiryPolicy, true, true, false);
         try {
-            boolean replaced = toObject(f.get());
+            boolean replaced = f.get();
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(false, start, replaced);
             }
@@ -376,7 +376,7 @@
         final long start = System.nanoTime();
         final Future<Boolean> f = replaceAsyncInternal(key, null, value, expiryPolicy, false, true, false);
         try {
-            boolean replaced = toObject(f.get());
+            boolean replaced = f.get();
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(false, start, replaced);
             }
@@ -391,7 +391,7 @@
         final long start = System.nanoTime();
         final Future<V> f = replaceAndGetAsyncInternal(key, null, value, expiryPolicy, false, true, false);
         try {
-            V oldValue = toObject(f.get());
+            V oldValue = f.get();
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(true, start, oldValue);
             }",0
[java] Fix for maximally specific method selection,"         } else if (second.isAbstract()) {
             return first; // first isn't abstract, second one is
         } else {
-            throw new IllegalStateException(""None of the maximally specific methods are abstract.\n""
-                                                    + first.toString() + ""\n"" + second.toString());
+            return null; // TODO: once shadowing and overriding methods is done, add exception back
+            // throw new IllegalStateException(""None of the maximally specific methods are abstract.\n""
+            //                                        + first.toString() + ""\n"" + second.toString());
         }
     }
 ",0
Fix crash in PreferenceScreen.onRestoreInstanceState()," 
     @Override
     protected void onRestoreInstanceState(Parcelable state) {
+        if (state == null || !state.getClass().equals(SavedState.class)) {
+            super.onRestoreInstanceState(state);
+            return;
+        }
         SavedState myState = (SavedState) state;
         super.onRestoreInstanceState(myState.getSuperState());
         if (myState.isShowing) {",0
"fix null pointer bug with rule ""a : a;"""," 		List<Triple<Integer,AltAST,String>> labels = new ArrayList<Triple<Integer,AltAST,String>>();
 		List<Triple<Integer,AltAST,String>> normalAltLabels = super.getAltLabels();
 		if ( normalAltLabels!=null ) labels.addAll(normalAltLabels);
+		if ( recPrimaryAlts!=null ) {
 		for (LeftRecursiveRuleAltInfo altInfo : recPrimaryAlts) {
 			if (altInfo.altLabel != null) {
 				labels.add(new Triple<Integer, AltAST, String>(altInfo.altNum,
@@ -95,6 +96,8 @@
 															   altInfo.altLabel));
 			}
 		}
+		}
+		if ( recOpAlts!=null ) {
 		for (int i = 0; i < recOpAlts.size(); i++) {
 			LeftRecursiveRuleAltInfo altInfo = recOpAlts.getElement(i);
 			if ( altInfo.altLabel!=null ) {
@@ -103,6 +106,7 @@
 															 altInfo.altLabel));
 			}
 		}
+		}
 		if ( labels.isEmpty() ) return null;
 		return labels;
 	}",0
Cloned Object3Ds now get names from their origin Object3D fixes #1399," 	}
 
 	protected void cloneTo(Object3D clone, boolean copyMaterial) {
+        clone.setName(mName);
 		clone.getGeometry().copyFromGeometry3D(mGeometry);
 		clone.isContainer(mIsContainerOnly);
 		clone.setMaterial(mMaterial);",0
Properly reset Database options panel,"      */
     private static final String PARAM_RECOVERY_LOG_ENABLED = PARAM_BASE_KEY + "".recoverylog"";
 
+    private static final boolean DEFAULT_COMPACT_DATABASE = false;
+    private static final int DEFAULT_BODY_SIZE = 16777216;
+    private static final int DEFAULT_NEW_SESSION_OPTION = NEW_SESSION_NOT_SPECIFIED;
+    private static final boolean DEFAULT_NEW_SESSION_PROMPT = true;
+    private static final boolean DEFAULT_RECOVERY_LOG_ENABLED = true;
+
     /**
      * The compact option, whether the database should be compacted on exit.
      * Default is {@code false}.
@@ -86,14 +92,14 @@
     
     /**
      * The request body size in the history table.
-     * Default is 16777216.
+     * Default is {@value #DEFAULT_BODY_SIZE}.
      * 
      */    
     private int requestbodysize;
 
     /**
      * The response body size in the history table.
-     * Default is 16777216.
+     * Default is {@value #DEFAULT_BODY_SIZE}.
      * 
      */    
     private int responsebodysize;
@@ -121,12 +127,12 @@
     public DatabaseParam() {
         super();
         
-        compactDatabase = false;
-        requestbodysize = 16777216;
-		responsebodysize = 16777216;
-		newSessionOption = NEW_SESSION_NOT_SPECIFIED;
-		newSessionPrompt = true;
-		recoveryLogEnabled = true;
+        compactDatabase = DEFAULT_COMPACT_DATABASE;
+        requestbodysize = DEFAULT_BODY_SIZE;
+		responsebodysize = DEFAULT_BODY_SIZE;
+		newSessionOption = DEFAULT_NEW_SESSION_OPTION;
+		newSessionPrompt = DEFAULT_NEW_SESSION_PROMPT;
+		recoveryLogEnabled = DEFAULT_RECOVERY_LOG_ENABLED;
     }
 
     /**
@@ -143,12 +149,12 @@
      */
     @Override
     protected void parse() {
-        compactDatabase = getConfig().getBoolean(PARAM_COMPACT_DATABASE, compactDatabase);
-        requestbodysize = getConfig().getInt(PARAM_REQUEST_BODY_SIZE, requestbodysize);
-        responsebodysize = getConfig().getInt(PARAM_RESPONSE_BODY_SIZE, responsebodysize);
-		newSessionOption = getConfig().getInt(PARAM_NEW_SESSION_OPTION, newSessionOption);
-		newSessionPrompt = getConfig().getBoolean(PARAM_NEW_SESSION_PROMPT, newSessionPrompt);
-		recoveryLogEnabled = getConfig().getBoolean(PARAM_RECOVERY_LOG_ENABLED, recoveryLogEnabled);
+        compactDatabase = getBoolean(PARAM_COMPACT_DATABASE, DEFAULT_COMPACT_DATABASE);
+        requestbodysize = getInt(PARAM_REQUEST_BODY_SIZE, DEFAULT_BODY_SIZE);
+        responsebodysize = getInt(PARAM_RESPONSE_BODY_SIZE, DEFAULT_BODY_SIZE);
+		newSessionOption = getInt(PARAM_NEW_SESSION_OPTION, DEFAULT_NEW_SESSION_OPTION);
+		newSessionPrompt = getBoolean(PARAM_NEW_SESSION_PROMPT, DEFAULT_NEW_SESSION_PROMPT);
+		recoveryLogEnabled = getBoolean(PARAM_RECOVERY_LOG_ENABLED, DEFAULT_RECOVERY_LOG_ENABLED);
     }
 
     /**",0
camel-core - Fix typo in XmlConverter javadoc,"     }
 
     /**
-     * Converts the given {@link InputStream} to a DOM document
+     * Converts the given {@link Reader} to a DOM document
      *
      * @param in is the data to be parsed
      * @return the parsed document
@@ -885,7 +885,7 @@
     }
     
     /**
-     * Converts the given {@link InputStream} to a DOM document
+     * Converts the given {@link Reader} to a DOM document
      *
      * @param in is the data to be parsed
      * @param exchange is the exchange to be used when calling the converter",0
Fix/494,"     private float mRate = 1.0f;
     private boolean mPlayInBackground = false;
     private boolean mActiveStatePauseStatus = false;
+    private boolean mActiveStatePauseStatusInitialized = false;
 
     private int mMainVer = 0;
     private int mPatchVer = 0;
@@ -236,7 +237,7 @@
                     headers.put(""Cookie"", cookie);
                 }
 
-                setDataSource(mThemedReactContext, parsedUrl, headers);
+                setDataSource(uriString);
             } else if (isAsset) {
                 if (uriString.startsWith(""content://"")) {
                     Uri parsedUrl = Uri.parse(uriString);
@@ -325,6 +326,11 @@
 
         mPaused = paused;
 
+        if ( !mActiveStatePauseStatusInitialized ) {
+            mActiveStatePauseStatus = mPaused;
+            mActiveStatePauseStatusInitialized = true;
+        }
+
         if (!mMediaPlayerValid) {
             return;
         }",0
fix Javadoc,"  *
  * <p>
  * The actual meaning and the purpose of parameters are entirely up to users, so
- * what the concrete parameter implmentation is pluggable. Write subclasses
+ * what the concrete parameter implementation is pluggable. Write subclasses
  * in a plugin and put {@link Extension} on the descriptor to register them.
  *
  * <p>
@@ -82,8 +82,8 @@
  * <h2>Assocaited Views</h2>
  * <h4>config.jelly</h4>
  * <p>
- * {@link ParameterDefinition} class uses <tt>config.jelly</tt> to provide contribute a form
- * fragment in the job configuration screen. Values entered there is fed back to
+ * {@link ParameterDefinition} class uses <tt>config.jelly</tt> to contribute a form
+ * fragment in the job configuration screen. Values entered there are fed back to
  * {@link ParameterDescriptor#newInstance(StaplerRequest, JSONObject)} to create {@link ParameterDefinition}s.
  *
  * <h4>index.jelly</h4>",0
Fix ConvolutionUtils for 2d case,"             throw new DL4JInvalidInputException(sb.toString());
         }
 
-        if (eKernel.length == 2 && convolutionMode != ConvolutionMode.Same
+        if (eKernel.length == 3 && convolutionMode != ConvolutionMode.Same
                 && (eKernel[2] <= 0 || eKernel[2] > inShape[2] + 2 * padding[2])) {
             int inD = inShape[2];
             StringBuilder sb = new StringBuilder();",0
fix recycleResources npe," 
 		ByteBuffer buf = buffer;
 		if (buf != null) {
-			buffer = null;
 			session.getSource().recycle(buffer);
+			buffer = null;
 
 		}
 	}",0
Fixes #18 onScrollStateChanged never get called,"     private int mLayoutMode;
 
     private int mTouchMode;
+    private int mScrollState = OnScrollListener.SCROLL_STATE_IDLE;
 
     // Rectangle used for hit testing children
     // private Rect mTouchFrame;
@@ -2004,8 +2005,8 @@
     }
 
     void reportScrollStateChange(int newState) {
-        if (newState != mTouchMode) {
-            mTouchMode = newState;
+        if (newState != mScrollState) {
+            mScrollState = newState;
             if (mOnScrollListener != null) {
                 mOnScrollListener.onScrollStateChanged(this, newState);
             }",0
修复单节点ok包packid多加一次的bug," 				ok.packetId = ++packetId;// OK_PACKET
 			}
 			ok.serverStatus = source.isAutocommit() ? 2 : 1;
-			ok.packetId = ++packetId;
+
 			recycleResources();
 			source.setLastInsertId(ok.insertId);
 			ok.write(source);",0
[1.4.x] Fix UNDERTOW-981 - Filter default ports of a scheme in ProxyPeerAddressHandler,"             if(forwardedPort != null) {
                 try {
                     port = Integer.parseInt(forwardedPort);
+                    String scheme = exchange.getRequestScheme();
+
+                    if (! standardPort(port, scheme)) {
                     hostHeader += "":"" + port;
+                    }
                 } catch (NumberFormatException ignore) {
                     UndertowLogger.REQUEST_LOGGER.debugf(""Cannot parse port: %s"", forwardedPort);
                 }
@@ -108,6 +112,9 @@
         next.handleRequest(exchange);
     }
 
+    private static boolean standardPort(int port, String scheme) {
+        return (port == 80 && ""http"".equals(scheme)) || (port == 443 & ""https"".equals(scheme));
+    }
 
     public static class Builder implements HandlerBuilder {
 ",0
Fix random Popup player crash,"         @Override
         public void onLoadingComplete(String imageUri, View view, Bitmap loadedImage) {
             super.onLoadingComplete(imageUri, view, loadedImage);
+            if (playerImpl == null) return;
             // rebuild notification here since remote view does not release bitmaps,
             // causing memory leaks
             resetNotification();",0
small javadoc fix,"     Traversable<? extends Traversable<T>> sliding(int size);
 
     /**
-     * Slides a window of specific {@code size} and {@code step} size over this {@code Traversable}.
+     * Slides a window of a specific {@code size} and {@code step} size over this {@code Traversable}.
      * <p>
      * Examples:
      * <pre>
@@ -927,7 +927,7 @@
      * @param size a positive window size
      * @param step a positive step size
      * @return a new Traversable of windows of a specific size using a specific step size
-     * @throws IllegalArgumentException if size is negative or zero
+     * @throws IllegalArgumentException if size or step are negative or zero
      */
     Traversable<? extends Traversable<T>> sliding(int size, int step);
 ",0
Fix a bug which make isDone method infinite-loop," 
     @Override
     public boolean isDone() {
-        return this.isDone();
+        return super.isDone();
     }
 
     @Override",0
Error in ClientHearbeatMonitor connection.close message,"         }
 
         final Connection connection = clientEndpoint.getConnection();
-        final long lastTimePackageReceived = connection.lastReadTimeMillis();
+        final long lastTimePacketReceived = connection.lastReadTimeMillis();
         final long timeoutInMillis = SECONDS.toMillis(heartbeatTimeoutSeconds);
         final long currentTimeMillis = Clock.currentTimeMillis();
-        if (lastTimePackageReceived + timeoutInMillis < currentTimeMillis) {
+        if (lastTimePacketReceived + timeoutInMillis < currentTimeMillis) {
             if (memberUuid.equals(clientEndpoint.getPrincipal().getOwnerUuid())) {
                 String message = ""Client heartbeat is timed out, closing connection to "" + connection
-                        + "". Now: "" + timeToString(lastTimePackageReceived)
-                        + "". LastTimePacketReceived: "" + timeToString(lastTimePackageReceived);
+                        + "". Now: "" + timeToString(currentTimeMillis)
+                        + "". LastTimePacketReceived: "" + timeToString(lastTimePacketReceived);
                 logger.log(Level.WARNING, message);
                 connection.close(message, null);
             }",0
Fix square/leakcanary#957.,"     boolean extendsThread = false;
     ClassObj parentClass = clazz;
     while (parentClass.getSuperClassObj() != null) {
-      if (clazz.getClassName().equals(Thread.class.getName())) {
+      if (parentClass.getClassName().equals(Thread.class.getName())) {
         extendsThread = true;
         break;
       }",0
Correctly detect if KeyManagerFactory is supported by OpenSSL even wh…," 
 import io.netty.buffer.ByteBuf;
 import io.netty.buffer.ByteBufAllocator;
-import io.netty.handler.ssl.util.SelfSignedCertificate;
 import io.netty.internal.tcnative.Buffer;
 import io.netty.internal.tcnative.Library;
 import io.netty.internal.tcnative.SSL;
@@ -31,8 +30,11 @@
 import io.netty.util.internal.logging.InternalLogger;
 import io.netty.util.internal.logging.InternalLoggerFactory;
 
+import java.io.ByteArrayInputStream;
 import java.security.AccessController;
 import java.security.PrivilegedAction;
+import java.security.cert.CertificateFactory;
+import java.security.cert.X509Certificate;
 import java.util.ArrayList;
 import java.util.Collections;
 import java.util.LinkedHashSet;
@@ -142,7 +144,6 @@
             try {
                 final long sslCtx = SSLContext.make(SSL.SSL_PROTOCOL_ALL, SSL.SSL_MODE_SERVER);
                 long certBio = 0;
-                SelfSignedCertificate cert = null;
                 try {
                     try {
                         SSLContext.setCipherSuite(sslCtx, TLSV13_CIPHERS, true);
@@ -172,8 +173,40 @@
                             logger.debug(""Hostname Verification not supported."");
                         }
                         try {
-                            cert = new SelfSignedCertificate();
-                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, cert.cert());
+                            // Bytes of self-signed certificate for netty.io
+                            byte[] certBytes = {
+                                    48, -126, 1, -92, 48, -126, 1, 13, -96, 3, 2, 1, 2, 2, 9, 0, -9, 61,
+                                    44, 121, -118, -4, -45, -120, 48, 13, 6, 9, 42, -122, 72, -122,
+                                    -9, 13, 1, 1, 5, 5, 0, 48, 19, 49, 17, 48, 15, 6, 3, 85, 4, 3, 19,
+                                    8, 110, 101, 116, 116, 121, 46, 105, 111, 48, 32, 23, 13, 49, 55,
+                                    49, 48, 50, 48, 49, 56, 49, 54, 51, 54, 90, 24, 15, 57, 57, 57, 57,
+                                    49, 50, 51, 49, 50, 51, 53, 57, 53, 57, 90, 48, 19, 49, 17, 48, 15,
+                                    6, 3, 85, 4, 3, 19, 8, 110, 101, 116, 116, 121, 46, 105, 111, 48, -127,
+                                    -97, 48, 13, 6, 9, 42, -122, 72, -122, -9, 13, 1, 1, 1, 5, 0, 3, -127,
+                                    -115, 0, 48, -127, -119, 2, -127, -127, 0, -116, 37, 122, -53, 28, 46,
+                                    13, -90, -14, -33, 111, -108, -41, 59, 90, 124, 113, -112, -66, -17,
+                                    -102, 44, 13, 7, -33, -28, 24, -79, -126, -76, 40, 111, -126, -103,
+                                    -102, 34, 11, 45, 16, -38, 63, 24, 80, 24, 76, 88, -93, 96, 11, 38,
+                                    -19, -64, -11, 87, -49, -52, -65, 24, 36, -22, 53, 8, -42, 14, -121,
+                                    114, 6, 17, -82, 10, 92, -91, -127, 81, -12, -75, 105, -10, -106, 91,
+                                    -38, 111, 50, 57, -97, -125, 109, 42, -87, -1, -19, 80, 78, 49, -97, -4,
+                                    23, -2, -103, 122, -107, -43, 4, -31, -21, 90, 39, -9, -106, 34, -101,
+                                    -116, 31, -94, -84, 80, -6, -78, -33, 87, -90, 31, 103, 100, 56, -103,
+                                    -5, 11, 2, 3, 1, 0, 1, 48, 13, 6, 9, 42, -122, 72, -122, -9, 13, 1, 1,
+                                    5, 5, 0, 3, -127, -127, 0, 112, 45, -73, 5, 64, 49, 59, 101, 51, 73,
+                                    -96, 62, 23, -84, 90, -41, -58, 83, -20, -72, 38, 123, -108, -45, 28,
+                                    96, -122, -18, 30, 42, 86, 87, -87, -28, 107, 110, 11, -59, 91, 100,
+                                    101, -18, 26, -103, -78, -80, -3, 38, 113, 83, -48, -108, 109, 41, -15,
+                                    6, 112, 105, 7, -46, -11, -3, -51, 40, -66, -73, -83, -46, -94, -121,
+                                    -88, 51, -106, -77, 109, 53, -7, 123, 91, 75, -105, -22, 64, 121, -72,
+                                    -59, -21, -44, 84, 12, 9, 120, 21, -26, 13, 49, -81, -58, -47, 117,
+                                    -44, -18, -17, 124, 49, -48, 19, 16, -41, 71, -52, -107, 99, -19, -29,
+                                    105, -93, -71, -38, -97, -128, -2, 118, 119, 49, -126, 109, 119 };
+
+                            CertificateFactory cf = CertificateFactory.getInstance(""X.509"");
+                            X509Certificate certificate = (X509Certificate) cf.generateCertificate(
+                                    new ByteArrayInputStream(certBytes));
+                            certBio = ReferenceCountedOpenSslContext.toBIO(ByteBufAllocator.DEFAULT, certificate);
                             SSL.setCertificateChainBio(ssl, certBio, false);
                             supportsKeyManagerFactory = true;
                             try {
@@ -195,9 +228,6 @@
                         if (certBio != 0) {
                             SSL.freeBIO(certBio);
                         }
-                        if (cert != null) {
-                            cert.delete();
-                        }
                     }
                 } finally {
                     SSLContext.free(sslCtx);",0
Fix NullPointerException in NTLM auth," 
     /** Convert host to standard form */
     private static String convertHost(final String host) {
-        return stripDotSuffix(host).toUpperCase();
+        return host != null ? stripDotSuffix(host).toUpperCase() : null;
     }
 
     /** Convert domain to standard form */
     private static String convertDomain(final String domain) {
-        return stripDotSuffix(domain).toUpperCase();
+        return domain != null ? stripDotSuffix(domain).toUpperCase() : null;
     }
 
     private static int readULong(final byte[] src, final int index) throws NtlmEngineException {",0
Fix typo in RandomXS128.java," 	
 	/**
 	 * Returns the internal seeds to allow state saving.
-	 * @param seed muse be 0 or 1, designating which of the 2 long seeds to return
+	 * @param seed must be 0 or 1, designating which of the 2 long seeds to return
 	 * @return the internal seed that can be used in setState
 	 */
 	public long getState(int seed) {",0
Fix clipping in fixed mode for edge snapping map points," 
 		final Rectangle worldMapRectangle = widget.getBounds();
 		final Area mapViewArea = getWorldMapClipArea(worldMapRectangle);
-		final Area canvasViewArea = getWorldMapClipArea(client.getCanvas().getBounds());
+		final Rectangle canvasBounds = client.getCanvas().getBounds();
+		// in fixed, the bounds are offset by the size of the black borders outside the canvas
+		canvasBounds.setLocation(0, 0);
+		final Area canvasViewArea = getWorldMapClipArea(canvasBounds);
+
 		WorldMapPoint tooltipPoint = null;
 
 		for (WorldMapPoint worldPoint : points)",0
Fix some of minecraft's resources loading twice,"                     .map(path -> root.relativize(path.toAbsolutePath()))
                     .filter(path -> path.getNameCount() > 0) // skip the root entry
                     .map(p->p.toString().replaceAll(""/$"","""")) // remove the trailing slash, if present
+                    .filter(s -> !s.isEmpty()) //filter empty strings, otherwise empty strings default to minecraft in ResourceLocations
                     .collect(Collectors.toSet());
         }
         catch (IOException e)",0
"Fix GPUImageView.capture(int, int) when show_loading attribute is false","             }
         });
 
-        if (isShowLoading) {
             post(new Runnable() {
                 @Override
                 public void run() {
-                    // Show loading
+                // Optionally, show loading view:
+                if (isShowLoading) {
                     addView(new LoadingView(getContext()));
+                }
+                // Request layout to release waiter:
                     surfaceView.requestLayout();
                 }
             });
-        }
 
         waiter.acquire();
 ",0
Fix potential NullPointerException in BaseCudnnHelper," 
             @Override
             public void deallocate() {
-                for (int i = 0; i < capacity; i++) {
+                for (int i = 0; !isNull() && i < capacity; i++) {
                     cudnnTensorStruct t = this.get(cudnnTensorStruct.class, i);
                     checkCudnn(cudnnDestroyTensorDescriptor(t));
                 }
+                if (owner != null) {
                 owner.deallocate();
                 owner = null;
+                }
                 setNull();
             }
         }",0
"Fixes #4515; AuthenticationScript (Python, Ruby, Groovy) does not work"," 
 import org.apache.commons.configuration.Configuration;
 import org.apache.commons.configuration.ConfigurationException;
+import org.apache.commons.lang.exception.ExceptionUtils;
 import org.apache.log4j.Logger;
 import org.parosproxy.paros.Constant;
 import org.parosproxy.paros.control.Control;
@@ -452,7 +453,8 @@
 				getScriptsExtension().handleScriptException(scriptW, e);
 				log.error(""Error while calling authentication script"", e);
 				warnAndResetPanel(Constant.messages.getString(
-						""authentication.method.script.dialog.error.text.loading"", e.getMessage()));
+						""authentication.method.script.dialog.error.text.loading"",
+						ExceptionUtils.getRootCauseMessage(e)));
 			}
 		}
 
@@ -664,9 +666,21 @@
 
 	private AuthenticationScriptV2 getScriptInterfaceV2(ScriptWrapper script) {
 		try {
-			return getScriptsExtension().getInterface(script, AuthenticationScriptV2.class);
+			AuthenticationScriptV2 authScript = getScriptsExtension().getInterface(script, AuthenticationScriptV2.class);
+
+			// Some ScriptEngines do not verify if all Interface Methods are contained in the script.
+			// So we must invoke them to ensure that they are defined in the loaded script!
+			// Otherwise some ScriptEngines loads successfully AuthenticationScriptV2 without the methods
+			// getLoggedInIndicator() / getLoggedOutIndicator().
+			// Though it should fallback to interface AuthenticationScript.
+			authScript.getLoggedInIndicator();
+			authScript.getLoggedOutIndicator();
+			return authScript;
 		} catch (Exception ignore) {
 			// The interface is optional, the AuthenticationScript will be checked after this one.
+			if(log.isDebugEnabled()){
+				log.debug(""Script '""+script.getName()+""' is not a AuthenticationScriptV2 interface!"", ignore);
+			}
 		}
 		return null;
 	}",0
"fix NullPointerExcpeption when opening ""Downloads"" with android-api < 23"," 		return v;
 	}
 
+	/** Added in API level 23. */
 	@Override
 	public void onAttach(Context activity) {
 		super.onAttach(activity);
+
+		// Bug: in api< 23 this is never called
+		// so mActivity=null
+		// so app crashes with nullpointer exception
+		mActivity = activity;
+	}
+
+	/** deprecated in API level 23,
+	 * but must remain to allow compatibility with api<23 */
+	@Override
+	public void onAttach(Activity activity) {
+		super.onAttach(activity);
+
 		mActivity = activity;
 	}
 ",0
Bug fix: fix NOAUTH error...," 
             try {
                 RedisAsyncConnectionImpl<String, String> connection = client.connectAsyncImpl(redisURI.getResolvedAddress());
+                char[] password = redisURI.getPassword();
+                if (password != null) {
+                    connection.auth(new String(password));
+                }
                 connections.put(redisURI, connection);
             } catch (RuntimeException e) {
                 logger.warn(""Cannot connect to "" + redisURI, e);",0
CHE-5692. Fix editor errors clearing," import com.google.gwt.core.client.GWT;
 import com.google.gwt.core.client.JavaScriptObject;
 import com.google.gwt.core.client.JsArray;
-import com.google.gwt.core.client.Scheduler;
 import com.google.gwt.dom.client.Document;
 import com.google.gwt.dom.client.Element;
 import com.google.gwt.event.dom.client.BlurEvent;
@@ -90,7 +89,6 @@
 import org.eclipse.che.ide.editor.orion.client.jso.OrionKeyBindingsRelationOverlay;
 import org.eclipse.che.ide.editor.orion.client.jso.OrionKeyModeOverlay;
 import org.eclipse.che.ide.editor.orion.client.jso.OrionKeyStrokeOverlay;
-import org.eclipse.che.ide.editor.orion.client.jso.OrionProblemOverlay;
 import org.eclipse.che.ide.editor.orion.client.jso.OrionRulerClickEventOverlay;
 import org.eclipse.che.ide.editor.orion.client.jso.OrionSelectionOverlay;
 import org.eclipse.che.ide.editor.orion.client.jso.OrionStyleOverlay;
@@ -732,7 +730,9 @@
     }
 
     public void clearErrors() {
-        editorOverlay.showProblems(JavaScriptObject.createArray().<JsArray<OrionProblemOverlay>>cast());
+        OrionAnnotationModelOverlay annotationModelOverlay = editorOverlay.getAnnotationModel();
+        problems.forEach(annotationModelOverlay::removeAnnotation);
+        problems.clear();
     }
 
     public OrionTextViewOverlay getTextView() {",0
 - fix issue where we process recording even if meeting is not recorded," 
   private void kickOffProcessingOfRecording(Meeting m) {
     if (m.isRecord() && m.getNumUsers() == 0) {
-      Map<String, Object> logData = new HashMap<String, Object>();
-      logData.put(""meetingId"", m.getInternalId());
-      logData.put(""externalMeetingId"", m.getExternalId());
-      logData.put(""name"", m.getName());
-      logData.put(""event"", ""kick_off_ingest_and_processing"");
-      logData.put(""description"", ""Start processing of recording."");
-
-      Gson gson = new Gson();
-      String logStr = gson.toJson(logData);
-
-      log.info(""Initiate recording processing: data={}"", logStr);
-
-      processRecording(m.getInternalId());
+      processRecording(m);
     }
   }
 
@@ -403,8 +391,21 @@
     recordingService.updateMetaParams(idList, metaParams);
   }
 
-  public void processRecording(String meetingId) {
-    recordingService.startIngestAndProcessing(meetingId);
+  public void processRecording(Meeting m) {
+    if (m.isRecord()) {
+      Map<String, Object> logData = new HashMap<String, Object>();
+      logData.put(""meetingId"", m.getInternalId());
+      logData.put(""externalMeetingId"", m.getExternalId());
+      logData.put(""name"", m.getName());
+      logData.put(""event"", ""kick_off_ingest_and_processing"");
+      logData.put(""description"", ""Start processing of recording."");
+
+      Gson gson = new Gson();
+      String logStr = gson.toJson(logData);
+
+      log.info(""Initiate recording processing: data={}"", logStr);
+      recordingService.startIngestAndProcessing(m.getInternalId());
+    }
   }
 
   public boolean isMeetingWithVoiceBridgeExist(String voiceBridge) {
@@ -481,7 +482,7 @@
     Meeting m = getMeeting(message.meetingId);
     if (m != null) {
       m.setForciblyEnded(true);
-      processRecording(m.getInternalId());
+      processRecording(m);
       destroyMeeting(m.getInternalId());
       meetings.remove(m.getInternalId());
       removeUserSessions(m.getInternalId());",0
Fixed Attribute.equals," 			if (obj == this) return true;
 			if (!(obj instanceof Attribute)) return false;
 			final Attribute other = (Attribute)obj;
-			if (other.type != other.type) return false; 
+			if (this.type != other.type) return false;
 			return equals(other);
 		}
 		@Override",0
Fix a potential memory leak in schedulePeriodically,"                     }
                 }
             };
-            mas.set(schedule(recursiveAction, initialDelay, unit));
+            MultipleAssignmentSubscription s = new MultipleAssignmentSubscription();
+            // Should call `mas.set` before `schedule`, or the new Subscription may replace the old one.
+            mas.set(s);
+            s.set(schedule(recursiveAction, initialDelay, unit));
             return mas;
         }
 ",0
Fix crash on scanning as foreground service ,"                     Intent intent = new Intent(consumer.getApplicationContext(), BeaconService.class);
                     if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O &&
                             this.getForegroundServiceNotification() != null) {
+                        if (isAnyConsumerBound()) {
+                            LogManager.i(TAG, ""Not starting foreground beacon scanning"" +
+                                    "" service.  A consumer is already bound, so it should be started"");
+                        }
+                        else {
                         LogManager.i(TAG, ""Starting foreground beacon scanning service."");
                         mContext.startForegroundService(intent);
                     }
+                    }
                     else {
                     }
                     consumer.bindService(intent, newConsumerInfo.beaconServiceConnection, Context.BIND_AUTO_CREATE);",0
Fixed AndroidSound objects not pausing and resuming ," 					music.wasPlaying = false;
 			}
 		}
+		this.soundPool.autoPause();
 	}
 
 	protected void resume () {
@@ -82,6 +83,7 @@
 				if (musics.get(i).wasPlaying == true) musics.get(i).play();
 			}
 		}
+		this.soundPool.autoResume();
 	}
 
 	/** {@inheritDoc} */",0
KYLIN-3876 Fix flink config option wrong key mapping,"         }
 
         //mapping task manager heap size -> -ytm
-        ConfigOption<String> tmHeapSizeOption = TaskManagerOptions.MANAGED_MEMORY_SIZE;
+        ConfigOption<String> tmHeapSizeOption = TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY;
         flinkOnYarnConfigMap.put(tmHeapSizeOption.key(), ""-ytm"");
         if (tmHeapSizeOption.hasDeprecatedKeys()) {
             Iterator<String> deprecatedKeyIterator = tmHeapSizeOption.deprecatedKeys().iterator();",0
fixed crash on receiving files," 				if (addedActionsCount < 3) {
 					Message firstDownloadableMessage = getFirstDownloadableMessage(messages);
 					if (firstDownloadableMessage != null) {
-						String label = mXmppConnectionService.getResources().getString(R.string.download_x_file, UIHelper.getFileDescriptionString(mXmppConnectionService, message));
-						PendingIntent pendingDownloadIntent = createDownloadIntent(message);
+						String label = mXmppConnectionService.getResources().getString(R.string.download_x_file, UIHelper.getFileDescriptionString(mXmppConnectionService, firstDownloadableMessage));
+						PendingIntent pendingDownloadIntent = createDownloadIntent(firstDownloadableMessage);
 						NotificationCompat.Action downloadAction = new NotificationCompat.Action.Builder(
 								R.drawable.ic_file_download_white_24dp,
 								label,",0
fix Javadoc,"  *              // Request got HTTP success statusCode
  *         }
  *         &#064;Override
- *         public void onFailure(int statusCode, Header[] headers, T t){
+ *         public void onFailure(int statusCode, Header[] headers, FontHandler t){
  *              // Request got HTTP fail statusCode
  *         }
  *     });",0
CosmosDB DocumentDBConverter Fixed," package org.apereo.cas.cosmosdb;
 
 import com.microsoft.azure.spring.data.documentdb.core.mapping.PartitionKey;
-import lombok.extern.slf4j.Slf4j;
 import org.springframework.data.annotation.Id;
 import org.springframework.data.mongodb.core.mapping.Document;
 import lombok.Getter;
@@ -14,7 +13,6 @@
  * @since 5.2.0
  */
 @Document
-@Slf4j
 @Getter
 @Setter
 public class CosmosDbDocument {",0
Fixed missing opening brace in FacebookDialog page link," /**
  * <p>Implements a <a href=""http://developer.android.com/reference/android/content/ContentProvider.html"">
  * ContentProvider</a> that can be used to provide binary attachments (e.g., images) to calls made
- * via @link FacebookDialog}. The {@link NativeAppCallAttachmentStore} class provides methods to attach
+ * via {@link FacebookDialog}. The {@link NativeAppCallAttachmentStore} class provides methods to attach
  * and clean up the attachments.
  *
  * <p>Note that this ContentProvider is only necessary if an application wishes to attach images, etc., that are",0
[SP-4947] - Fixed missing error message in Abort step,"  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2018 by Hitachi Vantara : http://www.pentaho.com
+ * Copyright (C) 2002-2019 by Hitachi Vantara : http://www.pentaho.com
  *
  *******************************************************************************
  *
@@ -859,7 +859,7 @@
         buffer.append( getString( row, i ) );
         buffer.append( ""]"" );
       }
-      return buffer.toString();
+      return buffer.toString().equals( """" ) ? ""No data in row"" : buffer.toString();
     } finally {
       lock.readLock().unlock();
     }",0
Fix improperly named arguments in chownSync().,"    * Synchronous version of {@link #chown(String, String, String, Handler)}
    *
    */
-  FileSystem chownSync(String user, String group, String perms) ;
+  FileSystem chownSync(String path, String user, String group) ;
 
   /**
    * Obtain properties for the file represented by {@code path}, asynchronously.",0
Fixed two small typos in Canvas,"     Vector2i calculateRestrictedSize(UIWidget widget, Vector2i sizeRestrictions);
 
     /**
-     * Calcualtes the maximum size a widget can take. A dimension will be Vector2i(Integer.MAX_VALUE, Integer.MAX_VALUE) if unbounded
+     * Calculates the maximum size a widget can take. A dimension will be Vector2i(Integer.MAX_VALUE, Integer.MAX_VALUE) if unbounded
      *
      * @param widget The widget to get the maximum size of.
      * @return The maximum size of the widget.
@@ -145,7 +145,7 @@
     void drawWidget(UIWidget element, Rect2i region);
 
     /**
-     * Draws test, using the current style.
+     * Draws text, using the current style.
      *
      * @param text
      */",0
Addressed issue where rules where failing to evaluate when using the APIs," import org.springframework.web.filter.GenericFilterBean;
 
 import java.io.IOException;
+import java.util.HashMap;
+import java.util.Map;
 
 import javax.servlet.FilterChain;
 import javax.servlet.ServletException;
@@ -61,6 +63,7 @@
     protected CustomerService customerService;
 
     public static final String CUSTOMER_ID_ATTRIBUTE = ""customerId"";
+    public static final String BLC_RULE_MAP_PARAM = ""blRuleMap"";
 
     @Override
     public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
@@ -94,6 +97,7 @@
                     Customer customer = customerService.readCustomerById(Long.valueOf(customerId));
                     if (customer != null) {
                         CustomerState.setCustomer(customer);
+                        setupCustomerForRuleProcessing(customer, request);
                     }
                 } else {
                     LOG.warn(String.format(""The customer id passed in '%s' was not a number"", StringUtil.sanitize(customerId)));
@@ -112,6 +116,17 @@
 
     }
 
+    private void setupCustomerForRuleProcessing(Customer customer, HttpServletRequest request) {
+        // Setup customer for content rule processing
+        @SuppressWarnings(""unchecked"")
+        Map<String,Object> ruleMap = (Map<String, Object>) request.getAttribute(BLC_RULE_MAP_PARAM);
+        if (ruleMap == null) {
+            ruleMap = new HashMap<String,Object>();
+        }
+        ruleMap.put(""customer"", customer);
+        request.setAttribute(BLC_RULE_MAP_PARAM, ruleMap);
+    }
+
     @Override
     public int getOrder() {
         return 2000;",0
Fix of missing support of VALIDATION in ODatabase.get()," 
     case CONFLICTSTRATEGY:
       return storage.getConfiguration().getConflictStrategy();
+    case VALIDATION:
+      return isValidationEnabled();
     }
 
     return null;",0
Fixed issue where a subcollection entity name can be a null reference in the enterprise workflow process,"         Property parentNameProp = parentEntity.getPMap().get(AdminMainEntity.MAIN_ENTITY_NAME_PROPERTY);
         if (parentNameProp != null) {
             ppr.setRequestingEntityName(parentNameProp.getValue());
+        } else {
+            Property name = parentEntity.getPMap().get(""name"");
+            if(name !=null) {
+                ppr.setRequestingEntityName(name.getValue());
+            }
         }
 
         Property p = new Property();",0
Swiping bug correction,"                         // we should aggregate offsets from all of the parents.
                         float offsetX = 0;
                         float offsetY = 0;
-                        for (View v = this; v != null && v != parent; v = (View) v.getParent()) {
+                        for (View v = this; v != null && v != parent; ) {
                             offsetX += v.getLeft() - v.getScrollX();
                             offsetY += v.getTop() - v.getScrollY();
+                            try {
+                                v = (View) v.getParent();
+                            } catch (ClassCastException ex) {
+                                break;
+                            }
                         }
                         final MotionEvent event = MotionEvent.obtainNoHistory(ev);
                         event.offsetLocation(offsetX, offsetY);",0
"Fix javadoc for Util.getMinimumSequence(Sequence[], long)","      * @param sequences to compare.
      * @param minimum   an initial default minimum.  If the array is empty this value will be
      *                  returned.
-     * @return the minimum sequence found or Long.MAX_VALUE if the array is empty.
+     * @return the smaller of minimum sequence value found in {@code sequences} and {@code minimum};
+     * {@code minimum} if {@code sequences} is empty
      */
     public static long getMinimumSequence(final Sequence[] sequences, long minimum)
     {",0
Connections dont always get cleaned up after lost connection," 
 import org.java_websocket.framing.CloseFrame;
 
+import java.util.ArrayList;
 import java.util.Collection;
 import java.util.Timer;
 import java.util.TimerTask;
@@ -104,23 +105,30 @@
         cancelConnectionLostTimer();
         connectionLostTimer = new Timer();
         connectionLostTimerTask = new TimerTask() {
+
+			/**
+			 * Keep the connections in a separate list to not cause deadlocks
+			 */
+			private ArrayList<WebSocket> connections = new ArrayList<WebSocket>(  );
             @Override
             public void run() {
-                Collection<WebSocket> con = connections();
-                synchronized ( con ) {
+                connections.clear();
+                connections.addAll( connections() );
                     long current = (System.currentTimeMillis()-(connectionLostTimeout * 1500));
-                    for( WebSocket conn : con ) {
+				WebSocketImpl webSocketImpl;
+				for( WebSocket conn : connections ) {
                         if (conn instanceof WebSocketImpl) {
-                            if( ((WebSocketImpl)conn).getLastPong() < current ) {
+						webSocketImpl = (WebSocketImpl)conn;
+						if( webSocketImpl.getLastPong() < current ) {
                                 if (WebSocketImpl.DEBUG)
                                     System.out.println(""Closing connection due to no pong received: "" + conn.toString());
-                                conn.close( CloseFrame.ABNORMAL_CLOSE );
+							webSocketImpl.closeConnection( CloseFrame.ABNORMAL_CLOSE , false );
                             } else {
-                                conn.sendPing();
+							webSocketImpl.sendPing();
                             }
                         }
                     }
-                }
+				connections.clear();
             }
         };
         connectionLostTimer.scheduleAtFixedRate( connectionLostTimerTask,connectionLostTimeout * 1000, connectionLostTimeout * 1000 );",0
Correctly JSON encode context regexs," import java.util.Set;
 import java.util.regex.Pattern;
 
-import net.sf.json.JSONObject;
-
 import org.apache.log4j.Logger;
 import org.parosproxy.paros.Constant;
 import org.parosproxy.paros.model.Model;
 import org.parosproxy.paros.model.SiteNode;
 import org.zaproxy.zap.authentication.AuthenticationMethod;
 import org.zaproxy.zap.authentication.AuthenticationMethodType;
-import org.zaproxy.zap.extension.api.ApiResponseElement;
 import org.zaproxy.zap.extension.api.ApiException.Type;
 import org.zaproxy.zap.extension.authorization.AuthorizationDetectionMethod;
 import org.zaproxy.zap.model.Context;
@@ -43,6 +40,9 @@
 import org.zaproxy.zap.model.TechSet;
 import org.zaproxy.zap.utils.ApiUtils;
 
+import net.sf.json.JSONArray;
+import net.sf.json.JSONObject;
+
 public class ContextAPI extends ApiImplementor {
 
     private static final Logger log = Logger.getLogger(ContextAPI.class);
@@ -263,10 +263,18 @@
         
         switch(name) {
         case VIEW_EXCLUDE_REGEXS:
-        	result = new ApiResponseElement(name, getContext(params).getExcludeFromContextRegexs().toString());
+            resultList = new ApiResponseList(name);
+            for (String regex : getContext(params).getExcludeFromContextRegexs()) {
+                resultList.addItem(new ApiResponseElement(REGEX_PARAM, regex));
+            }
+            result = resultList;
         	break;
         case VIEW_INCLUDE_REGEXS:
-        	result = new ApiResponseElement(name, getContext(params).getIncludeInContextRegexs().toString());
+            resultList = new ApiResponseList(name);
+            for (String regex : getContext(params).getIncludeInContextRegexs()) {
+                resultList.addItem(new ApiResponseElement(REGEX_PARAM, regex));
+            }
+            result = resultList;
         	break;
         case VIEW_CONTEXT_LIST:
             resultList = new ApiResponseList(name);
@@ -346,8 +354,8 @@
 		fields.put(""id"", Integer.toString(c.getIndex()));
 		fields.put(""description"", c.getDescription());
 		fields.put(""inScope"", Boolean.toString(c.isInScope()));
-		fields.put(""excludeRegexs"", c.getExcludeFromContextRegexs().toString());
-		fields.put(""includeRegexs"", c.getIncludeInContextRegexs().toString());
+		fields.put(""excludeRegexs"", jsonEncodeList(c.getExcludeFromContextRegexs()));
+		fields.put(""includeRegexs"", jsonEncodeList(c.getIncludeInContextRegexs()));
 		
 		AuthenticationMethod authenticationMethod = c.getAuthenticationMethod();
 		if(authenticationMethod != null){
@@ -372,6 +380,14 @@
 		return new ApiResponseSet<String>(""context"", fields);
 	}
 	
+	private String jsonEncodeList(List<String> list) {
+	    JSONArray js = new JSONArray();
+	    for (String item : list) {
+	        js.add(item);
+	    }
+	    return js.toString();
+	}
+	
 	/**
 	 * Gets the tech that matches the techName
 	 * or throws an exception if no tech matches",0
fix moveUp signature,"         return new NodeZipper<T>(newNode, breadcrumbs, nodeAdapter);
     }
 
-    public NodeZipper moveUp() {
+    public NodeZipper<T> moveUp() {
         T node = getParent();
         List<Breadcrumb<T>> newBreadcrumbs = breadcrumbs.subList(1, breadcrumbs.size());
         return new NodeZipper<>(node, newBreadcrumbs, nodeAdapter);",0
[master branch] UNDERTOW-1016 Fix potential NPE while dealing with unresolved InetSocketAddress," 
     public MCMPConfig(Builder builder) {
         this.managementSocketAddress = new InetSocketAddress(builder.managementHost, builder.managementPort);
-        if (managementSocketAddress.getAddress().isAnyLocalAddress()) {
-            throw UndertowLogger.PROXY_REQUEST_LOGGER.cannotUseWildcardAddressAsModClusterManagementHost(builder.managementHost);
-        }
         if (managementSocketAddress.isUnresolved()) {
             throw UndertowLogger.PROXY_REQUEST_LOGGER.unableToResolveModClusterManagementHost(builder.managementHost);
         }
+        if (managementSocketAddress.getAddress().isAnyLocalAddress()) {
+            throw UndertowLogger.PROXY_REQUEST_LOGGER.cannotUseWildcardAddressAsModClusterManagementHost(builder.managementHost);
+        }
         if (builder.advertiseBuilder != null) {
             this.advertiseConfig = new AdvertiseConfig(builder.advertiseBuilder, this);
         } else {",0
fix bug: epsi makes copy like eps,"      * Returns an ndarray with 1 if the element is epsilon equals
      *
      * @param other the number to compare
-     * @return a copied ndarray with the given
+     * @return a ndarray with the given
      * binary conditions
      */
     @Override
     public INDArray epsi(Number other) {
         INDArray otherArr = Nd4j.valueArrayOf(shape(),other.doubleValue());
-        return eps(otherArr);
+        return epsi(otherArr);
     }
 
     /**",0
fix to enable client-specified nonce count (NC),"  */
 public class Realm {
 
-    private static final String NC = ""00000001"";
+    private static final String DEFAULT_NC = ""00000001"";
 
     private final String principal;
     private final String password;
@@ -288,7 +288,7 @@
         private String response = """";
         private String opaque = """";
         private String qop = ""auth"";
-        private String nc = ""00000001"";
+        private String nc = DEFAULT_NC;
         private String cnonce = """";
         private Uri uri;
         private String methodName = ""GET"";
@@ -590,7 +590,7 @@
             
             if (isNonEmpty(qop)) {
                 //qop =""auth"" or ""auth-int""
-                sb.append(NC)//
+                sb.append(nc)//
                         .append(':')//
                         .append(cnonce)//
                         .append(':')//",0
fixed PolygonRegionLoader GWT compatibility and error report," 				}
 			reader.close();
 		} catch (IOException e) {
-			Gdx.app.error(PolygonRegionLoader.class.getSimpleName(), ""could not read "" + fileName, e);
+			throw new GdxRuntimeException(""Error reading "" + fileName, e);
 		}
 
 		if (image == null && params.textureExtensions != null) for (String extension : params.textureExtensions) {",0
Fix keyPressed for multiple keys,"    * @see PApplet#keyReleased()
    */
   public boolean keyPressed;
-  int keyPressedCount;
+  List<Long> pressedKeys = new ArrayList<>(6);
 
   /**
    * The last KeyEvent object passed into a mouse function.
@@ -2935,13 +2935,14 @@
 
     switch (event.getAction()) {
     case KeyEvent.PRESS:
-      keyPressedCount++;
+      Long hash = ((long) keyCode << Character.SIZE) | key;
+      if (!pressedKeys.contains(hash)) pressedKeys.add(hash);
       keyPressed = true;
       keyPressed(keyEvent);
       break;
     case KeyEvent.RELEASE:
-      keyPressedCount--;
-      keyPressed = (keyPressedCount > 0);
+      pressedKeys.remove(((long) keyCode << Character.SIZE) | key);
+      keyPressed = !pressedKeys.isEmpty();
       keyReleased(keyEvent);
       break;
     case KeyEvent.TYPE:
@@ -3123,7 +3124,10 @@
   public void focusGained() { }
 
 
-  public void focusLost() { }
+  public void focusLost() {
+    // TODO: if user overrides this without calling super it's not gonna work
+    pressedKeys.clear();
+  }
 
 
 ",0
Small fix to processing-java generation,"                    ""OPTION_FOR_HEADLESS_RUN=\""\""\n"" +
                    ""for ARG in \""$@\""\n"" +
                    ""do\n"" +
-                   ""    if [ $ARG = \""--build\"" ]; then\n"" +
+                   ""    if [ \""$ARG\"" = \""--build\"" ]; then\n"" +
                    ""        OPTION_FOR_HEADLESS_RUN=\""-Djava.awt.headless=true\""\n"" +
                    ""    fi\n"" +
                    ""done\n\n"");",0
Fix JavaDoc for hitsplat colours," 		 */
 		POISON,
 		/**
-		 * Damage from venom (dark green).
+		 * Damage from venom (teal).
 		 */
 		VENOM,
 		/**
-		 * Damage from disease (yellow).
+		 * Damage from disease (orange).
 		 */
 		DISEASE,
 		/**",0
Fixed bug for same name parameter at RequestParams.,"                 result.append(""&"");
 
             ArrayList<String> values = entry.getValue();
-            for (String value : values) {
-                if (values.indexOf(value) != 0)
+            for (int i = 0; i < values.size(); i++) {
+                if (i != 0)
                     result.append(""&"");
                 result.append(entry.getKey());
                 result.append(""="");
-                result.append(value);
+                result.append(values.get(i));
             }
         }
 ",0
CAMEL-10014: Fix Kubernetes Syntax," /**
  * The kubernetes component allows to work with Kubernetes PaaS.
  */
-@UriEndpoint(scheme = ""kubernetes"", title = ""Kubernetes"", syntax = ""kubernetes:master"", label = ""container,cloud,paas"")
+@UriEndpoint(scheme = ""kubernetes"", title = ""Kubernetes"", syntax = ""kubernetes:masterUrl"", label = ""container,cloud,paas"")
 public class KubernetesEndpoint extends DefaultEndpoint {
 
     private static final Logger LOG = LoggerFactory.getLogger(KubernetesEndpoint.class);",0
Fix missing guice bindings for MessageOutput.Factory2 (#5771),"         install(new GrokModule());
         install(new LookupModule());
         install(new FieldTypesModule());
+
+        // Just to create the binders so they are present in the injector. Prevents a server startup error when no
+        // outputs are bound that implement MessageOutput.Factory2.
+        outputsMapBinder2();
     }
 
     private void bindProviders() {",0
#1368 Set NettyResponseFuture#isDone before invoking abort callbacks," 
     public final void abort(final Throwable t) {
 
-        future.completeExceptionally(t);
-
         if (terminateAndExit())
             return;
 
+        future.completeExceptionally(t);
+
         if (onThrowableCalledField.compareAndSet(this, 0, 1)) {
             try {
                 asyncHandler.onThrowable(t);",0
Fix bugs in Bits," 			if (bitsAtWord != 0) {
 				for (int bit = 63; bit >= 0; --bit) {
 					if ((bitsAtWord & (1L << (bit & 0x3F))) != 0L) {
-						return (word << 6) + bit;
+						return (word << 6) + bit + 1;
 					}
 				}
 			}
@@ -260,11 +260,7 @@
 			bits[i] ^= other.bits[i];
 		}
 		
-		if (bits.length > commonWords) {
-			for (int i = other.bits.length, s = bits.length; s > i; i++) {
-				bits[i] = 0L;
-			}
-		} else if (commonWords < other.bits.length) {
+		if (commonWords < other.bits.length) {
 			checkCapacity(other.bits.length);
 			for (int i = commonWords, s = other.bits.length; s > i; i++) {
 				bits[i] = other.bits[i];",0
Effectively change user permissions when listing inputs.,"     @ApiOperation(value = ""Get all inputs"")
     public InputsList list() {
         final Set<InputSummary> inputs = inputService.all().stream()
-                .map(input -> getInputSummary(input))
+                .filter(input -> isPermitted(RestPermissions.INPUTS_READ, input.getId()))
+                .map(this::getInputSummary)
                 .collect(Collectors.toSet());
 
         return InputsList.create(inputs);",0
Support NTLM protocol with the proxy: fixed the header name for Proxy-Authorization,"     }
 
     private Realm kerberosChallenge(List<String> proxyAuth, Request request, ProxyServer proxyServer, FluentCaseInsensitiveStringsMap headers, Realm realm,
-            NettyResponseFuture<?> future) throws NTLMEngineException {
+            NettyResponseFuture<?> future, boolean proxyInd) throws NTLMEngineException {
 
         URI uri = request.getURI();
         String host = request.getVirtualHost() == null ? AsyncHttpProviderUtils.getHost(uri) : request.getVirtualHost();
@@ -1248,30 +1248,38 @@
             return realmBuilder.setUri(uri.getRawPath()).setMethodName(request.getMethod()).setScheme(Realm.AuthScheme.KERBEROS).build();
         } catch (Throwable throwable) {
             if (isNTLM(proxyAuth)) {
-                return ntlmChallenge(proxyAuth, request, proxyServer, headers, realm, future);
+                return ntlmChallenge(proxyAuth, request, proxyServer, headers, realm, future, proxyInd);
             }
             abort(future, throwable);
             return null;
         }
     }
 
-    private void addNTLMAuthorization(FluentCaseInsensitiveStringsMap headers, String challengeHeader) {
+    private void addNTLMAuthorization(FluentCaseInsensitiveStringsMap headers, String challengeHeader, boolean proxyInd) {
+        if ( proxyInd ) {
+            headers.add(HttpHeaders.Names.PROXY_AUTHORIZATION, ""NTLM "" + challengeHeader);
+        } else {
         headers.add(HttpHeaders.Names.AUTHORIZATION, ""NTLM "" + challengeHeader);
     }
+    }
 
-    private void addType3NTLMAuthorizationHeader(List<String> auth, FluentCaseInsensitiveStringsMap headers, String username, String password, String domain, String workstation)
+    private void addType3NTLMAuthorizationHeader(List<String> auth, FluentCaseInsensitiveStringsMap headers, String username, String password, String domain, String workstation, boolean proxyInd)
             throws NTLMEngineException {
+        if ( proxyInd ) {
+            headers.remove(HttpHeaders.Names.PROXY_AUTHORIZATION);
+        } else {
         headers.remove(HttpHeaders.Names.AUTHORIZATION);
+        }
 
         // Beware of space!, see #462
         if (isNonEmpty(auth) && auth.get(0).startsWith(""NTLM "")) {
             String serverChallenge = auth.get(0).trim().substring(""NTLM "".length());
             String challengeHeader = ntlmEngine.generateType3Msg(username, password, domain, workstation, serverChallenge);
-            addNTLMAuthorization(headers, challengeHeader);
+            addNTLMAuthorization(headers, challengeHeader, proxyInd);
         }
     }
 
-    private Realm ntlmChallenge(List<String> wwwAuth, Request request, ProxyServer proxyServer, FluentCaseInsensitiveStringsMap headers, Realm realm, NettyResponseFuture<?> future)
+    private Realm ntlmChallenge(List<String> wwwAuth, Request request, ProxyServer proxyServer, FluentCaseInsensitiveStringsMap headers, Realm realm, NettyResponseFuture<?> future, boolean proxyInd)
             throws NTLMEngineException {
 
         boolean useRealm = (proxyServer == null && realm != null);
@@ -1286,12 +1294,12 @@
             String challengeHeader = ntlmEngine.generateType1Msg(ntlmDomain, ntlmHost);
 
             URI uri = request.getURI();
-            addNTLMAuthorization(headers, challengeHeader);
+            addNTLMAuthorization(headers, challengeHeader, proxyInd);
             newRealm = new Realm.RealmBuilder().clone(realm).setScheme(realm.getAuthScheme()).setUri(uri.getRawPath()).setMethodName(request.getMethod())
                     .setNtlmMessageType2Received(true).build();
             future.getAndSetAuth(false);
         } else {
-            addType3NTLMAuthorizationHeader(wwwAuth, headers, principal, password, ntlmDomain, ntlmHost);
+            addType3NTLMAuthorizationHeader(wwwAuth, headers, principal, password, ntlmDomain, ntlmHost, proxyInd);
 
             Realm.RealmBuilder realmBuilder;
             Realm.AuthScheme authScheme;
@@ -1312,7 +1320,7 @@
             NettyResponseFuture<?> future) throws NTLMEngineException {
         future.getAndSetAuth(false);
 
-        addType3NTLMAuthorizationHeader(wwwAuth, headers, proxyServer.getPrincipal(), proxyServer.getPassword(), proxyServer.getNtlmDomain(), proxyServer.getHost());
+        addType3NTLMAuthorizationHeader(wwwAuth, headers, proxyServer.getPrincipal(), proxyServer.getPassword(), proxyServer.getNtlmDomain(), proxyServer.getHost(), true);
         Realm newRealm;
 
         Realm.RealmBuilder realmBuilder = new Realm.RealmBuilder();
@@ -2115,10 +2123,10 @@
 
                         // NTLM
                         if (!wwwAuth.contains(""Kerberos"") && (isNTLM(wwwAuth) || (wwwAuth.contains(""Negotiate"")))) {
-                            newRealm = ntlmChallenge(wwwAuth, request, proxyServer, headers, realm, future);
+                            newRealm = ntlmChallenge(wwwAuth, request, proxyServer, headers, realm, future, false);
                             // SPNEGO KERBEROS
                         } else if (wwwAuth.contains(""Negotiate"")) {
-                            newRealm = kerberosChallenge(wwwAuth, request, proxyServer, headers, realm, future);
+                            newRealm = kerberosChallenge(wwwAuth, request, proxyServer, headers, realm, future, false);
                             if (newRealm == null)
                                 return;
                         } else {
@@ -2167,7 +2175,7 @@
                             newRealm = ntlmProxyChallenge(proxyAuth, request, proxyServer, headers, realm, future);
                             // SPNEGO KERBEROS
                         } else if (proxyAuth.contains(""Negotiate"")) {
-                            newRealm = kerberosChallenge(proxyAuth, request, proxyServer, headers, realm, future);
+                            newRealm = kerberosChallenge(proxyAuth, request, proxyServer, headers, realm, future, true);
                             if (newRealm == null)
                                 return;
                         } else {",0
Fixed makeItemStack ignoring stackSize,"             FMLLog.getLogger().log(Level.TRACE, ""Unable to find item with name {}"", itemName);
             return null;
         }
-        ItemStack is = new ItemStack(item, 1, meta);
+        ItemStack is = new ItemStack(item, stackSize, meta);
         if (!Strings.isNullOrEmpty(nbtString))
         {
             NBTBase nbttag = null;",0
Fix top bar title positioning.,"         view.post(() -> {
             if (alignment == Alignment.Center) {
                 view.setX((getWidth() - view.getWidth()) / 2);
+            } else if (leftButtonController != null) {
+                view.setX(getContentInsetStartWithNavigation());
             } else {
                 view.setX(UiUtils.dpToPx(getContext(), 16));
             }",0
#2500 - DifferentialFunction null check (fix for convolution ops NPE),"         this.sameDiff = sameDiff;
         this.inPlace = inPlace;
         setInstanceId();
-        if(sameDiff != null)
+        if(sameDiff != null) {
             sameDiff.addArgsFor(args,this);
         for(int i = 0; i < args.length; i++) {
             if(args[i].isPlaceHolder()) {
@@ -317,6 +317,7 @@
             }
         }
     }
+    }
 
 
 ",0
[1.7.10] Fix FluidRegsitry.registerFluid,"      */
     public static boolean registerFluid(Fluid fluid)
     {
-        if (fluidIDs.containsKey(fluid.getName()))
+        if (fluids.containsKey(fluid.getName()))
         {
             FMLLog.bigWarning(""Duplicate registration attempt for fluid %s (type %s) has occurred. This is not a problem itself, but subsequent failed FluidStacks might be a result if not handled properly"", fluid.getName(), fluid.getClass().getName());
             return false;",0
fix:android 8.0," 
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {
             try {
+                if (Build.VERSION.SDK_INT < 26) {
                 FieldUtils.writeField(applicationInfo, ""deviceEncryptedDataDir"", applicationInfo.dataDir);
-                FieldUtils.writeField(applicationInfo, ""deviceProtectedDataDir"", applicationInfo.dataDir);
                 FieldUtils.writeField(applicationInfo, ""credentialEncryptedDataDir"", applicationInfo.dataDir);
+                }
+                FieldUtils.writeField(applicationInfo, ""deviceProtectedDataDir"", applicationInfo.dataDir);
                 FieldUtils.writeField(applicationInfo, ""credentialProtectedDataDir"", applicationInfo.dataDir);
-            } catch (IllegalAccessException e) {
+            } catch (Exception e) {
                 e.printStackTrace();
             }
         }",0
Add jdk.internal.reflect to ExternalAPIWhitelist for Java 9 compatibility (fixes #3106),"             .add(""java.awt"")
             .add(""java.awt.geom"")
             .add(""java.awt.image"")
+            .add(""jdk.internal.reflect"")
             .add(""com.google.common.annotations"")
             .add(""com.google.common.cache"")
             .add(""com.google.common.collect"")",0
HZ-2829: Use a single thread executorService to run heartbeat task.," import java.util.*;
 import java.util.concurrent.CopyOnWriteArrayList;
 import java.util.concurrent.CountDownLatch;
+import java.util.concurrent.ExecutorService;
+import java.util.concurrent.Executors;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicInteger;
 import java.util.logging.Level;
@@ -46,6 +48,7 @@
     private final HazelcastClient client;
     private volatile int lastDisconnectedConnectionId = -1;
     private ClientBinder binder;
+    private ExecutorService executorService = Executors.newSingleThreadExecutor();
 
     private volatile boolean lookingForLiveConnection = false;
     private volatile boolean running = true;
@@ -77,14 +80,14 @@
                         logger.log(Level.FINEST,
                                 ""Being idle for some time, Doing a getMembers() call to ping the server!"");
                         final CountDownLatch latch = new CountDownLatch(1);
-                        new Thread(new Runnable() {
+                        executorService.execute(new Runnable() {
                             public void run() {
                                 Set<Member> members = client.getCluster().getMembers();
                                 if (members != null && members.size() >= 1) {
                                     latch.countDown();
                                 }
                             }
-                        }).start();
+                        });
                         if (!latch.await(10000, TimeUnit.MILLISECONDS)) {
                             logger.log(Level.WARNING, ""Server didn't respond to client's ping call within 10 seconds!"");
                         }
@@ -335,5 +338,6 @@
         logger.log(Level.INFO, getClass().getSimpleName() + "" shutdown"");
         running = false;
         heartbeatTimer.cancel();
+        executorService.shutdown();
     }
 }",0
Fix searching issues in repository," import android.view.View;
 import android.widget.ListView;
 
+import com.github.pockethub.android.util.InfoUtils;
 import com.meisolsson.githubsdk.core.ServiceGenerator;
 import com.meisolsson.githubsdk.model.Issue;
 import com.meisolsson.githubsdk.model.Repository;
@@ -95,13 +96,16 @@
                     return Collections.emptyList();
                 }
                 List<Issue> matches = new ArrayList<>();
+                // We need to add the repo parameter to allow us to search only the repo issues
+                String searchQuery = query + ""+repo:"" + InfoUtils.createRepoId(repository);
 
-                SearchService service = ServiceGenerator.createService(getActivity(), SearchService.class);
+                SearchService service = ServiceGenerator.createService(getActivity(),
+                        SearchService.class);
 
                 int current = 1;
                 int last = 0;
                 while (current != last) {
-                    SearchPage<Issue> page = service.searchIssues(query, null, null, current)
+                    SearchPage<Issue> page = service.searchIssues(searchQuery, null, null, current)
                             .blockingGet()
                             .body();
 
@@ -129,6 +133,6 @@
 
     @Override
     public int compare(Issue lhs, Issue rhs) {
-        return (int) (rhs.number() - lhs.number());
+        return rhs.number() - lhs.number();
     }
 }",0
Fixed (seemingly copy&paste) bug that made several gamepad buttons/slide...," 	}
 
 	public OisPov getPov (int povIndex) {
-		if(povIndex < 0 || povIndex >= axes.length) return OisPov.Centered;
+		if(povIndex < 0 || povIndex >= povs.length) return OisPov.Centered;
 		switch (povs[povIndex]) {
 		case 0x00000000:
 			return OisPov.Centered;
@@ -130,18 +130,18 @@
 	}
 
 	public boolean isButtonPressed (int buttonIndex) {
-		if(buttonIndex < 0 || buttonIndex >= axes.length) return false;
+		if(buttonIndex < 0 || buttonIndex >= buttons.length) return false;
 		return buttons[buttonIndex];
 	}
 
 	public boolean getSliderX (int sliderIndex) {
-		if(sliderIndex < 0 || sliderIndex >= axes.length) return false;
+		if(sliderIndex < 0 || sliderIndex >= slidersX.length) return false;
 
 		return slidersX[sliderIndex];
 	}
 
 	public boolean getSliderY (int sliderIndex) {
-		if(sliderIndex < 0 || sliderIndex >= axes.length) return false;
+		if(sliderIndex < 0 || sliderIndex >= slidersY.length) return false;
 		return slidersY[sliderIndex];
 	}
 ",0
fix: replace dot character with underscore in style resource name," 			}
 		}
 		for (ResourceEntry resource : resStorage.getResources()) {
+			final String resTypeName = resource.getTypeName();
 			ClassNode typeCls = innerClsMap.computeIfAbsent(
-					resource.getTypeName(),
+					resTypeName,
 					name -> addClassForResType(resCls, rClsExists, name)
 			);
-			String resName = resource.getKeyName();
+			final String resName;
+			if (""style"".equals(resTypeName)) {
+				resName = resource.getKeyName().replace('.', '_');
+			} else {
+				resName = resource.getKeyName();
+			}
 			FieldNode rField = typeCls.searchFieldByName(resName);
 			if (rField == null) {
 				FieldInfo rFieldInfo = FieldInfo.from(typeCls.dex(), typeCls.getClassInfo(), resName, ArgType.INT);",0
Fixed: mCurrentDir is always null," package com.simplecity.amp_library.ui.fragments;
 
-import android.app.ProgressDialog;
-import android.content.Context;
-import android.content.SharedPreferences;
-import android.graphics.Color;
-import android.os.AsyncTask;
-import android.os.Bundle;
-import android.preference.PreferenceManager;
-import android.support.v4.graphics.drawable.DrawableCompat;
-import android.support.v7.widget.LinearLayoutManager;
-import android.support.v7.widget.PopupMenu;
-import android.support.v7.widget.RecyclerView;
-import android.support.v7.widget.Toolbar;
-import android.text.TextUtils;
-import android.view.ActionMode;
-import android.view.LayoutInflater;
-import android.view.Menu;
-import android.view.MenuInflater;
-import android.view.MenuItem;
-import android.view.SubMenu;
-import android.view.View;
-import android.view.ViewGroup;
-import android.widget.LinearLayout;
-import android.widget.ProgressBar;
-import android.widget.TextView;
-import android.widget.Toast;
-
 import com.afollestad.materialdialogs.MaterialDialog;
 import com.annimon.stream.Collectors;
 import com.annimon.stream.Stream;
@@ -63,6 +37,32 @@
 import com.simplecity.amp_library.utils.ThemeUtils;
 import com.simplecity.amp_library.utils.ViewUtils;
 
+import android.app.ProgressDialog;
+import android.content.Context;
+import android.content.SharedPreferences;
+import android.graphics.Color;
+import android.os.AsyncTask;
+import android.os.Bundle;
+import android.preference.PreferenceManager;
+import android.support.v4.graphics.drawable.DrawableCompat;
+import android.support.v7.widget.LinearLayoutManager;
+import android.support.v7.widget.PopupMenu;
+import android.support.v7.widget.RecyclerView;
+import android.support.v7.widget.Toolbar;
+import android.text.TextUtils;
+import android.view.ActionMode;
+import android.view.LayoutInflater;
+import android.view.Menu;
+import android.view.MenuInflater;
+import android.view.MenuItem;
+import android.view.SubMenu;
+import android.view.View;
+import android.view.ViewGroup;
+import android.widget.LinearLayout;
+import android.widget.ProgressBar;
+import android.widget.TextView;
+import android.widget.Toast;
+
 import java.io.File;
 import java.util.ArrayList;
 import java.util.Collections;
@@ -484,6 +484,8 @@
                         })
                         .collect(Collectors.toList());
 
+				mCurrentDir = path;
+
                 if (mShowBreadcrumbsInList) {
                     BreadcrumbsView breadcrumbsView = new BreadcrumbsView(mCurrentDir);
                     breadcrumbsView.setBreadcrumbsPath(mCurrentDir);
@@ -494,8 +496,6 @@
                     mAdapter.setItems(items);
                 }
 
-                mCurrentDir = path;
-
                 if (mBreadcrumb != null) {
                     mBreadcrumb.changeBreadcrumbPath(mCurrentDir);
                 }",0
Fix support for Rust 1.33.0," /*
- * Copyright (c) 2017, 2018, Oracle and/or its affiliates.
+ * Copyright (c) 2017, 2019, Oracle and/or its affiliates.
  *
  * All rights reserved.
  *
@@ -50,6 +50,8 @@
 import com.oracle.truffle.llvm.runtime.pointer.LLVMManagedPointer;
 import com.oracle.truffle.llvm.runtime.pointer.LLVMNativePointer;
 import com.oracle.truffle.llvm.runtime.pointer.LLVMPointer;
+import com.oracle.truffle.llvm.runtime.types.FunctionType;
+import com.oracle.truffle.llvm.runtime.types.PointerType;
 import com.oracle.truffle.llvm.runtime.types.StructureType;
 import com.oracle.truffle.llvm.runtime.types.Type;
 
@@ -99,7 +101,7 @@
             LangStartVtableType langStartVtable = createLangStartVtable(vtableGlobal.getPointeeType());
             LLVMNativePointer fn = readFn(memory, vtable, langStartVtable);
             LLVMNativePointer dropInPlace = readDropInPlace(memory, vtable, langStartVtable);
-            LLVMNativePointer main = derefMain(memory, mainPointer);
+            LLVMNativePointer main = coerceMainForFn(memory, langStartVtable, mainPointer);
             Integer exitCode = (Integer) fnDispatchNode.executeDispatch(fn, new Object[]{stackPointer, main});
             dropInPlaceDispatchNode.executeDispatch(dropInPlace, new Object[]{stackPointer, mainPointer});
             return exitCode.longValue();
@@ -113,28 +115,38 @@
             return LLVMNativePointer.create(langStartVtable.readDropInPlace(memory, vtablePointer.asNative()));
         }
 
-        protected LLVMNativePointer derefMain(LLVMMemory memory, LLVMNativePointer mainPointer) {
-            return memory.getPointer(mainPointer);
+        protected LLVMNativePointer coerceMainForFn(LLVMMemory memory, LangStartVtableType langStartVtable, LLVMNativePointer mainPointer) {
+            return LLVMNativePointer.create(langStartVtable.coerceMainForFn(memory, mainPointer.asNative()));
         }
 
         static final class LangStartVtableType {
             private final long offsetFn;
+            private final boolean fnExpectsCoercedMain;
 
-            private LangStartVtableType(DataLayout datalayout, StructureType type) {
+            private LangStartVtableType(DataLayout datalayout, StructureType type, FunctionType fnType) {
                 this.offsetFn = type.getOffsetOf(5, datalayout);
+                this.fnExpectsCoercedMain = !(((PointerType) fnType.getArgumentTypes()[0]).getPointeeType() instanceof PointerType);
             }
 
             long readFn(LLVMMemory memory, long address) {
                 return memory.getPointer(address + offsetFn).asNative();
             }
 
+            long coerceMainForFn(LLVMMemory memory, long mainAddress) {
+                if (fnExpectsCoercedMain) {
+                    return memory.getPointer(mainAddress).asNative();
+                }
+                return mainAddress;
+            }
+
             @SuppressWarnings(""static-method"")
             long readDropInPlace(LLVMMemory memory, long address) {
                 return memory.getPointer(address).asNative();
             }
 
             static LangStartVtableType create(DataLayout datalayout, Type vtableType) {
-                return new LangStartVtableType(datalayout, (StructureType) vtableType);
+                FunctionType fnType = (FunctionType) ((PointerType) ((StructureType) vtableType).getElementTypes()[5]).getPointeeType();
+                return new LangStartVtableType(datalayout, (StructureType) vtableType, fnType);
             }
 
         }",0
cut log spam by logging bluetooth off at debug level,"                             }
                             mLastScanCycleStartTime = new Date().getTime();
                         } else {
-                            LogManager.w(TAG, ""Bluetooth is disabled.  Cannot scan for beacons."");
+                            LogManager.d(TAG, ""Bluetooth is disabled.  Cannot scan for beacons."");
                         }
                     }
                 } catch (Exception e) {
@@ -253,7 +253,7 @@
                     }
                     mLastScanCycleEndTime = new Date().getTime();
                 } else {
-                    LogManager.w(TAG, ""Bluetooth is disabled.  Cannot scan for beacons."");
+                    LogManager.d(TAG, ""Bluetooth is disabled.  Cannot scan for beacons."");
                 }
             }
             mNextScanCycleStartTime = getNextScanStartTime();",0
Fix back button on viewing issue,"  */
 package com.github.pockethub.ui.issue;
 
-import static android.content.Intent.FLAG_ACTIVITY_CLEAR_TOP;
-import static android.content.Intent.FLAG_ACTIVITY_SINGLE_TOP;
-import static com.github.pockethub.Intents.EXTRA_ISSUE_NUMBERS;
-import static com.github.pockethub.Intents.EXTRA_POSITION;
-import static com.github.pockethub.Intents.EXTRA_REPOSITORIES;
-import static com.github.pockethub.Intents.EXTRA_REPOSITORY;
 import android.accounts.Account;
 import android.content.Intent;
 import android.os.Bundle;
@@ -29,6 +23,7 @@
 import android.view.MenuItem;
 
 import com.alorma.github.basesdk.client.BaseClient;
+import com.alorma.github.sdk.bean.dto.response.Issue;
 import com.alorma.github.sdk.bean.dto.response.Repo;
 import com.alorma.github.sdk.bean.dto.response.Team;
 import com.alorma.github.sdk.bean.dto.response.User;
@@ -58,11 +53,16 @@
 import java.util.List;
 import java.util.concurrent.atomic.AtomicReference;
 
-import com.alorma.github.sdk.bean.dto.response.Issue;
-
 import retrofit.RetrofitError;
 import retrofit.client.Response;
 
+import static android.content.Intent.FLAG_ACTIVITY_CLEAR_TOP;
+import static android.content.Intent.FLAG_ACTIVITY_SINGLE_TOP;
+import static com.github.pockethub.Intents.EXTRA_ISSUE_NUMBERS;
+import static com.github.pockethub.Intents.EXTRA_POSITION;
+import static com.github.pockethub.Intents.EXTRA_REPOSITORIES;
+import static com.github.pockethub.Intents.EXTRA_REPOSITORY;
+
 /**
  * Activity to display a collection of issues or pull requests in a pager
  */
@@ -271,11 +271,11 @@
             return;
 
         ActionBar actionBar = getSupportActionBar();
-        Repo repoId = repoIds.get(position);
-        if (repoId != null) {
+        repo = repoIds.get(position);
+        if (repo != null) {
             updateTitle(position);
-            actionBar.setSubtitle(InfoUtils.createRepoId(repoId));
-            Issue issue = store.getIssue(repoId, issueNumbers[position]);
+            actionBar.setSubtitle(InfoUtils.createRepoId(repo));
+            Issue issue = store.getIssue(repo, issueNumbers[position]);
             if (issue != null) {
                 Repo fullRepo = issue.repository;
                 if (fullRepo != null && fullRepo.owner != null) {",0
fix status check on contract transactions," 
     // https://www.reddit.com/r/ethereum/comments/5g8ia6/attention_miners_we_recommend_raising_gas_limit/
     public static final BigInteger GAS_LIMIT = BigInteger.valueOf(4_300_000);
-    public static final String SUCCESSFUL_TRANSACTION_STATUS = ""0x1"";
 
     protected final String contractBinary;
     protected String contractAddress;
@@ -254,8 +253,7 @@
 
         TransactionReceipt receipt = send(contractAddress, data, weiValue, gasPrice, gasLimit);
 
-        if (receipt.getStatus() != null
-                && !SUCCESSFUL_TRANSACTION_STATUS.equals(receipt.getStatus())) {
+        if (!receipt.isStatusOK()) {
             throw new TransactionException(
                     String.format(
                             ""Transaction has failed with status: %s. """,0
Fix spelling of Burthorpe Games Room in Discord Rich Presence," 	MG_BARROWS(""Barrows"", DiscordAreaType.MINIGAMES, 14131, 14231),
 	MG_BLAST_FURNACE(""Blast Furnace"", DiscordAreaType.MINIGAMES, 7757),
 	MG_BRIMHAVEN_AGILITY_ARENA(""Brimhaven Agility Arena"", DiscordAreaType.MINIGAMES, 11157),
-	MG_BURTHOPE_GAMES_ROOM(""Burthope Games Room"", DiscordAreaType.MINIGAMES, 8781),
+	MG_BURTHORPE_GAMES_ROOM(""Burthorpe Games Room"", DiscordAreaType.MINIGAMES, 8781),
 	MG_CASTLE_WARS(""Castle Wars"", DiscordAreaType.MINIGAMES, 9520),
 	MG_CLAN_WARS(""Clan Wars"", DiscordAreaType.MINIGAMES, 13135, 13134, 13133, 13131, 13130, 13387, 13386),
 	MG_DUEL_ARENA(""Duel Arena"", DiscordAreaType.MINIGAMES, 13362),",0
"Fix bug with control-click for RIGHT on Mac OS, addresses #5765","                                event.getX(), event.getY(),
                                button, event.getCount());
       }
-      if (button == MouseEvent.RELEASE) {
+      if (action == MouseEvent.RELEASE) {
         macosxLeftButtonWithCtrlPressed = false;
       }
     }",0
fix updateProperties,"     }
 
     /**
-     * Load the additional properties from an input stream
+     * Load the additional properties from an input stream and load all system properties
      *
      * @param inputStream
      */
     public void updateProperties(InputStream inputStream) {
         try {
-            //Load only the properties that are not overridden by the system properties, which take precedence
-            Properties temp = new Properties();
-            temp.load(inputStream);
-            for(String s : temp.stringPropertyNames()){
-                if(!conf.containsKey(s)){
-                    conf.setProperty(s, temp.getProperty(s));
-                }
-            }
+            conf.load(inputStream);
+            conf.putAll(System.getProperties());
         } catch (IOException e) {
             log.warn(""Error loading system properties from input stream"", e);
         }",0
fix documentation,"    void setMaxLifetime(long maxLifetimeMs);
 
    /**
-    * The property controls the maximum size that the pool is allowed to reach, including both idle and in-use
-    * connections. Basically this value will determine the maximum number of actual connections to the database
-    * backend.
-    * <p>
-    * When the pool reaches this size, and no idle connections are available, calls to getConnection() will
-    * block for up to connectionTimeout milliseconds before timing out.
+    * The property controls the minimum number of idle connections that HikariCP tries to maintain in the pool,
+    * including both idle and in-use connections. If the idle connections dip below this value, HikariCP will
+    * make a best effort to restore them quickly and efficiently.
     *
     * @return the minimum number of connections in the pool
     */",0
Update EventEntryConfiguration.java,"         return metaDataProperty;
     }
 
-    private static class Builder {
+    public static class Builder {
 
         private String timestampProperty = ""timestamp"", eventIdentifierProperty = ""eventIdentifier"",
                 aggregateIdentifierProperty = ""aggregateIdentifier"", sequenceNumberProperty = ""sequenceNumber"",",0
Fix MMS taken from Camera does not take into account MAX_MMS_ATTACHME…," import android.graphics.PorterDuff;
 import android.graphics.drawable.AnimationDrawable;
 import android.graphics.drawable.Drawable;
+import android.media.ExifInterface;
 import android.net.Uri;
 import android.os.AsyncTask;
 import android.os.Build;
@@ -869,6 +870,13 @@
         mLabel = label;
     }
 
+    public static Bitmap rotateImage(Bitmap source, float angle) {
+        Matrix matrix = new Matrix();
+        matrix.postRotate(angle);
+        return Bitmap.createBitmap(source, 0, 0, source.getWidth(), source.getHeight(), matrix,
+                true);
+    }
+
     private class ImageLoaderFromCameraTask extends AsyncTask<Void, Void, Bitmap> {
 
         @Override
@@ -879,7 +887,6 @@
             // Get the dimensions of the bitmap
             BitmapFactory.Options bmOptions = new BitmapFactory.Options();
             bmOptions.inJustDecodeBounds = true;
-            BitmapFactory.decodeFile(mCurrentPhotoPath, bmOptions);
             int photoW = bmOptions.outWidth;
             int photoH = bmOptions.outHeight;
 
@@ -891,7 +898,33 @@
             bmOptions.inSampleSize = scaleFactor;
             bmOptions.inPurgeable = true;
 
-            return BitmapFactory.decodeFile(mCurrentPhotoPath, bmOptions);
+            Bitmap bitmap = BitmapFactory.decodeFile(mCurrentPhotoPath, bmOptions);
+
+            long maxAttachmentSize =
+                    SmsHelper.getSendSettings(mContext).getMaxAttachmentSize();
+            bitmap = ImageUtils.shrink(bitmap, 90, maxAttachmentSize);
+
+            // Now, rotation the bitmap according to the Exif data.
+            ExifInterface ei = null;
+            try {
+                ei = new ExifInterface(mCurrentPhotoPath);
+            } catch (IOException e) {
+                e.printStackTrace();
+            }
+            int orientation = ei.getAttributeInt(ExifInterface.TAG_ORIENTATION,
+                    ExifInterface.ORIENTATION_UNDEFINED);
+
+            switch(orientation) {
+                case ExifInterface.ORIENTATION_ROTATE_90:
+                    return rotateImage(bitmap, 90);
+                case ExifInterface.ORIENTATION_ROTATE_180:
+                    return rotateImage(bitmap, 180);
+                case ExifInterface.ORIENTATION_ROTATE_270:
+                    return rotateImage(bitmap, 270);
+                case ExifInterface.ORIENTATION_NORMAL:
+                default:
+                    return rotateImage(bitmap, 0); // No rotation
+            }
         }
 
         @Override",0
Remove duplicate code.,"     @Override
     public void sendSofaException(SofaRpcException sofaException) {
         checkState();
-        checkState();
         SofaResponse response = new SofaResponse();
         response.setErrorMsg(sofaException.getMessage());
         sendSofaResponse(response, sofaException);",0
Fix for issue #529.," 
         for (int i = 0; i < mesh.length; i++) {
             final ChunkMesh segment = Preconditions.checkNotNull(mesh[i], ""Chunk mesh segment #"" + i + "" must not be null"");
-            Preconditions.checkNotNull(segment._vertexElements, ""Vertex elements for chunk mesh segment #"" + i + "" must not be null"");
+            if (segment._vertexElements != null)
             for (int j = 0; j < segment._vertexElements.length; j++) {
                 final ChunkMesh.VertexElements element = Preconditions.checkNotNull(segment._vertexElements[j], ""Vertex element #"" + j + "" of chunk mesh segment #"" + i + "" must not be null"");
                 totalFinalVertices += element.finalVertices.limit();",0
Fixed NullPointerException in getView of ContextualUndoAdapter," 			contextualUndoView.displayUndo();
 			mCurrentRemovedView = contextualUndoView;
 			long millisLeft = mAutoDeleteDelayMillis - (System.currentTimeMillis() - mDismissStartMillis);
+			if (mCountDownFormatter != null) {
 			mCurrentRemovedView.updateCountDownTimer(mCountDownFormatter.getCountDownString(millisLeft));
+			}
 		} else {
 			contextualUndoView.displayContentView();
 		}",0
Fix Future.traverse with ExecutorService argument,"         Objects.requireNonNull(executorService, ""executorService is null"");
         Objects.requireNonNull(values, ""values is null"");
         Objects.requireNonNull(mapper, ""mapper is null"");
-        return sequence(Iterator.ofAll(values).map(mapper));
+        return sequence(executorService, Iterator.ofAll(values).map(mapper));
     }
 
     // -- non-static Future API",0
Fix reshape vertex input type,"             case 3:
                 return InputType.recurrent(newShape[1]);
             case 4:
-                return InputType.convolutional(newShape[1], newShape[2], newShape[0]); //[mb,d,h,w] for activations
+                return InputType.convolutional(newShape[2], newShape[3], newShape[1]); //[mb,d,h,w] for activations
             default:
                 throw new UnsupportedOperationException(
                                 ""Cannot infer input type for reshape array "" + Arrays.toString(newShape));",0
Fix for #4916,"                                 this.inputShape[0]);
                         break;
                     default:
-                        throw new UnsupportedKerasConfigurationException(
-                                ""3D (convolutional) inputs with unknown dimension ordering "" + this.dimOrder
-                                        + "" are not supported."");
+                        this.dimOrder = DimOrder.THEANO;
+                        myInputType = new InputType.InputTypeConvolutional(this.inputShape[1], this.inputShape[2],
+                                this.inputShape[0]);
+                        log.warn(""Couldn't determine dim ordering / data format from model file. Older Keras "" +
+                                ""versions may come without specified backend, in which case we assume the model was "" +
+                                ""built with theano."" );
                 }
                 break;
             default:",0
Texture class fix," 	
 	public Texture(String textureName, TextureAtlas atlas)
 	{
-		super(TextureType.DIFFUSE, textureName, atlas.getTileNamed(""boat_int_prp_tex"").getPage());
+		super(TextureType.DIFFUSE, textureName, atlas.getTileNamed(textureName).getPage());
 	}
 	public Texture(String textureName, ACompressedTexture compressedTexture)
 	{",0
Fix Typo,"      */
     public static final String SEPARATOR = ""/"";
 
-    public static final String fileExtensionZip = ""zip"", fileExtensinJar = ""jar"", fileExtensionApk = ""apk"";
+    public static final String fileExtensionZip = ""zip"", fileExtensionJar = ""jar"", fileExtensionApk = ""apk"";
     public static final String fileExtensionTar = ""tar"";
     public static final String fileExtensionGzipTar = ""tar.gz"";
     public static final String fileExtensionRar = ""rar"";
@@ -105,7 +105,7 @@
     }
 
     private static boolean isZip(String type) {
-        return type.endsWith(fileExtensionZip) || type.endsWith(fileExtensinJar)
+        return type.endsWith(fileExtensionZip) || type.endsWith(fileExtensionJar)
                 || type.endsWith(fileExtensionApk);
     }
 ",0
Fix jumping in water and in mid-air,"                 movementComp.numberOfJumpsLeft--;
             }
 
+            if (state.isGrounded()) {
+                movementComp.numberOfJumpsLeft--;
             state.setGrounded(false);
         }
+        }
         if (input.isFirstRun() && moveResult.isHorizontalHit()) {
             Vector3f hitVelocity = new Vector3f(state.getVelocity());
             hitVelocity.x += (distanceMoved.x / moveDelta.x) * (endVelocity.x - state.getVelocity().x);",0
Fix string concatenation when used as argument of append() call,"   @Override
   public String toString() {
     StringBuilder strb = new StringBuilder();
-    strb.append(getExecutionEntity().getId() + "" : "" + getExecutionEntity().getActivityId() + "", parent id "" + getExecutionEntity().getParentId() + ""\r\n"");
+    strb.append(getExecutionEntity().getId()).append("" : "").append(getExecutionEntity().getActivityId()).append("", parent id "")
+            .append(getExecutionEntity().getParentId()).append(""\r\n"");
     if (children != null) {
       for (ExecutionTreeNode childNode : children) {
         childNode.internalToString(strb, """", true);
@@ -77,10 +78,9 @@
   }
 
   protected void internalToString(StringBuilder strb, String prefix, boolean isTail) {
-    strb.append(prefix + (isTail ? ""└── "" : ""├── "") + getExecutionEntity().getId() + "" : "" 
-        + getExecutionEntity().getActivityId() + "", parent id "" 
-        + getExecutionEntity().getParentId() 
-        + (getExecutionEntity().isScope() ? "" (scope)"" : """") + ""\r\n"");
+    strb.append(prefix).append(isTail ? ""└── "" : ""├── "").append(getExecutionEntity().getId()).append("" : "")
+            .append(getExecutionEntity().getActivityId()).append("", parent id "").append(getExecutionEntity().getParentId())
+            .append(getExecutionEntity().isScope() ? "" (scope)"" : """").append(""\r\n"");
     if (children != null) {
       for (int i = 0; i < children.size() - 1; i++) {
         children.get(i).internalToString(strb, prefix + (isTail ? ""    "" : ""│   ""), false);",0
-fix: Change the delay of the reaperFuture to be the minimum of the requ...," 
         try {
             future.touch();
-            int delay = requestTimeout(config, future.getRequest().getPerRequestConfig());
+            int delay = Math.min(config.getIdleConnectionTimeoutInMs(), requestTimeout(config, future.getRequest().getPerRequestConfig()));
             if (delay != -1 && !future.isDone() && !future.isCancelled()) {
                 ReaperFuture reaperFuture = new ReaperFuture(future);
                 Future scheduledFuture = config.reaper().scheduleAtFixedRate(reaperFuture, 0, delay, TimeUnit.MILLISECONDS);",0
fix NPE on null realm in NTLM challenge,"             }
 
             Realm.RealmBuilder realmBuilder;
+            Realm.AuthScheme authScheme;
             if (realm != null) {
                 realmBuilder = new Realm.RealmBuilder().clone(realm);
+                authScheme = realm.getAuthScheme();
             } else {
                 realmBuilder = new Realm.RealmBuilder();
+                authScheme = Realm.AuthScheme.NTLM;
             }
-            newRealm = realmBuilder.setScheme(realm.getAuthScheme())
+            newRealm = realmBuilder.setScheme(authScheme)
                     .setUri(URI.create(request.getUrl()).getPath())
                     .setMethodName(request.getMethod())
                     .build();",0
Save all webdriver network logs with request URL starting from 'ws://'," 
   private boolean isUrlFromCheTraffic(String url) {
     return url != null
-        && (url.matches(format(""https?://%s[:\\d]*/api/.*"", cheHost))
-            || url.matches(format(""wss?://%s[:\\d]*/(api|connect|wsagent).*"", cheHost)));
+        && (url.matches(format(""https?://%s[:\\d]*/api/.*"", cheHost)) || url.matches(""wss?://.*""));
   }
 
   private String formatTime(long timestamp) {",0
Fix NPE in NettyAsyncHttpProvider.toString()," 
     @Override
     public String toString() {
+        int availablePermits = freeConnections != null ? freeConnections.availablePermits() : 0;
         return String.format(""NettyAsyncHttpProvider:\n\t- maxConnections: %d\n\t- openChannels: %s\n\t- connectionPools: %s"",//
-                config.getMaxTotalConnections() - freeConnections.availablePermits(),//
+                config.getMaxTotalConnections() - availablePermits,//
                 openChannels.toString(),//
                 connectionsPool.toString());
     }",0
fix for breaking change in React Native 0.47," 		);
 	}
 
-	@Override
 	public List<Class<? extends JavaScriptModule>> createJSModules() {
 		return Collections.emptyList();
 	}",0
[BACKLOG-15718] Fix for recently opened file directory," import org.pentaho.di.ui.spoon.Spoon;
 import org.pentaho.repo.dialog.RepositoryOpenSaveDialog;
 
+import java.util.Calendar;
 import java.util.Collections;
+import java.util.Date;
 import java.util.List;
 import java.util.function.Supplier;
 
@@ -51,7 +53,12 @@
     String repoAndUser = getRepository().getName() + "":"" + username;
     List<LastUsedFile>
       lastUsedFileList = propsUI.getLastUsedRepoFiles().getOrDefault( repoAndUser, Collections.emptyList() );
-    if ( lastUsedFileList.size() > 0 ) {
+
+    Calendar calendar = Calendar.getInstance();
+    calendar.add( Calendar.DATE, -30 );
+    Date dateBefore = calendar.getTime();
+
+    if ( lastUsedFileList.size() > 0 && lastUsedFileList.get( 0 ).getLastOpened().after( dateBefore ) ) {
       lastUsedFile = lastUsedFileList.get( 0 );
     }
 ",0
Fixed error handling in AsyncExecutor's GWT emulation," 
 package com.badlogic.gdx.utils.async;
 
-import java.util.concurrent.Callable;
-import java.util.concurrent.ExecutorService;
-import java.util.concurrent.Executors;
-import java.util.concurrent.ThreadFactory;
-import java.util.concurrent.TimeUnit;
-
 import com.badlogic.gdx.utils.Disposable;
 import com.badlogic.gdx.utils.GdxRuntimeException;
-import com.badlogic.gdx.utils.async.AsyncResult;
-import com.badlogic.gdx.utils.async.AsyncTask;
 
-/**
- * GWT emulation of AsynchExecutor, will call tasks immediately :D
- * @author badlogic
- *
- */
+/** GWT emulation of AsynchExecutor, will call tasks immediately :D
+ * @author badlogic */
 public class AsyncExecutor implements Disposable {
 	
-	/**
-	 * Creates a new AsynchExecutor that allows maxConcurrent
-	 * {@link Runnable} instances to run in parallel.
-	 * @param maxConcurrent
-	 */
+	/** Creates a new AsynchExecutor that allows maxConcurrent {@link Runnable} instances to run in parallel.
+	 * @param maxConcurrent */
 	public AsyncExecutor(int maxConcurrent) {
 	}
 	
-	/**
-	 * Submits a {@link Runnable} to be executed asynchronously. If
-	 * maxConcurrent runnables are already running, the runnable 
-	 * will be queued.
-	 * @param task the task to execute asynchronously
-	 */
+	/** Submits a {@link Runnable} to be executed asynchronously. If maxConcurrent runnables are already running, the runnable will
+	 * be queued.
+	 * @param task the task to execute asynchronously */
 	public <T> AsyncResult<T> submit(final AsyncTask<T> task) {
 		T result = null;
-		boolean error = false;
 		try {
 			result = task.call();
 		} catch(Throwable t) {
-			error = true;
+			throw new GdxRuntimeException(""Could not submit AsyncTask: "" + t.getMessage(), t);
 		}
 		return new AsyncResult(result);
 	}
 	
-	/**
-	 * Waits for running {@link AsyncTask} instances to finish,
-	 * then destroys any resources like threads. Can not be used
-	 * after this method is called.
-	 */
+	/** Waits for running {@link AsyncTask} instances to finish, then destroys any resources like threads. Can not be used after
+	 * this method is called. */
 	@Override
 	public void dispose () {
 	}",0
Fix typos in class initialization messages," 
     public static class Options {
         @APIOption(name = ""delay-class-initialization-to-runtime"")//
-        @Option(help = ""A comma-separate list of classes (and implicitly all of their subclasses) that are initialized at runtime and not during image building"", type = OptionType.User)//
+        @Option(help = ""A comma-separated list of classes (and implicitly all of their subclasses) that are initialized at runtime and not during image building"", type = OptionType.User)//
         public static final HostedOptionKey<String> DelayClassInitialization = new HostedOptionKey<>("""");
 
         @APIOption(name = ""rerun-class-initialization-at-runtime"") //
-        @Option(help = ""A comma-separate list of classes (and implicitly all of their subclasses) that are initialized both at runtime and during image building"", type = OptionType.User)//
+        @Option(help = ""A comma-separated list of classes (and implicitly all of their subclasses) that are initialized both at runtime and during image building"", type = OptionType.User)//
         public static final HostedOptionKey<String> RerunClassInitialization = new HostedOptionKey<>("""");
     }
 
@@ -221,7 +221,7 @@
          * user cannot later manually register it as RERUN or DELAY.
          */
         if (obj != null && computeInitKindAndMaybeInitializeClass(obj.getClass()) != InitKind.EAGER) {
-            throw new UnsupportedFeatureException(""No instances are allowed in the image heap for a class that is initialized or reinitialzied at image runtime: "" + obj.getClass().getTypeName());
+            throw new UnsupportedFeatureException(""No instances are allowed in the image heap for a class that is initialized or reinitialized at image runtime: "" + obj.getClass().getTypeName());
         }
         return obj;
     }
@@ -234,7 +234,7 @@
          */
         for (Map.Entry<Class<?>, InitKind> entry : classInitKinds.entrySet()) {
             if (entry.getValue() == InitKind.DELAY && !UnsafeAccess.UNSAFE.shouldBeInitialized(entry.getKey())) {
-                throw UserError.abort(""Class that is marked for delaying initialzation to runtime got initialized during image building: "" + entry.getKey().getTypeName());
+                throw UserError.abort(""Class that is marked for delaying initialization to runtime got initialized during image building: "" + entry.getKey().getTypeName());
             }
         }
     }",0
Fix negative direction in RotateAroundAnimation3D," 	
 	@Override
 	protected void applyTransformation(float interpolatedTime) {
-		float radians = mDirection * 360f * interpolatedTime * PI_DIV_180;
+		float radians = 360f * interpolatedTime * PI_DIV_180;
 		
 		float cosVal = FloatMath.cos(radians) * mDistance;
 		float sinVal = FloatMath.sin(radians) * mDistance;",0
Hook OverrideMessageProxyListener into the Proxy," // ZAP: 2016/03/23 Issue 2331: Custom Context Panels not show in existing contexts after installation of add-on
 // ZAP: 2016/04/22 Issue 2428: Memory leak on session creation/loading
 // ZAP: 2016/05/30 Issue 2494: ZAP Proxy is not showing the HTTP CONNECT Request in history tab
+// ZAP: 2016/09/06 Hook OverrideMessageProxyListener into the Proxy
 
 package org.parosproxy.paros.control;
 
@@ -119,6 +120,7 @@
 		// ZAP: Start proxy even if no view
 	    Proxy proxy = getProxy(overrides);
 	    getExtensionLoader().hookProxyListener(proxy);
+	    getExtensionLoader().hookOverrideMessageProxyListener(proxy);
 	    getExtensionLoader().hookPersistentConnectionListener(proxy);
 	    getExtensionLoader().hookConnectRequestProxyListeners(proxy);
 		",0
Fix for the next(int) function in AtomicQueue.," 	}
 
 	private int next (int idx) {
-		return idx + 1 & queue.length() - 1;
+		return (idx + 1) % queue.length();
 	}
 
 	public boolean put (T value) {",0
Finding Sku Options in Community was failing due to the query looking at archiveStatus," 
         List<Predicate> predicates = new ArrayList<>();
 
-        // restrict archived values
-        predicates.add(cb.or(cb.notEqual(root.get(""sku"").get(""archiveStatus"").get(""archived""), 'Y'),
-                             cb.isNull(root.get(""sku"").get(""archiveStatus"").get(""archived""))));
-
         // restrict to skus that match the product
         predicates.add(root.get(""sku"").get(""product"").get(""id"").in(sandBoxHelper.mergeCloneIds(ProductImpl.class, productId)));
 ",0
Set the Sku's Product as the Product on the OrderItem if Product not provided,"         Product product = null;
         if (orderItemRequestDTO.getProductId() != null) {
             product = catalogService.findProductById(orderItemRequestDTO.getProductId());
+        } else if (sku != null) {
+            product = sku.getProduct();
         }
 
         Category category = null;",0
Fix an issue with drawLine() connecting wrong edges of a rectangle,"         Rect2i finalRegion = state.cropRegion.intersect(absoluteRegion);
 
         if (!finalRegion.isEmpty()) {
-            int sx = finalRegion.minX();
-            int sy = finalRegion.minY();
-            int ex = finalRegion.maxX();
-            int ey = finalRegion.maxY();
+            int sx = startX >= endX ? finalRegion.minX() : finalRegion.maxX();
+            int sy = startY >= endY ? finalRegion.minY() : finalRegion.maxY();
+            int ex = startX >= endX ? finalRegion.maxX() : finalRegion.minX();
+            int ey = startY >= endY ? finalRegion.maxY() : finalRegion.minY();
 
             if (state.drawOnTop) {
                 drawOnTopOperations.add(new DrawLineOperation(sx, sy, ex, ey, color));",0
Small fix so mIncludeSecondaryDrawerItems works in MiniDrawer,"      * @return
      */
     public IDrawerItem generateMiniDrawerItem(IDrawerItem drawerItem) {
-        if (drawerItem instanceof PrimaryDrawerItem) {
+        if (drawerItem instanceof SecondaryDrawerItem) {
+            return mIncludeSecondaryDrawerItems ? new MiniDrawerItem((SecondaryDrawerItem) drawerItem).withEnableSelectedBackground(mEnableSelectedMiniDrawerItemBackground) : null;
+        } else if (drawerItem instanceof PrimaryDrawerItem) {
             return new MiniDrawerItem((PrimaryDrawerItem) drawerItem).withEnableSelectedBackground(mEnableSelectedMiniDrawerItemBackground);
-        } else if (drawerItem instanceof SecondaryDrawerItem && mIncludeSecondaryDrawerItems) {
-            return new MiniDrawerItem((SecondaryDrawerItem) drawerItem).withEnableSelectedBackground(mEnableSelectedMiniDrawerItemBackground);
         } else if (drawerItem instanceof ProfileDrawerItem) {
             MiniProfileDrawerItem mpdi = new MiniProfileDrawerItem((ProfileDrawerItem) drawerItem);
             mpdi.withEnabled(mEnableProfileClick);",0
Give the file path in the exception so that it's easier to debug,"         this.file = file;
         if (file != null) {
             if (!file.isFile()) {
-                throw new FileNotFoundException(""File is not a normal file."");
+                final String errorMessage = 
+                    String.format(""File is not a normal file (%s)."", file.getAbsolutePath());
+                throw new FileNotFoundException(errorMessage);
             }
             if (!file.canRead()) {
-                throw new FileNotFoundException(""File is not readable."");
+                final String errorMessage = 
+                    String.format(""File is not readable (%s)."", file.getAbsolutePath());
+                throw new FileNotFoundException(errorMessage);
             }
             this.fileName = file.getName();
         }",0
override isRunning and isPaused method to fixbug shutdown open replicator,"     throw new RuntimeException(""Not supported !!"");
   }
 
+  /* (non-Javadoc)
+   * @see com.linkedin.databus2.producers.AbstractEventProducer#isPaused()
+   */
+  @Override
+  public synchronized boolean isPaused()
+  {
+    return _producerThread.isPauseRequested();
+  }
+
+  /* (non-Javadoc)
+   * @see com.linkedin.databus2.producers.AbstractEventProducer#isRunning()
+   */
+  @Override
+  public synchronized boolean isRunning()
+  {
+    return !_producerThread.isShutdownRequested() && !_producerThread.isPauseRequested();
+  }
 
   /* (non-Javadoc)
    * @see com.linkedin.databus2.producers.AbstractEventProducer#unpause()",0
[BACKLOG-15936] Fix slave server icon,"         continue;
       }
 
-      TreeItem tiSlave = createTreeItem( tiSlaveTitle, slaveServer.getName(), guiResource.getImageSlaveMedium() );
+      TreeItem tiSlave = createTreeItem( tiSlaveTitle, slaveServer.getName(), guiResource.getImageSlaveTree() );
       if ( slaveServer.isShared() ) {
         tiSlave.setFont( guiResource.getFontBold() );
       }",0
Fix TextureUnpacker," 		g2.setColor(Color.BLACK);
 
 		// Draw the four lines to save the ninepatch's padding and splits
-		g2.drawLine(region.splits[0] + NINEPATCH_PADDING, 0, region.width - region.splits[1] + NINEPATCH_PADDING - 1, 0);
-		g2.drawLine(0, region.splits[2] + NINEPATCH_PADDING, 0, region.height - region.splits[3] + NINEPATCH_PADDING - 1);
+		int startX = region.splits[0] + NINEPATCH_PADDING;
+		int endX = region.width - region.splits[1] + NINEPATCH_PADDING - 1;
+		int startY = region.splits[2] + NINEPATCH_PADDING;
+		int endY = region.height - region.splits[3] + NINEPATCH_PADDING - 1;
+		if (endX >= startX) g2.drawLine(startX, 0, endX, 0);
+		if (endY >= startY) g2.drawLine(0, startY, 0, endY);
 		if (region.pads != null) {
-			g2.drawLine(region.pads[0] + NINEPATCH_PADDING, splitImage.getHeight() - 1, splitImage.getWidth() - region.pads[1]
-				+ NINEPATCH_PADDING - 1, splitImage.getHeight() - 1);
-			g2.drawLine(splitImage.getWidth() - 1, region.pads[2] + NINEPATCH_PADDING, splitImage.getWidth() - 1,
-				splitImage.getHeight() - region.pads[3] + NINEPATCH_PADDING - 1);
+			int padStartX = region.pads[0] + NINEPATCH_PADDING;
+			int padEndX = region.width - region.pads[1] + NINEPATCH_PADDING - 1;
+			int padStartY = region.pads[2] + NINEPATCH_PADDING;
+			int padEndY = region.height - region.pads[3] + NINEPATCH_PADDING - 1;
+			g2.drawLine(padStartX, splitImage.getHeight() - 1, padEndX, splitImage.getHeight() - 1);
+			g2.drawLine(splitImage.getWidth() - 1, padStartY, splitImage.getWidth() - 1, padEndY);
 		}
 		g2.dispose();
 ",0
[3.6.1] ILock expiry operation should be able run both owner and backup,"         try {
             submit(operation, key);
         } catch (Throwable t) {
-            ILogger logger = nodeEngine.getLogger(getClass());
             logger.warning(t);
         }
     }
@@ -77,6 +76,7 @@
         OperationAccessor.setCallerAddress(operation, nodeEngine.getThisAddress());
         operation.setCallerUuid(nodeEngine.getLocalMember().getUuid());
         operation.setOperationResponseHandler(unlockResponseHandler);
+        operation.setValidateTarget(false);
         operation.setAsyncBackup(true);
 
         operationService.executeOperation(operation);",0
CAMEL-12926: fixed null pointer exceptions accessing swagger url inlueprint projects," 
 import java.lang.management.ManagementFactory;
 import java.util.ArrayList;
+import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
@@ -210,7 +211,7 @@
 
         List<RestDefinition> rests = getRestDefinitions(contextId);
         if (rests != null) {
-            final Map<String, Object> apiProperties = configuration.getApiProperties();
+            final Map<String, Object> apiProperties = configuration.getApiProperties() != null ? configuration.getApiProperties() : new HashMap<>();
             if (json) {
                 response.setHeader(Exchange.CONTENT_TYPE, (String) apiProperties.getOrDefault(""api.specification.contentType.json"", ""application/json""));
 ",0
Fix platform-specific preferences in some cases,"     load(new FileInputStream(file));
   }
 
+  protected String processPlatformSuffix(String key, String suffix, boolean isCurrentPlatform) {
+    if (key == null)
+      return null;
+    // Key does not end with the given suffix? Process as normal
+    if (!key.endsWith(suffix))
+      return key;
+    // Not the current platform? Ignore this key
+    if (!isCurrentPlatform)
+      return null;
+    // Strip the suffix from the key
+    return key.substring(0, key.length() - suffix.length());
+  }
+
   /**
    * Parse a property list stream and put key/value pairs into the Map
    * 
@@ -91,28 +104,15 @@
 
       int equals = line.indexOf('=');
       if (equals != -1) {
-        String key = line.substring(0, equals);
-        String value = line.substring(equals + 1);
-        put(key.trim(), value.trim());
-      }
-    }
+        String key = line.substring(0, equals).trim();
+        String value = line.substring(equals + 1).trim();
 
-    // This is needed to avoid ConcurrentAccessExceptions
-    Set<String> keys = new LinkedHashSet<String>(keySet());
+        key = processPlatformSuffix(key, "".linux"", Base.isLinux());
+        key = processPlatformSuffix(key, "".windows"", Base.isWindows());
+        key = processPlatformSuffix(key, "".macosx"", Base.isMacOS());
 
-    // Override keys that have OS specific versions
-    for (String key : keys) {
-      boolean replace = false;
-      if (Base.isLinux() && key.endsWith("".linux""))
-        replace = true;
-      if (Base.isWindows() && key.endsWith("".windows""))
-        replace = true;
-      if (Base.isMacOS() && key.endsWith("".macos""))
-        replace = true;
-      if (replace) {
-        int dot = key.lastIndexOf('.');
-        String overridenKey = key.substring(0, dot);
-        put(overridenKey, get(key));
+        if (key != null)
+          put(key, value);
       }
     }
   }",0
bug 版本号判断,"                 if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.M) {
                     Field mViewsField = Class.forName(""android.view.WindowManagerGlobal"").getDeclaredField(""mViews"");
                     mViewsField.setAccessible(true);
-                    List<View> views = (List<View>) mViewsField.get(mGlobalField.get(windowManager));
+                    List<View> views;
+                    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT){
+                        views = (List<View>) mViewsField.get(mGlobalField.get(windowManager));
+                    }else {
+                        views = Arrays.asList((View[]) mViewsField.get(mGlobalField.get(windowManager)));
+                    }
+
                     for (int i = views.size() - 1; i >= 0; i--) {
                         View targetView = getTargetDecorView(targetActivity, views.get(i));
                         if (targetView != null) {
@@ -104,11 +110,7 @@
                     Field mRootsField = Class.forName(""android.view.WindowManagerGlobal"").getDeclaredField(""mRoots"");
                     mRootsField.setAccessible(true);
                     List viewRootImpls;
-                    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
                         viewRootImpls = (List) mRootsField.get(mGlobalField.get(windowManager));
-                    } else {
-                        viewRootImpls = Arrays.asList((Object[]) mRootsField.get(mGlobalField.get(windowManager)));
-                    }
                     for (int i = viewRootImpls.size() - 1; i >= 0; i--) {
                         Class clazz = Class.forName(""android.view.ViewRootImpl"");
                         Object object = viewRootImpls.get(i);",0
Fix duplicate chat message notifications,"         overlay = nuiManager.addOverlay(NotificationOverlay.ASSET_URI, NotificationOverlay.class);
         console.subscribe((Message message) -> {
             if (!nuiManager.isOpen(""engine:console"")) {
+                // make sure the message isn't already shown in the chat overlay
+                if (message.getType() != CoreMessageType.CHAT && message.getType() != CoreMessageType.NOTIFICATION
+                        || !nuiManager.isOpen(""engine:chat"")) {
                 overlay.setVisible(true);
             }
+            }
         });
     }
 ",0
Fix 'Download output' link in toast notification," import org.eclipse.che.ide.api.dialogs.ConfirmCallback;
 import org.eclipse.che.ide.api.dialogs.DialogFactory;
 import org.eclipse.che.ide.api.machine.ExecAgentCommandManager;
-import org.eclipse.che.ide.command.toolbar.processes.ActivateProcessOutputEvent;
 import org.eclipse.che.ide.api.machine.events.ExecAgentServerRunningEvent;
 import org.eclipse.che.ide.api.machine.events.MachineRunningEvent;
 import org.eclipse.che.ide.api.machine.events.MachineStartingEvent;
@@ -64,6 +63,7 @@
 import org.eclipse.che.ide.api.workspace.model.RuntimeImpl;
 import org.eclipse.che.ide.api.workspace.model.WorkspaceImpl;
 import org.eclipse.che.ide.bootstrap.BasicIDEInitializedEvent;
+import org.eclipse.che.ide.command.toolbar.processes.ActivateProcessOutputEvent;
 import org.eclipse.che.ide.command.toolbar.processes.ProcessOutputClosedEvent;
 import org.eclipse.che.ide.console.CommandConsoleFactory;
 import org.eclipse.che.ide.console.CommandOutputConsole;
@@ -355,7 +355,7 @@
         }
 
         for (ProcessTreeNode processTreeNode : machineNodes.values()) {
-            if (processTreeNode.getData() instanceof MachineImpl) {
+            if (processTreeNode.getType() == MACHINE_NODE) {
                 String machineName = (String)processTreeNode.getData();
 
                 if (machineName.equals(devMachine.get().getName())) {
@@ -1280,33 +1280,18 @@
 
     @Override
     public void onDownloadWorkspaceOutput(DownloadWorkspaceOutputEvent event) {
-        // TODO (spi ide)
-//        MachineImpl devMachine = null;
-//
-//        for (ProcessTreeNode machineNode : machineNodes.values()) {
-//            if (!(machineNode.getData() instanceof MachineImpl)) {
-//                continue;
-//            }
-//
-//            MachineImpl machine = (MachineImpl)machineNode.getData();
-//
-//            if (!machine.getServerByName(WSAGENT_REFERENCE).isPresent()) {
-//                continue;
-//            }
-//
-//            devMachine = machine;
-//            break;
-//        }
-//
-//        if (devMachine == null) {
-//            return;
-//        }
-//
-//        String fileName = appContext.getWorkspace().getNamespace() + ""-"" + appContext.getWorkspace().getConfig().getName() +
-//                          "" "" + DateTimeFormat.getFormat(""yyyy-MM-dd HH:mm:ss"").format(new Date()) +
-//                          "".log"";
-//
-//        download(fileName, getText(devMachine.getName()));
+        WorkspaceImpl workspace = appContext.getWorkspace();
+        Optional<MachineImpl> devMachine = workspace.getDevMachine();
+
+        if (!devMachine.isPresent()) {
+            return;
+        }
+
+        String fileName = workspace.getNamespace() + ""-"" + workspace.getConfig().getName() +
+                          "" "" + DateTimeFormat.getFormat(""yyyy-MM-dd HH:mm:ss"").format(new Date()) +
+                          "".log"";
+
+        download(fileName, getText(devMachine.get().getName()));
     }
 
     @Override",0
Fix a bug of Switch.," 				x = (x < ball.xIni) ? ball.xIni : x;
 				x = (x > ball.xFin) ? ball.xFin : x;
 				if (x > ball.xCen) {
-					check = true;
+					eventCheck = true;
 				} else {
-					check = false;
+					eventCheck = false;
 				}
 				ViewHelper.setX(ball, x);
 				ball.changeBackground();
@@ -106,7 +106,7 @@
 				press = false;
 				isLastTouch = false;
 				if (eventCheck != check) {
-					eventCheck = check;
+					check = eventCheck;
 					if (onCheckListener != null)
 						onCheckListener.onCheck(check);
 				}
@@ -130,7 +130,7 @@
 		Canvas temp = new Canvas(bitmap);
 		Paint paint = new Paint();
 		paint.setAntiAlias(true);
-		paint.setColor((check) ? backgroundColor : Color.parseColor(""#B0B0B0""));
+		paint.setColor((eventCheck) ? backgroundColor : Color.parseColor(""#B0B0B0""));
 		paint.setStrokeWidth(Utils.dpToPx(2, getResources()));
 		temp.drawLine(getHeight() / 2, getHeight() / 2, getWidth()
 				- getHeight() / 2, getHeight() / 2, paint);
@@ -196,6 +196,7 @@
 	public void setChecked(boolean check) {
 		invalidate();
 		this.check = check;
+		this.eventCheck = check;
 		ball.animateCheck();
 	}
 
@@ -213,7 +214,7 @@
 		}
 
 		public void changeBackground() {
-			if (check) {
+			if (eventCheck) {
 				setBackgroundResource(R.drawable.background_checkbox);
 				LayerDrawable layer = (LayerDrawable) getBackground();
 				GradientDrawable shape = (GradientDrawable) layer
@@ -227,7 +228,7 @@
 		public void animateCheck() {
 			changeBackground();
 			ObjectAnimator objectAnimator;
-			if (check) {
+			if (eventCheck) {
 				objectAnimator = ObjectAnimator.ofFloat(this, ""x"", ball.xFin);
 
 			} else {",0
Fix for Tweak deadlock issue," import java.util.logging.Level;
 import java.util.logging.Logger;
 
+import javax.swing.SwingUtilities;
+
 import processing.app.*;
 import processing.app.ui.Editor;
 import processing.app.ui.EditorException;
@@ -216,18 +218,28 @@
 //          }
           // next lines are executed when the sketch quits
           if (launchInteractive) {
+            // fix swing deadlock issue: https://github.com/processing/processing/issues/3928
+            SwingUtilities.invokeLater(new Runnable() {
+              public void run() {
             editor.initEditorCode(parser.allHandles, false);
             editor.stopTweakMode(parser.allHandles);
           }
+            });
+          }
         }
       }).start();
 
       if (launchInteractive) {
+        // fix swing deadlock issue: https://github.com/processing/processing/issues/3928
+        SwingUtilities.invokeLater(new Runnable() {
+          public void run() {
         // replace editor code with baseCode
         editor.initEditorCode(parser.allHandles, false);
         editor.updateInterface(parser.allHandles, parser.colorBoxes);
         editor.startTweakMode();
       }
+        });
+      }
       return runtime;
     }
     return null;",0
[DUBBO-2757]: Fix the bug that ReferenceBean refers service more than once when debugging.,"                 try {
                     String name = method.getName();
                     if ((name.startsWith(""get"") || name.startsWith(""is""))
-                            && !""getClass"".equals(name) && !""get"".equals(name) && !""is"".equals(name)
+                            && !""get"".equals(name) && !""is"".equals(name)
+                            && !""getClass"".equals(name) && !""getObject"".equals(name)
                             && Modifier.isPublic(method.getModifiers())
                             && method.getParameterTypes().length == 0
                             && isPrimitive(method.getReturnType())) {",0
Reduce log output when loading a world with the debug text visible.,"             debugLine4.bindText(new ReadOnlyBinding<String>() {
                 @Override
                 public String get() {
+                    String biomeId = ""unavailable"";
                     Vector3i blockPos = new Vector3i(localPlayer.getPosition());
+                    if (worldProvider.isBlockRelevant(blockPos)) {
                     Biome biome = worldProvider.getBiome(blockPos);
-                    String biomeId = CoreRegistry.get(BiomeManager.class).getBiomeId(biome);
+                        biomeId = CoreRegistry.get(BiomeManager.class).getBiomeId(biome);
+                    }
                     return String.format(""total vus: %s | worldTime: %.2f | biome: %s"",
                             ChunkTessellator.getVertexArrayUpdateCount(),
                             worldProvider.getTime().getDays(),",0
FTP Server fixed while using Eth," 
 import java.io.File;
 import java.io.InputStream;
+import java.net.InetAddress;
 import java.util.Objects;
 
 /**
  * Created by yashwanthreddyg on 10-06-2016.
+ * Edited by Luca D'Amico (Luca91) on 25 Jul 2017 (Fixed FTP Server while using Eth connection)
  */
 public class FTPServerFragment extends Fragment {
 
@@ -120,10 +122,10 @@
             @Override
             public void onClick(View v) {
                 if (!FTPService.isRunning()) {
-                    if (FTPService.isConnectedToWifi(getContext()))
+                    if (FTPService.isConnectedToWifi(getContext()) || FTPService.isConnectedToLocalNetwork(getContext()))
                         startServer();
                     else {
-                        // no wifi, we shouldn't be here in the first place, because of broadcast
+                        // no wifi and no eth, we shouldn't be here in the first place, because of broadcast
                         // receiver, but just to be sure
                         statusText.setText(spannedStatusNoConnection);
                     }
@@ -340,11 +342,11 @@
         public void onReceive(Context context, Intent intent) {
             ConnectivityManager conMan = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
             NetworkInfo netInfo = conMan.getActiveNetworkInfo();
-            if (netInfo != null && netInfo.getType() == ConnectivityManager.TYPE_WIFI) {
-                // connected to wifi
+            if (netInfo != null && (netInfo.getType() == ConnectivityManager.TYPE_WIFI || netInfo.getType() == ConnectivityManager.TYPE_ETHERNET)) {
+                // connected to wifi or eth
                 ftpBtn.setEnabled(true);
             } else {
-                // wifi connection lost
+                // wifi or eth connection lost
                 stopServer();
                 statusText.setText(spannedStatusNoConnection);
                 ftpBtn.setEnabled(true);
@@ -421,7 +423,7 @@
     private void updateStatus() {
 
         if (!FTPService.isRunning()) {
-            if (!FTPService.isConnectedToWifi(getContext())) {
+            if (!FTPService.isConnectedToWifi(getContext()) && !FTPService.isConnectedToLocalNetwork(getContext())) {
                 statusText.setText(spannedStatusNoConnection);
                 ftpBtn.setEnabled(false);
             } else {
@@ -496,7 +498,11 @@
      * @return address at which server is running
      */
     private String getFTPAddressString() {
-        return ""ftp://"" + FTPService.getLocalInetAddress(getContext()).getHostAddress() + "":"" + FTPService.getPort();
+        String hostAddress = """";
+        InetAddress ia = FTPService.getLocalInetAddress(getContext());
+        if (ia != null)
+            hostAddress = ia.getHostAddress();
+        return ""ftp://"" + hostAddress  + "":"" + FTPService.getPort();
     }
 
     private int getDefaultPortFromPreferences() {",0
Fix compile error caused by merge 924393a,"   public void setForceRecompile(boolean forceRecompile) {
     this.forceRecompile = forceRecompile;
   }
-  
-  public void setAngularPass(boolean angularPass) {
-    this.angularPass = angularPass;
-  }
 
   public void setAngularPass(boolean angularPass) {
     this.angularPass = angularPass;",0
Fix golong gen return type bug - closes #610,"             ""\nfunc (*%1$s) SbeTemplateId() (templateId %4$s) {\n"" +
             ""\treturn %5$s\n"" +
             ""}\n"" +
-            ""\nfunc (*1$s) SbeSchemaId() (schemaId %6$s) {\n"" +
+            ""\nfunc (*%1$s) SbeSchemaId() (schemaId %6$s) {\n"" +
             ""\treturn %7$s\n"" +
             ""}\n"" +
             ""\nfunc (*%1$s) SbeSchemaVersion() (schemaVersion %8$s) {\n"" +",0
Fix high latency of multipart requests," import java.io.InputStream;
 import java.io.RandomAccessFile;
 import java.nio.ByteBuffer;
-import java.nio.channels.FileChannel;
-import java.nio.channels.WritableByteChannel;
+import java.nio.channels.*;
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Set;
 
 public class MultipartBody implements RandomAccessBody {
 
@@ -569,6 +569,30 @@
         int maxSpin = 0;
         synchronized (byteWriter) {
             ByteBuffer message = ByteBuffer.wrap(byteWriter.toByteArray());
+
+            if (target instanceof SocketChannel) {
+                final Selector selector = Selector.open();
+                try {
+                    final SocketChannel channel = (SocketChannel) target;
+                    channel.register(selector, SelectionKey.OP_WRITE);
+
+                    while (written < byteWriter.size() && selector.select() != 0) {
+                        final Set<SelectionKey> selectedKeys = selector.selectedKeys();
+
+                        for (SelectionKey key : selectedKeys) {
+                            if (key.isWritable()) {
+                                written += target.write(message);
+                            }
+                        }
+                    }
+
+                    if (written < byteWriter.size()) {
+                        throw new IOException(""Unable to write on channel "" + target);
+                    }
+                } finally {
+                    selector.close();
+                }
+            } else {
             while ((target.isOpen()) && (written < byteWriter.size())) {
                 long nWrite = target.write(message);
                 written += nWrite;
@@ -587,6 +611,7 @@
                 }
             }
         }
+        }
         return written;
     }
 ",0
[CLEANUP] Add null check to fix unit tests,"     trimType = getTrimTypeByCode( XMLHandler.getTagValue( node, ""trim_type"" ) );
     caseInsensitive = ""Y"".equalsIgnoreCase( XMLHandler.getTagValue( node, ""case_insensitive"" ) );
     collatorDisabled = ""Y"".equalsIgnoreCase( XMLHandler.getTagValue( node, ""collator_disabled"" ) );
+    if ( XMLHandler.getTagValue( node, ""collator_strength"" ) != null ) {
     collatorStrength = Integer.parseInt( XMLHandler.getTagValue( node, ""collator_strength"" ) );
+    }
     sortedDescending = ""Y"".equalsIgnoreCase( XMLHandler.getTagValue( node, ""sort_descending"" ) );
     outputPaddingEnabled = ""Y"".equalsIgnoreCase( XMLHandler.getTagValue( node, ""output_padding"" ) );
     dateFormatLenient = ""Y"".equalsIgnoreCase( XMLHandler.getTagValue( node, ""date_format_lenient"" ) );",0
Fix Html serialization," package org.graylog2.restclient.models;
 
 import com.google.common.collect.Lists;
-import org.graylog2.restclient.lib.Tools;
 import org.apache.commons.lang3.StringEscapeUtils;
-import play.twirl.api.Html;
+import org.graylog2.restclient.lib.Tools;
 
 import java.util.List;
 
@@ -58,14 +57,14 @@
         return value;
     }
 
-    private static Html convertNewlinesToBr(Object fullMessage) {
+    private static String convertNewlinesToBr(Object fullMessage) {
         if (fullMessage == null) {
             return null;
         }
 
         String s = StringEscapeUtils.escapeHtml4(fullMessage.toString());
         s = s.replaceAll(""\\n"", ""<br>"");
-        return Html.apply(s);
+        return s;
     }
 
     private static String mapSyslogLevel(Object level) {",0
TFJ-705 fix bug.,"             completedIn = getDouble(""completed_in"", searchMetaData);
             count = getInt(""count"", searchMetaData);
             maxId = getLong(""max_id"", searchMetaData);
-            nextResults = json.has(""next_results"") ? json.getString(""next_results"") : null;
+            nextResults = searchMetaData.has(""next_results"") ? searchMetaData.getString(""next_results"") : null;
             query = getURLDecodedString(""query"", searchMetaData);
             refreshUrl = getUnescapedString(""refresh_url"", searchMetaData);
             sinceId = getLong(""since_id"", searchMetaData);",0
[android] Cleanup errs from debug output change,"       PwsClient.UrlMetadata urlMetadata = mUrlToUrlMetadata.get(url);
       // If the metadata exists
       if (urlMetadata != null) {
-        Log.d(TAG, url + "" Metadata not null1"");
         // Set the title text
         titleTextView.setText(urlMetadata.title);
         // Set the url text
-        //TODO: urlTextView.setText(urlMetadata.displayUrl);
-        urlTextView.setText(url);
+        urlTextView.setText(urlMetadata.displayUrl);
         // Set the description text
         descriptionTextView.setText(urlMetadata.description);
         // Set the favicon image
@@ -497,7 +495,6 @@
       }
       // If metadata does not yet exist
       else {
-        Log.d(TAG, url + "" Metadata null1"");
         // Clear the children views content (in case this is a recycled list item view)
         titleTextView.setText("""");
         iconImageView.setImageDrawable(null);
@@ -561,7 +558,6 @@
       TextView rankView = (TextView) view.findViewById(R.id.metadata_debug_rank);
       TextView pwsTripTimeView = (TextView) view.findViewById(R.id.metadata_debug_pws_trip_time);
       if (metadata != null) {
-        Log.d(TAG, url + "" Metadata not null2"");
         float rank = metadata.rank;
         String rankString = getString(R.string.metadata_debug_rank_prefix)
             + new DecimalFormat(""##.##"").format(rank);",0
Fixes the blocker #2913," import org.terasology.logic.inventory.ItemComponent;
 import org.terasology.logic.location.LocationComponent;
 import org.terasology.math.geom.Vector3f;
-import org.terasology.math.geom.Vector3i;
 import org.terasology.network.ClientComponent;
 import org.terasology.network.NetworkSystem;
 import org.terasology.physics.CollisionGroup;
@@ -127,20 +126,16 @@
         OnItemUseEvent onItemUseEvent = new OnItemUseEvent();
         character.send(onItemUseEvent);
         if (!onItemUseEvent.isConsumed()) {
-            // It would seem to make more sense to just call getTargetBlock() and get the entity here, but that causes
-            // a NPE up in the EntityRef.
-            EntityRef targetEntity = targetSystem.getTarget();
-            if (targetEntity.exists()) {
-                targetEntity.send(new AttackEvent(character, event.getItem()));
-                return;
-            }
+            EntityRef gazeEntity = GazeAuthoritySystem.getGazeEntityForCharacter(character);
+            LocationComponent gazeLocation = gazeEntity.getComponent(LocationComponent.class);
+            Vector3f direction = gazeLocation.getWorldDirection();
+            Vector3f originPos = gazeLocation.getWorldPosition();
 
-            Vector3i position = targetSystem.getTargetBlockPosition();
-            if (position == null) {
-                return;
+            HitResult result = physics.rayTrace(originPos, direction, characterComponent.interactionRange, Sets.newHashSet(character), DEFAULTPHYSICSFILTER);
+
+            if (result.isHit()) {
+                result.getEntity().send(new AttackEvent(character, event.getItem()));
             }
-            EntityRef targetBlockEntity = blockRegistry.getBlockEntityAt(position);
-            targetBlockEntity.send(new AttackEvent(character, event.getItem()));
         }
     }
 ",0
fix javadoc parameter names,"      *
      * @param algorithm algorithm name.
      * @param secretBytes algorithm secret.
-     * @param header JWT header.
-     * @param payload JWT payload.
+     * @param headerBytes JWT header.
+     * @param payloadBytes JWT payload.
      * @param signatureBytes JWT signature.
      * @return true if signature is valid.
      * @throws NoSuchAlgorithmException if the algorithm is not supported.",0
Fix spelling mistake in invalid scheme exception," 			} else if( scheme.equals( ""ws"" ) ) {
 				return WebSocket.DEFAULT_PORT;
 			} else {
-				throw new RuntimeException( ""unkonow scheme"" + scheme );
+				throw new RuntimeException( ""unknown scheme: "" + scheme );
 			}
 		}
 		return port;",0
Fixed execution of sql batch script when lines ending with \n ,"         if (line == txBegunAtLine)
           // SKIP PREVIOUS COMMAND PART AND JUMP TO THE BEGIN IF ANY
           linePart = txBegunAtPart;
+        else
+          linePart = 0;
 
         for (; linePart < lineParts.size(); ++linePart) {
           final String lastCommand = lineParts.get(linePart);",0
Fixed exception messages in Array,"     @Override
     public Array<T> init() {
         if (isEmpty()) {
-            throw new UnsupportedOperationException(""init of empty vector"");
+            throw new UnsupportedOperationException(""init of empty Array"");
         }
         return dropRight(1);
     }
@@ -764,7 +764,7 @@
     @Override
     public Array<T> insert(int index, T element) {
         if (index < 0 || index > length()) {
-            throw new IndexOutOfBoundsException(""insert("" + index + "", e) on Vector of length "" + length());
+            throw new IndexOutOfBoundsException(""insert("" + index + "", e) on Array of length "" + length());
         }
         final Object[] arr = new Object[delegate.length + 1];
         System.arraycopy(delegate, 0, arr, 0, index);",0
Fix - Selection Mode Default Single," 
             setSelectionMode(a.getInteger(
                 R.styleable.MaterialCalendarView_mcv_selectionMode,
-                SELECTION_MODE_NONE
+                SELECTION_MODE_SINGLE
             ));
 
             final int tileSize = a.getLayoutDimension(R.styleable.MaterialCalendarView_mcv_tileSize, INVALID_TILE_DIMENSION);",0
Fix index stats collection (#5226),"         final long getTotalTimeSeconds = get.path(""total_time_in_millis"").asLong() / 1000L;
 
         final JsonNode indexing = stats.path(""indexing"");
-        final long indexingTotal = indexing.path(""total"").asLong();
-        final long indexingTotalTimeSeconds = indexing.path(""total_time_in_millis"").asLong() / 1000L;
+        final long indexingTotal = indexing.path(""index_total"").asLong();
+        final long indexingTotalTimeSeconds = indexing.path(""index_time_in_millis"").asLong() / 1000L;
 
-        final JsonNode merge = stats.path(""merge"");
+        final JsonNode merge = stats.path(""merges"");
         final long mergeTotal = merge.path(""total"").asLong();
         final long mergeTotalTimeSeconds = merge.path(""total_time_in_millis"").asLong() / 1000L;
 ",0
Remove nulling ThreadLocal since it's already WeakReference,"     public UserWithTweets mapFromCursor(@NonNull Cursor cursor) {
         final StorIOSQLite storIOSQLite = storIOSQLiteFromPerformGet.get();
 
-        // BTW, you don't need a transaction here
-        // StorIO will wrap mapFromCursor() into the transaction if needed
-        try {
             // Or you can manually parse cursor (it will be sliiightly faster)
             final User user = userGetResolver.mapFromCursor(cursor);
 
@@ -60,10 +57,6 @@
                     .executeAsBlocking();
 
             return new UserWithTweets(user, tweetsOfTheUser);
-        } finally {
-            // Releasing StorIOSQLite reference
-            storIOSQLiteFromPerformGet.set(null);
-        }
     }
 
     @NonNull",0
fix #320 FluxBufferTimeOrSize concurrently modified buffer," 
 		@Override
 		protected void checkedError(Throwable ev) {
+			synchronized (this) {
 			C v = values;
 			if(v != null) {
 				v.clear();
 				values = null;
 			}
+			}
 			subscriber.onError(ev);
 		}
 
 		@Override
 		public void nextCallback(T value) {
+			synchronized (this) {
 			C v = values;
 			if(v == null) {
 				v = bufferSupplier.get();
@@ -89,12 +92,20 @@
 			}
 			v.add(value);
 		}
+		}
 
 		@Override
 		public void flushCallback(T ev) {
 			C v = values;
+			boolean flush = false;
+			synchronized (this) {
 			if(v != null && !v.isEmpty()) {
 				values = bufferSupplier.get();
+					flush = true;
+				}
+			}
+
+			if (flush) {
 				subscriber.onNext(v);
 			}
 		}",0
Fixed Honeycomb crash,"-
 package org.holoeverywhere.widget;
 
 import android.annotation.SuppressLint;
@@ -368,6 +367,7 @@
             mNeedSync = false;
             checkSelectionChanged();
         }
+		if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH)
         ReflectHelper.invoke(this, ""notifyAccessibilityStateChanged"", null);
     }
 ",0
BasicSemanticChecks.checkGrammarName: allow null filenames.," 
 	void checkGrammarName(Token nameToken) {
 		String fullyQualifiedName = nameToken.getInputStream().getSourceName();
+		if (fullyQualifiedName == null) {
+			// This wasn't read from a file.
+			return;
+		}
+
 		File f = new File(fullyQualifiedName);
 		String fileName = f.getName();
 		if ( g.originalGrammar!=null ) return; // don't warn about diff if this is implicit lexer",0
Fix an exception caused by attempting to load an empty filename," 
 import static com.google.common.base.Preconditions.checkNotNull;
 import static com.google.common.base.Preconditions.checkState;
+import static com.google.common.base.Strings.isNullOrEmpty;
 import static com.google.javascript.jscomp.parsing.parser.FeatureSet.ES8_MODULES;
 
 import com.google.common.annotations.GwtIncompatible;
@@ -2938,7 +2939,7 @@
     String relativePath = resolveSibling(sourceMapOriginalPath, resultOriginalPath);
 
     SourceFile source = getSourceFileByName(relativePath);
-    if (source == null) {
+    if (source == null && !isNullOrEmpty(resultOriginalPath)) {
       source =
           SourceMapResolver.getRelativePath(sourceMap.getOriginalPath(), result.getOriginalFile());
       if (source != null) {",0
fix MultiBufferBatchEventProcessor endOfBatch handling bug,"         }
 
         final int barrierLength = barriers.length;
-        final long[] lastConsumed = new long[barrierLength];
-        fill(lastConsumed, -1L);
 
         while (true)
         {
@@ -69,16 +67,16 @@
                     long available = barriers[i].waitFor(-1);
                     Sequence sequence = sequences[i];
 
-                    long previous = sequence.get();
+                    long nextSequence = sequence.get() + 1;
 
-                    for (long l = previous + 1; l <= available; l++)
+                    for (long l = nextSequence; l <= available; l++)
                     {
-                        handler.onEvent(providers[i].get(l), l, previous == available);
+                        handler.onEvent(providers[i].get(l), l, nextSequence == available);
                     }
 
                     sequence.set(available);
 
-                    count += (available - previous);
+                    count += available - nextSequence + 1;
                 }
 
                 Thread.yield();",0
ammo: fix weapon check," 	{
 		// Check for weapon slot items. This overrides the ammo slot,
 		// as the player will use the thrown weapon (eg. chinchompas, knives, darts)
-		if (items.length >= EquipmentInventorySlot.WEAPON.getSlotIdx() - 1)
+		if (items.length > EquipmentInventorySlot.WEAPON.getSlotIdx())
 		{
 			final Item weapon = items[EquipmentInventorySlot.WEAPON.getSlotIdx()];
 			final ItemComposition weaponComp = itemManager.getItemComposition(weapon.getId());",0
Fix nil pointer exception in zkSerialize," public class StringSerializer extends SerializableSerializer {
     @Override
     public Object deserialize(byte[] bytes) throws ZkMarshallingError {
+        if (bytes == null){
+            return null;
+        }
         try {
-            if (ByteUtil.bytes2short(bytes, 0) == ObjectStreamConstants.STREAM_MAGIC) {
+            if (bytes.length > 1 && ByteUtil.bytes2short(bytes, 0) == ObjectStreamConstants.STREAM_MAGIC) {
                 return super.deserialize(bytes);
             }
             return new String(bytes, ""UTF-8"");",0
cell remove fix,"         // allow the UI to grow or shrink the cell count if the inventory changes size
         if (numSlots < cells.size()) {
             for (int i = cells.size(); i > numSlots && i > 0; --i) {
-                cells.remove(i);
+                cells.remove(i - 1);
             }
         } else if (numSlots > cells.size()) {
             for (int i = cells.size(); i < numSlots && i < getMaxCellCount(); ++i) {",0
Shadow Map FBO Initialization Bug,"             bufferIds.put(EXTFramebufferObject.GL_COLOR_ATTACHMENT1_EXT);
         }
         bufferIds.flip();
+        if (bufferIds.limit() == 0) {
+            if (depth && type == FBOType.FBOT_NO_COLOR) {
+                GL11.glReadBuffer(GL11.GL_NONE);
+            }
+            GL20.glDrawBuffers(GL11.GL_NONE);
+        } else {
         GL20.glDrawBuffers(bufferIds);
+        }
 
         int checkFB = EXTFramebufferObject.glCheckFramebufferStatusEXT(EXTFramebufferObject.GL_FRAMEBUFFER_EXT);
         switch (checkFB) {",0
Fix HTTP 100 handling in http inputs (#5725)," 
         handlers.put(""decoder"", () -> new HttpRequestDecoder(DEFAULT_MAX_INITIAL_LINE_LENGTH, DEFAULT_MAX_HEADER_SIZE, maxChunkSize));
         handlers.put(""decompressor"", HttpContentDecompressor::new);
-        handlers.put(""aggregator"", () -> new HttpObjectAggregator(maxChunkSize));
         handlers.put(""encoder"", HttpResponseEncoder::new);
+        handlers.put(""aggregator"", () -> new HttpObjectAggregator(maxChunkSize));
         handlers.put(""http-handler"", () -> new HttpHandler(enableCors));
         handlers.putAll(super.getCustomChildChannelHandlers(input));
 ",0
Fix a typo in ObjectEchoClientHandler," 
     @Override
     public void messageReceived(ChannelHandlerContext ctx, List<Integer> msg) throws Exception {
-        // Echo back the received object to the client.
+        // Echo back the received object to the server.
         ctx.write(msg);
     }
 ",0
Fix duplicate raging/monitoring callbacks,"             LogManager.w(TAG, ""Not supported prior to API 18."");
             return;
         }
+        if (mBeaconNotificationProcessor != null) {
+            mBeaconNotificationProcessor.unregister();
+        }
         stopForeground(true);
         bluetoothCrashResolver.stop();
         LogManager.i(TAG, ""onDestroy called.  stopping scanning"");",0
Fixed OfferPriceData matching process to correctly evaluate SKU_EXTERNAL_ID,"                     && Objects.equals(Long.valueOf(offerPriceData.getIdentifierValue()), doi.getSku().getId()))
                     || (offerPriceData.getIdentifierType().equals(OfferPriceDataIdentifierType.PRODUCT_EXTERNAL_ID)
                     && Objects.equals(String.valueOf(offerPriceData.getIdentifierValue()), doi.getProduct().getExternalId()))
-                    || (offerPriceData.getIdentifierType().equals(OfferPriceDataIdentifierType.PRODUCT_ID)
+                    || (offerPriceData.getIdentifierType().equals(OfferPriceDataIdentifierType.SKU_EXTERNAL_ID)
                     && Objects.equals(String.valueOf(offerPriceData.getIdentifierValue()), doi.getSku().getExternalId()))) {
                 return true;
             }",0
Fix warnings in FileCollectSource," package io.crate.execution.engine.collect.sources;
 
 import io.crate.analyze.CopyFromAnalyzedStatement;
-import io.crate.execution.engine.collect.CollectTask;
-import io.crate.expression.symbol.Symbol;
-import io.crate.expression.symbol.ValueSymbolVisitor;
-import io.crate.data.RowConsumer;
 import io.crate.data.BatchIterator;
-import io.crate.metadata.Functions;
-import io.crate.expression.InputFactory;
+import io.crate.data.Row;
+import io.crate.data.RowConsumer;
+import io.crate.execution.dsl.phases.CollectPhase;
+import io.crate.execution.dsl.phases.FileUriCollectPhase;
 import io.crate.execution.engine.collect.BatchIteratorCollectorBridge;
+import io.crate.execution.engine.collect.CollectTask;
 import io.crate.execution.engine.collect.CrateCollector;
 import io.crate.execution.engine.collect.files.FileInputFactory;
 import io.crate.execution.engine.collect.files.FileReadingIterator;
 import io.crate.execution.engine.collect.files.LineCollectorExpression;
+import io.crate.expression.InputFactory;
 import io.crate.expression.reference.file.FileLineReferenceResolver;
-import io.crate.execution.dsl.phases.CollectPhase;
-import io.crate.execution.dsl.phases.FileUriCollectPhase;
+import io.crate.expression.symbol.Symbol;
+import io.crate.expression.symbol.ValueSymbolVisitor;
+import io.crate.metadata.Functions;
 import io.crate.types.CollectionType;
 import io.crate.types.DataTypes;
 import org.elasticsearch.cluster.service.ClusterService;
@@ -44,6 +45,7 @@
 import org.elasticsearch.common.inject.Singleton;
 
 import java.util.Arrays;
+import java.util.Collection;
 import java.util.Collections;
 import java.util.List;
 import java.util.Map;
@@ -69,27 +71,29 @@
             inputFactory.ctxForRefs(FileLineReferenceResolver::getImplementation);
         ctx.add(collectPhase.toCollect());
 
-        String[] readers = fileUriCollectPhase.nodeIds().toArray(
-            new String[fileUriCollectPhase.nodeIds().size()]);
-        Arrays.sort(readers);
-
         List<String> fileUris;
         fileUris = targetUriToStringList(fileUriCollectPhase.targetUri());
-        BatchIterator fileReadingIterator = FileReadingIterator.newInstance(
+        BatchIterator<Row> fileReadingIterator = FileReadingIterator.newInstance(
             fileUris,
             ctx.topLevelInputs(),
             ctx.expressions(),
             fileUriCollectPhase.compression(),
             fileInputFactoryMap,
             fileUriCollectPhase.sharedStorage(),
-            readers.length,
-            Arrays.binarySearch(readers, clusterService.state().nodes().getLocalNodeId()),
+            fileUriCollectPhase.nodeIds().size(),
+            getReaderNumber(fileUriCollectPhase.nodeIds(), clusterService.state().nodes().getLocalNodeId()),
             fileUriCollectPhase.inputFormat()
         );
 
         return BatchIteratorCollectorBridge.newInstance(fileReadingIterator, consumer);
     }
 
+    private static int getReaderNumber(Collection<String> nodeIds, String localNodeId) {
+        String[] readers = nodeIds.toArray(new String[0]);
+        Arrays.sort(readers);
+        return Arrays.binarySearch(readers, localNodeId);
+    }
+
     private static List<String> targetUriToStringList(Symbol targetUri) {
         if (targetUri.valueType() == DataTypes.STRING) {
             return Collections.singletonList(ValueSymbolVisitor.STRING.process(targetUri));",0
fix path in description,"             name = ""save-result"",
             summary = ""Option to print command's result to log file"",
             description = ""This option enables to save each command's result to log file, "" +
-                    ""which path is ${user.home}/logs/arthas/result.log.""
+                    ""which path is ${user.home}/logs/arthas-cache/result.log.""
     )
     public static volatile boolean isSaveResult = false;
 ",0
Fix a NPE when the 'properties' element is missing from the form's JSON,"                 logRotator = null;
 
             DescribableList<JobProperty<?>, JobPropertyDescriptor> t = new DescribableList<JobProperty<?>, JobPropertyDescriptor>(NOOP,getAllProperties());
-            t.rebuild(req,json.optJSONObject(""properties""),JobPropertyDescriptor.getPropertyDescriptors(Job.this.getClass()));
+            JSONObject jsonProperties = json.optJSONObject(""properties"");
+            if (jsonProperties != null) {
+              t.rebuild(req,jsonProperties,JobPropertyDescriptor.getPropertyDescriptors(Job.this.getClass()));
+            } else {
+              t.clear();
+            }
             properties.clear();
             for (JobProperty p : t) {
                 p.setOwner(this);",0
Npc indicators fix," import net.runelite.api.events.MenuOptionClicked;
 import net.runelite.api.events.NpcDespawned;
 import net.runelite.api.events.NpcSpawned;
+import net.runelite.client.callback.ClientThread;
 import net.runelite.client.config.ConfigManager;
 import net.runelite.client.input.KeyManager;
 import net.runelite.client.menus.MenuManager;
@@ -96,6 +97,9 @@
 	@Inject
 	private KeyManager keyManager;
 
+	@Inject
+	private ClientThread clientThread;
+
 	/**
 	 * NPCs to highlight
 	 */
@@ -172,7 +176,11 @@
 	{
 		keyManager.registerKeyListener(inputListener);
 		highlights = getHighlights();
+		clientThread.invokeLater(() ->
+		{
+			skipNextSpawnCheck = true;
 		rebuildAllNpcs();
+		});
 	}
 
 	@Override
@@ -412,6 +420,14 @@
 	{
 		highlightedNpcs.clear();
 
+		if (client.getGameState() != GameState.LOGGED_IN &&
+			client.getGameState() != GameState.LOADING)
+		{
+			// NPCs are still in the client after logging out,
+			// but we don't want to highlight those.
+			return;
+		}
+
 		outer:
 		for (NPC npc : client.getNpcs())
 		{
@@ -490,7 +506,7 @@
 					}
 				}
 
-				if (isInViewRange(lastPlayerLocation, npc.getWorldLocation()))
+				if (lastPlayerLocation != null && isInViewRange(lastPlayerLocation, npc.getWorldLocation()))
 				{
 					final MemorizedNpc mn = memorizedNpcs.get(npc.getIndex());
 ",0
using == to compare two Integer values," //                            prevDelay = Math.max(minDelay, prevDelay/2);
 //                        }
 
-                        if (sizeHistory.peekFirst() == sizeHistory.peekLast()
-                                && sizeHistory.peekLast() == size) {
+                        if (sizeHistory.peekFirst().intValue() == sizeHistory.peekLast()
+                                && sizeHistory.peekLast().intValue() == size) {
                             if (size == keysLimit) {
                                 delay = Math.max(minDelay, delay/4);
                             }",0
Fix incorrect order in search for class.,"             }
         }
 
+        // Look in current package
+        if (this.wrappedNode.getPackageDeclaration().isPresent()) {
+            String qName = this.wrappedNode.getPackageDeclaration().get().getName().toString() + ""."" + name;
+            SymbolReference<ResolvedReferenceTypeDeclaration> ref = typeSolver.tryToSolveType(qName);
+            if (ref != null && ref.isSolved()) {
+                return SymbolReference.adapt(ref, ResolvedTypeDeclaration.class);
+            }
+        } else {
+            // look for classes in the default package
+            String qName = name;
+            SymbolReference<ResolvedReferenceTypeDeclaration> ref = typeSolver.tryToSolveType(qName);
+            if (ref != null && ref.isSolved()) {
+                return SymbolReference.adapt(ref, ResolvedTypeDeclaration.class);
+            }
+        }
+
         if (wrappedNode.getImports() != null) {
             int dotPos = name.indexOf('.');
             String prefix = null;
@@ -169,22 +185,6 @@
             }
         }
 
-        // Look in current package
-        if (this.wrappedNode.getPackageDeclaration().isPresent()) {
-            String qName = this.wrappedNode.getPackageDeclaration().get().getName().toString() + ""."" + name;
-            SymbolReference<ResolvedReferenceTypeDeclaration> ref = typeSolver.tryToSolveType(qName);
-            if (ref.isSolved()) {
-                return SymbolReference.adapt(ref, ResolvedTypeDeclaration.class);
-            }
-        } else {
-            // look for classes in the default package
-            String qName = name;
-            SymbolReference<ResolvedReferenceTypeDeclaration> ref = typeSolver.tryToSolveType(qName);
-            if (ref.isSolved()) {
-                return SymbolReference.adapt(ref, ResolvedTypeDeclaration.class);
-            }
-        }
-
         // Look in the java.lang package
         SymbolReference<ResolvedReferenceTypeDeclaration> ref = typeSolver.tryToSolveType(""java.lang."" + name);
         if (ref.isSolved()) {",0
Fixed crash when the listview has footerViews,"         int position = pointToPosition(mDownX, mDownY);
         int itemNum = position - getFirstVisiblePosition();
         View selectedView = getChildAt(itemNum);
-        if (selectedView == null || position < getHeaderViewsCount() || position >= getAdapter().getCount() - getHeaderViewsCount()) {
+        if (selectedView == null || position < getHeaderViewsCount() || position >= getAdapter().getCount() - getHeaderViewsCount() - getFooterViewsCount()) {
             return;
         }
 ",0
Changing addresses from a taxable address to a non-taxable address still retains original tax," import org.apache.commons.lang.StringUtils;
 import org.broadleafcommerce.common.config.domain.ModuleConfiguration;
 import org.broadleafcommerce.common.i18n.domain.ISOCountry;
+import org.broadleafcommerce.common.money.Money;
 import org.broadleafcommerce.common.persistence.EntityConfiguration;
 import org.broadleafcommerce.core.order.domain.FulfillmentGroup;
 import org.broadleafcommerce.core.order.domain.FulfillmentGroupFee;
@@ -33,6 +34,7 @@
 import org.broadleafcommerce.profile.core.domain.State;
 
 import java.math.BigDecimal;
+import java.util.List;
 import java.util.Map;
 
 import javax.annotation.Resource;
@@ -85,74 +87,61 @@
     public Order calculateTaxForOrder(Order order, ModuleConfiguration config) throws TaxException {
         if (!order.getCustomer().isTaxExempt()) {
             for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {
-                // Set taxes on the fulfillment group items
-                for (FulfillmentGroupItem fgItem : fulfillmentGroup.getFulfillmentGroupItems()) {
-                    if (isItemTaxable(fgItem)) {
-                        BigDecimal factor = determineItemTaxRate(fulfillmentGroup.getAddress());
-                        if (factor != null && factor.compareTo(BigDecimal.ZERO) != 0) {
-                            TaxDetail tax;
-                            checkDetail: {
-                                for (TaxDetail detail : fgItem.getTaxes()) {
-                                    if (detail.getType().equals(TaxType.COMBINED)) {
-                                        tax = detail;
-                                        break checkDetail;
-                                    }
-                                }
-                                tax = entityConfig.createEntityInstance(TaxDetail.class.getName(), TaxDetail.class);
-                                tax.setType(TaxType.COMBINED);
-                                fgItem.getTaxes().add(tax);
-                            }
-                            tax.setRate(factor);
-                            tax.setAmount(fgItem.getTotalItemTaxableAmount().multiply(factor));
-                        }
-                    }
-                }
-    
-                for (FulfillmentGroupFee fgFee : fulfillmentGroup.getFulfillmentGroupFees()) {
-                    if (isFeeTaxable(fgFee)) {
-                        BigDecimal factor = determineItemTaxRate(fulfillmentGroup.getAddress());
-                        if (factor != null && factor.compareTo(BigDecimal.ZERO) != 0) {
-                            TaxDetail tax;
-                            checkDetail: {
-                                for (TaxDetail detail : fgFee.getTaxes()) {
-                                    if (detail.getType().equals(TaxType.COMBINED)) {
-                                        tax = detail;
-                                        break checkDetail;
-                                    }
-                                }
-                                tax = entityConfig.createEntityInstance(TaxDetail.class.getName(), TaxDetail.class);
-                                tax.setType(TaxType.COMBINED);
-                                fgFee.getTaxes().add(tax);
-                            }
-                            tax.setRate(factor);
-                            tax.setAmount(fgFee.getAmount().multiply(factor));
-                        }
-                    }
-                }
-    
-                BigDecimal factor = determineTaxRateForFulfillmentGroup(fulfillmentGroup);
-                if (factor != null && factor.compareTo(BigDecimal.ZERO) != 0) {
-                    TaxDetail tax;
-                    checkDetail: {
-                        for (TaxDetail detail : fulfillmentGroup.getTaxes()) {
-                            if (detail.getType().equals(TaxType.COMBINED)) {
-                                tax = detail;
-                                break checkDetail;
-                            }
-                        }
-                        tax = entityConfig.createEntityInstance(TaxDetail.class.getName(), TaxDetail.class);
-                        tax.setType(TaxType.COMBINED);
-                        fulfillmentGroup.getTaxes().add(tax);
-                    }
-                    tax.setRate(factor);
-                    tax.setAmount(fulfillmentGroup.getFulfillmentPrice().multiply(factor));
-                }
+                handleFulfillmentGroupItemTaxes(fulfillmentGroup);
+                handleFulfillmentGroupFeeTaxes(fulfillmentGroup);
+                handleFulfillmentGroupTaxes(fulfillmentGroup);
             }
         }
 
         return order;
     }
 
+    protected void handleFulfillmentGroupItemTaxes(FulfillmentGroup fulfillmentGroup) {
+        for (FulfillmentGroupItem fgItem : fulfillmentGroup.getFulfillmentGroupItems()) {
+            if (isItemTaxable(fgItem)) {
+                applyTaxFactor(fgItem.getTaxes(), determineItemTaxRate(fulfillmentGroup.getAddress()), fgItem.getTotalItemTaxableAmount());
+            }
+        }
+    }
+
+    protected void handleFulfillmentGroupFeeTaxes(FulfillmentGroup fulfillmentGroup) {
+        for (FulfillmentGroupFee fgFee : fulfillmentGroup.getFulfillmentGroupFees()) {
+            if (isFeeTaxable(fgFee)) {
+                applyTaxFactor(fgFee.getTaxes(), determineItemTaxRate(fulfillmentGroup.getAddress()), fgFee.getAmount());
+            }
+        }
+    }
+
+    protected void handleFulfillmentGroupTaxes(FulfillmentGroup fulfillmentGroup) {
+        applyTaxFactor(fulfillmentGroup.getTaxes(), determineTaxRateForFulfillmentGroup(fulfillmentGroup), fulfillmentGroup.getFulfillmentPrice());
+    }
+
+    protected void applyTaxFactor(List<TaxDetail> taxes, BigDecimal taxFactor, Money taxMultiplier) {
+        TaxDetail tax = findExistingTaxDetail(taxes);
+        boolean shouldUpdateOrCreateTaxRecord = taxFactor != null && taxFactor.compareTo(BigDecimal.ZERO) != 0;
+        boolean shouldRemoveTaxRecord = (taxFactor == null || taxFactor.compareTo(BigDecimal.ZERO) == 0) && tax != null;
+        if (shouldUpdateOrCreateTaxRecord) {
+            if (tax == null) {
+                tax = entityConfig.createEntityInstance(TaxDetail.class.getName(), TaxDetail.class);
+                tax.setType(TaxType.COMBINED);
+                taxes.add(tax);
+            }
+            tax.setRate(taxFactor);
+            tax.setAmount(taxMultiplier.multiply(taxFactor));
+        } else if (shouldRemoveTaxRecord) {
+            taxes.remove(tax);
+        }
+    }
+
+    protected TaxDetail findExistingTaxDetail(List<TaxDetail> taxes) {
+        for (TaxDetail detail : taxes) {
+            if (detail.getType().equals(TaxType.COMBINED)) {
+                return detail;
+            }
+        }
+        return null;
+    }
+
     @Override
     public Order commitTaxForOrder(Order order, ModuleConfiguration config) throws TaxException {
         // intentionally left blank; no tax needs to be committed as this already has the tax details on the order",0
"Revert ""Fix app crash on enabling FTP service""","         notificationIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
         PendingIntent contentIntent = PendingIntent.getActivity(context, 0, notificationIntent, 0);
 
-        Notification.Builder notificationBuilder = new Notification.Builder(context)
+        Notification.Builder notificationBuilder = new Notification.Builder(context, NotificationConstants.CHANNEL_NORMAL_ID)
                 .setContentTitle(contentTitle)
                 .setContentText(contentText)
                 .setContentIntent(contentIntent)
@@ -72,9 +72,6 @@
                 .setWhen(when)
                 .setOngoing(true);
 
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O)
-            notificationBuilder.setChannelId(NotificationConstants.CHANNEL_NORMAL_ID);
-
         Notification notification;
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             notificationBuilder.setVisibility(Notification.VISIBILITY_PUBLIC);",0
[REVIEW] Fix DaggerGraph against updated snapshot,"     public final static class Initializer {
 
         public static Graph init() {
-            return Dagger_Graph.builder()
+            return DaggerGraph.builder()
                     .build();
         }
     }",0
Fix bad error message," 
             Type baseType = process(node.getBase(), context);
             if (!(baseType instanceof RowType)) {
-                throw new SemanticException(SemanticErrorCode.TYPE_MISMATCH, node.getBase(), ""Expression %s is not of type ROW"", node.getBase());
+                throw new SemanticException(TYPE_MISMATCH, node.getBase(), ""Expression %s is not of type ROW"", node.getBase());
             }
 
             RowType rowType = (RowType) baseType;
@@ -330,7 +330,7 @@
             while (qualifiedName.getPrefix().isPresent()) {
                 qualifiedName = qualifiedName.getPrefix().get();
                 List<Field> matches = tupleDescriptor.resolveFields(qualifiedName);
-                if (matches.size() > 0) {
+                if (!matches.isEmpty()) {
                     // The AMBIGUOUS_ATTRIBUTE exception will be thrown later with the right node if matches.size() > 1
                     return;
                 }
@@ -548,6 +548,7 @@
             return VARCHAR;
         }
 
+        @Override
         protected Type visitBinaryLiteral(BinaryLiteral node, StackableAstVisitorContext<AnalysisContext> context)
         {
             expressionTypes.put(node, VARBINARY);
@@ -714,7 +715,7 @@
                 if (node.isDistinct() && !type.isComparable()) {
                     throw new SemanticException(TYPE_MISMATCH, node, ""DISTINCT can only be applied to comparable types (actual: %s)"", type);
                 }
-                coerceType(context, expression, type, String.format(""Function %s argument %d"", function, i));
+                coerceType(context, expression, type, format(""Function %s argument %d"", function, i));
             }
             resolvedFunctions.put(node, function);
 
@@ -869,13 +870,13 @@
                 operatorSignature = functionRegistry.resolveOperator(operatorType, argumentTypes.build());
             }
             catch (OperatorNotFoundException e) {
-                throw new SemanticException(TYPE_MISMATCH, node, e.getMessage());
+                throw new SemanticException(TYPE_MISMATCH, node, ""%s"", e.getMessage());
             }
 
             for (int i = 0; i < arguments.length; i++) {
                 Expression expression = arguments[i];
                 Type type = typeManager.getType(operatorSignature.getArgumentTypes().get(i));
-                coerceType(context, expression, type, String.format(""Operator %s argument %d"", operatorSignature, i));
+                coerceType(context, expression, type, format(""Operator %s argument %d"", operatorSignature, i));
             }
 
             Type type = typeManager.getType(operatorSignature.getReturnType());",0
Properly close input streams in the applicationContext merge process,"         }
     }
 
-    private void removeSkippedMergeComponents(Properties props) {
-        InputStream inputStream = this.getClass().getClassLoader()
+    private void removeSkippedMergeComponents(Properties props)
+            throws UnsupportedEncodingException {
+        InputStream inputStream = null;
+        InputStreamReader inputStreamReader = null;
+        BufferedReader bufferedReader = null;
+        try {
+            inputStream = this.getClass().getClassLoader()
                 .getResourceAsStream(""/broadleaf-commmerce/skipMergeComponents.txt"");
 
-        if (inputStream != null) {
+            if (inputStream == null) {
+                return;
+            }
+
             if (LOG.isDebugEnabled()) {
                 LOG.debug(""mergeClassOverrides file found."");
             }
 
-            final InputStreamReader inputStreamReader = new InputStreamReader(inputStream);
-            final BufferedReader bufferedReader = new BufferedReader(inputStreamReader);
+            inputStreamReader = new InputStreamReader(inputStream, ""UTF-8"");
+            bufferedReader = new BufferedReader(inputStreamReader);
 
-            try {
-                while (bufferedReader.ready())
-                {
-                    String line = bufferedReader.readLine();
+            String line;
+            while ((line = bufferedReader.readLine()) != null) {
                     if (LOG.isDebugEnabled()) {
-                        LOG.debug(""mergeComponentOverrides - overridding "" + line);
+                    LOG.debug(""mergeComponentOverrides - overridding ""
+                            + line);
                     }
                     removeSkipMergeComponents(props, line);
                 }
             } catch (IOException e) {
                 LOG.error(""Error reading resource - /broadleaf-commmerce/skipMergeComponents.txt"", e);
             } finally {
+            if (inputStream != null) {
+                try {
+                    inputStream.close();
+                } catch (IOException e) {
+                    LOG.error(""Error closing resource - /broadleaf-commmerce/skipMergeComponents.txt"", e);
+                }
+            }
+            if (inputStreamReader != null) {
+                try {
+                    inputStreamReader.close();
+                } catch (IOException e) {
+                    LOG.error(""Error closing resource - /broadleaf-commmerce/skipMergeComponents.txt"", e);
+                }
+            }
+            if (bufferedReader != null) {
                 try {
                     bufferedReader.close();
-                } catch (IOException ioe) {
-                    LOG.error(""Error closing resource - /broadleaf-commmerce/skipMergeComponents.txt"", ioe);
+                } catch (IOException e) {
+                    LOG.error(""Error closing resource - /broadleaf-commmerce/skipMergeComponents.txt"", e);
                 }
             }
         }",0
nested-loop: Fix pause/resume handling on left-join null emit,"                                     if (tryFinish()) {
                                         return;
                                     }
+                                    if (left.upstreamFinished) {
+                                        // empty left table + right or full join -> ""post-loop"" iterate over right again and emit null-rows
+                                        assert emitRightJoin :
+                                            ""emitRightJoin must be true if tryFinish didn't return true and left upstream is finished as well"";
+                                        switchTo(right.resumeable);
+                                    } else {
                                     switchTo(left.resumeable);
                                 }
+                                }
                             });
                             // return without setting upstreamFinished=true to ensure left-side get's paused (if it isn't already)
                             // this way the resumeHandle call can un-pause it
+                            right.upstreamFinished  = false;
                             return;
                         case STOP:
                             stop = true;",0
Properly deobfuscate lambda expressions," 
 import org.objectweb.asm.ClassVisitor;
 import org.objectweb.asm.FieldVisitor;
+import org.objectweb.asm.Handle;
 import org.objectweb.asm.MethodVisitor;
 import org.objectweb.asm.Opcodes;
+import org.objectweb.asm.Type;
 import org.objectweb.asm.commons.Remapper;
 import org.objectweb.asm.commons.RemappingClassAdapter;
 import org.objectweb.asm.commons.RemappingMethodAdapter;
 
+import java.util.Arrays;
+import java.util.List;
+
 public class FMLRemappingAdapter extends RemappingClassAdapter {
     public FMLRemappingAdapter(ClassVisitor cv)
     {
         super(cv, FMLDeobfuscatingRemapper.INSTANCE);
     }
 
+    private static final List<Handle> META_FACTORIES = Arrays.asList(
+            new Handle(Opcodes.H_INVOKESTATIC, ""java/lang/invoke/LambdaMetafactory"", ""metafactory"",
+                    ""(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;""),
+            new Handle(Opcodes.H_INVOKESTATIC, ""java/lang/invoke/LambdaMetafactory"", ""altMetafactory"",
+                    ""(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;"")
+    );
+
     @Override
     public void visit(int version, int access, String name, String signature, String superName, String[] interfaces)
     {
@@ -89,5 +101,18 @@
                 mv.visitFieldInsn(opcode, type, fieldName, newDesc);
             }
         }
+
+        @Override
+        public void visitInvokeDynamicInsn(String name, String desc, Handle bsm, Object... bsmArgs)
+        {
+            if (META_FACTORIES.contains(bsm))
+            {
+                String owner = Type.getReturnType(desc).getInternalName();
+                String odesc = ((Type) bsmArgs[0]).getDescriptor(); // First constant argument is ""samMethodType - Signature and return type of method to be implemented by the function object.""
+                name = remapper.mapMethodName(owner, name, odesc);
+            }
+
+            super.visitInvokeDynamicInsn(name, desc, bsm, bsmArgs);
+        }
     }
 }",0
Recognize all Pharaoh's sceptre versions for emote clue.," 		new EmoteClue(""Wave in the Falador gem store. Equip a Mithril pickaxe, Black platebody and an Iron Kiteshield."", NEAR_HERQUINS_SHOP_IN_FALADOR, new WorldPoint(2945, 3335, 0), WAVE, item(MITHRIL_PICKAXE), item(BLACK_PLATEBODY), item(IRON_KITESHIELD)),
 		new EmoteClue(""Wave on Mudskipper Point. Equip a black cape, leather chaps and a steel mace."", MUDSKIPPER_POINT, new WorldPoint(2989, 3110, 0), WAVE, item(BLACK_CAPE), item(LEATHER_CHAPS), item(STEEL_MACE)),
 		new EmoteClue(""Wave on the northern wall of Castle Drakan. Beware of double agents! Wear a dragon sq shield, splitbark body and any boater."", NORTHERN_WALL_OF_CASTLE_DRAKAN, new WorldPoint(3560, 3385, 0), WAVE, item(DRAGON_SQ_SHIELD), item(SPLITBARK_BODY), any(""Any boater"", item(RED_BOATER), item(ORANGE_BOATER), item(GREEN_BOATER), item(BLUE_BOATER), item(BLACK_BOATER), item(PINK_BOATER), item(PURPLE_BOATER), item(WHITE_BOATER))),
-		new EmoteClue(""Yawn in the 7th room of Pyramid Plunder. Beware of double agents! Equip a pharaoh sceptre and a full set of menaphite robes."", _7TH_CHAMBER_OF_JALSAVRAH, new WorldPoint(1944, 4427, 0), YAWN, item(PHARAOHS_SCEPTRE_3), any(""Full set of menaphite robes"", all(item(MENAPHITE_PURPLE_HAT), item(MENAPHITE_PURPLE_TOP), range(MENAPHITE_PURPLE_ROBE, MENAPHITE_PURPLE_KILT)), all(item(MENAPHITE_RED_HAT), item(MENAPHITE_RED_TOP), range(MENAPHITE_RED_ROBE, MENAPHITE_RED_KILT)))),
+		new EmoteClue(""Yawn in the 7th room of Pyramid Plunder. Beware of double agents! Equip a pharaoh sceptre and a full set of menaphite robes."", _7TH_CHAMBER_OF_JALSAVRAH, new WorldPoint(1944, 4427, 0), YAWN, any(""Pharaoh's sceptre"", item(PHARAOHS_SCEPTRE), item(PHARAOHS_SCEPTRE_1), item(PHARAOHS_SCEPTRE_2), item(PHARAOHS_SCEPTRE_3), item(PHARAOHS_SCEPTRE_4), item(PHARAOHS_SCEPTRE_5), item(PHARAOHS_SCEPTRE_6), item(PHARAOHS_SCEPTRE_7), item(PHARAOHS_SCEPTRE_8)), any(""Full set of menaphite robes"", all(item(MENAPHITE_PURPLE_HAT), item(MENAPHITE_PURPLE_TOP), range(MENAPHITE_PURPLE_ROBE, MENAPHITE_PURPLE_KILT)), all(item(MENAPHITE_RED_HAT), item(MENAPHITE_RED_TOP), range(MENAPHITE_RED_ROBE, MENAPHITE_RED_KILT)))),
 		new EmoteClue(""Yawn in the Varrock library. Equip a green gnome robe top, HAM robe bottom and an iron warhammer."", VARROCK_PALACE_LIBRARY, new WorldPoint(3209, 3492, 0), YAWN, item(GREEN_ROBE_TOP), item(HAM_ROBE), item(IRON_WARHAMMER)),
 		new EmoteClue(""Yawn in Draynor Marketplace. Equip studded leather chaps, an iron kiteshield and a steel longsword."", DRAYNOR_VILLAGE_MARKET, new WorldPoint(3083, 3253, 0), YAWN, item(STUDDED_CHAPS), item(IRON_KITESHIELD), item(STEEL_LONGSWORD)),
 		new EmoteClue(""Yawn in the Castle Wars lobby. Shrug before you talk to me. Equip a ruby amulet, a mithril scimitar and a Wilderness cape."", CASTLE_WARS_BANK, new WorldPoint(2440, 3092, 0), YAWN, SHRUG, item(RUBY_AMULET), item(MITHRIL_SCIMITAR), range(""Any team cape"", TEAM1_CAPE, TEAM50_CAPE)),",0
Attempt to fix NPE on Galaxy Note 4 5.0.1," 
                         try {
                             if (getScanner() != null) {
-                                getScanner().startScan(new ScanFilterUtils().createScanFiltersForBeaconParsers(
-                                        mBeaconManager.getBeaconParsers()), settings, getNewLeScanCallback());
+                                List scanFilters = new ScanFilterUtils().createScanFiltersForBeaconParsers(
+                                        mBeaconManager.getBeaconParsers());
+                                ScanCallback callback = getNewLeScanCallback();
+                                try {
+                                    getScanner().startScan(scanFilters, settings, callback);
+                                }
+                                catch (NullPointerException npe) {
+                                    LogManager.w(TAG, ""Cannot start scan.  Unexpected NPE."", npe);
+                                }
                             }
                         }
                         catch (IllegalStateException e) {
@@ -192,7 +199,13 @@
         }
         try {
             if (getScanner() != null) {
-                getScanner().startScan(filters, settings, getNewLeScanCallback());
+                ScanCallback callback = getNewLeScanCallback();
+                try {
+                    getScanner().startScan(filters, settings, callback);
+                }
+                catch (NullPointerException npe) {
+                    LogManager.w(TAG, ""Cannot start scan.  Unexpected NPE."", npe);
+                }
             }
         }
         catch (IllegalStateException e) {",0
"Fixes ""top"" positioning"," 
 	private int getHeaderOverlap(int position) {
 		boolean isStartOfSection = isStartOfSection(position);
-		if (!isStartOfSection) {
-			final View header = mAdapter.getView(position, null, mList);
+		if (isStartOfSection) {
+			View header = mAdapter.getHeaderView(position, null, mList);
 			if (header == null) {
 				throw new NullPointerException(""header may not be null"");
 			}",0
Fix an integer overflow bug in the expected max memory allocation,"         this.printExceptionsOnClose = true;
 
         long alignment = swapperFactory.getRequiredBufferAlignment();
-        MemoryManager memoryManager = new MemoryManager( maxPages * cachePageSize, alignment );
+        long expectedMaxMemory = ((long) maxPages) * cachePageSize; // cast to long prevents overflow
+        MemoryManager memoryManager = new MemoryManager( expectedMaxMemory, alignment );
         Object pageList = null;
         int pageIndex = maxPages;
         while ( pageIndex --> 0 )",0
[hotfix] Fix the way proxy propagates auth headers to H2O Node (avoid duplicates)," 
     @Override
     protected void customizeExchange(HttpExchange exchange, HttpServletRequest request) {
-      exchange.addRequestHeader(""Authorization"", _basicAuth);
+      exchange.setRequestHeader(""Authorization"", _basicAuth);
     }
   }
 ",0
Fix to correct handling of lists in plugins," // ZAP: 2016/05/04 Use existing Plugin instances when setting them as completed
 // ZAP: 2016/06/27 Reduce log level when loading the plugins
 // ZAP: 2016/06/29 Do not log when cloning PluginFactory
+// ZAP: 2016/07/25 Fix to correct handling of lists in plugins
 
 package org.parosproxy.paros.core.scanner;
 
@@ -78,13 +79,16 @@
     private List<Plugin> listCompleted = new ArrayList<Plugin>();
     private int totalPluginToRun = 0;
     private boolean init = false;
-    private Configuration config = new HierarchicalConfiguration();
+    private Configuration config;
 
     /**
      *
      */
     public PluginFactory() {
         super();
+        HierarchicalConfiguration configuration = new HierarchicalConfiguration();
+        configuration.setDelimiterParsingDisabled(true);
+        config = configuration;
     }
     
     private static synchronized void initPlugins() {",0
Fixed stack overflow error.,"                 }
             }
             if (cc.getSuperclass() != null) {
-                return isSubtype(cc, parentType);
+                return isSubtype(cc.getSuperclass(), parentType);
             }
         }
         return false;",0
Fix crash when stylesheet text is empty," 
     final String value;
     final String key;
-    if (""/* undefined */"".equals(request.text)) {
-      // This gets sent when a key is disabled. Chrome does not send the key which was disabled
-      // though so not much we can do here.
+    if (request.text == null || !request.text.contains("":"")) {
       key = null;
       value = null;
     } else {",0
"If an exception was thrown in a workflow rollback handler, it is not possible to see what the exception was","                                 errorHandler.handleError(context, th);
                             }
                         } catch (RuntimeException e) {
-                            LOG.error(""An exception was caught while attempting to handle an activity generated exception"", th);
+                            LOG.error(""An exception was caught while attempting to handle an activity generated exception"", e);
                             throw e;
                         } catch (WorkflowException e) {
-                            LOG.error(""An exception was caught while attempting to handle an activity generated exception"", th);
+                            LOG.error(""An exception was caught while attempting to handle an activity generated exception"", e);
                             throw e;
                         }
                     }",0
1847 fix method injection for resources," 
 	protected IJExpression contextRef;
 	protected JMethod init;
+	private JBlock initBodyBeforeInjectionBlock;
 	private JBlock initBodyInjectionBlock;
 	private JBlock initBodyAfterInjectionBlock;
 	private JVar resourcesRef;
@@ -81,7 +82,16 @@
 		return initBodyAfterInjectionBlock;
 	}
 
+	public JBlock getInitBodyBeforeInjectionBlock() {
+		if (initBodyBeforeInjectionBlock == null) {
+			setInitBodyBlocks();
+		}
+
+		return initBodyBeforeInjectionBlock;
+	}
+
 	private void setInitBodyBlocks() {
+		initBodyBeforeInjectionBlock = getInitBody().blockVirtual();
 		initBodyInjectionBlock = getInitBody().blockVirtual();
 		initBodyAfterInjectionBlock = getInitBody().blockVirtual();
 	}
@@ -94,7 +104,7 @@
 	}
 
 	private void setResourcesRef() {
-		resourcesRef = getInitBodyInjectionBlock().decl(getClasses().RESOURCES, ""resources"" + generationSuffix(), getContextRef().invoke(""getResources""));
+		resourcesRef = getInitBodyBeforeInjectionBlock().decl(getClasses().RESOURCES, ""resources"" + generationSuffix(), getContextRef().invoke(""getResources""));
 	}
 
 	public JFieldVar getPowerManagerRef() {",0
Null the reference of the WebSocketImpl," 					} catch(Exception e){
 						log.error(""Error while reading from remote connection"", e);
 					}
-					
 					finally {
+						ws = null;
 						pushBuffer( buf );
 					}
 				}",0
Fix build errors," 		ciphers.remove(""TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"");
 		e.setEnabledCipherSuites( ciphers.toArray( new String[ciphers.size()] ) );
 		e.setUseClientMode( false );
-		return new SSLSocketChannel3( channel, e, exec, key );
+		return new SSLSocketChannel2( channel, e, exec, key );
 	}
 
 	@Override",0
fix TopRowUpstream race condition which can lead to a deadlock,"             } catch (InterruptedException e) {
                 Thread.currentThread().interrupt();
             }
+            // double check after lock has been acquired. Resume could have changed pendingPause before the lock was acquired
+            if (pendingPause) {
             return true;
+            } else {
+                pauseLock.unlock();
+            }
         }
         return false;
     }",0
Bug-fix: incorrect comparison in MeshBuilder," 			rect(i000, i100, i110, i010);
 			rect(i101, i001, i011, i111);
 			index(i000, i001, i010, i011, i110, i111, i100, i101);
-		} else if (primitiveType != GL10.GL_POINTS) {
+		} else if (primitiveType == GL10.GL_POINTS) {
 			ensureRectangleIndices(2);
 			rect(i000, i100, i110, i010);
 			rect(i101, i001, i011, i111);",0
Fixed Javadoc of connecting with timeout function,"      *                         the device is not in range after a 30-second timeout. If true, the connection will be pending indefinitely.
      *                         Unlike the native Android API, if set to true and the connection is lost there will NOT be any attempt to
      *                         reconnect unless explicitly resubscribed.
-     * @param operationTimeout Timeout configuration after which the operation will be considered as broken. Eventually the operation
-     *                         will be canceled and removed from queue. Keep in mind that it will cancel the library's operation
-     *                         only and may leave Android's BLE stack in an inconsistent state.
+     * @param operationTimeout Timeout configuration for operations scheduled using {@link RxBleConnection} emitted from this observable.
+     *                         Those operations will be considered broken after the specified timeout. Keep in mind that after the timeout
+     *                         those operations will be canceled and may leave Android's BLE stack in an inconsistent state.
      * @return Observable emitting the connection.
      * @throws BleDisconnectedException        emitted when the BLE link has been disconnected either when the connection
      *                                         was already established or was in pending connection state. This occurs when the",0
 fix CompletionAdaptor index out of bounds when the token is empty," 
     @Override
     public void complete(List<String> candidates) {
-        String lastToken = tokens.get(tokens.size() - 1).value();
+        String lastToken = tokens.isEmpty() ? null : tokens.get(tokens.size() - 1).value();
         if(StringUtils.isBlank(lastToken)) {
             lastToken = """";
         }",0
Fix termination race condition in OperatorPublish.dispatch,"             try {
                 for (;;) {
                     /*
+                     * We need to read terminalEvent before checking the queue for emptyness because
+                     * all enqueue happens before setting the terminal event.
+                     * If it were the other way around, when the emission is paused between
+                     * checking isEmpty and checking terminalEvent, some other thread might
+                     * have produced elements and set the terminalEvent and we'd quit emitting
+                     * prematurely.
+                     */
+                    Object term = terminalEvent;
+                    /*
                      * See if the queue is empty; since we need this information multiple
                      * times later on, we read it one.
                      * Although the queue can become non-empty in the mean time, we will
@@ -468,7 +477,7 @@
                     // if the queue is empty and the terminal event was received, quit
                     // and don't bother restoring emitting to false: no further activity is
                     // possible at this point
-                    if (checkTerminated(terminalEvent, empty)) {
+                    if (checkTerminated(term, empty)) {
                         skipFinal = true;
                         return;
                     }
@@ -508,10 +517,11 @@
                         // it may happen everyone has unsubscribed between here and producers.get()
                         // or we have no subscribers at all to begin with
                         if (len == unsubscribed) {
+                            term = terminalEvent;
                             // so let's consume a value from the queue
                             Object v = queue.poll();
                             // or terminate if there was a terminal event and the queue is empty
-                            if (checkTerminated(terminalEvent, v == null)) {
+                            if (checkTerminated(term, v == null)) {
                                 skipFinal = true;
                                 return;
                             }",0
fixed #460," 				int count = _record.NumStrings.intValue();
 				long offset = _record.StringOffset.intValue();
 				while (count > 0) {
-					String s = pevlr.getWideString(0);
+					String s = pevlr.getWideString(offset);
 					strings.add(s);
 					offset += s.length() * Native.WCHAR_SIZE;
 					offset += Native.WCHAR_SIZE;",0
Fix indentation in CommandLineRunner.java,,0
Fix memory leak in Recent,"     String path;  // if not loaded, this is non-null
 //    EditorState state;  // if not loaded, this is non-null
 
-    /**
-     * If currently loaded, this is non-null, and takes precedence over the
-     * path and state information, which will instead be stored actively by
-     * the actual sketch object.
-     */
-    Editor editor;
 //    Sketch sketch;
 
 //    Record(String path, EditorState state) {
@@ -374,14 +368,10 @@
 //    }
 
     Record(Editor editor) {
-      this.editor = editor;
-      this.path = editor.getSketch().getMainFilePath();
+      this(editor.getSketch().getMainFilePath());
     }
 
     String getName() {
-      if (editor != null) {
-        return editor.getSketch().getName();
-      }
       // Get the filename of the .pde (or .js or .py...)
       String name = path.substring(path.lastIndexOf(File.separatorChar) + 1);
       // Return the name with the extension removed",0
[BACKLOG-24282] Minor fix to include verbose properties unconditionally,"         }
       }
     }
-    if ( !streaming ) {
-      // used and unused mappings are considered ""verbose"" details
+    // mappings are considered ""verbose"" details
       rootNode.setProperty( DictionaryConst.PROPERTY_VERBOSE_DETAILS, StringUtils.join( verboseProperties, "","" ) );
     }
-  }
 
   @Override protected IClonableStepAnalyzer newInstance() {
     return new MetaInjectAnalyzer();",0
fix #1216,"      */
     private Map<String, Set<String>> getServiceAppMap(List<Provider> providers) {
         Map<String, Set<String>> serviceAppMap = new HashMap<String, Set<String>>();
-        if (providers != null && providers.size() >= 0) {
+        if (providers != null && providers.size() > 0) {
             for (Provider provider : providers) {
                 Set<String> appSet;
                 String service = provider.getService();",0
JENKINS-50487# Fix for java.util.NoSuchElementException error,"     public String getApiUrl(@Nonnull Item item) {
         if (item instanceof org.jenkinsci.plugins.workflow.multibranch.WorkflowMultiBranchProject) {
             MultiBranchProject<?,?> mbp = (MultiBranchProject<?,?>)item;
-            SCMSource s = mbp.getSCMSources().iterator().next();
-            if (s instanceof GitSCMSource) {
-                String remote = ((GitSCMSource)s).getRemote();
-                return remote;
-            }
+            return mbp.getSCMSources().stream()
+                    .filter(s->s instanceof GitSCMSource)
+                    .map(s -> ((GitSCMSource)s).getRemote())
+                    .findFirst()
+                    .orElse(null);
         }
         return null;
     }",0
Removing System.out.println from a previous bugfix under #937,"           }
 
           if(param.required() == true) {
-            System.out.println(param.required());
             parameter.setRequired(param.required());
           }
 ",0
Fix link error in MvpLceView,"  * by
  * invoking the corresponding presenter method</li>
  *
- * <li>{@link #showError(Exception, boolean)}: Display a error view (a TextView) on the screen if
+ * <li>{@link #showError(Throwable, boolean)}: Display a error view (a TextView) on the screen if
  * an error has occurred while loading data. You can distinguish between a pull-to-refresh error by
  * checking the boolean parameter and display the error message in another, more suitable way like
  * a",0
Fix flaky test due to double arithmetic in AbstractTestQueries,"     @Test
     public void testAggregationWithLimit()
     {
-        MaterializedResult actual = computeActual(""SELECT custkey, SUM(totalprice) FROM ORDERS GROUP BY custkey LIMIT 10"");
-        MaterializedResult all = computeExpected(""SELECT custkey, SUM(totalprice) FROM ORDERS GROUP BY custkey"", actual.getTypes());
+        MaterializedResult actual = computeActual(""SELECT custkey, SUM(CAST(totalprice * 100 AS BIGINT)) FROM ORDERS GROUP BY custkey LIMIT 10"");
+        MaterializedResult all = computeExpected(""SELECT custkey, SUM(CAST(totalprice * 100 AS BIGINT)) FROM ORDERS GROUP BY custkey"", actual.getTypes());
 
         assertEquals(actual.getMaterializedRows().size(), 10);
         assertContains(all, actual);",0
Fixes for testCompile issue,"  */
 package org.altbeacon.beacon.service;
 
-import java.util.Date;
-
 import org.altbeacon.beacon.logging.LogManager;
 
 public class MonitorState {
@@ -53,7 +51,7 @@
     }
     public boolean isNewlyOutside() {
         if (inside) {
-            if (lastSeenTime > 0 && (new Date()).getTime() - lastSeenTime > INSIDE_EXPIRATION_MILLIS) {
+            if (lastSeenTime > 0 && System.currentTimeMillis() - lastSeenTime > INSIDE_EXPIRATION_MILLIS) {
                 inside = false;
                 LogManager.d(TAG, ""We are newly outside the region because the lastSeenTime of %s ""
                                 + ""was %s seconds ago, and that is over the expiration duration """,0
Android: Fix an issue with incorrect Lightbox measurments.," import android.support.v7.app.AppCompatActivity;
 import android.view.View;
 import android.view.ViewGroup;
+import android.view.ViewTreeObserver;
 import android.view.Window;
 import android.view.WindowManager;
 import android.widget.RelativeLayout;
 
 import com.reactnativenavigation.R;
 import com.reactnativenavigation.params.LightBoxParams;
-import com.reactnativenavigation.screens.Screen;
 import com.reactnativenavigation.utils.ViewUtils;
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
@@ -48,14 +48,18 @@
         }
     }
 
-    private void createContent(final Context context, LightBoxParams params) {
+    private void createContent(final Context context, final LightBoxParams params) {
         lightBox = new RelativeLayout(context);
         lightBox.setAlpha(0);
-        content = new ContentView(context, params.screenId, params.navigationParams);
-        content.setAlpha(0);
-        RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);
-        lp.addRule(RelativeLayout.CENTER_IN_PARENT, content.getId());
         lightBox.setBackgroundColor(params.backgroundColor.getColor());
+
+        RelativeLayout.LayoutParams lp = new RelativeLayout.LayoutParams(WRAP_CONTENT, WRAP_CONTENT);
+        lp.width = WindowManager.LayoutParams.MATCH_PARENT;
+        lp.height = WindowManager.LayoutParams.MATCH_PARENT;
+
+        content = new ContentView(context, params.screenId, params.navigationParams);
+        lp.addRule(RelativeLayout.CENTER_IN_PARENT, content.getId());
+        content.setAlpha(0);
         lightBox.addView(content, lp);
 
         if (params.tapBackgroundToDismiss) {
@@ -66,20 +70,29 @@
                 }
             });
         }
-
-        content.setOnDisplayListener(new Screen.OnDisplayListener() {
+        content.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
             @Override
-            public void onDisplay() {
-                content.getLayoutParams().height = content.getChildAt(0).getHeight();
-                content.getLayoutParams().width = content.getChildAt(0).getWidth();
+            public void onGlobalLayout() {
+                // Note that this may be called multiple times as the lightbox views get built.  We want to hold off
+                // doing anything here until the lightbox screen and its measurements are available.
+                final View lightboxScreen = content.getChildAt(0);
+                if (lightboxScreen != null) {
+                    final int screenHeight = lightboxScreen.getHeight();
+                    final int screenWidth = lightboxScreen.getWidth();
+                    if (screenHeight > 0 && screenWidth > 0) {
+                        content.getViewTreeObserver().removeOnGlobalLayoutListener(this);
+                        content.getLayoutParams().height = screenHeight;
+                        content.getLayoutParams().width = screenWidth;
                 content.setBackgroundColor(Color.TRANSPARENT);
                 ViewUtils.runOnPreDraw(content, new Runnable() {
                     @Override
                     public void run() {
                         animateShow();
-
                     }
                 });
+
+                    }
+                }
             }
         });
         setContentView(lightBox, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
@@ -95,7 +108,8 @@
         animateHide();
     }
 
-    @Override public void onBackPressed() {
+    @Override
+    public void onBackPressed() {
         if (cancelable) {
             hide();
         }",0
Fix links in javadoc for getUserLists()," as returned to in the response body's next_cursor and previous_cursor attributes to page back and forth in the list.
      * @return the list of lists
      * @throws TwitterException when Twitter service or network is unavailable
-     * @see <a href=""https://dev.twitter.com/docs/api/1.1/get/lists"">GET lists | Twitter Developers</a>
+     * @see <a href=""https://dev.twitter.com/docs/api/1.1/get/lists/list"">GET lists/list | Twitter Developers</a>
      * @since Twitter4J 2.1.0
      */
     ResponseList<UserList> getUserLists(String listOwnerScreenName)
@@ -43,7 +43,7 @@
      * @param listOwnerUserId The id of the list owner
      * @return the list of lists
      * @throws TwitterException when Twitter service or network is unavailable
-     * @see <a href=""https://dev.twitter.com/docs/api/1.1/get/lists"">GET lists | Twitter Developers</a>
+     * @see <a href=""https://dev.twitter.com/docs/api/1.1/get/lists/list"">GET lists/list | Twitter Developers</a>
      * @since Twitter4J 2.2.3
      */
     ResponseList<UserList> getUserLists(long listOwnerUserId)",0
Fixed mem leak when acknowledging while disconnected from broker,"     private CompletableFuture<Void> sendAcknowledge(MessageId messageId, AckType ackType,
                                                     Map<String,Long> properties) {
         MessageIdImpl msgId = (MessageIdImpl) messageId;
-        final ByteBuf cmd = Commands.newAck(consumerId, msgId.getLedgerId(), msgId.getEntryId(),
-                                            ackType, null, properties);
 
         // There's no actual response from ack messages
         final CompletableFuture<Void> ackFuture = new CompletableFuture<Void>();
 
         if (isConnected()) {
+            final ByteBuf cmd = Commands.newAck(consumerId, msgId.getLedgerId(), msgId.getEntryId(),
+                    ackType, null, properties);
             cnx().ctx().writeAndFlush(cmd).addListener(new GenericFutureListener<Future<Void>>() {
                 @Override
                 public void operationComplete(Future<Void> future) throws Exception {",0
Fix RecyclerView IllegalStateException: Closes #21," package com.genius.groupie.example;
 
+import android.os.Handler;
 import android.support.v7.widget.LinearLayoutManager;
 import android.support.v7.widget.RecyclerView;
 
@@ -11,9 +12,11 @@
     private int firstVisibleItem, visibleItemCount, totalItemCount;
     private int current_page = 0;
     private LinearLayoutManager linearLayoutManager;
+    private Handler handler;
 
     public InfiniteScrollListener(LinearLayoutManager linearLayoutManager) {
         this.linearLayoutManager = linearLayoutManager;
+        this.handler = new Handler();
     }
 
     public void setLinearLayoutManager(LinearLayoutManager linearLayoutManager) {
@@ -21,9 +24,12 @@
     }
 
     @Override
-    public void onScrolled(RecyclerView recyclerView, int dx, int dy) {
+    public void onScrolled(final RecyclerView recyclerView, int dx, int dy) {
         super.onScrolled(recyclerView, dx, dy);
 
+        final Runnable runnable = new Runnable() {
+            @Override
+            public void run() {
         visibleItemCount = recyclerView.getChildCount();
         totalItemCount = linearLayoutManager.getItemCount();
         firstVisibleItem = linearLayoutManager.findFirstVisibleItemPosition();
@@ -42,6 +48,13 @@
             loading = true;
         }
     }
+        };
+
+        // We shouldn't directly mutate the RecyclerView data in onScrolled
+        // This is because it may be called during the measure & layout pass where you cannot change the data
+        // Post-pone any adapter changes until the next frame
+        handler.post(runnable);
+    }
 
     public abstract void onLoadMore(int current_page);
 }",0
Change form dialogue to document modal," 	}
 
 	public AbstractFormDialog(Dialog owner, String title, boolean initView) {
-		super(owner, title, true);
+		super(owner, title, ModalityType.DOCUMENT_MODAL);
 		initialise(initView);
 	}
 ",0
MINOR: Fix some spelling corrections in comments,"      */
     private void handleConnections() {
         for (String node : this.selector.connected()) {
-            // We are now connected.  Node that we might not still be able to send requests. For instance,
+            // We are now connected.  Note that we might not still be able to send requests. For instance,
             // if SSL is enabled, the SSL handshake happens after the connection is established.
             // Therefore, it is still necessary to check isChannelReady before attempting to send on this
             // connection.
@@ -987,7 +987,7 @@
             Cluster cluster = metadata.fetch();
             // 'processDisconnection' generates warnings for misconfigured bootstrap server configuration
             // resulting in 'Connection Refused' and misconfigured security resulting in authentication failures.
-            // The warning below handles the case where connection to a broker was established, but was disconnected
+            // The warning below handles the case where a connection to a broker was established, but was disconnected
             // before metadata could be obtained.
             if (cluster.isBootstrapConfigured()) {
                 int nodeId = Integer.parseInt(destination);
@@ -1008,8 +1008,9 @@
 
         @Override
         public void handleCompletedMetadataResponse(RequestHeader requestHeader, long now, MetadataResponse response) {
-            // If any partition has leader with missing listeners, log a few for diagnosing broker configuration
-            // issues. This could be a transient issue if listeners were added dynamically to brokers.
+            // If any partition has leader with missing listeners, log up to ten of these partitions
+            // for diagnosing broker configuration issues.
+            // This could be a transient issue if listeners were added dynamically to brokers.
             List<TopicPartition> missingListenerPartitions = response.topicMetadata().stream().flatMap(topicMetadata ->
                 topicMetadata.partitionMetadata().stream()
                     .filter(partitionMetadata -> partitionMetadata.error() == Errors.LISTENER_NOT_FOUND)
@@ -1021,12 +1022,12 @@
                         count, missingListenerPartitions.subList(0, Math.min(10, count)));
             }
 
-            // check if any topics metadata failed to get updated
+            // Check if any topic's metadata failed to get updated
             Map<String, Errors> errors = response.errors();
             if (!errors.isEmpty())
                 log.warn(""Error while fetching metadata with correlation id {} : {}"", requestHeader.correlationId(), errors);
 
-            // don't update the cluster if there are no valid nodes...the topic we want may still be in the process of being
+            // Don't update the cluster if there are no valid nodes...the topic we want may still be in the process of being
             // created which means we will get errors and no nodes until it exists
             if (response.brokers().isEmpty()) {
                 log.trace(""Ignoring empty metadata response with correlation id {}."", requestHeader.correlationId());
@@ -1085,7 +1086,7 @@
             }
 
             if (connectionStates.canConnect(nodeConnectionId, now)) {
-                // we don't have a connection to this node right now, make one
+                // We don't have a connection to this node right now, make one
                 log.debug(""Initialize connection to node {} for sending metadata request"", node);
                 initiateConnect(node, now);
                 return reconnectBackoffMs;",0
Fix contentView parent," 			contextualUndoView.findViewById(mUndoActionId).setOnClickListener(new UndoListener(contextualUndoView));
 		}
 
-		View contentView = super.getView(position, contextualUndoView.getContentView(), parent);
+		View contentView = super.getView(position, contextualUndoView.getContentView(), contextualUndoView);
 		contextualUndoView.updateContentView(contentView);
 
 		long itemId = getItemId(position);",0
Bugfix for B3DLoader,"                 }
                 B3DModel.Parser parser = new B3DModel.Parser(resource.getInputStream());
                 B3DModel model = parser.parse();
-                cache.put(modelLocation, model);
+                cache.put(file, model);
             }
             catch(IOException e)
             {
                 //FMLLog.log(Level.ERROR, e, ""Exception loading model %s with B3D loader, skipping"", modelLocation);
-                cache.put(modelLocation, null);
+                cache.put(file, null);
                 throw e;
             }
         }",0
Fix length check for sliceStart,"     }
 
     public static Filter getFilter(SliceQuery query) {
-        byte[] colStartBytes = query.getSliceEnd().length() > 0 ? query.getSliceStart().as(StaticBuffer.ARRAY_FACTORY) : null;
+        byte[] colStartBytes = query.getSliceStart().length() > 0 ? query.getSliceStart().as(StaticBuffer.ARRAY_FACTORY) : null;
         byte[] colEndBytes = query.getSliceEnd().length() > 0 ? query.getSliceEnd().as(StaticBuffer.ARRAY_FACTORY) : null;
 
         Filter filter = new ColumnRangeFilter(colStartBytes, true, colEndBytes, false);",0
Fix NPE when there are no database," 
     public Response getDBList() {
         Response response = new Response();
-        if (mDatabaseDir != null) {
+        if (mDatabaseDir != null && mDatabaseDir.list() != null) {
             for (String name : mDatabaseDir.list()) {
                 response.rows.add(name);
             }",0
Always return 100% when spider stopped," 			SpiderScan scan = (SpiderScan) this.getSpiderScan(params);
 			int progress = 0;
 			if (scan != null) {
+				if (scan.isStopped()) {
+					progress = 100;
+				} else {
 				progress = scan.getProgress();
 			}
+			}
 			result = new ApiResponseElement(name, Integer.toString(progress));
 		} else if (VIEW_RESULTS.equals(name)) {
 			result = new ApiResponseList(name);",0
fixed null pointer exception in view resolver when BroadleafRequestContext is null,"     }
     
     protected boolean isIFrameRequest() {
+    	if (BroadleafRequestContext.getBroadleafRequestContext() != null && BroadleafRequestContext.getBroadleafRequestContext().getRequest() != null) {
         HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();
     	String iFrameParameter = request.getParameter(""blcIFrame"");
     	return  (iFrameParameter != null && ""true"".equals(iFrameParameter));
     }
+    	return false;
+    }
     
     protected boolean isAjaxRequest() {
+    	if (BroadleafRequestContext.getBroadleafRequestContext() != null && BroadleafRequestContext.getBroadleafRequestContext().getRequest() != null) {
         HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();
         return BroadleafControllerUtility.isAjaxRequest(request);
     }
+    	return false;
+    }
 
     /**
      * Gets the map of prefix : layout for use in determining which layout",0
Fix a typo in zap/GuiBootstrap.java,"                 warnAddOnsAndExtensionsNoLongerRunnable();
 
                 if (firstTime) {
-                    // Disabled for now - we have too many popups occuring when you
+                    // Disabled for now - we have too many popups occurring when you
                     // first start up
                     // be nice to have a clean start up wizard...
                     // ExtensionHelp.showHelp();",0
fix incorrect Time factory methods,"     }
 
     public static Time minutes(long value) {
-        return new Time(minutesAsSeconds(value), TimeUnit.MILLISECONDS);
+        return new Time(minutesAsSeconds(value), TimeUnit.SECONDS);
     }
 
     public static Time hours(long value) {
-        return new Time(hoursAsSeconds(value), TimeUnit.MILLISECONDS);
+        return new Time(hoursAsSeconds(value), TimeUnit.SECONDS);
     }
 
     public static Time days(long value) {
-        return new Time(daysAsSeconds(value), TimeUnit.MILLISECONDS);
+        return new Time(daysAsSeconds(value), TimeUnit.SECONDS);
     }
 
     public long toMillis() {",0
MathUtils: Fixed isEqual() documentation," 	/** Returns true if a is nearly equal to b.
 	 * @param a the first value.
 	 * @param b the second value.
-	 * @param tolerance represent an upper bound below which the value is considered zero. */
+	 * @param tolerance represent an upper bound below which the two values are considered equal. */
 	static public boolean isEqual (float a, float b, float tolerance) {
 		return Math.abs(a - b) <= tolerance;
 	}",0
Fix the problem with NoClassDefFoundError,"                         continue;
                     }
 
+                    boolean isKotlin = false;
+
+                    try {
                     if (referenceExpression instanceof KotlinUQualifiedReferenceExpression) {
+                            isKotlin = true;
+                        }
+                    } catch (NoClassDefFoundError ignored) {}
+
+                    if (isKotlin) {
                         if (""onRequestPermissionsResult"".equals(referenceExpression.getResolvedName())) {
                             return true;
                         }",0
Fix last package not making to list,"             } else {
                 if (resName.lastIndexOf('.') >= 0) {
                     String pkg = resName.substring(0, resName.lastIndexOf('.'));
-                    if (lastPackage == null || !pkg.equals(lastPackage)) {
-                        if (packageNode != null) {
-                            currentClassesDex.add(packageNode);
-                        }
+                    if (!pkg.equals(lastPackage)) {
                         lastPackage = pkg;
                         packageNode = new DefaultMutableTreeNode(pkg);
+                        currentClassesDex.add(packageNode);
                     }
                     packageNode.add(new DefaultMutableTreeNode(new NodeInfo(resName)));
                 } else {",0
Consider the super class when obtaining a property iterator from Hibernate metadata,"         if (metadata == null) {
             return propertyNames;
         }
-        Iterator propertyIterator = metadata.getPropertyIterator();
+        Iterator propertyIterator = metadata.getPropertyClosureIterator();
         while (propertyIterator.hasNext()) {
             org.hibernate.mapping.Property prop = (org.hibernate.mapping.Property) propertyIterator.next();
             propertyNames.add(prop.getName());
@@ -115,7 +115,7 @@
         if (metadata == null) {
             return propertyTypes;
         }
-        Iterator propertyIterator = metadata.getPropertyIterator();
+        Iterator propertyIterator = metadata.getPropertyClosureIterator();
         while (propertyIterator.hasNext()) {
             org.hibernate.mapping.Property prop = (org.hibernate.mapping.Property) propertyIterator.next();
             propertyTypes.add(prop.getType());",0
"NetJavaImpl, fixed previous commit"," 			connection.setDoOutput(doingOutPut);
 			connection.setDoInput(true);
 			connection.setRequestMethod(method);
-			connection.setFollowRedirects(httpRequest.getFollowRedirects());
+			HttpURLConnection.setFollowRedirects(httpRequest.getFollowRedirects());
 
 			lock.lock();
 			connections.put(httpRequest, connection);",0
Perf producer was overriding the producer max queue size,"         if (arguments.batchTime > 0) {
             producerConf.setBatchingMaxPublishDelay(arguments.batchTime, TimeUnit.MILLISECONDS);
             producerConf.setBatchingEnabled(true);
-            producerConf.setMaxPendingMessages(arguments.msgRate);
         }
 
         // Block if queue is full else we will start seeing errors in sendAsync",0
Fix wrong class name in the exception message,"     public synchronized MockMvc build(final MockMvcConfig config) {
         final MockMvc mockMvcToReturn;
         if (!isAssigned()) {
-            throw new IllegalStateException(""You haven't configured a MockMVC instance. You can do this statically\n\nRestAssured.mockMvc(..)\nRestAssured.standaloneSetup(..);\nRestAssured.webAppContextSetup(..);\n\nor using the DSL:\n\ngiven().\n\t\tmockMvc(..). ..\n"");
+            throw new IllegalStateException(""You haven't configured a MockMVC instance. You can do this statically\n\nRestAssuredMockMvc.mockMvc(..)\nRestAssuredMockMvc.standaloneSetup(..);\nRestAssuredMockMvc.webAppContextSetup(..);\n\nor using the DSL:\n\ngiven().\n\t\tmockMvc(..). ..\n"");
         } else if (mockMvc instanceof MockMvc) {
             mockMvcToReturn = (MockMvc) this.mockMvc;
         } else if (mockMvc instanceof AbstractMockMvcBuilder) {",0
"Fix bug when orientation changes, the screen goes transparent"," import android.content.res.ColorStateList;
 import android.os.Build;
 import android.os.Bundle;
+import android.support.annotation.ColorInt;
 import android.support.annotation.ColorRes;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
@@ -415,37 +416,47 @@
         }).show();
     }
 
-    private Integer getBackgroundColor(int position, float positionOffset) {
-        return (Integer) argbEvaluator.evaluate(positionOffset, color(adapter.getItem(position).backgroundColor()), color(adapter.getItem(position + 1).backgroundColor()));
+    private int getBackgroundEvaluatedColor(int position, float positionOffset) {
+        return (int) argbEvaluator.evaluate(positionOffset, getBackgroundColor(position), getBackgroundColor(position + 1));
     }
 
-    private Integer getButtonsColor(int position, float positionOffset) {
-        return (Integer) argbEvaluator.evaluate(positionOffset, color(adapter.getItem(position).buttonsColor()), color(adapter.getItem(position + 1).buttonsColor()));
+    private int getButtonsEvaluatedColor(int position, float positionOffset) {
+        return (int) argbEvaluator.evaluate(positionOffset, getButtonsColor(position), getButtonsColor(position + 1));
     }
 
-    private int color(@ColorRes int color) {
+    @ColorInt
+    private int getColorFromRes(@ColorRes int color) {
         return ContextCompat.getColor(this, color);
     }
 
+    private int getButtonsColor(int position) {
+        return getColorFromRes(adapter.getItem(position).buttonsColor());
+    }
+
+    private int getBackgroundColor(int position) {
+        return getColorFromRes(adapter.getItem(position).backgroundColor());
+    }
+
     private class ColorTransitionScrollListener implements IPageScrolledListener {
         @Override
         public void pageScrolled(int position, float offset) {
             if (position < adapter.getCount() - 1) {
                 setViewsColor(position, offset);
-            } else if (adapter.getCount() == 1) {
-                viewPager.setBackgroundColor(adapter.getItem(position).backgroundColor());
-                messageButton.setTextColor(adapter.getItem(position).backgroundColor());
+            } else if (adapter.getCount() == 1 || isOnLastSlide(position, offset)) {
+                viewPager.setBackgroundColor(getBackgroundColor(position));
+                messageButton.setTextColor(getBackgroundColor(position));
+                pageIndicator.setPageIndicatorColor(getButtonsColor(position));
 
-                tintButtons(ColorStateList.valueOf(adapter.getItem(position).buttonsColor()));
+                tintButtons(ColorStateList.valueOf(getButtonsColor(position)));
             }
         }
 
         private void setViewsColor(int position, float offset) {
-            int backgroundColor = getBackgroundColor(position, offset);
+            int backgroundColor = getBackgroundEvaluatedColor(position, offset);
             viewPager.setBackgroundColor(backgroundColor);
             messageButton.setTextColor(backgroundColor);
 
-            int buttonsColor = getButtonsColor(position, offset);
+            int buttonsColor = getButtonsEvaluatedColor(position, offset);
             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
                 getWindow().setStatusBarColor(buttonsColor);
             }
@@ -454,6 +465,10 @@
             tintButtons(ColorStateList.valueOf(buttonsColor));
         }
 
+        private boolean isOnLastSlide(int position, float offset) {
+            return position == adapter.getLastItemPosition() && offset == 0;
+        }
+
         private void tintButtons(ColorStateList color) {
             ViewCompat.setBackgroundTintList(nextButton, color);
             ViewCompat.setBackgroundTintList(backButton, color);",0
Fix typo in Lunar Isle teleport location," 	ELF_CAMP_SCROLL(TeleportType.SCROLL, ""Elf Camp Teleport"", new WorldPoint(2193, 3257, 0), ""scroll_teleport_icon.png""),
 	FELDIP_HILLS_SCROLL(TeleportType.SCROLL, ""Feldip Hills Teleport"", new WorldPoint(2542, 2925, 0), ""scroll_teleport_icon.png""),
 	LUMBERYARD_SCROLL(TeleportType.SCROLL, ""Lumberyard Teleport"", new WorldPoint(3303, 3487, 0), ""scroll_teleport_icon.png""),
-	LUNAR_ISLE_SCROLL(TeleportType.SCROLL, ""Lunar Aisle Teleport"", new WorldPoint(2093, 3912, 0), ""scroll_teleport_icon.png""),
+	LUNAR_ISLE_SCROLL(TeleportType.SCROLL, ""Lunar Isle Teleport"", new WorldPoint(2093, 3912, 0), ""scroll_teleport_icon.png""),
 	MORTTON_SCROLL(TeleportType.SCROLL, ""Mort'ton"", new WorldPoint(3489, 3288, 0), ""scroll_teleport_icon.png""),
 	MOS_LEHARMLESS_SCROLL(TeleportType.SCROLL, ""Mos Le'Harmless Teleport"", new WorldPoint(3701, 2996, 0), ""scroll_teleport_icon.png""),
 	NARDAH_SCROLL(TeleportType.SCROLL, ""Nardah Teleport"", new WorldPoint(3421, 2917, 0), ""scroll_teleport_icon.png""),",0
[PUBDEV-5002] Fix obtaining the logs from the client node (#1646),"   public final H2ONode[] _memary;
 
   // mapping from a node ip to node index
-  private final HashMap<String, Integer> _node_ip_to_index;
+  private HashMap<String, Integer> _node_ip_to_index;
   final int _hash;
 
   public H2ONode getNodeByIpPort(String ipPort) {
@@ -1593,7 +1593,8 @@
       if (index != null) {
         if(index == -1){
           return H2O.SELF;
-        } else if(index < -1 || index >= _memary.length){
+        } else if(index <= -1 || index >= _memary.length){
+          // index -1 should not happen anymore as well
           throw new RuntimeException(""Mapping from node id to node index contains: "" + index + "", however this node"" +
                   ""does not exist!"");
         }
@@ -1619,10 +1620,6 @@
   H2O( H2ONode[] h2os, int hash, int idx ) {
     _memary = h2os;             // Need to clone?
     java.util.Arrays.sort(_memary);       // ... sorted!
-    _node_ip_to_index = new HashMap<>();
-    for(H2ONode node: _memary){
-      _node_ip_to_index.put(node.getIpPortString(), node.index());
-    }
     _hash = hash;               // And record hash for cloud rollover
     _idx = (char)(idx&0x0ff);   // Roll-over at 256
   }
@@ -1637,6 +1634,11 @@
       CLOUDS[idx] = CLOUD = new H2O(h2os,hash,idx);
     }
     SELF._heartbeat._cloud_size=(char)CLOUD.size();
+
+    H2O.CLOUD._node_ip_to_index = new HashMap<>();
+    for(H2ONode node: H2O.CLOUD._memary){
+      H2O.CLOUD._node_ip_to_index.put(node.getIpPortString(), node.index());
+    }
   }
 
   // Is nnn larger than old (counting for wrap around)? Gets confused if we",0
修复当插入的字符串中只含有一个英文状态的双引号或者单引号的时候，mycat会假死的BUG。（#1569）," 				flag = 2;
 				currentValue.append(j);
 			} else if(j=='\'' && flag == 1){
-				flag = 2;
-				currentValue.append(j);
-			} else if(j=='\\' && flag == 2){
 				flag = 3;
 				currentValue.append(j);
-			} else if (flag == 3){
+			} else if (j == '\\' && flag == 2) {
+				flag = 4;
+				currentValue.append(j);
+			} else if (j == '\\' && flag == 3) {
+				flag = 5;
+				currentValue.append(j);
+			} else if (flag == 4) {
 				flag = 2;
 				currentValue.append(j);
+			} else if (flag == 5) {
+				flag = 3;
+				currentValue.append(j);
 			}else if(j=='\""' && flag == 2){
 				flag = 1;
 				currentValue.append(j);
-			} else if(j=='\'' && flag == 2){
+			} else if (j == '\'' && flag == 3) {
 				flag = 1;
 				currentValue.append(j);
 			} else if (j==')' && flag == 1){",0
solve issue #2 about TintImageView bug," import android.content.res.TypedArray;
 import android.graphics.PorterDuff;
 import android.graphics.drawable.Drawable;
-import android.os.Build;
 import android.support.v4.content.ContextCompat;
 import android.support.v4.graphics.drawable.DrawableCompat;
 import android.util.AttributeSet;
@@ -135,21 +134,21 @@
     private boolean applySupportImageTint() {
         Drawable image = ((ImageView) mView).getDrawable();
         if (image != null && mImageTintInfo != null && mImageTintInfo.mHasTintList) {
-            image.mutate();
-            image = DrawableCompat.wrap(image);
+            Drawable tintDrawable = image.mutate();
+            tintDrawable = DrawableCompat.wrap(tintDrawable);
             if (mImageTintInfo.mHasTintList) {
-                DrawableCompat.setTintList(image, mImageTintInfo.mTintList);
+                DrawableCompat.setTintList(tintDrawable, mImageTintInfo.mTintList);
             }
             if (mImageTintInfo.mHasTintMode) {
-                DrawableCompat.setTintMode(image, mImageTintInfo.mTintMode);
+                DrawableCompat.setTintMode(tintDrawable, mImageTintInfo.mTintMode);
             }
-            if (image.isStateful()) {
-                image.setState(mView.getDrawableState());
+            if (tintDrawable.isStateful()) {
+                tintDrawable.setState(mView.getDrawableState());
             }
-            if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.KITKAT) {
-                setImageDrawable(null);
+            setImageDrawable(tintDrawable);
+            if (image == tintDrawable) {
+                tintDrawable.invalidateSelf();
             }
-            setImageDrawable(image);
             return true;
         }
         return false;",0
Couple more bug fixes," 
     @Override
     public void reset() {
+        sourceIterator.reset();
         currentIndex = 0;
     }
 
@@ -124,14 +125,15 @@
             ds = cache.get(key);
         } else {
             ds = sourceIterator.next();
-            if (preProcessor != null) {
-                preProcessor.preProcess(ds);
-            }
             cache.put(key, ds);
         }
 
         currentIndex += 1;
 
+        if (preProcessor != null) {
+            preProcessor.preProcess(ds);
+        }
+
         return ds;
     }
 ",0
Fixed scope of MySingletonScopedBean to really be @Singelton,"  */
 package org.javaee7.cdi.bean.scopes;
 
-import javax.enterprise.context.RequestScoped;
+import javax.inject.Singleton;
 
 /**
  * @author Arun Gupta
  */
-@RequestScoped
+@Singleton
 public class MySingletonScopedBean {
     public String getID() {
         return this + """";",0
Simple spelling fix,"  * <h3>One-shot API</h3>
  * <p>
  * The main purpose of a {@code Promise} is to complete its underlying {@code Future}. When only a single {@code Thread}
- * will eventually complete the {@code Promise}, we use on of these methods. Calls will throw if the {@code Promise} is already
+ * will eventually complete the {@code Promise}, we use one of these methods. Calls will throw if the {@code Promise} is already
  * completed.
  * <ul>
  * <li>{@link #complete(Try)}</li>",0
Fix NPE crash in ResourcesUtil.getIdString()," import com.facebook.stetho.common.LogUtil;
 
 import javax.annotation.Nonnull;
+import javax.annotation.Nullable;
 
 public class ResourcesUtil {
   private ResourcesUtil() {
   }
 
   @Nonnull
-  public static String getIdStringQuietly(Object idContext, Resources r, int resourceId) {
+  public static String getIdStringQuietly(Object idContext, @Nullable Resources r, int resourceId) {
     try {
       return getIdString(r, resourceId);
     } catch (Resources.NotFoundException e) {
-      String idString = ""#"" + Integer.toHexString(resourceId);
+      String idString = getFallbackIdString(resourceId);
       LogUtil.w(""Unknown identifier encountered on "" + idContext + "": "" + idString);
       return idString;
     }
   }
 
-  public static String getIdString(Resources r, int resourceId) throws Resources.NotFoundException {
+  public static String getIdString(@Nullable Resources r, int resourceId)
+      throws Resources.NotFoundException {
+    if (r == null) {
+      return getFallbackIdString(resourceId);
+    }
+
     String prefix;
     String prefixSeparator;
     switch (getResourcePackageId(resourceId)) {
@@ -59,6 +65,10 @@
     return sb.toString();
   }
 
+  private static String getFallbackIdString(int resourceId) {
+    return ""#"" + Integer.toHexString(resourceId);
+  }
+
   private static int getResourcePackageId(int id) {
     return (id >>> 24) & 0xff;
   }",0
Error removing a child order item from the cart,"         // We now need to delete any OrderItems that were marked as such, including their children, if any
         for (OrderItem oi : request.getOisToDelete()) {
             order.getOrderItems().remove(oi);
-            orderItemService.delete(oi);
             
             if (oi.getParentOrderItem() != null) {
                 OrderItem parentItem = oi.getParentOrderItem();
                 parentItem.getChildOrderItems().remove(oi);
             }
+
+            orderItemService.delete(oi);
         }
         
         // We need to build up a map of OrderItem to which FulfillmentGroupItems reference that particular OrderItem.",0
Fix for Issue 2800," import org.terasology.entitySystem.systems.RenderSystem;
 import org.terasology.monitoring.PerformanceMonitor;
 import org.terasology.registry.In;
+import org.terasology.rendering.cameras.Camera;
 import org.terasology.rendering.dag.AbstractNode;
 import org.terasology.rendering.dag.stateChanges.BindFBO;
 import static org.lwjgl.opengl.GL11.GL_ONE_MINUS_SRC_ALPHA;
@@ -27,9 +28,11 @@
 import org.terasology.rendering.dag.stateChanges.EnableBlending;
 import static org.terasology.rendering.opengl.DefaultDynamicFBOs.READ_ONLY_GBUFFER;
 
+import org.terasology.rendering.dag.stateChanges.LookThrough;
 import org.terasology.rendering.dag.stateChanges.SetBlendFunction;
 import org.terasology.rendering.dag.stateChanges.SetViewportToSizeOf;
 import org.terasology.rendering.opengl.fbms.DisplayResolutionDependentFBOs;
+import org.terasology.rendering.world.WorldRenderer;
 
 /**
  * An instance of this class renders and blends semi-transparent objects into the content of the existing g-buffer.
@@ -49,6 +52,9 @@
 public class SimpleBlendMaterialsNode extends AbstractNode {
 
     @In
+    private WorldRenderer worldRenderer;
+
+    @In
     private ComponentSystemManager componentSystemManager;
 
     @In
@@ -60,6 +66,9 @@
      */
     @Override
     public void initialise() {
+        Camera playerCamera = worldRenderer.getActiveCamera();
+        addDesiredStateChange(new LookThrough(playerCamera));
+
         addDesiredStateChange(new BindFBO(READ_ONLY_GBUFFER.getName(), displayResolutionDependentFBOs));
         addDesiredStateChange(new SetViewportToSizeOf(READ_ONLY_GBUFFER.getName(), displayResolutionDependentFBOs));
 ",0
Fix NPE when coercing a null into a String,"     public static GraphQLScalarType GraphQLString = new GraphQLScalarType(""String"", ""Built-in String"", new Coercing() {
         @Override
         public Object coerce(Object input) {
-            return input.toString();
+            return input == null ? null : input.toString();
         }
 
         @Override",0
Fix class cast exception in CPA,"         if (!(isInstanceOfView(object))) {
             return POSITION_NONE;
         }
-        MonthView monthView = (MonthView) object;
-        CalendarDay month = monthView.getMonth();
-        if (month == null) {
+        CalendarPagerView pagerView = (CalendarPagerView) object;
+        CalendarDay firstViewDay = pagerView.getFirstViewDay();
+        if (firstViewDay == null) {
             return POSITION_NONE;
         }
         int index = indexOf((V) object);",0
Downgrade pulsar-client CLI consume warning message (#1485)," 
                 Message<byte[]> msg = consumer.receive(5, TimeUnit.SECONDS);
                 if (msg == null) {
-                    LOG.warn(""No message to consume after waiting for 20 seconds."");
+                    LOG.debug(""No message to consume after waiting for 5 seconds."");
                 } else {
                     numMessagesConsumed += 1;
                     System.out.println(MESSAGE_BOUNDARY);",0
UndoHelper fixes," 
         if (mSnackBar == null) {
             mSnackBar = Snackbar.make(view, text, duration)
-                    .setCallback(new Snackbar.Callback() {
+                    .addCallback(new Snackbar.Callback() {
                         @Override
                         public void onDismissed(Snackbar snackbar, int event) {
                             super.onDismissed(snackbar, event);
@@ -153,14 +153,15 @@
                             super.onShown(snackbar);
                             doChange();
                         }
-                    })
-                    .setAction(actionText, new View.OnClickListener() {
+                    });
+
+        }
+        mSnackBar.setAction(actionText, new View.OnClickListener() {
                         @Override
                         public void onClick(View v) {
                             undoChange();
                         }
                     });
-        }
 
         mSnackBar.show();
         return mSnackBar;",0
"When new cluster is setup, public/default namespace should be extended there"," import com.google.common.collect.Lists;
 
 import java.io.IOException;
+import java.util.Collections;
 import java.util.List;
 
 import org.apache.bookkeeper.client.BookKeeperAdmin;
@@ -150,13 +151,21 @@
             // Ignore
         }
 
-        // Create public tenant
-        TenantInfo publicTenant = new TenantInfo();
+        // Create public tenant, whitelisted to use the this same cluster, along with other clusters
+        String publicTenantPath = POLICIES_ROOT + ""/"" + TopicName.PUBLIC_TENANT;
+        TenantInfo publicTenant;
+        if (globalZk.exists(publicTenantPath, false) == null) {
+            publicTenant = new TenantInfo(Collections.emptySet(), Collections.singleton(arguments.cluster));
+        } else {
+            byte[] content = globalZk.getData(publicTenantPath, false, null);
+            publicTenant = ObjectMapperFactory.getThreadLocal().readValue(content, TenantInfo.class);
+            publicTenant.getAllowedClusters().add(arguments.cluster);
+        }
         byte[] publicPropertyDataJson = ObjectMapperFactory.getThreadLocal().writeValueAsBytes(publicTenant);
         try {
             ZkUtils.createFullPathOptimistic(
                 globalZk,
-                POLICIES_ROOT + ""/"" + TopicName.PUBLIC_TENANT,
+                publicTenantPath,
                 publicPropertyDataJson,
                 ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT);
@@ -165,13 +174,22 @@
         }
 
         // Create default namespace
-        Policies policies = new Policies();
-        policies.bundles = getBundles(4);
+        String defaultNamespacePath = POLICIES_ROOT + ""/"" + TopicName.PUBLIC_TENANT + ""/"" + TopicName.DEFAULT_NAMESPACE;
+        Policies policies;
+        if (globalZk.exists(defaultNamespacePath, false) == null) {
+            policies = new Policies();
+            policies.bundles = getBundles(16);
+        } else {
+            byte[] content = globalZk.getData(defaultNamespacePath, false, null);
+            policies = ObjectMapperFactory.getThreadLocal().readValue(content, Policies.class);
+            policies.replication_clusters.add(arguments.cluster);
+        }
+
         byte[] defaultNamespaceDataJson = ObjectMapperFactory.getThreadLocal().writeValueAsBytes(policies);
         try {
             ZkUtils.createFullPathOptimistic(
                 globalZk,
-                POLICIES_ROOT + ""/"" + TopicName.PUBLIC_TENANT + ""/"" + TopicName.DEFAULT_NAMESPACE,
+                defaultNamespacePath,
                 defaultNamespaceDataJson,
                 ZooDefs.Ids.OPEN_ACL_UNSAFE,
                 CreateMode.PERSISTENT);",0
fix for unexpected behaviour when repeatedly calling Geometry3D.addFromGeometry3D(),"     }
 
     public static float[] getFloatArrayFromBuffer(FloatBuffer buffer) {
-        float[] array = null;
+        float[] array = new float[0];
         if (buffer != null) {
             if (buffer.hasArray()) {
                 array = buffer.array();
@@ -207,7 +207,7 @@
     }
 
     public static int[] getIntArrayFromBuffer(Buffer buffer) {
-        int[] array = null;
+        int[] array = new int[0];
         if (buffer != null) {
             if (buffer.hasArray()) {
                 array = (int[]) buffer.array();
@@ -325,10 +325,10 @@
 
         //Set the new data
         setVertices(newVertices, true);
-        setNormals(newNormals);
-        setTextureCoords(newTextureCoords);
-        setColors(newColors);
-        setIndices(newIntIndices);
+        setNormals(newNormals, true);
+        setTextureCoords(newTextureCoords, true);
+        setColors(newColors, true);
+        setIndices(newIntIndices, true);
 
         if (createVBOs) {
             //Create the new buffers
@@ -764,11 +764,15 @@
     }
 
     public void setNormals(float[] normals) {
+        setNormals(normals, false);
+    }
+
+    public void setNormals(float[] normals, boolean override) {
         if (normals == null) {
             return;
         }
         final BufferInfo normalInfo = mBuffers.get(NORMAL_BUFFER_KEY);
-        if (normalInfo.buffer == null) {
+        if (normalInfo.buffer == null || override == true) {
             normalInfo.buffer = ByteBuffer.allocateDirect(normals.length * FLOAT_SIZE_BYTES)
                     .order(ByteOrder.nativeOrder()).asFloatBuffer();
             ((FloatBuffer) normalInfo.buffer).put(normals);
@@ -802,8 +806,12 @@
     }
 
     public void setIndices(int[] indices) {
+        setIndices(indices, false);
+    }
+
+    public void setIndices(int[] indices, boolean override) {
         final BufferInfo indexInfo = mBuffers.get(INDEX_BUFFER_KEY);
-        if (indexInfo.buffer == null) {
+        if (indexInfo.buffer == null || override == true) {
             indexInfo.buffer = ByteBuffer.allocateDirect(indices.length * INT_SIZE_BYTES)
                     .order(ByteOrder.nativeOrder()).asIntBuffer();
             ((IntBuffer) indexInfo.buffer).put(indices).position(0);
@@ -822,11 +830,15 @@
     }
 
     public void setTextureCoords(float[] textureCoords) {
+        setTextureCoords(textureCoords, false);
+    }
+
+    public void setTextureCoords(float[] textureCoords, boolean override) {
         if (textureCoords == null) {
             return;
         }
         final BufferInfo textureInfo = mBuffers.get(TEXTURE_BUFFER_KEY);
-        if (textureInfo.buffer == null) {
+        if (textureInfo.buffer == null || override == true) {
             textureInfo.buffer = ByteBuffer
                     .allocateDirect(textureCoords.length * FLOAT_SIZE_BYTES)
                     .order(ByteOrder.nativeOrder()).asFloatBuffer();
@@ -854,8 +866,12 @@
     }
 
     public void setColors(float[] colors) {
+        setTextureCoords(colors, false);
+    }
+
+    public void setColors(float[] colors, boolean override) {
         final BufferInfo colorInfo = mBuffers.get(COLOR_BUFFER_KEY);
-        if (colorInfo.buffer == null) {
+        if (colorInfo.buffer == null || override == true) {
             colorInfo.buffer = ByteBuffer
                     .allocateDirect(colors.length * FLOAT_SIZE_BYTES)
                     .order(ByteOrder.nativeOrder()).asFloatBuffer();",0
fix bigInteger bad key issue," 		{
 			LongLongColumn llc = (LongLongColumn) s;
 			BigInteger b = new BigInteger(llc.getValue() + """");
-			return b.add(new BigInteger(unsignedOffset(s, avroField) + """"));
+			return b.add(new BigInteger(unsignedOffset(s, avroField) + """")).longValue();
 		}
 		return Long.parseLong(s.getValue() + """") + unsignedOffset(s, avroField);
 	}",0
Small fix for in-game torches not producing lights,"                         lightComponent.lightColorAmbient.y, lightComponent.lightColorAmbient.z, true);
                     lightGeometryMaterial.setFloat3(""lightProperties"", lightComponent.lightAmbientIntensity,
                         lightComponent.lightDiffuseIntensity, lightComponent.lightSpecularPower, true);
+                    lightGeometryMaterial.setFloat4(""lightExtendedProperties"", lightComponent.lightAttenuationRange,
+                        lightComponent.lightAttenuationFalloff, 0.0f, 0.0f, true);
 
                     // setting shader parameters for the light position in camera space
                     Vector3f lightPositionInViewSpace = new Vector3f(lightPositionRelativeToCamera);",0
FulfillmentGroupItemImpl.getHasProratedOrderAdjustments() now returns correct value,"     @Override
     public boolean getHasProratedOrderAdjustments() {
         if (proratedOrderAdjustment != null) {
-            return (proratedOrderAdjustment.compareTo(BigDecimal.ZERO) == 0);
+            return (proratedOrderAdjustment.compareTo(BigDecimal.ZERO) != 0);
         }
         return false;
     }",0
Fix typo,"     }
 
     /**
-     * It will use {@link JavaParser#parseStatement(String)} inside, so it should end with a semi column
+     * It will use {@link JavaParser#parseStatement(String)} inside, so it should end with a semicolon
      */
     default N addStatement(String statement) {
         return addStatement(parseStatement(statement));",0
Fix grammar in ConnectionLostDialog.,"         super(
             parentShell,
             ""Connection lost"",
-            ""Connection to '"" + container.getName() + ""' was lost and cannot be re-established.\nWhat to you want to do?"",
+            ""Connection to '"" + container.getName() + ""' was lost and cannot be re-established.\nWhat do you want to do?"",
             GeneralUtils.makeExceptionStatus(error),
             IStatus.INFO | IStatus.WARNING | IStatus.ERROR);
         this.stopButtonName = stopButtonName;",0
fix issue-2948:spring boot external config invalid,"                     if (name.startsWith(normalizedPrefix)) {
                         String subName = name.substring(normalizedPrefix.length());
                         String value = propertyResolver.getProperty(name);
-                        subProperties.put(subName, value);
+                        subProperties.putIfAbsent(subName, value);
                     }
                 }
             }",0
Fixed a bug where the Read-Only data directory config is not honored properly.,"         }
 
         // Define various paths
-        String dataDirectory = combinedConfigs.getString(VOLDEMORT_HOME) + File.separator + ""data"";
+        String defaultDataDirectory = combinedConfigs.getString(VOLDEMORT_HOME) + File.separator + ""data"";
+        String dataDirectory = combinedConfigs.getString(DATA_DIRECTORY, defaultDataDirectory);
         dynamicDefaults.put(DATA_DIRECTORY, dataDirectory);
         dynamicDefaults.put(BDB_DATA_DIRECTORY, dataDirectory + File.separator + ""bdb"");
         dynamicDefaults.put(READONLY_DATA_DIRECTORY, dataDirectory + File.separator + ""read-only"");",0
fix #5468: eager hooks onError call," 
     @Override
     public void onError(Throwable e) {
-        RxJavaHooks.onError(e);
         if (done) {
+            RxJavaHooks.onError(e);
             return;
         }
         done = true;",0
Fix Circle.contains," 	/** @param c the other {@link Circle}
 	 * @return whether this circle contains the other circle. */
 	public boolean contains (Circle c) {
+		final float radiusDiff = radius - c.radius;
+		if (radiusDiff < 0f) return false; // Can't contain bigger circle
 		final float dx = x - c.x;
 		final float dy = y - c.y;
 		final float dst = dx * dx + dy * dy;
-		final float radiusDiff = radius - c.radius;
 		final float radiusSum = radius + c.radius;
 		return (!(radiusDiff * radiusDiff < dst) && (dst < radiusSum * radiusSum));
 	}",0
fix do not close socket output correctly," 
     private void closeSocketOutput(Socket socket) {
         try {
-            if (socket.isOutputShutdown()) {
+            if (!socket.isOutputShutdown()) {
                 socket.shutdownOutput();
             }
         } catch (IOException e) {",0
[V3] Bug/expandable no intercept,"             if (!expandable.isExpanded() && expandable.getSubItems() != null && expandable.getSubItems().size() > 0) {
                 IAdapter<Item> adapter = mFastAdapter.getAdapter(position);
                 if (adapter != null && adapter instanceof IItemAdapter) {
-                    ((IItemAdapter<?, Item>) adapter).add(position + 1, expandable.getSubItems());
+                    ((IItemAdapter<?, Item>) adapter).addInternal(position + 1, expandable.getSubItems());
                 }
 
                 //remember that this item is now opened (not collapsed)",0
Fix wrong buffer clear," 
 	private IntBuffer toIntBuffer (int v[], int offset, int count) {
 		ensureBufferCapacity(count << 2);
-		floatBuffer.clear();
+		intBuffer.clear();
 		com.badlogic.gdx.utils.BufferUtils.copy(v, count, offset, intBuffer);
 		return intBuffer;
 	}",0
SelectBox: maxListCount off-by-one bug quick fix," 					height = heightBelow;
 			}
 
-			// Fit items evenly.
-			float itemHeight = list.getItemHeight();
-			float backgroundPadding = getStyle().background.getTopHeight() + getStyle().background.getBottomHeight();
-			height -= backgroundPadding;
-			height -= height % itemHeight;
-			height += backgroundPadding;
-
 			if (below)
 				setY(tmpCoords.y - height);
 			else
@@ -297,6 +290,8 @@
 			setWidth(SelectBox.this.getWidth());
 			setHeight(height);
 
+			float itemHeight = list.getItemHeight();
+
 			scrollToCenter(0, list.getHeight() - selectedIndex * itemHeight - itemHeight / 2, 0, 0);
 			updateVisualScroll();
 ",0
fixed modSuffix ternary expression so it appends -mod when true,"         // Timestamped SNAPSHOT
         actualURI = contentRoot + '/' + uriRoot + identifier.getName() + '-' +
             identifier.getVersion().substring(0, identifier.getVersion().length() - 9) + '-' +
-            timestamp + '-' + buildNumber + (modSuffix ? """" : ""-mod"") + "".zip"";
+            timestamp + '-' + buildNumber + (modSuffix ? ""-mod"" : """") + "".zip"";
       }
     }
     if (actualURI == null) {",0
Fixed filesaver not saving non-java files," 					try {
 						JarEntry etn = new JarEntry(entry.getName());
 						if(history.add(etn))
-							continue;
+						{
 						history.add(etn);
 						out.putNextEntry(etn);
 						try {
-							InputStream in = jfile.getInputStream(entry);
+							InputStream in = jfile.getInputStream(etn);
 							if (in != null) {
 								try {
 									int count;
@@ -216,6 +216,7 @@
 						} finally {
 							out.closeEntry();
 						}
+					}
 					} catch (ZipException ze) {
 						// some jar-s contain duplicate pom.xml entries: ignore it
 						if (!ze.getMessage().contains(""duplicate"")) {",0
FIXED ConcurrentModificationException when adding a request listener to a request that's firing updates,"             if (listRequestListenerForThisRequest == null) {
                 if (request.isProcessable()) {
                     Ln.d(""Adding entry for type %s and cacheKey %s."", request.getResultType(), request.getRequestCacheKey());
-                    listRequestListenerForThisRequest = new HashSet<RequestListener<?>>();
+                    listRequestListenerForThisRequest = Collections.synchronizedSet(new HashSet<RequestListener<?>>());
                     this.mapRequestToRequestListener.put(request, listRequestListenerForThisRequest);
                 }
             } else {
@@ -479,6 +479,7 @@
             }
 
             Ln.v(""Notifying "" + listeners.size() + "" listeners of progress "" + progress);
+            synchronized (listeners) {
             for (final RequestListener<?> listener : listeners) {
                 if (listener != null && listener instanceof RequestProgressListener) {
                     Ln.v(""Notifying %s"", listener.getClass().getSimpleName());
@@ -487,6 +488,7 @@
             }
         }
     }
+    }
 
     private static class ResultRunnable<T> implements Runnable {
 
@@ -512,6 +514,7 @@
 
             final String resultMsg = spiceException == null ? ""success"" : ""failure"";
             Ln.v(""Notifying "" + listeners.size() + "" listeners of request "" + resultMsg);
+            synchronized (listeners) {
             for (final RequestListener<?> listener : listeners) {
                 if (listener != null) {
                     @SuppressWarnings(""unchecked"")
@@ -526,6 +529,7 @@
             }
         }
     }
+    }
 
     @Override
     public String toString() {",0
fix issue #72: java.io.IOException: Crash when open keepmapping with …,"                 HashMap<String, String> fileMapping = config.mOldFileMapping;
                 List<String> keepFileNames = new ArrayList<String>();
                 //这里面为了兼容以前，也需要用以前的文件名前缀，即res混淆成什么
-                String resRoot = null;
+                String resRoot = TypedValue.RES_FILE_PATH;
                 for (String name : fileMapping.values()) {
                     int dot = name.indexOf(""/"");
                     if (dot == -1) {",0
"Fix anagram clue ""A Basic Anti Pot"""," {
 	private static final Set<AnagramClue> CLUES = ImmutableSet.of(
 		new AnagramClue(""A BAKER"", ""Baraek"", new WorldPoint(3217, 3434, 0), ""Varrock square"", ""5""),
-		new AnagramClue(""A BASIC ANTI POT"", ""Captain Tobias"", new WorldPoint(3026, 3216, 0), ""Port Sarim"", ""7""),
+		new AnagramClue(""A BASIC ANTI POT"", ""Captain Tobias"", new WorldPoint(3026, 3216, 0), ""Port Sarim"", ""6""),
 		new AnagramClue(""A HEART"", ""Aretha"", new WorldPoint(1814, 3851, 0), ""Soul altar"", ""2""),
 		new AnagramClue(""A ZEN SHE"", ""Zenesha"", new WorldPoint(2652, 3295, 0), ""Platebody Southern Ardougne centre square""),
 		new AnagramClue(""ACE MATCH ELM"", ""Cam The Camel"", new WorldPoint(3300, 3231, 0), ""North of the glider in Al Kharid""),",0
Fix the adapter index to getItemId() to include the mFirstPosition offse...,"                 final View view = getChildAt(motionPosition); // a fix by @pboos
 
                 if (view != null) {
-                    performItemClick(view, motionPosition + mFirstPosition, adapter.getItemId(motionPosition));
+                    performItemClick(view, motionPosition + mFirstPosition, adapter.getItemId(motionPosition + mFirstPosition));
                 }
             }
         }",0
Proposed fix for issue #250 - live wallpaper freezes," import java.util.Timer;
 
 public class TimerManager {
-	private static TimerManager mInstance;
+	private static final ThreadLocal<TimerManager> mThreadLocalManager =
+		new ThreadLocal<TimerManager>();
 	private Stack<Timer> mTimers;
 	
 	private TimerManager() {
@@ -33,7 +34,13 @@
 	
 	public static TimerManager getInstance()
 	{
-		if(mInstance == null) mInstance = new TimerManager();
-		return mInstance;
+		TimerManager instance = mThreadLocalManager.get();
+		if(instance == null)
+		{
+			instance = new TimerManager();
+			mThreadLocalManager.set(instance);
+		}
+
+		return instance;
 	}
 }",0
Fixes #2088,"             String callingClass = classContexts.length > 3 ? classContexts[4].getName() : ""none"";
             String callingParent = classContexts.length > 4 ? classContexts[5].getName() : ""none"";
             // FML is allowed to call system exit and the Minecraft applet (from the quit button)
-            if (!(callingClass.startsWith(""net.minecraftforge.fml."") || ( ""net.minecraft.client.Minecraft"".equals(callingClass) && ""net.minecraft.client.Minecraft"".equals(callingParent)) || (""net.minecraft.server.dedicated.DedicatedServer"".equals(callingClass) && ""net.minecraft.server.MinecraftServer"".equals(callingParent))))
+            if (!(callingClass.startsWith(""net.minecraftforge.fml."") || ""net.minecraft.server.dedicated.ServerHangWatchdog$1"".equals(callingClass) || ""net.minecraft.server.dedicated.ServerHangWatchdog"".equals(callingClass) || ( ""net.minecraft.client.Minecraft"".equals(callingClass) && ""net.minecraft.client.Minecraft"".equals(callingParent)) || (""net.minecraft.server.dedicated.DedicatedServer"".equals(callingClass) && ""net.minecraft.server.MinecraftServer"".equals(callingParent))))
             {
                 throw new ExitTrappedException();
             }",0
Fix accidental dismiss onClick," 			float velocityY = Math.abs(mVelocityTracker.getYVelocity());
 			boolean dismiss = false;
 			boolean dismissRight = false;
-			if (Math.abs(deltaX) > mViewWidth / 2) {
+			final float absDeltaX = Math.abs(deltaX);
+			if (absDeltaX > mViewWidth / 2) {
 				dismiss = true;
 				dismissRight = deltaX > 0;
-			} else if (mMinFlingVelocity <= velocityX && velocityX <= mMaxFlingVelocity && velocityY < velocityX) {
+			} else if (mMinFlingVelocity <= velocityX && velocityX <= mMaxFlingVelocity && velocityY < velocityX && absDeltaX > mSlop) {
 				dismiss = true;
 				dismissRight = mVelocityTracker.getXVelocity() > 0;
 			}",0
Fix NullPointerException," import org.axonframework.commandhandling.model.Repository;
 import org.axonframework.common.annotation.AnnotationUtils;
 import org.axonframework.common.transaction.TransactionManager;
-import org.axonframework.config.*;
+import org.axonframework.config.AggregateConfigurer;
+import org.axonframework.config.Configuration;
+import org.axonframework.config.Configurer;
+import org.axonframework.config.DefaultConfigurer;
+import org.axonframework.config.EventHandlingConfiguration;
+import org.axonframework.config.ModuleConfiguration;
+import org.axonframework.config.SagaConfiguration;
 import org.axonframework.eventhandling.EventBus;
 import org.axonframework.eventhandling.EventMessage;
 import org.axonframework.eventhandling.saga.ResourceInjector;
@@ -23,14 +29,15 @@
 import org.axonframework.spring.stereotype.Saga;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
-import org.springframework.beans.BeanUtils;
 import org.springframework.beans.BeansException;
 import org.springframework.beans.factory.BeanFactory;
 import org.springframework.beans.factory.BeanFactoryAware;
 import org.springframework.beans.factory.config.BeanDefinition;
 import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;
 import org.springframework.beans.factory.config.RuntimeBeanReference;
-import org.springframework.beans.factory.support.*;
+import org.springframework.beans.factory.support.BeanDefinitionReaderUtils;
+import org.springframework.beans.factory.support.BeanDefinitionRegistry;
+import org.springframework.beans.factory.support.ManagedList;
 import org.springframework.context.ApplicationContext;
 import org.springframework.context.annotation.DeferredImportSelector;
 import org.springframework.context.annotation.ImportBeanDefinitionRegistrar;
@@ -109,16 +116,21 @@
     private void registerDefaultEventHandlerConfiguration(BeanDefinitionRegistry registry) {
         List<RuntimeBeanReference> beans = new ManagedList<>();
         beanFactory.getBeanNamesIterator().forEachRemaining(bean -> {
+            if (!beanFactory.isFactoryBean(bean)) {
             Class<?> beanType = beanFactory.getType(bean);
             if (beanFactory.containsBeanDefinition(bean) && beanFactory.getBeanDefinition(bean).isSingleton()) {
                 boolean hasHandler = StreamSupport.stream(methodsOf(beanType).spliterator(), false)
-                        .map(m -> AnnotationUtils.findAnnotationAttributes(m, MessageHandler.class).orElse(null))
+                                                      .map(m -> AnnotationUtils
+                                                              .findAnnotationAttributes(m, MessageHandler.class)
+                                                              .orElse(null))
                         .filter(Objects::nonNull)
-                        .anyMatch(attr -> EventMessage.class.isAssignableFrom((Class) attr.get(""messageType"")));
+                                                      .anyMatch(attr -> EventMessage.class
+                                                              .isAssignableFrom((Class) attr.get(""messageType"")));
                 if (hasHandler) {
                     beans.add(new RuntimeBeanReference(bean));
                 }
             }
+            }
         });
         registry.registerBeanDefinition(""eventHandlingConfiguration"",
                                         genericBeanDefinition(DefaultSpringEventHandlingConfiguration.class)",0
TextField bug: DELETE char not notifying listener," 								delete();
 							}
 						}
-						return true;
 					}
 					if (character != ENTER_DESKTOP && character != ENTER_ANDROID) {
 						if (filter != null && !filter.acceptChar(TextField.this, character)) return true;",0
[java] Fixes to JavaTypeDefinitionSimple," import java.lang.reflect.Type;
 import java.lang.reflect.TypeVariable;
 import java.lang.reflect.WildcardType;
-import java.util.ArrayList;
-import java.util.Collections;
+import java.util.Arrays;
 import java.util.HashSet;
 import java.util.List;
 import java.util.Objects;
@@ -28,7 +27,7 @@
 
 /* default */ class JavaTypeDefinitionSimple extends JavaTypeDefinition {
     private final Class<?> clazz;
-    private final List<JavaTypeDefinition> genericArgs;
+    private final JavaTypeDefinition[] genericArgs;
     // cached because calling clazz.getTypeParameters().length create a new array every time
     private final int typeParameterCount;
     private final boolean isGeneric;
@@ -36,6 +35,7 @@
     private final JavaTypeDefinition enclosingClass;
 
     private static final Logger LOG = Logger.getLogger(JavaTypeDefinitionSimple.class.getName());
+    private static final JavaTypeDefinition[] NO_GENERICS = {};
 
     protected JavaTypeDefinitionSimple(Class<?> clazz, JavaTypeDefinition... boundGenerics) {
         super(EXACT);
@@ -59,12 +59,10 @@
         isRawType = isGeneric && boundGenerics.length == 0;
 
         if (isGeneric) {
-            // Generics will be lazily loaded
-            this.genericArgs = new ArrayList<>(typeParameters.length);
-            // boundGenerics would be empty if this is a raw type, hence the lazy loading
-            Collections.addAll(this.genericArgs, boundGenerics);
+            // Generics will be lazily loaded if not already known
+            this.genericArgs = Arrays.copyOf(boundGenerics, typeParameterCount);
         } else {
-            this.genericArgs = Collections.emptyList();
+            this.genericArgs = NO_GENERICS;
         }
 
         enclosingClass = forClass(clazz.getEnclosingClass());
@@ -82,7 +80,7 @@
 
     @Override
     public boolean isGeneric() {
-        return !genericArgs.isEmpty();
+        return isGeneric;
     }
 
     private JavaTypeDefinition getGenericType(final String parameterName, Method method,
@@ -126,29 +124,22 @@
     @Override
     public JavaTypeDefinition getGenericType(final int index) {
         // Check if it has been lazily initialized first
-        if (genericArgs.size() > index) {
-            final JavaTypeDefinition cachedDefinition = genericArgs.get(index);
+        final JavaTypeDefinition cachedDefinition = genericArgs[index];
             if (cachedDefinition != null) {
                 return cachedDefinition;
             }
-        }
-
-        // Force the list to have enough elements
-        for (int i = genericArgs.size(); i <= index; i++) {
-            genericArgs.add(null);
-        }
 
         /*
-         * Set a default to circuit-brake any recursions (ie: raw types with no generic info)
+         * Set a default to circuit-break any recursions (ie: raw types with no generic info)
          * Object.class is a right answer in those scenarios
          */
-        genericArgs.set(index, forClass(Object.class));
+        genericArgs[index] = forClass(Object.class);
 
         final TypeVariable<?> typeVariable = clazz.getTypeParameters()[index];
         final JavaTypeDefinition typeDefinition = resolveTypeDefinition(typeVariable.getBounds()[0]);
 
         // cache result
-        genericArgs.set(index, typeDefinition);
+        genericArgs[index] = typeDefinition;
         return typeDefinition;
     }
 
@@ -279,7 +270,7 @@
                 .append("", genericArgs=["");
 
         // Forcefully resolve all generic types
-        for (int i = 0; i < genericArgs.size(); i++) {
+        for (int i = 0; i < genericArgs.length; i++) {
             getGenericType(i);
         }
 
@@ -287,7 +278,7 @@
             sb.append(jtd.shallowString()).append("", "");
         }
 
-        if (!genericArgs.isEmpty()) {
+        if (genericArgs.length != 0) {
             sb.replace(sb.length() - 3, sb.length() - 1, """");   // remove last comma
         }
 ",0
Fix show partitions bug,"     public List<Partition> getPartitions(TableHandle table, Optional<Map<ColumnHandle, Object>> bindings)
     {
         checkNotNull(table, ""table is null"");
-        return getConnectorSplitManager(table).getPartitions(table, bindings.get());
+        return getConnectorSplitManager(table).getPartitions(table, bindings.or(ImmutableMap.<ColumnHandle, Object>of()));
     }
 
     private List<Partition> prunePartitions(Session session, List<Partition> partitions, Expression predicate, Map<ColumnHandle, Symbol> columnToSymbol)",0
Fixed incorrect registration of new block families client-side.,"                     logger.error(""Missing id for block {} in registered family {}"", block.getURI(), familyUri);
                     block.setId(UNKNOWN_ID);
                 }
-                registerFamily(family);
             }
+            registerFamily(family);
         } else {
             logger.error(""Block family not available: {}"", familyUri);
         }",0
[bug fix] to support Jetty 8.0,"                     return target.toBytecode();
                 }
 
-                InstrumentMethod jetty8HandleMethodEditorBuilder = target.getDeclaredMethod(""handle"", ""org.eclipse.jetty.server.AbstractHttpConnection"");
-                if (jetty8HandleMethodEditorBuilder != null) {
-                    jetty8HandleMethodEditorBuilder.addInterceptor(""com.navercorp.pinpoint.plugin.jetty.interceptor.Jetty8ServerHandleInterceptor"", va(config.getJettyExcludeUrlFilter()));
+                InstrumentMethod jetty80HandleMethodEditorBuilder = target.getDeclaredMethod(""handle"", ""org.eclipse.jetty.server.HttpConnection"");
+                if (jetty80HandleMethodEditorBuilder != null) {
+                    jetty80HandleMethodEditorBuilder.addInterceptor(""com.navercorp.pinpoint.plugin.jetty.interceptor.Jetty8ServerHandleInterceptor"", va(config.getJettyExcludeUrlFilter()));
+                    return target.toBytecode();
+                }
+
+                InstrumentMethod jetty82HandleMethodEditorBuilder = target.getDeclaredMethod(""handle"", ""org.eclipse.jetty.server.AbstractHttpConnection"");
+                if (jetty82HandleMethodEditorBuilder != null) {
+                    jetty82HandleMethodEditorBuilder.addInterceptor(""com.navercorp.pinpoint.plugin.jetty.interceptor.Jetty8ServerHandleInterceptor"", va(config.getJettyExcludeUrlFilter()));
                     return target.toBytecode();
                 }
 ",0
"Made active scan progress consistent with spider, show progress of 100 if scan is stopped"," 			activeScan = getActiveScan(params);
 			int progress = 0;
 			if (activeScan != null) {
+				if (activeScan.isStopped()) {
+					progress = 100;
+				} else {
 				progress = activeScan.getProgress();
 			}
+			}
 			result = new ApiResponseElement(name, String.valueOf(progress));
 			break;
 		case VIEW_SCANS:",0
Temporary fixing problem with start not java stack,"     private final MavenProjectManager   projectManager;
     private final MavenTerminal         terminal;
     private final MavenProgressNotifier notifier;
-    private final File                  localRepository;
+    private File                        localRepository;
 
     @Inject
     public ClasspathManager(@Named(""che.user.workspaces.storage"") String workspacePath,
@@ -80,6 +80,11 @@
         MavenServerWrapper mavenServer = wrapperManager.getMavenServer(MavenWrapperManager.ServerType.DOWNLOAD);
         try {
             localRepository = mavenServer.getLocalRepository();
+        }
+         catch (RuntimeException e) {
+             // We can got this exception if maven not install in system
+             // This is temporary solution will be fix more accurate in https://jira.codenvycorp.com/browse/CHE-1120
+            LOG.error(""Maven server not started looks like you don't have Maven in your path"");
         } finally {
             wrapperManager.release(mavenServer);
         }",0
[UNDERTOW-1142] fix of two minor typos in log messages,"     @Message(id = 38, value = ""Authentication failed, requested user name '%s'"")
     String authenticationFailed(final String userName);
 
-    @Message(id = 39, value = ""To many query parameters, cannot have more than %s query parameters"")
+    @Message(id = 39, value = ""Too many query parameters, cannot have more than %s query parameters"")
     BadRequestException tooManyQueryParameters(int noParams);
 
-    @Message(id = 40, value = ""To many headers, cannot have more than %s header"")
+    @Message(id = 40, value = ""Too many headers, cannot have more than %s header"")
     String tooManyHeaders(int noParams);
 
     @Message(id = 41, value = ""Channel is closed"")",0
Fixed #1065. Add information about doNothing() method to CannotStubVo…,"                 ""'"" + methodName + ""' is a *void method* and it *cannot* be stubbed with a *return value*!"",
                 ""Voids are usually stubbed with Throwables:"",
                 ""    doThrow(exception).when(mock).someVoidMethod();"",
+                ""If you need to set the void method to do nothing you can use:"",
+                ""    doNothing().when(mock).someVoidMethod();"",
+                ""For more information, check out the javadocs for Mockito.doNothing()."",
                 ""***"",
                 ""If you're unsure why you're getting above error read on."",
                 ""Due to the nature of the syntax above problem might occur because:"",",0
Fix logger initialization in QuartzHelper to the right class," 
 public final class QuartzHelper {
 
-    public static final Logger LOG = LoggerFactory.getLogger(QuartzEndpoint.class);
+    public static final Logger LOG = LoggerFactory.getLogger(QuartzHelper.class);
 
     private QuartzHelper() {
+        // prevent instantiation
     }
 
     public static String getQuartzContextName(CamelContext camelContext) {
@@ -38,6 +39,14 @@
         }
     }
 
+    /**
+     * Adds the current CamelContext name and endpoint URI to the Job's jobData
+     * map.
+     * 
+     * @param camelContext The currently active camelContext
+     * @param jobDetail The job for which the jobData map shall be updated
+     * @param endpointUri URI of the endpoint name, if any. May be {@code null}
+     */
     public static void updateJobDataMap(CamelContext camelContext, JobDetail jobDetail, String endpointUri) {
         // Store this camelContext name into the job data
         JobDataMap jobDataMap = jobDetail.getJobDataMap();",0
fix bug: upload more than 2 files in a single post request will be failed,"         }
 
         public long getTotalLength() {
-            long streamLength = file.length();
+            long streamLength = file.length() + CR_LF.length;
             return header.length + streamLength;
         }
 ",0
Fix Regex error in NodeTaskExecutor #192," package com.github.eirslett.maven.plugins.frontend.lib;
 
-import static com.github.eirslett.maven.plugins.frontend.lib.Utils.*;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 import java.io.File;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
 
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
+import static com.github.eirslett.maven.plugins.frontend.lib.Utils.*;
 
 abstract class NodeTaskExecutor {
+    private static final String DS = ""//"";
+    private static final String AT = ""@"";
+    
     private final Logger logger;
     private final String taskName;
     private final String taskLocation;
@@ -62,10 +65,36 @@
             final String s = clonedArguments.get(i);
             final boolean maskMavenProxyPassword = s.contains(""proxy="");
             if (maskMavenProxyPassword) {
-                final String first = s.replaceFirst(""//(?<keep>.*):.*@"", ""//${keep}:***@"");
-                clonedArguments.set(i, first);
+                final String bestEffortMaskedPassword = maskPassword(s);
+                clonedArguments.set(i, bestEffortMaskedPassword);
             }
         }
         return ""'"" + taskName + "" "" + implode("" "", clonedArguments) + ""'"";
     }
+
+    private static String maskPassword(String proxyString) {
+        String retVal = proxyString;
+        if (proxyString != null && !"""".equals(proxyString.trim())) {
+            boolean hasSchemeDefined = proxyString.contains(""http:"") || proxyString.contains(""https:"");
+            boolean hasProtocolDefined = proxyString.contains(DS);
+            boolean hasAtCharacterDefined = proxyString.contains(AT);
+            if (hasSchemeDefined && hasProtocolDefined && hasAtCharacterDefined) {
+                final int firstDoubleSlashIndex = proxyString.indexOf(DS);
+                final int lastAtCharIndex = proxyString.lastIndexOf(AT);
+                boolean hasPossibleURIUserInfo = firstDoubleSlashIndex < lastAtCharIndex;
+                if (hasPossibleURIUserInfo) {
+                    final String userInfo = proxyString.substring(firstDoubleSlashIndex + DS.length(), lastAtCharIndex);
+                    final String[] userParts = userInfo.split("":"");
+                    if (userParts.length > 0) {
+                        final int startOfUserNameIndex = firstDoubleSlashIndex + DS.length();
+                        final int firstColonInUsernameOrEndOfUserNameIndex = startOfUserNameIndex + userParts[0].length();
+                        final String leftPart = proxyString.substring(0, firstColonInUsernameOrEndOfUserNameIndex);
+                        final String rightPart = proxyString.substring(lastAtCharIndex);
+                        retVal = leftPart + "":***"" + rightPart;
+                    }
+                }
+            }
+        }
+        return retVal;
+    }
 }",0
Fix return type for method getMethodParameter,"         String methodKey = method + ""."" + key;
         Number n = getNumbers().get(methodKey);
         if (n != null) {
-            return n.intValue();
+            return n.doubleValue();
         }
         String value = getMethodParameter(method, key);
         if (StringUtils.isEmpty(value)) {
@@ -742,7 +742,7 @@
         String methodKey = method + ""."" + key;
         Number n = getNumbers().get(methodKey);
         if (n != null) {
-            return n.intValue();
+            return n.floatValue();
         }
         String value = getMethodParameter(method, key);
         if (StringUtils.isEmpty(value)) {
@@ -757,7 +757,7 @@
         String methodKey = method + ""."" + key;
         Number n = getNumbers().get(methodKey);
         if (n != null) {
-            return n.intValue();
+            return n.longValue();
         }
         String value = getMethodParameter(method, key);
         if (StringUtils.isEmpty(value)) {",0
Race fixed in HAManager,"       List<String> nodes = clusterManager.getNodes();
 
       for (Map.Entry<String, String> entry: clusterMap.entrySet()) {
-        if (!nodes.contains(entry.getKey())) {
+        if (!leftNodeID.equals(entry.getKey()) && !nodes.contains(entry.getKey())) {
           checkFailover(entry.getKey(), new JsonObject(entry.getValue()));
         }
       }",0
A bux fix for issue #340,"         moveDelta.scale(delta);
 
         // Note: No stepping underwater, no issue with slopes
-        MoveResult moveResult = move(location.getWorldPosition(), moveDelta, 0, -1, movementComp.collider);
+        MoveResult moveResult = move(location.getWorldPosition(), moveDelta, 0, 0.1f, movementComp.collider);
         Vector3f distanceMoved = new Vector3f(moveResult.finalPosition);
         distanceMoved.sub(location.getWorldPosition());
 ",0
Fix V20161130141500_DefaultStreamRecalcIndexRanges," 
 import org.graylog2.indexer.IndexSet;
 import org.graylog2.indexer.IndexSetRegistry;
+import org.graylog2.indexer.MongoIndexSet;
 import org.graylog2.indexer.cluster.Cluster;
+import org.graylog2.indexer.indexset.IndexSetConfig;
+import org.graylog2.indexer.indexset.IndexSetService;
 import org.graylog2.indexer.indices.TooManyAliasesException;
 import org.graylog2.indexer.ranges.CreateNewSingleIndexRangeJob;
 import org.graylog2.indexer.ranges.IndexRange;
 import org.graylog2.indexer.ranges.IndexRangeService;
+import org.mongojack.DBQuery;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -36,16 +40,22 @@
     private static final Logger LOG = LoggerFactory.getLogger(V20161130141500_DefaultStreamRecalcIndexRanges.class);
 
     private final IndexSetRegistry indexSetRegistry;
+    private final IndexSetService indexSetService;
+    private final MongoIndexSet.Factory indexSetFactory;
     private final IndexRangeService indexRangeService;
     private final CreateNewSingleIndexRangeJob.Factory rebuildIndexRangeJobFactory;
     private final Cluster cluster;
 
     @Inject
     public V20161130141500_DefaultStreamRecalcIndexRanges(final IndexSetRegistry indexSetRegistry,
+                                                          final IndexSetService indexSetService,
+                                                          final MongoIndexSet.Factory indexSetFactory,
                                                           final IndexRangeService indexRangeService,
                                                           final CreateNewSingleIndexRangeJob.Factory rebuildIndexRangeJobFactory,
                                                           final Cluster cluster) {
         this.indexSetRegistry = indexSetRegistry;
+        this.indexSetService = indexSetService;
+        this.indexSetFactory = indexSetFactory;
         this.indexRangeService = indexRangeService;
         this.rebuildIndexRangeJobFactory = rebuildIndexRangeJobFactory;
         this.cluster = cluster;
@@ -58,7 +68,18 @@
 
     @Override
     public void upgrade() {
-        final IndexSet defaultIndexSet = indexSetRegistry.getDefault();
+        IndexSet indexSet;
+        try {
+            indexSet = indexSetRegistry.getDefault();
+        } catch (IllegalStateException e) {
+            // Try to find the default index set manually if the index set registry cannot find it.
+            // This is needed if you run this migration with a 2.2.0-beta.2 state before commit 460cac6af.
+            final IndexSetConfig indexSetConfig = indexSetService.findOne(DBQuery.is(""default"", true))
+                    .orElseThrow(() -> new IllegalStateException(""No default index set configured! This is a bug!""));
+            indexSet = indexSetFactory.create(indexSetConfig);
+        }
+
+        final IndexSet defaultIndexSet = indexSet;
 
         if (!cluster.isConnected()) {
             LOG.info(""Cluster not connected yet, delaying migration until it is reachable."");",0
Fix NPE in SqlTaskExecution.isFinished,"         @Override
         public synchronized boolean isFinished()
         {
+            if (closed) {
+                return true;
+            }
+
+            if (driver == null) {
+                return false;
+            }
+
             return driver.isFinished();
         }
 ",0
fixed docs for storage.lock.expiry-time,"      * This value should be a small multiple of the average consistent write time.
      */
     public static final ConfigOption<Duration> LOCK_WAIT = new ConfigOption<>(LOCK_NS, ""wait-time"",
-            ""Number of milliseconds the system waits for a lock application to be acknowledged by the storage backend"",
+            ""Number of milliseconds the system waits for a lock application to be acknowledged by the storage backend. "" +
+            ""Also, the time waited at the end of all lock applications before verifying that the applications were successful. "" +
+            ""This value should be a small multiple of the average consistent write time."",
             ConfigOption.Type.GLOBAL_OFFLINE, Duration.ofMillis(100L));
 //    public static final String LOCK_WAIT_MS = ""lock-wait-time"";
 //    public static final long LOCK_WAIT_MS_DEFAULT = 100;
@@ -588,7 +590,10 @@
      * held applications are expired pre-maturely and as small as possible to avoid dead lock.
      */
     public static final ConfigOption<Duration> LOCK_EXPIRE = new ConfigOption<>(LOCK_NS, ""expiry-time"",
-            ""Number of milliseconds the system waits for a lock application to be acknowledged by the storage backend"",
+            ""Number of milliseconds after which a lock is considered to have expired. "" +
+            ""Lock applications that were not released are considered expired after this time and released. "" +
+            ""This value should be larger than the maximum time a transaction can take in order to guarantee "" +
+            ""that no correctly held applications are expired pre-maturely and as small as possible to avoid dead lock."",
             ConfigOption.Type.GLOBAL_OFFLINE, Duration.ofMillis(300 * 1000L));
 //    public static final String LOCK_EXPIRE_MS = ""lock-expiry-time"";
 //    public static final long LOCK_EXPIRE_MS_DEFAULT = 300 * 1000;",0
fixed bug regarding Validation.flatMap,"                 return value.isEmpty() ? /*TODO(#1034)*/invalid(null) : valid(value.get());
             } else {
                 final java.util.Iterator<? extends U> iterator = iterable.iterator();
-                return iterator.hasNext() ? /*TODO(#1034)*/invalid(null) : valid(iterator.next());
+                return iterator.hasNext() ? valid(iterator.next()) : /*TODO(#1034)*/invalid(null);
             }
         }
     }",0
Fixed bug when asking for dpi on retina devices," 
 // FIXME add GL 1.x support by ripping Android's classes
 public class IOSGraphics extends iPhoneOSGameView implements Graphics {
+
+	private static final String tag = ""IOSGraphics"";
+
 	IOSApplication app;
 	IOSInput input;
 	IOSGLES20 gl20;
@@ -68,7 +71,7 @@
 		// setup view and OpenGL
 		width = (int)bounds.get_Width();
 		height = (int)bounds.get_Height();
-		app.debug(""IOSGraphics"", bounds.get_Width() + ""x"" + bounds.get_Height() + "", "" + UIScreen.get_MainScreen().get_Scale());
+		app.debug(tag, bounds.get_Width() + ""x"" + bounds.get_Height() + "", "" + UIScreen.get_MainScreen().get_Scale());
 		this.app = app;
 		this.input = input;
 		set_LayerRetainsBacking(false);
@@ -84,14 +87,14 @@
 		Gdx.gl20 = gl20;
 
 		// determine display density and PPI (PPI values via Wikipedia!)
-		if ((UIScreen.get_MainScreen().RespondsToSelector(new Selector(""scale:"")))
-			&& (UIScreen.get_MainScreen().get_Scale() == 2.0f)) {
-			// Retina display!
-			density = 2.0f;
-		} else {
-			// regular display
-			density = 1.0f;
+		density = 1f;
+
+		if ((UIScreen.get_MainScreen().RespondsToSelector(new Selector(""scale"")))) {
+			float scale = UIScreen.get_MainScreen().get_Scale();
+			app.debug(tag, ""Calculating density, UIScreen.mainScreen.scale: "" + scale);
+			if (scale == 2f) density = 2f;
 		}
+
 		int ppi;
 		if (UIDevice.get_CurrentDevice().get_UserInterfaceIdiom().Value == UIUserInterfaceIdiom.Pad) {
 			// iPad
@@ -104,7 +107,7 @@
 		ppiY = ppi;
 		ppcX = ppiX / 2.54f;
 		ppcY = ppcY / 2.54f;
-		app.debug(""IOSGraphics"", ""Display: ppi="" + ppi + "", density="" + density);
+		app.debug(tag, ""Display: ppi="" + ppi + "", density="" + density);
 
 		// time + FPS
 		lastFrameTime = System.nanoTime();",0
Fix missing return statement in FastConcurrentDirectDeque.getUnsafe," 
     private static Unsafe getUnsafe() {
         if (System.getSecurityManager() != null) {
-            AccessController.doPrivileged(new PrivilegedAction<Unsafe>() {
+            return AccessController.doPrivileged(new PrivilegedAction<Unsafe>() {
                 public Unsafe run() {
                     return getUnsafe0();
                 }",0
Fix for #3486 (Hiero deadlocks on exit)," 	JTextPane sampleTextPane;
 	JSpinner padAdvanceXSpinner;
 	JList effectsList;
+	LwjglCanvas rendererCanvas;
 	JPanel gamePanel;
 	JTextField fontFileText;
 	JRadioButton fontFileRadio;
@@ -170,7 +171,8 @@
 		initialize();
 		splash.close();
 
-		gamePanel.add(new LwjglCanvas(new Renderer()).getCanvas());
+		rendererCanvas = new LwjglCanvas(new Renderer());
+		gamePanel.add(rendererCanvas.getCanvas());
 
 		prefs = Preferences.userNodeForPackage(Hiero.class);
 		java.awt.Color backgroundColor = EffectUtil.fromString(prefs.get(""background"", ""000000""));
@@ -238,7 +240,7 @@
 				saveBm(f);
 			} else {
 				System.err.println(""Unknown parameter: "" + param);
-				System.exit(3);
+				exit(3);
 			}
 		}
 
@@ -377,6 +379,16 @@
 		updateFont();
 	}
 
+	void exit (final int exitCode) {
+		rendererCanvas.stop();
+		EventQueue.invokeLater(new Runnable() {
+			@Override
+			public void run () {
+				System.exit(exitCode);
+			}
+		});
+	}
+
 	private void initializeEvents () {
 		fontList.addListSelectionListener(new ListSelectionListener() {
 			public void valueChanged (ListSelectionEvent evt) {
@@ -1412,7 +1424,7 @@
 					bmFont.save(saveBmFontFile);
 
 					if (batchMode) {
-						System.exit(0);
+						exit(0);
 					}
 				} catch (Throwable ex) {
 					System.out.println(""Error saving BMFont files: "" + saveBmFontFile.getAbsolutePath());",0
Fix settings on screen rotation,"             actionBar.setDisplayShowTitleEnabled(true);
         }
 
+        if (savedInstanceBundle == null) {
         getFragmentManager().beginTransaction()
                 .replace(R.id.fragment_holder,  new SettingsFragment())
                 .commit();
     }
+    }
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {",0
Allow Message.RESERVED_SETTABLE_FIELDS fields set by a GELF message.,"             }
 
             // Skip standard or already set fields.
-            if (message.getField(key) != null || Message.RESERVED_FIELDS.contains(key)) {
+            if (message.getField(key) != null || (Message.RESERVED_FIELDS.contains(key) && !Message.RESERVED_SETTABLE_FIELDS.contains(key))) {
                 continue;
             }
 ",0
Fix iioobe bottom tab,"             bottomTabs.setBackgroundColor(options.backgroundColor.get());
         }
         if (options.currentTabIndex.hasValue()) {
-            bottomTabs.setCurrentItem(options.currentTabIndex.get());
+            int tabIndex = options.currentTabIndex.get();
+            if (tabIndex >= 0) bottomTabs.setCurrentItem(tabIndex);
         }
         if (options.testId.hasValue()) {
             bottomTabs.setTag(options.testId.get());",0
Fix loading of large embedded album art," import com.bumptech.glide.Priority;
 import com.bumptech.glide.load.data.DataFetcher;
 
+import org.jaudiotagger.audio.exceptions.InvalidAudioFrameException;
+import org.jaudiotagger.audio.exceptions.ReadOnlyFileException;
+import org.jaudiotagger.audio.mp3.MP3File;
+import org.jaudiotagger.tag.TagException;
+import org.jaudiotagger.tag.images.Artwork;
+
 import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.FileInputStream;
@@ -48,6 +54,24 @@
     private static final String[] FALLBACKS = {""cover.jpg"", ""album.jpg"", ""folder.jpg"", ""cover.png"", ""album.png"", ""folder.png""};
 
     private InputStream fallback(String path) throws FileNotFoundException {
+        // Method 1: use embedded high resolution album art if there is any
+        try {
+            MP3File mp3File = new MP3File(path);
+            if (mp3File.hasID3v2Tag()) {
+                Artwork art = mp3File.getTag().getFirstArtwork();
+                if (art != null) {
+                    byte[] imageData = art.getBinaryData();
+                    return new ByteArrayInputStream(imageData);
+                }
+            }
+        // If there are any exceptions, we ignore them and continue to the other fallback method
+        } catch (ReadOnlyFileException ignored) {
+        } catch (InvalidAudioFrameException ignored) {
+        } catch (TagException ignored) {
+        } catch (IOException ignored) {
+        }
+
+        // Method 2: look for album art in external files
         File parent = new File(path).getParentFile();
         for (String fallback : FALLBACKS) {
             File cover = new File(parent, fallback);",0
[PDI-17126] Fixes regression for fields without a specified metadata …,"             }
             String string = getString( data );
             int len = string.length();
-            int maxlen = isLengthInvalidOrZero() ? 0 : getLength();
-            if ( len < maxlen ) {
+            int maxlen = isLengthInvalidOrZero() ? len : getLength();
+            if ( len <= maxlen ) {
               preparedStatement.setString( index, string );
             } else {
               // Take the last maxlen characters of the string...",0
fix EOP Error,"                       writePos.moveToNextBuffer();
                       _tail.copy(_currentWritePosition);
                       assert assertBuffersLimits();
+                      preEndPeriodEvent = false;
                     }
                   }
                   else",0
"Revert ""fixing clearing notification bar ""","         mSession.setFlags(MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS
                           | MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS);
     }
-    @Override
-     public void onTaskRemoved(Intent rootIntent){
-        super.onTaskRemoved(rootIntent);
-         cancelNotification();
-     }
+
     @Override
     public void onDestroy() {
         if (D) Log.d(TAG, ""Destroying service"");",0
"Fix #720: On exception abort Future, do not rethrow","             connectionManager.doAsyncTrackedConnection(request, future, connectHandler);
         } catch (Exception e) {
             if (e instanceof RuntimeException) {
-                throw (RuntimeException) e;
+                abort(future, e);
             } else if (e instanceof IOException) {
-                throw (IOException) e;
-            }
+                abort(future, e);
+            } else {
             if (LOGGER.isWarnEnabled()) {
                 LOGGER.warn(e.toString(), e);
+                    abort(future, e);
+                }
             }
         }
 
         return future;
     }
 
+    private void abort(GrizzlyResponseFuture<?> future, Throwable t) {
+        if (!future.isDone()) {
+            LOGGER.debug(""Aborting Future {}\n"", future);
+            LOGGER.debug(t.getMessage(), t);
+            future.abort(t);
+        }
+    }
+
+
     @Override
     public void close() {
 ",0
Bug fixes: add synchronized block to map operation in OfflineStore,"        */
       if (object instanceof ParseInstallation
           && newObjectId == null) {
+        synchronized (lock) {
         classNameAndObjectIdToObjectMap.remove(Pair.create(object.getClassName(), oldObjectId));
+        }
         return;
       } else {
         throw new RuntimeException(""objectIds cannot be changed in offline mode."");",0
Remove unnecesary repeated conditional test in ExtensionManager,"     public List<T> getHandlers() {
         synchronized (LOCK_OBJECT) {
             if (!handlersSorted) {
-                if (!handlersSorted) {
                     Comparator fieldCompare = new BeanComparator(""priority"");
                     Collections.sort(handlers, fieldCompare);
                     handlersSorted = true;
                 }
-            }
             return handlers;
         }
     }",0
Fixes 3.x crashes in applyHeaderPadding - closes #37,"     }
 
     private void applyHeaderPadding(MotionEvent ev) {
-        // Workaround for getPointerCount() which is unavailable in 1.5
-        // (it's always 1 in 1.5)
-        int pointerCount = 1;
-        try {
-            Method method = MotionEvent.class.getMethod(""getPointerCount"");
-            pointerCount = (Integer)method.invoke(ev);
-        } catch (NoSuchMethodException e) {
-            pointerCount = 1;
-        } catch (IllegalArgumentException e) {
-            throw e;
-        } catch (IllegalAccessException e) {
-            System.err.println(""unexpected "" + e);
-        } catch (InvocationTargetException e) {
-            System.err.println(""unexpected "" + e);
-        }
+        // getHistorySize has been available since API 1
+        int pointerCount = ev.getHistorySize();
 
         for (int p = 0; p < pointerCount; p++) {
             if (mRefreshState == RELEASE_TO_REFRESH) {",0
Fix import issue," 
 import org.nd4j.linalg.factory.Nd4jBackend;
 import org.nd4j.linalg.io.Resource;
-import org.nd4j.org.nd4j.linalg.util.Paths;
+import org.nd4j.linalg.util.Paths;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.nd4j.linalg.io.ClassPathResource;",0
Fixed VerifyError when JUnit 3 is in the classpath,"     private static boolean canLoadJunitClass() {
         try {
             JUnitArgsAreDifferent.create(""message"", ""wanted"", ""actual"");
-        } catch (NoClassDefFoundError onlyIfJUnitIsNotAvailable) {
+        } catch (Throwable onlyIfJUnitIsNotAvailable) {
             return false;
         }
         return true;",0
minor fixes based on findBugs feedback,"             init = init.put(init.size(), t);
             if (predicate.test(t)) {
                 if (init.size() == length()) {
-                    Tuple.of(this, empty());
+                    return Tuple.of(this, empty());
                 } else {
                     return Tuple.of(new Vector<>(init), drop(init.size()));
                 }",0
fixed #850 - DelegatingFuture.isDone always returns false until get is c...,"     }
 
     public final boolean isDone() {
-        return done;
+        return done ? done : future.isDone();
     }
 
     protected void setError(Throwable error) {",0
[FIX JENKINS-41662] Input submissions not working if another browser loads the same input step," 
     public InputStepImpl(InputStep inputStep, Reachable parent) {
         this.inputStep = inputStep;
+        if (inputStep.getId() == null) {
+            // Make sure the input step has an ID.
         this.inputStep.setId(UUID.randomUUID().toString().replaceAll(""-"", """"));
+        }
         this.self = parent.getLink().rel(""input"");
     }
 ",0
KEYCLOAK-736 Fix class-path issues,"     }
 
     private Liquibase getLiquibase(Connection connection) throws Exception {
+        ServiceLocator sl = ServiceLocator.getInstance();
+
         if (!System.getProperties().containsKey(""liquibase.scan.packages"")) {
-            System.setProperty(""liquibase.scan.packages"", ""liquibase.change,liquibase.changelog,liquibase.database,liquibase.parser,liquibase.precondition,liquibase.datatype,liquibase.serializer,liquibase.sqlgenerator,liquibase.executor,liquibase.snapshot,liquibase.logging,liquibase.diff,liquibase.structure,liquibase.structurecompare,liquibase.lockservice"");
+            if (sl.getPackages().remove(""liquibase.core"")) {
+                sl.addPackageToScan(""liquibase.core.xml"");
         }
+
+            if (sl.getPackages().remove(""liquibase.parser"")) {
+                sl.addPackageToScan(""liquibase.parser.core.xml"");
+            }
+
+            if (sl.getPackages().remove(""liquibase.serializer"")) {
+                sl.addPackageToScan(""liquibase.serializer.core.xml"");
+            }
+
+            sl.getPackages().remove(""liquibase.ext"");
+            sl.getPackages().remove(""liquibase.sdk"");
+        }
+
         LogFactory.setInstance(new LogWrapper());
         Database database = DatabaseFactory.getInstance().findCorrectDatabaseImplementation(new JdbcConnection(connection));
         return new Liquibase(CHANGELOG, new ClassLoaderResourceAccessor(getClass().getClassLoader()), database);",0
Fix 4208 - Prayer bonus for suffering RI," 	EXPLORERS_RING_3(ItemID.EXPLORERS_RING_3, 1),
 	EXPLORERS_RING_4(ItemID.EXPLORERS_RING_4, 1),
 	RING_OF_SUFFERING(ItemID.RING_OF_SUFFERING, 2),
+	RING_OF_SUFFERING_R(ItemID.RING_OF_SUFFERING_R, 2),
 	RING_OF_SUFFERING_I(ItemID.RING_OF_SUFFERING_I, 4),
+	RING_OF_SUFFERING_RI(ItemID.RING_OF_SUFFERING_RI, 4),
 	RING_OF_THE_GODS(ItemID.RING_OF_THE_GODS, 4),
 	RING_OF_THE_GODS_I(ItemID.RING_OF_THE_GODS_I, 8),
 ",0
Fixed resize view,"             } else {
                 measureTileHeight = desiredTileHeight;
             }
-        } else if (specWidthMode == MeasureSpec.EXACTLY) {
+        } else if (specWidthMode == MeasureSpec.EXACTLY || specWidthMode == MeasureSpec.AT_MOST) {
             if (specHeightMode == MeasureSpec.EXACTLY) {
-                //Pick the larger of the two explicit sizes
-                measureTileSize = Math.max(desiredTileWidth, desiredTileHeight);
+                //Pick the smaller of the two explicit sizes
+                measureTileSize = Math.min(desiredTileWidth, desiredTileHeight);
             } else {
                 //Be the width size the user wants
                 measureTileSize = desiredTileWidth;
             }
-        } else if (specHeightMode == MeasureSpec.EXACTLY) {
+        } else if (specHeightMode == MeasureSpec.EXACTLY || specHeightMode == MeasureSpec.AT_MOST) {
             //Be the height size the user wants
             measureTileSize = desiredTileHeight;
         }",0
fixed javadoc warning to get clean builds,"     }
 
     /**
+     * @return  a Builder of Info level diff events
      * @deprecated use {@link DiffEvent#apiInfo()} instead
      */
     @Deprecated",0
Fix 143 potential context leak,"     }
 
    protected BeaconManager(Context context) {
-      mContext = context;
+      mContext = context.getApplicationContext();
       if (!sManifestCheckingDisabled) {
          verifyServiceDeclaration();
       }",0
[WIP] Small API/build fix,"      * @param <T>
      * @return
      */
-    public <T> T output(@NonNull ModelAdapter<T> adapter, INDArray[] input, INDArray[] inputMasks) {
+    public <T> T output(@NonNull ModelAdapter<T> adapter, INDArray[] input, INDArray[] inputMasks, INDArray[] labelsMasks) {
         val holder = selector.getModelForThisThread();
         Model model = null;
         boolean acquired = false;
         try {
             model = holder.acquireModel();
             acquired = true;
-            return adapter.apply(model, input, inputMasks);
+            return adapter.apply(model, input, inputMasks, labelsMasks);
         } catch (InterruptedException e) {
             throw new RuntimeException(e);
         } finally {",0
Fix NPE in ExtensionLog4j in non dev mode," 
 	    if (getView() != null) {	        
 	        extensionHook.getHookMenu().addToolsMenuItem(getMenuGarbageCollect());
+
+	        if (scanStatus != null) {
 	        extensionHook.addSessionListener(new ResetCounterOnSessionChange(scanStatus));
 	    }
+	    }
 
 	}
 ",0
Fix Eddystone transmissions to meet spec,"                         (byte) ((serviceUuid >> 8) & 0xff)};
                 ParcelUuid parcelUuid = parseUuidFrom(serviceUuidBytes);
                 dataBuilder.addServiceData(parcelUuid, advertisingBytes);
-            }
-            else {
+                dataBuilder.addServiceUuid(parcelUuid);
+                dataBuilder.setIncludeTxPowerLevel(false);
+                dataBuilder.setIncludeDeviceName(false);
+
+            } else {
                 dataBuilder.addManufacturerData(manufacturerCode, advertisingBytes);
             }
 
             AdvertiseSettings.Builder settingsBuilder = new AdvertiseSettings.Builder();
 
             settingsBuilder.setAdvertiseMode(mAdvertiseMode);
-
             settingsBuilder.setTxPowerLevel(mAdvertiseTxPowerLevel);
             settingsBuilder.setConnectable(false);
 ",0
"Minor style fixes, no functional changes","     private static final String statusInProgress = ""IN_PROGRESS"";
     private static final String statusFinished = ""FINISHED"";
 
-
     private final String tenantName;
     private final String applicationName;
     private final String instanceName;
@@ -134,14 +133,14 @@
     private String inProgressOutput(JsonNode hosts) {
         ArrayList<String> statusPerHost = new ArrayList<>();
         for (JsonNode host : hosts) {
-            StringBuilder sb = new StringBuilder();
             String status = host.get(""status"").asText();
-            sb.append(host.get(""hostname"").asText()).append("": "").append(status);
-            if (status.equals(statusUnknown))
+            StringBuilder sb = new StringBuilder(host.get(""hostname"").asText()).append("": "").append(status);
+            switch (status) {
+                case statusUnknown:
                 sb.append("" ("").append(host.get(""message"").asText()).append("")"");
-            else if (status.equals(statusInProgress)) {
+                    break;
+                case statusInProgress:
                 JsonNode fileReferencesArray = host.get(""fileReferences"");
-                int size = fileReferencesArray.size();
                 int finished = 0;
                 for (JsonNode element : fileReferencesArray) {
                     for (Iterator<Map.Entry<String, JsonNode>> it = element.fields(); it.hasNext(); ) {
@@ -150,7 +149,12 @@
                             finished++;
                     }
                 }
-                sb.append("" ("" + finished + "" of "" + size + "" finished)"");
+                    sb.append("" ("" + finished + "" of "" + fileReferencesArray.size() + "" finished)"");
+                    break;
+                case statusFinished:
+                    break; // Nothing to add
+                default:
+                    throw new RuntimeException(""Unknown status "" + status);
             }
             statusPerHost.add(sb.toString());
         }",0
Catch exceptions in AbstractWebSocket," 			if( WebSocketImpl.DEBUG )
 				System.out.println( ""Connection lost timer restarted"" );
 			//Reset all the pings
+			try {
 			ArrayList<WebSocket> connections = new ArrayList<WebSocket>( getConnections() );
 			WebSocketImpl webSocketImpl;
 			for( WebSocket conn : connections ) {
@@ -110,6 +111,10 @@
 					webSocketImpl.updateLastPong();
 				}
 			}
+			} catch (Exception e) {
+				if (WebSocketImpl.DEBUG)
+					System.out.println(""Exception during connection lost restart: "" + e.getMessage());
+			}
 			restartConnectionLostTimer();
 		}
     }
@@ -158,6 +163,7 @@
 			@Override
 			public void run() {
 				connections.clear();
+				try {
 				connections.addAll( getConnections() );
 				long current = (System.currentTimeMillis()-(connectionLostTimeout * 1500));
 				WebSocketImpl webSocketImpl;
@@ -178,6 +184,10 @@
 						}
 					}
 				}
+				} catch ( Exception e ) {
+					if (WebSocketImpl.DEBUG)
+						System.out.println(""Exception during connection lost ping: "" + e.getMessage());
+				}
 				connections.clear();
 			}
 		};",0
Fixed issue #3172,"   public static List<String> getCascadeDeleteFields(String iClassName) {
     if (iClassName == null || iClassName.isEmpty())
       return null;
-    for (Class<?> iClass : cascadeDeleteFields.keySet()) {
+    for (Class<?> iClass : classes) {
       if (iClass.getSimpleName().equals(iClassName))
         return getCascadeDeleteFields(iClass);
     }",0
[java] Fix NPE on UnnecessaryModifierRule,"     private boolean isSafeVarargs(final ASTMethodDeclaration node) {
         for (final ASTAnnotation annotation : node.jjtGetParent().findChildrenOfType(ASTAnnotation.class)) {
             final Node childAnnotation = annotation.jjtGetChild(0);
-            if (childAnnotation instanceof ASTMarkerAnnotation
-                    && SafeVarargs.class.isAssignableFrom(((ASTMarkerAnnotation) childAnnotation).getType())) {
+            if (childAnnotation instanceof ASTMarkerAnnotation) {
+                final ASTMarkerAnnotation marker = (ASTMarkerAnnotation) childAnnotation;
+                if (marker.getType() != null && SafeVarargs.class.isAssignableFrom(marker.getType())) {
                 return true;
             }
         }
+        }
         
         return false;
     }",0
Fix bug with java.lang.ArrayIndexOutOfBoundsException: 30," 
 
   @Override
-  public void publish(LogRecord record) {
+  public synchronized void publish(LogRecord record) {
     if (record.getLevel().intValue() < minimumLevel) {
       return;
     }
@@ -67,12 +67,12 @@
   }
 
   @Override
-  public void flush() {
+  public synchronized void flush() {
     /* NOOP */
   }
 
   @Override
-  public void close() throws SecurityException {
+  public synchronized void close() throws SecurityException {
     for (int i = 0; i < capacity; i++) {
       lastRecords[i] = null;
     }
@@ -95,7 +95,7 @@
     return validRecords.toArray(new LogRecord[validRecords.size()]);
   }
 
-  public String formattedRecords() {
+  public synchronized String formattedRecords() {
     final StringWriter writer;
 
     writer = new StringWriter();",0
Fix RecurrenceModel Parcelable and javadoc," 
     private CalendarDatePickerDialog mDatePickerDialog;
 
-    private class RecurrenceModel implements Parcelable {
+    private static class RecurrenceModel implements Parcelable {
 
         // Should match EventRecurrence.DAILY, etc
         static final int FREQ_DAILY = 0;
@@ -111,10 +111,10 @@
         /**
          * FREQ: Repeat pattern
          *
-         * @see FREQ_DAILY
-         * @see FREQ_WEEKLY
-         * @see FREQ_MONTHLY
-         * @see FREQ_YEARLY
+         * @see #FREQ_DAILY
+         * @see #FREQ_WEEKLY
+         * @see #FREQ_MONTHLY
+         * @see #FREQ_YEARLY
          */
         int freq = FREQ_WEEKLY;
 
@@ -126,11 +126,9 @@
         /**
          * UNTIL and COUNT: How does the the event end?
          *
-         * @see END_NEVER
-         * @see END_BY_DATE
-         * @see END_BY_COUNT
-         * @see untilDate
-         * @see untilCount
+         * @see #END_NEVER
+         * @see #END_BY_DATE
+         * @see #END_BY_COUNT
          */
         int end;
 
@@ -152,8 +150,8 @@
         /**
          * BYDAY AND BYMONTHDAY: How to repeat monthly events? Same date of the month or Same nth day of week.
          *
-         * @see MONTHLY_BY_DATE
-         * @see MONTHLY_BY_NTH_DAY_OF_WEEK
+         * @see #MONTHLY_BY_DATE
+         * @see #MONTHLY_BY_NTH_DAY_OF_WEEK
          */
         int monthlyRepeat;
 
@@ -187,16 +185,17 @@
                     + monthlyByDayOfWeek + "", monthlyByNthDayOfWeek="" + monthlyByNthDayOfWeek + ""]"";
         }
 
+        public RecurrenceModel() {
+        }
+
         @Override
         public int describeContents() {
             return 0;
         }
 
-        public RecurrenceModel() {
-        }
-
         @Override
         public void writeToParcel(Parcel dest, int flags) {
+            dest.writeInt(recurrenceState);
             dest.writeInt(freq);
             dest.writeInt(interval);
             dest.writeInt(end);
@@ -209,8 +208,35 @@
             dest.writeInt(monthlyByMonthDay);
             dest.writeInt(monthlyByDayOfWeek);
             dest.writeInt(monthlyByNthDayOfWeek);
-            dest.writeInt(recurrenceState);
         }
+
+        private RecurrenceModel(Parcel in) {
+            this.recurrenceState = in.readInt();
+            this.freq = in.readInt();
+            this.interval = in.readInt();
+            this.end = in.readInt();
+            this.endDate = new Time();
+            endDate.year = in.readInt();
+            endDate.month = in.readInt();
+            endDate.monthDay = in.readInt();
+            this.endCount = in.readInt();
+            this.weeklyByDayOfWeek = in.createBooleanArray();
+            this.monthlyRepeat = in.readInt();
+            this.monthlyByMonthDay = in.readInt();
+            this.monthlyByDayOfWeek = in.readInt();
+            this.monthlyByNthDayOfWeek = in.readInt();
+        }
+
+        public static final Creator<RecurrenceModel> CREATOR = new Creator<RecurrenceModel>() {
+
+            public RecurrenceModel createFromParcel(Parcel source) {
+                return new RecurrenceModel(source);
+            }
+
+            public RecurrenceModel[] newArray(int size) {
+                return new RecurrenceModel[size];
+            }
+        };
     }
 
     class minMaxTextWatcher implements TextWatcher {",0
Fix Android audio crash fixes Issue #1417,"             groupIndex = getGroupIndexForDefaultLocale(groups);
         }
 
-        if (groupIndex == C.INDEX_UNSET && trackType == C.TRACK_TYPE_VIDEO) { // Video auto
-            if (groups.length != 0) {
+        if (groupIndex == C.INDEX_UNSET && trackType == C.TRACK_TYPE_VIDEO && groups.length != 0) { // Video auto
+            // Add all tracks as valid options for ABR to choose from
                 TrackGroup group = groups.get(0);
                 tracks = new int[group.length];
                 groupIndex = 0;
@@ -984,7 +984,8 @@
                     tracks[j] = j;
                 }
             }
-        } else if (groupIndex == C.INDEX_UNSET) {
+
+        if (groupIndex == C.INDEX_UNSET) {
             trackSelector.setParameters(disableParameters);
             return;
         }",0
Fix the TGC cookie expiration when remember me is enabled,"     private boolean isRememberMeAuthentication(final RequestContext requestContext) {
         final HttpServletRequest request = WebUtils.getHttpServletRequestFromExternalWebflowContext(requestContext);
         final String value = request.getParameter(RememberMeCredential.REQUEST_PARAMETER_REMEMBER_ME);
-        return StringUtils.isNotBlank(value) || WebUtils.isRememberMeAuthenticationEnabled(requestContext);
+        return StringUtils.isNotBlank(value) && WebUtils.isRememberMeAuthenticationEnabled(requestContext);
     }
 
     /**",0
Fixes for issue 88," 
     static {
         try {
-            sClipToWindowEnabledMethod = PopupWindow.class.getDeclaredMethod(
+            sClipToWindowEnabledMethod = android.widget.PopupWindow.class.getDeclaredMethod(
                     ""setClipToScreenEnabled"", boolean.class);
         } catch (NoSuchMethodException e) {
             Log.i(TAG, ""Could not find method setClipToScreenEnabled() on PopupWindow. Oh well."");
@@ -1062,6 +1062,15 @@
         };
     }
 
+    private int getSystemBarHeight(String resourceName) {
+        int height = 0;
+        int resourceId = mContext.getResources().getIdentifier(resourceName, ""dimen"", ""android"");
+        if (resourceId > 0) {
+            height = mContext.getResources().getDimensionPixelSize(resourceId);
+        }
+        return height;
+    }
+
     /**
      * <p>Builds the popup window's content and returns the height the popup
      * should have. Returns -1 when the content already exists.</p>
@@ -1192,11 +1201,21 @@
             mTempRect.setEmpty();
         }       
 
+        int systemBarsReservedSpace = 0;
+        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+            //  getMaxAvailableHeight() on Lollipop seems to ignore the system bars.
+            systemBarsReservedSpace = Math.max(
+                    getSystemBarHeight(""status_bar_height""),
+                    getSystemBarHeight(""navigation_bar_height"")
+            );
+        }
+
         // Max height available on the screen for a popup.
         boolean ignoreBottomDecorations =
                 mPopup.getInputMethodMode() == PopupWindow.INPUT_METHOD_NOT_NEEDED;
         final int maxHeight = mPopup.getMaxAvailableHeight(
-                getAnchorView(), mDropDownVerticalOffset /*, ignoreBottomDecorations*/);
+                getAnchorView(), mDropDownVerticalOffset /*, ignoreBottomDecorations*/)
+                - systemBarsReservedSpace;
         
         if (mDropDownAlwaysVisible || mDropDownHeight == ViewGroup.LayoutParams.MATCH_PARENT) {
             return maxHeight + padding;
@@ -1796,6 +1815,8 @@
             } catch (Exception e) {
                 Log.i(TAG, ""Could not call setClipToScreenEnabled() on PopupWindow. Oh well."");
             }
+        } else if(clip && Build.VERSION.SDK_INT >= Build.VERSION_CODES.CUPCAKE) {
+            mPopup.setClippingEnabled(false);
         }
     }
     ",0
Fix for issue #237," import android.content.Intent;
 import android.os.Build;
 import android.os.Bundle;
+import android.os.SystemClock;
 import android.support.annotation.Nullable;
 
 import com.evernote.android.job.JobProxy;
@@ -94,7 +95,7 @@
     }
 
     protected void plantOneOffExact(JobRequest request, AlarmManager alarmManager, PendingIntent pendingIntent) {
-        long triggerAtMillis = Common.getAverageDelayMs(request);
+        long triggerAtMillis = SystemClock.elapsedRealtime() + Common.getAverageDelayMs(request);
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {
             alarmManager.setExactAndAllowWhileIdle(AlarmManager.ELAPSED_REALTIME_WAKEUP, triggerAtMillis, pendingIntent);
         } else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {",0
Bugfix of Exception Text in JdbcEventStorageEngine,"                 () -> executeQuery(getConnection(),
                                    connection -> connection.prepareStatement(sql),
                                    resultSet -> nextAndExtract(resultSet, 1, Long.class),
-                                   e -> new EventStoreException(""Failed to get head token"")));
+                                   e -> new EventStoreException(""Failed to get tail token"")));
         return Optional.ofNullable(index)
                        .map(seq -> GapAwareTrackingToken.newInstance(seq, Collections.emptySet()))
                        .orElse(null);",0
"Fix for ""ModifierVisitorAdapter tries to modify unmodifiable collection typeArgs #314""","     }
 
     public List<Type> getTypeArguments() {
-        return unmodifiableList(typeArguments);
+        return typeArguments;
     }
 
     public boolean isUsingDiamondOperator() {",0
PostgreSQL: Filter functions and views from extensions during clean.,"  * PostgreSQL implementation of Schema.
  */
 public class PostgreSQLSchema extends Schema<PostgreSQLDbSupport> {
+
     /**
      * Creates a new PostgreSQL schema.
      *
@@ -111,9 +112,6 @@
             jdbcTemplate.execute(statement);
         }
 
-        for (Type type : allTypes()) {
-            type.drop();
-        }
     }
 
     /**
@@ -193,9 +191,12 @@
     private List<String> generateDropStatementsForRoutines() throws SQLException {
         List<Map<String, String>> rows =
                 jdbcTemplate.queryForList(
+                // Search for all functions
                         ""SELECT proname, oidvectortypes(proargtypes) AS args ""
                                 + ""FROM pg_proc INNER JOIN pg_namespace ns ON (pg_proc.pronamespace = ns.oid) ""
-                                + ""WHERE pg_proc.proisagg = false AND ns.nspname = ?"",
+                // that don't depend on an extension
+                        + ""LEFT JOIN pg_depend dep ON dep.objid = pg_proc.oid AND dep.deptype = 'e' ""
+                        + ""WHERE pg_proc.proisagg = false AND ns.nspname = ? AND dep.objid IS NULL"",
                         name
                 );
 
@@ -273,8 +274,12 @@
     private List<String> generateDropStatementsForViews() throws SQLException {
         List<String> viewNames =
                 jdbcTemplate.queryForStringList(
-                        ""SELECT table_name FROM information_schema.views WHERE table_schema=?"", name);
-
+                // Search for all views
+                ""SELECT table_name FROM information_schema.views"" +
+                        // that don't depend on an extension
+                        "" LEFT JOIN pg_depend dep ON dep.objid = (table_schema || '.' || table_name)::regclass::oid AND dep.deptype = 'e'"" +
+                        "" WHERE table_schema=? AND dep.objid IS NULL"",
+                name);
         List<String> statements = new ArrayList<String>();
         for (String domainName : viewNames) {
             statements.add(""DROP VIEW IF EXISTS "" + dbSupport.quote(name, domainName) + "" CASCADE"");",0
fixed comments in ModelBatch (typos & copy-paste)," 	/** the {@link RenderableSorter} **/
 	protected final RenderableSorter sorter;
 
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself. 
+	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and context.end() yourself. 
 	 * @param context The {@link RenderContext} to use.
 	 * @param shaderProvider The {@link ShaderProvider} to use.
 	 * @param sorter The {@link RenderableSorter} to use. */
@@ -87,40 +87,40 @@
 			: shaderProvider;
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself. 
+	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and context.end() yourself. 
 	 * @param context The {@link RenderContext} to use.
 	 * @param shaderProvider The {@link ShaderProvider} to use. */
 	public ModelBatch(final RenderContext context, final ShaderProvider shaderProvider) {
 		this(context, shaderProvider, null);
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself. 
+	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and context.end() yourself. 
 	 * @param context The {@link RenderContext} to use.
 	 * @param sorter The {@link RenderableSorter} to use. */
 	public ModelBatch(final RenderContext context, final RenderableSorter sorter) {
 		this(context, null, sorter);
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself. 
+	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and context.end() yourself. 
 	 * @param context The {@link RenderContext} to use. */
 	public ModelBatch(final RenderContext context) {
 		this(context, null, null);
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself.
+	/** Construct a ModelBatch
 	 * @param shaderProvider The {@link ShaderProvider} to use.
 	 * @param sorter The {@link RenderableSorter} to use. */
 	public ModelBatch(final ShaderProvider shaderProvider, final RenderableSorter sorter) {
 		this(null, shaderProvider, sorter);
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself.
+	/** Construct a ModelBatch
 	 * @param sorter The {@link RenderableSorter} to use. */
 	public ModelBatch(final RenderableSorter sorter) {
 		this(null, null, sorter);
 	}
 	
-	/** Construct a ModelBatch, using this constructor makes you responsible for calling context.begin() and contact.end() yourself.
+	/** Construct a ModelBatch
 	 * @param shaderProvider The {@link ShaderProvider} to use. */
 	public ModelBatch(final ShaderProvider shaderProvider) {
 		this(null, shaderProvider, null);",0
Fix typos in ArchiveExtractor.java error messages,"           while (stripPath > 0) {
             slash = name.indexOf(""/"", slash);
             if (slash == -1) {
-              throw new IOException(""Invalid archive: it must contains a single root folder"");
+              throw new IOException(""Invalid archive: it must contain a single root folder"");
             }
             slash++;
             stripPath--;
@@ -174,7 +174,7 @@
 
         // Strip the common path prefix when requested
         if (!name.startsWith(pathPrefix)) {
-          throw new IOException(""Invalid archive: it must contains a single root folder while file "" + name + "" is outside "" + pathPrefix);
+          throw new IOException(""Invalid archive: it must contain a single root folder while file "" + name + "" is outside "" + pathPrefix);
         }
         name = name.substring(pathPrefix.length());
         if (name.isEmpty()) {
@@ -185,7 +185,7 @@
         File outputLinkedFile = null;
         if (isLink) {
           if (!linkName.startsWith(pathPrefix)) {
-            throw new IOException(""Invalid archive: it must contains a single root folder while file "" + linkName + "" is outside "" + pathPrefix);
+            throw new IOException(""Invalid archive: it must contain a single root folder while file "" + linkName + "" is outside "" + pathPrefix);
           }
           linkName = linkName.substring(pathPrefix.length());
           outputLinkedFile = new File(destFolder, linkName);",0
[no issue] fix typo," 
     private final AtomicBoolean onTimerTask = new AtomicBoolean(false);
 
-    private SimpleOrderedThreadPool webSocketflushExecutor;
+    private SimpleOrderedThreadPool webSocketFlushExecutor;
 
     private java.util.Timer flushTimer;
     private static final long DEFAULT_FLUSH_DELAY = 1000;
@@ -105,7 +105,7 @@
     @Override
     public void start() {
         PinpointThreadFactory flushThreadFactory = new PinpointThreadFactory(ClassUtils.simpleClassName(this) + ""-Flush-Thread"", true);
-        webSocketflushExecutor = new SimpleOrderedThreadPool(Runtime.getRuntime().availableProcessors(), 65535, flushThreadFactory);
+        webSocketFlushExecutor = new SimpleOrderedThreadPool(Runtime.getRuntime().availableProcessors(), 65535, flushThreadFactory);
 
         flushTimer = new java.util.Timer(ClassUtils.simpleClassName(this) + ""-Flush-Timer"", true);
         healthCheckTimer = new java.util.Timer(ClassUtils.simpleClassName(this) + ""-HealthCheck-Timer"", true);
@@ -133,8 +133,8 @@
             reactiveTimer.cancel();
         }
 
-        if (webSocketflushExecutor != null) {
-            webSocketflushExecutor.shutdown();
+        if (webSocketFlushExecutor != null) {
+            webSocketFlushExecutor.shutdown();
         }
     }
 
@@ -304,7 +304,7 @@
                 Collection<PinpointWebSocketResponseAggregator> values = aggregatorRepository.values();
                 for (final PinpointWebSocketResponseAggregator aggregator : values) {
                     try {
-                        aggregator.flush(webSocketflushExecutor);
+                        aggregator.flush(webSocketFlushExecutor);
                     } catch (Exception e) {
                         logger.warn(""failed while flushing ActiveThreadCount to aggregator. applicationName:{}, error:{}"", aggregator.getApplicationName(), e.getMessage(), e);
                     }
@@ -384,7 +384,7 @@
 
         private void sendPingMessage(WebSocketSession session, TextMessage pingMessage) {
             try {
-                webSocketflushExecutor.execute(new OrderedWebSocketFlushRunnable(session, pingMessage, true));
+                webSocketFlushExecutor.execute(new OrderedWebSocketFlushRunnable(session, pingMessage, true));
             } catch (RuntimeException e) {
                 logger.warn(""failed while to execute. error:{}."", e.getMessage(), e);
             }",0
Fix using the wrong Pair implementation," 
 package net.minecraftforge.items;
 
-import javafx.util.Pair;
 import net.minecraft.block.Block;
 import net.minecraft.block.BlockDropper;
 import net.minecraft.block.BlockHopper;
@@ -32,6 +31,8 @@
 import net.minecraft.util.math.BlockPos;
 import net.minecraft.util.math.MathHelper;
 import net.minecraft.world.World;
+import org.apache.commons.lang3.tuple.ImmutablePair;
+import org.apache.commons.lang3.tuple.Pair;
 
 import javax.annotation.Nonnull;
 import javax.annotation.Nullable;
@@ -270,7 +271,7 @@
                 if (tileentity.hasCapability(CapabilityItemHandler.ITEM_HANDLER_CAPABILITY, side))
                 {
                     IItemHandler capability = tileentity.getCapability(CapabilityItemHandler.ITEM_HANDLER_CAPABILITY, side);
-                    destination = new Pair<IItemHandler, Object>(capability, tileentity);
+                    destination = ImmutablePair.<IItemHandler, Object>of(capability, tileentity);
                 }
             }
         }",0
Add top margin to the error panel," 		}
 
 		errorPanel.setContent(""Exp trackers"", ""You have not gained experience yet."");
-		errorPanel.setBorder(new EmptyBorder(0, 0, 0, 0));
 		add(errorPanel);
 	}
 ",0
Checking isHeadless from DisplayDevice," import com.snowplowanalytics.snowplow.tracker.events.Unstructured;
 import com.snowplowanalytics.snowplow.tracker.payload.SelfDescribingJson;
 import org.lwjgl.opengl.GL11;
+import org.terasology.context.Context;
+import org.terasology.engine.subsystem.DisplayDevice;
+import org.terasology.registry.CoreRegistry;
 import org.terasology.telemetry.TelemetryCategory;
 import org.terasology.telemetry.TelemetryField;
 
@@ -32,6 +35,7 @@
 public class SystemContextMetric extends Metric {
 
     public static final String SCHEMA_OS = ""iglu:org.terasology/systemContext/jsonschema/1-0-0"";
+    private Context context;
 
     @TelemetryField
     private String osName;
@@ -79,9 +83,13 @@
         javaVersion = System.getProperty(""java.version"");
         jvmName = System.getProperty(""java.vm.name"");
         jvmVersion = System.getProperty(""java.vm.version"");
+        context = CoreRegistry.get(Context.class);
+        DisplayDevice display = context.get(DisplayDevice.class);
+        if (!display.isHeadless()) {
         openGLVendor = GL11.glGetString(GL11.GL_VENDOR);
         openGLVersion = GL11.glGetString(GL11.GL_VERSION);
         openGLRenderer = GL11.glGetString(GL11.GL_RENDERER);
+        }
         processorNumbers = Runtime.getRuntime().availableProcessors();
         memoryMaxByte = Runtime.getRuntime().maxMemory();
     }",0
Fixed orientation issue,"     private ViewPager mViewPager;
     private ViewPager.OnPageChangeListener mListener;
     private TitleProvider mTitleProvider;
-    private int mCurrentPage;
+    private int mCurrentPage = -1;
     private int mCurrentOffset;
     private int mScrollState;
     private final Paint mPaintText = new Paint();
@@ -319,6 +319,9 @@
             return;
         }
 
+        // mCurrentPage is -1 on first start and after orientation changed. If so, retrieve the correct index from viewpager.
+        if(mCurrentPage == -1 && mViewPager != null) mCurrentPage = mViewPager.getCurrentItem();
+        
         //Calculate views bounds
         ArrayList<RectF> bounds = calculateAllBounds(mPaintText);
         final int boundsSize = bounds.size();",0
fix merge bug in dataset.merge," 
                 break;
             case 4:
-                labelsOut = merge4dCnnData(featuresToMerge);
+                labelsOut = merge4dCnnData(labelsToMerge);
                 labelsMaskOut = null;
                 break;
             default:",0
Fix memory leak at BlurTransformation.,"   }
 
   public BlurTransformation(Context context, BitmapPool pool, int radius, int sampling) {
-    mContext = context;
+    mContext = context.getApplicationContext();
     mBitmapPool = pool;
     mRadius = radius;
     mSampling = sampling;
   }
 
   public BlurTransformation(Context context, int radius, int sampling) {
-    mContext = context;
+    mContext = context.getApplicationContext();
     mBitmapPool = Glide.get(context).getBitmapPool();
     mRadius = radius;
     mSampling = sampling;",0
Fix NPE in FragmentByIdProcessor," 
 import javax.annotation.processing.ProcessingEnvironment;
 import javax.lang.model.element.Element;
+import javax.lang.model.element.TypeElement;
 import javax.lang.model.type.TypeMirror;
 
 import com.googlecode.androidannotations.annotations.FragmentById;
@@ -62,12 +63,11 @@
 		TypeMirror elementType = element.asType();
 		String typeQualifiedName = elementType.toString();
 
-		TypeMirror nativeFragmentType = annotationHelper.typeElementFromQualifiedName(CanonicalNameConstants.FRAGMENT).asType();
+		TypeElement nativeFragmentElement = annotationHelper.typeElementFromQualifiedName(CanonicalNameConstants.FRAGMENT);
 
 		JMethod findFragmentById;
-		if (annotationHelper.isSubtype(elementType, nativeFragmentType)) {
+		if (nativeFragmentElement != null && annotationHelper.isSubtype(elementType, nativeFragmentElement.asType())) {
 			// Injecting native fragment
-
 			findFragmentById = null;
 
 			if (holder.findNativeFragmentById == null) {",0
Fix for resource leak on exception,"      */
     private static ArrayList<String> getLinuxLdPaths() {
         ArrayList<String> ldPaths = new ArrayList<String>();
+        BufferedReader reader = null;
         try {
                 Process process = Runtime.getRuntime().exec(""/sbin/ldconfig -p"");
-                BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
-                String buffer = """";
+            reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
+            String buffer;
                 while ((buffer = reader.readLine()) != null) {
                         int startPath = buffer.indexOf("" => "");
                         int endPath = buffer.lastIndexOf('/');
                         if (startPath != -1 && endPath != -1 && startPath < endPath) {
                                 String path =  buffer.substring(startPath+4, endPath);
-                                if (ldPaths.contains(path) == false) {
+                    if (!ldPaths.contains(path)) {
                                         ldPaths.add(path);
                                 }
                         }
                 }
-                reader.close();
         } catch (Exception e) {
+        } finally {
+            if(reader != null) {
+                try {
+                    reader.close();
+                } catch (IOException e) {
+                }
+            }
         }
         return ldPaths;
     }",0
Increment current while adding a collection to IntegerList (fixes #474)," 		int current = 0;
 		for (int x : list) {
 			_data[_size + current] = x;
+			current++;
 		}
 
 		_size += list.size();",0
[1.9] Fix double dropping of items. Closes #2549,"             return null;
         }
 
+        if (player.isServerWorld())
+        {
         player.getEntityWorld().spawnEntityInWorld(event.entityItem);
+        }
         return event.entityItem;
     }
 ",0
Check for null messages in KafkaTransport,"                                 final MessageAndMetadata<byte[], byte[]> message = consumerIterator.next();
 
                                 final byte[] bytes = message.message();
+
+                                // it is possible that the message is null
+                                if (bytes == null) {
+                                    continue;
+                                }
+
                                 totalBytesRead.addAndGet(bytes.length);
                                 lastSecBytesReadTmp.addAndGet(bytes.length);
 ",0
Fix Hazelcast ticket deletion when ticket encryption is enabled," 
     @Override
     public boolean deleteSingleTicket(final String ticketId) {
+        final String encTicketId = encodeTicketId(ticketId);
         final TicketDefinition metadata = this.ticketCatalog.find(ticketId);
         final IMap<String, Ticket> map = getTicketMapInstanceByMetadata(metadata);
-        return map.remove(ticketId) != null;
+        return map.remove(encTicketId) != null;
     }
 
     @Override",0
NioNetworking input and out threads visibility problem,"             }
         });
 
-        this.inputThreads = new NioThread[inputThreadCount];
-        for (int i = 0; i < inputThreads.length; i++) {
+        NioThread[] inThreads = new NioThread[inputThreadCount];
+        for (int i = 0; i < inThreads.length; i++) {
             NioThread thread = new NioThread(
                     createThreadPoolName(threadNamePrefix, ""IO"") + ""in-"" + i,
                     loggingService.getLogger(NioThread.class),
@@ -166,13 +166,14 @@
                     idleStrategy);
             thread.id = i;
             thread.setSelectorWorkaroundTest(selectorWorkaroundTest);
-            inputThreads[i] = thread;
+            inThreads[i] = thread;
             metricsRegistry.scanAndRegister(thread, ""tcp.inputThread["" + thread.getName() + ""]"");
             thread.start();
         }
+        this.inputThreads = inThreads;
 
-        this.outputThreads = new NioThread[outputThreadCount];
-        for (int i = 0; i < outputThreads.length; i++) {
+        NioThread[] outThreads = new NioThread[outputThreadCount];
+        for (int i = 0; i < outThreads.length; i++) {
             NioThread thread = new NioThread(
                     createThreadPoolName(threadNamePrefix, ""IO"") + ""out-"" + i,
                     loggingService.getLogger(NioThread.class),
@@ -181,10 +182,11 @@
                     idleStrategy);
             thread.id = i;
             thread.setSelectorWorkaroundTest(selectorWorkaroundTest);
-            outputThreads[i] = thread;
+            outThreads[i] = thread;
             metricsRegistry.scanAndRegister(thread, ""tcp.outputThread["" + thread.getName() + ""]"");
             thread.start();
         }
+        this.outputThreads = outThreads;
 
         startIOBalancer();
     }",0
KEYCLOAK-2068 - Fix Potential NPE when using Servlet-Filter Adapter.," 
                 MultivaluedHashMap<String, String> getParams() {
                     if (parameters != null) return parameters;
+
+                    if (body == null) return new MultivaluedHashMap<String, String>();
+
                     String contentType = getContentType();
                     contentType = contentType.toLowerCase();
                     if (contentType.startsWith(""application/x-www-form-urlencoded"")) {",0
Fix help text output,"      */
     private final Settings settings;
 
+    private static final String SUPPORTED_FORMATS = ""HTML, XML, CSV, JSON, VULN, or ALL"";
+
     /**
      * Constructs a new CLI Parser object with the configured settings.
      *
@@ -133,7 +135,7 @@
                     Format.valueOf(format);
                 } catch (IllegalArgumentException ex) {
                     final String msg = String.format(""An invalid 'format' of '%s' was specified. ""
-                            + ""Supported output formats are HTML, XML, CSV, JSON, VULN, or ALL"", format);
+                            + ""Supported output formats are "" + SUPPORTED_FORMATS, format);
                     throw new ParseException(msg);
                 }
             }
@@ -273,7 +275,7 @@
                 .build();
 
         final Option outputFormat = Option.builder(ARGUMENT.OUTPUT_FORMAT_SHORT).argName(""format"").hasArg().longOpt(ARGUMENT.OUTPUT_FORMAT)
-                .desc(""The output format to write to (XML, JSON, HTML, VULN, ALL). The default is HTML."")
+                .desc(""The output format to write to ("" + SUPPORTED_FORMATS + ""). The default is HTML."")
                 .build();
 
         final Option verboseLog = Option.builder(ARGUMENT.VERBOSE_LOG_SHORT).argName(""file"").hasArg().longOpt(ARGUMENT.VERBOSE_LOG)",0
Fix NPE in OrganizationJob," import java.io.IOException;
 import java.util.List;
 import java.util.OptionalInt;
+import java.util.OptionalLong;
 import java.util.Set;
 import java.util.UUID;
 
@@ -81,7 +82,7 @@
         TableMetadata metadata = getTableMetadata(tableId);
         List<ShardInfo> newShards = performCompaction(transactionId, bucketNumber, shardUuids, metadata);
         log.info(""Compacted shards %s into %s"", shardUuids, newShards.stream().map(ShardInfo::getShardUuid).collect(toList()));
-        shardManager.replaceShardUuids(transactionId, tableId, metadata.getColumns(), shardUuids, newShards, null);
+        shardManager.replaceShardUuids(transactionId, tableId, metadata.getColumns(), shardUuids, newShards, OptionalLong.empty());
     }
 
     private TableMetadata getTableMetadata(long tableId)",0
Fix typo in AddExchanges.visitJoin variables,"             PlanWithProperties left;
             PlanWithProperties right;
 
-            boolean isCrossJoin = type != INNER || !leftSymbols.isEmpty();
-            boolean joinWithNonScalar = !node.getRight().accept(new IsScalarPlanVisitor(), null);
-            if ((distributedJoins && isCrossJoin && joinWithNonScalar) || type == FULL || type == RIGHT) {
+            boolean isCrossJoin = type == INNER && leftSymbols.isEmpty();
+            boolean joinWithNonScalar = node.getRight().accept(new IsScalarPlanVisitor(), null);
+            if ((distributedJoins && !isCrossJoin && !joinWithNonScalar) || type == FULL || type == RIGHT) {
                 // The implementation of full outer join only works if the data is hash partitioned. See LookupJoinOperators#buildSideOuterJoinUnvisitedPositions
 
                 left = node.getLeft().accept(this, context.withPreferredProperties(PreferredProperties.hashPartitioned(leftSymbols)));",0
Fix the StringIndexOutOfBoundsException,"                 break;
             }
         }
+
+        int lastLetter = 0;
         for (int ptr = cursor; ptr < lineEndOffset - lineStartOffset; ptr++) {
+            lastLetter = ptr;
             if (!Character.isLetter(chars[ptr])) {
                 end = ptr;
                 break;
             }
         }
+        if (end == 0) {
+            end = lastLetter + 1;
+        }
+
         String ret = new String(chars, start, end-start);
         Logger.info(""Selected words: "" + ret);
         return ret;",0
[1.12.x] Fix issue with --modListFile. (#5315),"     @SuppressWarnings(""unchecked"")
     public static List<ModList> getKnownLists(File mcdir)
     {
-        for (String list : new String[] {""mods/mod_list.json"", ""mods/"" + ForgeVersion.mcVersion + ""/mod_list.json"", ((Map<String, String>)Launch.blackboard.get(""launchArgs"")).get(""--modListFile"")})
+        for (String list : new String[] {""mods/mod_list.json"", ""mods/"" + ForgeVersion.mcVersion + ""/mod_list.json"", ((Map<String, String>)Launch.blackboard.get(""forgeLaunchArgs"")).get(""--modListFile"")})
         {
             if (list != null)
             {
@@ -84,7 +84,7 @@
         if (memory != null)
             lst.add(memory);
 
-        for (String list : new String[] {""mods/mod_list.json"", ""mods/"" + ForgeVersion.mcVersion + ""/mod_list.json"", ((Map<String, String>)Launch.blackboard.get(""launchArgs"")).get(""--modListFile"")})
+        for (String list : new String[] {""mods/mod_list.json"", ""mods/"" + ForgeVersion.mcVersion + ""/mod_list.json"", ((Map<String, String>)Launch.blackboard.get(""forgeLaunchArgs"")).get(""--modListFile"")})
         {
             if (list != null)
             {",0
Fix issue#44 Set attribute values programmatically won't change the visual of the progress wheel.," 
     public void setBarWidth(int barWidth) {
         this.barWidth = barWidth;
+        
+        if ( this.barPaint != null ) {
+        	this.barPaint.setStrokeWidth( this.barWidth );
+        }
     }
 
     public int getTextSize() {
@@ -418,6 +422,10 @@
 
     public void setTextSize(int textSize) {
         this.textSize = textSize;
+        
+        if ( this.textPaint != null ) {
+        	this.textPaint.setTextSize( this.textSize );
+        }
     }
 
     public int getPaddingTop() {
@@ -458,6 +466,10 @@
 
     public void setBarColor(int barColor) {
         this.barColor = barColor;
+        
+        if ( this.barPaint != null ) {
+        	this.barPaint.setColor( this.barColor );
+        }
     }
 
     public int getCircleColor() {
@@ -466,6 +478,10 @@
 
     public void setCircleColor(int circleColor) {
         this.circleColor = circleColor;
+        
+        if ( this.circlePaint != null ) {
+        	this.circlePaint.setColor( this.circleColor);
+        }
     }
 
     public int getRimColor() {
@@ -474,6 +490,10 @@
 
     public void setRimColor(int rimColor) {
         this.rimColor = rimColor;
+        
+        if ( this.rimPaint != null ) {
+        	this.rimPaint.setColor( this.rimColor );
+        }
     }
 
 
@@ -491,6 +511,10 @@
 
     public void setTextColor(int textColor) {
         this.textColor = textColor;
+        
+        if ( this.textPaint != null ) {
+        	this.textPaint.setColor( this.textColor );
+        }
     }
 
     public int getSpinSpeed() {
@@ -507,6 +531,10 @@
 
     public void setRimWidth(int rimWidth) {
         this.rimWidth = rimWidth;
+        
+        if ( this.rimPaint != null ) {
+        	this.rimPaint.setStrokeWidth( this.rimWidth );
+        }
     }
 
     public int getDelayMillis() {
@@ -516,4 +544,28 @@
     public void setDelayMillis(int delayMillis) {
         this.delayMillis = delayMillis;
     }
+    
+    public int getContourColor() {
+    	return contourColor;
+    }
+    
+    public void setContourColor(int contourColor) {
+    	this.contourColor = contourColor;
+    	
+    	if ( contourPaint != null ) {
+    		this.contourPaint.setColor( this.contourColor );
+    	}
+    }
+    
+    public float getContourSize() {
+    	return this.contourSize;
+    }
+    
+    public void setContourSize(float contourSize) {
+    	this.contourSize = contourSize;
+    	
+    	if ( contourPaint != null ) {
+    		this.contourPaint.setStrokeWidth( this.contourSize );
+    	}
+    }
 }",0
[FIX JENKINS-39842] Open Blue Ocean button should not try to load /activity for a folder,"             return pipelineModelMapping.blueUiUrl + ""/detail/"" + encodeURIComponent(decodeURIComponent(job.getName())) + ""/"" + encodeURIComponent(run.getId());
         } else if (classicModelObject instanceof Item) {
             Resource blueResource = BluePipelineFactory.resolve((Item) classicModelObject);
-            if (blueResource != null) {
                 if (blueResource instanceof BlueMultiBranchPipeline) {
                     return getOrgPrefix() + ""/"" + encodeURIComponent(((BluePipeline) blueResource).getFullName()) + ""/branches"";
-                } else if (blueResource instanceof BluePipeline) {
-                    return getOrgPrefix() + ""/"" + encodeURIComponent(((BluePipeline) blueResource).getFullName());
-                }
             }
         }
 ",0
Fixing NPE in DelayedActionSystem.,"         if (!delayedComponent.isEmpty() && oldWakeUp < newWakeUp) {
             delayedOperationsSortedByTime.remove(oldWakeUp, entity);
             delayedOperationsSortedByTime.put(newWakeUp, entity);
+        } else if (delayedComponent.isEmpty()) {
+            delayedOperationsSortedByTime.remove(oldWakeUp, entity);
         }
         saveOrRemoveComponent(entity, delayedComponent);
     }
@@ -200,6 +202,8 @@
         if (!periodicActionComponent.isEmpty() && oldWakeUp < newWakeUp) {
             periodicOperationsSortedByTime.remove(oldWakeUp, entity);
             periodicOperationsSortedByTime.put(newWakeUp, entity);
+        } else if (periodicActionComponent.isEmpty()) {
+            periodicOperationsSortedByTime.remove(oldWakeUp, entity);
         }
         saveOrRemoveComponent(entity, periodicActionComponent);
     }",0
Fix empty initialWidth and initialHeight [Android]," 
     BitmapFactory.Options options = new BitmapFactory.Options();
     options.inJustDecodeBounds = true;
+    BitmapFactory.decodeFile(realPath, options);
     int initialWidth = options.outWidth;
     int initialHeight = options.outHeight;
 ",0
VI.5 fix lower bound on recursive call to sqrt_helper," 	    } else if (guess * guess < n) { // too low
 	        return sqrt_helper(n, guess + 1, max); // try higher
 	    } else { // too high
-	        return sqrt_helper(n, 1, guess - 1); // try lower
+	        return sqrt_helper(n, min, guess - 1); // try lower
 	    }
 	}
 	        ",0
Bug fix," import android.view.ViewGroup;
 import android.view.animation.Interpolator;
 import android.view.animation.LinearInterpolator;
+
 import jp.wasabeef.recyclerview.animators.internal.ViewHelper;
 
 /**
@@ -40,6 +41,16 @@
     return mAdapter.onCreateViewHolder(parent, viewType);
   }
 
+  @Override public void registerAdapterDataObserver(RecyclerView.AdapterDataObserver observer) {
+    super.registerAdapterDataObserver(observer);
+    mAdapter.registerAdapterDataObserver(observer);
+  }
+
+  @Override public void unregisterAdapterDataObserver(RecyclerView.AdapterDataObserver observer) {
+    super.unregisterAdapterDataObserver(observer);
+    mAdapter.unregisterAdapterDataObserver(observer);
+  }
+
   @Override public void onBindViewHolder(RecyclerView.ViewHolder holder, int position) {
     mAdapter.onBindViewHolder(holder, position);
 ",0
[Defect] Not always all modules are available for filtering,"                 if (info == null) {
                     info = ModuleSelectionInfo.remote(remote);
                     modulesLookup.put(remote.getId(), info);
-                    int pos = Collections.binarySearch(sortedModules, info, moduleInfoComparator);
-                    if (pos < 0) { // not yet in the (sorted) list
-                        sortedModules.add(-pos - 1, info); // use ""insertion point"" to keep the list sorted
-                        allSortedModules.clear();
-                        allSortedModules.addAll(sortedModules);
-                    }
                 }
                 info.setOnlineVersion(remote);
             }
         }
+        sortedModules.clear();
+        allSortedModules.clear();
+
+        sortedModules.addAll(modulesLookup.values());
+        sortedModules.sort(moduleInfoComparator);
+
+        allSortedModules.addAll(sortedModules);
+
         filterModules();
     }
 ",0
fix #3173 - use filtered values in returned instance,"         OpenAPI clone = new OpenAPI();
         clone.info(filteredOpenAPI.getInfo());
         clone.openapi(filteredOpenAPI.getOpenapi());
-        clone.setExtensions(openAPI.getExtensions());
-        clone.setExternalDocs(openAPI.getExternalDocs());
-        clone.setSecurity(openAPI.getSecurity());
-        clone.setServers(openAPI.getServers());
+        clone.setExtensions(filteredOpenAPI.getExtensions());
+        clone.setExternalDocs(filteredOpenAPI.getExternalDocs());
+        clone.setSecurity(filteredOpenAPI.getSecurity());
+        clone.setServers(filteredOpenAPI.getServers());
         clone.tags(filteredOpenAPI.getTags() == null ? null : new ArrayList<>(openAPI.getTags()));
 
         final Set<String> allowedTags = new HashSet<>();",0
[b] fix `onNavigationItemSelected` was triggered 2 times,"     private BottomNavigationItemView[] mButtons;
     // used for setupWithViewPager end
 
+    // detect navigation tab changes when the user clicking on navigation item
+    private static boolean isNavigationItemClicking = false;
+
     public BottomNavigationViewEx(Context context) {
         super(context);
 //        init();
@@ -903,7 +906,7 @@
         @Override
         public void onPageSelected(final int position) {
             final BottomNavigationViewEx bnve = mBnveRef.get();
-            if (null != bnve)
+            if (null != bnve && !isNavigationItemClicking)
                 bnve.setCurrentItem(position);
 //            Log.d(""onPageSelected"", ""--------- position "" + position + "" ------------"");
         }
@@ -960,7 +963,10 @@
             if (null == viewPager)
                 return false;
 
+            // use isNavigationItemClicking flag to avoid `ViewPager.OnPageChangeListener` trigger
+            isNavigationItemClicking = true;
             viewPager.setCurrentItem(items.get(item.getItemId()), smoothScroll);
+            isNavigationItemClicking = false;
 
             // update previous position
             previousPosition = position;",0
fix crash when authentication error happens,"             @Override
             protected void onError(AuthenticateResponse response) {
                 onGoingAccessTokenQuery.set(false);
-                RealmLog.debug(""Session[%s]: Failed to get access token (%d)"", configuration.getPath(), response.getError().getErrorCode());
+                RealmLog.debug(""Session[%s]: Failed to get access token (%s)"", configuration.getPath(),
+                        response.getError().getErrorCode());
                 if (!isClosed && !Thread.currentThread().isInterrupted()) {
                     errorHandler.onError(SyncSession.this, response.getError());
                 }",0
"Fixed the LGTM error ""Type mismatch on container modification""","      * @param controller the controller to remove
      */
     private void removeController(Controller controller) {
-        controllers.remove(controller.getName());
+        controllers.remove(controller);
         logger.info(""Removed controller: "" + controller.getName());
     }
 ",0
[core] Fix JCommander help for -min option," import net.sourceforge.pmd.lang.LanguageVersion;
 
 import com.beust.jcommander.IStringConverter;
+import com.beust.jcommander.IValueValidator;
 import com.beust.jcommander.Parameter;
 import com.beust.jcommander.ParameterException;
 import com.beust.jcommander.validators.PositiveInteger;
@@ -25,14 +26,13 @@
             required = true)
     private String rulesets;
 
-    @Parameter(names = { ""-uri"", ""-u"" }, description = ""Database URI for sources."", required = false)
+    @Parameter(names = { ""-uri"", ""-u"" }, description = ""Database URI for sources."")
     private String uri;
 
-    @Parameter(names = { ""-dir"", ""-d"" }, description = ""Root directory for sources."", required = false)
+    @Parameter(names = { ""-dir"", ""-d"" }, description = ""Root directory for sources."")
     private String sourceDir;
 
-    @Parameter(names = { ""-filelist"" }, description = ""Path to a file containing a list of files to analyze."",
-            required = false)
+    @Parameter(names = ""-filelist"", description = ""Path to a file containing a list of files to analyze."")
     private String fileListPath;
 
     @Parameter(names = { ""-format"", ""-f"" }, description = ""Report format type."")
@@ -50,7 +50,7 @@
 
     @Parameter(names = { ""-threads"", ""-t"" }, description = ""Sets the number of threads used by PMD."",
             validateWith = PositiveInteger.class)
-    private Integer threads = 1;
+    private int threads = 1;
 
     @Parameter(names = { ""-benchmark"", ""-b"" },
             description = ""Benchmark mode - output a benchmark report upon completion; default to System.err."")
@@ -70,9 +70,10 @@
     private String suppressmarker = ""NOPMD"";
 
     @Parameter(names = { ""-minimumpriority"", ""-min"" },
-            description = ""Rule priority threshold; rules with lower priority than configured here won't be used. Default is '5' which is the lowest priority."",
-            converter = RulePriorityConverter.class)
-    private RulePriority minimumPriority = RulePriority.LOW;
+            description = ""Rule priority threshold; rules with lower priority than configured here won't be used. ""
+                    + ""Valid values are integers between 1 and 5 (inclusive), with 5 being the lowest priority."",
+            validateValueWith = RulePriorityValidator.class)
+    private int minimumPriority = RulePriority.LOW.getPriority();
 
     @Parameter(names = { ""-property"", ""-P"" }, description = ""{name}={value}: Define a property for the report format."",
             converter = PropertyConverter.class)
@@ -125,7 +126,20 @@
         }
     }
 
+
+    public static class RulePriorityValidator implements IValueValidator<Integer> {
+
+        @Override
+        public void validate(String name, Integer value) throws ParameterException {
+            if (value < 1 || value > 5) {
+                throw new ParameterException(""Priority values can only be integer value, between 1 and 5,"" + value + "" is not valid"");
+            }
+        }
+    }
+
     // this has to be a public static class, so that JCommander can use it!
+    /** @deprecated Will be removed in 7.0.0 */
+    @Deprecated
     public static class RulePriorityConverter implements IStringConverter<RulePriority> {
 
         public int validate(String value) throws ParameterException {
@@ -243,7 +257,7 @@
     }
 
     public RulePriority getMinimumPriority() {
-        return minimumPriority;
+        return RulePriority.valueOf(minimumPriority);
     }
 
     public Properties getProperties() {",0
fix wrong argument order for registering Consumer,"      * @return {@link Consumer} object for the newly registered consumer.
      */
     public Consumer registerConsumer(final String owner, final MultivaluedMap<String, String> attributes) {
-        return registerConsumer(newUUIDString(), newUUIDString(), owner, attributes);
+        return registerConsumer(owner, newUUIDString(), newUUIDString(), attributes);
     }
 
     /**",0
added a couple fixture related methods on Box2d World," 		return world->GetBodyCount();
 	*/
 
+	/** Get the number of fixtures. */
+	public int getFixtureCount () {
+		return fixtures.size;
+	}
+
 	/** Get the number of joints. */
 	public int getJointCount () {
 		return jniGetJointcount(addr);
@@ -869,6 +874,15 @@
 		}		
 	}
 
+	/** @param fixtures an Array in which to place all fixtures currently in the simulation */
+	public void getFixtures (Array<Fixture> fixtures) {
+		fixtures.clear();
+		fixtures.ensureCapacity(this.fixtures.size);
+		for (Iterator<Fixture> iter = this.fixtures.values(); iter.hasNext();) {
+			fixtures.add(iter.next());
+		}		
+	}
+
 	/** @param joints an Array in which to place all joints currently in the simulation */
 	public void getJoints (Array<Joint> joints) {
 		joints.clear();",0
Fix spelling typos,"             return;
         }
         if (cnx == null || (getState() == State.Connecting)) {
-            log.warn(""[{}] Client Connection needs to be establised for redelivery of unacknowledged messages"", this);
+            log.warn(""[{}] Client Connection needs to be established for redelivery of unacknowledged messages"", this);
         } else {
             log.warn(""[{}] Reconnecting the client to redeliver the messages."", this);
             cnx.ctx().close();
@@ -1164,7 +1164,7 @@
             return;
         }
         if (cnx == null || (getState() == State.Connecting)) {
-            log.warn(""[{}] Client Connection needs to be establised for redelivery of unacknowledged messages"", this);
+            log.warn(""[{}] Client Connection needs to be established for redelivery of unacknowledged messages"", this);
         } else {
             log.warn(""[{}] Reconnecting the client to redeliver the messages."", this);
             cnx.ctx().close();",0
Fix ClassCastException in the RatingsProcessor," 
     @Override
     public Map<String, Object> populateModelVariables(String tagName, Map<String, String> tagAttributes, BroadleafTemplateContext context) {
-        String itemId = String.valueOf(context.parseExpression(tagAttributes.get(""itemId"")));
+        Object obj = context.parseExpression(tagAttributes.get(""itemId""));
+        String itemId = obj.toString();
         RatingSummary ratingSummary = ratingService.readRatingSummary(itemId, RatingType.PRODUCT);
         Map<String, Object> newModelVars = new HashMap<>();
         if (ratingSummary != null) {",0
Fix typo in JavaDoc," import java.sql.Connection;
 
 /**
- * Creates an {@link SqlSesion} out of a connection or a DataSource
+ * Creates an {@link SqlSession} out of a connection or a DataSource
  * 
  * @author Clinton Begin
  */",0
Fix Slayer Tower emote clue," import static net.runelite.api.ItemID.CLIMBING_BOOTS;
 import static net.runelite.api.ItemID.COIF;
 import static net.runelite.api.ItemID.COMBAT_BRACELET;
+import static net.runelite.api.ItemID.COMBAT_BRACELET4;
 import static net.runelite.api.ItemID.CREAM_ROBE_TOP;
 import static net.runelite.api.ItemID.DEATH_TIARA;
 import static net.runelite.api.ItemID.DESERT_SHIRT;
@@ -481,7 +482,7 @@
 		new EmoteClue(""Goblin Salute in the Goblin Village. Beware of double agents! Equip a bandos godsword, a bandos cloak and a bandos platebody."", new WorldPoint(2956, 3505, 0), GOBLIN_SALUTE, item(BANDOS_PLATEBODY), item(BANDOS_CLOAK), item(BANDOS_GODSWORD)),
 		new EmoteClue(""Headbang in the mine north of Al Kharid. Equip a desert shirt, leather gloves and leather boots."", new WorldPoint(3299, 3289, 0), HEADBANG, item(DESERT_SHIRT), item(LEATHER_GLOVES), item(LEATHER_BOOTS)),
 		new EmoteClue(""Headbang at the exam center. Beware of double agents! Equip a mystic fire staff, a diamond bracelet and rune boots."", new WorldPoint(3362, 3340, 0), HEADBANG, item(MYSTIC_FIRE_STAFF), item(DIAMOND_BRACELET), item(RUNE_BOOTS)),
-		new EmoteClue(""Headbang at the top of Slayer Tower. Equip a seercull, a combat bracelet and helm of Neitiznot."", new WorldPoint(3115, 3420, 0), HEADBANG, item(SEERCULL), item(COMBAT_BRACELET), item(HELM_OF_NEITIZNOT)),
+		new EmoteClue(""Headbang at the top of Slayer Tower. Equip a seercull, a combat bracelet and helm of Neitiznot."", new WorldPoint(3421, 3537, 2), HEADBANG, item(SEERCULL), range(""Combat bracelet"", COMBAT_BRACELET4, COMBAT_BRACELET), item(HELM_OF_NEITIZNOT)),
 		new EmoteClue(""Dance a jig by the entrance to the Fishing Guild. Equip an emerald ring, a sapphire amulet, and a bronze chain body."", new WorldPoint(2610, 3391, 0), JIG, item(EMERALD_RING), item(SAPPHIRE_AMULET), item(BRONZE_CHAINBODY)),
 		new EmoteClue(""Dance a jig under Shantay's Awning. Bow before you talk to me. Equip a pointed blue snail helmet, an air staff and a bronze square shield."", new WorldPoint(3304, 3124, 0), JIG, BOW, item(BRUISE_BLUE_SNELM_3343), item(STAFF_OF_AIR), item(BRONZE_SQ_SHIELD)),
 		new EmoteClue(""Do a jig in Varrock's rune store. Equip an air tiara and a staff of water."", new WorldPoint(3253, 3401, 0), JIG, item(AIR_TIARA), item(STAFF_OF_WATER)),",0
Fix touch events for LWP on Android API <9," 			this.app.initialize(listener, config);
 			this.listener = listener;
 			this.view = ((AndroidGraphicsLiveWallpaper)app.getGraphics()).getView();
-			// FIXME this seems to crash on ICS, and is unnecessary it seems if you
-			// overwrite onTouchEvent
-//			if(config.getTouchEventsForLiveWallpaper) {
-//				this.setTouchEventsEnabled(true);
-//			}
+
+			if (config.getTouchEventsForLiveWallpaper && Integer.parseInt(android.os.Build.VERSION.SDK) < 9)
+				this.setTouchEventsEnabled(true);
 		}
 
 		@Override",0
"Remove AbstractPanel from internal list, always"," 
 	public void removeTab(AbstractPanel panel) {
 		this.remove(panel);
+	}
+
+	@Override
+	public void removeTabAt(int index) {
+		if (index < 0 || index >= getTabCount()) {
+			throw new IndexOutOfBoundsException(""Index: "" + index + "", Tab count: "" + getTabCount());
+		}
+
+		Component component = getComponentAt(index);
+		super.removeTabAt(index);
+
+		if (!(component instanceof AbstractPanel)) {
+			return;
+		}
+
+		AbstractPanel panel = (AbstractPanel) component;
 		this.fullTabList.remove(panel);
 		if (this.removedTabList.remove(panel)) {
 			handleHiddenTabListTab();",0
Fix duplicate issues when searching.,"                 if (repository == null)
                     return Collections.emptyList();
                 List<SearchIssue> matches = new ArrayList<SearchIssue>();
-                matches.addAll(service.searchIssues(repository, STATE_OPEN,
-                        query));
-                matches.addAll(service.searchIssues(repository, STATE_CLOSED,
-                        query));
+                /** TODO
+                 *  This request is using a legacy API that is not working properly
+                 *  it needs to be fixed
+                 */
+                matches.addAll(service.searchIssues(repository, STATE_OPEN, query));
+                //matches.addAll(service.searchIssues(repository, STATE_CLOSED, query));
                 Collections.sort(matches, SearchIssueListFragment.this);
                 return matches;
             }",0
slayerplugin: cancel task when leaving fight caves," 	private static final String CHAT_GEM_COMPLETE_MESSAGE = ""You need something new to hunt."";
 	private static final Pattern CHAT_COMPLETE_MESSAGE = Pattern.compile(""[\\d]+(?:,[\\d]+)?"");
 	private static final String CHAT_CANCEL_MESSAGE = ""Your task has been cancelled."";
+	private static final String CHAT_CANCEL_MESSAGE_JAD = ""You no longer have a slayer task as you left the fight cave."";
 	private static final String CHAT_SUPERIOR_MESSAGE = ""A superior foe has appeared..."";
 	private static final String CHAT_BRACELET_SLAUGHTER = ""Your bracelet of slaughter prevents your slayer"";
 	private static final String CHAT_BRACELET_EXPEDITIOUS = ""Your expeditious bracelet helps you progress your"";
@@ -372,7 +373,7 @@
 			return;
 		}
 
-		if (chatMsg.equals(CHAT_GEM_COMPLETE_MESSAGE) || chatMsg.equals(CHAT_CANCEL_MESSAGE))
+		if (chatMsg.equals(CHAT_GEM_COMPLETE_MESSAGE) || chatMsg.equals(CHAT_CANCEL_MESSAGE) || chatMsg.equals(CHAT_CANCEL_MESSAGE_JAD))
 		{
 			setTask("""", 0);
 			return;",0
fix #1194," import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
+import java.util.Set;
 
 /**
  * implement group function select a,count(*),sum(*) from A group by a
@@ -177,7 +179,7 @@
 			return;
 		}
 
-
+		Set<Integer> rmIndexSet = new HashSet<Integer>();
 		for (MergeCol merg : mergCols) {
 			if(merg.mergeType==MergeCol.MERGE_AVG)
 			{
@@ -188,12 +190,16 @@
 				if (result != null)
 				{
 					toRow.fieldValues.set(merg.colMeta.avgSumIndex, result);
-					toRow.fieldValues.remove(merg.colMeta.avgCountIndex) ;
+//					toRow.fieldValues.remove(merg.colMeta.avgCountIndex) ;
+//					toRow.fieldCount=toRow.fieldCount-1;
+					rmIndexSet.add(merg.colMeta.avgCountIndex);
+				}
+			}
+		}
+		for(Integer index : rmIndexSet) {
+			toRow.fieldValues.remove(index);
 					toRow.fieldCount=toRow.fieldCount-1;
 				}
-			}
-		}
-
 
 
 	}",0
Fix #664,"     }
 
     private boolean isGetter(Method method, String fieldName) {
-        return (method.getName().startsWith(""get"") || method.getName().startsWith(""is""))
-                && method.getName().endsWith(getFieldNameSuffix(fieldName));
+        return method.getName().equals(""get"" + getFieldNameSuffix(fieldName))
+                || method.getName().equals(""is"" + getFieldNameSuffix(fieldName));
     }
 
     private boolean isSetter(Method method, String fieldName) {
-        return method.getName().startsWith(""set"")
-                && method.getName().endsWith(getFieldNameSuffix(fieldName));
+        return method.getName().equals(""set"" + getFieldNameSuffix(fieldName));
     }
 
     private static String getFieldNameSuffix(String fieldName) {",0
"Minor fixes for shape/stride fields (serialization, permutei)","     protected boolean isWrapAround = false;
     protected int linearStride = -1;
     protected boolean attemptedToFindElementWiseStride = false;
-    protected DataBuffer shape;
-    protected DataBuffer stride;
+    protected transient DataBuffer shape;
+    protected transient DataBuffer stride;
 
 
     //Precalculate these arrays (like [3,2,1,0], [2,1,0], [1,0], [0] etc) for use in TAD, to avoid creating same int[]s over and over
@@ -4263,6 +4263,9 @@
         this.numLeadingOnes = -1;
         this.numTrailingOnes = -1;
 
+        this.shape = null;
+        this.stride = null;
+
         return this;
     }
 ",0
Fixed issue with removing of network connections though connection is ac...,"     // FREE DEAD CONNECTIONS
     int removedDeadConnections = 0;
     for (OChannelBinaryAsynchClient n : new ArrayList<OChannelBinaryAsynchClient>(networkPool)) {
-      if (n != null && !n.isConnected())
+      if (n != null && !n.isConnected()) //Fixed issue with removing of network connections though connection is active.
+      {
         try {
           n.close();
         } catch (Exception e) {
@@ -1817,6 +1818,7 @@
       networkPool.remove(n);
       removedDeadConnections++;
     }
+    }
 
     OLogManager.instance().debug(this, ""Found and removed %d dead connections from the network pool"", removedDeadConnections);
   }",0
fix setShowCamera method,"     }
 
     public PhotoPickerBuilder setShowCamera(boolean showCamera) {
-      mPickerOptionsBundle.putBoolean(EXTRA_SHOW_GIF, showCamera);
+      mPickerOptionsBundle.putBoolean(EXTRA_SHOW_CAMERA, showCamera);
       return this;
     }
 ",0
service typo fix,"   private static final int NEAREST_BEACON_NOTIFICATION_ID = 23;
   private static final int SECOND_NEAREST_BEACON_NOTIFICATION_ID = 24;
   private static final int SUMMARY_NOTIFICATION_ID = 25;
-  private static final int NON_LOLLIPOP_NOTIFCATION_TITLE_COLOR = Color.parseColor(""#ffffff"");
-  private static final int NON_LOLLIPOP_NOTIFCATION_URL_COLOR = Color.parseColor(""#999999"");
-  private static final int NON_LOLLIPOP_NOTIFCATION_SNIPPET_COLOR = Color.parseColor(""#999999"");
+  private static final int NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR = Color.parseColor(""#ffffff"");
+  private static final int NON_LOLLIPOP_NOTIFICATION_URL_COLOR = Color.parseColor(""#999999"");
+  private static final int NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR = Color.parseColor(""#999999"");
   private ScreenBroadcastReceiver mScreenStateBroadcastReceiver;
   private RegionResolver mRegionResolver;
   private NotificationManagerCompat mNotificationManager;
@@ -396,9 +396,9 @@
       remoteViews.setTextViewText(R.id.description_firstBeacon, description);
       // Recolor notifications to have light text for non-Lollipop devices
       if (!(android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP)) {
-        remoteViews.setTextColor(R.id.title_firstBeacon, NON_LOLLIPOP_NOTIFCATION_TITLE_COLOR);
-        remoteViews.setTextColor(R.id.url_firstBeacon, NON_LOLLIPOP_NOTIFCATION_URL_COLOR);
-        remoteViews.setTextColor(R.id.description_firstBeacon, NON_LOLLIPOP_NOTIFCATION_SNIPPET_COLOR);
+        remoteViews.setTextColor(R.id.title_firstBeacon, NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR);
+        remoteViews.setTextColor(R.id.url_firstBeacon, NON_LOLLIPOP_NOTIFICATION_URL_COLOR);
+        remoteViews.setTextColor(R.id.description_firstBeacon, NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR);
       }
 
       // Create an intent that will open the browser to the beacon's url
@@ -429,9 +429,9 @@
       remoteViews.setTextViewText(R.id.description_secondBeacon, description);
       // Recolor notifications to have light text for non-Lollipop devices
       if (!(android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP)) {
-        remoteViews.setTextColor(R.id.title_secondBeacon, NON_LOLLIPOP_NOTIFCATION_TITLE_COLOR);
-        remoteViews.setTextColor(R.id.url_secondBeacon, NON_LOLLIPOP_NOTIFCATION_URL_COLOR);
-        remoteViews.setTextColor(R.id.description_secondBeacon, NON_LOLLIPOP_NOTIFCATION_SNIPPET_COLOR);
+        remoteViews.setTextColor(R.id.title_secondBeacon, NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR);
+        remoteViews.setTextColor(R.id.url_secondBeacon, NON_LOLLIPOP_NOTIFICATION_URL_COLOR);
+        remoteViews.setTextColor(R.id.description_secondBeacon, NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR);
       }
 
       // Create an intent that will open the browser to the beacon's url",0
Fix ActionBar name,"   @Override
   public void onResume() {
     super.onResume();
+    getActivity().getActionBar().setTitle(R.string.title_nearby_beacons);
     startScanning();
   }
 ",0
resetting terminate to close the urlconnection also in redirected cases,"         }
 
         public T call() throws Exception {
+            terminate = true;
             AsyncHandler.STATE state = AsyncHandler.STATE.ABORT;
             try {
                 Uri uri = request.getUri();",0
Fix SettingsManager," 
     @Nullable
     private String getString(@NonNull String key) {
-        return getSharedPreferences().getString(key, null);
+        return getString(key, null);
     }
 
     @NonNull",0
[java] MissingOverrideRule: Avoid NoClassDefFoundError with incomplete classpath,"             return null;
         }
 
+        try {
         Set<Method> overridden = overriddenMethods(exploredType);
         Map<String, Map<Integer, List<Method>>> result = new HashMap<>();
 
@@ -128,6 +129,10 @@
         }
 
         return new MethodLookup(result, overridden);
+        } catch (final LinkageError e) {
+            // we may have an incomplete auxclasspath
+            return null;
+        }
     }
 
 ",0
Fixed ignoring of LIBRARY_INDEX_URL system property,"     String externalLibraryIndexUrl = System.getProperty(""LIBRARY_INDEX_URL"");
     if (externalLibraryIndexUrl != null && !"""".equals(externalLibraryIndexUrl)) {
       LIBRARY_INDEX_URL = externalLibraryIndexUrl;
+      LIBRARY_INDEX_URL_GZ = """";
+      String externalLibraryIndexUrlGz = System.getProperty(""LIBRARY_INDEX_URL_GZ"");
+      if (externalLibraryIndexUrlGz != null && !"""".equals(externalLibraryIndexUrlGz)) {
+        LIBRARY_INDEX_URL_GZ = externalLibraryIndexUrlGz;
+      }
     } else {
       LIBRARY_INDEX_URL = ""http://downloads.arduino.cc/libraries/library_index.json"";
-    }
     LIBRARY_INDEX_URL_GZ = ""http://downloads.arduino.cc/libraries/library_index.json.gz"";
   }
+  }
 
 }",0
Fixed rename operation in HdfsFailedFetchLock,"                 outputStream = this.fileSystem.create(temporaryLockFile, false);
                 props.storeFlattened(outputStream);
                 outputStream.flush();
+                IOUtils.closeQuietly(outputStream); // necessary, otherwise the rename fails.
 
                 // We attempt to rename to the globally contended lock path
                 this.lockAcquired = this.fileSystem.rename(temporaryLockFile, this.lockFile);
@@ -214,7 +215,7 @@
             } catch (IOException e) {
                 handleIOException(e, ACQUIRE_LOCK, attempts);
             } finally {
-                IOUtils.closeQuietly(outputStream);
+                IOUtils.closeQuietly(outputStream); // in case we failed before the other close above.
             }
 
             if (!this.lockAcquired) {",0
fix #1233,"     }
 
     private String[] toCategoriesPath(URL url) {
-        String[] categroies;
+        String[] categories;
         if (Constants.ANY_VALUE.equals(url.getParameter(Constants.CATEGORY_KEY))) {
-            categroies = new String[]{Constants.PROVIDERS_CATEGORY, Constants.CONSUMERS_CATEGORY,
+            categories = new String[]{Constants.PROVIDERS_CATEGORY, Constants.CONSUMERS_CATEGORY,
                     Constants.ROUTERS_CATEGORY, Constants.CONFIGURATORS_CATEGORY};
         } else {
-            categroies = url.getParameter(Constants.CATEGORY_KEY, new String[]{Constants.DEFAULT_CATEGORY});
+            categories = url.getParameter(Constants.CATEGORY_KEY, new String[]{Constants.DEFAULT_CATEGORY});
         }
-        String[] paths = new String[categroies.length];
-        for (int i = 0; i < categroies.length; i++) {
-            paths[i] = toServicePath(url) + Constants.PATH_SEPARATOR + categroies[i];
+        String[] paths = new String[categories.length];
+        for (int i = 0; i < categories.length; i++) {
+            paths[i] = toServicePath(url) + Constants.PATH_SEPARATOR + categories[i];
         }
         return paths;
     }",0
fixed muc invite with <body/>.," 				if (message != null) {
 					message.markUnread();
 				}
-			} else if (packet.hasChild(""body"")) {
+			} else if (packet.hasChild(""body"")
+					&& !(packet.hasChild(""x"",
+							""http://jabber.org/protocol/muc#user""))) {
 				message = this.parseChat(packet, account);
 				if (message != null) {
 					message.markUnread();",0
Fix loading local images,"     @NonNull
     private Drawable getDrawable(Context context, String source) throws IOException {
         Drawable drawable;
-
         if (isLocalFile(Uri.parse(source))) {
             drawable = loadFile(source);
         } else {
             drawable = loadResource(source);
-            if (drawable == null || NavigationApplication.instance.isDebug()) {
+            if (drawable == null && NavigationApplication.instance.isDebug()) {
                 drawable = readJsDevImage(context, source);
             }
         }
-
+        if (drawable == null) throw new RuntimeException(""Could not load image "" + source);
         return drawable;
     }
 ",0
Close topics after creating all subscriptions on increment-partitions," 
             // get list of cursors name of partition-1
             final String ledgerName = dn.getPartition(1).getPersistenceNamingEncoding();
+            final Set<Topic> topics = Sets.newConcurrentHashSet();
             ((ManagedLedgerFactoryImpl) pulsar().getManagedLedgerFactory()).getMetaStore().getCursors(ledgerName,
                     new MetaStoreCallback<List<String>>() {
 
                         @Override
                         public void operationComplete(List<String> cursors,
                                 org.apache.bookkeeper.mledger.impl.MetaStore.Stat stat) {
-                            List<CompletableFuture<Void>> topicCreationFuture = Lists.newArrayList();
+                            List<CompletableFuture<Void>> subscriptionCreationFuture = Lists.newArrayList();
                             // create subscriptions for all new partition-topics
                             cursors.forEach(cursor -> {
                                 String subName = Codec.decode(cursor);
@@ -1317,6 +1318,8 @@
                                     final String topicName = dn.getPartition(i).toString();
                                     CompletableFuture<Void> future = new CompletableFuture<>();
                                     pulsar().getBrokerService().getTopic(topicName).handle((topic, ex) -> {
+                                        // cache topic to close all of them after creating all subscriptions
+                                        topics.add(topic);
                                         if (ex != null) {
                                             log.warn(""[{}] Failed to create topic {}"", clientAppId(), topicName);
                                             future.completeExceptionally(ex);
@@ -1329,10 +1332,8 @@
                                                     future.completeExceptionally(e);
                                                     return null;
                                                 } else {
-                                                    log.info(""[{}] Successfully create subsciption {} {}"",
+                                                    log.info(""[{}] Successfully created subsciption {} {}"",
                                                             clientAppId(), topicName, subName);
-                                                    // close topic
-                                                    topic.close();
                                                     future.complete(null);
                                                     return null;
                                                 }
@@ -1340,20 +1341,30 @@
                                             return null;
                                         }
                                     });
-                                    topicCreationFuture.add(future);
+                                    subscriptionCreationFuture.add(future);
                                 }
                             });
                             // wait for all subscriptions to be created
-                            FutureUtil.waitForAll(topicCreationFuture).handle((res, e) -> {
-                                if (e != null) {
-                                    result.completeExceptionally(e);
+                            FutureUtil.waitForAll(subscriptionCreationFuture).handle((res, subscriptionException) -> {
+                                // close all topics and then complete result future 
+                                FutureUtil.waitForAll(
+                                        topics.stream().map(topic -> topic.close()).collect(Collectors.toList()))
+                                        .handle((closed, topicCloseException) -> {
+                                            if (topicCloseException != null) {
+                                                log.warn(""Failed to close newly created partitioned topics for {} "", dn,
+                                                        topicCloseException);
+                                            }
+                                            if (subscriptionException != null) {
+                                                result.completeExceptionally(subscriptionException);
                                 } else {
-                                    log.info(""[{}] Successfully create new partitions {}"", clientAppId(),
+                                                log.info(""[{}] Successfully created new partitions {}"", clientAppId(),
                                             dn.toString());
                                     result.complete(null);
                                 }
                                 return null;
                             });
+                                return null;
+                            });
                         }
 
                         @Override",0
fix:全屏或小屏退出时不触发ON_QUIT_XXX事件的问题,"     //退出全屏和小窗的方法
     public void playOnThisJcvd() {
         Log.i(TAG, ""playOnThisJcvd "" + "" ["" + this.hashCode() + ""] "");
-        onEvent(currentScreen == JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
+/*        onEvent(currentScreen == JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
                 JCUserAction.ON_QUIT_FULLSCREEN :
-                JCUserAction.ON_QUIT_TINYSCREEN);
+                JCUserAction.ON_QUIT_TINYSCREEN);*/
         //1.清空全屏和小窗的jcvd
         currentState = JCVideoPlayerManager.getSecondFloor().currentState;
         clearFloatScreen();
@@ -616,6 +616,12 @@
             return false;
         if (JCVideoPlayerManager.getSecondFloor() != null) {
             CLICK_QUIT_FULLSCREEN_TIME = System.currentTimeMillis();
+
+            JCVideoPlayer jcVideoPlayer = JCVideoPlayerManager.getSecondFloor();
+            jcVideoPlayer.onEvent(jcVideoPlayer.currentScreen == JCVideoPlayerStandard.SCREEN_WINDOW_FULLSCREEN ?
+                    JCUserAction.ON_QUIT_FULLSCREEN :
+                    JCUserAction.ON_QUIT_TINYSCREEN);
+
             JCVideoPlayerManager.getFirstFloor().playOnThisJcvd();
             return true;
         } else if (JCVideoPlayerManager.getFirstFloor() != null &&",0
JENKINS-48872# Fix deserialization error for missing ModelObject field," package io.jenkins.blueocean.service.embedded;
 
+import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import hudson.model.ModelObject;
 import io.jenkins.blueocean.rest.factory.BlueOceanUrlMapper;
 import io.jenkins.blueocean.rest.model.BlueOceanUrlObject;
-
 import javax.annotation.Nonnull;
 
 /**
@@ -13,6 +13,10 @@
 
     private final String mappedUrl;
 
+    // leave it there to avoid deserialization errors for older version of this object
+    @SuppressFBWarnings(value = ""UUF_UNUSED_FIELD"", justification = ""Field is present to avoid deserialization errors for older version of this object"")
+    private transient ModelObject modelObject;
+
     public BlueOceanUrlObjectImpl(ModelObject modelObject) {
         this.mappedUrl = computeUrl(modelObject);
     }",0
Fix the connection leaking issue.,"         AdminClient adminClient = AdminClient.createTempAdminClient(voldemortConfig,
                                                                     metadataStore.getCluster(),
                                                                     1);
+        try {
         // Get replica.factor for current store
         StoreDefinition storeDef = adminClient.metadataMgmtOps.getStoreDefinition(storeName);
         if (null == storeDef) {
@@ -2139,6 +2140,9 @@
 
         response.setSwapIsPossible(swapIsPossible);
         response.setInfo(responseMessage);
+        } finally {
+            adminClient.close();
+        }
 
         return response.build();
     }",0
<T> javadoc fix up,"      * </pre>
      *
      * @param propertyName the name of the property to retrieve
+     * @param <T>          the type of result
      *
      * @return a new PropertyDataFetcher using the provided function as its source of values
      */
@@ -100,6 +101,7 @@
      *
      * @param function the function to use to obtain a value from the source object
      * @param <O>      the type of the source object
+     * @param <T>      the type of result
      *
      * @return a new PropertyDataFetcher using the provided function as its source of values
      */",0
Fixes JENKINS-13649,"             this.remote = normalize(rel);
         } else 
         if(base.isUnix()) {
-            this.remote = normalize(base.remote+'/'+rel);
+            // shouldn't need this replace, but better safe than sorry
+            this.remote = normalize(base.remote+'/'+rel.replace('\\','/'));
         } else {
-            this.remote = normalize(base.remote+'\\'+rel);
+            // need this replace, see Slave.getWorkspaceFor and AbstractItem.getFullName, nested jobs on Windows
+            // slaves will always have a rel containing at least one '/' character. JENKINS-13649
+            this.remote = normalize(base.remote+'\\'+rel.replace('/','\\'));
         }
     }
 ",0
Show error if failed to active the certificate," // ZAP: 2017/01/09 Remove method no longer needed.
 // ZAP: 2017/01/23 Select first alias of selected keystore
 // ZAP: 2017/08/16 Tidy up usage of CertificateView.
+// ZAP: 2017/08/16 Show error message if failed to activate the certificate.
 
 package org.parosproxy.paros.extension.option;
 
@@ -218,7 +219,16 @@
 			setActiveButton.addActionListener(new java.awt.event.ActionListener() {
 				@Override
 				public void actionPerformed(java.awt.event.ActionEvent evt) {
+					try {
 					setActiveButtonActionPerformed(evt);
+					} catch (ProviderException e) {
+						JOptionPane.showMessageDialog(
+								null,
+								new String[] { Constant.messages.getString(""options.cert.error.accesskeystore""), e.toString() },
+								Constant.messages.getString(""options.cert.error""),
+								JOptionPane.ERROR_MESSAGE);
+						logger.error(e.getMessage(), e);
+					}
 				}
 			});
 ",0
conversation settings fix #368,"     }
 
     public SharedPreferences getConversationPrefs() {
-        return mPrefs;
+        return mConversationPrefs;
     }
 }",0
fix to resolve problems with entities appearing as either white or black," 
     private TObjectIntMap<String> bindMap = new TObjectIntHashMap<>();
     private TIntObjectMap<Texture> textureMap = new TIntObjectHashMap<>();
+
     private GLSLShader shader;
     private boolean activeFeaturesChanged;
     private TObjectIntMap<UniformId> uniformLocationMap = new TObjectIntHashMap<>();
@@ -72,11 +73,13 @@
     private ShaderParameters shaderParameters;
 
     private DisposalAction disposalAction;
+    private MaterialData materialData;
 
     public GLSLMaterial(ResourceUrn urn, AssetType<?, MaterialData> assetType, MaterialData data) {
         super(urn, assetType);
         disposalAction = new DisposalAction(urn);
         getDisposalHook().setDisposeAction(disposalAction);
+        this.materialData = data;
         shaderManager = CoreRegistry.get(ShaderManager.class);
         reload(data);
     }
@@ -143,6 +146,7 @@
         }
         disposalAction.shaderPrograms.clear();
         uniformLocationMap.clear();
+        bindMap.clear();
 
         disposalAction.shaderPrograms.put(0, shader.linkShaderProgram(0));
         for (Set<ShaderProgramFeature> permutation : Sets.powerSet(shader.getAvailableFeatures())) {
@@ -152,6 +156,12 @@
         if (shaderParameters != null) {
             shaderParameters.initialParameters(this);
         }
+
+        //resolves #966
+        //Some of the uniforms are not updated constantly between frames
+        //this function will rebind any uniforms that are not bound
+        rebindVaribles(materialData);
+
     }
 
     @Override
@@ -163,7 +173,21 @@
 
                 shader = (GLSLShader) data.getShader();
                 recompile();
+                rebindVaribles(data);
 
+            });
+        } catch (InterruptedException e) {
+            logger.error(""Failed to reload {}"", getUrn(), e);
+        }
+    }
+
+    /**
+     * Rebindes all the varibles from MaterialData this is only called when the shader first loads
+     * and then it get's recompiled.
+     * @param data
+     */
+    private void rebindVaribles(MaterialData data)
+    {
                 for (Map.Entry<String, Texture> entry : data.getTextures().entrySet()) {
                     setTexture(entry.getKey(), entry.getValue());
                 }
@@ -195,11 +219,8 @@
                             break;
                     }
                 }
-            });
-        } catch (InterruptedException e) {
-            logger.error(""Failed to reload {}"", getUrn(), e);
         }
-    }
+
 
 
     @Override",0
"fix #1278 修复PHP5.3,5.4版本PDO使用服务端prepare的BUG","  * 
  *  values:                    for all non-NULL values, each parameters appends its value
  *                             as described in Row Data Packet: Binary (column values)
- * @see http://dev.mysql.com/doc/internals/en/execute-packet.html
+ * @see https://dev.mysql.com/doc/internals/en/com-stmt-execute.html
  * </pre>
  * 
- * @author mycat
+ * @author mycat, CrazyPig
  */
 public class ExecutePacket extends MySQLPacket {
 
@@ -108,6 +108,7 @@
 
         // 读取NULL指示器数据
         int parameterCount = values.length;
+        if(parameterCount > 0) {
         nullBitMap = new byte[(parameterCount + 7) / 8];
         for (int i = 0; i < nullBitMap.length; i++) {
             nullBitMap[i] = mm.read();
@@ -115,6 +116,7 @@
 
         // 当newParameterBoundFlag==1时，更新参数类型。
         newParameterBoundFlag = mm.read();
+        }
         if (newParameterBoundFlag == (byte) 1) {
             for (int i = 0; i < parameterCount; i++) {
                 pstmt.getParametersType()[i] = mm.readUB2();",0
fix targetElement NPE,"     @Override
     protected void onDetachedFromWindow() {
         super.onDetachedFromWindow();
-        targetElement = null;
         if (dialog != null) {
             dialog.dismiss();
         }
+        targetElement = null;
     }
 
     public void setOnDragListener(OnDragListener onDragListener) {",0
minor javadoc fix,"   /**
    * Reads the entire file as represented by the path {@code path} as a {@link Buffer}, asynchronously.
    * <p>
-   * Do not user this method to read very large files or you risk running out of available RAM.
+   * Do not use this method to read very large files or you risk running out of available RAM.
    *
    * @param path  path to the file
    * @param handler  the handler that will be called on completion",0
Fixed a bug in the equals function," 	 */
 	public boolean equals(final Quaternion other, final double tolerance) {
 		double fCos = dot(other);
+		if (fCos > 1.0 && (fCos - 1.0) < tolerance) return true;
 		double angle = Math.acos(fCos);
-
 		return (Math.abs(angle) <= tolerance) || MathUtil.realEqual(angle, MathUtil.PI, tolerance);
 	}
 	",0
Fix nextPlayPos in clearQueue(),"         setShuffleMode(ShuffleMode.OFF);
         stop(true);
         playPos = -1;
+        nextPlayPos = -1;
         notifyChange(InternalIntents.QUEUE_CHANGED);
     }
 ",0
Fixed typo in file chooser dialog," 			} else {
 				JFileChooser chooser = new JFileChooser();
 				chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
-				chooser.setDialogTitle(""Chose destination"");
+				chooser.setDialogTitle(""Choose destination"");
 				int result = chooser.showOpenDialog(null);
 				if (result == JFileChooser.APPROVE_OPTION) {
 					File dir = chooser.getSelectedFile();",0
Remove temp Sequence requests on session clean up," // ZAP: 2016/04/12 Update the SiteNode when deleting alerts
 // ZAP: 2016/05/27 Moved the temporary types to this class
 // ZAP: 2016/05/30 Add new type for CONNECT requests received by the proxy
+// ZAP: 2016/06/15 Add TYPE_SEQUENCE_TEMPORARY
 
 package org.parosproxy.paros.model;
 
@@ -148,6 +149,7 @@
      * <li>{@link #TYPE_SCANNER_TEMPORARY};</li>
      * <li>{@link #TYPE_AUTHENTICATION};</li>
      * <li>{@link #TYPE_SPIDER_TASK};</li>
+     * <li>{@link #TYPE_SEQUENCE_TEMPORARY};</li>
      * </ul>
      * <p>
      * Persisted messages with temporary types are deleted when the session is closed.
@@ -167,6 +169,14 @@
      */
     public static final int TYPE_PROXY_CONNECT = 16;
 
+    /**
+     * A (temporary) HTTP message created/used when active scanning sequences.
+     * 
+     * @since TODO add version
+     * @see #DEFAULT_TEMPORARY_HISTORY_TYPES
+     */
+    public static final int TYPE_SEQUENCE_TEMPORARY = 17;
+
    private static java.text.DecimalFormat decimalFormat = new java.text.DecimalFormat(""##0.###"");
 	private static TableHistory staticTableHistory = null;
 	// ZAP: Support for multiple tags
@@ -180,6 +190,7 @@
 		defaultHistoryTypes.add(Integer.valueOf(HistoryReference.TYPE_SCANNER_TEMPORARY));
 		defaultHistoryTypes.add(Integer.valueOf(HistoryReference.TYPE_AUTHENTICATION));
 		defaultHistoryTypes.add(Integer.valueOf(HistoryReference.TYPE_SPIDER_TASK));
+		defaultHistoryTypes.add(Integer.valueOf(HistoryReference.TYPE_SEQUENCE_TEMPORARY));
 		DEFAULT_TEMPORARY_HISTORY_TYPES = Collections.unmodifiableSet(defaultHistoryTypes);
 
 		TEMPORARY_HISTORY_TYPES.addAll(DEFAULT_TEMPORARY_HISTORY_TYPES);",0
fix buffer pool not import," import java.util.ArrayList;
 import java.util.List;
 import java.util.concurrent.ConcurrentLinkedQueue;
+import java.util.concurrent.atomic.AtomicInteger;
 
 import org.apache.log4j.Logger;
 ",0
fix(core): properly invoke jarsigner,"             if (mSignedApk.exists()) {
                 mSignedApk.delete();
             }
-            String cmd = ""jarsigner -sigalg MD5withRSA -digestalg SHA1 -keystore "" + config.mSignatureFile
-                + "" -storepass "" + config.mStorePass
-                + "" -keypass "" + config.mKeyPass
-                + "" -signedjar "" + mSignedApk.getAbsolutePath()
-                + "" "" + mUnSignedApk.getAbsolutePath()
-                + "" "" + config.mStoreAlias;
-            Process pro = Runtime.getRuntime().exec(cmd);
+            String[] argv = {
+                ""jarsigner"", ""-sigalg"", ""MD5withRSA"", ""-digestalg"", ""SHA1"", ""-keystore"", config.mSignatureFile.toString(),
+                ""-storepass"", config.mStorePass,
+                ""-keypass"", config.mKeyPass,
+                ""-signedjar"", mSignedApk.getAbsolutePath(),
+                mUnSignedApk.getAbsolutePath(),
+                config.mStoreAlias
+            };
+            Process pro = Runtime.getRuntime().exec(argv);
             //destroy the stream
             pro.waitFor();
             pro.destroy();",0
[java] Fix ClassCastException on SignatureDeclareThrowsException,"         ASTImplementsList impl = node.getFirstChildOfType(ASTImplementsList.class);
         if (impl != null && impl.jjtGetParent().equals(node)) {
             for (int ix = 0; ix < impl.jjtGetNumChildren(); ix++) {
-                ASTClassOrInterfaceType type = (ASTClassOrInterfaceType) impl.jjtGetChild(ix);
+            	Node child = impl.jjtGetChild(ix);
+            	
+            	if (child.getClass() != ASTClassOrInterfaceType.class) {
+            		continue;
+            	}
+            	
+                ASTClassOrInterfaceType type = (ASTClassOrInterfaceType) child;
                 if (isJUnitTest(type)) {
                     junitImported = true;
                     return super.visit(node, data);",0
Fix IOSNet POST request to close the stream and set content length correctly.," 					httpWebRequest.set_Headers(webHeaderCollection);
 
 					if (method.equalsIgnoreCase(HttpMethods.POST)) {
-						Stream stream = httpWebRequest.GetRequestStream();
-
 						InputStream contentAsStream = httpRequest.getContentStream();
 						String contentAsString = httpRequest.getContent();
 
 						if (contentAsStream != null) {
+							httpWebRequest.set_ContentLength(contentAsStream.available());
+							
+							Stream stream = httpWebRequest.GetRequestStream();
 							StreamUtils.copyStream(contentAsStream, new OutputStreamNetStreamImpl(stream));
+							stream.Close();
 						} else if (contentAsString != null) {
-							new StreamWriter(stream).Write(contentAsString);
+							byte[] data = contentAsString.getBytes();
+							httpWebRequest.set_ContentLength(data.length);
+							
+							Stream stream = httpWebRequest.GetRequestStream();
+							stream.Write(data, 0, data.length);
+							stream.Close();
 						}
+						
 					}
 
 					final HttpWebResponse httpWebResponse = (HttpWebResponse)httpWebRequest.GetResponse();",0
URLDNS: Small fix to avoid DNS resolution while generating the payload," package ysoserial.payloads;
 
-import java.lang.reflect.InvocationHandler;
+import java.io.IOException;
+import java.net.InetAddress;
+import java.net.URLConnection;
+import java.net.URLStreamHandler;
 import java.util.HashMap;
-import java.util.LinkedHashSet;
-import java.util.Hashtable;
 import java.net.URL;
 
-import javax.xml.transform.Templates;
-
 import ysoserial.payloads.annotation.Dependencies;
 import ysoserial.payloads.util.PayloadRunner;
 import ysoserial.payloads.util.Reflections;
@@ -44,8 +43,13 @@
 public class URLDNS implements ObjectPayload<Object> {
 
         public Object getObject(final String url) throws Exception {
+
+                //Avoid DNS resolution during payload creation
+                //Since the field <code>java.net.URL.handler</code> is transient, it will not be part of the serialized payload.
+                URLStreamHandler handler = new SilentURLStreamHandler();
+
                 HashMap ht = new HashMap(); // HashMap that will contain the URL
-                URL u = new URL(url); // URL to use as the Key
+                URL u = new URL(null, url, handler); // URL to use as the Key
                 ht.put(u, url); //The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.
 
                 Reflections.setFieldValue(u, ""hashCode"", -1); // During the put above, the URL's hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.
@@ -57,4 +61,23 @@
                 PayloadRunner.run(URLDNS.class, args);
         }
 
+        /**
+         * <p>This instance of URLStreamHandler is used to avoid any DNS resolution while creating the URL instance.
+         * DNS resolution is used for vulnerability detection. It is important not to probe the given URL prior
+         * using the serialized object.</p>
+         *
+         * <b>Potential false negative:</b>
+         * <p>If the DNS name is resolved first from the tester computer, the targeted server might get a cache hit on the
+         * second resolution.</p>
+         */
+        static class SilentURLStreamHandler extends URLStreamHandler {
+
+                protected URLConnection openConnection(URL u) throws IOException {
+                        return null;
+                }
+
+                protected synchronized InetAddress getHostAddress(URL u) {
+                        return null;
+                }
+        }
 }",0
Fix for missing time_zone,"             LANGUAGE = json.getString(""language"");
             ALWAYS_USE_HTTPS = getBoolean(""always_use_https"", json);
             DISCOVERABLE_BY_EMAIL = getBoolean(""discoverable_by_email"", json);
+            // https://groups.google.com/forum/?fromgroups=#!topic/twitter4j/zPaAXP9gkU4
+            if (json.isNull(""time_zone"")) {
+                TIMEZONE = null;
+            } else {
             TIMEZONE = new TimeZoneJSONImpl(json.getJSONObject(""time_zone""));
+            }
             SCREEN_NAME = json.getString(""screen_name"");
         } catch (JSONException e) {
             throw new TwitterException(e);",0
Fix bug related to the recently deprecated ``initialize`` method.," package com.karumi.dexter;
 
 import android.app.Activity;
+import android.app.Application;
 import android.content.Context;
 import android.content.Intent;
 import android.content.pm.PackageManager;
+
 import com.karumi.dexter.listener.PermissionDeniedResponse;
 import com.karumi.dexter.listener.PermissionGrantedResponse;
 import com.karumi.dexter.listener.PermissionRequest;
@@ -208,12 +210,16 @@
   }
 
   private void startTransparentActivityIfNeeded() {
-    if (context.get() == null) {
+    Context context = this.context.get();
+    if (context == null) {
       return;
     }
 
-    Intent intent = intentProvider.get(context.get(), DexterActivity.class);
-    context.get().startActivity(intent);
+    Intent intent = intentProvider.get(context, DexterActivity.class);
+    if (context instanceof Application) {
+      intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
+    }
+    context.startActivity(intent);
   }
 
   private void handleDeniedPermissions(Collection<String> permissions) {",0
Spring MVC Test cases with Binary Data download fixed,"             response = mvcResult.getResponse();
             restAssuredResponse = new MockMvcRestAssuredResponseImpl(perform, logRepository);
             restAssuredResponse.setConfig(ConfigConverter.convertToRestAssuredConfig(config));
-            restAssuredResponse.setContent(response.getContentAsString());
+            restAssuredResponse.setContent(response.getContentAsByteArray());
             restAssuredResponse.setContentType(response.getContentType());
             restAssuredResponse.setHasExpectations(false);
             restAssuredResponse.setStatusCode(response.getStatus());",0
Added null check for order when DatabaseOrderLockManager is configured to throw exception instead of queueing the lock attempt," 
     @Override
     public Object acquireLockIfAvailable(Order order) {
-        if (order instanceof NullOrderImpl) {
+        if (order == null || order instanceof NullOrderImpl) {
             if (LOG.isDebugEnabled()) {
-                LOG.debug(""Attempted to grab a lock for a NullOrderImpl. Not blocking"");
+                LOG.debug(""Attempted to grab a lock - order was null or it was a NullOrderImpl. Not blocking"");
             }
             return order;
         }",0
Extending crash fix for Android 4.x with recent Google Play Services to cancel() method…," 
     @Override
     public void cancel(int jobId) {
+        try {
         mGcmNetworkManager.cancelTask(createTag(jobId), PlatformGcmService.class);
+        } catch (IllegalArgumentException e) {
+            if (e.getMessage() != null && e.getMessage().startsWith(""The GcmTaskService class you provided"")) {
+                throw new JobProxyIllegalStateException(e);
+            } else {
+                throw e;
+            }
+        }
     }
 
     @Override",0
Fix another rare crash," 
       int movePosition;
       if (dy > 0) {
-        if (first == 0 && getChildAt(0).getTop() == padTop) {
+		View v = getChildAt(0);
+		if ((v == null) || (first == 0 && v.getTop() == padTop)) {
 					mScrolling = false;
           return;
         }",0
"fix #2974 GeometryUtils#polygonArea(float[], int, int)"," 			int x1 = i;
 			int y1 = i + 1;
 			int x2 = (i + 2) % n;
+			if(x2 < offset)
+				x2 += offset;
 			int y2 = (i + 3) % n;
+			if(y2 < offset)
+				y2 += offset;
 			area += polygon[x1] * polygon[y2];
 			area -= polygon[x2] * polygon[y1];
 		}",0
#320 fixes CREATE OR REPLACE text insertion on Oracle object sources,"         if (body) {
             sourceType += "" BODY"";
         }
-        Pattern srcPattern = Pattern.compile(""("" + sourceType + "")\\s+(\\w+)"", Pattern.CASE_INSENSITIVE);
+        Pattern srcPattern = Pattern.compile(""^("" + sourceType + "")\\s+(\""{0,1}\\w+\""{0,1})"", Pattern.CASE_INSENSITIVE);
         Matcher matcher = srcPattern.matcher(source);
         if (matcher.find()) {
             return",0
Type safety and deprecated API forward-compatibility fixes for Notifications," package eu.siacs.conversations.services;
 
+import android.annotation.SuppressLint;
 import android.app.Notification;
 import android.app.NotificationManager;
 import android.app.PendingIntent;
@@ -8,6 +9,7 @@
 import android.content.SharedPreferences;
 import android.graphics.Bitmap;
 import android.net.Uri;
+import android.os.Build;
 import android.os.PowerManager;
 import android.os.SystemClock;
 import android.support.v4.app.NotificationCompat;
@@ -18,6 +20,9 @@
 import android.util.DisplayMetrics;
 import android.util.Log;
 
+import org.json.JSONArray;
+import org.json.JSONObject;
+
 import java.io.FileNotFoundException;
 import java.util.ArrayList;
 import java.util.Calendar;
@@ -27,15 +32,10 @@
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
-import org.json.JSONArray;
-import org.json.JSONObject;
-
 import eu.siacs.conversations.Config;
 import eu.siacs.conversations.R;
 import eu.siacs.conversations.entities.Account;
 import eu.siacs.conversations.entities.Conversation;
-import eu.siacs.conversations.entities.Downloadable;
-import eu.siacs.conversations.entities.DownloadableFile;
 import eu.siacs.conversations.entities.Message;
 import eu.siacs.conversations.ui.ConversationActivity;
 import eu.siacs.conversations.ui.ManageAccountActivity;
@@ -70,14 +70,14 @@
 				 );
 	}
 
-	public void notifyPebble(Message message) {
+	public void notifyPebble(final Message message) {
 		final Intent i = new Intent(""com.getpebble.action.SEND_NOTIFICATION"");
 
-		final HashMap data = new HashMap();
 		final Conversation conversation = message.getConversation();
-		data.put(""title"", conversation.getName());
-		data.put(""body"", message.getBody());
-		final JSONObject jsonData = new JSONObject(data);
+		final JSONObject jsonData = new JSONObject(new HashMap<String, String>(2) {{
+			put(""title"", conversation.getName());
+			put(""body"", message.getBody());
+		}});
 		final String notificationData = new JSONArray().put(jsonData).toString();
 
 		i.putExtra(""messageType"", ""PEBBLE_ALERT"");
@@ -111,13 +111,28 @@
 		return mXmppConnectionService.getPreferences().getBoolean(""always_notify_in_conference"", false);
 	}
 
+	@SuppressLint(""NewApi"")
+	@SuppressWarnings(""deprecation"")
+	private boolean isInteractive() {
+		final PowerManager pm = (PowerManager) mXmppConnectionService
+			.getSystemService(Context.POWER_SERVICE);
+
+		final boolean isScreenOn;
+		if (android.os.Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {
+			isScreenOn = pm.isScreenOn();
+		} else {
+			isScreenOn = pm.isInteractive();
+		}
+
+		return isScreenOn;
+	}
+
 	public void push(final Message message) {
 		if (!notify(message)) {
 			return;
 		}
-		final PowerManager pm = (PowerManager) mXmppConnectionService
-			.getSystemService(Context.POWER_SERVICE);
-		final boolean isScreenOn = pm.isScreenOn();
+
+		final boolean isScreenOn = isInteractive();
 
 		if (this.mIsInForeground && isScreenOn
 				&& this.mOpenConversation == message.getConversation()) {",0
Fixed incorrect state in drag view's children during drag,"         boolean isSecondViewHit = isViewHit(secondView, (int) ev.getX(), (int) ev.getY());
         if (isMaximized()) {
             dragView.dispatchTouchEvent(ev);
+        } else {
+            dragView.dispatchTouchEvent(cloneMotionEventWithAction(ev, MotionEvent.ACTION_CANCEL));
         }
         return isDragViewHit || isSecondViewHit;
     }
 
     /**
+     * Clone given motion event and set specified action. This method is useful, when we want to
+     * cancel event propagation in child views by sending event with {@link MotionEvent#ACTION_CANCEL} action.
+     * @param event event to clone
+     * @param action new action
+     * @return cloned motion event
+     */
+    private MotionEvent cloneMotionEventWithAction(MotionEvent event, int action) {
+        return MotionEvent.obtain(event.getDownTime(), event.getEventTime(), action,
+                event.getX(), event.getY(), event.getMetaState());
+    }
+
+    /**
      * Override method to configure the dragged view and secondView layout properly.
      *
      * @param changed",0
[HOTFIX][StackedEnsemble] :fire: Do not show StackedEnsemble model builder in Flow UI,"     };
   }
 
+  @Override public BuilderVisibility builderVisibility() { return BuilderVisibility.Experimental; }
+
   @Override protected StackedEnsembleDriver trainModelImpl() { return _driver = new StackedEnsembleDriver(); }
 
   public static void addModelPredictionsToLevelOneFrame(Model aModel, Frame aModelsPredictions, Frame levelOneFrame) {",0
Fix utf8 failure on ibm jdk,"             }
 
             char[] rawChars = (char[]) getCharArray.invoke( input );
-            int len = (int)arrayEncode.invoke( charsetEncoder, rawChars, 0, rawChars.length, out );
+            int len = (int)arrayEncode.invoke( charsetEncoder, rawChars, 0, input.length(), out );
 
             if( len == -1 )
             {",0
[JENKINS-53590] Fix always add a user," import javax.annotation.Nonnull;
 import javax.annotation.Nullable;
 import javax.annotation.concurrent.Immutable;
-import java.io.Serializable;
 import java.nio.charset.StandardCharsets;
 import java.security.MessageDigest;
 import java.security.NoSuchAlgorithmException;
@@ -299,10 +298,7 @@
     }
     
     @Immutable
-    private static class HashValue implements Serializable {
-
-        private static final long serialVersionUID = 1L;
-
+    private static class HashValue {
         /**
          * Allow to distinguish tokens from different versions easily to adapt the logic
          */
@@ -341,10 +337,7 @@
         }
     }
     
-    public static class HashedToken implements Serializable {
-
-        private static final long serialVersionUID = 1L;
-
+    public static class HashedToken {
         // allow us to rename the token and link the statistics
         private String uuid;
         private String name;",0
Make native debug flags toggleable at runtime," public final class Native implements Version {
 
     public static final String DEFAULT_ENCODING = ""utf8"";
-    static final boolean DEBUG_LOAD = Boolean.getBoolean(""jna.debug_load"");
-    static final boolean DEBUG_JNA_LOAD = Boolean.getBoolean(""jna.debug_load.jna"");
+    public static boolean DEBUG_LOAD = Boolean.getBoolean(""jna.debug_load"");
+    public static boolean DEBUG_JNA_LOAD = Boolean.getBoolean(""jna.debug_load.jna"");
 
     // Used by tests, do not remove
     static String jnidispatchPath = null;",0
#6200 Fixes issue with twitch channel string being case-sensitive," 			&& twitchConfig.oauthToken() != null
 			&& twitchConfig.channel() != null)
 		{
-			String channel = twitchConfig.channel();
+			String channel = twitchConfig.channel().toLowerCase();
 			if (!channel.startsWith(""#""))
 			{
 				channel = ""#"" + channel;",0
Fixes #2276 - fix midnight events,"     private static final long DAWN_TIME = DAY_LENGTH / 4;
     private static final long MIDDAY_TIME = DAY_LENGTH / 2;
     private static final long DUSK_TIME = 3 * DAY_LENGTH / 4;
-    private static final long MIDNIGHT_TIME = DAY_LENGTH;
+    private static final long MIDNIGHT_TIME = 0;
 
     @Override
     public float getSunPosAngle(float days) {",0
Fix new RCFile reader support for old files," package com.facebook.presto.rcfile;
 
 import com.facebook.presto.spi.block.Block;
+import com.facebook.presto.spi.block.BlockBuilderStatus;
+import com.facebook.presto.spi.block.RunLengthEncodedBlock;
 import com.facebook.presto.spi.type.Type;
 import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
 import io.airlift.slice.BasicSliceInput;
 import io.airlift.slice.ChunkedSliceInput;
 import io.airlift.slice.ChunkedSliceInput.BufferReference;
@@ -31,11 +32,11 @@
 import java.io.IOException;
 import java.util.Map;
 import java.util.Map.Entry;
-import java.util.Set;
 
 import static com.facebook.presto.rcfile.RcFileDecoderUtils.findFirstSyncPosition;
 import static com.facebook.presto.rcfile.RcFileDecoderUtils.readVInt;
 import static com.google.common.base.Preconditions.checkArgument;
+import static com.google.common.base.Preconditions.checkState;
 import static com.google.common.io.ByteStreams.skipFully;
 import static io.airlift.slice.SizeOf.SIZE_OF_INT;
 import static io.airlift.slice.SizeOf.SIZE_OF_LONG;
@@ -65,7 +66,7 @@
     private static final String COLUMN_COUNT_METADATA_KEY = ""hive.io.rcfile.column.number"";
 
     private final RcFileDataSource dataSource;
-    private final Set<Integer> readColumns;
+    private final Map<Integer, Type> readColumns;
     private final ChunkedSliceInput input;
     private final long length;
 
@@ -105,7 +106,7 @@
             throws IOException
     {
         this.dataSource = requireNonNull(dataSource, ""rcFileDataSource is null"");
-        this.readColumns = ImmutableSet.copyOf(requireNonNull(readColumns, ""readColumns is null"").keySet());
+        this.readColumns = ImmutableMap.copyOf(requireNonNull(readColumns, ""readColumns is null""));
         this.input = new ChunkedSliceInput(new DataSourceSliceLoader(dataSource), toIntExact(bufferSize.toBytes()));
 
         checkArgument(offset >= 0, ""offset is negative"");
@@ -191,9 +192,11 @@
         }
         columns = new Column[columnCount];
         for (Entry<Integer, Type> entry : readColumns.entrySet()) {
+            if (entry.getKey() < columnCount) {
             ColumnEncoding columnEncoding = encoding.getEncoding(entry.getValue());
             columns[entry.getKey()] = new Column(columnEncoding, decompressor);
         }
+        }
 
         // read sync bytes
         syncFirst = input.readLong();
@@ -367,7 +370,7 @@
 
             Slice lengthsBuffer = headerInput.readSlice(lengthsSize);
 
-            if (readColumns.contains(columnIndex)) {
+            if (readColumns.containsKey(columnIndex)) {
                 Slice dataBuffer = input.readSlice(compressedDataSize);
                 columns[columnIndex].setBuffers(lengthsBuffer, dataBuffer, uncompressedDataSize);
             }
@@ -382,12 +385,15 @@
     public Block readBlock(int columnIndex)
             throws IOException
     {
-        if (columns[columnIndex] == null) {
-            throw new IllegalArgumentException(""Column "" + columnIndex + "" is not being read"");
+        checkArgument(readColumns.containsKey(columnIndex), ""Column %s is not being read"", columnIndex);
+        checkState(currentChunkRowCount > 0, ""No more data"");
+
+        if (columnIndex >= columns.length) {
+            Type type = readColumns.get(columnIndex);
+            Block nullBlock = type.createBlockBuilder(new BlockBuilderStatus(), 1, 0).appendNull().build();
+            return new RunLengthEncodedBlock(nullBlock, currentChunkRowCount);
         }
-        if (currentChunkRowCount <= 0) {
-            throw new IllegalStateException(""No more data"");
-        }
+
         return columns[columnIndex].readBlock(rowGroupPosition, currentChunkRowCount);
     }
 ",0
Fixed 'New File' FAB action. Was creating a new folder instead of a new file.,"         materialDialog.show();
     }
     void mkfile(final int openMode,final String path,final Main ma){
-        final MaterialDialog materialDialog=utils.showNameDialog(mainActivity,new String[]{utils.getString(mainActivity, R.string.entername), """",utils.getString(mainActivity,R.string.newfolder),utils.getString(mainActivity, R.string.create),utils.getString(mainActivity,R.string.cancel),null});
+        final MaterialDialog materialDialog=utils.showNameDialog(mainActivity,new String[]{utils.getString(mainActivity, R.string.entername), """",utils.getString(mainActivity,R.string.newfile),utils.getString(mainActivity, R.string.create),utils.getString(mainActivity,R.string.cancel),null});
         materialDialog.getActionButton(DialogAction.POSITIVE).setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
                 String a = materialDialog.getInputEditText().getText().toString();
-                mkDir(new HFile(openMode,path + ""/"" + a),ma);
+                mkFile(new HFile(openMode,path + ""/"" + a),ma);
                 materialDialog.dismiss();
             }
         });",0
Converted from utc to local time. Fixes #991.,"         return getRelativeTime(stringToDate(date));
     }
 
+    /**
+     * Convert string datetime in UTC to local datetime.
+     * @param value The datetime in UTC to parse.
+     * @return Local datetime.
+     */
     public static Date stringToDate(String value){
         DateTimeFormatter format = DateTimeFormat.forPattern(""yyyy-MM-dd'T'HH:mm:ss'Z'"");
-        DateTime t = format.parseDateTime(value);
+        DateTime t = format.withZoneUTC().parseDateTime(value);
         return t.toDate();
     }
 ",0
Use input from the input state in launchExisting() for radio.," 
 import com.codahale.metrics.annotation.Timed;
 import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.Maps;
 import com.google.common.collect.Sets;
+import org.graylog2.plugin.IOState;
 import org.graylog2.plugin.Tools;
 import org.graylog2.plugin.configuration.Configuration;
 import org.graylog2.plugin.configuration.ConfigurationException;
-import org.graylog2.plugin.IOState;
 import org.graylog2.plugin.inputs.MessageInput;
 import org.graylog2.radio.rest.resources.RestResource;
+import org.graylog2.rest.models.system.inputs.requests.InputLaunchRequest;
 import org.graylog2.rest.models.system.inputs.responses.InputStateSummary;
 import org.graylog2.rest.models.system.inputs.responses.InputSummary;
 import org.graylog2.rest.models.system.inputs.responses.InputsList;
-import org.graylog2.shared.inputs.InputDescription;
 import org.graylog2.shared.inputs.InputLauncher;
 import org.graylog2.shared.inputs.InputRegistry;
 import org.graylog2.shared.inputs.MessageInputFactory;
 import org.graylog2.shared.inputs.NoSuchInputTypeException;
 import org.graylog2.shared.inputs.PersistedInputs;
-import org.graylog2.rest.models.system.inputs.requests.InputLaunchRequest;
-import org.graylog2.shared.rest.resources.system.inputs.responses.InputTypesSummary;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -50,7 +47,6 @@
 import javax.ws.rs.Path;
 import javax.ws.rs.PathParam;
 import javax.ws.rs.Produces;
-import javax.ws.rs.WebApplicationException;
 import javax.ws.rs.core.MediaType;
 import javax.ws.rs.core.Response;
 import java.io.IOException;
@@ -218,7 +214,19 @@
         final IOState<MessageInput> inputState = inputRegistry.getInputState(inputId);
 
         if (inputState == null || inputState.getState() != IOState.Type.RUNNING) {
-            final MessageInput input = persistedInputs.get(inputId);
+            final MessageInput input;
+
+            if (inputState == null) {
+                // No previously running input found. Initialize a new one.
+                input = persistedInputs.get(inputId);
+
+                if (input != null) {
+                    input.initialize();
+                }
+            } else {
+                // Use the previously running input.
+                input = inputState.getStoppable();
+            }
 
             if (input == null) {
                 final String message = ""Cannot launch input <"" + inputId + "">. Input not found."";
@@ -227,8 +235,6 @@
             }
 
             LOG.info(""Launching existing input ["" + input.getName() + ""]. Reason: REST request."");
-            if (inputState == null)
-                input.initialize();
             inputLauncher.launch(input);
             LOG.info(""Launched existing input ["" + input.getName() + ""]. Reason: REST request."");
         }",0
Fixed a typo in GL10.java," import java.nio.Buffer;
 import java.nio.FloatBuffer;
 
-/** Interface wrapping all standard OpenGL ES 1.0 methods. Note that this excludes and fixed point OpenGL ES 1.0 methods!
+/** Interface wrapping all standard OpenGL ES 1.0 methods. Note that this excludes any fixed point OpenGL ES 1.0 methods!
  * 
  * @author mzechner */
 public interface GL10 extends GLCommon {",0
Fixing incorrect method used.,"         }
         long scheduleTime = time.getGameTimeInMs() + event.getDelay();
         DelayedActionComponent delayedComponent = new DelayedActionComponent(scheduleTime, event.getActionId());
-        entity.saveComponent(delayedComponent);
+        entity.addComponent(delayedComponent);
     }
 
     private static final class DelayedOperation {",0
bug fix for null overwrite of formKey if it exissts,"             }
         }
         
-        if (StringUtils.isEmpty(formKey)) {
+        if (StringUtils.isEmpty(finalFormKey)) {
             finalFormKey = formKey;
         }
         ",0
[java] Fix misconfiguration detection,"         return super.visit(cUnit, data);
     }
 
-
     private boolean allCommentsAreIgnored() {
 
-        return getProperty(HEADER_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
+        return getProperty(OVERRIDE_CMT_DESCRIPTOR) == CommentRequirement.Ignored
+                && getProperty(ACCESSOR_CMT_DESCRIPTOR) == CommentRequirement.Ignored
+                && getProperty(HEADER_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
                && getProperty(FIELD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
                && getProperty(PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
                && getProperty(PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
+                && getProperty(ENUM_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
                && getProperty(SERIAL_VERSION_UID_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored;
     }
 
-
     @Override
     public String dysfunctionReason() {
         return allCommentsAreIgnored() ? ""All comment types are ignored"" : null;
     }
 
-
     private enum CommentRequirement {
         Required(""Required""), Ignored(""Ignored""), Unwanted(""Unwanted"");
 ",0
Minor fix for CifarDataSetIterator,"     }
 
     @Override
+    public boolean resetSupported() {
+        return true;
+    }
+
+    @Override
     public List<String> getLabels() {
         return loader.getLabels();
     }",0
"fix: Exception doesn't catch NoSuchMethodError, Throwable does"," 				return activityUtils.getCurrentActivity().getFragmentManager().findFragmentById(id);
 			else
 				return activityUtils.getCurrentActivity().getFragmentManager().findFragmentByTag(tag);
-		}catch (Exception ignored) {}
+		}catch (Throwable ignored) {}
 
 		return null;
 	}",0
[PDI-11422]: Fix error when opening Zip File job entry - backport,"     wCreateMoveToDirectory.setSelection( jobEntry.isCreateMoveToDirectory() );
     wIncludeSubfolders.setSelection( jobEntry.isIncludingSubFolders() );
 
-    wStoredSourcePathDepth.setText( jobEntry.getStoredSourcePathDepth() );
+    wStoredSourcePathDepth.setText( Const.NVL( jobEntry.getStoredSourcePathDepth(), """" ) );
 
     wName.selectAll();
     wName.setFocus();",0
Fix cancelling wakeup alarm," import android.content.Context;
 import android.content.Intent;
 import android.os.Handler;
-import android.util.Log;
 
 import org.altbeacon.beacon.BeaconManager;
 import org.altbeacon.beacon.logging.LogManager;
@@ -319,7 +318,7 @@
         // devices.
         long milliseconds = Long.MAX_VALUE; // 2.9 million years from now
         AlarmManager alarmManager = (AlarmManager) mContext.getSystemService(Context.ALARM_SERVICE);
-        alarmManager.set(AlarmManager.RTC_WAKEUP, System.currentTimeMillis() + milliseconds, getWakeUpOperation());
+        alarmManager.set(AlarmManager.RTC_WAKEUP, milliseconds, getWakeUpOperation());
         LogManager.d(TAG, ""Set a wakeup alarm to go off in %s ms: %s"", milliseconds, getWakeUpOperation());
 
     }",0
Fix invalid javadoc in BatchedExecutionStrategy,"  * Execution Strategy that minimizes calls to the data fetcher when used in conjunction with {@link DataFetcher}s that have
  * {@link DataFetcher#get(DataFetchingEnvironment)} methods annotated with {@link Batched}. See the javadoc comment on
  * {@link Batched} for a more detailed description of batched data fetchers.
- * <p/>
+ * <p>
  * The strategy runs a BFS over terms of the query and passes a list of all the relevant sources to the batched data fetcher.
- * <p/>
+ * </p>
  * Normal DataFetchers can be used, however they will not see benefits of batching as they expect a single source object
  * at a time.
  */",0
Fix SSL proxy tunnelling.," 
                 // this SSL connection is proxied, must issue a CONNECT request to the proxy server
                 // http://stackoverflow.com/a/6594880/704837
-                String connect = String.format(""CONNECT %s:%s HTTP/1.1\r\n\r\n"", uri.getHost(), port);
+                // some proxies also require 'Host' header, it should be safe to provide it every time
+                String connect = String.format(""CONNECT %s:%s HTTP/1.1\r\nHost: %s\r\n\r\n"", uri.getHost(), port, uri.getHost());
                 Util.writeAll(socket, connect.getBytes(), new CompletedCallback() {
                     @Override
                     public void onCompleted(Exception ex) {
@@ -116,23 +117,18 @@
                             @Override
                             public void onStringAvailable(String s) {
                                 if (statusLine == null) {
-                                    statusLine = s;
-                                    if (statusLine.length() > 128 || !statusLine.contains(""200"")) {
+                                    statusLine = s.trim();
+                                    if (!statusLine.matches(""HTTP/1.\\d 2\\d\\d .*"")) { // connect response is allowed to have any 2xx status code
                                         socket.setDataCallback(null);
                                         socket.setEndCallback(null);
-                                        callback.onConnectCompleted(new IOException(""non 200 status line""), socket);
+                                        callback.onConnectCompleted(new IOException(""non 2xx status line""), socket);
                                     }
                                 }
-                                else {
+                                else if (TextUtils.isEmpty(s.trim())) { // skip all headers, complete handshake once empty line is received
                                     socket.setDataCallback(null);
                                     socket.setEndCallback(null);
-                                    if (TextUtils.isEmpty(s.trim())) {
                                         tryHandshake(socket, data, uri, port, callback);
                                     }
-                                    else {
-                                        callback.onConnectCompleted(new IOException(""unknown second status line""), socket);
-                                    }
-                                }
                             }
                         });
 ",0
OSX bugfix," 
 	@Override
 	public void start(final Stage primaryStage) throws IOException {
+		ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
+		Platform.runLater(() -> {
+			/*
+			 * This fixes a bug on OSX where the magic file open handler leads
+			 * to no context class loader being set in the AppKit (event) thread
+			 * if the application is not started opening a file.
+			 */
+			if (Thread.currentThread().getContextClassLoader() == null) {
+				Thread.currentThread().setContextClassLoader(contextClassLoader);
+			}
+		});
+
 		Runtime.getRuntime().addShutdownHook(MainApplication.CLEAN_SHUTDOWN_PERFORMER);
 
 		executorService = Executors.newCachedThreadPool();",0
fix android rooBackgroundImage support,"         result.topTabsHeight = getInt(""topTabsHeight"", getDefaultTopTabsHeight());
 
         result.screenBackgroundColor = getColor(""screenBackgroundColor"", getDefaultScreenBackgroundColor());
+        result.rootBackgroundImageName = params.getString(""rootBackgroundImageName"");
 
         result.bottomTabsInitialIndex = getInt(""initialTabIndex"", 0);
         result.bottomTabsHidden = getBoolean(""bottomTabsHidden"", getDefaultBottomTabsHidden());",0
fixed hash collide in fetch requests,"     private final RowDelegate partitionRowDelegate = new RowDelegate();
     private final Object rowDelegateLock = new Object();
     private final Row outputRow;
-    private final Map<Integer, NodeBucket> nodeBuckets = new HashMap<>();
+    private final Map<String, NodeBucket> nodeBuckets = new HashMap<>();
     private final AtomicInteger remainingUpstreams = new AtomicInteger(0);
     private final AtomicBoolean consumingRows = new AtomicBoolean(true);
     private final List<String> executionNodes;
@@ -169,13 +169,11 @@
 
         String nodeId = jobSearchContextIdToNode.get(jobSearchContextId);
         String index = jobSearchContextIdToShard.get(jobSearchContextId).getIndex();
-        int nodeIdIndex = Objects.hash(nodeId);
 
-        NodeBucket nodeBucket = nodeBuckets.get(nodeIdIndex);
+        NodeBucket nodeBucket = nodeBuckets.get(nodeId);
         if (nodeBucket == null) {
             nodeBucket = new NodeBucket(nodeId, executionNodes.indexOf(nodeId));
-            nodeBuckets.put(nodeIdIndex, nodeBucket);
-
+            nodeBuckets.put(nodeId, nodeBucket);
         }
         Row partitionRow = partitionedByRow(index);
         nodeBucket.add(inputCursor++, docId, partitionRow, row);",0
Fix SyncProvidersTest with ActiveDirectory,"         picketlinkUser.setFirstName(firstName);
         picketlinkUser.setLastName(lastName);
         picketlinkUser.setEmail(email);
-        picketlinkUser.setAttribute(new Attribute(""fullName"", getFullName(username, firstName, lastName)));
         idmManager.update(picketlinkUser);
         return picketlinkUser;
     }",0
[BACKLOG-26444] Small fix to mapping indices in the Meta Inject Analyzer,"       // mappings are ignored, and instead, data is sent directly
       final boolean ignoreMapping = sourceInjectorStepField.getStepname().equalsIgnoreCase(
         meta.getStreamSourceStepname() );
-      String mappingKey = ""mapping ["" + mappingCount++ + ""]"";
+      String mappingKey;
       if ( !ignoreMapping ) {
+        mappingKey = ""mapping ["" + mappingCount++ + ""]"";
         // if the target template step name is the same as the step we read from (sourceStepName), we want to get the
         // output fields from the target template step and pass them back (input) into the parent injector step
         if ( targetTemplateStepName.equalsIgnoreCase( sourceStepName ) ) {",0
Low priority / typo fix ,"                 // preserve explicitly specified message id, as it may be lost on save
                 mimeMessage.setHeader(""Message-ID"", messageId);
             }
-            LOG.debug(""Sending MimMessage: {} using host: {}"", mimeMessage, host);
+            LOG.debug(""Sending MimeMessage: {} using host: {}"", mimeMessage, host);
             transport.sendMessage(mimeMessage, mimeMessage.getAllRecipients());
         } finally {
             try {",0
unique URLs in findAndReadConfigFile to work around apparent sbt/nsc bug," import java.util.ArrayList;
 import java.util.Enumeration;
 import java.util.HashMap;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
@@ -106,7 +107,7 @@
 
     public static Map findAndReadConfigFile(String name, boolean mustExist) {
         try {
-            List<URL> resources = findResources(name);
+            HashSet<URL> resources = new HashSet<URL>(findResources(name));
             if(resources.isEmpty()) {
                 if(mustExist) throw new RuntimeException(""Could not find config file on classpath "" + name);
                 else return new HashMap();
@@ -115,7 +116,7 @@
                 throw new RuntimeException(""Found multiple "" + name + "" resources. You're probably bundling the Storm jars with your topology jar. ""
                   + resources);
             }
-            URL resource = resources.get(0);
+            URL resource = resources.iterator().next();
             Yaml yaml = new Yaml();
             Map ret = (Map) yaml.load(new InputStreamReader(resource.openStream()));
             if(ret==null) ret = new HashMap();",0
fix bug Unknown database,"         int length = schema.length();
         if (length > 0) {
             if (schema.charAt(0) == '`' && schema.charAt(length - 1) == '`') {
-                schema = schema.substring(1, length - 2);
+                schema = schema.substring(1, length - 1);
             }
         }
 ",0
修复bug 1.5版本having 失效问题，此问题在1.6版本上与2016年3月15日修复," 
 			//clear group having
 			SQLSelectGroupByClause groupByClause = mysqlSelectQuery.getGroupBy();
-			if(groupByClause != null && groupByClause.getHaving() != null){
+			if(groupByClause != null && groupByClause.getHaving() != null && isRoutMultiNode(schema,rrs)){
 				groupByClause.setHaving(null);
 			}
 ",0
fix RajLog error," 							fis = new FileInputStream(filePath);
 							mat.addTexture(new Texture(getOnlyFileName(matDef.diffuseTexture), new Etc1Texture(getOnlyFileName(matDef.diffuseTexture)+""etc1"", fis, null)));
 						} catch (FileNotFoundException e) {
-							RajLog.e(""LoaderOBJ"", ""File decode error"", e);
+							RajLog.e(""LoaderOBJ"", ""File decode error"");
 						} finally {
 							try {
 								fis.close();",0
Fixed views not being removed from the item container.," 
     private void clearItems() {
         if (mItemContainer != null) {
-            int childCount = mItemContainer.getChildCount();
-
-            if (childCount > 0) {
-                for (int i = 0; i < childCount; i++) {
-                    mItemContainer.removeView(mItemContainer.getChildAt(i));
-                }
-            }
+            mItemContainer.removeAllViews();
         }
 
         if (mFragmentManager != null) {",0
1.x: Don't swallow fatal errors in OperatorZipIterable,"             @Override
             public void onError(Throwable e) {
                 if (done) {
+                    Exceptions.throwIfFatal(e);
                     return;
                 }
                 done = true;",0
Fix：运行Demo测试so库加载crash #60,"     /**
      * copy so lib to specify directory(/data/data/host_pack_name/pluginlib)
      * 
-     * @param dexPath plugin path
-     * @param cpuName cpuName CPU_X86,CPU_MIPS,CPU_ARMEABI
+     * @param dexPath
+     *            plugin path
+     * @param cpuName
+     *            cpuName CPU_X86,CPU_MIPS,CPU_ARMEABI
      */
     public void copyPluginSoLib(Context context, String dexPath, String nativeLibDir) {
         String cpuName = getCpuName();
@@ -114,27 +116,24 @@
         Log.d(TAG, ""cpuArchitect: "" + cpuArchitect);
         long start = System.currentTimeMillis();
         try {
-            ZipFile zip = new ZipFile(dexPath);
-            Enumeration<? extends ZipEntry> entries = zip.entries();
+            ZipFile zipFile = new ZipFile(dexPath);
+            Enumeration<? extends ZipEntry> entries = zipFile.entries();
             while (entries.hasMoreElements()) {
-                ZipEntry ze = (ZipEntry) entries.nextElement();
-                if (ze.isDirectory()) {
+                ZipEntry zipEntry = (ZipEntry) entries.nextElement();
+                if (zipEntry.isDirectory()) {
                     continue;
                 }
-                String zipEntryName = ze.getName();
+                String zipEntryName = zipEntry.getName();
                 if (zipEntryName.endsWith("".so"") && zipEntryName.contains(cpuArchitect)) {
-                    final long lastModify = ze.getTime();
+                    final long lastModify = zipEntry.getTime();
                     if (lastModify == DLConfigs.getSoLastModifiedTime(context, zipEntryName)) {
                         // exist and no change
-                        Log.d(TAG, ""skip copying, the so lib is exist and not change: ""
-                                + zipEntryName);
+                        Log.d(TAG, ""skip copying, the so lib is exist and not change: "" + zipEntryName);
                         continue;
                     }
-                    InputStream ins = zip.getInputStream(ze);
-                    mSoExecutor.execute(new CopySoTask(context, ins, zipEntryName, lastModify));
+                    mSoExecutor.execute(new CopySoTask(context, zipFile, zipEntry, lastModify));
                 }
             }
-            zip.close();
         } catch (IOException e) {
             e.printStackTrace();
         }
@@ -149,16 +148,16 @@
     private class CopySoTask implements Runnable {
 
         private String mSoFileName;
-        private InputStream mIns;
-        private String mZipEntryName;
+        private ZipFile mZipFile;
+        private ZipEntry mZipEntry;
         private Context mContext;
         private long mLastModityTime;
 
-        CopySoTask(Context context, InputStream ins, String zipEntryName, long lastModify) {
-            mIns = ins;
+        CopySoTask(Context context, ZipFile zipFile, ZipEntry zipEntry, long lastModify) {
+            mZipFile = zipFile;
             mContext = context;
-            mZipEntryName = zipEntryName;
-            mSoFileName = parseSoFileName(zipEntryName);
+            mZipEntry = zipEntry;
+            mSoFileName = parseSoFileName(zipEntry.getName());
             mLastModityTime = lastModify;
         }
 
@@ -167,31 +166,68 @@
         }
 
         private void writeSoFile2LibDir() {
+            InputStream is = null;
             FileOutputStream fos = null;
             try {
+                is = mZipFile.getInputStream(mZipEntry);
                 fos = new FileOutputStream(new File(sNativeLibDir, mSoFileName));
-                byte[] buf = new byte[8192];
-                int len = -1;
-
-                while ((len = mIns.read(buf)) != -1) {
-                    fos.write(buf, 0, len);
-                }
-
-                Log.e(TAG, ""### copy so file : "" + mSoFileName);
-                fos.flush();
-            } catch (Exception e) {
+            } catch (IOException e) {
                 e.printStackTrace();
-            } finally {
-                DLUtils.closeQuietly(fos);
-                DLUtils.closeQuietly(mIns);
             }
+            copy(is, fos);
+            try {
+                mZipFile.close();
+            } catch (IOException e) {
+                e.printStackTrace();
+            }
+        }
+
+        /**
+         * 输入输出流拷贝
+         * 
+         * @param is
+         * @param os
+         */
+        public void copy(InputStream is, OutputStream os) {
+            if (is == null || os == null)
+                return;
+            BufferedInputStream bis = new BufferedInputStream(is);
+            BufferedOutputStream bos = new BufferedOutputStream(os);
+            byte[] buf = null;
+            try {
+                buf = new byte[getAvailableSize(bis)];
+            } catch (IOException e) {
+                e.printStackTrace();
+            }
+            int i = 0;
+            try {
+                while ((i = bis.read(buf)) != -1) {
+                    bos.write(buf, 0, i);
+                }
+            } catch (IOException e) {
+                e.printStackTrace();
+            }
+            try {
+                bos.flush();
+                bos.close();
+                bis.close();
+            } catch (IOException e) {
+                e.printStackTrace();
+            }
+        }
+
+        private int getAvailableSize(InputStream is) throws IOException {
+            if (is == null)
+                return 0;
+            int available = is.available();
+            return available <= 0 ? 1024 : available;
         }
 
         @Override
         public void run() {
             writeSoFile2LibDir();
-            DLConfigs.setSoLastModifiedTime(mContext, mZipEntryName, mLastModityTime);
-            Log.d(TAG, ""copy so lib success: "" + mZipEntryName);
+            DLConfigs.setSoLastModifiedTime(mContext, mZipEntry.getName(), mLastModityTime);
+            Log.d(TAG, ""copy so lib success: "" + mZipEntry.getName());
         }
 
     }",0
worldhopper: fix spam in chatbox when trying to open switcher in bank," import net.runelite.api.MenuAction;
 import net.runelite.api.MenuEntry;
 import net.runelite.api.Varbits;
+import net.runelite.api.events.ChatMessage;
 import net.runelite.api.events.ConfigChanged;
 import net.runelite.api.events.GameStateChanged;
+import net.runelite.api.events.GameTick;
 import net.runelite.api.events.MenuEntryAdded;
 import net.runelite.api.events.PlayerMenuOptionClicked;
 import net.runelite.api.events.VarbitChanged;
@@ -93,6 +95,8 @@
 	private static final int REFRESH_THROTTLE = 60_000;  // ms
 	private static final int TICK_THROTTLE = (int) Duration.ofMinutes(10).toMillis();
 
+	private static final int DISPLAY_SWITCHER_MAX_ATTEMPTS = 3;
+
 	private static final String HOP_TO = ""Hop-to"";
 	private static final String KICK_OPTION = ""Kick"";
 	private static final ImmutableList<String> BEFORE_OPTIONS = ImmutableList.of(""Add friend"", ""Remove friend"", KICK_OPTION);
@@ -125,6 +129,9 @@
 	private NavigationButton navButton;
 	private WorldSwitcherPanel panel;
 
+	private net.runelite.api.World quickHopTargetWorld;
+	private int displaySwitcherAttempts = 0;
+
 	@Getter
 	private int lastWorld;
 
@@ -586,17 +593,67 @@
 				.runeLiteFormattedMessage(chatMessage)
 				.build());
 
-		clientThread.invokeLater(() ->
+		quickHopTargetWorld = rsWorld;
+		displaySwitcherAttempts = 0;
+	}
+
+	@Subscribe
+	public void onGameTick(GameTick event)
 		{
+		if (quickHopTargetWorld == null)
+		{
+			return;
+		}
+
 			if (client.getWidget(WidgetInfo.WORLD_SWITCHER_LIST) == null)
 			{
 				client.openWorldHopper();
-				return false;
+
+			if (++displaySwitcherAttempts >= DISPLAY_SWITCHER_MAX_ATTEMPTS)
+			{
+				String chatMessage = new ChatMessageBuilder()
+					.append(ChatColorType.NORMAL)
+					.append(""Failed to quick-hop after "")
+					.append(ChatColorType.HIGHLIGHT)
+					.append(Integer.toString(displaySwitcherAttempts))
+					.append(ChatColorType.NORMAL)
+					.append("" attempts."")
+					.build();
+
+				chatMessageManager
+					.queue(QueuedMessage.builder()
+						.type(ChatMessageType.GAME)
+						.runeLiteFormattedMessage(chatMessage)
+						.build());
+
+				resetQuickHopper();
+			}
+		}
+		else
+		{
+			client.hopToWorld(quickHopTargetWorld);
+			resetQuickHopper();
+		}
 			}
 
-			client.hopToWorld(rsWorld);
-			return true;
-		});
+	@Subscribe
+	public void onChatMessage(ChatMessage event)
+	{
+		if (event.getType() != ChatMessageType.SERVER)
+		{
+			return;
+		}
+
+		if (event.getMessage().equals(""Please finish what you're doing before using the World Switcher.""))
+		{
+			resetQuickHopper();
+		}
+	}
+
+	private void resetQuickHopper()
+	{
+		displaySwitcherAttempts = 0;
+		quickHopTargetWorld = null;
 	}
 
 	private ChatPlayer getChatPlayerFromName(String name)",0
add content-type parameter for char-stream data in multipart/form-data & fix bug of writing wrong last boundary,"             return;
         }
 
-        writeBoundary();
+        try {
+            out.write((""--"" + boundary + ""--\r\n"").getBytes());
+            out.flush();
+        } catch (final IOException e) {
+            e.printStackTrace();
+        }
         
         isSetLast = true;
     }
 
-    public void addPart(final String key, final String value) {
+    public void addPart(final String key, final String value, final String contentType) {
         writeBoundary();
         try {
-            out.write((""Content-Disposition: form-data; name=\"""" +key+""\""\r\n\r\n"").getBytes());
+            out.write((""Content-Disposition: form-data; name=\"""" +key+""\""\r\n"").getBytes());
+            out.write((""Content-Type: "" + contentType + ""\r\n\r\n"").getBytes());
             out.write(value.getBytes());
             out.write((""\r\n"").getBytes());
         } catch (final IOException e) {
@@ -93,6 +99,10 @@
         }
     }
 
+    public void addPart(final String key, final String value) {
+        addPart(key,value,""text/plain; charset=UTF-8"");
+    }
+
     public void addPart(final String key, final String fileName, final InputStream fin, final boolean isLast){
         addPart(key, fileName, fin, ""application/octet-stream"", isLast);
     }
@@ -111,7 +121,7 @@
                 out.write(tmp, 0, l);
             }
             out.write((""\r\n"").getBytes());
-            out.flush();
+            
         } catch (final IOException e) {
             e.printStackTrace();
         } finally {
@@ -159,6 +169,7 @@
 
     @Override
     public void writeTo(final OutputStream outstream) throws IOException {
+        writeLastBoundaryIfNeeds();
         outstream.write(out.toByteArray());
     }
 
@@ -179,6 +190,7 @@
     @Override
     public InputStream getContent() throws IOException,
     UnsupportedOperationException {
+    	writeLastBoundaryIfNeeds();
         return new ByteArrayInputStream(out.toByteArray());
     }
 }
\ No newline at end of file",0
hotfix/javadoc error,"      * Gets or creates the user's private Jenkins-managed key and returns the
      * public key to the user
      * @return JSON response
-     * @throws IOException
      */
     @GET
     @WebMethod(name=""publickey"")
@@ -196,7 +195,6 @@
     /**
      * Deletes the user's private Jenkins-managed key
      * @return
-     * @throws IOException
      */
     @DELETE
     @WebMethod(name=""publickey"")",0
fixes mapper signature in Future.recover(),"    * @param mapper A function which takes the exception of a failure and returns a new future.
    * @return A recovered future
    */
-  default Future<T> recover(Function<? super Throwable, Future<T>> mapper) {
+  default Future<T> recover(Function<Throwable, Future<T>> mapper) {
     Future<T> ret = Future.future();
     setHandler(ar -> {
       if (ar.succeeded()) {",0
More avoiding dividing by zero in the inventory grid,"         if (cellSize.getX() == 0 || cellSize.getY() == 0) {
             return;
         }
-        int horizontalCells = Math.min(maxHorizontalCells, canvas.size().getX() / cellSize.getX());
+        int horizontalCells = Math.max(1, Math.min(maxHorizontalCells, canvas.size().getX() / cellSize.getX()));
         for (int i = 0; i < numSlots && i < cells.size(); ++i) {
             int horizPos = i % horizontalCells;
             int vertPos = i / horizontalCells;",0
Fix crash when custom models return null default state," import java.util.function.Function;
 import com.google.common.base.Joiner;
 import com.google.common.base.Objects;
+import com.google.common.base.Preconditions;
 import java.util.Optional;
 import com.google.common.base.Predicate;
 import com.google.common.cache.CacheBuilder;
@@ -670,7 +671,10 @@
                 textures.addAll(model.getTextures()); // Kick this, just in case.
 
                 models.add(model);
-                builder.add(Pair.of(model, new ModelStateComposition(v.getState(), model.getDefaultState())));
+
+                IModelState modelDefaultState = model.getDefaultState();
+                Preconditions.checkNotNull(modelDefaultState, ""Model %s returned null as default state"", loc);
+                builder.add(Pair.of(model, new ModelStateComposition(v.getState(), modelDefaultState)));
             }
 
             if (models.size() == 0) //If all variants are missing, add one with the missing model and default rotation.",0
Fix for Issue #1355 -- Animated GIF & Alpha Channel.," package org.rajawali3d.materials.textures;
 
 import android.content.Context;
+import android.graphics.Color;
 import android.graphics.Bitmap;
 import android.graphics.Bitmap.Config;
 import android.graphics.Canvas;
@@ -114,6 +115,7 @@
 		long now = SystemClock.uptimeMillis();
 		int relTime = (int)((now - mStartTime) % mMovie.duration());
 		mMovie.setTime(relTime);
+		mGIFBitmap.eraseColor(Color.TRANSPARENT);
 		mMovie.draw(mCanvas, 0, 0);
 		mBitmap = Bitmap.createScaledBitmap(mGIFBitmap, mTextureSize, mTextureSize, false);
 		TextureManager.getInstance().replaceTexture(this);",0
Fix default value for boolean AP option," 			String trace = options.get(key);
 			return !""false"".equals(trace);
 		} else {
-			return true;
+			return false;
 		}
 	}
 ",0
Fix TransactionalTopologyBuilder NPE,"         _id = id;
         _spoutId = spoutId;
         _spout = spout;
-        _spoutParallelism = spoutParallelism.intValue();
+        _spoutParallelism = (spoutParallelism == null) ? null : spoutParallelism.intValue();
     }
     
     public TransactionalTopologyBuilder(String id, String spoutId, ITransactionalSpout spout) {",0
Allow AhcEndpoint address override in grizzly provider,"             port = getPort(scheme, uri.getPort());
         }
         
-        final String partitionId = getPartitionId(request, proxy);
+        final String partitionId = getPartitionId(request.getInetAddress(), request, proxy);
         Endpoint endpoint = endpointMap.get(partitionId);
         if (endpoint == null) {
             final boolean isSecure = Utils.isSecure(scheme);
             endpoint = new AhcEndpoint(partitionId,
-                    isSecure, host, port, request.getLocalAddress(),
+                    isSecure, request.getInetAddress(), host, port, request.getLocalAddress(),
                     defaultConnectionHandler);
 
             endpointMap.put(partitionId, endpoint);
@@ -164,11 +164,11 @@
         
         final boolean isSecure = Utils.isSecure(scheme);
         
-        final String partitionId = getPartitionId(request, proxy);
+        final String partitionId = getPartitionId(request.getInetAddress(), request, proxy);
         Endpoint endpoint = endpointMap.get(partitionId);
         if (endpoint == null) {
             endpoint = new AhcEndpoint(partitionId,
-                    isSecure, host, port, request.getLocalAddress(),
+                    isSecure, request.getInetAddress(), host, port, request.getLocalAddress(),
                     defaultConnectionHandler);
 
             endpointMap.put(partitionId, endpoint);
@@ -219,9 +219,10 @@
         return !IS_NOT_KEEP_ALIVE.isSet(connection);
     }
     
-    private static String getPartitionId(Request request,
+    private static String getPartitionId(InetAddress overrideAddress, Request request,
             ProxyServer proxyServer) {
-        return request.getConnectionPoolPartitioning()
+        return (overrideAddress != null ? overrideAddress.toString() + ""_"" : """") + 
+            request.getConnectionPoolPartitioning()
                 .getPartitionKey(request.getUri(), proxyServer).toString();
     }
 
@@ -244,6 +245,7 @@
 
         private final String partitionId;
         private final boolean isSecure;
+        private final InetAddress remoteOverrideAddress;
         private final String host;
         private final int port;
         private final InetAddress localAddress;
@@ -251,12 +253,13 @@
         
         private AhcEndpoint(final String partitionId,
                 final boolean isSecure,
-                final String host, final int port,
+                final InetAddress remoteOverrideAddress, final String host, final int port,
                 final InetAddress localAddress,
                 final ConnectorHandler<SocketAddress> connectorHandler) {
             
             this.partitionId = partitionId;
             this.isSecure = isSecure;
+            this.remoteOverrideAddress = remoteOverrideAddress;
             this.host = host;
             this.port = port;
             this.localAddress = localAddress;
@@ -275,12 +278,19 @@
         @Override
         public GrizzlyFuture<Connection> connect() {
             return (GrizzlyFuture<Connection>) connectorHandler.connect(
-                    new InetSocketAddress(host, port),
+                    buildRemoteSocketAddress(),
                     localAddress != null
                             ? new InetSocketAddress(localAddress, 0)
                             : null);
         }
 
+        private InetSocketAddress buildRemoteSocketAddress()
+        {
+            return remoteOverrideAddress != null
+                    ? new InetSocketAddress(remoteOverrideAddress, port)
+                    : new InetSocketAddress(host, port);
+        }
+
         @Override
         protected void onConnect(final Connection connection,
                 final SingleEndpointPool<SocketAddress> pool) {",0
Fix for #217 by ddrscott," import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.lang.ref.WeakReference;
 import java.net.InetSocketAddress;
 import java.net.Proxy;
 import java.net.Socket;
@@ -46,7 +47,8 @@
 
 	private Proxy proxy = Proxy.NO_PROXY;
 
-	private Thread writeThread;
+	private WeakReference<Thread> readThread;
+ 	private WeakReference<Thread> writeThread;
 
 	private Draft draft;
 
@@ -155,10 +157,11 @@
 	 * Initiates the websocket connection. This method does not block.
 	 */
 	public void connect() {
-		if( writeThread != null )
+		if( readThread != null )
 			throw new IllegalStateException( ""WebSocketClient objects are not reuseable"" );
-		writeThread = new Thread( this );
-		writeThread.start();
+		Thread reader = new Thread( this ,""WebsocketReadThread"");
+		reader.start();
+		readThread = new WeakReference<Thread>( reader );
 	}
 
 	/**
@@ -230,8 +233,9 @@
 			return;
 		}
 
-		writeThread = new Thread( new WebsocketWriteThread() );
-		writeThread.start();
+		Thread write = new Thread( new WebsocketWriteThread() );
+		write.start();
+		writeThread = new WeakReference<Thread>( write );
 
 		byte[] rawbuffer = new byte[ WebSocketImpl.RCVBUF ];
 		int readBytes;
@@ -328,8 +332,10 @@
 	 */
 	@Override
 	public final void onWebsocketClose( WebSocket conn, int code, String reason, boolean remote ) {
-		if( writeThread != null )
-			writeThread.interrupt();
+		if( writeThread != null && writeThread.get() != null)
+			writeThread.get().interrupt();
+		if( readThread != null && readThread.get() != null)
+			readThread.get().interrupt();
 		try {
 			if( socket != null )
 				socket.close();",0
Fix PDF417 numeric encoding grouping index check,"     StringBuilder tmp = new StringBuilder(count / 3 + 1);
     BigInteger num900 = BigInteger.valueOf(900);
     BigInteger num0 = BigInteger.valueOf(0);
-    while (idx < count - 1) {
+    while (idx < count) {
       tmp.setLength(0);
       int len = Math.min(44, count - idx);
       String part = '1' + msg.substring(startpos + idx, startpos + idx + len);",0
Fix request code to be lowser than 16bit," import android.view.View;
 import android.view.View.OnClickListener;
 
+import androidx.annotation.NonNull;
 import androidx.appcompat.app.AppCompatActivity;
 import androidx.core.app.ActivityCompat;
 import androidx.core.content.ContextCompat;
@@ -30,6 +31,8 @@
 
 public class ActivityMain extends AppCompatActivity implements OnClickListener {
 
+    private static final int REQUEST_CAMERA = 1;
+
     @Override
     public void onCreate(final Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
@@ -40,35 +43,35 @@
 
     @Override
     public void onClick(final View v) {
-        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
-                == PackageManager.PERMISSION_DENIED) {
-            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.CAMERA}, v.getId());
-        } else {
-            startActivity(v.getId());
-        }
-    }
-
-    @Override
-    public void onRequestPermissionsResult(int requestCode, String[] permissions,
-                                           int[] grantResults) {
-        if (grantResults.length != 1 || grantResults[0] == PackageManager.PERMISSION_GRANTED) {
-            startActivity(requestCode);
-        } else {
-            super.onRequestPermissionsResult(requestCode, permissions, grantResults);
-        }
-    }
-
-    private void startActivity(int id) {
-        switch (id) {
+        switch (v.getId()) {
             case R.id.button_gallery:
                 startActivity(new Intent(this, ActivityGallery.class));
                 break;
+
             case R.id.button_camera:
+                if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)
+                        == PackageManager.PERMISSION_DENIED) {
+                    ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.CAMERA},
+                            REQUEST_CAMERA);
+                } else {
                 startActivity(new Intent(this, ActivityCamera.class));
+                }
                 break;
 
             default:
                 break;
         }
     }
+
+    @Override
+    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,
+                                           @NonNull int[] grantResults) {
+        if (requestCode == REQUEST_CAMERA &&
+                grantResults.length != 1 ||
+                grantResults[0] == PackageManager.PERMISSION_GRANTED) {
+            startActivity(new Intent(this, ActivityCamera.class));
+        } else {
+            super.onRequestPermissionsResult(requestCode, permissions, grantResults);
+        }
+    }
 }",0
Fix a typo in org.reactivestreams.example.unicast.AsyncSubscriber,"             handleOnSubscribe(((OnSubscribe)s).subscription);
           else if (s instanceof OnError) // We are always able to handle OnError, obeying rule 2.10
             handleOnError(((OnError)s).error);
-          else if (s == OnComplete.Instance) // We are always able to handle OnError, obeying rule 2.9
+          else if (s == OnComplete.Instance) // We are always able to handle OnComplete, obeying rule 2.9
             handleOnComplete();
         }
       } finally {",0
Don't deregister Channel as part of closing it when using native kque…,"         // Even if we allow half closed sockets we should give up on reading. Otherwise we may allow a read attempt on a
         // socket which has not even been connected yet. This has been observed to block during unit tests.
         inputClosedSeenErrorOnRead = true;
-        try {
-            if (isRegistered()) {
-                // The FD will be closed, which should take care of deleting any associated events from kqueue, but
-                // since we rely upon jniSelfRef to be consistent we make sure that we clear this reference out for
-                // all events which are pending in kqueue to avoid referencing a deleted pointer at a later time.
-
-                // Need to check if we are on the EventLoop as doClose() may be triggered by the GlobalEventExecutor
-                // if SO_LINGER is used.
-                //
-                // See https://github.com/netty/netty/issues/7159
-                EventLoop loop = eventLoop();
-                if (loop.inEventLoop()) {
-                    doDeregister();
-                } else {
-                    loop.execute(new Runnable() {
-                        @Override
-                        public void run() {
-                            try {
-                                doDeregister();
-                            } catch (Throwable cause) {
-                                pipeline().fireExceptionCaught(cause);
-                            }
-                        }
-                    });
-                }
-            }
-        } finally {
             socket.close();
         }
-    }
 
     @Override
     protected void doDisconnect() throws Exception {",0
to solve getTypeParametersMap method bug,"         List<Pair<ResolvedTypeParameterDeclaration, ResolvedType>> typeParametersMap = new ArrayList<>();
         if (!isRawType()) {
             for (int i = 0; i < typeDeclaration.getTypeParameters().size(); i++) {
-                typeParametersMap.add(new Pair<>(typeDeclaration.getTypeParameters().get(0), typeParametersValues().get(i)));
+                typeParametersMap.add(new Pair<>(typeDeclaration.getTypeParameters().get(i), typeParametersValues().get(i)));
             }
         }
         return typeParametersMap;",0
Fixed crash caused by modifying the view on a thread other than UI. F…,"     Log.d(TAG, ""onReadUrlComplete"" + ""  url:  "" + url);
     if (!isShortUrl(url)) {
       setEditCardUrl(url);
+      return;
     }
 
     // Populate the field with a URL.
     new PwsClient().resolve(Arrays.asList(url), new PwsResultCallback() {
+      public void runSetEditCardUrlOnUiThread(final String url){
+        getActivity().runOnUiThread(new Runnable(){
+          @Override
+          public void run() {
+            setEditCardUrl(url);
+          }
+        });
+      }
+
       @Override
       public void onPwsResult(PwsResult pwsResult) {
-        setEditCardUrl(pwsResult.getSiteUrl());
+        runSetEditCardUrlOnUiThread(pwsResult.getSiteUrl());
       }
 
       @Override
       public void onPwsResultAbsent(String url) {
-        setEditCardUrl(url);
+        runSetEditCardUrlOnUiThread(url);
       }
     });
   }",0
Made logger static to improve performance. Fixed logger name.,"  */
 public abstract class AsyncCompletionHandler<T> implements AsyncHandler<T>, ProgressAsyncHandler<T> {
 
-    private final Logger log = LoggerFactory.getLogger(AsyncCompletionHandlerBase.class);
+    private static final Logger log = LoggerFactory.getLogger(AsyncCompletionHandler.class);
     private final Response.ResponseBuilder builder = new Response.ResponseBuilder();
 
     /**",0
Fix typos in WebSocketServer," 	 * <p>
 	 * {@link #WebSocketServer(InetSocketAddress, int, List, Collection)} allows to specify a collection which will be used to store current connections in.<br>
 	 * Depending on the type on the connection, modifications of that collection may have to be synchronized.
-	 * @param ws The Webscoket connection which should be removed
+	 * @param ws The Websocket connection which should be removed
 	 * @return Removing connection successful
 	 */
 	protected boolean removeConnection( WebSocket ws ) {
@@ -696,7 +696,7 @@
 
 	/**
 	 * @see #removeConnection(WebSocket)
-	 * @param ws the Webscoket connection which should be added
+	 * @param ws the Websocket connection which should be added
 	 * @return Adding connection successful
 	 */
 	protected boolean addConnection( WebSocket ws ) {",0
解决子查询中只有单个表时候查询结果不准确的bug," import io.mycat.server.response.ShowTables;
 import io.mycat.statistic.stat.QueryResult;
 import io.mycat.statistic.stat.QueryResultDispatcher;
+import io.mycat.util.ResultSetUtil;
 import io.mycat.util.StringUtil;
 
 import org.slf4j.Logger; import org.slf4j.LoggerFactory;
@@ -84,7 +85,8 @@
     private volatile boolean isDefaultNodeShowTable;
     private volatile boolean isDefaultNodeShowFullTable;
     private  Set<String> shardingTablesSet;
-	
+	private byte[] header = null;
+	private List<byte[]> fields = null;
 	public SingleNodeHandler(RouteResultset rrs, NonBlockingSession session) {
 		this.rrs = rrs;
 		this.node = rrs.getNodes()[0];
@@ -347,7 +349,13 @@
 		buffer = source.writeToBuffer(eof, allocBuffer());
 		int resultSize = source.getWriteQueue().size()*MycatServer.getInstance().getConfig().getSystem().getBufferPoolPageSize();
 		resultSize=resultSize+buffer.position();
+		MiddlerResultHandler middlerResultHandler = session.getMiddlerResultHandler();
+
+		if(middlerResultHandler !=null ){
+			middlerResultHandler.secondEexcute(); 
+		} else{
 		source.write(buffer);
+		}
 		//TODO: add by zhuam
 		//查询结果派发
 		QueryResult queryResult = new QueryResult(session.getSource().getUser(), 
@@ -376,7 +384,12 @@
 	@Override
 	public void fieldEofResponse(byte[] header, List<byte[]> fields,
 			byte[] eof, BackendConnection conn) {
-		
+		this.header = header;
+		this.fields = fields;
+		MiddlerResultHandler middlerResultHandler = session.getMiddlerResultHandler();
+        if(null !=middlerResultHandler ){
+			return;
+		}
 		this.netOutBytes += header.length;
 		for (int i = 0, len = fields.size(); i < len; ++i) {
 			byte[] field = fields.get(i);
@@ -459,8 +472,17 @@
 			 */
 			buffer = binRowDataPk.write(buffer, session.getSource(), true);
 		} else {
+
+			MiddlerResultHandler middlerResultHandler = session.getMiddlerResultHandler();
+	        if(null ==middlerResultHandler ){
 			buffer = session.getSource().writeToBuffer(row, allocBuffer());
-			//session.getSource().write(row);
+			}else{
+		        if(middlerResultHandler instanceof MiddlerQueryResultHandler){
+ 						 String rowValue =  ResultSetUtil.getColumnValAsString(row, fields, 0);
+						 middlerResultHandler.add(rowValue);	
+ 				 }
+			}
+		 
 		}
 
 	}",0
[BUG] Refactor @Service annotation bean name," public class ServiceAnnotationBeanPostProcessor implements BeanDefinitionRegistryPostProcessor, EnvironmentAware,
         ResourceLoaderAware, BeanClassLoaderAware {
 
+    private static final String SEPARATOR = "":"";
+
     private final Logger logger = LoggerFactory.getLogger(getClass());
 
     private final Set<String> packagesToScan;
@@ -254,7 +256,7 @@
                 buildServiceBeanDefinition(service, interfaceClass, annotatedServiceBeanName);
 
         // ServiceBean Bean name
-        String beanName = generateServiceBeanName(interfaceClass, annotatedServiceBeanName);
+        String beanName = generateServiceBeanName(service, interfaceClass, annotatedServiceBeanName);
 
         if (scanner.checkCandidate(beanName, serviceBeanDefinition)) { // check duplicated candidate bean
             registry.registerBeanDefinition(beanName, serviceBeanDefinition);
@@ -279,14 +281,35 @@
     /**
      * Generates the bean name of {@link ServiceBean}
      *
+     * @param service
      * @param interfaceClass           the class of interface annotated {@link Service}
      * @param annotatedServiceBeanName the bean name of annotated {@link Service}
      * @return ServiceBean@interfaceClassName#annotatedServiceBeanName
      * @since 2.5.9
      */
-    private String generateServiceBeanName(Class<?> interfaceClass, String annotatedServiceBeanName) {
+    private String generateServiceBeanName(Service service, Class<?> interfaceClass, String annotatedServiceBeanName) {
 
-        return ""ServiceBean@"" + interfaceClass.getName() + ""#"" + annotatedServiceBeanName;
+        StringBuilder beanNameBuilder = new StringBuilder(ServiceBean.class.getSimpleName());
+
+        beanNameBuilder.append(SEPARATOR).append(annotatedServiceBeanName);
+
+        String interfaceClassName = interfaceClass.getName();
+
+        beanNameBuilder.append(SEPARATOR).append(interfaceClassName);
+
+        String version = service.version();
+
+        if (StringUtils.hasText(version)) {
+            beanNameBuilder.append(SEPARATOR).append(version);
+        }
+
+        String group = service.group();
+
+        if (StringUtils.hasText(group)) {
+            beanNameBuilder.append(SEPARATOR).append(group);
+        }
+
+        return beanNameBuilder.toString();
 
     }
 ",0
Correcting order of constructor parameters for DSVParser.,"         this.httpFileRetriever = httpFileRetriever;
         this.dsvParser = new DSVParser(
                 this.config.ignorechar(),
-                this.config.separator(),
                 this.config.lineSeparator(),
+                this.config.separator(),
                 this.config.quotechar(),
                 this.config.isCheckPresenceOnly(),
                 this.config.isCaseInsensitiveLookup(),",0
[FIXED JENKINS-20610] symlink FileAlreadyExistsException," import java.text.NumberFormat;
 import java.text.ParseException;
 import java.util.*;
+import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicBoolean;
 import java.util.logging.Level;
 import java.util.logging.Logger;
@@ -1136,9 +1137,28 @@
             Object target = Class.forName(""java.nio.file.Paths"").getMethod(""get"", String.class, String[].class).invoke(null, targetPath, new String[0]);
             Class<?> filesC = Class.forName(""java.nio.file.Files"");
             Class<?> pathC = Class.forName(""java.nio.file.Path"");
-            filesC.getMethod(""deleteIfExists"", pathC).invoke(null, path);
+            Class<?> fileAlreadyExistsExceptionC = Class.forName(""java.nio.file.FileAlreadyExistsException"");
+
             Object noAttrs = Array.newInstance(Class.forName(""java.nio.file.attribute.FileAttribute""), 0);
+            final int maxNumberOfTries = 4;
+            final int timeInMillis = 100;
+            for (int tryNumber = 1; tryNumber <= maxNumberOfTries; tryNumber++) {
+                filesC.getMethod(""deleteIfExists"", pathC).invoke(null, path);
+                try {
             filesC.getMethod(""createSymbolicLink"", pathC, pathC, noAttrs.getClass()).invoke(null, path, target, noAttrs);
+                    break;
+                }
+                catch (Exception x) {
+                    if (fileAlreadyExistsExceptionC.isInstance(x)) {
+                        if(tryNumber < maxNumberOfTries) {
+                            TimeUnit.MILLISECONDS.sleep(timeInMillis); //trying to defeat likely ongoing race condition
+                            continue;
+                        }
+                        LOGGER.warning(""symlink FileAlreadyExistsException thrown ""+maxNumberOfTries+"" times => cannot createSymbolicLink"");
+                    }
+                    throw x;
+                }
+            }
             return true;
         } catch (NoSuchMethodException x) {
             return false; // fine, Java 6",0
fix exception message typo,"     {
         if(batchStartsAt < 0 || batchSize < 0)
         {
-            throw new IllegalArgumentException(""Both batchStartsAt and batchSize must be positive but got: batchStartsAt "" + batchStartsAt + "" and bachSize "" + batchSize);
+            throw new IllegalArgumentException(""Both batchStartsAt and batchSize must be positive but got: batchStartsAt "" + batchStartsAt + "" and batchSize "" + batchSize);
         }
         else if(batchSize > bufferSize)
         {",0
[android] Remove unhelpful url from debug display," 
         float pwsTripTime = mUrlToPwsTripTime.get(url) / 1000.0f;
         String pwsTripTimeString = """" + getString(R.string.metadata_debug_pws_trip_time_prefix)
-            + new DecimalFormat(""##.##s"").format(pwsTripTime) + "" "" + url;
+            + new DecimalFormat(""##.##s"").format(pwsTripTime);
         pwsTripTimeView.setText(pwsTripTimeString);
       } else {
         rankView.setText("""");",0
Fix password management,"             final String originalTargetState = initializeLoginFormState.getTransition(CasWebflowConstants.STATE_ID_SUCCESS).getTargetStateId();
             final SubflowState pswdResetSubFlowState = createSubflowState(flow, CasWebflowConstants.STATE_ID_PASSWORD_RESET_SUBFLOW, FLOW_ID_PASSWORD_RESET);
 
-            getTransitionableState(flow, CasWebflowConstants.STATE_ID_REAL_SUBMIT).getEntryActionList()
+            getTransitionableState(flow, CasWebflowConstants.STATE_ID_CREATE_TICKET_GRANTING_TICKET).getEntryActionList()
                 .add(createEvaluateAction(""flowScope."" + DO_CHANGE_PASSWORD_PARAMETER
                     + "" = requestParameters."" + DO_CHANGE_PASSWORD_PARAMETER + "" != null""));
 
@@ -155,11 +155,11 @@
                 CasWebflowConstants.STATE_ID_CHECK_DO_CHANGE_PASSWORD,
                 ""flowScope."" + DO_CHANGE_PASSWORD_PARAMETER + "" == true"",
                 CasWebflowConstants.VIEW_ID_MUST_CHANGE_PASSWORD,
-                getTransitionableState(flow, CasWebflowConstants.STATE_ID_REAL_SUBMIT)
+                getTransitionableState(flow, CasWebflowConstants.STATE_ID_CREATE_TICKET_GRANTING_TICKET)
                     .getTransition(CasWebflowConstants.TRANSITION_ID_SUCCESS).getTargetStateId())
                 .getEntryActionList().add(createEvaluateAction(""flowScope.pswdChangePostLogin=true""));
 
-            createTransitionForState(getTransitionableState(flow, CasWebflowConstants.STATE_ID_REAL_SUBMIT),
+            createTransitionForState(getTransitionableState(flow, CasWebflowConstants.STATE_ID_CREATE_TICKET_GRANTING_TICKET),
                 CasWebflowConstants.TRANSITION_ID_SUCCESS, CasWebflowConstants.STATE_ID_CHECK_DO_CHANGE_PASSWORD, true);
 
             createDecisionState(flow,",0
1.4 JENKINS-48571# Create MBP SCMSource with Id (#1662),"         validateInternal(getName(), scmConfig, organization);
         MultiBranchProject project = createMultiBranchProject(organization);
         assignCredentialToProject(scmConfig, project);
-        SCMSource source = createSource(project, scmConfig);
+        SCMSource source = createSource(project, scmConfig).withId(""blueocean"");
         project.setSourcesList(ImmutableList.of(new BranchSource(source)));
         project.save();
         final boolean hasJenkinsfile = repoHasJenkinsFile(source);",0
fixes #1412 lights now work again," 						//
 						// -- lightDir = vec3(L.x, L.y, L.z) * spotFactor;
 						//
-						lightDir.assign(multiply(castVec3(lightDir.x(), lightDir.y(), lightDir.z()), spotFactor));
+						lightDir.assign(multiply(castVec3(lightDir), spotFactor));
 					}
 					endif();
 ",0
Fix proxy injector filtering.,"                 {
                     for (ASMData a : data.getAll(Mod.class.getName()))
                     {
-                        if (a.getClassName().equals(targ.getClassName()))
+                        if (isProxyFromMod(a.getClassName(), targ.getClassName()))
                         {
                             modid = (String)a.getAnnotationInfo().get(""modid"");
                             break;
@@ -61,10 +61,13 @@
                     }
                 }
 
-                if (modid == null || !modid.equals(mod.getModId()))
+                if (modid == null)
                 {
-                    //TODO? Throw exception if modid == null? As that shouldn't happen {annotation with no name in a class without a @Mod)
-                    FMLLog.fine(""Skipping proxy injection for %s.%s since it is not for mod %s"", targ.getClassName(), targ.getObjectName(), mod.getModId());
+                    FMLLog.warning(""Unable to determine the associated mod for proxy injection for %s.%s, assuming it's from %s"", targ.getClassName(), targ.getObjectName(), mod.getModId());
+                }
+                else if (!modid.equals(mod.getModId()))
+                {
+                    FMLLog.fine(""Skipping proxy injection for %s.%s since it is not for mod %s, it should belong to %s"", targ.getClassName(), targ.getObjectName(), mod.getModId(), modid);
                     continue;
                 }
 
@@ -108,4 +111,36 @@
         // Allow language specific proxy injection.
         languageAdapter.setInternalProxies(mod, side, mcl);
     }
+
+    /**
+     * Checks if a proxy is part of a mod.
+     *
+     * Checks that the proxy is somewhere in the same package that holds the mod.
+     * For example, the @Mod is 'com.modname.Mod', the Proxy is 'com.modname.proxies.ProxyClient'
+     * The package of the mod is 'com.modname', and Proxy is in that package, so it is from the mod.
+     *
+     * Compares each path section in a for loop instead of simply using {@link String#startsWith(String)}
+     * because a mod like 'com.modname.Mod' with package 'com.modname'
+     * does not own a proxy from 'com.modnametools.proxies.ProxyClient' even though they start the same.
+     */
+    private static boolean isProxyFromMod(String modClassName, String proxyClassName)
+    {
+        if (modClassName.equals(proxyClassName))
+            return true;
+
+        String[] modPath = modClassName.split(""\\."");
+        String[] proxyPath = proxyClassName.split(""\\."");
+        if (proxyPath.length < modPath.length)
+            return false;
+
+        for (int i = 0; i < modPath.length - 1; i++)
+        {
+            if (!modPath[i].equals(proxyPath[i]))
+            {
+                return false;
+            }
+        }
+
+        return true;
+    }
 }",0
Fix typos in URL to the project," 			Element cap = packet.addChild(""c"",
 					""http://jabber.org/protocol/caps"");
 			cap.setAttribute(""hash"", ""sha-1"");
-			cap.setAttribute(""node"", ""http://conversions.im"");
+			cap.setAttribute(""node"", ""http://conversations.im"");
 			cap.setAttribute(""ver"", capHash);
 		}
 		return packet;",0
Fix a few typos in TwitterException message strings," 
     @Override
     public String toString() {
-        return getMessage() + (nested ? """" : ""Relevant discussions can be on the Internet at:\n""
+        return getMessage() + (nested ? """" : ""Relevant discussions can be found on the Internet at:\n""
                 + ""\thttp://www.google.co.jp/search?q="" + getExceptionDiagnosis().getStackLineHashAsHex()
                 + "" or\n\thttp://www.google.co.jp/search?q="" + getExceptionDiagnosis().getLineNumberHashAsHex())
                 + ""\nTwitterException{"" + (nested ? """" : ""exceptionCode=["" + getExceptionCode() + ""], "") +
@@ -329,10 +329,10 @@
                 cause = ""There was no new data to return."";
                 break;
             case BAD_REQUEST:
-                cause = ""The request was invalid. An accompanying error message will explain why. This is the status code will be returned during rate limiting (https://dev.twitter.com/pages/rate-limiting)."";
+                cause = ""The request was invalid. An accompanying error message will explain why. This is the status code that will be returned during rate limiting (https://dev.twitter.com/pages/rate-limiting)."";
                 break;
             case UNAUTHORIZED:
-                cause = ""Authentication credentials (https://dev.twitter.com/docs/auth) were missing or incorrect. Ensure that you have set valid conumer key/secret, access token/secret, and the system clock in in sync."";
+                cause = ""Authentication credentials (https://dev.twitter.com/docs/auth) were missing or incorrect. Ensure that you have set valid consumer key/secret, access token/secret, and the system clock is in sync."";
                 break;
             case FORBIDDEN:
                 cause = ""The request is understood, but it has been refused. An accompanying error message will explain why. This code is used when requests are being denied due to update limits (https://support.twitter.com/articles/15364-about-twitter-limits-update-api-dm-and-following)."";",0
Fixed issue 4245," 	/** @param id The ID of the animation to fetch (case sensitive).
 	 * @return The {@link Animation} with the specified id, or null if not available. */
 	public Animation getAnimation (final String id) {
-		return getAnimation(id, true);
+		return getAnimation(id, false);
 	}
 
 	/** @param id The ID of the animation to fetch.",0
bugfix: throw a NPE in deserialization process when one property of java.sql.Time type happens to be null," 
             try {
                 java.util.Date date = (java.util.Date) in.readObject();
-                value = new java.sql.Time(date.getTime());
+                if (date != null) value = new java.sql.Time(date.getTime());
 
                 _field.set(obj, value);
             } catch (Exception e) {",0
Potential fix for module permission issue (under OSX?).," import java.net.URLClassLoader;
 import java.nio.file.Paths;
 import java.security.AccessController;
+import java.security.PrivilegedAction;
 import java.security.PrivilegedActionException;
 import java.security.PrivilegedExceptionAction;
 
@@ -58,8 +59,14 @@
 
     @Override
     protected Class<?> loadClass(String name, boolean resolve) throws ClassNotFoundException {
-        Class<?> clazz = super.loadClass(name, resolve);
-        if (clazz.getClassLoader() != this) {
+        final Class<?> clazz = super.loadClass(name, resolve);
+        ClassLoader loadingClassLoader = AccessController.doPrivileged(new PrivilegedAction<ClassLoader>() {
+            @Override
+            public ClassLoader run() {
+                return clazz.getClassLoader();
+            }
+        });
+        if (loadingClassLoader != this) {
             if (securityManager.checkAccess(clazz)) {
                 return clazz;
             } else {",0
itemstats: Use correct crab meat," 			TOAD_CRUNCHIES, EGG_AND_TOMATO, LECKISH_FISH_2, PRAEL_BAT_1, PEACH);
 		add(food(9), PREMADE_P_PUNCH, PINEAPPLE_PUNCH, PREMADE_FR_BLAST, FRUIT_BLAST, SALMON, ANCHOVY_PIZZA,
 			_12_ANCHOVY_PIZZA);
-		add(food(10), TUNA, CRAB_MEAT, CHOPPED_TUNA, COOKED_CHOMPY, FIELD_RATION);
+		add(food(10), TUNA, COOKED_CRAB_MEAT, CHOPPED_TUNA, COOKED_CHOMPY, FIELD_RATION);
 		add(food(11), RAINBOW_FISH, STEW, PINEAPPLE_PIZZA, _12_PINEAPPLE_PIZZA, COOKED_FISHCAKE,
 			PREMADE_VEG_BATTA, VEGETABLE_BATTA, PREMADE_WM_BATTA, WORM_BATTA, PREMADE_TD_BATTA, TOAD_BATTA, PREMADE_CT_BATTA,
 			CHEESETOM_BATTA, PREMADE_FRT_BATTA, FRUIT_BATTA, MUSHROOM__ONION, GIRAL_BAT_2, LAVA_EEL);",0
"#5185-Dump without ""DROP"" statements-was fixed","                 cmd.add(""--routines""); //$NON-NLS-1$
             }
         }
-        if (addDropStatements) cmd.add(""--add-drop-table""); //$NON-NLS-1$
+        if (addDropStatements) { 
+        	cmd.add(""--add-drop-table""); //$NON-NLS-1$
+        } else {
+            cmd.add(""--skip-add-drop-table""); //$NON-NLS-1$
+        }
         if (disableKeys) cmd.add(""--disable-keys""); //$NON-NLS-1$
         if (extendedInserts) {
             cmd.add(""--extended-insert""); //$NON-NLS-1$",0
fix protocol version compatibility on 2.6.x," public final class Version {
     private static final Logger logger = LoggerFactory.getLogger(Version.class);
 
-    // Dubbo RPC protocol version
-    public static final String DEFAULT_DUBBO_PROTOCOL_VERSION = ""2.0.2"";
+    // Dubbo RPC protocol version, for compatibility, it must not be between 2.0.10 ~ 2.6.2
+    public static final String DEFAULT_DUBBO_PROTOCOL_VERSION = ""2.0.1"";
     // Dubbo implementation version, usually is jar version.
     private static final String VERSION = getVersion(Version.class, """");
 
@@ -43,7 +43,7 @@
      * For protocol compatibility purpose.
      * Because {@link #isSupportResponseAttatchment} is checked for every call, int compare expect to has higher performance than string.
      */
-    private static final int LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT = 202; // 2.0.2
+    private static final int LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT = 20001; // 2.0.1
     private static final Map<String, Integer> VERSION2INT = new HashMap<String, Integer>();
 
     static {
@@ -66,7 +66,13 @@
         if (version == null || version.length() == 0) {
             return false;
         }
-        return getIntVersion(version) >= LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT;
+        // for previous dubbo version(2.0.10/020010~2.6.2/020602), this version is the jar's version, so they need to be ignore
+        int iVersion = getIntVersion(version);
+        if (iVersion >= 20010 && iVersion <= 20602) {
+            return false;
+        }
+
+        return iVersion >= LOWEST_VERSION_FOR_RESPONSE_ATTATCHMENT;
     }
 
     public static int getIntVersion(String version) {
@@ -82,12 +88,31 @@
         int v = 0;
         String[] vArr = version.split(""\\."");
         int len = vArr.length;
-        for (int i = 1; i <= len; i++) {
-            v += Integer.parseInt(vArr[len - i]) * Math.pow(10, i - 1);
+        for (int i = 0; i < len; i++) {
+            v += Integer.parseInt(getDigital(vArr[i])) * Math.pow(10, (len - i - 1) * 2);
         }
         return v;
     }
 
+    private static String getDigital(String v) {
+        int index = 0;
+        for (int i = 0; i < v.length(); i++) {
+            char c = v.charAt(i);
+            if (Character.isDigit(c)) {
+                if (i == v.length() - 1) {
+                    index = i + 1;
+                } else {
+                    index = i;
+                }
+                continue;
+            } else {
+                index = i;
+                break;
+            }
+        }
+        return v.substring(0, index);
+    }
+
     private static boolean hasResource(String path) {
         try {
             return Version.class.getClassLoader().getResource(path) != null;",0
Fix antlr4-javascript #36.," 			return targetCharValueEscape[v];
 		}
 
-		if (v >= 0x20 && v < 127 && (!Character.isDigit(v) || v == '8' || v == '9')) {
+		if (v >= 0x20 && v < 127) {
 			return String.valueOf((char)v);
 		}
 
-		if ( v>=0 && v<=127 ) {
-			String oct = Integer.toOctalString(v);
-			return ""\\""+ oct;
-		}
-
 		String hex = Integer.toHexString(v|0x10000).substring(1,5);
 		return ""\\u""+hex;
 	}",0
support local registry multi init," import com.alipay.sofa.rpc.common.struct.ScheduledService;
 import com.alipay.sofa.rpc.common.struct.ValueDifference;
 import com.alipay.sofa.rpc.common.utils.CommonUtils;
+import com.alipay.sofa.rpc.common.utils.StringUtils;
 import com.alipay.sofa.rpc.config.ConsumerConfig;
 import com.alipay.sofa.rpc.config.ProviderConfig;
 import com.alipay.sofa.rpc.config.RegistryConfig;
@@ -105,6 +106,11 @@
 
     @Override
     public void init() {
+
+        if (StringUtils.isNotBlank(regFile)) {
+            return;
+        }
+
         this.regFile = registryConfig.getFile();
         if (regFile == null) {
             throw new SofaRpcRuntimeException(""File of LocalRegistry is null"");",0
Remove comment that was only meant for testing," 			if ( c!=null ) {
 				if (!t.isEpsilon() && !closureBusy.add(c)) {
 					// avoid infinite recursion for EOF* and EOF+
-					//continue;
+					continue;
 				}
 
 				int newDepth = depth;",0
Use gravity from attributes when available. Fixes #115,"         baselineStrokeWidth = DimenUtils.pixelsFromDpResource(getContext(), R.dimen.bootstrap_edit_text_edge_width);
         baselineCornerRadius = DimenUtils.pixelsFromDpResource(getContext(), R.dimen.bootstrap_edit_text_corner_radius);
 
-        setGravity(Gravity.CENTER_VERTICAL); // center text vertically by default
+        a = getContext().obtainStyledAttributes(attrs, new int[] {android.R.attr.gravity});
+        try {
+            setGravity(a.getInt(0, Gravity.CENTER_VERTICAL)); // center text vertically by default
+        } finally {
+            a.recycle();
+        }
         updateBootstrapState();
         invalidate();
     }",0
Fix retweets_of_me call to use Paging params,"      */
     public ResponseList<Status> getRetweetsOfMe(Paging paging) throws TwitterException {
         return factory.createStatusList(get(conf.getRestBaseURL()
-                + ""statuses/retweets_of_me.json""));
+                + ""statuses/retweets_of_me.json"", paging.asPostParameterArray()));
     }
 
     /**",0
CAMEL-13080 - fix URI creation for windows builds," 
     private Path asFolder(String p) {
         if (p.endsWith("".jar"")) {
+            File fp = new File(p);
             try {
                 Map<String, String> env = new HashMap<>();
-                return FileSystems.newFileSystem(URI.create(""jar:file:"" + p + ""!/""), env).getPath(""/"");
+                return FileSystems.newFileSystem(URI.create(""jar:"" + fp.toURI().toString()), env).getPath(""/"");
             } catch (FileSystemAlreadyExistsException e) {
-                return FileSystems.getFileSystem(URI.create(""jar:file:"" + p + ""!/"")).getPath(""/"");
+                return FileSystems.getFileSystem(URI.create(""jar:"" + fp.toURI().toString())).getPath(""/"");
             } catch (IOException e) {
                 throw new IOError(e);
             }",0
[core] Fix typo,"     }
 
     private String languageAliases(String language) {
-        // CPD and C language share the same parser
+        // CPP and C language share the same parser
         if (""c"".equals(language)) {
             return ""cpp"";
         }",0
"Fix ""internal error"" in ScriptAPI"," 
 import java.io.File;
 import java.io.IOException;
+import java.security.InvalidParameterException;
 import java.util.HashMap;
 import java.util.Map;
 
@@ -140,9 +141,11 @@
 			if (type == null) {
 				throw new ApiException(ApiException.Type.DOES_NOT_EXIST, ACTION_PARAM_SCRIPT_TYPE);
 			}
-			ScriptEngineWrapper engine = extension.getEngineWrapper(params.getString(ACTION_PARAM_SCRIPT_ENGINE));
-			if (engine == null) {
-				throw new ApiException(ApiException.Type.DOES_NOT_EXIST, ACTION_PARAM_SCRIPT_ENGINE);
+			ScriptEngineWrapper engine;
+			try {
+				engine = extension.getEngineWrapper(params.getString(ACTION_PARAM_SCRIPT_ENGINE));
+			} catch (InvalidParameterException e) {
+				throw new ApiException(ApiException.Type.DOES_NOT_EXIST, ACTION_PARAM_SCRIPT_ENGINE, e);
 			}
 			File file = new File(params.getString(ACTION_PARAM_FILE_NAME));
 			if (!file.exists()) {",0
PUBDEV-4650 3/Find api search on column bug fix,"       Vec vec = frame.vec(find.column);
       if( vec==null ) throw new H2OColumnNotFoundArgumentException(""column"", frame, find.column);
       find.key = new FrameV3(new Frame(new String[]{find.column}, new Vec[]{vec}));
+      // need to update frame variable
+      frame = find.key._fr;
     }
 
     // Convert the search string into a column-specific flavor",0
Resubscribe even when there are no listeners,"     @SuppressWarnings(""unchecked"")
     public void channelRead(Object msg) {
         PubSubOutput<K, V> output = (PubSubOutput<K, V>) msg;
+        // update internal state
+        switch (output.type()) {
+	        case psubscribe:
+	            patterns.add(output.pattern());
+	            break;
+	        case punsubscribe:
+	            patterns.remove(output.pattern());
+	            break;
+	        case subscribe:
+	            channels.add(output.channel());
+	            break;
+	        case unsubscribe:
+	            channels.remove(output.channel());
+	            break;
+	        default:
+	        	break;
+        }
+        // update listeners
         for (RedisPubSubListener<K, V> listener : listeners) {
             switch (output.type()) {
                 case message:
@@ -117,19 +135,15 @@
                     listener.message(output.pattern(), output.channel(), output.get());
                     break;
                 case psubscribe:
-                    patterns.add(output.pattern());
                     listener.psubscribed(output.pattern(), output.count());
                     break;
                 case punsubscribe:
-                    patterns.remove(output.pattern());
                     listener.punsubscribed(output.pattern(), output.count());
                     break;
                 case subscribe:
-                    channels.add(output.channel());
                     listener.subscribed(output.channel(), output.count());
                     break;
                 case unsubscribe:
-                    channels.remove(output.channel());
                     listener.unsubscribed(output.channel(), output.count());
                     break;
                 default:",0
Fix typo in sky rendering causing tons of BlockPos allocations,"         int multiplier = (r / divider & 255) << 16 | (g / divider & 255) << 8 | b / divider & 255;
 
         skyX = center.getX();
-        skyZ = center.getY();
+        skyZ = center.getZ();
         skyRGBMultiplier = multiplier;
         return skyRGBMultiplier;
     }",0
Fixed spelling in documentation comment," import com.badlogic.gdx.scenes.scene2d.utils.Drawable;
 import com.badlogic.gdx.utils.Pools;
 
-/** A slider is a horizontal indicator that allows a user to set a value. The slider his a range (min, max) and a stepping between
+/** A slider is a horizontal indicator that allows a user to set a value. The slider has a range (min, max) and a stepping between
  * each value the slider represents.
  * <p>
  * {@link ChangeEvent} is fired when the slider knob is moved. Cancelling the event will move the knob to where it was previously.",0
Fixing buffering feedback,"         simpleExoPlayer.prepare(videoSource);
         simpleExoPlayer.setPlayWhenReady(true);
         callback = new onBufferingUpdate();
-        mainHandler.post(callback);
     }
 
     @Override
@@ -134,6 +133,11 @@
                     }
                 }
             });
+            if(percent < 100) {
+                mainHandler.postDelayed(callback, 300);
+            } else {
+                mainHandler.removeCallbacks(callback);
+            }
         }
     }
 
@@ -228,6 +232,7 @@
                         }
                         break;
                         case Player.STATE_BUFFERING: {
+                            mainHandler.post(callback);
                         }
                         break;
                         case Player.STATE_READY: {",0
Fix bug with postgres channel message decoder,"         @Override
         protected Object decode(ChannelHandlerContext ctx, Channel channel, ChannelBuffer buffer) throws Exception {
             switch (state) {
-                /**
+                /*
                  * StartupMessage:
                  * | int32 length | int32 protocol | [ string paramKey | string paramValue , ... ]
                  */
@@ -551,6 +551,7 @@
                     if (buffer.readableBytes() < 8) {
                         return null;
                     }
+                    buffer.markReaderIndex();
                     msgLength = buffer.readInt() - 8; // exclude length itself and protocol
                     if (msgLength == 0) {
                         // SSL negotiation pkg
@@ -561,9 +562,8 @@
                     LOGGER.trace(""Header pkgLength: {}"", msgLength);
                     int protocol = buffer.readInt();
                     traceLogProtocol(protocol);
-                    state = State.STARTUP_BODY;
-                    return nullOrBuffer(buffer);
-                /**
+                    return nullOrBuffer(buffer, State.STARTUP_BODY);
+                /*
                  * Regular Data Packet:
                  * | char tag | int32 len | payload
                  */
@@ -571,13 +571,13 @@
                     if (buffer.readableBytes() < 5) {
                         return null;
                     }
+                    buffer.markReaderIndex();
                     msgType = buffer.readByte();
                     msgLength = buffer.readInt() - 4; // exclude length itself
-                    state = State.MSG_BODY;
-                    return nullOrBuffer(buffer);
+                    return nullOrBuffer(buffer, State.MSG_BODY);
                 case MSG_BODY:
                 case STARTUP_BODY:
-                    return nullOrBuffer(buffer);
+                    return nullOrBuffer(buffer, state);
             }
             throw new IllegalStateException(""Invalid state "" + state);
         }
@@ -587,10 +587,12 @@
          *
          * If null is returned the decoder will be called again, otherwise the MessageHandler will be called next.
          */
-        private ChannelBuffer nullOrBuffer(ChannelBuffer buffer) {
+        private ChannelBuffer nullOrBuffer(ChannelBuffer buffer, State nextState) {
             if (buffer.readableBytes() < msgLength) {
+                buffer.resetReaderIndex();
                 return null;
             }
+            state = nextState;
             return buffer;
         }
     }",0
Clarifies Traversable.min()/max() javadoc. Fixes #1304,"     <U> Traversable<U> map(Function<? super T, ? extends U> mapper);
 
     /**
-     * Calculates the maximum of this elements according to their natural order.
+     * Calculates the maximum of this elements according to the underlying element {@code Comparator} if exists,
+     * or the natural order of elements.
      *
-     * @return {@code Some(maximum)} of this elements or {@code None} if this is empty or this elements are not comparable
+     * @return {@code Some(maximum)} of this elements or {@code None} if this is empty or no {@code Comparator} is applicable
      */
     @SuppressWarnings(""unchecked"")
     default Option<T> max() {
@@ -690,9 +691,10 @@
     }
 
     /**
-     * Calculates the minimum of this elements according to their natural order.
+     * Calculates the minimum of this elements according to the underlying element {@code Comparator} if exists,
+     * or the natural order of elements.
      *
-     * @return {@code Some(minimum)} of this elements or {@code None} if this is empty or this elements are not comparable
+     * @return {@code Some(minimum)} of this elements or {@code None} if this is empty or no {@code Comparator} is applicable
      */
     @SuppressWarnings(""unchecked"")
     default Option<T> min() {",0
Fix error-prone warning,"     }
     for (Annotation annotation : annotations) {
       if (jsonQualifier.equals(annotation.annotationType())) {
-        Set<Annotation> delegateAnnotations = new LinkedHashSet<>(annotations);
+        Set<? extends Annotation> delegateAnnotations = new LinkedHashSet<>(annotations);
         delegateAnnotations.remove(annotation);
         return Collections.unmodifiableSet(delegateAnnotations);
       }",0
Long have to be compared using equals,"             // OrderItem request
             FulfillmentGroupItem fulfillmentGroupItem = null;
             for (FulfillmentGroupItem fgi : fg.getFulfillmentGroupItems()) {
-                if (fgi.getOrderItem().getId() == option.getOrderItem().getId()) {
+                if (fgi.getOrderItem().getId().equals(option.getOrderItem().getId())) {
                     fulfillmentGroupItem = fgi;
                 }
             }",0
Fixes #2069 to catch env var security exception," 	public static final boolean retry_debug = false;
 
 	/** Just in case this optimization is bad, add an ENV variable to turn it off */
-	public static final boolean TURN_OFF_LR_LOOP_ENTRY_BRANCH_OPT = Boolean.parseBoolean(System.getenv(""TURN_OFF_LR_LOOP_ENTRY_BRANCH_OPT""));
+	public static final boolean TURN_OFF_LR_LOOP_ENTRY_BRANCH_OPT = Boolean.parseBoolean(getSafeEnv(""TURN_OFF_LR_LOOP_ENTRY_BRANCH_OPT""));
 
 	protected final Parser parser;
 
@@ -2181,4 +2181,14 @@
 	public Parser getParser() {
 		return parser;
 	}
+
+	public static String getSafeEnv(String envName) {
+		try {
+			return System.getenv(envName);
+		}
+		catch(SecurityException e) {
+			// use the default value
+		}
+		return null;
+	}
 }",0
"Fixes exception ""The Resourcepart must not be null"" on xmpp muc join.","     {
         if(this.role == null)
         {
+            // If there is no nickname, there is no way to match anything.
+            // Sometimes while joining we receive the presence and dispatch
+            // the user role before nickname is stored in multiUserChat
+            // returning guest here is just for the event reporting the new
+            // role and that old is guest
+            if (multiUserChat.getNickname() == null)
+            {
+                return ChatRoomMemberRole.GUEST;
+            }
+
             Occupant o = multiUserChat.getOccupant(JidCreate.entityFullFrom(
                 multiUserChat.getRoom(), multiUserChat.getNickname()));
 ",0
Fixed possible resource leak in AndroidFileHandle::length()," 
 	public long length () {
 		if (type == FileType.Internal) {
+			AssetFileDescriptor fileDescriptor = null;
 			try {
-				return assets.openFd(file.getPath()).getLength();
+				try {
+					fileDescriptor = assets.openFd(file.getPath());
+					return fileDescriptor.getLength();
+				}
+				finally {
+					if (fileDescriptor != null) {
+						fileDescriptor.close();
+					}
+				}
 			} catch (IOException ignored) {
 			}
 		}",0
fix issue with protocol version not being correct,"         if (log.isDebugEnabled()) {
             log.debug(""{} Connection is ready"", ctx.channel());
         }
-        connectionFuture.complete(null);
+        // set remote protocol version to the correct version before we complete the connection future
         remoteEndpointProtocolVersion = connected.getProtocolVersion();
+        connectionFuture.complete(null);
         state = State.Ready;
     }
 ",0
Fix mongo migration,"         convertApplicationsToClients();
         convertOAuthClientsToClients();
 
-        db.getCollection(""realms"").update(new BasicDBObject(), new BasicDBObject(""$rename"", new BasicDBObject(""adminAppId"", ""clientId"")), false, true);
+        db.getCollection(""realms"").update(new BasicDBObject(), new BasicDBObject(""$rename"", new BasicDBObject(""adminAppId"", ""masterAdminClient"")), false, true);
 
         ensureIndex(""userConsents"", new String[]{""clientId"", ""userId""}, true, false);
     }
 
     private void convertApplicationsToClients() {
         DBCollection applications = db.getCollection(""applications"");
+        applications.dropIndex(""realmId_1_name_1"");
+
         applications.update(new BasicDBObject(), new BasicDBObject(""$set"", new BasicDBObject(""consentRequired"", false)), false, true);
         applications.update(new BasicDBObject(), new BasicDBObject(""$rename"", new BasicDBObject(""name"", ""clientId"")), false, true);
         renameCollection(""applications"", ""clients"");
@@ -39,14 +41,14 @@
         roles.update(new BasicDBObject(), new BasicDBObject(""$rename"", new BasicDBObject(""applicationId"", ""clientId"")), false, true);
         log.debugv(""Renamed roles.applicationId to roles.clientId"");
 
-        db.getCollection(""clients"").dropIndex(""realmId_1_name_1"");
         ensureIndex(""clients"", new String[]{""realmId"", ""clientId""}, true, false);
-
     }
 
     private void convertOAuthClientsToClients() {
         DBCollection clients = db.getCollection(""clients"");
         DBCollection oauthClients = db.getCollection(""oauthClients"");
+        oauthClients.dropIndex(""realmId_1_name_1"");
+
         oauthClients.update(new BasicDBObject(), new BasicDBObject(""$rename"", new BasicDBObject(""name"", ""clientId"")), false, true);
         oauthClients.update(new BasicDBObject(), new BasicDBObject(""$set"", new BasicDBObject(""consentRequired"", true)), false, true);
 ",0
Fix issue when FAM didn't open or close if some menu buttons has visi…," import android.view.animation.Interpolator;
 import android.view.animation.OvershootInterpolator;
 import android.widget.ImageView;
+import android.widget.Toast;
 
 public class FloatingActionMenu extends ViewGroup {
 
@@ -599,14 +600,15 @@
             }
 
             int delay = 0;
+            int counter = 0;
             mIsMenuOpening = true;
             for (int i = getChildCount() - 1; i >= 0; i--) {
                 View child = getChildAt(i);
                 if (child instanceof FloatingActionButton
                         && child != mMenuButton && child.getVisibility() != GONE) {
+                    counter++;
 
                     final FloatingActionButton fab = (FloatingActionButton) child;
-                    final int count = i;
                     mUiHandler.postDelayed(new Runnable() {
                         @Override
                         public void run() {
@@ -617,20 +619,23 @@
                             if (label != null && label.isHandleVisibilityChanges()) {
                                 label.show(animate);
                             }
-
-                            if (count == 0) {
-                                mMenuOpened = true;
-                            }
                         }
                     }, delay);
                     delay += mAnimationDelayPerItem;
                 }
             }
 
+            mUiHandler.postDelayed(new Runnable() {
+                @Override
+                public void run() {
+                    mMenuOpened = true;
+
             if (mToggleListener != null) {
                 mToggleListener.onMenuToggle(true);
             }
         }
+            }, ++counter * mAnimationDelayPerItem);
+        }
     }
 
     public void close(final boolean animate) {
@@ -649,14 +654,15 @@
             }
 
             int delay = 0;
+            int counter = 0;
             mIsMenuOpening = false;
             for (int i = 0; i < getChildCount(); i++) {
                 View child = getChildAt(i);
                 if (child instanceof FloatingActionButton
                         && child != mMenuButton && child.getVisibility() != GONE) {
+                    counter++;
 
                     final FloatingActionButton fab = (FloatingActionButton) child;
-                    final int count = i;
                     mUiHandler.postDelayed(new Runnable() {
                         @Override
                         public void run() {
@@ -667,20 +673,23 @@
                             if (label != null && label.isHandleVisibilityChanges()) {
                                 label.hide(animate);
                             }
-
-                            if (count == mButtonsCount - 3) {
-                                mMenuOpened = false;
-                            }
                         }
                     }, delay);
                     delay += mAnimationDelayPerItem;
                 }
             }
 
+            mUiHandler.postDelayed(new Runnable() {
+                @Override
+                public void run() {
+                    mMenuOpened = false;
+
             if (mToggleListener != null) {
                 mToggleListener.onMenuToggle(false);
             }
         }
+            }, ++counter * mAnimationDelayPerItem);
+        }
     }
 
     /**",0
"Net, fixed latest commit"," import java.util.Map;
 import java.util.concurrent.Future;
 
-import com.badlogic.gdx.Application.ApplicationType
+import com.badlogic.gdx.Application.ApplicationType;
 import com.badlogic.gdx.Gdx;
 import com.badlogic.gdx.Net.HttpRequest;
 import com.badlogic.gdx.Net.HttpResponseListener;
@@ -195,10 +195,10 @@
 		
 		/** Sets whether 301 and 302 redirects are followed. By default true.
 		 * Can't be changed in the GWT backend because this uses XmlHttpRequests which always redirect.
-		 * @param boolean whether to follow redirects.
+		 * @param followRedirects whether to follow redirects.
 		 * @exception IllegalArgumentException if redirection is disabled on the GWT backend.*/
 		public void setFollowRedirects (boolean followRedirects) throws IllegalArgumentException {
-			if (followRedirects == true || Gdx.app.getApplicationType() != ApplicationType.WebGl) {
+			if (followRedirects == true || Gdx.app.getType() != ApplicationType.WebGL) {
 				this.followRedirects = followRedirects;
 			}
 			else {
@@ -243,7 +243,7 @@
 		}
 		
 		/** Returns whether 301 and 302 redirects are followed. By default true.
-		 * @param boolean Whether to follow redirects. */
+		 *  Whether to follow redirects. */
 		public boolean getFollowRedirects() {
 			return followRedirects;
 		}",0
PlatformDependent.maxDirectMemory() must respect io.netty.maxDirectMe…,"                 DIRECT_MEMORY_COUNTER = new AtomicLong();
             }
         }
-        DIRECT_MEMORY_LIMIT = maxDirectMemory;
         logger.debug(""-Dio.netty.maxDirectMemory: {} bytes"", maxDirectMemory);
+        DIRECT_MEMORY_LIMIT = maxDirectMemory >= 1 ? maxDirectMemory : MAX_DIRECT_MEMORY;
 
         int tryAllocateUninitializedArray =
                 SystemPropertyUtil.getInt(""io.netty.uninitializedArrayAllocationThreshold"", 1024);
@@ -284,7 +284,7 @@
      * Returns the maximum memory reserved for direct buffer allocation.
      */
     public static long maxDirectMemory() {
-        return MAX_DIRECT_MEMORY;
+        return DIRECT_MEMORY_LIMIT;
     }
 
     /**",0
Small typo on IllegalArgumentException,"    */
   public static void assertBackgroundThread() {
     if (!isOnBackgroundThread()) {
-      throw new IllegalArgumentException(""YOu must call this method on a background thread"");
+      throw new IllegalArgumentException(""You must call this method on a background thread"");
     }
   }
 ",0
"Graphics, fixed JavaDoc typo"," 	 * access OpenGL ES 3.0 functionality. Note that this functionality will only be available if you instructed the
 	 * {@link Application} instance to use OpenGL ES 3.0!
 	 * 
-	 * @return whether OpenGL ES 2.0 is available */
+	 * @return whether OpenGL ES 3.0 is available */
 	public boolean isGL30Available ();
 
 	/** @return a {@link GLCommon} instance */",0
[PDI-13785] - Fixed border problem with the swt groups on the mac.,"             @Override
             public void paintControl( PaintEvent paintEvent ) {
               paintEvent.gc.setBackground( gui.getColorBackground() );
-              paintEvent.gc.fillRectangle( 0, 0, control.getBounds().width, control.getBounds().height );
+              paintEvent.gc.fillRectangle( 2, 0, control.getBounds().width-8, control.getBounds().height-20 );
             }
           } );
         }",0
Fix typo in javadoc of readBinaryValue,"     }
 
     /**
-     * Method that can be used as an alternative to {@link #getBigIntegerValue()},
+     * Method that can be used as an alternative to {@link #getBinaryValue()},
      * especially when value can be large. The main difference (beyond method
      * of returning content using {@link OutputStream} instead of as byte array)
      * is that content will NOT remain accessible after method returns: any content",0
Fix for enum serialization when enums where anonymous innerclasses (impl...," 
 			if (ClassReflection.isAssignableFrom(Enum.class, actualType)) {
 				if (knownType == null || !knownType.equals(actualType)) {
+					
+					// Ensures that enums with specific implementations (abstract logic) serialize correctly
+					if(actualType.isAnonymousClass())
+						actualType = actualType.getSuperclass();
+					
 					writeObjectStart(actualType, null);
 					writer.name(""value"");
 					writer.value(value);
@@ -827,7 +832,7 @@
 			if (type != null) {
 				if (type == String.class || type == Integer.class || type == Boolean.class || type == Float.class
 					|| type == Long.class || type == Double.class || type == Short.class || type == Byte.class
-					|| type == Character.class || type.isEnum()) {
+					|| type == Character.class || ClassReflection.isAssignableFrom(Enum.class, type)) {
 					return readValue(""value"", type, jsonData);
 				}
 
@@ -956,9 +961,15 @@
 				return constructor.newInstance();
 			} catch (SecurityException ignored) {
 			} catch (ReflectionException ignored) {
+				
 				if (type.isEnum()) {
 					return type.getEnumConstants()[0];
 				}
+			
+				if(type.isAnonymousClass() && type.getSuperclass().isEnum()){
+					return type.getSuperclass().getEnumConstants()[0];
+				}
+				
 				if (type.isArray())
 					throw new SerializationException(""Encountered JSON object when expected array of type: "" + type.getName(), ex);
 				else if (ClassReflection.isMemberClass(type) && !ClassReflection.isStaticClass(type))",0
fixes #448 remove broken import statements in Http2Client," import io.undertow.client.ClientProvider;
 import io.undertow.client.ClientRequest;
 import io.undertow.client.ClientResponse;
-import io.undertow.client.http.Light4jHttp2ClientProvider;
-import io.undertow.client.http.Light4jHttpClientProvider;
 import io.undertow.connector.ByteBufferPool;
 import io.undertow.protocols.ssl.UndertowXnioSsl;
 import io.undertow.server.DefaultByteBufferPool;",0
Disallow customers from logging in if they're archived,"  */
 package org.broadleafcommerce.profile.core.service;
 
+import org.broadleafcommerce.common.persistence.Status;
 import org.broadleafcommerce.profile.core.domain.Customer;
 import org.broadleafcommerce.profile.core.domain.CustomerRole;
 import org.springframework.dao.DataAccessException;
@@ -55,9 +56,12 @@
         if (customer == null) {
             throw new UsernameNotFoundException(""The customer was not found"");
         }
-
+        boolean isActive = !customer.isDeactivated();
+        if (Status.class.isAssignableFrom(customer.getClass())) {
+            isActive = isActive && ((Status) customer).isActive();
+        }
         List<GrantedAuthority> grantedAuthorities = createGrantedAuthorities(roleService.findCustomerRolesByCustomerId(customer.getId()));
-        return new CustomerUserDetails(customer.getId(), username, customer.getPassword(), !customer.isDeactivated(), true, !customer.isPasswordChangeRequired(), true, grantedAuthorities);
+        return new CustomerUserDetails(customer.getId(), username, customer.getPassword(), isActive, true, !customer.isPasswordChangeRequired(), true, grantedAuthorities);
     }
 
     protected List<GrantedAuthority> createGrantedAuthorities(List<CustomerRole> customerRoles) {",0
"fix error ""isRecyclable decremented below 0""","   }
 
   @Override
-  public boolean animateChange(ViewHolder oldHolder, ViewHolder newHolder, int fromX, int fromY,
-      int toX, int toY) {
+  public boolean animateChange(ViewHolder oldHolder, ViewHolder newHolder, int fromX, int fromY, int toX, int toY) {
+    if (oldHolder == newHolder) {
+      // Don't know how to run change animations when the same view holder is re-used.
+      // run a move animation to handle position changes.
+      return animateMove(oldHolder, fromX, fromY, toX, toY);
+    }
     final float prevTranslationX = ViewCompat.getTranslationX(oldHolder.itemView);
     final float prevTranslationY = ViewCompat.getTranslationY(oldHolder.itemView);
     final float prevAlpha = ViewCompat.getAlpha(oldHolder.itemView);",0
Fixed typo in error messages,"     RULE_PLANNER_UNAVAILABLE_FALLBACK(
         SeverityLevel.WARNING,
         Status.Statement.PlannerUnavailableWarning,
-        ""Using RULE planner is unsupported for current CYPHER version, the query has been execute by an older CYPHER "" +
+        ""Using RULE planner is unsupported for current CYPHER version, the query has been executed by an older CYPHER "" +
         ""version""
     ),
     RUNTIME_UNSUPPORTED(
@@ -178,12 +178,12 @@
     CREATE_UNIQUE_UNAVAILABLE_FALLBACK(
             SeverityLevel.WARNING,
             Status.Statement.PlannerUnavailableWarning,
-        ""CREATE UNIQUE is unsupported for current CYPHER version, the query has been execute by an older CYPHER version""
+        ""CREATE UNIQUE is unsupported for current CYPHER version, the query has been executed by an older CYPHER version""
     ),
     START_UNAVAILABLE_FALLBACK(
             SeverityLevel.WARNING,
             Status.Statement.PlannerUnavailableWarning,
-            ""START is unsupported for current CYPHER version, the query has been execute by an older CYPHER version""
+            ""START is unsupported for current CYPHER version, the query has been executed by an older CYPHER version""
     );
 
     private final Status status;",0
PUBDEV-4416: Fixed streamParse in Orc Parser.," import org.apache.hadoop.hive.serde2.objectinspector.*;
 import org.joda.time.DateTime;
 import org.joda.time.MutableDateTime;
+import water.Futures;
 import water.H2O;
 import water.Job;
 import water.Key;
@@ -71,9 +72,12 @@
   @Override protected ParseWriter streamParse(final InputStream is, final StreamParseWriter dout) throws IOException {
     List<StripeInformation> stripesInfo = ((OrcParseSetup) this._setup).getStripes();
     StreamParseWriter nextChunk = dout;
+    Futures fs = new Futures();
     for(int i = 0; i < stripesInfo.size(); i++) {
-      parseChunk(i, null, dout);
-      if(dout != nextChunk) dout.reduce(nextChunk);
+      parseChunk(i, null, nextChunk);
+      nextChunk.close(fs);
+      if(dout != nextChunk)
+        dout.reduce(nextChunk);
       if(i < stripesInfo.size()-1) nextChunk = nextChunk.nextChunk();
     }
     return dout;",0
use passed in config instead of default config. This is to fix config in...,"      * @param providerClass a {@link AsyncHttpProvider}
      */
     public DefaultAsyncHttpClient(String providerClass, AsyncHttpClientConfig config) {
-        this(loadProvider(providerClass, config), new AsyncHttpClientConfig.Builder().build());
+        this(loadProvider(providerClass, config), config);
     }
 
     /**",0
Fix Issue 2745 SpiderSitemapXMLParser," import net.htmlparser.jericho.Source;
 
 import org.parosproxy.paros.network.HttpMessage;
+import org.parosproxy.paros.network.HttpStatusCode;
 import org.w3c.dom.Document;
 import org.w3c.dom.NodeList;
 import org.xml.sax.InputSource;
@@ -89,7 +90,10 @@
 		
 		if (log.isDebugEnabled()) log.debug(""Parsing a sitemap.xml resource..."");
 		
-		if (message == null || !params.isParseSitemapXml()) {
+		if (message == null || !params.isParseSitemapXml() || 
+				!message.getResponseHeader().isXml() ||
+				HttpStatusCode.isClientError(message.getResponseHeader().getStatusCode()) ||
+				HttpStatusCode.isServerError(message.getResponseHeader().getStatusCode())) {
 			return false;
 		}		
 		",0
Normalise form-based login URL validation/usage," import java.awt.event.FocusListener;
 import java.io.IOException;
 import java.io.UnsupportedEncodingException;
-import java.net.URL;
 import java.net.URLDecoder;
 import java.net.URLEncoder;
 import java.util.HashMap;
@@ -160,9 +159,7 @@
 		private HttpMessage prepareRequestMessage(UsernamePasswordAuthenticationCredentials credentials)
 				throws URIException, HttpMalformedHeaderException, DatabaseException {
 
-			// Replace the username and password in the uri
-			String requestURL = replaceUserData(loginRequestURL, credentials.getUsername(), credentials.getPassword());
-			URI requestURI = new URI(requestURL, false);
+			URI requestURI = createLoginUrl(loginRequestURL, credentials.getUsername(), credentials.getPassword());
 
 			// Replace the username and password in the post data of the request, if needed
 			String requestBody = null;
@@ -330,11 +327,11 @@
 				if (postData != null && postData.length() > 0) {
 					method = HttpRequestHeader.POST;
 				}
-				URI uri = new URI(url, true);
 
 				this.loginRequestURL = url;
 				this.loginRequestBody = postData;
 
+				URI uri = createLoginUrl(loginRequestURL, """", """");
 				// Note: The findNode just checks the parameter names, not their values
 				// Note: No need to make sure the other parameters (besides user/password) are the
 				// same, as POSTs with different values are not delimited in the SitesTree anyway
@@ -412,6 +409,10 @@
 		}
 	}
 
+	private static URI createLoginUrl(String loginData, String username, String password) throws URIException {
+		return new URI(replaceUserData(loginData, username, password), true);
+	}
+
 	private static String replaceUserData(String loginData, String username, String password) {
 		return loginData.replace(FormBasedAuthenticationMethod.MSG_USER_PATTERN, encodeParameter(username))
 				.replace(FormBasedAuthenticationMethod.MSG_PASS_PATTERN, encodeParameter(password));
@@ -426,6 +427,15 @@
 		return """";
 	}
 
+	private static boolean isValidLoginUrl(String loginUrl) {
+		try {
+			createLoginUrl(loginUrl, """", """");
+			return true;
+		} catch (Exception e) {
+			return false;
+		}
+	}
+
 	/**
 	 * The Options Panel used for configuring a {@link FormBasedAuthenticationMethod}.
 	 */
@@ -554,9 +564,7 @@
 
 		@Override
 		public void validateFields() {
-			try {
-				new URL(loginUrlField.getText());
-			} catch (Exception ex) {
+			if (!isValidLoginUrl(loginUrlField.getText())) {
 				loginUrlField.requestFocusInWindow();
 				throw new IllegalStateException(
 						Constant.messages.getString(""authentication.method.fb.dialog.error.url.text""));
@@ -923,9 +931,7 @@
 			public void handleAction(JSONObject params) throws ApiException {
 				Context context = ApiUtils.getContextByParamId(params, AuthenticationAPI.PARAM_CONTEXT_ID);
 				String loginUrl = ApiUtils.getNonEmptyStringParam(params, PARAM_LOGIN_URL);
-				try {
-					new URL(loginUrl);
-				} catch (Exception ex) {
+				if (!isValidLoginUrl(loginUrl)) {
 					throw new ApiException(ApiException.Type.ILLEGAL_PARAMETER, PARAM_LOGIN_URL);
 				}
 				String postData = """";",0
Fix bug in restartScan,"         // Get the service
         UrlDeviceDiscoveryService.LocalBinder localBinder =
             (UrlDeviceDiscoveryService.LocalBinder) service;
-        localBinder.getServiceInstance().clearCache();
+        localBinder.getServiceInstance().restartScan();
         mContext.unbindService(this);
       }
 ",0
[1.3.x] Fix UNDERTOW-981 - Filter default ports of a scheme in ProxyPeerAddressHandler ,"             if(forwardedPort != null) {
                 try {
                     port = Integer.parseInt(forwardedPort);
+                    String scheme = exchange.getRequestScheme();
+
+                    if (! standardPort(port, scheme)) {
                     hostHeader += "":"" + port;
+                    }
                 } catch (NumberFormatException ignore) {
                     UndertowLogger.REQUEST_LOGGER.debugf(""Cannot parse port: %s"", forwardedPort);
                 }
@@ -108,6 +112,9 @@
         next.handleRequest(exchange);
     }
 
+    private static boolean standardPort(int port, String scheme) {
+        return (port == 80 && ""http"".equals(scheme)) || (port == 443 & ""https"".equals(scheme));
+    }
 
     public static class Builder implements HandlerBuilder {
 ",0
[BACKLOG-9928] Fixing missing types.," import org.pentaho.di.core.row.ValueMetaInterface;
 import org.pentaho.di.core.row.value.ValueMetaBase;
 import org.pentaho.di.core.row.value.ValueMetaBigNumber;
+import org.pentaho.di.core.row.value.ValueMetaBinary;
 import org.pentaho.di.core.row.value.ValueMetaBoolean;
 import org.pentaho.di.core.row.value.ValueMetaDate;
 import org.pentaho.di.core.row.value.ValueMetaFactory;
 import org.pentaho.di.core.row.value.ValueMetaInteger;
+import org.pentaho.di.core.row.value.ValueMetaInternetAddress;
 import org.pentaho.di.core.row.value.ValueMetaNone;
 import org.pentaho.di.core.row.value.ValueMetaNumber;
 import org.pentaho.di.core.row.value.ValueMetaString;
+import org.pentaho.di.core.row.value.ValueMetaTimestamp;
 import org.pentaho.di.core.variables.VariableSpace;
 import org.pentaho.di.core.variables.Variables;
 import org.pentaho.di.core.vfs.KettleVFS;
@@ -2188,20 +2191,24 @@
       String name = columns.getString( ""COLUMN_NAME"" );
       String type = columns.getString( ""SOURCE_DATA_TYPE"" );
       int size = columns.getInt( ""COLUMN_SIZE"" );
-      if ( type.equals( ""Integer"" ) ) {
+      if ( type.equals( ""Integer"" ) || type.equals( ""Long"" ) ) {
         valueMeta = new ValueMetaInteger();
-      } else if ( type.equals( ""BigDecimal"" ) ) {
+      } else if ( type.equals( ""BigDecimal"" ) || type.equals( ""BigNumber"" ) ) {
         valueMeta = new ValueMetaBigNumber();
-      } else if ( type.equals( ""Double"" ) ) {
+      } else if ( type.equals( ""Double"" ) || type.equals( ""Number"" ) ) {
         valueMeta = new ValueMetaNumber();
-      } else if ( type.equals( ""Long"" ) ) {
-        valueMeta = new ValueMetaInteger();
       } else if ( type.equals( ""String"" ) ) {
         valueMeta = new ValueMetaString();
       } else if ( type.equals( ""Date"" ) ) {
         valueMeta = new ValueMetaDate();
       } else if ( type.equals( ""Boolean"" ) ) {
         valueMeta = new ValueMetaBoolean();
+      } else if ( type.equals( ""Binary"" ) ) {
+        valueMeta = new ValueMetaBinary();
+      } else if ( type.equals( ""Timestamp"" ) ) {
+        valueMeta = new ValueMetaTimestamp();
+      } else if ( type.equals( ""Internet Address"" ) ) {
+        valueMeta = new ValueMetaInternetAddress();
       }
       if ( valueMeta != null ) {
         valueMeta.setName( name );",0
Disallow adding archived skus to cart,"  */
 package org.broadleafcommerce.core.catalog.dao;
 
+import org.apache.commons.collections4.CollectionUtils;
 import org.broadleafcommerce.common.persistence.EntityConfiguration;
+import org.broadleafcommerce.common.persistence.Status;
 import org.broadleafcommerce.common.sandbox.SandBoxHelper;
 import org.broadleafcommerce.core.catalog.domain.Product;
 import org.broadleafcommerce.core.catalog.domain.ProductImpl;
@@ -27,6 +29,8 @@
 import org.broadleafcommerce.core.catalog.domain.ProductOptionValueImpl;
 import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;
 import org.broadleafcommerce.core.catalog.domain.ProductOptionXrefImpl;
+import org.broadleafcommerce.core.catalog.domain.Sku;
+import org.broadleafcommerce.core.catalog.domain.SkuImpl;
 import org.broadleafcommerce.core.catalog.domain.SkuProductOptionValueXrefImpl;
 import org.broadleafcommerce.core.catalog.domain.dto.AssignedProductOptionDTO;
 import org.hibernate.Criteria;
@@ -40,6 +44,7 @@
 
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Objects;
 
 import javax.annotation.Resource;
 import javax.persistence.EntityManager;
@@ -47,8 +52,8 @@
 import javax.persistence.TypedQuery;
 import javax.persistence.criteria.CriteriaBuilder;
 import javax.persistence.criteria.CriteriaQuery;
-import javax.persistence.criteria.Path;
 import javax.persistence.criteria.Join;
+import javax.persistence.criteria.Path;
 import javax.persistence.criteria.Predicate;
 import javax.persistence.criteria.Root;
 
@@ -72,6 +77,7 @@
         return query.getResultList();
     }
     
+    @Override
     public ProductOption saveProductOption(ProductOption option) {
         return em.merge(option);
     }
@@ -139,9 +145,9 @@
     @Override
     public List<Long> readSkuIdsForProductOptionValues(Long productId, String attributeName, String attributeValue, List<Long> possibleSkuIds) {
         CriteriaBuilder cb = em.getCriteriaBuilder();
-        CriteriaQuery<Long> criteria = cb.createQuery(Long.class);
+        CriteriaQuery<Sku> criteria = cb.createQuery(Sku.class);
         Root<SkuProductOptionValueXrefImpl> root = criteria.from(SkuProductOptionValueXrefImpl.class);
-        criteria.select(root.get(""sku"").get(""id"").as(Long.class));
+        criteria.select(root.get(""sku"").as(Sku.class));
 
         List<Predicate> predicates = new ArrayList<>();
 
@@ -159,17 +165,54 @@
         predicates.add(cb.equal(root.get(""productOptionValue"").get(""attributeValue""), attributeValue));
 
         // restrict to skus that have ids within the given list of skus ids
+        if (CollectionUtils.isNotEmpty(possibleSkuIds)) {
+            possibleSkuIds = sandBoxHelper.mergeCloneIds(SkuImpl.class, possibleSkuIds.toArray(new Long[possibleSkuIds.size()]));
         Predicate skuDomainPredicate = buildSkuDomainPredicate(cb, root.get(""sku"").get(""id""), possibleSkuIds);
         if (skuDomainPredicate != null) {
             predicates.add(skuDomainPredicate);
         }
+        }
+
+        // restrict archived values
+        attachArchivalConditionIfPossible(SkuProductOptionValueXrefImpl.class, root, cb, predicates);
+        attachArchivalConditionIfPossible(SkuImpl.class, root.get(""sku""), cb, predicates);
 
         criteria.where(cb.and(predicates.toArray(new Predicate[predicates.size()])));
 
-        TypedQuery<Long> query = em.createQuery(criteria);
+        TypedQuery<Sku> query = em.createQuery(criteria);
         query.setHint(QueryHints.HINT_CACHEABLE, true);
         query.setHint(QueryHints.HINT_CACHE_REGION, ""query.Catalog"");
-        return query.getResultList();
+        List<Sku> candidateSkus = query.getResultList();
+
+        return filterCandidateSkusForArchivedStatus(candidateSkus);
+    }
+
+    protected List<Long> filterCandidateSkusForArchivedStatus(final List<Sku> candidateSkus) {
+        final List<Long> validCandidateSkuIds = new ArrayList<>();
+
+        for (final Sku sku : candidateSkus) {
+            if (Status.class.isAssignableFrom(sku.getClass())) {
+                if (!Objects.equals(((Status) sku).getArchived(), 'Y')) {
+                    validCandidateSkuIds.add(sku.getId());
+                }
+            } else {
+                // if Sku doesn't implement Status from bytecode weaving, assume it's non-archived
+                validCandidateSkuIds.add(sku.getId());
+            }
+        }
+
+        return validCandidateSkuIds;
+    }
+
+    protected void attachArchivalConditionIfPossible(Class<?> clazz, Path<?> path, CriteriaBuilder cb, List<Predicate> predicates) {
+        if (Status.class.isAssignableFrom(clazz)) {
+            predicates.add(
+                    cb.or(
+                            cb.isNull(path.get(""archiveStatus"").get(""archived"")),
+                            cb.equal(path.get(""archiveStatus"").get(""archived""), 'N')
+                    )
+            );
+        }
     }
 
     @SuppressWarnings(""unchecked"")",0
"fix #1641, support get system load on windows","         try {
             Method method = OperatingSystemMXBean.class.getMethod(""getSystemLoadAverage"", new Class<?>[0]);
             load = (Double) method.invoke(operatingSystemMXBean, new Object[0]);
+            if (load == -1) {
+                com.sun.management.OperatingSystemMXBean bean =
+                        (com.sun.management.OperatingSystemMXBean) operatingSystemMXBean;
+                load = bean.getSystemCpuLoad();
+            }
         } catch (Throwable e) {
             load = -1;
         }",0
Fix stack overflow caused by scanPeriod of 0s,"             }, mScanState.getScanJobRuntimeMillis());
         }
         else {
-            LogManager.i(TAG, ""No monitored or ranged regions. Scan job complete."");
+            LogManager.i(TAG, ""Scanning not started so Scan job is complete."");
             ScanJob.this.jobFinished(jobParameters , false);
         }
         return true;
@@ -159,10 +159,19 @@
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
             mScanHelper.stopAndroidOBackgroundScan();
         }
-        mScanHelper.getCycledScanner().setScanPeriods(mScanState.getBackgroundMode() ? mScanState.getBackgroundScanPeriod() : mScanState.getForegroundScanPeriod(),
-                                      mScanState.getBackgroundMode() ? mScanState.getBackgroundBetweenScanPeriod() : mScanState.getForegroundBetweenScanPeriod(),
+
+        long scanPeriod = mScanState.getBackgroundMode() ? mScanState.getBackgroundScanPeriod() : mScanState.getForegroundScanPeriod();
+        long betweenScanPeriod = mScanState.getBackgroundMode() ? mScanState.getBackgroundBetweenScanPeriod() : mScanState.getForegroundBetweenScanPeriod();
+        mScanHelper.getCycledScanner().setScanPeriods(scanPeriod,
+                                                      betweenScanPeriod,
                                       mScanState.getBackgroundMode());
         mInitialized = true;
+        if (scanPeriod <= 0) {
+            LogManager.w(TAG, ""Starting scan with scan period of zero.  Exiting ScanJob."");
+            mScanHelper.getCycledScanner().stop();
+            return false;
+        }
+
         if (mScanHelper.getRangedRegionState().size() > 0 || mScanHelper.getMonitoringStatus().regions().size() > 0) {
             mScanHelper.getCycledScanner().start();
             return true;",0
fix getstatic description," 
 @Name(""getstatic"")
 @Summary(""Show the static field of a class"")
-@Description(Constants.EXAMPLE + ""  getstatic getstatic demo.MathGame random\n""
-                + ""  getstatic -c 39eb305e org.apache.log4j.LogManager DEFAULT_CONFIGURATION_FILE\n""
-             + Constants.WIKI + Constants.WIKI_HOME + ""getstatic"")
+@Description(Constants.EXAMPLE +
+             ""  getstatic demo.MathGame random\n"" +
+             ""  getstatic -c 39eb305e org.apache.log4j.LogManager DEFAULT_CONFIGURATION_FILE\n"" +
+             Constants.WIKI + Constants.WIKI_HOME + ""getstatic"")
 public class GetStaticCommand extends AnnotatedCommand {
 
     private static final Logger logger = LogUtil.getArthasLogger();",0
Fix normals not being generated for formats without normals,"         float[][] lightmap = quadData[lightmapIndex];
         float[][] color = quadData[colorIndex];
 
-        if(normalIndex != -1 && (
-            quadData[normalIndex][0][0] != -1 ||
-            quadData[normalIndex][0][1] != -1 ||
-            quadData[normalIndex][0][2] != -1))
+        // If all three normal values are either -1 or 0, normals must be generated
+        if(quadData[normalIndex][0][0] != quadData[normalIndex][0][1] ||
+            quadData[normalIndex][0][1] != quadData[normalIndex][0][2] ||
+           (quadData[normalIndex][0][0] != -1 && quadData[normalIndex][0][0] != 0))
         {
             normal = quadData[normalIndex];
         }",0
"Revert ""Fix for #217 by ddrscott"""," import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
-import java.lang.ref.WeakReference;
 import java.net.InetSocketAddress;
 import java.net.Proxy;
 import java.net.Socket;
@@ -47,8 +46,7 @@
 
 	private Proxy proxy = Proxy.NO_PROXY;
 
-	private WeakReference<Thread> readThread;
- 	private WeakReference<Thread> writeThread;
+	private Thread writeThread;
 
 	private Draft draft;
 
@@ -157,11 +155,10 @@
 	 * Initiates the websocket connection. This method does not block.
 	 */
 	public void connect() {
-		if( readThread != null )
+		if( writeThread != null )
 			throw new IllegalStateException( ""WebSocketClient objects are not reuseable"" );
-		Thread reader = new Thread( this ,""WebsocketReadThread"");
-		reader.start();
-		readThread = new WeakReference<Thread>( reader );
+		writeThread = new Thread( this );
+		writeThread.start();
 	}
 
 	/**
@@ -233,9 +230,8 @@
 			return;
 		}
 
-		Thread write = new Thread( new WebsocketWriteThread() );
-		write.start();
-		writeThread = new WeakReference<Thread>( write );
+		writeThread = new Thread( new WebsocketWriteThread() );
+		writeThread.start();
 
 		byte[] rawbuffer = new byte[ WebSocketImpl.RCVBUF ];
 		int readBytes;
@@ -332,10 +328,8 @@
 	 */
 	@Override
 	public final void onWebsocketClose( WebSocket conn, int code, String reason, boolean remote ) {
-		if( writeThread != null && writeThread.get() != null)
-			writeThread.get().interrupt();
-		if( readThread != null && readThread.get() != null)
-			readThread.get().interrupt();
+		if( writeThread != null )
+			writeThread.interrupt();
 		try {
 			if( socket != null )
 				socket.close();",0
CAMEL-7731: fix typo,"                 continue;
             }
             if (toUpper) {
-                char upper = Character.toLowerCase(ch);
+                char upper = Character.toUpperCase(ch);
                 sb.append(upper);
                 // reset flag
                 toUpper = false;",0
Avoid StringIndexOutOfBoundException," 		/** Return the UTF-16 encoded string for the given interval */
 		@Override
 		public String getText(Interval interval) {
-			int startIdx = Math.min(interval.a, size - 1);
-			int len = Math.min(interval.b - interval.a + 1, size);
+			int startIdx = Math.min(interval.a, size);
+			int len = Math.min(interval.b - interval.a + 1, size - startIdx);
 
 			// We know there are no surrogates in this
 			// array, since otherwise we would be given a
@@ -258,8 +258,8 @@
 		/** Return the UTF-16 encoded string for the given interval */
 		@Override
 		public String getText(Interval interval) {
-			int startIdx = Math.min(interval.a, size - 1);
-			int len = Math.min(interval.b - interval.a + 1, size);
+			int startIdx = Math.min(interval.a, size);
+			int len = Math.min(interval.b - interval.a + 1, size - startIdx);
 
 			// Note that we pass the int[] code points to the String constructor --
 			// this is supported, and the constructor will convert to UTF-16 internally.",0
"Fix #1539, change log method","                     throw e;
                 } else {
                     if (logger.isWarnEnabled()) {
-                        logger.info(""fail-mock: "" + invocation.getMethodName() + "" fail-mock enabled , url : "" + directory.getUrl(), e);
+                        logger.warn(""fail-mock: "" + invocation.getMethodName() + "" fail-mock enabled , url : "" + directory.getUrl(), e);
                     }
                     result = doMockInvoke(invocation, e);
                 }",0
make FixedBatchSpout batch aware.," import backtype.storm.Config;
 import backtype.storm.task.TopologyContext;
 import backtype.storm.tuple.Fields;
+
+import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
+import java.util.HashMap;
+
 import storm.trident.operation.TridentCollector;
 import storm.trident.spout.IBatchSpout;
 
@@ -14,6 +18,7 @@
     Fields fields;
     List<Object>[] outputs;
     int maxBatchSize;
+    HashMap<Long, List<List<Object>>> batches = new HashMap<Long, List<List<Object>>>();
     
     public FixedBatchSpout(Fields fields, int maxBatchSize, List<Object>... outputs) {
         this.fields = fields;
@@ -35,18 +40,25 @@
 
     @Override
     public void emitBatch(long batchId, TridentCollector collector) {
-        //Utils.sleep(2000);
+        List<List<Object>> batch = this.batches.get(batchId);
+        if(batch == null){
+            batch = new ArrayList<List<Object>>();
         if(index>=outputs.length && cycle) {
             index = 0;
         }
         for(int i=0; index < outputs.length && i < maxBatchSize; index++, i++) {
-            collector.emit(outputs[index]);
+                batch.add(outputs[index]);
+            }
+            this.batches.put(batchId, batch);
+        }
+        for(List<Object> list : batch){
+            collector.emit(list);
         }
     }
 
     @Override
     public void ack(long batchId) {
-        
+        this.batches.remove(batchId);
     }
 
     @Override",0
using path for matching filters instead of URI.toString(),"         if (httpMethods != null && !httpMethods.contains(method)) {
             return Optional.empty();
         }
-        String uriStr = uri.toString();
+        String uriStr = uri.getPath();
         for (String pattern : patterns) {
             if (PathMatcher.ANT.matches(pattern, uriStr)) {
                 HttpFilter filter = getFilter();",0
Minor animation fix,"         mColorRipple = colorRipple;
     }
 
-    boolean isHidden() {
-        return getVisibility() == INVISIBLE;
-    }
-
     void show(boolean animate) {
-        if (isHidden()) {
             if (animate) {
                 playShowAnimation();
             }
             setVisibility(VISIBLE);
         }
-    }
 
     void hide(boolean animate) {
-        if (!isHidden()) {
             if (animate) {
                 playHideAnimation();
             }
             setVisibility(INVISIBLE);
         }
-    }
 
     void setShowAnimation(Animation showAnimation) {
         mShowAnimation = showAnimation;",0
默认节点 null bug修复," 			TableConfig tableConfig = schema.getTables().get(table);
 			if(tableConfig!=null && tableConfig.isGlobalTable()) {
 				isAllGlobal = true;
-				break;
+			} else {
+				return false;
 			}
 		}
 		return isAllGlobal;",0
fix cleanPrivateStorage()," 	}
 
 	private boolean cleanPrivateStorage() {
-		cleanPrivatePictures();
-		cleanPrivateFiles();
+		for(String type : Arrays.asList(""Images"", ""Videos"", ""Files"", ""Recordings"")) {
+		        cleanPrivateFiles(type);
+	    }
 		return true;
 	}
 
-	private void cleanPrivatePictures() {
+	private void cleanPrivateFiles(final String type) {
 		try {
-			File dir = new File(getFilesDir().getAbsolutePath(), ""/Pictures/"");
-			File[] array = dir.listFiles();
-			if (array != null) {
-				for (int b = 0; b < array.length; b++) {
-					String name = array[b].getName().toLowerCase();
-					if (name.equals("".nomedia"")) {
-						continue;
-					}
-					if (array[b].isFile()) {
-						array[b].delete();
-					}
-				}
-			}
-		} catch (Throwable e) {
-			Log.e(""CleanCache"", e.toString());
-		}
-	}
-
-	private void cleanPrivateFiles() {
-		try {
-			File dir = new File(getFilesDir().getAbsolutePath(), ""/Files/"");
+			File dir = new File(getFilesDir().getAbsolutePath(), ""/"" + type + ""/"");
 			File[] array = dir.listFiles();
 			if (array != null) {
 				for (int b = 0; b < array.length; b++) {",0
GraphView: fix width of the vertical labels," 			double diffX = maxX - minX;
 
 			 // measure bottom text
-			if (textHeight == null || textWidth == null) {
+			if (labelTextHeight == null || horLabelTextWidth == null) {
 				paint.setTextSize(getGraphViewStyle().getTextSize());
 				double testX = ((getMaxX(true)-getMinX(true))*0.783)+getMinX(true);
 				String testLabel = formatLabel(testX, true);
 				paint.getTextBounds(testLabel, 0, testLabel.length(), textBounds);
-				textHeight = (textBounds.height());
-				textWidth = (textBounds.width());
+				labelTextHeight = (textBounds.height());
+				horLabelTextWidth = (textBounds.width());
 			}
-			border += textHeight;
+			border += labelTextHeight;
 
 			float graphheight = height - (2 * border);
 			graphwidth = width;
@@ -273,24 +273,24 @@
 			paint.setStrokeWidth(0);
 
 			 // measure bottom text
-			if (textHeight == null || textWidth == null) {
+			if (labelTextHeight == null || verLabelTextWidth == null) {
 				paint.setTextSize(getGraphViewStyle().getTextSize());
-				double testX = ((getMaxX(true)-getMinX(true))*0.783)+getMinX(true);
-				String testLabel = formatLabel(testX, true);
+				double testY = ((getMaxY()-getMinY())*0.783)+getMinY();
+				String testLabel = formatLabel(testY, false);
 				paint.getTextBounds(testLabel, 0, testLabel.length(), textBounds);
-				textHeight = (textBounds.height());
-				textWidth = (textBounds.width());
+				labelTextHeight = (textBounds.height());
+				verLabelTextWidth = (textBounds.width());
 			}
-			if (getGraphViewStyle().getVerticalLabelsWidth()==0 && getLayoutParams().width != textWidth+GraphViewConfig.BORDER) {
+			if (getGraphViewStyle().getVerticalLabelsWidth()==0 && getLayoutParams().width != verLabelTextWidth+GraphViewConfig.BORDER) {
 				setLayoutParams(new LayoutParams(
-						(int) (textWidth+GraphViewConfig.BORDER), LayoutParams.FILL_PARENT));
+						(int) (verLabelTextWidth+GraphViewConfig.BORDER), LayoutParams.FILL_PARENT));
 			} else if (getGraphViewStyle().getVerticalLabelsWidth()!=0 && getGraphViewStyle().getVerticalLabelsWidth() != getLayoutParams().width) {
 				setLayoutParams(new LayoutParams(
 						getGraphViewStyle().getVerticalLabelsWidth(), LayoutParams.FILL_PARENT));
 			}
 
 			float border = GraphViewConfig.BORDER;
-			border += textHeight;
+			border += labelTextHeight;
 			float height = getHeight();
 			float graphheight = height - (2 * border);
 
@@ -331,8 +331,9 @@
 	private GraphViewStyle graphViewStyle;
 	private final GraphViewContentView graphViewContentView;
 	private CustomLabelFormatter customLabelFormatter;
-	private Integer textHeight;
-	private Integer textWidth;
+	private Integer labelTextHeight;
+	private Integer horLabelTextWidth;
+	private Integer verLabelTextWidth;
 	private final Rect textBounds = new Rect();
 	private boolean staticHorizontalLabels;
 	private boolean staticVerticalLabels;
@@ -483,7 +484,7 @@
 	private String[] generateHorlabels(float graphwidth) {
 		int numLabels = getGraphViewStyle().getNumHorizontalLabels()-1;
 		if (numLabels < 0) {
-			numLabels = (int) (graphwidth/(textWidth*2));
+			numLabels = (int) (graphwidth/(horLabelTextWidth*2));
 		}
 
 		String[] labels = new String[numLabels+1];
@@ -498,7 +499,7 @@
 	synchronized private String[] generateVerlabels(float graphheight) {
 		int numLabels = getGraphViewStyle().getNumVerticalLabels()-1;
 		if (numLabels < 0) {
-			numLabels = (int) (graphheight/(textHeight*3));
+			numLabels = (int) (graphheight/(labelTextHeight*3));
 		}
 		String[] labels = new String[numLabels+1];
 		double min = getMinY();
@@ -679,8 +680,9 @@
 		if (!staticHorizontalLabels) horlabels = null;
 		numberformatter[0] = null;
 		numberformatter[1] = null;
-		textHeight = null;
-		textWidth = null;
+		labelTextHeight = null;
+		horLabelTextWidth = null;
+		verLabelTextWidth = null;
 
 		invalidate();
 		viewVerLabels.invalidate();
@@ -755,7 +757,7 @@
 	 */
 	public void setGraphViewStyle(GraphViewStyle style) {
 		graphViewStyle = style;
-		textHeight = null;
+		labelTextHeight = null;
 	}
 
 	/**",0
fixes row missing while left-join an empty table,"             return true;
         }
 
-        private boolean exitIfFirstCallAndLead() {
+        protected boolean exitIfFirstCallAndLead() {
             upstreamFinished = true;
             if (firstCall) {
                 firstCall = false;
@@ -461,8 +461,12 @@
                 return;
             }
 
-            if ((JoinType.LEFT == joinType || JoinType.FULL == joinType) &&
-                !matchedJoinPredicate && left.lastRow != null) {
+            if (JoinType.LEFT == joinType || JoinType.FULL == joinType) {
+                if (exitIfFirstCallAndLead()) {
+                    // left did not send any row so just return
+                    return;
+                }
+                if (!matchedJoinPredicate && left.lastRow != null) {
                 // emit row with right one nulled
                 combinedRow.outerRow = left.lastRow;
                 combinedRow.innerRow = rightNullRow;
@@ -489,6 +493,7 @@
                         break;
                 }
             }
+            }
             if (tryFinish()) {
                 return;
             }",0
1.9 fix logical log rotation threshold docs,"     @Description( ""Specifies at which file size the logical log will auto-rotate. "" +
                   ""0 means that no rotation will automatically occur based on file size. "" +
                   ""Default is 25M"" )
-    public static final Setting<Long> logical_log_rotation_threshold = setting( ""logical_log_rotation_threshold"",
-            Settings.LONG_WITH_OPTIONAL_UNIT, ""25M"" );
+    public static final GraphDatabaseSetting<Long> logical_log_rotation_threshold = new NumberOfBytesSetting( setting(
+            ""logical_log_rotation_threshold"", BYTES, ""25M"" ) );
 
     @Description(""Use a quick approach for rebuilding the ID generators. This give quicker recovery time, "" +
             ""but will limit the ability to reuse the space of deleted entities."")",0
Fix inconsistent top and bottom arrays on restoration,"         GridListSavedState ss = (GridListSavedState) state;
         mColumnCount = ss.columnCount;
         mColumnTops = ss.columnTops;
+        mColumnBottoms = new int[mColumnCount];
         mPositionData = ss.positionData;
         mNeedSync = true;
         super.onRestoreInstanceState(ss);",0
Fixed fetchAllIfNeeded and fetchAllIfNeededInBackground limit,"         }
 
         final ParseQuery<T> query = ParseQuery.<T>getQuery(className)
-                .whereContainedIn(KEY_OBJECT_ID, objectIds);
+                .whereContainedIn(KEY_OBJECT_ID, objectIds)
+                .setLimit(objectIds.size());
         return toAwait.continueWithTask(new Continuation<Void, Task<List<T>>>() {
             @Override
             public Task<List<T>> then(Task<Void> task) {",0
Fixed a warning being issued by an unrequired constructor for NotificationDispatcher," import org.apache.commons.logging.LogFactory;
 import org.broadleafcommerce.common.exception.ServiceException;
 import org.broadleafcommerce.common.notification.service.type.Notification;
-import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;
 import java.util.List;
 
@@ -37,7 +36,6 @@
 
     protected final List<NotificationService> notificationServices;
 
-    @Autowired(required = false)
     public NotificationDispatcherImpl(List<NotificationService> notificationServices) {
         this.notificationServices = notificationServices;
     }",0
Clamp max diffuse lighting multiplier to 1.0," {
     public static float diffuseLight(float x, float y, float z)
     {
-        return x * x * 0.6f + y * y * ((3f + y) / 4f) + z * z * 0.8f;
+        return Math.min(x * x * 0.6f + y * y * ((3f + y) / 4f) + z * z * 0.8f, 1f);
     }
 
     public static float diffuseLight(EnumFacing side)",0
Shutdown zk cache executor on service shutdown,"             }
 
             orderedExecutor.shutdown();
+            cacheExecutor.shutdown();
             state = State.Closed;
 
         } catch (Exception e) {",0
Fix memory leak in hyperloglog_distinct,"         }
         if (state2.isInitialized()) {
             state1.merge(state2);
+            state2.close();
         }
         return state1;
     }
@@ -122,7 +123,9 @@
     @Override
     public Long terminatePartial(RamAccountingContext ramAccountingContext, HllState state) {
         if (state.isInitialized()) {
-            return state.value();
+            long count = state.value();
+            state.close();
+            return count;
         }
         return null;
     }
@@ -137,7 +140,7 @@
         return info;
     }
 
-    public static class HllState implements Comparable<HllState>, Writeable {
+    public static class HllState implements Comparable<HllState>, Writeable, AutoCloseable {
 
         private final DataType dataType;
         private final Murmur3Hash murmur3Hash;
@@ -200,10 +203,18 @@
             if (isInitialized()) {
                 out.writeBoolean(true);
                 hyperLogLogPlusPlus.writeTo(0, out);
+                hyperLogLogPlusPlus.close();
             } else {
                 out.writeBoolean(false);
             }
         }
+
+        @Override
+        public void close() {
+            if (hyperLogLogPlusPlus != null) {
+                hyperLogLogPlusPlus.close();
+            }
+        }
     }
 
     public static class HllStateType extends DataType<HyperLogLogDistinctAggregation.HllState>",0
Null check fix reported by findbugs," 
         Queue.Item item = replayAction.run2(replayAction.getOriginalScript(), replayAction.getOriginalLoadedScripts());
 
+        if(item == null){
+            throw new ServiceException.UnexpectedErrorException(""Run was not added to queue."");
+        }
+
         BlueQueueItem queueItem = QueueUtil.getQueuedItem(item, run.getParent());
         WorkflowRun replayedRun = QueueUtil.getRun(run.getParent(), item.getId());
         if (queueItem != null) { // If the item is still queued",0
Fixed BottomTabs height being calculated twice,"     private void createVisibilityAnimator() {
         visibilityAnimator = new VisibilityAnimator(BottomTabs.this,
                 VisibilityAnimator.HideDirection.Down,
-                (int) ViewUtils.convertDpToPixel(Constants.BOTTOM_TABS_HEIGHT));
+                Constants.BOTTOM_TABS_HEIGHT);
     }
 
     private void setStyle() {",0
fix: Allows sendPresenceExtension to have more than one element with …,"      * @param extension the <tt>ConferenceDescriptionPacketExtension<tt> to set,
      * or <tt>null</tt> to not set one.
      * @param namespace the namespace of <tt>ExtensionElement</tt>.
+     * @param matchElementName if {@code true} only extensions matching both
+     * the element name and namespace will be matched and removed. Otherwise,
+     * only the namespace will be matched.
      */
     private static void setPacketExtension(
             Stanza packet,
             ExtensionElement extension,
-            String namespace)
+            String namespace,
+            boolean matchElementName)
     {
         if (org.jitsi.util.StringUtils.isNullOrEmpty(namespace))
         {
@@ -2002,10 +2006,21 @@
 
         //clear previous announcements
         ExtensionElement pe;
+        if (matchElementName && extension != null)
+        {
+            String element = extension.getElementName();
+            while (null != (pe = packet.getExtension(element, namespace)))
+            {
+                packet.removeExtension(pe);
+            }
+        }
+        else
+        {
         while (null != (pe = packet.getExtension(namespace)))
         {
             packet.removeExtension(pe);
         }
+        }
 
         if (extension != null)
         {
@@ -2014,6 +2029,26 @@
     }
 
     /**
+     * Sets <tt>ext</tt> as the only <tt>ExtensionElement</tt> that belongs to
+     * given <tt>namespace</tt> of the <tt>packet</tt>.
+     *
+     * @param packet the <tt>Packet<tt> to be modified.
+     * @param extension the <tt>ConferenceDescriptionPacketExtension<tt> to set,
+     * or <tt>null</tt> to not set one.
+     * @param namespace the namespace of <tt>ExtensionElement</tt>.
+     * @param matchElementName if {@code true} only extensions matching both
+     * the element name and namespace will be matched and removed. Otherwise,
+     * only the namespace will be matched.
+     */
+    private static void setPacketExtension(
+        Stanza packet,
+        ExtensionElement extension,
+        String namespace)
+    {
+        setPacketExtension(packet, extension, namespace, false);
+    }
+
+    /**
      * Publishes new status message in chat room presence.
      * @param newStatus the new status message to be published in the MUC.
      */
@@ -2049,7 +2084,7 @@
         }
 
         setPacketExtension(
-            lastPresenceSent, extension, extension.getNamespace());
+            lastPresenceSent, extension, extension.getNamespace(), true);
         try
         {
             provider.getConnection().sendStanza(lastPresenceSent);",0
fix a bug about getting null machine in HeartBeatAlert," 			long currentMill = System.currentTimeMillis();
 			long currentHourMill = currentMill - currentMill % TimeHelper.ONE_HOUR;
 			HeartbeatReport currentReport = generateReport(domain, currentHourMill);
-			Set<String> ips = currentReport.getIps();
 
-			for (String ip : ips) {
-				Machine machine = currentReport.getMachines().get(ip);
+			for (Machine machine : currentReport.getMachines().values()) {
+				String ip = machine.getIp();
 				Map<String, double[]> arguments = generateArgumentMap(machine);
 
 				for (String metric : m_metrics) {
@@ -160,10 +159,9 @@
 			long currentMill = System.currentTimeMillis();
 			long lastHourMill = currentMill - currentMill % TimeHelper.ONE_HOUR - TimeHelper.ONE_HOUR;
 			HeartbeatReport lastReport = generateReport(domain, lastHourMill);
-			Set<String> ips = lastReport.getIps();
 
-			for (String ip : ips) {
-				Machine machine = lastReport.getMachines().get(ip);
+			for (Machine machine : lastReport.getMachines().values()) {
+				String ip = machine.getIp();
 				Map<String, double[]> arguments = generateArgumentMap(machine);
 
 				for (String metric : m_metrics) {
@@ -178,13 +176,12 @@
 			long lastHourMill = currentHourMill - TimeHelper.ONE_HOUR;
 			HeartbeatReport currentReport = generateReport(domain, currentHourMill);
 			HeartbeatReport lastReport = generateReport(domain, lastHourMill);
-			Set<String> ips = lastReport.getIps();
 
-			for (String ip : ips) {
-				Machine lastMachine = lastReport.getMachines().get(ip);
+			for (Machine lastMachine : lastReport.getMachines().values()) {
+				String ip = lastMachine.getIp();
 				Machine currentMachine = currentReport.getMachines().get(ip);
 
-				if (lastMachine != null && currentMachine != null) {
+				if (currentMachine != null) {
 					Map<String, double[]> lastHourArguments = generateArgumentMap(lastMachine);
 					Map<String, double[]> currentHourArguments = generateArgumentMap(currentMachine);
 ",0
fix issue #17,"         if (mNeedLoading && mImages == null) {
             mImages = new ArrayList<>();
         } else {
-            mImages = mSelectedImages;
+            mImages = new ArrayList<>();
+            mImages.addAll(mSelectedImages);
         }
     }
 
@@ -223,7 +224,7 @@
                     , String.valueOf(mSelectedImages.size())));
             mProgressBar.setVisibility(View.GONE);
             mGallery.setVisibility(View.VISIBLE);
-            mAdapter.setMedias(mSelectedImages);
+            mAdapter.setMedias(mImages);
         } else {
             loadMedia(mAlbumId, mStartPos, mCurrentPage);
             mAdapter.setMedias(mImages);",0
Fix wrong frame layout stroke attrs using,"             R.styleable.FrameLayout_carbon_insetColor
     };
     private static int[] strokeIds = new int[]{
-            R.styleable.CoordinatorLayout_carbon_stroke,
-            R.styleable.CoordinatorLayout_carbon_strokeWidth
+            R.styleable.FrameLayout_carbon_stroke,
+            R.styleable.FrameLayout_carbon_strokeWidth
     };
     private static int[] maxSizeIds = new int[]{
             R.styleable.FrameLayout_carbon_maxWidth,
@@ -773,6 +773,7 @@
     }
 
     final RectF tmpHitRect = new RectF();
+
     public void getHitRect(@NonNull Rect outRect) {
         Matrix matrix = getMatrix();
         if (matrix.isIdentity()) {",0
Fix typo," 	}
 
 	/**
-	 * Collect incoming values into a {@link List} that will be pushed into the returned {@link Mono} on complete only.
+	 * Collect incoming values into a {@link List} that will be pushed into the returned {@link Flux} on complete only.
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/projectreactor.io/master/src/main/static/assets/img/marble/buffer.png""
 	 * alt="""">",0
[core] Fix XSS in HTML renderer," import java.util.Iterator;
 import java.util.List;
 
+import org.apache.commons.lang3.StringEscapeUtils;
+
 import net.sourceforge.pmd.PMD;
 import net.sourceforge.pmd.Report;
 import net.sourceforge.pmd.RuleViolation;
@@ -122,7 +124,7 @@
             buf.append(""> "" + PMD.EOL);
             buf.append(""<td align=\""center\"">"" + violationCount + ""</td>"" + PMD.EOL);
             buf.append(""<td width=\""*%\"">""
-                    + maybeWrap(rv.getFilename(),
+                    + maybeWrap(StringEscapeUtils.escapeHtml4(rv.getFilename()),
                             linePrefix == null ? """" : linePrefix + Integer.toString(rv.getBeginLine()))
                     + ""</td>"" + PMD.EOL);
             buf.append(""<td align=\""center\"" width=\""5%\"">"" + Integer.toString(rv.getBeginLine()) + ""</td>"" + PMD.EOL);",0
Fixed NPE when converters are not defined in the @Rest annotation," 		TypeMirror httpMessageConverterType = annotationHelper.typeElementFromQualifiedName(HTTP_MESSAGE_CONVERTER).asType();
 		TypeMirror httpMessageConverterTypeErased = annotationHelper.getTypeUtils().erasure(httpMessageConverterType);
 		List<DeclaredType> converters = annotationHelper.extractAnnotationClassArrayParameter(element, annotationHelper.getTarget(), ""converters"");
+
+		if (converters == null) {
+			valid.invalidate();
+			return;
+		}
+
 		for (DeclaredType converterType : converters) {
 			TypeMirror erasedConverterType = annotationHelper.getTypeUtils().erasure(converterType);
 			if (annotationHelper.isSubtype(erasedConverterType, httpMessageConverterTypeErased)) {",0
ChatboxPanelManager: Be more resilient when scripts mismatch," 			0,
 			1
 		);
+		if (currentInput != null)
+		{
+			killCurrentPanel();
+		}
 	}
 
 	private void unsafeOpenInput(ChatboxInput input)
@@ -113,6 +117,11 @@
 			mouseManager.registerMouseWheelListener((MouseWheelListener) input);
 		}
 
+		if (currentInput != null)
+		{
+			killCurrentPanel();
+		}
+
 		currentInput = input;
 		client.setVar(VarClientInt.INPUT_TYPE, InputType.RUNELITE_CHATBOX_PANEL.getType());
 		client.getWidget(WidgetInfo.CHATBOX_TITLE).setHidden(true);",0
BooleanFieldType: fix string interpolation,"         if (isPrimitive) {
             builder.addCode(""$L.getValueAsBoolean()"", JSON_PARSER_VARIABLE_NAME);
         } else {
-            builder.addCode(""$L.getCurrentToken() == JsonToken.VALUE_NULL ? null : Boolean.valueOf(%s.getValueAsBoolean())"", JSON_PARSER_VARIABLE_NAME, JSON_PARSER_VARIABLE_NAME);
+            builder.addCode(""$L.getCurrentToken() == JsonToken.VALUE_NULL ? null : Boolean.valueOf($L.getValueAsBoolean())"", JSON_PARSER_VARIABLE_NAME, JSON_PARSER_VARIABLE_NAME);
         }
     }
 ",0
fixed wrong UnreachedBarColor #25," 
     public void setUnreachedBarColor(int barColor) {
         this.mUnreachedBarColor = barColor;
-        mUnreachedBarPaint.setColor(mReachedBarColor);
+        mUnreachedBarPaint.setColor(mUnreachedBarColor);
         invalidate();
     }
 ",0
Lazy.filter() should not access Lazy.value member directly,"     }
 
     public Option<T> filter(Predicate<? super T> predicate) {
-        return predicate.test(value) ? Option.some(value) : Option.none();
+        T v = get();
+        return predicate.test(v) ? Option.some(v) : Option.none();
     }
 
     /**",0
CAMEL-10961: Backported parts of CAMEL-10292 in order to fix possible…," 
     public void process(Exchange exchange) throws Exception {
 
+        if (connection == null) {
+            connection = this.zkm.getConnection();
+        }
         ProductionContext context = new ProductionContext(connection, exchange);
 
         String operation = exchange.getIn().getHeader(ZooKeeperMessage.ZOOKEEPER_OPERATION, String.class);",0
fix reload bug," 		Map<String, PhysicalDBPool> cNodes = conf.getDataHosts();
 		boolean reloadStatus = true;
 		for (PhysicalDBPool dn : dataHosts.values()) {
-			
+			dn.setSchemas(MycatServer.getInstance().getConfig().getDataNodeSchemasOfDataHost(dn.getHostName()));
 			// init datahost
 			String index = DnPropertyUtil.loadDnIndexProps().getProperty(dn.getHostName(),
 					""0"");",0
#3960 fix," 
     @Override
     public int batch() {
-        return sourceIterator.numExamples();
+        return sourceIterator.batch();
     }
 
     @Override",0
Fix some typos,"  * By using {@link #intent(ViewIntentBinder)} and {@link #subscribeViewState(Observable,
  * ViewStateConsumer)}
  * a relay will be established between the view and this presenter that allows the view to be
- * temporarily detached, without unsubscribing the underlyings reactive business logic workflow and
+ * temporarily detached, without unsubscribing the underlying reactive business logic workflow and
  * without causing memory leaks (caused by recreation of the view).
  * </p>
  *
@@ -149,12 +149,12 @@
   private boolean subscribeViewStateMethodCalled = false;
   /**
    * List of internal relays, bridging the gap between intents coming from the viewState (will be
-   * unsubscribed temporarly when viewState is detached i.e. during config changes)
+   * unsubscribed temporarily when viewState is detached i.e. during config changes)
    */
   private List<IntentRelayBinderPair<?>> intentRelaysBinders = new ArrayList<>(4);
 
   /**
-   * Composite Desposals holding subscriptions to all intents observable offered by the viewState.
+   * Composite Disposals holding subscriptions to all intents observable offered by the viewState.
    */
   private CompositeDisposable intentDisposals;
 
@@ -199,7 +199,7 @@
    */
   public MviBasePresenter(@NonNull VS initialViewState) {
     if (initialViewState == null) {
-      throw new NullPointerException(""Initia ViewState == null"");
+      throw new NullPointerException(""Initial ViewState == null"");
     }
 
     viewRelay = BehaviorSubject.createDefault(initialViewState);
@@ -221,7 +221,7 @@
    * </p>
    *
    * @param viewStateObservable The Observable emitting new ViewState. Typically an intent {@link
-   * #intent(ViewIntentBinder)} causes the underyling business logic to do a change and eventually
+   * #intent(ViewIntentBinder)} causes the underlying business logic to do a change and eventually
    * create a new ViewState.
    * @param consumer {@link ViewStateConsumer} The consumer that will update (""render"") the view.
    */
@@ -259,7 +259,7 @@
   }
 
   /**
-   * Actually subscribes the view as consumer to the internaly view relay
+   * Actually subscribes the view as consumer to the internally view relay
    *
    * @param view The mvp view
    */
@@ -309,7 +309,7 @@
       unbindIntents();
       viewAttachedFirstTime = true;
       intentRelaysBinders.clear();
-      // TODO should we re emit the inital state? What if no initial state has been set.
+      // TODO should we re emit the initial state? What if no initial state has been set.
     }
 
     if (viewRelayConsumerDisposable != null) {
@@ -319,7 +319,7 @@
     }
 
     if (intentDisposals != null) {
-      // Cancel subscriptons from view intents to intent Relays
+      // Cancel subscriptions from view intents to intent Relays
       intentDisposals.dispose();
       intentDisposals = null;
     }",0
Fix issue #21 - memory leak,"         while (rsm.decode(buffer, output)) {
             ctx.fireChannelRead(output);
             output = new PubSubOutput<K, V>(codec);
+            buffer.discardReadBytes();
         }
     }
 ",0
Fix TargetApi settings from ListView delegates,"         mList.smoothScrollByOffset(offset);
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
+    @TargetApi(Build.VERSION_CODES.FROYO)
     public void smoothScrollToPosition(int position) {
         if (Build.VERSION.SDK_INT < Build.VERSION_CODES.HONEYCOMB) {
             mList.smoothScrollToPosition(position);
@@ -663,15 +663,11 @@
         return mList.getLastVisiblePosition();
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
     public void setChoiceMode(int choiceMode) {
-        requireSdkVersion(Build.VERSION_CODES.HONEYCOMB);
         mList.setChoiceMode(choiceMode);
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
     public void setItemChecked(int position, boolean value) {
-        requireSdkVersion(Build.VERSION_CODES.HONEYCOMB);
         mList.setItemChecked(position, value);
     }
 
@@ -681,21 +677,17 @@
         return mList.getCheckedItemCount();
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
+    @TargetApi(Build.VERSION_CODES.FROYO)
     public long[] getCheckedItemIds() {
-        requireSdkVersion(Build.VERSION_CODES.HONEYCOMB);
+        requireSdkVersion(Build.VERSION_CODES.FROYO);
         return mList.getCheckedItemIds();
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
     public int getCheckedItemPosition() {
-        requireSdkVersion(Build.VERSION_CODES.HONEYCOMB);
         return mList.getCheckedItemPosition();
     }
 
-    @TargetApi(Build.VERSION_CODES.HONEYCOMB)
     public SparseBooleanArray getCheckedItemPositions() {
-        requireSdkVersion(Build.VERSION_CODES.HONEYCOMB);
         return mList.getCheckedItemPositions();
     }
 ",0
CAMEL-12588 Fix Improvement,"         }
         
         if (timeoutCheckerExecutorService != null) {
-            camelContext.getExecutorServiceManager().shutdownNow(timeoutCheckerExecutorService);
+            camelContext.getExecutorServiceManager().shutdown(timeoutCheckerExecutorService);
         }
         
         ServiceHelper.stopServices(timeoutMap, processor, deadLetterProducerTemplate);",0
Fixed Coverity error UNINTENDED_INTEGER_DIVISION,"   protected Path buildClippingPath() {
 
     Path squaresPath = new Path();
-    int numSquares = (int) Math.ceil(width / (2 * squareSize));
+    int numSquares = (int) Math.ceil((double) width / (2 * squareSize));
     int startingHeight = height;
     int lowerHeight = startingHeight - squareSize;
     squaresPath.moveTo(0, startingHeight);",0
TreeViewer: Fix NPE," 
 				JTree selectedTree = (JTree) e.getSource();
 				TreePath path = selectedTree.getSelectionPath();
+				if (path!=null) {
 				TreeNodeWrapper treeNode = (TreeNodeWrapper) path.getLastPathComponent();
 
 				// Set the clicked AST.
 				viewer.setTree((Tree) treeNode.getUserObject());
 			}
+			}
 		});
 
 		treePanel.add(new JScrollPane(tree));",0
fix failed build,"  * @author andrew00x
  */
 @DTO
-public interface MachineProcessDto extends CommandDto, MachineProcess, Hyperlinks {
+public interface MachineProcessDto extends MachineProcess, Hyperlinks {
     void setPid(int pid);
 
     MachineProcessDto withPid(int pid);",0
Fix order of loading session settings," 		// Load user configuration
 		configManager.load();
 
+		// Load the session, including saved configuration
+		sessionManager.loadSession();
+
 		// Tell the plugin manager if client is outdated or not
 		pluginManager.setOutdated(isOutdated);
 
@@ -255,9 +258,6 @@
 		// Start client session
 		clientSessionManager.start();
 
-		// Load the session, including saved configuration
-		sessionManager.loadSession();
-
 		// Initialize UI
 		clientUI.open(this);
 ",0
"Fixed concurrency issues with submitting scan requests,","         } else if (checkIfLocationAccessIsEnabledIfRequired()) {
             return Observable.error(new BleScanException(BleScanException.LOCATION_SERVICES_DISABLED));
         } else {
-            return getMatchingQueuedScan(filterServiceUUIDs).switchIfEmpty(createScanOperation(filterServiceUUIDs));
+            return initializeScan(filterServiceUUIDs);
+        }
+    }
+
+    private Observable<RxBleScanResult> initializeScan(@Nullable UUID[] filterServiceUUIDs) {
+        final Set<UUID> filteredUUIDs = uuidUtil.toDistinctSet(filterServiceUUIDs);
+
+        synchronized (queuedScanOperations) {
+            Observable<RxBleScanResult> matchingQueuedScan = queuedScanOperations.get(filteredUUIDs);
+
+            if (matchingQueuedScan == null) {
+                matchingQueuedScan = createScanOperation(filterServiceUUIDs);
+                queuedScanOperations.put(filteredUUIDs, matchingQueuedScan);
+            }
+
+            return matchingQueuedScan;
         }
     }
 
@@ -103,28 +118,18 @@
     }
 
     private Observable<RxBleScanResult> createScanOperation(@Nullable UUID[] filterServiceUUIDs) {
-        return Observable.defer(() -> {
             final Set<UUID> filteredUUIDs = uuidUtil.toDistinctSet(filterServiceUUIDs);
             final RxBleRadioOperationScan scanOperation = new RxBleRadioOperationScan(filterServiceUUIDs, rxBleAdapterWrapper, uuidUtil);
-
-            final Observable<RxBleScanResult> scanResultObservable = rxBleRadio.queue(scanOperation)
+        return rxBleRadio.queue(scanOperation)
                     .doOnUnsubscribe(() -> {
+
+                    synchronized (queuedScanOperations) {
                         scanOperation.stop();
                         queuedScanOperations.remove(filteredUUIDs);
+                    }
                     })
                     .mergeWith(bluetoothAdapterOffExceptionObservable())
                     .map(this::convertToPublicScanResult)
                     .share();
-            queuedScanOperations.put(filteredUUIDs, scanResultObservable);
-            return scanResultObservable;
-        });
-    }
-
-    private Observable<RxBleScanResult> getMatchingQueuedScan(@Nullable UUID[] filterServiceUUIDs) {
-        return Observable.just(filterServiceUUIDs)
-                .map(uuidUtil::toDistinctSet)
-                .map(queuedScanOperations::get)
-                .filter(rxBleScanResultObservable -> rxBleScanResultObservable != null)
-                .flatMap(rxBleScanResultObservable -> rxBleScanResultObservable);
     }
 }",0
Fixed an issue: not able to promote a Content Targetter that already has a pending promotion.,"     }
 
     protected Long getRuleId(SimpleRule rule, EntityManager em) {
+        if (!em.contains(rule)) {
+            rule = em.merge(rule);
+        }
+
         Long id = (Long) em.unwrap(Session.class).getIdentifier(rule);
         id = transformId(id, rule);
         return id;
@@ -364,8 +368,13 @@
 
         Object containedRule = findContainedRuleIfApplicable(simpleRule);
         if (containedRule != null) {
+            if (!em.contains(containedRule)) {
+                containedRule = em.merge(containedRule);
+            }
+
             containedId = (Long) em.unwrap(Session.class).getIdentifier(containedRule);
             containedId = transformId(containedId, containedRule);
+
         }
 
         return containedId;",0
Long have to be compared using equals,"         } else {
             if (customerAddress.getAddress().isDefault()) {
                 for (CustomerAddress activeCustomerAddress : activeCustomerAddresses) {
-                    if (activeCustomerAddress.getId() != customerAddress.getId() && activeCustomerAddress.getAddress().isDefault()) {
+                    if (!activeCustomerAddress.getId().equals(customerAddress.getId()) && activeCustomerAddress.getAddress().isDefault()) {
                         activeCustomerAddress.getAddress().setDefault(false);
                         customerAddressDao.save(activeCustomerAddress);
                     }",0
Remove import (again) to fix build," import org.bytedeco.javacpp.FloatPointer;
 import org.bytedeco.javacpp.IntPointer;
 
-import static org.bytedeco.javacpp.mkl_rt.*;
 import static org.bytedeco.javacpp.openblas.*;
 import org.nd4j.linalg.api.blas.BlasException ;
 ",0
Fix comment.,"     protected volatile boolean     started;
 
     /**
-     * Bolt服务端
+     * Rest服务端
      */
     protected SofaNettyJaxrsServer httpServer;
 ",0
Correct help page for Passive Scan Rules options," 
     @Override
     public String getHelpIndex() {
-        return ""ui.dialogs.options.pscan"";
+        return ""ui.dialogs.options.pscanrules"";
     }
 }",0
修改多分片通配bug," 		}
 
 		this.name = name.toUpperCase();
-		String theDataNodes[] = SplitUtil.split(dataNode, ',', '$', '-', '[',
-				']');
+		String theDataNodes[] = SplitUtil.split(dataNode, ',', '$', '-');
+
 
 		if (theDataNodes == null || theDataNodes.length <= 0) {
 			throw new IllegalArgumentException(""invalid table dataNodes: """,0
#708 (bugfix for fibonacci sequence function),"         BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
         int n = Integer.parseInt(br.readLine());
 
-        System.out.println(fibMemo(n)); // Returns 8 for n = 6
-        System.out.println(fibBotUp(n)); // Returns 8 for n = 6
+        // Methods all returning [0, 1, 1, 2, 3, 5, ...] for n = [0, 1, 2, 3, 4, 5, ...]
+        System.out.println(fibMemo(n));
+        System.out.println(fibBotUp(n));
     }
 
     /**
@@ -34,13 +35,12 @@
 
         int f;
 
-        if (n <= 2) {
-            f = 1;
+        if (n <= 1) {
+            f = n;
         } else {
             f = fibMemo(n - 1) + fibMemo(n - 2);
             map.put(n, f);
         }
-
         return f;
     }
 
@@ -54,10 +54,10 @@
 
         Map<Integer, Integer> fib = new HashMap<>();
 
-        for (int i = 1; i < n + 1; i++) {
+        for (int i = 0; i <= n; i++) {
             int f;
-            if (i <= 2) {
-                f = 1;
+            if (i <= 1) {
+                f = i;
             } else {
                 f = fib.get(i - 1) + fib.get(i - 2);
             }",0
impling plugin: fix impling list not clearing on hopping worlds," import javax.inject.Inject;
 import lombok.AccessLevel;
 import lombok.Getter;
+import net.runelite.api.GameState;
 import net.runelite.api.NPC;
+import net.runelite.api.events.GameStateChanged;
 import net.runelite.api.events.NpcDespawned;
 import net.runelite.api.events.NpcSpawned;
 import net.runelite.client.config.ConfigManager;
@@ -91,6 +93,15 @@
 	}
 
 	@Subscribe
+	public void onGameStateChange(GameStateChanged event)
+	{
+		if (event.getGameState() == GameState.LOGIN_SCREEN || event.getGameState() == GameState.HOPPING)
+		{
+			implings.clear();
+		}
+	}
+
+	@Subscribe
 	public void onNpcDespawned(NpcDespawned npcDespawned)
 	{
 		if (implings.isEmpty())",0
"KYLIN-3492, fix typo in KylinConfigBase.getDefaultVarcharPrecision.","         int v = Integer.parseInt(getOptional(""kylin.source.hive.default-varchar-precision"", ""256""));
         if (v < 1) {
             return 256;
-        } else if (v > 65355) {
+        } else if (v > 65535) {
             return 65535;
         } else {
             return v;",0
Fixed SelectBox::hideList()," 
 	public void hideList () {
 		if (list.getParent() == null) return;
+		
+		getStage().removeCaptureListener(list.stageListener)
 		list.addAction(sequence(fadeOut(0.15f, Interpolation.fade), removeActor()));
 	}
 
@@ -228,7 +230,6 @@
 
 			public void touchUp (InputEvent event, float x, float y, int pointer, int button) {
 				hideList();
-				event.getStage().removeCaptureListener(stageListener);
 			}
 
 			public boolean mouseMoved (InputEvent event, float x, float y) {",0
Fixed error messages,"     }
 
     private GraphQL(GraphQLSchema graphQLSchema, ExecutionStrategy queryStrategy, ExecutionStrategy mutationStrategy, ExecutionStrategy subscriptionStrategy, ExecutionIdProvider idProvider, Instrumentation instrumentation, PreparsedDocumentProvider preparsedDocumentProvider) {
-        this.graphQLSchema = assertNotNull(graphQLSchema, ""queryStrategy must be non null"");
+        this.graphQLSchema = assertNotNull(graphQLSchema, ""graphQLSchema must be non null"");
         this.queryStrategy = queryStrategy != null ? queryStrategy : new AsyncExecutionStrategy();
         this.mutationStrategy = mutationStrategy != null ? mutationStrategy : new AsyncSerialExecutionStrategy();
         this.subscriptionStrategy = subscriptionStrategy != null ? subscriptionStrategy : new SubscriptionExecutionStrategy();
@@ -251,7 +251,7 @@
         }
 
         public GraphQL build() {
-            assertNotNull(graphQLSchema, ""queryStrategy must be non null"");
+            assertNotNull(graphQLSchema, ""graphQLSchema must be non null"");
             assertNotNull(queryExecutionStrategy, ""queryStrategy must be non null"");
             assertNotNull(idProvider, ""idProvider must be non null"");
             return new GraphQL(graphQLSchema, queryExecutionStrategy, mutationExecutionStrategy, subscriptionExecutionStrategy, idProvider, instrumentation, preparsedDocumentProvider);",0
do not add 1 to hour when generating display string for time and datetime column,"             if (value instanceof Date && format == DBDDisplayFormat.NATIVE) {
             Calendar cal = Calendar.getInstance();
             cal.setTime((Date) value);
-            final String hourOfDay = getTwoDigitValue(cal.get(Calendar.HOUR_OF_DAY) + 1);
+            final String hourOfDay = getTwoDigitValue(cal.get(Calendar.HOUR_OF_DAY));
             final String minutes = getTwoDigitValue(cal.get(Calendar.MINUTE));
             final String seconds = getTwoDigitValue(cal.get(Calendar.SECOND));
             final String year = String.valueOf(cal.get(Calendar.YEAR));",0
"1.3.0.1修改order by ,group by 别名的bug"," import com.alibaba.druid.sql.ast.SQLOrderingSpecification;
 import com.alibaba.druid.sql.ast.SQLStatement;
 import com.alibaba.druid.sql.ast.expr.SQLAggregateExpr;
+import com.alibaba.druid.sql.ast.expr.SQLAllColumnExpr;
+import com.alibaba.druid.sql.ast.expr.SQLIdentifierExpr;
 import com.alibaba.druid.sql.ast.expr.SQLIntegerExpr;
+import com.alibaba.druid.sql.ast.expr.SQLMethodInvokeExpr;
+import com.alibaba.druid.sql.ast.expr.SQLPropertyExpr;
 import com.alibaba.druid.sql.ast.statement.SQLSelectItem;
 import com.alibaba.druid.sql.ast.statement.SQLSelectOrderByItem;
 import com.alibaba.druid.sql.ast.statement.SQLSelectQuery;
@@ -39,6 +43,8 @@
 		if(sqlSelectQuery instanceof MySqlSelectQueryBlock) {
 			MySqlSelectQueryBlock mysqlSelectQuery = (MySqlSelectQueryBlock)selectStmt.getSelect().getQuery();
 
+			Map<String, String> aliaColumns = new HashMap<String, String>();//sohudo 2015-2-5 解决了下面这个坑
+			//以下注释的代码没准以后有用，rrs.setMergeCols(aggrColumns);目前就是个坑，设置了反而报错，得不到正确结果
 			//setHasAggrColumn ,such as count(*)
 			Map<String, Integer> aggrColumns = new HashMap<String, Integer>();
 			for(SQLSelectItem item : mysqlSelectQuery.getSelectList()) {
@@ -52,6 +58,16 @@
 					}
 					rrs.setHasAggrColumn(true);
 				}
+				else{
+					if (!(item.getExpr() instanceof SQLAllColumnExpr)) {
+						String alia=item.getAlias();
+						String field=getFieldName(item);
+						if (alia==null){
+						  alia=field;	
+						}
+					    aliaColumns.put(field,alia);				
+					}
+				}
 
 			}
 			if(aggrColumns.size() > 0) {
@@ -61,14 +77,14 @@
 			//setGroupByCols
 			if(mysqlSelectQuery.getGroupBy() != null) {
 				List<SQLExpr> groupByItems = mysqlSelectQuery.getGroupBy().getItems();
-				String[] groupByCols = buildGroupByCols(groupByItems);
+				String[] groupByCols = buildGroupByCols(groupByItems,aliaColumns);
 				rrs.setGroupByCols(groupByCols);
 			}
 			
 			//setOrderByCols
 			if(mysqlSelectQuery.getOrderBy() != null) {
 				List<SQLSelectOrderByItem> orderByItems = mysqlSelectQuery.getOrderBy().getItems();
-				rrs.setOrderByCols(buildOrderByCols(orderByItems));
+				rrs.setOrderByCols(buildOrderByCols(orderByItems,aliaColumns));
 			}
 
 			//更改canRunInReadDB属性
@@ -83,7 +99,14 @@
 //			System.out.println();
 		}
 	}
-	
+	private String getFieldName(SQLSelectItem item){
+		if ((item.getExpr() instanceof SQLPropertyExpr)||(item.getExpr() instanceof SQLMethodInvokeExpr)
+				|| (item.getExpr() instanceof SQLIdentifierExpr)) {			
+			return item.getExpr().toString();//字段别名
+		}
+		else
+		  return item.toString();
+	}
 	/**
 	 * 改写sql：需要加limit的加上
 	 */
@@ -240,17 +263,27 @@
 		
 	}
 	
-	private String[] buildGroupByCols(List<SQLExpr> groupByItems) {
+	private String getAliaColumn(Map<String, String> aliaColumns,String column ){
+		String alia=aliaColumns.get(column);
+		if (alia==null){
+			return column;
+		}
+		else {
+			return alia;
+		}
+	}
+	
+	private String[] buildGroupByCols(List<SQLExpr> groupByItems,Map<String, String> aliaColumns) {
 		String[] groupByCols = new String[groupByItems.size()]; 
 		for(int i= 0; i < groupByItems.size(); i++) {
 			SQLName expr = (SQLName) ((MySqlSelectGroupByExpr)groupByItems.get(i)).getExpr();
-			String column = removeBackquote(expr.getSimpleName().toUpperCase());
-			groupByCols[i] = column;
+			String column = removeBackquote(expr.getSimpleName());//不要转大写 2015-2-10 sohudo removeBackquote(expr.getSimpleName().toUpperCase());
+			groupByCols[i] = getAliaColumn(aliaColumns,column);//column;
 		}
 		return groupByCols;
 	}
 	
-	private LinkedHashMap<String, Integer> buildOrderByCols(List<SQLSelectOrderByItem> orderByItems) {
+	private LinkedHashMap<String, Integer> buildOrderByCols(List<SQLSelectOrderByItem> orderByItems,Map<String, String> aliaColumns) {
 		LinkedHashMap<String, Integer> map = new LinkedHashMap<String, Integer>();
 		for(int i= 0; i < orderByItems.size(); i++) {
 			SQLOrderingSpecification type = orderByItems.get(i).getType();
@@ -260,6 +293,7 @@
 			if(type == null) {
 				type = SQLOrderingSpecification.ASC;
 			}
+			col=getAliaColumn(aliaColumns,col);
 			map.put(col, type == SQLOrderingSpecification.ASC ? OrderCol.COL_ORDER_TYPE_ASC : OrderCol.COL_ORDER_TYPE_DESC);
 		}
 		return map;",0
Fix MergeManager overrides," 
     private void setHandlers(Properties props) throws ClassNotFoundException, IllegalAccessException, InstantiationException {
         ArrayList<MergeHandler> handlers = new ArrayList<MergeHandler>();
-        String[] keys = props.keySet().toArray(new String[props.keySet().size()]);
-        for (String key : keys) {
+        for (String key : props.stringPropertyNames()) {
             if (key.startsWith(""handler."")) {
                 MergeHandler temp = (MergeHandler) Class.forName(props.getProperty(key)).newInstance();
                 String name = key.substring(8, key.length());",0
Identify DecorViews on Android 6.0 Fixes #786," 
 		for (int j = 0; j < views.length; j++) {
 			view = views[j];
-			if (view != null){ 
-				String nameOfClass = view.getClass().getName();
-				if(nameOfClass.equals(""com.android.internal.policy.impl.PhoneWindow$DecorView"") || nameOfClass
-						.equals(""com.android.internal.policy.impl.MultiPhoneWindow$MultiPhoneDecorView"") || 
-						nameOfClass.equals(""com.android.internal.policy.PhoneWindow$DecorView"")) {
+			if (isDecorView(view)){ 
 					decorViews[i] = view;
 					i++;
 				}
 			}
-		}
 		return getRecentContainer(decorViews);
 	}
 
@@ -186,8 +181,7 @@
 
 			for (int j = 0; j < views.length; j++) {
 				view = views[j];
-				if (view != null && !(view.getClass().getName()
-						.equals(""com.android.internal.policy.impl.PhoneWindow$DecorView""))) {
+				if (!isDecorView(view)) {
 					decorViews[i] = view;
 					i++;
 				}
@@ -196,6 +190,21 @@
 		return decorViews;
 	}
 
+	/**
+	 * Returns whether a view is a DecorView
+ 	 * @param view
+	 * @return true if view is a DecorView, false otherwise
+	 */
+	private boolean isDecorView(View view) {
+		if (view == null) {
+			return false;
+		}
+
+		final String nameOfClass = view.getClass().getName();
+		return (nameOfClass.equals(""com.android.internal.policy.impl.PhoneWindow$DecorView"") ||
+				nameOfClass.equals(""com.android.internal.policy.impl.MultiPhoneWindow$MultiPhoneDecorView"") ||
+				nameOfClass.equals(""com.android.internal.policy.PhoneWindow$DecorView""));
+	}
 
 
 	/**",0
Fix bug with tab sorting when adding new tabs,"         SketchCode temp = code[who];
         code[who] = code[i];
         code[i] = temp;
+
+        // We also need to update the current tab
+        if (currentIndex == i) {
+          currentIndex = who;
+        } else if (currentIndex == who) {
+          currentIndex = i;
+        }
       }
     }
   }",0
Fix for load/save normalizer," 
     @Override
     public void preProcess(DataSet toPreProcess) {
-        if (featureMeanStd == null) throw new RuntimeException(""API_USE_ERROR: Preprocessors have to be explicitly fit before use. Usage: .fit(dataset) or .fit(datasetiterator)"");
+        if (featureMean == null) throw new RuntimeException(""API_USE_ERROR: Preprocessors have to be explicitly fit before use. Usage: .fit(dataset) or .fit(datasetiterator)"");
         INDArray theFeatures = toPreProcess.getFeatures();
         INDArray theLabels = toPreProcess.getLabels();
         this.preProcess(theFeatures,true);
@@ -256,6 +256,10 @@
     public void load(File...statistics) throws IOException {
         this.featureMean = Nd4j.readBinary(statistics[0]);
         this.featureStd = Nd4j.readBinary(statistics[1]);
+        if (fitLabels) {
+            this.labelMean = Nd4j.readBinary(statistics[2]);
+            this.labelStd = Nd4j.readBinary(statistics[3]);
+        }
     }
 
     /**
@@ -267,6 +271,10 @@
     public void save(File...statistics) throws IOException {
         Nd4j.saveBinary(this.featureMean,statistics[0]);
         Nd4j.saveBinary(this.featureStd,statistics[1]);
+        if (fitLabels) {
+            Nd4j.saveBinary(this.labelMean,statistics[2]);
+            Nd4j.saveBinary(this.labelStd,statistics[3]);
+        }
     }
 
     private INDArray tailor3d2d(DataSet dataset, boolean areFeatures) {",0
Fix for pause() not being called on iOS backend," 
 	public void resume() {
 		paused = false;
+		
+		if (wasPaused) {
+			Array<LifecycleListener> listeners = app.lifecycleListeners;
+			synchronized (listeners) {
+				for (LifecycleListener listener : listeners) {
+					listener.resume();
+				}
+			}
+			app.listener.resume();
+			wasPaused = false;
+		}
 	}
 
 	public void pause() {
 		paused = true;
+		
+		if (!wasPaused) {
+			Array<LifecycleListener> listeners = app.lifecycleListeners;
+			synchronized (listeners) {
+				for (LifecycleListener listener : listeners) {
+					listener.pause();
+				}
+			}
+			app.listener.pause();
+			wasPaused = true;
+		}
 	}
 
 	boolean created = false;
@@ -265,28 +287,7 @@
 			created = true;
 		}
 		if (paused) {
-			if (!wasPaused) {
-				Array<LifecycleListener> listeners = app.lifecycleListeners;
-				synchronized (listeners) {
-					for (LifecycleListener listener : listeners) {
-						listener.pause();
-					}
-				}
-				app.listener.pause();
-				wasPaused = true;
-			}
 			return;
-		} else {
-			if (wasPaused) {
-				Array<LifecycleListener> listeners = app.lifecycleListeners;
-				synchronized (listeners) {
-					for (LifecycleListener listener : listeners) {
-						listener.resume();
-					}
-				}
-				app.listener.resume();
-				wasPaused = false;
-			}
 		}
 
 		long time = System.nanoTime();",0
Property VisibilityEnum#VISIBLE_ALL does not work properly,"                         f.setIsVisible(false);
                     }
 
+                    if (VisibilityEnum.VISIBLE_ALL.equals(fmd.getVisibility())) {
+                        f.setIsVisible(true);
+                    }
+
                     // Add the field to the appropriate FieldGroup
                     if (fmd.getGroup() == null) {
                         homelessFields.add(f);",0
[BACKLOG-3424] - setting metastore when running trans through debug m…,"         trans.setSafeModeEnabled( executionConfiguration.isSafeModeEnabled() );
         trans.setPreview( true );
         trans.setGatheringMetrics( executionConfiguration.isGatheringMetrics() );
+        trans.setMetaStore( spoon.getMetaStore() );
         trans.prepareExecution( args );
         trans.setRepository( spoon.rep );
 ",0
fixed a bug regarding missing conditional check.,"         }
         Map<String, ServerTypeDetector> registeredDetectors = getRegisteredServerTypeDetectors(plugins);
         for (String orderedDetector : orderedDetectors) {
-            if (registeredDetectors.containsKey(orderedDetector));
+            if (registeredDetectors.containsKey(orderedDetector)) {
             this.detectors.add(registeredDetectors.remove(orderedDetector));
         }
+        }
         this.detectors.addAll(registeredDetectors.values());
         this.resolver = new ApplicationServerTypePluginResolver(this.detectors);
     }",0
Fix variable name in ArrayDistinctFunction,"         return new FunctionInfo(signature, getDescription(), isHidden(), methodHandle, isDeterministic(), false, ImmutableList.of(false));
     }
 
-    public static Slice distinct(Type type, Slice jsonArray)
+    public static Slice distinct(Type type, Slice array)
     {
-        Block elementsBlock = readStructuralBlock(jsonArray);
+        Block elementsBlock = readStructuralBlock(array);
 
         if (elementsBlock.getPositionCount() == 0) {
-            return jsonArray;
+            return array;
         }
 
         GroupByHash groupByHash = createGroupByHash(ImmutableList.of(type), new int[] {0}, Optional.empty(), elementsBlock.getPositionCount());",0
"Fixed NullPointerException inside Nd4j.rand(1,1) call with jcublas","         // check for INT datatype arrays
         interceptIntDataType(op);
 
-        if (op.x().isCompressed())
+        if (op.x() != null && op.x().isCompressed())
             Nd4j.getCompressor().decompressi(op.x());
 
         if (op.y() != null && op.y().isCompressed())",0
quick samediff null check to fix pooling layers in dl4j," 
         inputArguments.addAll(Arrays.asList(arg));
 
-        val args = args();
+        val args = sameDiff != null ? args() : null;
         val arrsSoFar = inputArguments();
         //validate arrays passed in, keep in mind that
         //this is a cumulative algorithm so we should always
         //refresh the current list
+        if (args != null) {
         for(int i = 0; i < arg.length; i++) {
             if(!Arrays.equals(args[i].getShape(),arrsSoFar[i].shape()))
                 throw new ND4JIllegalStateException(""Illegal array passed in. Expected shape "" + Arrays.toString(args[i].getShape()) + "" and received array with shape "" + Arrays.toString(arg[i].shape()));
         }
     }
+    }
 
     @Override
     public void removeInputArgument(INDArray arg) {",0
fix wrong TimeUnit," 
     // 2 minutes
     long maxExecuteTime = 2;
-    TimeUnit maxExecuteTimeUnit = TimeUnit.SECONDS;
+    TimeUnit maxExecuteTimeUnit = TimeUnit.MINUTES;
 
     WorkerExecutor executor = vertx.createSharedWorkerExecutor(""my-worker-pool"", poolSize, maxExecuteTime, maxExecuteTimeUnit);
   }",0
Fix ThreadGroup is parent for self,"                 groups.add(newRoot);
                 mirror.java.lang.ThreadGroup.groups.set(root, groups);
                 for (ThreadGroup group : newGroups) {
+                    if (group == newRoot) continue;
                     mirror.java.lang.ThreadGroup.parent.set(group, newRoot);
                 }
             }
@@ -389,6 +390,7 @@
                 ThreadGroupN.groups.set(newRoot, newGroups);
                 ThreadGroupN.groups.set(root, new ThreadGroup[]{newRoot});
                 for (Object group : newGroups) {
+                    if (group == newRoot) continue;
                     ThreadGroupN.parent.set(group, newRoot);
                 }
                 ThreadGroupN.ngroups.set(root, 1);",0
fix ArraySchema toString,"         sb.append(""class ArraySchema {\n"");
         sb.append(""    "").append(toIndentedString(super.toString())).append(""\n"");
         sb.append(""    items: "").append(toIndentedString(items)).append(""\n"");
-        sb.append(""    _default: "").append(toIndentedString(_default)).append(""\n"");
         sb.append(""}"");
         return sb.toString();
     }",0
JENKINS-38036# Regression fix with anonymous read permission on loadi…," import hudson.Extension;
 import hudson.model.UnprotectedRootAction;
 import hudson.remoting.Base64;
-import hudson.security.Permission;
 import io.jenkins.blueocean.BlueOceanUI;
 import io.jenkins.blueocean.commons.BlueOceanConfigProperties;
-import io.jenkins.blueocean.commons.ServiceException;
 import jenkins.model.Jenkins;
 import org.acegisecurity.Authentication;
 import org.acegisecurity.context.SecurityContext;
@@ -21,10 +19,7 @@
 import org.kohsuke.stapler.StaplerProxy;
 import org.kohsuke.stapler.StaplerRequest;
 
-import javax.xml.bind.DatatypeConverter;
 import java.nio.charset.StandardCharsets;
-import java.security.MessageDigest;
-import java.security.NoSuchAlgorithmException;
 import java.util.Random;
 
 /**
@@ -87,7 +82,7 @@
         }else{
             //If user doesn't have overall Jenkins read permission then return 403, which results in classic UI redirecting
             // user to login page
-            Jenkins.getInstance().checkPermission(Permission.READ);
+            Jenkins.getInstance().checkPermission(Jenkins.READ);
         }
 
         return app;",0
Fixed min/max operations in ComputerRetentionWork,"             if (!nextCheck.containsKey(c) || startRun > nextCheck.get(c)) {
                 // at the moment I don't trust strategies to wait more than 60 minutes
                 // strategies need to wait at least one minute
-                final long waitInMins = Math.min(1, Math.max(60, c.getRetentionStrategy().check(c)));
+                final long waitInMins = Math.max(1, Math.min(60, c.getRetentionStrategy().check(c)));
                 nextCheck.put(c, startRun + waitInMins*1000*60 /*MINS->MILLIS*/);
             }
         }",0
Populate totals and line items only for PaymentType.UNCONFIRMED," 
 import org.apache.commons.lang.StringUtils;
 import org.broadleafcommerce.common.money.Money;
-import org.broadleafcommerce.common.payment.PaymentType;
+import org.broadleafcommerce.common.payment.PaymentTransactionType;
 import org.broadleafcommerce.common.payment.dto.PaymentRequestDTO;
 import org.broadleafcommerce.common.util.BLCSystemProperty;
 import org.broadleafcommerce.core.order.domain.FulfillmentGroup;
@@ -87,8 +87,12 @@
         populateCustomerInfo(order, requestDTO);
         populateShipTo(order, requestDTO);
         populateBillTo(order, requestDTO);
+
+        // Only set totals and line items when in a Payment flow
+        if (PaymentTransactionType.UNCONFIRMED.equals(paymentTransaction.getType())) {
         populateTotals(order, requestDTO);
         populateDefaultLineItemsAndSubtotal(order, requestDTO);
+        }
         
         //Copy Additional Fields from PaymentTransaction into the Request DTO.
         //This will contain any gateway specific information needed to perform actions on this transaction",0
Fix formatting mistakes,"     return !traversalStack.empty();
   }
   
-  private void checkAndPush(Pair<IZyTreeNode, Integer> justProcessed, IZyTreeNode justProcessedNode, int justProcessedChildrenProcessed) {
+  private void checkAndPush(Pair<IZyTreeNode, Integer> justProcessed,
+    IZyTreeNode justProcessedNode, int justProcessedChildrenProcessed) {
         switch (justProcessedNode.getChildren().size()) {
             case 0:
                 throw new RuntimeException(""Error"");",0
typo fix in UnfinishedStubbingException,"                 ""Hints:"",
                 "" 1. missing thenReturn()"",
                 "" 2. you are trying to stub a final method, which is not supported"",
-                "" 3: you are stubbing the behaviour of another mock inside before 'thenReturn' instruction if completed"",
+                "" 3: you are stubbing the behaviour of another mock inside before 'thenReturn' instruction is completed"",
                 """"
         ));
     }",0
[#noissue] Fixes to incorrect detection in OpenWhisk," 
     @Override
     public boolean detect(ConditionProvider provider) {
-        setOpenwhiskApplicationType(provider);
+        return setOpenwhiskApplicationType(provider);
+    }
+
+    private boolean setOpenwhiskApplicationType(ConditionProvider provider) {
+        if (provider.checkForClass(CONTROLLER_REQUIRED_CLASS)) {
+            this.applicationType = OpenwhiskConstants.OPENWHISK_CONTROLLER;
+            return true;
+        } else if (provider.checkForClass(INVOKER_REQUIRED_CLASS)) {
+            this.applicationType = OpenwhiskConstants.OPENWHISK_INVOKER;
         return true;
     }
 
-    private void setOpenwhiskApplicationType(ConditionProvider provider) {
-        if (provider.checkForClass(CONTROLLER_REQUIRED_CLASS)) {
-            this.applicationType = OpenwhiskConstants.OPENWHISK_CONTROLLER;
-        } else if (provider.checkForClass(INVOKER_REQUIRED_CLASS)) {
-            this.applicationType = OpenwhiskConstants.OPENWHISK_INVOKER;
-        }
+        return false;
     }
 
 }",0
Fix handling of lexer accept positions for zero-length tokens and at EOF," 		if (ds0.isAcceptState) {
 			// allow zero-length tokens
 			captureSimState(prevAccept, input, ds0);
-			// adjust index since the current input character was not yet consumed
-			prevAccept.index--;
 		}
 
 		int t = input.LA(1);
@@ -239,6 +237,14 @@
 				break;
 			}
 
+			// If this is a consumable input element, make sure to consume before
+			// capturing the accept state so the input index, line, and char
+			// position accurately reflect the state of the interpreter at the
+			// end of the token.
+			if (t != IntStream.EOF) {
+				consume(input);
+			}
+
 			if (target.isAcceptState) {
 				captureSimState(prevAccept, input, target);
 				if (t == IntStream.EOF) {
@@ -246,11 +252,7 @@
 				}
 			}
 
-			if (t != IntStream.EOF) {
-				consume(input);
 				t = input.LA(1);
-			}
-
 			s = target; // flip; current DFA target becomes new src/from state
 		}
 
@@ -388,9 +390,6 @@
 		input.seek(index);
 		this.line = line;
 		this.charPositionInLine = charPos;
-		if (input.LA(1) != IntStream.EOF) {
-			consume(input);
-		}
 
 		if (lexerActionExecutor != null && recog != null) {
 			lexerActionExecutor.execute(recog, input, startIndex);",0
Fixing findbugs issue REC_CATCH_EXCEPTION," 
 package io.undertow.protocols.ssl;
 
+import io.undertow.UndertowLogger;
+import io.undertow.connector.ByteBufferPool;
 import org.xnio.ChannelListener;
 import org.xnio.ChannelListeners;
 import org.xnio.IoUtils;
 import org.xnio.Option;
 import org.xnio.OptionMap;
 import org.xnio.Options;
-import io.undertow.UndertowLogger;
-import io.undertow.connector.ByteBufferPool;
 import org.xnio.Sequence;
 import org.xnio.SslClientAuthMode;
 import org.xnio.StreamConnection;
@@ -36,7 +36,6 @@
 import org.xnio.channels.AcceptingChannel;
 import org.xnio.ssl.SslConnection;
 
-import javax.net.ssl.SSLEngine;
 import java.io.IOException;
 import java.net.InetAddress;
 import java.net.InetSocketAddress;
@@ -49,6 +48,7 @@
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicIntegerFieldUpdater;
 import java.util.concurrent.atomic.AtomicReferenceFieldUpdater;
+import javax.net.ssl.SSLEngine;
 
 import static org.xnio._private.Messages.msg;
 
@@ -183,7 +183,7 @@
                 engine.setEnabledProtocols(finalList.toArray(new String[finalList.size()]));
             }
             return accept(tcpConnection, engine);
-        } catch (Exception e) {
+        } catch (IOException | RuntimeException e) {
             IoUtils.safeClose(tcpConnection);
             UndertowLogger.REQUEST_LOGGER.failedToAcceptSSLRequest(e);
             return null;",0
"fix for masks, copy dataset","     @Override
     public DataSet copy() {
         DataSet ret = new DataSet(getFeatures().dup(), getLabels().dup());
+        if (getLabelsMaskArray() != null) ret.setLabelsMaskArray(getLabelsMaskArray().dup());
+        if(getFeaturesMaskArray() != null) ret.setFeaturesMaskArray(getFeaturesMaskArray().dup());
         ret.setColumnNames(getColumnNames());
         ret.setLabelNames(getLabelNames());
         return ret;",0
修复android5.0下本地库拷贝失败的bug," 
 	private static int copyNativeBinariesBeforeL(File apkFile, File sharedLibraryDir) {
 		try {
-			return Reflect.on(NativeLibraryHelper.class).call(""copyNativeBinariesIfNeededLI"", apkFile, sharedLibraryDir)
+			return Reflect.on(NativeLibraryHelper.Class).call(""copyNativeBinariesIfNeededLI"", apkFile, sharedLibraryDir)
 					.get();
 		} catch (Throwable e) {
 			e.printStackTrace();",0
fix BUG:dispose ACTIVITY FLAGS incorrect of CLEARTOP+SINGLETOP," import android.os.Bundle;
 import android.os.IBinder;
 import android.os.RemoteException;
+import android.util.Log;
 import android.util.SparseArray;
 
 import com.lody.virtual.client.core.VirtualCore;
@@ -75,11 +76,16 @@
     }
 
     private void deliverNewIntentLocked(ActivityRecord sourceRecord, ActivityRecord targetRecord, Intent intent) {
+        if (targetRecord == null) {
+            return;
+        }
         String creator = sourceRecord != null ? sourceRecord.component.getPackageName() : ""android"";
         try {
             targetRecord.process.client.scheduleNewIntent(creator, targetRecord.token, intent);
         } catch (RemoteException e) {
             e.printStackTrace();
+        } catch (NullPointerException npe) {
+            npe.printStackTrace();
         }
     }
 
@@ -200,6 +206,7 @@
 
     int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder resultTo, Bundle options,
                             String resultWho, int requestCode) {
+        boolean isClearTop_SingleTop = false;
 
         optimizeTasksLocked();
 
@@ -245,6 +252,8 @@
             case LAUNCH_SINGLE_TOP: {
                 if (!clearTop) {
                     singleTop = true;
+                } else {
+                    isClearTop_SingleTop = true;
                 }
                 if (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {
                     reuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
@@ -318,13 +327,19 @@
                     deliverNewIntentLocked(sourceRecord, topRecord, intent);
                     delivered = true;
                 }
+                if (isClearTop_SingleTop) {
+                    topRecord.marked = false;
+                    deliverNewIntentLocked(sourceRecord, topRecord, intent);
+                    delivered = true;
+                    Log.e(""AStack"", ""fix clear top with single top"");
+                }
             }
             if (taskMarked) {
                 synchronized (mHistory) {
                     scheduleFinishMarkedActivityLocked();
                 }
             }
-            if (reuseTask.isFinishing()) {
+            if (reuseTask != null && reuseTask.isFinishing()) {
                 startActivityInNewTaskLocked(userId, intent, info, options);
                 delivered = true;
             }",0
fix a bug on reloading sequence_db_conf.properties," 		for (Map.Entry<Object, Object> entry : props.entrySet()) {
 			String seqName = (String) entry.getKey();
 			String dataNode = (String) entry.getValue();
-			SequenceVal seqVal = new SequenceVal(seqName, dataNode);
-			seqValueMap.put(seqName, seqVal);
-
-
-
 			if(!seqValueMap.containsKey(seqName)){
 				seqValueMap.put(seqName, new SequenceVal(seqName, dataNode));
 			}else{",0
"[BACKLOG-24014] Amqp Consumer bug fix for step metrics table, fill table even when contains empty row.","   private void refreshView() {
     refreshViewLock.lock();
     try {
-      boolean tableCleared = false;
       int numberStepsToDisplay = -1;
       int baseStepCount = -1;
 
@@ -338,19 +337,22 @@
           }
         }
 
-        if ( table.getItemCount() != numberStepsToDisplay ) {
-          table.removeAll();
-          tableCleared = true;
-        }
-
         if ( numberStepsToDisplay == 0 && table.getItemCount() == 0 ) {
           // We need at least one table-item in a table
           new TableItem( table, SWT.NONE );
           return;
         }
 
-        if ( tableCleared ) {
-          // iterate over the base steps and add into table
+        //account for the empty tableItem which is added to an empty table
+        int offsetTableItemCount = table.getItemCount();
+        if ( offsetTableItemCount == 1 && Strings.isNullOrEmpty( table.getItem( 0 ).getText( STEP_NUMBER_COLUMN ) ) ) {
+          offsetTableItemCount = 0;
+        }
+
+        if ( offsetTableItemCount != numberStepsToDisplay ) {
+          table.removeAll();
+
+          // Fill table: iterate over the base steps and add into table
           for ( int i = 0; i < baseStepCount; i++ ) {
             StepInterface baseStep = transGraph.trans.getRunThread( i );
 
@@ -390,9 +392,8 @@
 
             String tableStepNumber = ti.getText( STEP_NUMBER_COLUMN );
 
-            //The first row step number may be empty if the table was just cleared
-            if ( rowIndex == 0 && Strings.isNullOrEmpty( tableStepNumber ) ) {
-              log.logDebug( ""Table step number null or empty for row 0"" );
+            if ( Strings.isNullOrEmpty( tableStepNumber ) ) {
+              log.logError( ""Table step number null or empty for row "" + rowIndex );
               continue;
             }
 ",0
Fix: failed withSavedInstanceState if withPositionBasedStateManagement(false),"                     id = String.valueOf(item.getIdentifier());
                     if (expandedItems != null && expandedItems.contains(id)) {
                         expand(i);
+                        size = getItemCount();
                     }
                     if (selectedItems != null && selectedItems.contains(id)) {
                         select(i);",0
Bugfix: correctly render vcard of a selected inline query result,"             user.phone = result.send_message.phone_number;
             user.first_name = result.send_message.first_name;
             user.last_name = result.send_message.last_name;
+            user.restriction_reason = result.send_message.vcard;
             SendMessagesHelper.getInstance(currentAccount).sendMessage(user, dialog_id, reply_to_msg, result.send_message.reply_markup, params);
         }
     }",0
HPlus: fixed bug setting current date," 
     private HPlusSupport setCurrentDate(TransactionBuilder transaction) {
         Calendar c = GregorianCalendar.getInstance();
-        int year = c.get(Calendar.YEAR) - 1900;
+        int year = c.get(Calendar.YEAR);
         int month = c.get(Calendar.MONTH);
         int day = c.get(Calendar.DAY_OF_MONTH);
 ",0
asyncHttpServer.directory fix. replaceAll replaces the entire url pattern.,"     }
 
     public static android.util.Pair<Integer, InputStream> getAssetStream(final Context context, String asset) {
-        AssetManager am = context.getAssets();
+        AssetManager am = context.getResources().getAssets();
         try {
             InputStream is = am.open(asset);
             return new android.util.Pair<Integer, InputStream>(is.available(), is);
@@ -373,12 +373,16 @@
         return null;
     }
 
+    private String replacePrefix(Matcher m) {
+        return m.group(0).substring(m.end(1));
+    }
+
     public void directory(Context context, String regex, final String assetPath) {
         final Context _context = context.getApplicationContext();
         addAction(AsyncHttpGet.METHOD, regex, new HttpServerRequestCallback() {
             @Override
             public void onRequest(AsyncHttpServerRequest request, final AsyncHttpServerResponse response) {
-                String path = request.getMatcher().replaceAll("""");
+                String path = replacePrefix(request.getMatcher());
                 android.util.Pair<Integer, InputStream> pair = getAssetStream(_context, assetPath + path);
                 final InputStream is = pair.second;
                 response.getHeaders().getHeaders().set(""Content-Length"", String.valueOf(pair.first));
@@ -401,7 +405,7 @@
         addAction(AsyncHttpHead.METHOD, regex, new HttpServerRequestCallback() {
             @Override
             public void onRequest(AsyncHttpServerRequest request, final AsyncHttpServerResponse response) {
-                String path = request.getMatcher().replaceAll("""");
+                String path = replacePrefix(request.getMatcher());
                 android.util.Pair<Integer, InputStream> pair = getAssetStream(_context, assetPath + path);
                 final InputStream is = pair.second;
                 StreamUtility.closeQuietly(is);
@@ -428,7 +432,7 @@
         addAction(""GET"", regex, new HttpServerRequestCallback() {
             @Override
             public void onRequest(AsyncHttpServerRequest request, final AsyncHttpServerResponse response) {
-                String path = request.getMatcher().replaceAll("""");
+                String path = replacePrefix(request.getMatcher());
                 File file = new File(directory, path);
                 
                 if (file.isDirectory() && list) {",0
fix error when no sampled in the dubbo,"             if (trace == null) {
                 return;
             }
-
+            if (!trace.canSampled()) {
+                return;
+            }
             try {
                 final SpanRecorder recorder = trace.getSpanRecorder();
                 doInBeforeTrace(recorder, target, args);",0
Fix the way proxy propagates auth headers to H2O Node (avoid duplicates)," 
     @Override
     protected void customizeExchange(HttpExchange exchange, HttpServletRequest request) {
-      exchange.addRequestHeader(""Authorization"", _basicAuth);
+      exchange.setRequestHeader(""Authorization"", _basicAuth);
     }
   }
 ",0
Fixed checkstyle errors in DynPrioQueue," package org.terasology.utilities.concurrency;
 
 import com.google.common.collect.Lists;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
 
 import java.util.AbstractQueue;
 import java.util.Collection;
 import java.util.Comparator;
 import java.util.Iterator;
-import java.util.LinkedList;
 import java.util.List;
 import java.util.ListIterator;
 import java.util.concurrent.BlockingQueue;
@@ -79,8 +76,8 @@
         }
     }
 
+    @Override
     public T poll() {
-        final ReentrantLock lock = this.lock;
         lock.lock();
         try {
             return dequeue();
@@ -89,35 +86,39 @@
         }
     }
 
+    @Override
     public T take() throws InterruptedException {
-        final ReentrantLock lock = this.lock;
         lock.lockInterruptibly();
-        T result;
         try {
-            while ( (result = dequeue()) == null)
+            T result = dequeue();
+            while (result == null) {
                 notEmpty.await();
+                result = dequeue();
+            }
+            return result;
         } finally {
             lock.unlock();
         }
-        return result;
     }
 
+    @Override
     public T poll(long timeout, TimeUnit unit) throws InterruptedException {
         long nanos = unit.toNanos(timeout);
-        final ReentrantLock lock = this.lock;
         lock.lockInterruptibly();
-        T result;
         try {
-            while ( (result = dequeue()) == null && nanos > 0)
+            T result = dequeue();
+            while (result == null && nanos > 0) {
                 nanos = notEmpty.awaitNanos(nanos);
+                result = dequeue();
+            }
+            return result;
         } finally {
             lock.unlock();
         }
-        return result;
     }
 
+    @Override
     public T peek() {
-        final ReentrantLock lock = this.lock;
         lock.lock();
         try {
             return elements.size() == 0 ? null : elements.get(0);
@@ -179,7 +180,6 @@
 
     @Override
     public int size() {
-        final ReentrantLock lock = this.lock;
         lock.lock();
         try {
             return elements.size();",0
fix shadervar return type error," 	{
 		ShaderVar out = null;
 		
-		if(left == right)
+		if(left != right)
 			out = getInstanceForDataType(left);
 		else if(left == DataType.IVEC4 || right == DataType.IVEC4)
 			out = getInstanceForDataType(DataType.IVEC4);",0
Fixed Fetch plan for async SQL statement in binary protocol,"           // FORCE THE SERVER'S TIMEOUT
           command.setTimeout(serverTimeout, command.getTimeoutStrategy());
 
-        ((OCommandRequestInternal) connection.database.command(command)).execute();
-
         // ASSIGNED THE PARSED FETCHPLAN
         listener.setFetchPlan(((OCommandRequestInternal) connection.database.command(command)).getFetchPlan());
 
+        ((OCommandRequestInternal) connection.database.command(command)).execute();
+        
+        
         if (empty.get())
           try {
             sendOk(clientTxId);",0
Fixed incorrect boards.txt preference handling when submenu id has underscore,"     TargetBoard board = getTargetBoard();
     if (board == null)
       return null;
+    String boardId = board.getId();
     
     PreferencesMap prefs = new PreferencesMap(board.getPreferences());
+
+    String extendedName = prefs.get(""name"");
     for (String menuId : board.getMenuIds()) {
+      if (!board.hasMenu(menuId))
+        continue;
+
+      // Get ""custom_[MENU_ID]"" preference (for example ""custom_cpu"")
       String entry = PreferencesData.get(""custom_"" + menuId);
-      if (board.hasMenu(menuId) && entry != null &&
-          entry.startsWith(board.getId())) {
-        String selectionId = entry.substring(entry.indexOf(""_"") + 1);
+      if (entry != null && entry.startsWith(boardId)) {
+
+        String selectionId = entry.substring(boardId.length() + 1);
         prefs.putAll(board.getMenuPreferences(menuId, selectionId));
-        prefs.put(""name"", prefs.get(""name"") + "", "" +
-            board.getMenuLabel(menuId, selectionId));
+
+        // Update the name with the extended configuration
+        extendedName += "", "" + board.getMenuLabel(menuId, selectionId);
       }
     }
+    prefs.put(""name"", extendedName);
     return prefs;
   }
 ",0
fix NullPointerException in ColumnIdent serialization broke MergeNodeTest and," 
     public ColumnIdent(String name) {
         this.name = name;
+        this.path = ImmutableList.of();
     }
 
     public ColumnIdent(String name, String childName) {
@@ -53,7 +54,7 @@
 
     public ColumnIdent(String name, @Nullable List<String> path) {
         this(name);
-        this.path = path;
+        this.path = Objects.firstNonNull(path, ImmutableList.<String>of());
     }
 
     public String name() {
@@ -67,13 +68,12 @@
         return Joiner.on(""."").join(name, path.toArray(new String[path.size()]));
     }
 
-    @Nullable
     public List<String> path() {
         return path;
     }
 
     public boolean isColumn() {
-        return path == null || path.size() == 0;
+        return path.isEmpty();
     }
 
     @Override",0
Fixes #1469 HttpClientMetrics#createEndpoint may be called multiple times for the same endpoint," import io.vertx.core.impl.VertxInternal;
 import io.vertx.core.logging.Logger;
 import io.vertx.core.logging.LoggerFactory;
+import io.vertx.core.net.impl.ChannelProvider;
 import io.vertx.core.net.impl.PartialPooledByteBufAllocator;
 import io.vertx.core.net.impl.ProxyChannelProvider;
 import io.vertx.core.net.impl.SSLHelper;
-import io.vertx.core.net.impl.ChannelProvider;
 import io.vertx.core.spi.metrics.HttpClientMetrics;
 
 import javax.net.ssl.SSLHandshakeException;
@@ -109,15 +109,7 @@
     private final Map<TargetAddress, ConnQueue> queueMap = new ConcurrentHashMap<>();
 
     ConnQueue getConnQueue(TargetAddress address, HttpVersion version) {
-      ConnQueue connQueue = queueMap.get(address);
-      if (connQueue == null) {
-        connQueue = new ConnQueue(version, this, address);
-        ConnQueue prev = queueMap.putIfAbsent(address, connQueue);
-        if (prev != null) {
-          connQueue = prev;
-        }
-      }
-      return connQueue;
+      return queueMap.computeIfAbsent(address, targetAddress -> new ConnQueue(version, this, targetAddress));
     }
 
     public void close() {",0
fix #1161," 
 import io.mycat.net.mysql.RowDataPacket;
 import io.mycat.util.ByteUtil;
-import io.mycat.util.CompareUtil;
 
 public class RowDataPacketSorter {
 
@@ -183,7 +182,8 @@
         case ColMeta.COL_TYPE_DATETIME:
         case ColMeta.COL_TYPE_NEWDATE:
         case ColMeta.COL_TYPE_BIT:
-            return BytesTools.compareTo(left,right);
+//            return BytesTools.compareTo(left,right);
+        	return ByteUtil.compareNumberByte(left, right);
         case ColMeta.COL_TYPE_VAR_STRING:
         case ColMeta.COL_TYPE_STRING:
             // ENUM和SET类型都是字符串，按字符串处理",0
fix incorrected null check," 
 
             final Method getRequestMethod = getGetRequestMethod(object);
-            if (getRequestMethod == null) {
+            if (getRequestMethod != null) {
                 final Request request = (Request) getRequestMethod.invoke(object);
                 return request;
             }",0
Fix bug #70. Initial delay was hardcoded to 1 second. Now uses delay …,"     };
 
     public void startAutoCycle(){
-        startAutoCycle(1000, mSliderDuration, mAutoRecover);
+        startAutoCycle(mSliderDuration, mSliderDuration, mAutoRecover);
     }
 
     /**",0
1771 fix cookie detection," 
 			JForEach innerForEach = forLoopBody.forEach(getClasses().STRING, ""thisCookieName"", requestedCookiesVar);
 			JBlock innerBody = innerForEach.body();
-			JBlock thenBlock = innerBody._if(JExpr.invoke(rawCookieVar, ""startsWith"").arg(innerForEach.var()))._then();
+			JBlock thenBlock = innerBody._if(JExpr.invoke(rawCookieVar, ""startsWith"").arg(innerForEach.var().plus(""="")))._then();
 
 			// where does the cookie VALUE end?
 			JInvocation valueEnd = rawCookieVar.invoke(""indexOf"").arg(JExpr.lit(';'));",0
Javadoc fix for the DDE methods using a String instead of Ddeml.HSZ,"          * string. A value of -1 indicates that pData is a data handle that
          * identifies the data being sent.
          *
-         * @param item The data item for which data is being
-         * exchanged during the transaction. This handle must have been created
-         * by a previous call to the DdeCreateStringHandle function. This
-         * parameter is ignored (and should be set to 0L) if the wType parameter
-         * is XTYP_EXECUTE.
+         * @param item The data item for which data is being exchanged during
+         * the transaction. This parameter is ignored (and should be set to NULL)
+         * if the wType parameter is XTYP_EXECUTE.
          *
          * @param wFmt The standard clipboard format in which the data item is
          * being submitted or requested.
@@ -2223,11 +2221,9 @@
          * function, and the application can use it only after establishing a
          * conversation with the server.
          *
-         * @param item The data item for which data is being
-         * exchanged during the transaction. This handle must have been created
-         * by a previous call to the DdeCreateStringHandle function. This
-         * parameter is ignored (and should be set to 0L) if the wType parameter
-         * is XTYP_EXECUTE.
+         * @param item The data item for which data is being exchanged during
+         * the transaction. This parameter is ignored (and should be set to NULL)
+         * if the wType parameter is XTYP_EXECUTE.
          *
          * @param wFmt The standard clipboard format in which the data item is
          * being submitted or requested.
@@ -2425,11 +2421,9 @@
          * string. A value of -1 indicates that pData is a data handle that
          * identifies the data being sent.
          *
-         * @param item The data item for which data is being
-         * exchanged during the transaction. This handle must have been created
-         * by a previous call to the DdeCreateStringHandle function. This
-         * parameter is ignored (and should be set to 0L) if the wType parameter
-         * is XTYP_EXECUTE.
+         * @param item The data item for which data is being exchanged during
+         * the transaction. This parameter is ignored (and should be set to NULL)
+         * if the wType parameter is XTYP_EXECUTE.
          *
          * @param wFmt The standard clipboard format in which the data item is
          * being submitted or requested.
@@ -2573,9 +2567,8 @@
          * conversation with the server.
          * 
          * @param item The data item for which data is being exchanged during
-         * the transaction. This handle must have been created by a previous
-         * call to the DdeCreateStringHandle function. This parameter is ignored
-         * (and should be set to 0L) if the wType parameter is XTYP_EXECUTE.
+         * the transaction. This parameter is ignored (and should be set to NULL)
+         * if the wType parameter is XTYP_EXECUTE.
          *
          * @param wFmt The standard clipboard format in which the data item is
          * being submitted or requested.
@@ -2661,11 +2654,9 @@
          * DdeCallback, receives this transaction when a client specifies
          * XTYP_ADVSTOP in the DdeClientTransaction function.
          *
-         * @param item The data item for which data is being
-         * exchanged during the transaction. This handle must have been created
-         * by a previous call to the DdeCreateStringHandle function. This
-         * parameter is ignored (and should be set to 0L) if the wType parameter
-         * is XTYP_EXECUTE.
+         * @param item The data item for which data is being exchanged during
+         * the transaction. This parameter is ignored (and should be set to NULL)
+         * if the wType parameter is XTYP_EXECUTE.
          *
          * @param wFmt The standard clipboard format in which the data item is
          * being submitted or requested.
@@ -3349,15 +3340,12 @@
          * server exists, the system selects only one.
          *
          * @param service The service name of the server application with which
-         * a conversation is to be established. This handle must have been
-         * created by a previous call to the DdeCreateStringHandle function. If
-         * this parameter is 0L, a conversation is established with any
-         * available server.
+         * a conversation is to be established. If this parameter is NULL, a
+         * conversation is established with any available server.
          *
          * @param topic The name of the topic on which a conversation is to be
-         * established. This handle must have been created by a previous call to
-         * DdeCreateStringHandle. If this parameter is 0L, a conversation on any
-         * topic supported by the selected server is established.
+         * established. If this parameter is NULL, a conversation on any topic
+         * supported by the selected server is established.
          *
          * @param convcontext A pointer to the CONVCONTEXT structure that contains
          * conversation context information. If this parameter is NULL, the
@@ -3699,14 +3687,13 @@
          * 
          * @param service A string that specifies the service name of the server
          * application with which a conversation is to be established. If this
-         * parameter is 0L, the system attempts to establish conversations with
+         * parameter is NULL, the system attempts to establish conversations with
          * all available servers that support the specified topic name.
          *
          * @param topic A string that specifies the name of the topic on which a
-         * conversation is to be established. This handle must have been created
-         * by a previous call to the DdeCreateStringHandle function. If this
-         * parameter is 0L, the system will attempt to establish conversations
-         * on all topics supported by the selected server (or servers).
+         * conversation is to be established. If this parameter is NULL, the
+         * system will attempt to establish conversations on all topics
+         * supported by the selected server (or servers).
          * 
          * @param existingList An existinct conversation list to be enumerated.
          * This parameter should be NULL if a new conversation list is to be",0
Fix editor(my IntelliJ IDEA) preview bug,"     }
 
     private void init() {
+        if (!isInEditMode())
         Iconify.addIcons(this);
+        else
+          this.setText(""ico"");
     }
 
     @Override",0
Fix crash when rename file on smb server," /*
- * Copyright (C) 2014 Arpit Khurana <arpitkh96@gmail.com>, Vishal Nehra <vishalmeham2@gmail.com>
+ * Copyright (C) 2014 Arpit Khurana <arpitkh96@gmail.com>, Vishal Nehra <vishalmeham2@gmail.com>,
+ * Marcin Zasuwa <marcinadd@gmail.com>
  *
  * This file is part of Amaze File Manager.
  *
@@ -242,6 +243,7 @@
      * @param context
      */
     public static void scanFile(@NonNull Context context, @NonNull HybridFile[] hybridFiles) {
+        AsyncTask.execute(() -> {
         if (hybridFiles[0].exists(context) && hybridFiles[0].isLocal()) {
             String[] paths = new String[hybridFiles.length];
             for (int i = 0; i<hybridFiles.length; i++) {
@@ -254,6 +256,7 @@
                 scanFile(hybridFile, context);
             }
         }
+        });
     }
 
     /**",0
Pac4j: Fix SAML IdP initiated logout,"         val request = WebUtils.getHttpServletRequestFromExternalWebflowContext(context);
         val response = WebUtils.getHttpServletResponseFromExternalWebflowContext(context);
 
-        if (singleSignOnSessionExists(context)) {
+        if (!isLogoutRequest(request) && singleSignOnSessionExists(context)) {
             LOGGER.debug(""An existing single sign-on session already exists. Skipping delegation and routing back to CAS authentication flow"");
             return super.doExecute(context);
         }
@@ -243,6 +243,10 @@
         }
     }
 
+    private boolean isLogoutRequest(final HttpServletRequest request) {
+        return request.getParameter(SAML2ServiceProviderMetadataResolver.LOGOUT_ENDPOINT_PARAMETER) != null;
+    }
+
     private boolean singleSignOnSessionExists(final RequestContext requestContext) {
         val tgtId = WebUtils.getTicketGrantingTicketId(requestContext);
         if (StringUtils.isBlank(tgtId)) {
@@ -448,8 +452,8 @@
      * @return the service
      */
     protected Service restoreAuthenticationRequestInContext(final RequestContext requestContext, final J2EContext webContext, final String clientName) {
-        val logoutEndpoint = webContext.getRequestParameter(SAML2ServiceProviderMetadataResolver.LOGOUT_ENDPOINT_PARAMETER);
-        if (logoutEndpoint != null) {
+        val logoutEndpoint = isLogoutRequest(webContext.getRequest());
+        if (logoutEndpoint) {
             return null;
         } else {
             try {",0
Comparing related Skus when computing related products could yield incorrect results,"                         
                     }
                 } else {
-                    if(numSkus == maxQuantity) {
+                    if(numSkus.equals(maxQuantity)) {
                         break;
                     }
                     relatedSkus.add(relatedProduct.getDefaultSku());",0
Fix wince-arm detection (affects only unittests),"         C_LIBRARY_NAME = osType == WINDOWS ? ""msvcrt"" : osType == WINDOWSCE ? ""coredll"" : ""c"";
         MATH_LIBRARY_NAME = osType == WINDOWS ? ""msvcrt"" : osType == WINDOWSCE ? ""coredll"" : ""m"";
         HAS_DLL_CALLBACKS = osType == WINDOWS;
-	ARCH = getCanonicalArchitecture(System.getProperty(""os.arch""));
+	ARCH = getCanonicalArchitecture(System.getProperty(""os.arch""), osType);
         RESOURCE_PREFIX = getNativeLibraryResourcePrefix();
     }
     private Platform() { }
@@ -236,7 +236,7 @@
         return false;
     }
 
-    static String getCanonicalArchitecture(String arch) {
+    static String getCanonicalArchitecture(String arch, int platform) {
 	arch = arch.toLowerCase().trim();
         if (""powerpc"".equals(arch)) {
             arch = ""ppc"";
@@ -256,7 +256,7 @@
 	    arch = ""ppc64le"";
 	}
         // Map arm to armel if the binary is running as softfloat build
-        if(""arm"".equals(arch) && isSoftFloat()) {
+        if(""arm"".equals(arch) && platform == Platform.LINUX && isSoftFloat()) {
             arch = ""armel"";
         }
         
@@ -300,7 +300,7 @@
     */
     static String getNativeLibraryResourcePrefix(int osType, String arch, String name) {
         String osPrefix;
-        arch = getCanonicalArchitecture(arch);
+        arch = getCanonicalArchitecture(arch, osType);
         switch(osType) {
         case Platform.ANDROID:
             if (arch.startsWith(""arm"")) {",0
Null pointer exception fixed,"           pesPayloadReader = id3Reader;
         } else {
           pesPayloadReader = streamReaderFactory.createStreamReader(streamType, esInfo);
+          if (pesPayloadReader != null) {
           pesPayloadReader.init(output, new TrackIdGenerator(trackId, MAX_PID_PLUS_ONE));
         }
+        }
 
         if (pesPayloadReader != null) {
           tsPayloadReaders.put(elementaryPid, new PesReader(pesPayloadReader, timestampAdjuster));",0
Fix stop joining thread before interrupting Selector.select," 		}
 
 		synchronized ( this ) {
-			if( selectorthread != null ) {
-				if( Thread.currentThread() != selectorthread ) {
-
-				}
-				if( selectorthread != Thread.currentThread() ) {
-					if( socketsToClose.size() > 0 )
-						selectorthread.join( timeout );// isclosed will tell the selectorthread to go down after the last connection was closed
-					selectorthread.interrupt();// in case the selectorthread did not terminate in time we send the interrupt
-					selectorthread.join();
-				}
+			if( selectorthread != null && selectorthread != Thread.currentThread() ) {
+				selector.wakeup();
+				selectorthread.interrupt();
+				selectorthread.join( timeout );
 			}
 		}
 	}",0
Fix parentheses in login page object,"     @Override
     public UriBuilder createUriBuilder() {
         return super.createUriBuilder()
-                .path((getProtocol().equals(OIDC) || getProtocol().equals(SAML)) ? ""protocol/"" : """" + ""{"" + PROTOCOL + ""}"" + (getProtocol().equals(OIDC) ? ""/auth"" : """"));
+                .path(((getProtocol().equals(OIDC) || getProtocol().equals(SAML)) ? ""protocol/"" : """") + ""{"" + PROTOCOL + ""}"" + (getProtocol().equals(OIDC) ? ""/auth"" : """"));
     }
     
     public void setProtocol(String protocol) {",0
Notifications fix," import java.util.Comparator;
 import java.util.HashMap;
 import java.util.List;
+import java.util.concurrent.TimeUnit;
 
 /**
  * This is a service that scans for nearby uriBeacons.
@@ -93,6 +94,7 @@
   private static final int NEAREST_BEACON_NOTIFICATION_ID = 23;
   private static final int SECOND_NEAREST_BEACON_NOTIFICATION_ID = 24;
   private static final int SUMMARY_NOTIFICATION_ID = 25;
+  private static final int TIMEOUT_FOR_OLD_BEACONS = 2;
   private static final int NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR = Color.parseColor(""#ffffff"");
   private static final int NON_LOLLIPOP_NOTIFICATION_URL_COLOR = Color.parseColor(""#999999"");
   private static final int NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR = Color.parseColor(""#999999"");
@@ -138,15 +140,16 @@
   }
 
   private void initialize() {
-    mRegionResolver = new RegionResolver();
     mNotificationManager = NotificationManagerCompat.from(this);
-    mUrlToUrlMetadata = new HashMap<>();
-    mSortedDevices = null;
-    mDeviceAddressToUrl = new HashMap<>();
     mMdnsUrlDiscoverer = new MdnsUrlDiscoverer(this, UriBeaconDiscoveryService.this);
     initializeScreenStateBroadcastReceiver();
   }
-
+  private void initializeLists() {
+    mRegionResolver = new RegionResolver();
+    mUrlToUrlMetadata = new HashMap<>();
+    mSortedDevices = null;
+    mDeviceAddressToUrl = new HashMap<>();
+  }
   /**
    * Create the broadcast receiver that will listen
    * for screen on/off events
@@ -171,6 +174,8 @@
 
   @Override
   public int onStartCommand(Intent intent, int flags, int startId) {
+    // Since sometimes the lists have values when onStartCommand gets called
+    initializeLists();
     // Start scanning only if the screen is on
     PowerManager powerManager = (PowerManager) getSystemService(Context.POWER_SERVICE);
     if (powerManager.isScreenOn()) {
@@ -194,8 +199,7 @@
     stopSearchingForUriBeacons();
     mMdnsUrlDiscoverer.stopScanning();
     unregisterReceiver(mScreenStateBroadcastReceiver);
-    mUrlToUrlMetadata = new HashMap<>();
-    cancelNotifications();
+    mNotificationManager.cancelAll();
   }
 
   @Override
@@ -253,6 +257,9 @@
   }
 
   private void handleFoundDevice(ScanResult scanResult) {
+    long timeStamp = scanResult.getTimestampNanos();
+    long now = TimeUnit.MILLISECONDS.toNanos(System.currentTimeMillis());
+    if (now - timeStamp < TimeUnit.SECONDS.toNanos(TIMEOUT_FOR_OLD_BEACONS)) {
     UriBeacon uriBeacon = UriBeacon.parseFromBytes(scanResult.getScanRecord().getBytes());
     if (uriBeacon != null) {
       String address = scanResult.getDevice().getAddress();
@@ -270,6 +277,7 @@
       mRegionResolver.onUpdate(address, rssi, txPowerLevel);
     }
   }
+  }
 
   /**
    * Create a new set of notifications or update those existing
@@ -280,7 +288,7 @@
     // If no beacons have been found
     if (mSortedDevices.size() == 0) {
       // Remove all existing notifications
-      cancelNotifications();
+      mNotificationManager.cancelAll();
       return;
     }
     // If at least one beacon has been found
@@ -328,7 +336,8 @@
     }
     navigateToBeaconUrlIntent.setData(Uri.parse(url));
     int requestID = (int) System.currentTimeMillis();
-    PendingIntent pendingIntent = PendingIntent.getActivity(this, requestID, navigateToBeaconUrlIntent, 0);
+    PendingIntent pendingIntent = PendingIntent.getActivity(this, requestID,
+        navigateToBeaconUrlIntent, 0);
 
     String title = urlMetadata.title;
     String description = urlMetadata.description;
@@ -460,12 +469,6 @@
     }
   }
 
-  private void cancelNotifications() {
-    mNotificationManager.cancel(SUMMARY_NOTIFICATION_ID);
-    mNotificationManager.cancel(SECOND_NEAREST_BEACON_NOTIFICATION_ID);
-    mNotificationManager.cancel(NEAREST_BEACON_NOTIFICATION_ID);
-  }
-
   /**
    * This is the class that listens for screen on/off events
    */
@@ -473,6 +476,8 @@
     @Override
     public void onReceive(Context context, Intent intent) {
       boolean isScreenOn = Intent.ACTION_SCREEN_ON.equals(intent.getAction());
+      initializeLists();
+      mNotificationManager.cancelAll();
       if (isScreenOn) {
         startSearchingForUriBeacons();
         mMdnsUrlDiscoverer.startScanning();",0
Fixed a typo," 
 /**
  * This implementation of the resource mapping context assumed resource are
- * of simple a simple type with a statically defined structure.
+ * of a simple type with a statically defined structure.
  *
  * @author Gerard Davison (gerard.davison at oracle.com)
  */",0
fixed wrong class name generation for fixed length strings,"                 indent + ""        CodecUtil.charsPut(buffer, this.offset + %d, src, srcOffset, length);\n"" +
                 indent + ""        return this;\n"" +
                 indent + ""    }\n"",
-                containingClassName,
+                formatClassName(containingClassName),
                 toUpperFirstChar(propertyName),
                 fieldLength,
                 offset",0
Response packets should not be processed on io threads,"         try {
             if (packet.isHeaderSet(Packet.HEADER_RESPONSE)) {
                 //it is an response packet.
-                responseThread.process(packet);
+                responseThread.workQueue.add(packet);
             } else {
                 //it is an must be an operation packet
                 int partitionId = packet.getPartitionId();",0
Fix backport typo in NearCache heap cost calculation,"     private void updateSizeEstimatorWithRecords(NearCacheRecord previous, NearCacheRecord record) {
         updateSizeEstimator(calculateCost(record));
         if (previous != null) {
-            updateSizeEstimator(-calculateCost(record));
+            updateSizeEstimator(-calculateCost(previous));
         }
     }
 ",0
Fixed typo in Eclipse import instructions (GdxSetupUI.java)," 				}, ui.settings.getGradleArgs());
 				log(""Done!"");
 				if (ui.settings.getGradleArgs().contains(""eclipse"") || ui.settings.getGradleArgs().contains(""idea"")) {
-					log(""To import in Eclipse: File -> Import -> General -> Exisiting Projects into Workspace"");
+					log(""To import in Eclipse: File -> Import -> General -> Existing Projects into Workspace"");
 					log(""To import to Intellij IDEA: File -> Open -> YourProject.ipr"");
 				} else {
 					log(""To import in Eclipse: File -> Import -> Gradle -> Gradle Project"");",0
Fix RGBA color tuple parsing,"       if (colorExpression.length() == 7) {
         // Set the alpha value
         color |= 0x00000000ff000000;
-      } else if (colorExpression.length() != 9) {
+      } else if (colorExpression.length() == 9) {
+        int alpha = (int) color & 0x00000000000000ff; // get the transparency
+        color >>= 8;                                  // put rgb bytes in their rightful place
+        color |= alpha << 24;                         // put the transparency byte in its rightful place
+      } else {
         throw new IllegalArgumentException();
       }
       return (int) color;",0
Fix return value of method withModel in IGenericItem," 
 import android.support.v7.widget.RecyclerView;
 
-import com.mikepenz.fastadapter.items.GenericAbstractItem;
-
 /**
  * Created by mikepenz on 03.02.15.
  */
@@ -15,7 +13,7 @@
      * @param model
      * @return
      */
-    GenericAbstractItem<?, ?, ?> withModel(Model model);
+    IGenericItem<?, ?, ?> withModel(Model model);
 
     /**
      * get's the model of the item",0
Fix fluid tanks incorrectly reading NBT when empty,"         if (!nbt.hasKey(""Empty""))
         {
             FluidStack fluid = FluidStack.loadFluidStackFromNBT(nbt);
-
-            if (fluid != null)
-            {
                 setFluid(fluid);
             }
+        else
+        {
+            setFluid(null);
         }
         return this;
     }",0
Persist the invalidation of Order Payment,"         for (PaymentTransaction transaction : payment.getTransactions()) {
             transaction.setArchived('Y');
         }
+        orderPaymentService.save(payment);
     }
 
     @Override",0
[golang] no longer assumes fixed order of group dimension metadata fields,"         final String propertyName = formatPropertyName(signalToken.name());
         final Token blockLengthToken = Generators.findFirst(""blockLength"", tokens, 0);
         final Token numInGroupToken = Generators.findFirst(""numInGroup"", tokens, 0);
+        final int blockLengthOffset = blockLengthToken.offset();
         final String blockLengthType = golangTypeName(blockLengthToken.encoding().primitiveType());
         final String blockLengthMarshalType = golangMarshalType(blockLengthToken.encoding().primitiveType());
+        final int numInGroupOffset = numInGroupToken.offset();
         final String numInGroupType = golangTypeName(numInGroupToken.encoding().primitiveType());
         final String numInGroupMarshalType = golangMarshalType(numInGroupToken.encoding().primitiveType());
 
@@ -1189,16 +1191,32 @@
         encode.append(generateEncodeOffset(gap, """"));
         decode.append(generateDecodeOffset(gap, """"));
 
-        // Write/Read the group header
-        encode.append(String.format(
-            ""\n\tvar %7$sBlockLength %1$s = %2$d\n"" +
-            ""\tvar %7$sNumInGroup %3$s = %3$s(len(%4$s.%5$s))\n"" +
+        // Write block length
+        final String encBlockLengthTmpl =
+            ""\tvar %7$sBlockLength %1$s = %2$d\n"" +
             ""\tif err := _m.Write%6$s(_w, %7$sBlockLength); err != nil {\n"" +
             ""\t\treturn err\n"" +
-            ""\t}\n"" +
+            ""\t}\n"";
+
+        // Write number of elements in group
+        final String encNumInGroupTmpl =
+            ""\tvar %7$sNumInGroup %3$s = %3$s(len(%4$s.%5$s))\n"" +
             ""\tif err := _m.Write%8$s(_w, %7$sNumInGroup); err != nil {\n"" +
             ""\t\treturn err\n"" +
-            ""\t}\n"",
+            ""\t}\n"";
+
+        // Order write based on offset
+        String encGrpMetaTmpl = ""\n"";
+        if (blockLengthOffset < numInGroupOffset)
+        {
+            encGrpMetaTmpl = encBlockLengthTmpl + encNumInGroupTmpl;
+        }
+        else
+        {
+            encGrpMetaTmpl = encNumInGroupTmpl + encBlockLengthTmpl;
+        }
+
+        encode.append(String.format(encGrpMetaTmpl,
             blockLengthType,
             signalToken.encodedLength(),
             numInGroupType,
@@ -1208,7 +1226,7 @@
             propertyName,
             numInGroupMarshalType));
 
-        // Write/Read the group itself
+        // Write the group itself
         encode.append(String.format(
             ""\tfor _, prop := range %1$s.%2$s {\n"" +
             ""\t\tif err := prop.Encode(_m, _w); err != nil {\n"" +
@@ -1217,18 +1235,10 @@
             varName,
             toUpperFirstChar(signalToken.name())));
 
-        // Read length/num
+        // Check version
         decode.append(String.format(
             ""\n"" +
-            ""\tif %1$s.%2$sInActingVersion(actingVersion) {\n"" +
-            ""\t\tvar %2$sBlockLength %3$s\n"" +
-            ""\t\tvar %2$sNumInGroup %4$s\n"" +
-            ""\t\tif err := _m.Read%5$s(_r, &%2$sBlockLength); err != nil {\n"" +
-            ""\t\t\treturn err\n"" +
-            ""\t\t}\n"" +
-            ""\t\tif err := _m.Read%6$s(_r, &%2$sNumInGroup); err != nil {\n"" +
-            ""\t\t\treturn err\n"" +
-            ""\t\t}\n"",
+            ""\tif %1$s.%2$sInActingVersion(actingVersion) {\n"",
             varName,
             propertyName,
             blockLengthType,
@@ -1236,7 +1246,39 @@
             blockLengthMarshalType,
             numInGroupMarshalType));
 
-        // Read num elements
+        // Read block length
+        final String decBlockLengthTmpl =
+            ""\t\tvar %2$sBlockLength %3$s\n"" +
+            ""\t\tif err := _m.Read%5$s(_r, &%2$sBlockLength); err != nil {\n"" +
+            ""\t\t\treturn err\n"" +
+            ""\t\t}\n"";
+
+        // Read number of elements in group
+        final String decNumInGroupTmpl =
+            ""\t\tvar %2$sNumInGroup %4$s\n"" +
+            ""\t\tif err := _m.Read%6$s(_r, &%2$sNumInGroup); err != nil {\n"" +
+            ""\t\t\treturn err\n"" +
+            ""\t\t}\n"";
+
+        // Order read based on offset
+        String decGrpMetaTmpl = ""\n"";
+        if (blockLengthOffset < numInGroupOffset)
+        {
+            decGrpMetaTmpl = decBlockLengthTmpl + decNumInGroupTmpl;
+        }
+        else
+        {
+            decGrpMetaTmpl = decNumInGroupTmpl + decBlockLengthTmpl;
+        }
+        decode.append(String.format(decGrpMetaTmpl,
+            varName,
+            propertyName,
+            blockLengthType,
+            numInGroupType,
+            blockLengthMarshalType,
+            numInGroupMarshalType));
+
+        // Read the group itself
         decode.append(String.format(
             ""\t\tif cap(%1$c.%2$s) < int(%2$sNumInGroup) {\n"" +
             ""\t\t\t%1$s.%2$s = make([]%3$s%2$s, %2$sNumInGroup)\n"" +",0
fix 通知栏2个view,"         Notification notification1 = NotificaitionUtils.clone(pluginContext, notification);
         if (Build.VERSION.SDK_INT >= 16 && isBig) {
             notification1.bigContentView = remoteViews;
+            notification1.contentView = null;
         } else {
+            if (Build.VERSION.SDK_INT >= 16) {
+                notification1.bigContentView = null;
+            }
             notification1.contentView = remoteViews;
         }
         ResourcesCompat.getInstance().fixNotificationIcon(notification1);",0
"Revert #2672, fixing #2788 and part of #2804, but bringing back #2605","  */
 package org.terasology.logic.players;
 
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.Collection;
-
 import org.terasology.engine.Time;
-import org.terasology.entitySystem.Component;
 import org.terasology.entitySystem.entity.EntityBuilder;
 import org.terasology.entitySystem.entity.EntityManager;
 import org.terasology.entitySystem.entity.EntityRef;
+import org.terasology.entitySystem.entity.lifecycleEvents.BeforeDeactivateComponent;
 import org.terasology.entitySystem.entity.lifecycleEvents.OnActivatedComponent;
 import org.terasology.entitySystem.entity.lifecycleEvents.OnChangedComponent;
 import org.terasology.entitySystem.event.ReceiveEvent;
@@ -42,35 +38,24 @@
 import org.terasology.math.geom.Vector3f;
 import org.terasology.network.ClientComponent;
 import org.terasology.registry.In;
-import org.terasology.rendering.logic.MeshComponent;
+import org.terasology.rendering.world.WorldRenderer;
 
-/**
- */
 @RegisterSystem(RegisterMode.CLIENT)
 public class FirstPersonClientSystem extends BaseComponentSystem implements UpdateSubscriberSystem {
-
     private static final int USEANIMATIONLENGTH = 200;
 
-    /** Lists the component classes which are needed to render a held item */
-    private static final Collection<Class<? extends Component>> NEEDED_COMPONENTS_FOR_RENDERING =
-            Arrays.asList(
-                MeshComponent.class,
-                FirstPersonHeldItemTransformComponent.class);
-
     @In
     private LocalPlayer localPlayer;
     @In
+    private WorldRenderer worldRenderer;
+    @In
     private EntityManager entityManager;
     @In
     private Time time;
 
     private EntityRef handEntity;
-
-    // the item from the inventory synchronized with the server
-    private EntityRef currentHeldItem = EntityRef.NULL;
-
-    // the client side entity representing the hold item
-    private EntityRef clientHeldItem = EntityRef.NULL;
+    private EntityRef currentHeldItem;
+    private boolean relinkHeldItem;
 
     private EntityRef getHandEntity() {
         if (handEntity == null) {
@@ -82,7 +67,6 @@
         return handEntity;
     }
 
-    // ensures held item mount point entity exists, attaches it to the camera and sets its transform
     @ReceiveEvent
     public void ensureClientSideEntityOnHeldItemMountPoint(OnActivatedComponent event, EntityRef camera,
                                                            FirstPersonHeldItemMountPointComponent firstPersonHeldItemMountPointComponent) {
@@ -93,9 +77,6 @@
             camera.saveComponent(firstPersonHeldItemMountPointComponent);
         }
 
-        // subscribe to vr controller pose updates if possible
-        firstPersonHeldItemMountPointComponent.trySubscribeToControllerPoses();
-
         // link the mount point entity to the camera
         Location.removeChild(camera, firstPersonHeldItemMountPointComponent.mountPointEntity);
         Location.attachChild(camera, firstPersonHeldItemMountPointComponent.mountPointEntity,
@@ -154,55 +135,46 @@
         }
     }
 
-    /**
-     * Changes held item entity.
-     *
-     * <p>Detaches old held item and removes it's components. Adds components to new held item and
-     * attaches it to the mount point entity.</p>
-     */
-    private void linkHeldItemLocationForLocalPlayer(EntityRef character, EntityRef newItem, EntityRef oldItem) {
+    @ReceiveEvent(netFilter = RegisterMode.CLIENT)
+    public void onLocationRemovedAddClientSideLocation(BeforeDeactivateComponent event, EntityRef entityRef, LocationComponent locationComponent) {
+        // when in a remote client situation,  the remove LocationComponent happens after the CharacterHeldItemComponent is changed.
+        // So this allows re-adding the client side LocationComponent after this
+        if (entityRef.equals(currentHeldItem)) {
+            relinkHeldItem = true;
+        }
+    }
+
+    void linkHeldItemLocationForLocalPlayer(EntityRef character, EntityRef newItem, EntityRef oldItem) {
         if (!newItem.equals(oldItem)) {
             EntityRef camera = localPlayer.getCameraEntity();
             FirstPersonHeldItemMountPointComponent mountPointComponent = camera.getComponent(FirstPersonHeldItemMountPointComponent.class);
             if (mountPointComponent != null) {
-
-                if (clientHeldItem.exists()) {
-                    clientHeldItem.destroy();
-                    clientHeldItem = EntityRef.NULL;
-                }
-
-
                 // remove the location from the old item
                 if (oldItem != null && oldItem.exists()) {
+                    Location.removeChild(mountPointComponent.mountPointEntity, oldItem);
+                    oldItem.removeComponent(LocationComponent.class);
                     oldItem.removeComponent(ItemIsHeldComponent.class);
                 } else {
+                    Location.removeChild(mountPointComponent.mountPointEntity, getHandEntity());
+                    getHandEntity().removeComponent(LocationComponent.class);
                     getHandEntity().removeComponent(ItemIsHeldComponent.class);
                 }
 
                 // use the hand if there is no new item
-                EntityRef heldItem;
-                if (!newItem.exists()) {
+                EntityRef heldItem = newItem;
+                if (!heldItem.exists()) {
                     heldItem = getHandEntity();
-                } else {
-                    heldItem = newItem;
                 }
 
-                // create client side held item entity
-                clientHeldItem = heldItem.copy();
-
-                // remove unneeded/unused components for display only
-                removeUnusedClientHeldComponents(clientHeldItem);
-
-                clientHeldItem.addOrSaveComponent(new LocationComponent());
-
+                //ensure the item has a location
+                heldItem.addOrSaveComponent(new LocationComponent());
                 heldItem.addOrSaveComponent(new ItemIsHeldComponent());
 
-                FirstPersonHeldItemTransformComponent heldItemTransformComponent = clientHeldItem.getComponent(FirstPersonHeldItemTransformComponent.class);
+                FirstPersonHeldItemTransformComponent heldItemTransformComponent = heldItem.getComponent(FirstPersonHeldItemTransformComponent.class);
                 if (heldItemTransformComponent == null) {
                     heldItemTransformComponent = new FirstPersonHeldItemTransformComponent();
-                    clientHeldItem.addComponent(heldItemTransformComponent);
                 }
-                Location.attachChild(mountPointComponent.mountPointEntity, clientHeldItem,
+                Location.attachChild(mountPointComponent.mountPointEntity, heldItem,
                         heldItemTransformComponent.translate,
                         new Quat4f(
                                 TeraMath.DEG_TO_RAD * heldItemTransformComponent.rotateDegrees.y,
@@ -214,38 +186,28 @@
     }
 
     /**
-     * Removes all components from an entity which are not needed for client side rendering of the
-     * held item.
-     * @param heldItem The item from which to remove the components
-     */
-    private void removeUnusedClientHeldComponents(EntityRef heldItem) {
-        Collection<Class<? extends Component>> componentsToRemove = new ArrayList<>();
-        for (Component component : heldItem.iterateComponents()) {
-            if (!NEEDED_COMPONENTS_FOR_RENDERING.contains(component.getClass())) {
-                componentsToRemove.add(component.getClass());
-            }
-        }
-
-        for (Class<? extends Component> componentToRemove : componentsToRemove) {
-            heldItem.removeComponent(componentToRemove);
-        }
-    }
-
-    /**
      * modifies the held item mount point to move the held item in first person view
      */
     @Override
     public void update(float delta) {
-
-        // ensure empty hand is shown if no item is hold at the moment
-        if (!currentHeldItem.exists() && clientHeldItem != getHandEntity()) {
+        // relink the held item if its location got removed from an item transition that removed its location
+        if (relinkHeldItem) {
             linkHeldItemLocationForLocalPlayer(localPlayer.getCharacterEntity(), currentHeldItem, null);
+            relinkHeldItem = false;
         }
 
         // ensure that there are no lingering items that are marked as still held. This situation happens with client side predicted items
         for (EntityRef entityRef : entityManager.getEntitiesWith(ItemIsHeldComponent.class)) {
             if (!entityRef.equals(currentHeldItem) && !entityRef.equals(handEntity)) {
                 entityRef.removeComponent(ItemIsHeldComponent.class);
+
+                // also remove the location if it is currently location linked to the mount point
+                EntityRef camera = localPlayer.getCameraEntity();
+                FirstPersonHeldItemMountPointComponent mountPointComponent = camera.getComponent(FirstPersonHeldItemMountPointComponent.class);
+                LocationComponent locationComponent = entityRef.getComponent(LocationComponent.class);
+                if (mountPointComponent != null && locationComponent != null && locationComponent.getParent().equals(mountPointComponent.mountPointEntity)) {
+                    entityRef.removeComponent(LocationComponent.class);
+                }
             }
         }
 
@@ -270,7 +232,6 @@
         }
         float addPitch = 15f * animateAmount;
         float addYaw = 10f * animateAmount;
-        if (mountPointComponent.rotationQuaternion == null) {
             locationComponent.setLocalRotation(new Quat4f(
                     TeraMath.DEG_TO_RAD * (mountPointComponent.rotateDegrees.y + addYaw),
                     TeraMath.DEG_TO_RAD * (mountPointComponent.rotateDegrees.x + addPitch),
@@ -278,14 +239,6 @@
             Vector3f offset = new Vector3f(0.25f * animateAmount, -0.12f * animateAmount, 0f);
             offset.add(mountPointComponent.translate);
             locationComponent.setLocalPosition(offset);
-        } else {
-            // In the case that we have obtained the quaternion directly, just set it.
-            // Receiving a quaternion directly is also signalling to us that we received
-            // it from OpenVR, so we omit the animation (since we want the item to track
-            // the player's hand.
-            locationComponent.setLocalRotation(mountPointComponent.rotationQuaternion);
-            locationComponent.setLocalPosition(mountPointComponent.translate);
-        }
 
         mountPointComponent.mountPointEntity.saveComponent(locationComponent);
     }",0
fix issue 1731," 
     @Parameter(key = Constants.INVOKER_LISTENER_KEY, append = true)
     public String getListener() {
-        checkMultiExtension(InvokerListener.class, ""listener"", listener);
         return listener;
     }
 
     public void setListener(String listener) {
+        checkMultiExtension(InvokerListener.class, ""listener"", listener);
         this.listener = listener;
     }
 ",0
fixes #178,"     @Override
     protected Table[] doAllTables() throws SQLException {
         List<String> tableNames = jdbcTemplate.queryForStringList(
-                ""SELECT table_name FROM all_tables WHERE owner = ?""
+                // For every table this query will count the number of references (including the transitive ones)
+                // and order the result list using that value.
+                "" SELECT r FROM"" +
+                ""   (SELECT CONNECT_BY_ROOT t r FROM"" +
+                ""     (SELECT DISTINCT c1.table_name f, NVL(c2.table_name, at.table_name) t"" +
+                ""     FROM all_constraints c1"" +
+                ""       RIGHT JOIN all_constraints c2 ON c2.constraint_name = c1.r_constraint_name"" +
+                ""       RIGHT JOIN all_tables at ON at.table_name = c2.table_name"" +
+                ""     WHERE at.owner = ?"" +
                         // Ignore Recycle bin objects
-                        + "" AND table_name NOT LIKE 'BIN$%'""
+                ""       AND at.table_name NOT LIKE 'BIN$%'"" +
                         // Ignore Spatial Index Tables as they get dropped automatically when the index gets dropped.
-                        + "" AND table_name NOT LIKE 'MDRT_%$'""
+                ""       AND at.table_name NOT LIKE 'MDRT_%$'"" +
                         // Ignore Materialized View Logs
-                        + "" AND table_name NOT LIKE 'MLOG$%' AND table_name NOT LIKE 'RUPD$%'""
+                ""       AND at.table_name NOT LIKE 'MLOG$%' AND at.table_name NOT LIKE 'RUPD$%'"" +
                         // Ignore Oracle Text Index Tables
-                        + "" AND table_name NOT LIKE 'DR$%'""
+                ""       AND at.table_name NOT LIKE 'DR$%'"" +
                         // Ignore Index Organized Tables
-                        + "" AND table_name NOT LIKE 'SYS_IOT_OVER_%'""
+                ""       AND at.table_name NOT LIKE 'SYS_IOT_OVER_%'"" +
                         // Ignore Nested Tables
-                        + "" AND nested != 'YES'""
+                ""       AND at.nested != 'YES'"" +
                         // Ignore Nested Tables
-                        + "" AND secondary != 'Y'"", name
-        );
+                ""       AND at.secondary != 'Y')"" +
+                ""   CONNECT BY NOCYCLE PRIOR f = t)"" +
+                "" GROUP BY r"" +
+                "" ORDER BY COUNT(*)"", name);
 
         Table[] tables = new Table[tableNames.size()];
         for (int i = 0; i < tableNames.size(); i++) {",0
Fix GameData.findBlock," 
     static Item findItem(String modId, String name)
     {
-        return (Item)getMain().iItemRegistry.getObject(modId + "":"" + name);
+        return getMain().iItemRegistry.getObject(modId + "":"" + name);
     }
 
     static Block findBlock(String modId, String name)
     {
-        String key = modId + "":"" + name;
-        return getMain().iBlockRegistry.containsKey(key) ? getMain().iBlockRegistry.getObject(key) : null;
+        return getMain().iBlockRegistry.getObject(modId + "":"" + name);
     }
 
     static UniqueIdentifier getUniqueName(Block block)",0
Minor typo fix in attributes merger configuration,"     @ConditionalOnMissingBean(name = ""aggregatingAttributeRepository"")
     public IPersonAttributeDao aggregatingAttributeRepository() {
         val mergingDao = new MergingPersonAttributeDaoImpl();
-        val merger = StringUtils.defaultIfBlank(casProperties.getAuthn().getAttributeRepository().getMerger(), ""replace"".trim());
+        val merger = StringUtils.defaultIfBlank(casProperties.getAuthn().getAttributeRepository().getMerger(), ""replace"").trim();
         LOGGER.trace(""Configured merging strategy for attribute sources is [{}]"", merger);
         mergingDao.setMerger(getAttributeMerger(merger));
 ",0
fixed issue where checking an existing password would fail when using a password encoder,"         }
     }
 
+    protected void checkExistingPassword(String password, AdminUser user, GenericResponse response) {
+        if (!passwordEncoder.isPasswordValid(user.getPassword(), password, getSalt(user))) {
+            response.addErrorCode(""invalidPassword"");
+        }
+    }
+
     protected boolean isTokenExpired(ForgotPasswordSecurityToken fpst) {
         Date now = SystemTime.asDate();
         long currentTimeInMillis = now.getTime();
@@ -388,7 +394,7 @@
 		}
 		checkUser(user, response);
 		checkPassword(password, confirmPassword, response);
-		checkPassword(oldPassword, user.getPassword(), response);
+		checkExistingPassword(oldPassword, user, response);
 
 		if (!response.getHasErrors()) {
 			user.setUnencodedPassword(password);",0
Fixed Error in APTCodeModelHelper #1952," /**
  * Copyright (C) 2010-2016 eBusiness Information, Excilys Group
+ * Copyright (C) 2016 the AndroidAnnotations project
  *
  * Licensed under the Apache License, Version 2.0 (the ""License""); you may not
  * use this file except in compliance with the License. You may obtain a copy of
@@ -293,8 +294,8 @@
 			if (method.name().equals(methodName) && method.params().size() == parameters.size()) {
 				int i = 0;
 				for (JVar param : method.params()) {
-					String searchedParamType = typeMirrorToJClass(parameters.get(i).asType()).name();
-					if (!param.type().name().equals(searchedParamType)) {
+					String searchedParamType = typeMirrorToJClass(parameters.get(i).asType()).fullName();
+					if (!param.type().fullName().equals(searchedParamType)) {
 						continue method;
 					}
 					i++;",0
fix mispelling in javadoc of TcpIpConfig.java,"  * Contains the configuration for the Tcp/Ip join mechanism.
  * <p/>
  * The Tcp/Ip join mechanism relies on one or more well known members. So when a new member wants to join
- * a cluster, it will try to connect to one of the well known members. If it is able to connect, it will now
- * about all members in the cluster and doesn't rely on these well known members anymore.
+ * a cluster, it will try to connect to one of the well known members. If it is able to connect, it will know
+ * about all members in the cluster and won't rely on these well known members anymore.
  */
 public class TcpIpConfig {
 ",0
Don't use HTTP session for manual auth if not set," 				throw new UnsupportedAuthenticationCredentialsException(
 						""Manual authentication credentials should be used for Manual authentication."");
 			}
+			ManualAuthenticationCredentials mc = (ManualAuthenticationCredentials) credentials;
+			HttpSession httpSession = mc.getSelectedSession();
+			if (httpSession == null) {
+				return null;
+			}
+
 			// Build a new WebSession based on the values from the HttpSession
 			// TODO: Changes in either the WebSession or the HttpSession are not
 			// visible in the other
-			ManualAuthenticationCredentials mc = (ManualAuthenticationCredentials) credentials;
 			WebSession session = new CookieBasedSessionManagementMethodType.CookieBasedSession();
-			for (Entry<String, Cookie> v : mc.getSelectedSession().getTokenValuesUnmodifiableMap().entrySet()) {
+			for (Entry<String, Cookie> v : httpSession.getTokenValuesUnmodifiableMap().entrySet()) {
 				session.getHttpState().addCookie(v.getValue());
 			}
 			return session;",0
Fix bugs in WrappingVariablesMap introduced when adding targetRemovedKeys field," import java.util.ArrayList;
 import java.util.Collection;
 import java.util.Collections;
+import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Map;
 import java.util.Set;
@@ -53,18 +54,19 @@
     WrappingVariablesMap(VariablesMap<K, V> targetMap) {
         super();
         this.targetMap = targetMap;
-        this.targetRemovedKeys = null;
     }
 
 
     @Override
     public int size() {
-        return super.size() + this.targetMap.size();
+        return super.size() + this.targetMap.size() -
+                (this.targetRemovedKeys == null ? 0 : this.targetRemovedKeys.size());
     }
 
     @Override
     public boolean isEmpty() {
-        return super.isEmpty() && this.targetMap.isEmpty();
+        return super.isEmpty() && (this.targetMap.isEmpty() ||
+                this.targetRemovedKeys != null && this.targetRemovedKeys.size() == this.targetMap.size());
     }
 
     @Override
@@ -72,6 +74,9 @@
         if (super.containsKey(key)) {
             return true;
         }
+        if (containsRemovedKey(key)) {
+            return false;
+        }
         return this.targetMap.containsKey(key);
     }
 
@@ -80,40 +85,71 @@
         if (super.containsValue(value)) {
             return true;
         }
+        if (this.targetRemovedKeys == null) {
         return this.targetMap.containsValue(value);
     }
+        for (Map.Entry<K, V> targetEntry : targetMap.entrySet()) {
+            if (!containsRemovedKey(targetEntry.getKey())) {
+                if (value == null) {
+                    if (targetEntry.getValue() == null) {
+                        return true;
+                    }
+                } else if (value.equals(targetEntry.getValue())) {
+                    return true;
+                }
+            }
+        }
+        return false;
+    }
 
     @Override
     public V get(Object key) {
         if (super.containsKey(key)) {
             return super.get(key);
         }
+        if (containsRemovedKey(key)) {
+            return null;
+        }
         return this.targetMap.get(key);
     }
 
     @Override
+    public V put(K key, V value) {
+        V oldValue = super.put(key, value);
+        if (oldValue == null && targetMap.containsKey(key)) {
+            // ensure that we properly override by marking the target key as removed
+            if (targetRemovedKeys == null) {
+                targetRemovedKeys = new HashSet<K>(3);
+            } else if (!targetRemovedKeys.contains(key)) {
+                oldValue = targetMap.get(key);
+            }
+            targetRemovedKeys.add(key);
+        }
+        return oldValue;
+    }
+
+    @Override
     public V remove(Object key) {
         if (super.containsKey(key)) {
             return super.remove(key);
         }
-        if (this.targetRemovedKeys != null && this.targetRemovedKeys.contains(key)) {
+        if (containsRemovedKey(key)) {
             return null;
         }
         if (this.targetMap.containsKey(key)) {
             if (this.targetRemovedKeys == null) {
                 this.targetRemovedKeys = new HashSet<K>(3);
             }
-            this.targetRemovedKeys.add((K) key);
+            if (this.targetRemovedKeys.add((K) key)) {
+                return targetMap.get(key);
+            }
         }
         return null;
     }
 
     @Override
     public void clear() {
-        if (this.targetRemovedKeys == null) {
-            this.targetRemovedKeys = new HashSet<K>(3);
-        }
-        this.targetRemovedKeys.addAll(this.targetMap.keySet());
+        this.targetRemovedKeys = new HashSet<K>(this.targetMap.keySet());
         super.clear();
     }
 
@@ -134,6 +170,9 @@
             return super.keySet();
         }
         final Set<K> keySet = new HashSet<K>(targetKeySet);
+        if (targetRemovedKeys != null) {
+            keySet.removeAll(targetRemovedKeys);
+        }
         keySet.addAll(super.keySet());
         return Collections.unmodifiableSet(keySet);
     }
@@ -147,17 +186,27 @@
      */
     @Override
     public Collection<V> values() {
-        final Collection<V> targetValues = this.targetMap.values();
-        if (targetValues.isEmpty()) {
+        if (this.targetMap.isEmpty()) {
             return super.values();
         }
-        final Collection<V> values = new ArrayList<V>(targetValues);
+        final Collection<V> values;
+        if (targetRemovedKeys == null) {
+            values = new ArrayList<V>(targetMap.values());
+        } else {
+            final Set<Map.Entry<K, V>> targetEntrySet = this.targetMap.entrySet();
+            values = new ArrayList<V>(targetEntrySet.size() + super.size() - targetRemovedKeys.size());
+            for (Map.Entry<K, V> targetEntry : targetEntrySet) {
+                if (!targetRemovedKeys.contains(targetEntry.getKey())) {
+                    values.add(targetEntry.getValue());
+                }
+            }
+        }
         values.addAll(super.values());
         return Collections.unmodifiableCollection(values);
     }
 
     /**
-     * This violates the Map contract because it returns a read-only Set, not a mutable Sne
+     * This violates the Map contract because it returns a read-only Set, not a mutable Set
      * that reflects the underlying table, unless the wrapped map is empty.
      *
      * @return immutable Set containing the union of the wrapped map's entrySet and this map's entrySet,
@@ -165,11 +214,17 @@
      */
     @Override
     public Set<Map.Entry<K, V>> entrySet() {
-        final Set<Map.Entry<K, V>> targetEntrySet = targetMap.entrySet();
-        if (targetEntrySet.isEmpty()) {
+        final Set<Map.Entry<K, V>> entrySet;
+        if (targetRemovedKeys == null) {
+            entrySet = new HashSet<Map.Entry<K, V>>(targetMap.entrySet());
+        } else {
+            HashMap<K, V> targetMapCopy = new HashMap<K, V>(targetMap);
+            targetMapCopy.keySet().removeAll(targetRemovedKeys);
+            entrySet = targetMapCopy.entrySet();
+        }
+        if (entrySet.isEmpty()) {
             return super.entrySet();
         }
-        final Set<Map.Entry<K, V>> entrySet = new HashSet<Map.Entry<K, V>>(targetEntrySet);
         entrySet.addAll(super.entrySet());
         return Collections.unmodifiableSet(entrySet);
     }
@@ -180,4 +235,8 @@
         return (WrappingVariablesMap) super.clone();
     }
 
+
+    private boolean containsRemovedKey(Object key) {
+        return this.targetRemovedKeys != null && this.targetRemovedKeys.contains(key);
+    }
 }",0
-fixed bug in rewriting applicationId with old value,"                 } else {
                     applicationId = appIdString;
                 }
-
-                applicationId = (String) appId;
             } else if (appId instanceof Integer) {
                 throw new FacebookException(
                         ""App Ids cannot be directly placed in the manfiest."" +
-                        ""They mut be prexied by 'fb' or be placed in the string resource file."");
+                                ""They must be prefixed by 'fb' or be placed in the string resource file."");
             }
         }
 ",0
Fix CLI to abort query when pager exits,"                 // ignore the user pressing ctrl-C while in the pager
                 ignoreUserInterrupt.set(true);
                 pager.getFinishFuture().thenRun(() -> {
-                    userAbortedQuery.set(true);
                     ignoreUserInterrupt.set(false);
+                    userAbortedQuery.set(true);
+                    client.close();
                     clientThread.interrupt();
                 });
             }",0
fix #3088 - fixes boolean @type annotation,"         dms.put(""string_date-time"", ""date-time"");
         dms.put(""string_partial-time"", ""partial-time"");
         dms.put(""string_password"", ""password"");
-        dms.put(""boolean"", ""boolean"");
+        dms.put(""boolean_"", ""boolean"");
         dms.put(""object_"", ""object"");
         datatypeMappings = Collections.unmodifiableMap(dms);
 ",0
Fix a NPE in CommonJS modules.,"             Var typeDeclaration = t.getScope().getVar(baseName);
 
             // Make sure we can find a variable declaration (and it's in this file)
-            if (typeDeclaration != null
+            if (typeDeclaration != null && typeDeclaration.getNode() != null
                 && Objects.equals(typeDeclaration.getNode().getInputId(), typeNode.getInputId())) {
               String importedModuleName = getModuleImportName(t, typeDeclaration.getNode());
 ",0
#1369 Support null executor in NettyResponseFuture#addListener," 
     public final void abort(final Throwable t) {
 
-        future.completeExceptionally(t);
-
         if (terminateAndExit())
             return;
 
+        future.completeExceptionally(t);
+
         if (onThrowableCalledField.compareAndSet(this, 0, 1)) {
             try {
                 asyncHandler.onThrowable(t);
@@ -256,6 +256,9 @@
 
     @Override
     public ListenableFuture<V> addListener(Runnable listener, Executor exec) {
+        if (exec == null) {
+            exec = Runnable::run;
+        }
         future.whenCompleteAsync((r, v) -> listener.run(), exec);
         return this;
     }",0
Fix: SignleTop launch mode," 					}
 				}
 			} break;
+			case ONLY_TOP : {
+				marked = false;
+			} break;
 		}
 
 		return marked;
@@ -239,7 +242,7 @@
 
 		switch (info.launchMode) {
 			case LAUNCH_SINGLE_TOP : {
-				clearTarget = ClearTarget.AFTER_TOP;
+				clearTarget = ClearTarget.ONLY_TOP;
 				if (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {
 					reuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
 							? ReuseTarget.MULTIPLE
@@ -593,7 +596,9 @@
 		NOTHING,
 		SPEC_ACTIVITY,
 		FULL_TASK(true),
-		AFTER_TOP(true);
+		AFTER_TOP(true),
+		ONLY_TOP(true);
+
 		boolean deliverIntent;
 
 		ClearTarget() {",0
Fixed comment typo in Music class,"  * </p>
  * 
  * <p>
- * <b>Note<b>: any values provided will not be clamped, it is the developer's responsibility to do so
+ * <b>Note</b>: any values provided will not be clamped, it is the developer's responsibility to do so
  * </p>
  * 
  * @author mzechner */",0
修复了因为异常而终止了Merge时候出现的空指针Bug," 	}
 
 	private boolean handleRowData(String dataNode, byte[] rowData) {
+		if(temniated)
+		{
+			return true;
+		}
 		RowDataPacket rowDataPkg = new RowDataPacket(fieldCount);
 		rowDataPkg.read(rowData);
 		if (grouper != null) {
@@ -314,11 +318,12 @@
 		if (LOGGER.isDebugEnabled()) {
 			LOGGER.debug(""clear data "");
 		}
-		temniated = true;
+		
 		grouper = null;
 		sorter = null;
 		result = null;
 		jobQueue.clear();
+		temniated = true;
 	}
 
 }",0
Fixed Matrix4.setAll method to set axis vecs to columns instead of rows," 	 * @return A reference to this {@link Matrix4} to facilitate chaining.
 	 */
 	public Matrix4 setAll(final Vector3 xAxis, final Vector3 yAxis, final Vector3 zAxis, final Vector3 pos) {
-		m[M00] = xAxis.x; m[M01] = xAxis.y; m[M02] = xAxis.z;
-		m[M10] = yAxis.x; m[M11] = yAxis.y; m[M12] = yAxis.z;
-		m[M20] = -zAxis.x; m[M21] = -zAxis.y; m[M22] = -zAxis.z;
-		m[M03] = pos.x; m[M13] = pos.y; m[M23] = pos.z;
+		m[M00] = xAxis.x;	m[M01] = yAxis.x;	m[M02] = zAxis.x;	m[M03] = pos.x;
+		m[M10] = xAxis.y; 	m[M11] = yAxis.y;	m[M12] = zAxis.y;	m[M13] = pos.y;
+		m[M20] = xAxis.z;	m[M21] = yAxis.z;	m[M22] = zAxis.z;	m[M23] = pos.z;
 		m[M30] = 0; m[M31] = 0; m[M32] = 0; m[M33] = 1;
 		return this;
 	}",0
Fix --js_module_root in CommandLineRunner.,"       hidden = true,
       usage = ""Path prefix to be removed from CommonJS module names.""
     )
-    private List<String> commonJsPathPrefix =
-        ImmutableList.of(ES6ModuleLoader.DEFAULT_FILENAME_PREFIX);
+    private List<String> commonJsPathPrefix = new ArrayList<>();
 
     @Option(
       name = ""--js_module_root"",
       hidden = true,
       usage = ""Path prefixes to be removed from ES6 & CommonJS modules.""
     )
-    private List<String> moduleRoot = ImmutableList.of(ES6ModuleLoader.DEFAULT_FILENAME_PREFIX);
+    private List<String> moduleRoot = new ArrayList<>();
 
     @Option(name = ""--common_js_entry_module"",
         hidden = true,
@@ -1056,7 +1055,11 @@
 
       // For backwards compatibility, allow both commonJsPathPrefix and jsModuleRoot.
       List<String> moduleRoots = new ArrayList<>(flags.commonJsPathPrefix);
+      if (!flags.moduleRoot.isEmpty()) {
       moduleRoots.addAll(flags.moduleRoot);
+      } else {
+        moduleRoots.add(ES6ModuleLoader.DEFAULT_FILENAME_PREFIX);
+      }
 
       getCommandLineConfig()
           .setPrintTree(flags.printTree)",0
全局表的delete和update紧急Bug," 		if(retNodesSet != null && retNodesSet.size() > 0) {
 			if(retNodesSet.size() > 1 && isAllGlobalTable(ctx, schema)) {
 				// mulit routes ,not cache route result
+				if (isSelect) {
 				rrs.setCacheAble(false);
 				routeToSingleNode(rrs, retNodesSet.iterator().next(), ctx.getSql());
+				}
+				else {
+					routeToMultiNode(isSelect, rrs, retNodesSet, ctx.getSql());
+				}
+				
 			} else {
 				routeToMultiNode(isSelect, rrs, retNodesSet, ctx.getSql());
 			}",0
fix empty author endpoint," import android.view.ViewGroup;
 import android.widget.TextView;
 
+import org.jsoup.helper.StringUtil;
 import org.schabi.newpipe.R;
 import org.schabi.newpipe.extractor.InfoItem;
 import org.schabi.newpipe.extractor.comments.CommentsInfoItem;
@@ -76,6 +77,7 @@
         itemThumbnailView.setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View view) {
+                if(StringUtil.isBlank(item.getAuthorEndpoint())) return;
                 try {
                     final AppCompatActivity activity = (AppCompatActivity) itemBuilder.getContext();
                     NavigationHelper.openChannelFragment(",0
Fixed Error When Parsing Content ID," import android.content.Context;
 import android.preference.PreferenceManager;
 import android.util.Log;
+
 import com.google.android.mms.ContentType;
 import com.google.android.mms.MmsException;
 import com.google.android.mms.pdu_alt.PduBody;
 import com.google.android.mms.pdu_alt.PduPart;
 import com.moez.QKSMS.LogTag;
 import com.moez.QKSMS.MmsConfig;
+
 import org.json.JSONArray;
 import org.json.JSONObject;
 import org.w3c.dom.smil.SMILMediaElement;
@@ -42,16 +44,17 @@
 
 public class MediaModelFactory {
     private static final String TAG = ""Mms:media"";
+    private static final boolean LOCAL_LOGV = false;
 
     /**
      * Returns the media model for the given SMILMediaElement in the PduBody.
      *
-     * @param context
+     * @param context Context
      * @param sme The SMILMediaElement to find
-     * @param srcs
-     * @param layouts
-     * @param pb
-     * @return
+     * @param srcs    String array of sources
+     * @param layouts LayoutModel
+     * @param pb      PduBuddy
+     * @return MediaModel
      * @throws IOException
      * @throws IllegalArgumentException
      * @throws MmsException
@@ -93,7 +96,6 @@
      *
      * We employ several methods of pairing src strings up to parts, using certain patterns we've
      * seen in failed MMS messages. These are described in this method.
-     *
      * TODO TODO TODO: Create a testing suite for this!
      */
     private static PduPart findPart(final Context context, PduBody pb, String src,
@@ -318,7 +320,17 @@
         if (src == null) {
             return -1;
         } else {
-            return Long.parseLong(src.substring(""cid:"".length()));
+            if (LOCAL_LOGV) {
+                Log.v(TAG, ""Initial contentId: "" + src);
+            }
+            src = src.substring(""cid:"".length());
+            src = unescapeXML(src);
+            // Strip any leading < or trailing > ... they are present sometimes and causing error(s)
+            src = src.replaceAll(""(^\\<)|(\\>$)"", """");
+            if (LOCAL_LOGV) {
+                Log.v(TAG, ""Final contentId: "" + src);
+            }
+            return Long.parseLong(src);
         }
     }
 
@@ -364,7 +376,7 @@
                 return getGenericMediaModel(context, tag, src, srme, part, region);
             }
         } else {
-            String rId = null;
+            String rId;
 
             if (tag.equals(SmilHelper.ELEMENT_TAG_TEXT)) {
                 rId = LayoutModel.TEXT_REGION_ID;
@@ -398,20 +410,26 @@
         }
 
         String contentType = new String(bytes);
-        MediaModel media = null;
-        if (tag.equals(SmilHelper.ELEMENT_TAG_TEXT)) {
+        MediaModel media;
+
+        switch (tag) {
+            case SmilHelper.ELEMENT_TAG_TEXT:
             media = new TextModel(context, contentType, src,
                     part.getCharset(), part.getData(), regionModel);
-        } else if (tag.equals(SmilHelper.ELEMENT_TAG_IMAGE)) {
+                break;
+            case SmilHelper.ELEMENT_TAG_IMAGE:
             media = new ImageModel(context, contentType, src,
                     part.getDataUri(), regionModel);
-        } else if (tag.equals(SmilHelper.ELEMENT_TAG_VIDEO)) {
+                break;
+            case SmilHelper.ELEMENT_TAG_VIDEO:
             media = new VideoModel(context, contentType, src,
                     part.getDataUri(), regionModel);
-        } else if (tag.equals(SmilHelper.ELEMENT_TAG_AUDIO)) {
+                break;
+            case SmilHelper.ELEMENT_TAG_AUDIO:
             media = new AudioModel(context, contentType, src,
                     part.getDataUri());
-        } else if (tag.equals(SmilHelper.ELEMENT_TAG_REF)) {
+                break;
+            case SmilHelper.ELEMENT_TAG_REF:
             if (ContentType.isTextType(contentType)) {
                 media = new TextModel(context, contentType, src,
                         part.getCharset(), part.getData(), regionModel);
@@ -429,7 +447,8 @@
                         + contentType);
                 media = createEmptyTextModel(context, regionModel);
             }
-        } else {
+                break;
+            default:
             throw new IllegalArgumentException(""Unsupported TAG: "" + tag);
         }
 
@@ -453,12 +472,10 @@
                 if (t.getTimeType() != Time.SMIL_TIME_INDEFINITE) {
                     duration = (int) (t.getResolvedOffset() * 1000) - begin;
 
-                    if (duration == 0 &&
-                            (media instanceof AudioModel || media instanceof VideoModel)) {
+                    if (duration == 0 && (media instanceof AudioModel || media instanceof VideoModel)) {
                         duration = MmsConfig.getMinimumSlideElementDuration();
-                        if (Log.isLoggable(LogTag.APP, Log.VERBOSE)) {
-                            Log.d(TAG, ""[MediaModelFactory] compute new duration for "" + tag +
-                                    "", duration="" + duration);
+                        if (Log.isLoggable(TAG, Log.VERBOSE)) {
+                            Log.v(TAG, ""[MediaModelFactory] compute new duration for "" + tag + "", duration="" + duration);
                         }
                     }
                 }
@@ -474,7 +491,7 @@
              * If not, the media will disappear while rotating the screen
              * in the slide show play view.
              */
-            media.setFill(sme.FILL_FREEZE);
+            media.setFill(SMILMediaElement.FILL_FREEZE);
         } else {
             // Set 'fill' property.
             media.setFill(sme.getFill());",0
Fix unregistered double input in approx_percentile," import com.facebook.presto.operator.aggregation.ApproximateCountColumnAggregations;
 import com.facebook.presto.operator.aggregation.ApproximateCountDistinctAggregations;
 import com.facebook.presto.operator.aggregation.ApproximateDoublePercentileAggregations;
+import com.facebook.presto.operator.aggregation.ApproximateDoublePercentileArrayAggregations;
 import com.facebook.presto.operator.aggregation.ApproximateLongPercentileAggregations;
 import com.facebook.presto.operator.aggregation.ApproximateLongPercentileArrayAggregations;
 import com.facebook.presto.operator.aggregation.ApproximateSetAggregation;
@@ -297,6 +298,7 @@
                 .aggregate(ApproximateLongPercentileAggregations.class)
                 .aggregate(ApproximateLongPercentileArrayAggregations.class)
                 .aggregate(ApproximateDoublePercentileAggregations.class)
+                .aggregate(ApproximateDoublePercentileArrayAggregations.class)
                 .aggregate(CountIfAggregation.class)
                 .aggregate(BooleanAndAggregation.class)
                 .aggregate(BooleanOrAggregation.class)",0
Fixed wrong method call in ChunkIOProvider.,"     public void callStage2(QueuedChunk queuedChunk, net.minecraft.world.chunk.Chunk chunk) throws RuntimeException {
         if(chunk == null) {
             // If the chunk loading failed just do it synchronously (may generate)
-            queuedChunk.provider.loadChunk(queuedChunk.x, queuedChunk.z);
+            queuedChunk.provider.originalLoadChunk(queuedChunk.x, queuedChunk.z);
             return;
         }
 ",0
TooTallNate#171,"  */
 package org.java_websocket;
 
+import javax.net.ssl.SSLEngine;
+import javax.net.ssl.SSLEngineResult;
+import javax.net.ssl.SSLEngineResult.HandshakeStatus;
+import javax.net.ssl.SSLEngineResult.Status;
+import javax.net.ssl.SSLException;
+import javax.net.ssl.SSLSession;
+import java.io.EOFException;
 import java.io.IOException;
 import java.net.Socket;
 import java.net.SocketAddress;
@@ -20,13 +27,6 @@
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Future;
 
-import javax.net.ssl.SSLEngine;
-import javax.net.ssl.SSLEngineResult;
-import javax.net.ssl.SSLEngineResult.HandshakeStatus;
-import javax.net.ssl.SSLEngineResult.Status;
-import javax.net.ssl.SSLException;
-import javax.net.ssl.SSLSession;
-
 /**
  * Implements the relevant portions of the SocketChannel interface with the SSLEngine wrapper.
  */
@@ -213,6 +213,9 @@
 		//	createBuffers( sslEngine.getSession() );
 		//}
 		int num = socketChannel.write( wrap( src ) );
+        if (writeEngineResult.getStatus() == SSLEngineResult.Status.CLOSED) {
+            throw new EOFException(""Connection is closed"");
+        }
 		return num;
 
 	}
@@ -286,6 +289,9 @@
 		if( inCrypt.hasRemaining() ) {
 			unwrap();
 			int amount = transfereTo( inData, dst );
+            if (readEngineResult.getStatus() == SSLEngineResult.Status.CLOSED) {
+                return -1;
+            }
 			if( amount > 0 )
 				return amount;
 		}",0
Add normal colour to the !clues command," 			}
 
 			ChatMessageBuilder chatMessageBuilder = new ChatMessageBuilder()
+				.append(ChatColorType.NORMAL)
 				.append(""Clue scroll ("" + level + "")"").append("": "")
 				.append(ChatColorType.HIGHLIGHT)
 				.append(Integer.toString(quantity));",0
Fix unneeded scroll bar display in code completion suggestion box," 
     float h = itemHeight * (itemCount);
 
+    if (itemCount >= 4)
+    	h += itemHeight * 0.3; // a bit of offset
+
     return Math.min(maxHeight, (int) h); // popup menu height
   }
   ",0
Fix in ServerCnx to prevent using recycled commands,"     @Override
     protected void handleLookup(CommandLookupTopic lookup) {
         final long requestId = lookup.getRequestId();
-
+        final boolean authoritative = lookup.getAuthoritative();
         if (log.isDebugEnabled()) {
             log.debug(""[{}] Received Lookup from {} for {}"", lookup.getTopic(), remoteAddress, requestId);
         }
@@ -253,9 +253,9 @@
             String finalOriginalPrincipal = originalPrincipal;
             isProxyAuthorizedFuture.thenApply(isProxyAuthorized -> {
                 if (isProxyAuthorized) {
-                    lookupDestinationAsync(getBrokerService().pulsar(), topicName, lookup.getAuthoritative(),
+                    lookupDestinationAsync(getBrokerService().pulsar(), topicName, authoritative,
                             finalOriginalPrincipal != null ? finalOriginalPrincipal : authRole, authenticationData,
-                            lookup.getRequestId()).handle((lookupResponse, ex) -> {
+                            requestId).handle((lookupResponse, ex) -> {
                                 if (ex == null) {
                                     ctx.writeAndFlush(lookupResponse);
                                 } else {
@@ -549,7 +549,7 @@
                 subscribe.getStartMessageId().getLedgerId(), subscribe.getStartMessageId().getEntryId(),
                 subscribe.getStartMessageId().getPartition(), subscribe.getStartMessageId().getBatchIndex())
                 : null;
-
+        final String subscription = subscribe.getSubscription();
         final int priorityLevel = subscribe.hasPriorityLevel() ? subscribe.getPriorityLevel() : 0;
         final boolean readCompacted = subscribe.getReadCompacted();
         final Map<String, String> metadata = CommandUtils.metadataFromCommand(subscribe);
@@ -567,7 +567,7 @@
                 if (service.isAuthorizationEnabled()) {
                     authorizationFuture = service.getAuthorizationService().canConsumeAsync(topicName,
                             originalPrincipal != null ? originalPrincipal : authRole, authenticationData,
-                            subscribe.getSubscription());
+                            subscription);
                 } else {
                     authorizationFuture = CompletableFuture.completedFuture(true);
                 }
@@ -994,13 +994,13 @@
     @Override
     protected void handleSeek(CommandSeek seek) {
         checkArgument(state == State.Connected);
-
+        final long requestId = seek.getRequestId();
         CompletableFuture<Consumer> consumerFuture = consumers.get(seek.getConsumerId());
 
         // Currently only seeking on a message id is supported
         if (!seek.hasMessageId()) {
             ctx.writeAndFlush(
-                    Commands.newError(seek.getRequestId(), ServerError.MetadataError, ""Message id was not present""));
+                    Commands.newError(requestId, ServerError.MetadataError, ""Message id was not present""));
             return;
         }
 
@@ -1010,7 +1010,7 @@
             MessageIdData msgIdData = seek.getMessageId();
 
             Position position = new PositionImpl(msgIdData.getLedgerId(), msgIdData.getEntryId());
-            long requestId = seek.getRequestId();
+            
 
             subscription.resetCursor(position).thenRun(() -> {
                 log.info(""[{}] [{}][{}] Reset subscription to message id {}"", remoteAddress,
@@ -1018,12 +1018,12 @@
                 ctx.writeAndFlush(Commands.newSuccess(requestId));
             }).exceptionally(ex -> {
                 log.warn(""[{}][{}] Failed to reset subscription: {}"", remoteAddress, subscription, ex.getMessage(), ex);
-                ctx.writeAndFlush(Commands.newError(seek.getRequestId(), ServerError.UnknownError,
+                ctx.writeAndFlush(Commands.newError(requestId, ServerError.UnknownError,
                         ""Error when resetting subscription: "" + ex.getCause().getMessage()));
                 return null;
             });
         } else {
-            ctx.writeAndFlush(Commands.newError(seek.getRequestId(), ServerError.MetadataError, ""Consumer not found""));
+            ctx.writeAndFlush(Commands.newError(requestId, ServerError.MetadataError, ""Consumer not found""));
         }
     }
 ",0
"[fix] If requestLayout() call, will reset children bounds.","     private List<SwipeDenier> mSwipeDeniers = new ArrayList<>();
     private Map<View, ArrayList<OnRevealListener>> mRevealListeners = new HashMap<>();
     private Map<View, Boolean> mShowEntirely = new HashMap<>();
+    private Map<View, Rect> mViewBoundCache = new HashMap<>();//save all children's bound, restore in onLayout
 
     private DoubleClickListener mDoubleClickListener;
 
@@ -392,10 +393,36 @@
             dispatchSwipeEvent(evLeft, evTop, dx, dy);
 
             invalidate();
+
+            captureChildrenBound();
         }
     };
 
     /**
+     * save children's bounds, so they can restore the bound in {@link #onLayout(boolean, int, int, int, int)}
+     */
+    private void captureChildrenBound(){
+        View currentBottomView = getCurrentBottomView();
+        if(getOpenStatus()==Status.Close){
+            mViewBoundCache.remove(currentBottomView);
+            return;
+        }
+
+        View[] views = new View[]{getSurfaceView(), currentBottomView};
+        for (View child : views) {
+            Rect rect = mViewBoundCache.get(child);
+            if(rect==null){
+                rect = new Rect();
+                mViewBoundCache.put(child, rect);
+            }
+            rect.left = child.getLeft();
+            rect.top = child.getTop();
+            rect.right = child.getRight();
+            rect.bottom = child.getBottom();
+        }
+    }
+
+    /**
      * the dispatchRevealEvent method may not always get accurate position, it
      * makes the view may not always get the event when the view is totally
      * show( fraction = 1), so , we need to calculate every time.
@@ -763,30 +790,34 @@
     }
 
     void layoutPullOut() {
-        Rect rect = computeSurfaceLayoutArea(false);
         View surfaceView = getSurfaceView();
+        Rect surfaceRect = mViewBoundCache.get(surfaceView);
+        if(surfaceRect == null) surfaceRect = computeSurfaceLayoutArea(false);
         if (surfaceView != null) {
-            surfaceView.layout(rect.left, rect.top, rect.right, rect.bottom);
+            surfaceView.layout(surfaceRect.left, surfaceRect.top, surfaceRect.right, surfaceRect.bottom);
             bringChildToFront(surfaceView);
         }
-        rect = computeBottomLayoutAreaViaSurface(ShowMode.PullOut, rect);
         View currentBottomView = getCurrentBottomView();
+        Rect bottomViewRect = mViewBoundCache.get(currentBottomView);
+        if(bottomViewRect == null) bottomViewRect = computeBottomLayoutAreaViaSurface(ShowMode.PullOut, surfaceRect);
         if (currentBottomView != null) {
-            currentBottomView.layout(rect.left, rect.top, rect.right, rect.bottom);
+            currentBottomView.layout(bottomViewRect.left, bottomViewRect.top, bottomViewRect.right, bottomViewRect.bottom);
         }
     }
 
     void layoutLayDown() {
-        Rect rect = computeSurfaceLayoutArea(false);
         View surfaceView = getSurfaceView();
+        Rect surfaceRect = mViewBoundCache.get(surfaceView);
+        if(surfaceRect == null) surfaceRect = computeSurfaceLayoutArea(false);
         if (surfaceView != null) {
-            surfaceView.layout(rect.left, rect.top, rect.right, rect.bottom);
+            surfaceView.layout(surfaceRect.left, surfaceRect.top, surfaceRect.right, surfaceRect.bottom);
             bringChildToFront(surfaceView);
         }
-        rect = computeBottomLayoutAreaViaSurface(ShowMode.LayDown, rect);
         View currentBottomView = getCurrentBottomView();
+        Rect bottomViewRect = mViewBoundCache.get(currentBottomView);
+        if(bottomViewRect == null) bottomViewRect = computeBottomLayoutAreaViaSurface(ShowMode.LayDown, surfaceRect);
         if (currentBottomView != null) {
-            currentBottomView.layout(rect.left, rect.top, rect.right, rect.bottom);
+            currentBottomView.layout(bottomViewRect.left, bottomViewRect.top, bottomViewRect.right, bottomViewRect.bottom);
         }
     }
 ",0
Fix small copy-paste error + tiny typo in Advanced Copy dialog," 
             copyHeaderCheck = UIUtils.createCheckbox(group, ""Copy header"", null, copySettings.isCopyHeader(), 2);
             copyRowsCheck = UIUtils.createCheckbox(group, ""Copy row numbers"", null, copySettings.isCopyRowNumbers(), 2);
-            quoteCellsCheck = UIUtils.createCheckbox(group, ""Quote cell values"", ""Place cell value in quotes it it contains column or row delimiter"", copySettings.isCopyRowNumbers(), 2);
+            quoteCellsCheck = UIUtils.createCheckbox(group, ""Quote cell values"", ""Place cell value in quotes if it contains column or row delimiter"", copySettings.isQuoteCells(), 2);
 
             UIUtils.createControlLabel(group, ""Format"");
             formatCombo = new Combo(group, SWT.BORDER | SWT.DROP_DOWN | SWT.READ_ONLY);
@@ -196,6 +196,7 @@
 
             settings.put(PARAM_COPY_HEADER, copySettings.isCopyHeader());
             settings.put(PARAM_COPY_ROWS, copySettings.isCopyRowNumbers());
+            settings.put(PARAM_QUOTE_CELLS, copySettings.isQuoteCells());
             settings.put(PARAM_FORMAT, format.name());
             settings.put(PARAM_COL_DELIMITER, copySettings.getColumnDelimiter());
             settings.put(PARAM_ROW_DELIMITER, copySettings.getRowDelimiter());",0
Fix: install error above Android N (support FileProvider)," import com.lody.virtual.helper.utils.BitmapUtils;
 import com.lody.virtual.helper.utils.ComponentUtils;
 import com.lody.virtual.helper.utils.DrawableUtils;
+import com.lody.virtual.helper.utils.FileUtils;
 import com.lody.virtual.helper.utils.Reflect;
 import com.lody.virtual.helper.utils.VLog;
 import com.lody.virtual.os.VUserHandle;
@@ -63,6 +64,10 @@
 import com.lody.virtual.server.interfaces.IAppRequestListener;
 
 import java.io.File;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.OutputStream;
 import java.lang.ref.WeakReference;
 import java.lang.reflect.Method;
 import java.util.List;
@@ -360,6 +365,7 @@
 
         private static final String SCHEME_FILE = ""file"";
         private static final String SCHEME_PACKAGE = ""package"";
+        private static final String SCHEME_CONTENT = ""content"";
 
         @Override
         public String getMethodName() {
@@ -475,6 +481,32 @@
                     } catch (RemoteException e) {
                         e.printStackTrace();
                     }
+                } else if (SCHEME_CONTENT.equals(packageUri.getScheme())){
+                    InputStream inputStream = null;
+                    OutputStream outputStream = null;
+                    File sharedFileCopy = new File(getHostContext().getCacheDir(), packageUri.getLastPathSegment());
+                    try {
+                        inputStream = getHostContext().getContentResolver().openInputStream(packageUri);
+                        outputStream = new FileOutputStream(sharedFileCopy);
+                        byte[] buffer = new byte[1024];
+                        int count;
+                        while ((count = inputStream.read(buffer)) > 0) {
+                            outputStream.write(buffer, 0, count);
+                        }
+                        outputStream.flush();
+
+                    } catch (IOException e) {
+                        e.printStackTrace();
+                    } finally {
+                        FileUtils.closeQuietly(inputStream);
+                        FileUtils.closeQuietly(outputStream);
+                    }
+                    try {
+                        listener.onRequestInstall(sharedFileCopy.getPath());
+                        return true;
+                    } catch (RemoteException e) {
+                        e.printStackTrace();
+                    }
                 }
 
             }",0
fix an exception,"     public boolean cancel(boolean mayInterruptIfRunning) {
         isCancelled = true;
         if (mayInterruptIfRunning && request != null && !request.isAborted()) {
+            new Thread(new Runnable() {
+                @Override
+                public void run() {
             request.abort();
         }
+            });
+        }
         return isCancelled();
     }
 }",0
Fix for #2518," package org.terasology.world.block.entity;
 
 import com.google.common.base.Joiner;
+import com.google.common.base.Strings;
 import com.google.common.collect.Lists;
 import org.terasology.assets.ResourceUrn;
 import org.terasology.assets.management.AssetManager;
@@ -60,7 +61,7 @@
 import java.util.List;
 import java.util.Optional;
 import java.util.Set;
-
+import java.util.stream.Collectors;
 
 @RegisterSystem
 @Share(BlockCommands.class)
@@ -233,6 +234,37 @@
 
     }
 
+    @Command(shortDescription = ""Gives multiple stacks of blocks matching a search"",
+            helpText = ""Adds all blocks that match the search parameter into your inventory"",
+            runOnServer = true, requiredPermission = PermissionManager.CHEAT_PERMISSION)
+    public String bulkGiveBlock(
+            @Sender EntityRef sender,
+            @CommandParam(""searched"") String searched) {
+        String searchLowercase = searched.toLowerCase();
+        List<String> blocks = findBlockMatches(searchLowercase);
+        String result = ""Found "" + blocks.size() + "" block matches when searching for '"" + searched + ""'."";
+        if (blocks.size() > 0) {
+            result += ""\nBlocks:"";
+            for (String block : blocks) {
+                result += ""\n"" + block;
+                giveBlock(sender, block, null, null);
+            }
+        }
+        return result;
+    }
+
+    private List<String> findBlockMatches(String searchLowercase) {
+        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)
+                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))
+                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))
+                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());
+    }
+
+    private static boolean matchesSearch(String searchLowercase, BlockFamilyDefinition def) {
+        return def.getUrn().toString().toLowerCase().contains(searchLowercase);
+    }
+
+
     @Command(shortDescription = ""Adds a block to your inventory"",
             helpText = ""Puts a desired number of the given block with the give shape into your inventory"",
             runOnServer = true, requiredPermission = PermissionManager.CHEAT_PERMISSION)",0
Fixed wrong parameter name in class documentation,"  * return new CatViewHolder(inflater.inflate(R.layout.item_cat, parent, false));
  * }
  * @Override protected void onBindViewHolder(Cat item, CatViewHolder holder);
- * holder.setName(cat.getName());
+ * holder.setName(item.getName());
  * ...
  * }
  * }",0
fix rotation changes,"         });
     }
 
+    // fix rotation changes
+    @Override
+    protected void onSizeChanged(int w, int h, int oldw, int oldh) {
+        super.onSizeChanged(w, h, oldw, oldh);
+        mAreDimensionsInvalid = true;
+    }
+
     /**
      * Initialize time column width. Calculate value with all possible hours (supposed widest text)
      */",0
fix gwt build,"      * @param cases A not necessarily exhaustive sequence of cases that will be matched against a cause.
      * @return A new {@code Try} if this is a {@code Failure}, otherwise this.
      */
+    @GwtIncompatible
     @SuppressWarnings({ ""unchecked"", ""varargs"" })
     default Try<T> mapFailure(Match.Case<? extends Throwable, ? extends Throwable>... cases) {
         if (isSuccess()) {",0
typo lol,"         return request(OPTIONS, url);
     }
 
-    public static RequestBuilder path(String url) {
+    public static RequestBuilder patch(String url) {
         return request(PATCH, url);
     }
 ",0
A null pointer exception could occur when translating an order item,"     protected void translateOrderItem(OrderItem orderItem, Sku sku) {
         if (sku != null) {
             orderItem.setName(sku.getName());
-        }
-
         if (sku.getProductOptionValues() != null) {
             for (ProductOptionValue optionValue : sku.getProductOptionValues()) {
                 String key = optionValue.getProductOption().getAttributeName();
@@ -134,3 +132,4 @@
         }
     }
 }
+}",0
Moved setUseClientMode above setSSLParameters to fix #991 in master,"             SSLContext sslContext = SslUtils.getInstance().getSSLContext(config);
 
             SSLEngine sslEngine = sslContext.createSSLEngine(peerHost, peerPort);
+            sslEngine.setUseClientMode(true);
             if (!config.isAcceptAnyCertificate()) {
                 SSLParameters params = sslEngine.getSSLParameters();
                 params.setEndpointIdentificationAlgorithm(""HTTPS"");
                 sslEngine.setSSLParameters(params);
             }
-            sslEngine.setUseClientMode(true);
 
             if (isNonEmpty(config.getEnabledProtocols()))
                 sslEngine.setEnabledProtocols(config.getEnabledProtocols());",0
[BACKLOG-21474] Fix for issue with disposed widget," 
         // Stop button...
         //
-        if ( !stopItem.isEnabled() ^ !running ) {
+        if ( !stopItem.isDisposed() && !stopItem.isEnabled() ^ !running ) {
           stopItem.setEnabled( running );
         }
 ",0
javadoc fix up,"      * object will be an instance of {@link graphql.language.Value}.
      *
      * Note : You should not allow {@link java.lang.RuntimeException}s to come out of your parseLiteral method, but rather
-     * catch them and return null as per the method contract to indicate that the AST literal cannot be parsed into this scalar.
+     * catch them and fire them as {@link graphql.schema.CoercingParseLiteralException} instead as per the method contract.
      *
      * @param input is never null
      *",0
Fix getmetadata shell command,"                 processPut(line.substring(""put"".length()));
             } else if(line.toLowerCase().startsWith(""getall"")) {
                 processGetAll(line.substring(""getall"".length()));
-            } else if(line.toLowerCase().startsWith(""get"")) {
-                processGet(line.substring(""get"".length()));
-            } else if(line.toLowerCase().startsWith(""delete"")) {
-                processDelete(line.substring(""delete"".length()));
             } else if(line.toLowerCase().startsWith(""getmetadata"")) {
                 String[] args = line.substring(""getmetadata"".length() + 1).split(""\\s+"");
                 int remoteNodeId = Integer.valueOf(args[0]);
@@ -332,6 +328,10 @@
                     commandOutput.println(versioned.getValue());
                     commandOutput.println();
                 }
+            } else if(line.toLowerCase().startsWith(""get"")) {
+                processGet(line.substring(""get"".length()));
+            } else if(line.toLowerCase().startsWith(""delete"")) {
+                processDelete(line.substring(""delete"".length()));
             } else if(line.startsWith(""preflist"")) {
                 JsonReader jsonReader = new JsonReader(new StringReader(line.substring(""preflist"".length())));
                 Object key = tightenNumericTypes(jsonReader.read());",0
fix NPE in ShardRelocatingNodeExpression," 
     @Override
     public BytesRef value() {
-        return new BytesRef(indexShard.routingEntry().relocatingNodeId());
+        String relocatingNodeId = indexShard.routingEntry().relocatingNodeId();
+        if (relocatingNodeId != null) {
+            return new BytesRef(relocatingNodeId);
+        }
+        return null;
     }
 }
\ No newline at end of file",0
Fix index join property propagation," 
             // index side is really a nested-loops plan, so don't add exchanges
             PlanNode result = ChildReplacer.replaceChildren(node, ImmutableList.of(probeSource.getNode(), node.getIndexSource()));
-            return new PlanWithProperties(result, deriveProperties(result, probeProperties));
+            return new PlanWithProperties(result, deriveProperties(result, probeSource.getProperties()));
         }
 
         @Override",0
BugFix: Fix checkDynamicClass bug when startActivity.," import com.qihoo360.i.Factory2;
 import com.qihoo360.i.IPluginActivityManager;
 import com.qihoo360.i.IPluginManager;
-import com.qihoo360.replugin.utils.ReflectUtils;
 import com.qihoo360.replugin.RePlugin;
 import com.qihoo360.replugin.base.IPC;
 import com.qihoo360.replugin.component.activity.ActivityInjector;
@@ -37,6 +36,7 @@
 import com.qihoo360.replugin.helper.LogDebug;
 import com.qihoo360.replugin.helper.LogRelease;
 import com.qihoo360.replugin.model.PluginInfo;
+import com.qihoo360.replugin.utils.ReflectUtils;
 
 import org.json.JSONArray;
 import org.json.JSONObject;
@@ -84,8 +84,10 @@
         String plugin = intent.getStringExtra(IPluginManager.KEY_PLUGIN);
 
         /* 检查是否是动态注册的类 */
-        // 如果要启动的 Activity 是动态注册的类，则直接启动，不经过 SDK。
-        ComponentName componentName = activity.getComponentName();
+        // 如果要启动的 Activity 是动态注册的类，则不使用坑位机制，而是直接动态类。
+        // 原因：宿主的某些动态注册的类不能运行在坑位中（如'桌面'插件的入口Activity）
+        ComponentName componentName = intent.getComponent();
+        if (componentName != null) {
         if (LogDebug.LOG) {
             LogDebug.d(""loadClass"", ""isHookingClass("" + plugin + "","" + componentName.getClassName() + "") = ""
                     + isDynamicClass(plugin, componentName.getClassName()));
@@ -95,6 +97,7 @@
             activity.startActivity(intent);
             return true;
         }
+        }
 
         if (TextUtils.isEmpty(plugin)) {
             //
@@ -182,7 +185,9 @@
             }
         }
 
-        // 如果是 activity 是动态注册的类，则直接打开
+        /* 检查是否是动态注册的类 */
+        // 如果要启动的 Activity 是动态注册的类，则不使用坑位机制，而是直接动态类。
+        // 原因：宿主的某些动态注册的类不能运行在坑位中（如'桌面'插件的入口Activity）
         if (LOG) {
             LogDebug.d(""loadClass"", ""isHookingClass("" + plugin + "" , "" + activity + "") = ""
                     + Factory2.isDynamicClass(plugin, activity));",0
Fix h2o-mojo-compatibility error," import hex.Model;
 import hex.MultiModelMojoWriter;
 import hex.StackedEnsembleModel;
+import water.DKV;
 
 import java.io.IOException;
 import java.util.LinkedList;
 import java.util.List;
-import water.DKV;
 
 public class StackedEnsembleMojoWriter extends MultiModelMojoWriter<StackedEnsembleModel,
         StackedEnsembleModel.StackedEnsembleParameters, StackedEnsembleModel.StackedEnsembleOutput> {
@@ -20,7 +20,7 @@
 
     @Override
     public String mojoVersion() {
-        return ""1.0"";
+        return ""1.00"";
     }
 
     @Override",0
[java] Avoid crashes during type resolution when used JRE is older than dependencies' version,"                 }
             } catch (final NoSuchFieldException ignored) {
                 // swallow
-            } catch (final NoClassDefFoundError e) {
+            } catch (final LinkageError e) {
+                if (LOG.isLoggable(Level.WARNING)) {
+                    LOG.log(Level.WARNING, ""Error during type resolution due to: "" + e);
+                }
                 // TODO : report a missing class once we start doing that...
                 return null;
             }",0
Fix typo in variable name,"   @Override public Object onRetainCustomNonConfigurationInstance() {
 
     P presenter = delegateCallback.shouldInstanceBeRetained() ? delegateCallback.getPresenter() : null;
-    Object nonMosbyConfiguraionInstance =
+    Object nonMosbyConfigurationInstance =
         delegateCallback.onRetainNonMosbyCustomNonConfigurationInstance();
 
-    if (presenter == null && nonMosbyConfiguraionInstance == null) {
+    if (presenter == null && nonMosbyConfigurationInstance == null) {
       return null;
     }
 
-    return new ActivityMvpNonConfigurationInstances<>(presenter, nonMosbyConfiguraionInstance);
+    return new ActivityMvpNonConfigurationInstances<>(presenter, nonMosbyConfigurationInstance);
   }
 
   @Override public Object getNonMosbyLastCustomNonConfigurationInstance() {",0
fix the bug #1785 to support file @@list," 	static {
 		int i = 0;
 		byte packetId = 0;
-		header.packetId = 1;
+		header.packetId = ++packetId;
 
 		fields[i] = PacketUtil.getField(""DATA"", Fields.FIELD_TYPE_VAR_STRING);
 		fields[i++].packetId = ++packetId;",0
[fix]Fix the error of writing logs on some api level of Android devic…,"                 && Environment.getExternalStorageDirectory().canWrite()) {
             return Environment.getExternalStorageDirectory().getPath() + logPath;
         }
-        return Environment.getDataDirectory().getAbsolutePath() + BlockCanaryInternals.getContext().providePath();
+        return getContext().provideContext().getFilesDir() + BlockCanaryInternals.getContext().providePath();
     }
 
     static File detectedBlockDirectory() {",0
Fix crash on trying to view Palette on a selected image," 
             case R.id.action_palette:
                 Intent paletteIntent = new Intent(act, PaletteActivity.class);
-                paletteIntent.putExtra(""imageUri"", adapter.getFirstSelected().getUri().toString());
+                paletteIntent.setData(adapter.getFirstSelected().getUri());
                 startActivity(paletteIntent);
                 return true;
 ",0
Fixed showing of unnecessary scrollbar - follow-up from PR #2180,"             int optionsSize = options.get().size() <= visibleOptionsNum ? options.get().size() : visibleOptionsNum;
 
             // Calculate total options height
-            int height = (font.getLineHeight() + itemMargin.getTotalHeight()) * optionsSize + canvas.getCurrentStyle().getBackgroundBorder().getTotalHeight();
+            int itemHeight = itemMargin.getTotalHeight() + font.getLineHeight();
+            int height = itemHeight * optionsSize + canvas.getCurrentStyle().getBackgroundBorder().getTotalHeight();
             canvas.addInteractionRegion(mainListener, Rect2i.createFromMinAndSize(0, 0, canvas.size().x, canvas.size().y + height));
 
             // Dropdown Background Frame
             Rect2i frame = Rect2i.createFromMinAndSize(0, canvas.size().y, canvas.size().x, height);
             canvas.drawBackground(frame);
+            canvas.setPart(LIST_ITEM);
 
+            if (options.get().size() > visibleOptionsNum) {
+                createScrollbarItems(canvas, frame, font, itemMargin, height, itemHeight);
+            } else {
+                createNoScrollItems(canvas, itemMargin, itemHeight);
+            }
+
+        } else {
+            canvas.addInteractionRegion(mainListener);
+        }
+    }
+
+    /**
+     * Located in the onDraw method, this draws the menu items when the scrollbar is unnecessary.
+     * @param canvas {@link Canvas} from the onDraw method.
+     * @param itemMargin Margin around every menu item.
+     * @param itemHeight Height per menu item.
+     */
+    private void createNoScrollItems(Canvas canvas, Border itemMargin, int itemHeight) {
+        for (int i = 0; i < optionListeners.size(); ++i) {
+            readItemMouseOver(canvas, i);
+            Rect2i itemRegion = Rect2i.createFromMinAndSize(0, canvas.size().y + itemHeight * i, canvas.size().x, itemHeight);
+            drawItem(canvas, itemMargin, i, itemRegion);
+        }
+    }
+
+    /**
+     * Located in the onDraw method, this draws the menu items with a scrollbar.
+     * @param canvas {@link Canvas} from the onDraw method.
+     * @param frame Menu frame.
+     * @param font {@link Font} used in the menu.
+     * @param itemMargin Margin around every menu item.
+     * @param height Total menu height.
+     * @param itemHeight Height per menu item.
+     */
+    private void createScrollbarItems(Canvas canvas, Rect2i frame, Font font, Border itemMargin, int height, int itemHeight) {
             // Scrollable Area
             Rect2i scrollableArea = Rect2i.createFromMinAndSize(0, canvas.size().y, canvas.size().x, height - itemMargin.getBottom());
 
@@ -118,36 +155,46 @@
             int scrollbarXPos = availableWidth - itemMargin.getRight();
             int scrollbarYPos = itemMargin.getTotalHeight() * 2 + font.getLineHeight();
 
-            // Item
-            int itemHeight = itemMargin.getTotalHeight() + font.getLineHeight();
+        // Draw Scrollbar
+        Rect2i scrollbarRegion = Rect2i.createFromMinAndSize(scrollbarXPos, scrollbarYPos, scrollbarWidth, scrollbarHeight);
+        canvas.drawWidget(verticalBar, scrollbarRegion);
 
-            canvas.setPart(LIST_ITEM);
             for (int i = 0; i < optionListeners.size(); ++i) {
+            readItemMouseOver(canvas, i);
+            Rect2i itemRegion = Rect2i.createFromMinAndSize(0, itemHeight * i - verticalBar.getValue(), availableWidth, itemHeight);
+
+            // If outside location, then hide
+            try (SubRegion ignored = canvas.subRegion(scrollableArea, true)) {
+                drawItem(canvas, itemMargin, i, itemRegion);
+            }
+        }
+    }
+
+    /**
+     * Looks for MouseOver event for every item in the menu.
+     * @param canvas {@link Canvas} from the onDraw method.
+     * @param i Item index.
+     */
+    private void readItemMouseOver(Canvas canvas, int i) {
                 if (optionListeners.get(i).isMouseOver()) {
                     canvas.setMode(HOVER_MODE);
                 } else {
                     canvas.setMode(DEFAULT_MODE);
                 }
+    }
 
-                Rect2i itemRegion = Rect2i.createFromMinAndSize(0, itemHeight * i - verticalBar.getValue(), availableWidth, itemHeight);
-
-                // If outside location, then hide
-                try (SubRegion ignored = canvas.subRegion(scrollableArea, true)) {
+    /**
+     * Draws the item on the {@link Canvas}.
+     * @param canvas {@link Canvas} from the onDraw method.
+     * @param itemMargin Margin around every menu item.
+     * @param i Item index.
+     * @param itemRegion Region of the item in the menu.
+     */
+    private void drawItem(Canvas canvas, Border itemMargin, int i, Rect2i itemRegion) {
                     canvas.drawBackground(itemRegion);
                     optionRenderer.draw(options.get().get(i), canvas, itemMargin.shrink(itemRegion));
                     canvas.addInteractionRegion(optionListeners.get(i), itemRegion);
                 }
-            }
-
-            // Draw Scrollbar
-            Rect2i scrollbarRegion = Rect2i.createFromMinAndSize(scrollbarXPos, scrollbarYPos, scrollbarWidth, scrollbarHeight);
-            canvas.drawWidget(verticalBar, scrollbarRegion);
-
-
-        } else {
-            canvas.addInteractionRegion(mainListener);
-        }
-    }
 
     @Override
     public void onLoseFocus() {",0
Fix sample-mvi,"     clearSelectionDisposal = intent(SelectedCountToolbarView::clearSelectionIntent)
         .doOnNext(ignore -> Timber.d(""intent: clear selection""))
         .subscribe(aBoolean -> clearSelectionRelay.onNext(aBoolean));
-    subscribeViewState(selectedCountObservable, SelectedCountToolbarView::render);
 
     deleteSelectedItemsDisposal =
         intent(SelectedCountToolbarView::deleteSelectedItemsIntent)",0
fix typo,"      * sequence as the index into the buffer (indexMask). (aka modulo operator)
      * -- The upper portion of the sequence becomes the value to check for availability.
      * ie: it tells us how many times around the ring buffer we've been (aka division)
-     * -- Beause we can't wrap without the gating sequences moving forward (i.e. the
+     * -- Because we can't wrap without the gating sequences moving forward (i.e. the
      * minimum gating sequence is effectively our last available position in the
      * buffer), when we have new data and successfully claimed a slot we can simply
      * write over the top.",0
Fix for cursorPersistenceAsyncMarkDeleteSameThread," import org.apache.bookkeeper.mledger.proto.MLDataFormats.ManagedCursorInfo;
 import org.apache.bookkeeper.mledger.proto.MLDataFormats.PositionInfo;
 import org.apache.commons.lang3.tuple.Pair;
+import org.jctools.queues.MessagePassingQueue;
 import org.jctools.queues.MpmcArrayQueue;
+import org.jctools.queues.MpscLinkedQueue;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -149,7 +151,7 @@
         }
     }
 
-    private final MpmcArrayQueue<MarkDeleteEntry> pendingMarkDeleteOps = new MpmcArrayQueue<>(16);
+    private final MessagePassingQueue<MarkDeleteEntry> pendingMarkDeleteOps = MpscLinkedQueue.newMpscLinkedQueue();
 
     private static final AtomicIntegerFieldUpdater<ManagedCursorImpl> PENDING_MARK_DELETED_SUBMITTED_COUNT_UPDATER =
         AtomicIntegerFieldUpdater.newUpdater(ManagedCursorImpl.class, ""pendingMarkDeletedSubmittedCount"");
@@ -1358,7 +1360,10 @@
             startCreatingNewMetadataLedger();
             // fall through
         case SwitchingLedger:
-            pendingMarkDeleteOps.add(mdEntry);
+            if (!pendingMarkDeleteOps.offer(mdEntry)) {
+                callback.markDeleteFailed(new ManagedLedgerException(""Cursor queue of mark-delete operations full""), ctx);
+                return;
+            }
             if (state != State.SwitchingLedger) {
                 // If state changed since we checked. Trigger a flush since we could have missed the current entry
                 flushPendingMarkDeletes();",0
Fix NPE on RangedBeacon per #638,"     }
 
     public void addBeacon(Beacon beacon) {
-        if (mRangedBeacons.containsKey(beacon)) {
             RangedBeacon rangedBeacon = mRangedBeacons.get(beacon);
+        if (rangedBeacon != null) {
             if (LogManager.isVerboseLoggingEnabled()) {
                 LogManager.d(TAG, ""adding %s to existing range for: %s"", beacon, rangedBeacon);
             }
@@ -71,6 +71,7 @@
         synchronized (mRangedBeacons) {
             for (Beacon beacon : mRangedBeacons.keySet()) {
                 RangedBeacon rangedBeacon = mRangedBeacons.get(beacon);
+                if (rangedBeacon != null) {
                 if (rangedBeacon.isTracked()) {
                     rangedBeacon.commitMeasurements(); // calculates accuracy
                     if (!rangedBeacon.noMeasurementsAvailable()) {
@@ -90,6 +91,7 @@
                     LogManager.d(TAG, ""Dumping beacon from RangeState because it has no recent measurements."");
                 }
             }
+            }
             mRangedBeacons = newRangedBeacons;
         }
 ",0
Somewhat hacky fix for #3066 - validate the particle prefab being available,"             // dust particle effect
             if (entity.hasComponent(LocationComponent.class) && block.isDebrisOnDestroy()) {
                 EntityBuilder dustBuilder = entityManager.newBuilder(""core:dustEffect"");
+                // TODO: particle system stuff should be split out better - this is effectively a stealth dependency on Core from the engine
+                if (dustBuilder.hasComponent(LocationComponent.class)) {
                 dustBuilder.getComponent(LocationComponent.class).setWorldPosition(entity.getComponent(LocationComponent.class).getWorldPosition());
                 dustBuilder.build();
             }
+            }
 
             // sound to play for destroyed block
             BlockSounds sounds = block.getSounds();",0
Delay initialisation of keyboard mappings," 	private KeyboardAPI api = null;
 
 	public ExtensionKeyboard() {
-		super();
-		initialize();
-	}
-
-	private void initialize() {
-        this.setName(NAME);
-        this.setOrder(2000);	// Really want this to be added late on
+		super(NAME);
 	}
 
 	@Override
@@ -83,7 +77,7 @@
 	}
 
 	@Override
-	public void optionsLoaded() {
+	public void postInit() {
 		if (View.isInitialised()) {
 			logger.info(""Initializing keyboard shortcuts"");
 			initAllMenuItems(View.getSingleton().getMainFrame().getMainMenuBar().getMenuFile());",0
fix offer does not apply when edited by a CSR,"         postMergedCustomer.setUnencodedChallengeAnswer(preMergedCustomer.getUnencodedChallengeAnswer());
         postMergedCustomer.setAnonymous(preMergedCustomer.isAnonymous());
         postMergedCustomer.setCookied(preMergedCustomer.isCookied());
-        postMergedCustomer.setLoggedIn(preMergedCustomer.isLoggedIn());
+        postMergedCustomer.setLoggedIn(preMergedCustomer.isRegistered());
         postMergedCustomer.getTransientProperties().putAll(preMergedCustomer.getTransientProperties());
     }
 ",0
Fixed compilation error," import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import com.navercorp.pinpoint.bootstrap.context.AttributeScope;
 import com.navercorp.pinpoint.bootstrap.context.Trace;
 import com.navercorp.pinpoint.bootstrap.context.TraceContext;
 import com.navercorp.pinpoint.bootstrap.context.TraceId;",0
Netty: Prevent overwriting the host header with the host from the URI,"         }
 
         String hostHeader = hostHeader(request, uri);
-        if (hostHeader != null)
+        if (hostHeader != null && !headers.contains(HttpHeaders.Names.HOST))
             headers.set(HttpHeaders.Names.HOST, hostHeader);
 
         Realm realm = request.getRealm() != null ? request.getRealm() : config.getRealm();",0
A couple of small fixes to the categoriesProcessor," 		// instead of the first category in the list
 		List<Category> categories = catalogService.findCategoriesByName(parentCategory);
 		if (categories != null && categories.size() > 0) {
-			List<Category> subcategories = catalogService.findAllSubCategories(categories.get(0));
+			// gets child categories in order ONLY if they are in the xref table and active
+			List<Category> subcategories = categories.get(0).getChildCategories();
+			if (subcategories != null && !subcategories.isEmpty()) {
 			if (StringUtils.isNotEmpty(unparsedMaxResults)) {
 				int maxResults = Integer.parseInt(unparsedMaxResults);
+					if (subcategories.size() > maxResults) {
 				subcategories = subcategories.subList(0, maxResults);
 			}
+				}
+			}
 			
 			addToModel(resultVar, subcategories);
 		}",0
CorsHandler.write(...) should not cause a flush.,"                 setExposeHeaders(response);
             }
         }
-        ctx.writeAndFlush(msg, promise);
+        ctx.write(msg, promise);
     }
 
     private static void forbidden(final ChannelHandlerContext ctx, final HttpRequest request) {",0
Fix silent UITreeView error when no item is selected,"                 // Expand or contract and item on RMB - works even if the tree is disabled.
                 model.get().getItem(index).setExpanded(!model.get().getItem(index).isExpanded());
 
-                Tree<T> selectedItem = model.get().getItem(selectedIndex.get());
+                Tree<T> selectedItem = selectedIndex.get() != null ? model.get().getItem(selectedIndex.get()) : null;
                 model.get().resetItems();
 
+                if (selectedItem != null) {
                 int newIndex = model.get().indexOf(selectedItem);
                 if (newIndex == -1) {
                     selectedIndex.set(null);
                 } else {
                     selectedIndex.set(newIndex);
                 }
+                }
                 return true;
             } else if (isEnabled()) {
                 if (event.getMouseButton() == MouseInput.MOUSE_LEFT) {",0
"Fixed ItemFluidContainer always draining the maximum amount, regardless ...","             return null;
         }
 
+        int currentAmount = stack.amount;
         stack.amount = Math.min(stack.amount, maxDrain);
         if (doDrain)
         {
-            if (maxDrain >= capacity)
+            if (currentAmount == stack.amount)
             {
                 container.stackTagCompound.removeTag(""Fluid"");
 
@@ -150,7 +151,7 @@
             }
 
             NBTTagCompound fluidTag = container.stackTagCompound.getCompoundTag(""Fluid"");
-            fluidTag.setInteger(""Amount"", fluidTag.getInteger(""Amount"") - maxDrain);
+            fluidTag.setInteger(""Amount"", currentAmount - stack.amount);
             container.stackTagCompound.setTag(""Fluid"", fluidTag);
         }
         return stack;",0
Fix leaked NotificationProcessor in ScanJobsScheduler,"         JobScheduler jobScheduler = (JobScheduler) context.getSystemService(Context.JOB_SCHEDULER_SERVICE);
         jobScheduler.cancel(ScanJob.getImmediateScanJobId(context));
         jobScheduler.cancel(ScanJob.getPeriodicScanJobId(context));
+
+        if (mBeaconNotificationProcessor != null) {
+            mBeaconNotificationProcessor.unregister();
+        }
     }
 
     // This method appears to be never used, because it is only used by Android O APIs, which",0
fix recycleResources npe," 
 		ByteBuffer buf = buffer;
 		if (buf != null) {
-			buffer = null;
 			session.getSource().recycle(buffer);
-
+			buffer = null;
 		}
 	}
 ",0
Fixing minor typos in message of NoCacheRegionFactoryAvailableException,"  */
 public class NoCacheRegionFactoryAvailableException extends CacheException {
 	private static final String MSG = ""Second-level cache is used in the application, but property ""
-			+ Environment.CACHE_REGION_FACTORY + ""is not gaven, please either disable second level cache"" +
+			+ Environment.CACHE_REGION_FACTORY + "" is not given, please either disable second level cache"" +
 			"" or set correct region factory class name to property ""+Environment.CACHE_REGION_FACTORY+
-			"" (and make sure the second level cache provider, hibernate-infinispan, for example, available in the classpath)."";
+			"" (and make sure the second level cache provider, hibernate-infinispan, for example, is available in the classpath)."";
 	public NoCacheRegionFactoryAvailableException() {
 		super( MSG );
 	}",0
Fix creating new SAML svc definitions bug on every restart,"         servicesManager.load();
 
         if (servicesManager.findServiceBy(registeredService -> registeredService instanceof SamlRegisteredService
-                && registeredService.getServiceId().equals(service.getServiceId())) != null) {
+                && registeredService.getServiceId().equals(service.getServiceId())).size() == 0) {
             LOGGER.info(""Service [{}] does not exist in the registry and will be added."", service.getServiceId());
             servicesManager.save(service);
             servicesManager.load();",0
Fix for Issue 1470: On OS X TextField deletes symbols from the right side," 					long timeStamp = Keyboard.getEventNanoseconds();
 
 					switch (keyCode) {
+					case Keys.DEL:
+						keyChar = 8;
+						break;
 					case Keys.FORWARD_DEL:
 						keyChar = 127;
 						break;",0
Fix for issue #185," 
     private SavedState(Parcel in) {
         super(in);
-
+        preferences = in.readParcelable(Preferences.class.getClassLoader());
     }
 
     @Override
@@ -51,4 +51,3 @@
         public SavedState[] newArray(int size) { return new SavedState[size]; }
     };
 }
-",0
creator tools icon bug," import com.kickstarter.libs.ActivityViewModel;
 import com.kickstarter.libs.BuildCheck;
 import com.kickstarter.libs.Config;
+import com.kickstarter.libs.CurrentConfigType;
 import com.kickstarter.libs.CurrentUserType;
 import com.kickstarter.libs.Environment;
 import com.kickstarter.libs.FeatureKey;
+import com.kickstarter.libs.rx.transformers.Transformers;
 import com.kickstarter.libs.utils.BooleanUtils;
 import com.kickstarter.libs.utils.DiscoveryDrawerUtils;
 import com.kickstarter.libs.utils.DiscoveryUtils;
@@ -98,15 +100,17 @@
 
   final class ViewModel extends ActivityViewModel<DiscoveryActivity> implements Inputs, Outputs {
     private final ApiClientType apiClient;
-    private final WebClientType webClient;
     private final BuildCheck buildCheck;
     private final CurrentUserType currentUser;
+    private final CurrentConfigType currentConfigType;
+    private final WebClientType webClient;
 
     public ViewModel(final @NonNull Environment environment) {
       super(environment);
 
       this.apiClient = environment.apiClient();
       this.buildCheck = environment.buildCheck();
+      this.currentConfigType = environment.currentConfig();
       this.currentUser = environment.currentUser();
       this.webClient = environment.webClient();
 
@@ -118,10 +122,17 @@
       this.showProfile = this.profileClick;
       this.showSettings = this.settingsClick;
 
-      final Observable<Boolean> userIsCreator = this.currentUser.observable()
+      final Observable<User> currentUser = this.currentUser.observable();
+
+      currentUser.subscribe(updatedUser ->
+        this.apiClient.config()
+          .compose(Transformers.neverError())
+          .subscribe(this.currentConfigType::config));
+
+      final Observable<Boolean> userIsCreator = currentUser
         .map(u -> u != null && IntegerUtils.isNonZero(u.memberProjectsCount()));
 
-      final Observable<Boolean> creatorViewFeatureFlagIsEnabled = environment.currentConfig().observable()
+      final Observable<Boolean> creatorViewFeatureFlagIsEnabled = this.currentConfigType.observable()
         .map(Config::features)
         .filter(ObjectUtils::isNotNull)
         .map(f -> coalesce(f.get(FeatureKey.ANDROID_CREATOR_VIEW), false));
@@ -203,7 +214,7 @@
       // to avoid displaying old data.
       pagerSelectedPage
         .compose(takeWhen(params))
-        .compose(combineLatestPair(this.currentUser.observable()))
+        .compose(combineLatestPair(currentUser))
         .map(pageAndUser -> pageAndUser.first)
         .flatMap(currentPage -> Observable.from(DiscoveryParams.Sort.values())
           .map(DiscoveryUtils::positionFromSort)
@@ -225,7 +236,7 @@
         categories,
         params,
         expandedCategory,
-        this.currentUser.observable(),
+        currentUser,
         DiscoveryDrawerUtils::deriveNavigationDrawerData
       )
         .distinctUntilChanged()",0
Fixed #167,"             }
 
         } else if (opcode == OP_CLOSE) {
-            int    code   = (payload.length >= 2) ? 256 * payload[0] + payload[1] : 0;
+            int    code   = (payload.length >= 2) ? 256 * (payload[0] & 0xFF) + (payload[1] & 0xFF) : 0;
             String reason = (payload.length >  2) ? encode(slice(payload, 2))     : null;
 //            Log.d(TAG, ""Got close op! "" + code + "" "" + reason);
             onDisconnect(code, reason);",0
Fix NPE," import com.squareup.leakcanary.CanaryLog;
 import com.squareup.leakcanary.R;
 import java.lang.reflect.Method;
+import java.util.List;
 import java.util.concurrent.Executor;
 import java.util.concurrent.Executors;
 
@@ -114,12 +115,16 @@
     ActivityManager activityManager =
         (ActivityManager) context.getSystemService(Context.ACTIVITY_SERVICE);
     ActivityManager.RunningAppProcessInfo myProcess = null;
-    for (ActivityManager.RunningAppProcessInfo process : activityManager.getRunningAppProcesses()) {
+    List<ActivityManager.RunningAppProcessInfo> runningProcesses =
+        activityManager.getRunningAppProcesses();
+    if (runningProcesses != null) {
+      for (ActivityManager.RunningAppProcessInfo process : runningProcesses) {
       if (process.pid == myPid) {
         myProcess = process;
         break;
       }
     }
+    }
     if (myProcess == null) {
       CanaryLog.d(""Could not find running process for %d"", myPid);
       return false;",0
Fixes Ion Issue 169 (https://github.com/koush/ion/issues/169),"         c.add(new ContinuationCallback() {
             @Override
             public void onContinue(Continuation continuation, CompletedCallback next) throws Exception {
-                byte[] bytes = (getBoundaryEnd() + ""\r\n"").getBytes();
+                byte[] bytes = (getBoundaryEnd()).getBytes();
                 com.koushikdutta.async.Util.writeAll(sink, bytes, next);
                 written += bytes.length;
                 
@@ -207,7 +207,7 @@
                 return -1;
             length += part.length() + part.getRawHeaders().toHeaderString().getBytes().length + ""\r\n"".length();
         }
-        length += (getBoundaryEnd() + ""\r\n"").getBytes().length;
+        length += (getBoundaryEnd()).getBytes().length;
         return totalToWrite = length;
     }
     ",0
Fixes #6 Defer load until first layout pass," import android.graphics.Rect;
 import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
+import android.view.ViewTreeObserver;
 import java.io.File;
 import java.io.OutputStream;
 import java.util.concurrent.Future;
@@ -67,12 +68,38 @@
          * @param model Model used by {@link BitmapLoader} to load desired {@link Bitmap}
          */
         public void load(@Nullable Object model) {
+            if (cropView.getWidth() == 0 && cropView.getHeight() == 0) {
+                // Defer load until layout pass
+                deferLoad(model);
+                return;
+            }
+            performLoad(model);
+        }
+
+        void performLoad(Object model) {
             if (bitmapLoader == null) {
                 bitmapLoader = resolveBitmapLoader(cropView);
             }
-
             bitmapLoader.load(model, cropView);
         }
+
+        void deferLoad(final Object model) {
+            if (!cropView.getViewTreeObserver().isAlive()) {
+                return;
+            }
+            cropView.getViewTreeObserver().addOnGlobalLayoutListener(
+                    new ViewTreeObserver.OnGlobalLayoutListener() {
+                        @Override
+                        public void onGlobalLayout() {
+                            if (cropView.getViewTreeObserver().isAlive()) {
+                                //noinspection deprecation
+                                cropView.getViewTreeObserver().removeGlobalOnLayoutListener(this);
+                            }
+                            performLoad(model);
+                        }
+                    }
+            );
+        }
     }
 
     public static class CropRequest {",0
Account for center aligned blocks for OnEnterBlockEvent,"             updatePosition(characterMovementComponent, result, input, entity);
 
             if (input.isFirstRun()) {
-                checkBlockEntry(entity, new Vector3i(initial.getPosition()), new Vector3i(result.getPosition()), characterMovementComponent.height);
+                checkBlockEntry(entity, new Vector3i(initial.getPosition(), 0.5f), new Vector3i(result.getPosition(), 0.5f), characterMovementComponent.height);
             }
 
             if (result.getMode() != MovementMode.GHOSTING && result.getMode() != MovementMode.NONE) {",0
Clean Java doc to fix #246,"      * <code>getPackage()</code> on the <code>Class</code> object returned 
      * by <code>toClass()</code> will return a non-null object.</p>
      *
-     * <p>The jigsaw module introduced by Java 9 has broken this method.
-     * In Java 9 or later, the VM argument
-     * <code>--add-opens java.base/java.lang=ALL-UNNAMED</code>
-     * has to be given to the JVM so that this method can run.
-     * </p>
+     * <p>The jigsaw module introduced by Java 9 has broken this method.</p>
      *
      * @param loader        the class loader passed to <code>toClass()</code> or
      *                      the default one obtained by <code>getClassLoader()</code>.",0
Fix for issue #21," import org.hamcrest.Matcher;
 import org.hamcrest.TypeSafeMatcher;
 
+import java.util.Arrays;
+
 public class StringContainsInOrder extends TypeSafeMatcher<String> {
     private final Iterable<String> substrings;
 
@@ -52,4 +54,19 @@
     public static Matcher<String> stringContainsInOrder(Iterable<String> substrings) {
         return new StringContainsInOrder(substrings);
     }
+
+    /**
+     * Creates a matcher of {@link String} that matches when the examined string contains all of
+     * the specified substrings, regardless of the order of their appearance.
+     * <p/>
+     * For example:
+     * <pre>assertThat(""myfoobarbaz"", stringContainsInOrder(""bar"", ""foo""))</pre>
+     *
+     * @param substrings
+     *     the substrings that must be contained within matching strings
+     */
+    @Factory
+    public static Matcher<String> stringContainsInOrder(String... substrings) {
+        return new StringContainsInOrder(Arrays.asList(substrings));
+    }
 }",0
"When addAppearListener is added, hover view cannot be dismissed. FIXED","         @Override
         public void onAnimationEnd(Animator animation) {
             mAppearingAnimators.remove(animation);
-            if(mAppearListeners.isEmpty()){
                 mHoverStatus = HOVER_STATUS.APPEARED;
+            if(!mAppearListeners.isEmpty()){
                 for(AppearListener l : mAppearListeners){
                     l.onEnd();
                 }",0
Fixed IndexOutOfBoundsException for leak traces of size 1,"     if (position == 1) {
       return DisplayLeakConnectorView.Type.HELP;
     } else if (position == 2) {
+      if (leakTrace.expectedReachability.size() == 1) {
+        return DisplayLeakConnectorView.Type.START_LAST_REACHABLE;
+      }
       Reachability nextReachability =
           leakTrace.expectedReachability.get(elementIndex(position + 1));
       if (nextReachability != Reachability.REACHABLE) {",0
fixed CumulativeDistribution class returned wrong values," 			else break;
 		}
 
-		return value.value;
+		return values.items[imin].value;
 	}
 
 	/** @return the value whose interval contains a random probability in [0,1] */",0
Fix crash when pre-lollipop receiver is already unregistered," 
         subscriber.add(unsubscribeInUiThread(new Action0() {
           @Override public void call() {
+            //Catch case where the receiver is already unregistered
+            try {
             context.unregisterReceiver(receiver);
+            } catch (Exception e) {
+              // ignore exception
+            }
           }
         }));
       }",0
TFJ-855 Fixed Wrong javadoc,"      * Return up to 100 users worth of extended information, specified by either ID, screen name, or combination of the two. The author's most recent status (if the authenticating user has permission) will be returned inline.
      * <br>This method calls https://api.twitter.com/1.1/users/lookup.json
      *
-     * @param ids Specifies the screen names of the users to return.
+     * @param ids Specifies the IDs of the users to return.
      * @return users
      * @throws TwitterException when Twitter service or network is unavailable
      * @see <a href=""https://dev.twitter.com/docs/api/1.1/get/users/lookup"">GET users/lookup | Twitter Developers</a>",0
修复心跳 启动立马切换bug," 				if (detector == null || detector.isQuit()) {
 					try {
 						detector = new MySQLDetector(this);
+						detector.heartbeat();
 					} catch (Exception e) {
 						LOGGER.warn(source.getConfig().toString(), e);
 						setResult(ERROR_STATUS, detector, null);",0
Backend thread pool incorrectly fixed at 2 threads,"         Preconditions.checkArgument(persistAttemptWaittime > 0, ""Persistence attempt retry wait time must be non-negative"");
 
         if (storageConfig.getBoolean(PARALLEL_BACKEND_OPS_KEY, PARALLEL_BACKEND_OPS_DEFAULT)) {
-            int poolsize = Math.min(1, Runtime.getRuntime().availableProcessors()) * THREAD_POOL_SIZE_SCALE_FACTOR;
+            int poolsize = Runtime.getRuntime().availableProcessors() * THREAD_POOL_SIZE_SCALE_FACTOR;
             threadPool = Executors.newFixedThreadPool(poolsize);
             log.info(""Initiated backend operations thread pool of size {}"", poolsize);
         } else {",0
Fix magic number in LoopInitializer," package com.seriouscompany.business.java.fizzbuzz.packagenamingpackage.impl.loop;
 
 public class LoopInitializer {
+	
+	public static final int LOOP_INIT_VALUE = 1;
+	
 	public int getLoopInitializationPoint() {
-		return 1;
+		return LoopInitializer.LOOP_INIT_VALUE;
 	}
 }",0
CAMEL-11117: Fix searchTerm error with unseen and subjectOrBody," 
         if (simple.getSubjectOrBody() != null) {
             String text = simple.getSubjectOrBody();
-            builder = builder.subject(text).body(SearchTermBuilder.Op.or, text);
+            SearchTermBuilder builderTemp = new SearchTermBuilder();
+            builderTemp = builderTemp.subject(text).body(SearchTermBuilder.Op.or, text);
+            builder = builder.and(builderTemp.build());
         }
         if (simple.getSubject() != null) {
             builder = builder.subject(simple.getSubject());",0
Fix ambiguous class definition in FieldSerializeCheck,"      */
      final class NullCheck<T> implements FieldSerializeCheck<T> {
 
-        private static final NullCheck INSTANCE = new NullCheck();
+        private static final FieldSerializeCheck.NullCheck INSTANCE = new FieldSerializeCheck.NullCheck();
 
         private NullCheck() {
         }
 
         @SuppressWarnings(""unchecked"")
-        public static <T> NullCheck<T> newInstance() {
+        public static <T> FieldSerializeCheck.NullCheck<T> newInstance() {
             return INSTANCE;
         }
 ",0
fix a typo in PolygonRegion," 		this.triangles = triangles;
 
 		float[] textureCoords = this.textureCoords = new float[vertices.length];
-		float u = region.u, v = region.u;
+		float u = region.u, v = region.v;
 		float uvWidth = region.u2 - u;
 		float uvHeight = region.v2 - v;
 		int width = region.regionWidth;",0
按月分片，范围查询跨头尾分片出现空指针的bug，类似pull request1024对按天分片的修改," 
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
+import java.util.ArrayList;
 import java.util.Calendar;
+import java.util.Collections;
+import java.util.List;
 
 import io.mycat.config.model.rule.RuleAlgorithm;
+import org.apache.log4j.Logger;
 
 /**
  * 例子 按月份列分区 ，每个自然月一个分片，格式 between操作解析的范例
@@ -14,6 +18,7 @@
  */
 public class PartitionByMonth extends AbstractPartitionAlgorithm implements
 		RuleAlgorithm {
+	private static final Logger LOGGER = Logger.getLogger(PartitionByDate.class);
 	private String sBeginDate;
 	private String dateFormat;
 	private String sEndDate;
@@ -52,6 +57,26 @@
 		}
 	}
 
+	/**
+	 * For circulatory partition, calculated value of target partition needs to be
+	 * rotated to fit the partition range
+	 */
+	private int reCalculatePartition(int targetPartition) {
+		/**
+		 * If target date is previous of start time of partition setting, shift
+		 * the delta range between target and start date to be positive value
+		 */
+		if (targetPartition < 0) {
+			targetPartition = nPartition - (-targetPartition) % nPartition;
+		}
+
+		if (targetPartition >= nPartition) {
+			targetPartition =  targetPartition % nPartition;
+		}
+
+		return targetPartition;
+	}
+
 	@Override
 	public Integer calculate(String columnValue)  {
 		try {
@@ -67,17 +92,7 @@
 			 * rotated to fit the partition range
  			 */
 			if (nPartition > 0) {
-				/**
-				 * If target date is previous of start time of partition setting, shift
-				 * the delta range between target and start date to be positive value
-				 */
-				if (targetPartition < 0) {
-					targetPartition = nPartition - (-targetPartition) % nPartition;
-				}
-
-				if (targetPartition >= nPartition) {
-					targetPartition = targetPartition % nPartition;
-				}
+				targetPartition = reCalculatePartition(targetPartition);
 			}
 			return targetPartition;
 
@@ -88,8 +103,33 @@
 
 	@Override
 	public Integer[] calculateRange(String beginValue, String endValue)  {
-		return AbstractPartitionAlgorithm.calculateSequenceRange(this,
-				beginValue, endValue);
+		try {
+			int startPartition, endPartition;
+			Calendar partitionTime = Calendar.getInstance();
+			SimpleDateFormat format = new SimpleDateFormat(dateFormat);
+			partitionTime.setTime(format.parse(beginValue));
+			startPartition = ((partitionTime.get(Calendar.YEAR) - beginDate.get(Calendar.YEAR))
+					* 12 + partitionTime.get(Calendar.MONTH)
+					- beginDate.get(Calendar.MONTH));
+			partitionTime.setTime(format.parse(endValue));
+			endPartition = ((partitionTime.get(Calendar.YEAR) - beginDate.get(Calendar.YEAR))
+					* 12 + partitionTime.get(Calendar.MONTH)
+					- beginDate.get(Calendar.MONTH));
+
+			List<Integer> list = new ArrayList<>();
+
+			while (startPartition <= endPartition) {
+				Integer nodeValue = reCalculatePartition(startPartition);
+				if (Collections.frequency(list, nodeValue) < 1)
+					list.add(nodeValue);
+				startPartition++;
+			}
+			int size = list.size();
+			return (list.toArray(new Integer[size]));
+		} catch (ParseException e) {
+			LOGGER.error(e);
+			return new Integer[0];
+		}
 	}
 
 	public void setsBeginDate(String sBeginDate) {",0
fix offset bug for NLPchina/elasticsearch-analysis-ansj#94," 		}
 
 		String temp = br.readLine();
-		offe = br.getStart();
 		while (StringUtil.isBlank(temp)) {
 			if (temp == null) {
+                offe = br.getStart();
 				return null;
 			} else {
 				temp = br.readLine();
 			}
 
 		}
+        offe = br.getStart();
 
 		// 歧异处理字符串
 ",0
[PUBDEV-5500] Fix warning messages in automl (#2328),"               buildSpec.input_spec.training_path +
               "" and training_frame: "" + buildSpec.input_spec.training_frame);
     if (this.origTrainingFrame.find(buildSpec.input_spec.response_column) == -1) {
-      throw new H2OIllegalArgumentException(""Response column "" + buildSpec.input_spec.response_column + ""is not in "" +
+      throw new H2OIllegalArgumentException(""Response column '"" + buildSpec.input_spec.response_column + ""' is not in "" +
               ""the training frame."");
     }
     if (buildSpec.input_spec.fold_column != null && this.origTrainingFrame.find(buildSpec.input_spec.fold_column) == -1) {
-      throw new H2OIllegalArgumentException(""Fold column "" + buildSpec.input_spec.fold_column + ""is not in "" +
+      throw new H2OIllegalArgumentException(""Fold column '"" + buildSpec.input_spec.fold_column + ""' is not in "" +
               ""the training frame."");
     }
     if (buildSpec.input_spec.weights_column != null && this.origTrainingFrame.find(buildSpec.input_spec.weights_column) == -1) {
-      throw new H2OIllegalArgumentException(""Weights column "" + buildSpec.input_spec.weights_column + ""is not in "" +
+      throw new H2OIllegalArgumentException(""Weights column '"" + buildSpec.input_spec.weights_column + ""' is not in "" +
               ""the training frame."");
     }
 ",0
Fixed issue where items were unable to be added to wishlist when out of stock," import org.broadleafcommerce.core.inventory.service.InventoryUnavailableException;
 import org.broadleafcommerce.core.inventory.service.type.InventoryType;
 import org.broadleafcommerce.core.order.domain.Order;
+import org.broadleafcommerce.core.order.service.type.OrderStatus;
 import org.broadleafcommerce.core.workflow.BaseActivity;
 import org.broadleafcommerce.core.workflow.ProcessContext;
 
 import java.util.HashMap;
 import java.util.Map;
+import java.util.Objects;
 
 import javax.annotation.Resource;
 
@@ -43,6 +45,12 @@
     @Resource(name = ""blInventoryService"")
     protected ContextualInventoryService inventoryService;
     
+    @Override
+    public boolean shouldExecute(ProcessContext<CartOperationRequest> context) {
+        Order order = context.getSeedData().getOrder();
+        return order != null && !Objects.equals(order.getStatus(), OrderStatus.NAMED);
+    }
+    
     protected void checkSkuAvailability(Order order, Sku sku, Integer requestedQuantity) throws InventoryUnavailableException {
         // First check if this Sku is available
         if (!sku.isAvailable()) {",0
Fixed overflow," 	 * 
 	 * @param value The value to add */
 	public void addValue (float value) {
+		if (added_values < values.length)
 		added_values++;
 		values[last_value++] = value;
 		if (last_value > values.length - 1) last_value = 0;",0
	修复 分片节点 第一个节点不是默认节点时候 desc table 路由到默认节点的bug 表名大写转换," 	 * @author AStoneGod
 	 */
 	public static String getFixedSql(String stmt){
-		if (stmt.endsWith("";""))
-			stmt = stmt.substring(0,stmt.length()-2);
 		stmt = stmt.replaceAll(""\r\n"", "" ""); //对于\r\n的字符 用 空格处理 rainbow
 		return stmt = stmt.trim(); //.toUpperCase();    
 	}
@@ -1101,7 +1099,8 @@
 	 * @return
 	 */
 	public static boolean isNoSharding(SchemaConfig schemaConfig, String tableName) {
-		
+		// Table名字被转化为大写的，存储在schema
+		tableName = tableName.toUpperCase();
 		if (schemaConfig.isNoSharding()) {
 			return true;
 		}",0
Fixed toMojoFailureException() when e.getCause() is null,"     private static final Logger LOGGER = LoggerFactory.getLogger(MojoUtils.class);
 
     static <E extends Throwable> MojoFailureException toMojoFailureException(E e) {
-        return new MojoFailureException(e.getMessage() + "": "" + e.getCause().getMessage(), e);
+        String causeMessage = e.getCause() != null ? "": "" + e.getCause().getMessage() : """";
+        return new MojoFailureException(e.getMessage() + causeMessage, e);
     }
 
     static ProxyConfig getProxyConfig(MavenSession mavenSession, SettingsDecrypter decrypter) {",0
Fixed bug that broke ScrollPane.setupFadeScrollBars," 		boolean panning = flickScrollListener.getGestureDetector().isPanning();
 
 		if (fadeAlpha > 0 && fadeScrollBars && !panning && !touchScrollH && !touchScrollV) {
-			fadeDelay -= fadeDelaySeconds * delta;
-			if (fadeDelay <= 0) fadeAlpha = Math.max(0, fadeAlpha - fadeAlphaSeconds * delta);
+			fadeDelay -= delta;
+			if (fadeDelay <= 0) fadeAlpha = Math.max(0, fadeAlpha - delta);
 		}
 
 		if (flingTimer > 0) {",0
"Add ""one"" to binding necklace regex matching group"," )
 public class RunecraftPlugin extends Plugin
 {
-	private static Pattern bindNeckString = Pattern.compile(""You have ([0-9]+) charges left before your Binding necklace disintegrates."");
+	private static Pattern bindNeckString = Pattern.compile(""You have ([0-9]+|one) charges? left before your Binding necklace disintegrates."");
 	private static final String POUCH_DECAYED_NOTIFICATION_MESSAGE = ""Your rune pouch has decayed."";
 	private static final String POUCH_DECAYED_MESSAGE = ""Your pouch has decayed through use."";
 	private static final int DESTROY_ITEM_WIDGET_ID = WidgetInfo.DESTROY_ITEM_YES.getId();
@@ -151,7 +151,15 @@
 			Matcher match = bindNeckString.matcher(event.getMessage());
 			if (match.find())
 			{
+				if (match.group(1).equals(""one""))
+				{
+					bindNeckOverlay.bindingCharges = 1;
+				}
+				else
+				{
 				bindNeckOverlay.bindingCharges = Integer.parseInt(match.group(1));
+				}
+
 				return;
 			}
 ",0
Fixed issue with overriding handlers,"   public S binaryMessageHandler(Handler<Buffer> handler) {
     synchronized (conn) {
       checkClosed();
-      if (frameHandler == null || frameHandler.getClass() == FrameAggregator.class) {
+      if (frameHandler == null || frameHandler.getClass() != FrameAggregator.class) {
         frameHandler = new FrameAggregator();
       }
       ((FrameAggregator) frameHandler).binaryMessageHandler = handler;",0
Fixed setHostnameVerifier not invoke," import java.util.StringTokenizer;
 import java.util.TimeZone;
 
+import javax.net.ssl.HostnameVerifier;
 import javax.net.ssl.HttpsURLConnection;
 import javax.net.ssl.SSLSocketFactory;
 
@@ -141,6 +142,11 @@
                 if (sslSocketFactory != null) {
                     ((HttpsURLConnection) connection).setSSLSocketFactory(sslSocketFactory);
                 }
+
+                HostnameVerifier hostnameVerifier = params.getHostnameVerifier();
+                if (hostnameVerifier != null) {
+                    ((HttpsURLConnection) connection).setHostnameVerifier(hostnameVerifier);
+                }
             }
         }
 ",0
Remove unnecessary cast between long/double and floor call," 
     private void assertValidDateClaim(Date date, long leeway, boolean shouldBeFuture) {
         Date today = clock.getToday();
-        today.setTime((long) Math.floor((today.getTime() / 1000) * 1000)); // truncate millis
+        today.setTime(today.getTime() / 1000 * 1000); // truncate millis
         if (shouldBeFuture) {
             assertDateIsFuture(date, leeway, today);
         } else {",0
Fix project build," import the.bytecode.club.bytecodeviewer.obfuscators.rename.RenameMethods;
 import the.bytecode.club.bytecodeviewer.plugin.PluginManager;
 import the.bytecode.club.bytecodeviewer.plugin.preinstalled.CodeSequenceDiagram;
-import the.bytecode.club.bytecodeviewer.plugins.AllatoriStringDecrypter;
-import the.bytecode.club.bytecodeviewer.plugins.ShowAllStrings;
-import the.bytecode.club.bytecodeviewer.plugins.ShowMainMethods;
-import the.bytecode.club.bytecodeviewer.plugins.ZKMStringDecrypter;
-import the.bytecode.club.bytecodeviewer.plugins.ZStringArrayDecrypter;
+import the.bytecode.club.bytecodeviewer.plugin.preinstalled.AllatoriStringDecrypter;
+import the.bytecode.club.bytecodeviewer.plugin.preinstalled.ShowAllStrings;
+import the.bytecode.club.bytecodeviewer.plugin.preinstalled.ShowMainMethods;
+import the.bytecode.club.bytecodeviewer.plugin.preinstalled.ZKMStringDecrypter;
+import the.bytecode.club.bytecodeviewer.plugin.preinstalled.ZStringArrayDecrypter;
 
 /**
  * The main file for the GUI.n",0
Dont use proxy settings if ssl is enabled. Fixes #1281,"     public DefaultHttpClient(URL url, HttpClientConfiguration configuration) {
         this(
                 LoadBalancer.fixed(url), configuration, null, new DefaultThreadFactory(MultithreadEventLoopGroup.class),
-                createSslBuilder(), createDefaultMediaTypeRegistry(),
+                createSslBuilder(configuration), createDefaultMediaTypeRegistry(),
                 AnnotationMetadataResolver.DEFAULT
         );
     }
@@ -360,7 +360,7 @@
     public DefaultHttpClient(URL url, HttpClientConfiguration configuration, String contextPath) {
         this(
                 LoadBalancer.fixed(url), configuration, contextPath, new DefaultThreadFactory(MultithreadEventLoopGroup.class),
-                createSslBuilder(), createDefaultMediaTypeRegistry(),
+                createSslBuilder(configuration), createDefaultMediaTypeRegistry(),
                 AnnotationMetadataResolver.DEFAULT
         );
     }
@@ -1233,7 +1233,8 @@
         final SslContext sslCtx;
         if (uriObject.getScheme().equals(""https"")) {
             sslCtx = sslContext;
-            if (sslCtx == null) {
+            //Allow https requests to be sent if SSL is disabled but a proxy is present
+            if (sslCtx == null && !configuration.getProxyAddress().isPresent()) {
                 throw new HttpClientException(""Cannot send HTTPS request. SSL is disabled"");
             }
         } else {
@@ -1941,8 +1942,8 @@
         );
     }
 
-    private static NettyClientSslBuilder createSslBuilder() {
-        return new NettyClientSslBuilder(new ClientSslConfiguration(), new ResourceResolver());
+    private static NettyClientSslBuilder createSslBuilder(HttpClientConfiguration configuration) {
+        return new NettyClientSslBuilder(configuration.getSslConfiguration());
     }
 
     private <I> NettyRequestWriter prepareRequest(io.micronaut.http.HttpRequest<I> request, URI requestURI) throws HttpPostRequestEncoder.ErrorDataEncoderException {
@@ -2039,6 +2040,8 @@
                 ch.config().setAutoRead(false);
             }
 
+            Optional<SocketAddress> proxy = configuration.getProxyAddress();
+
             if (sslContext != null) {
                 SslHandler sslHandler = sslContext.newHandler(
                         ch.alloc(),
@@ -2046,10 +2049,11 @@
                         port
                 );
                 p.addFirst(HANDLER_SSL, sslHandler);
-            }
 
-            Optional<SocketAddress> proxy = configuration.getProxyAddress();
-            if (proxy.isPresent()) {
+                if (LOG.isDebugEnabled() && proxy.isPresent()) {
+                    LOG.debug(""HttpClient proxy settings will be ignored because SSL is enabled"");
+                }
+            } else if (proxy.isPresent()) {
                 Type proxyType = configuration.getProxyType();
                 SocketAddress proxyAddress = proxy.get();
                 configureProxy(p, proxyType, proxyAddress);",0
Memory leak in IAddonThemes fix," 
 package org.holoeverywhere.addon;
 
+import java.lang.ref.WeakReference;
 import java.util.Map;
 import java.util.WeakHashMap;
 
@@ -21,7 +22,7 @@
         public int resolveThemeForContext(Context context, int invalidTheme);
     }
 
-    private Map<Context, AddonThemeWrapper> mContexts;
+    private Map<Context, WeakReference<AddonThemeWrapper>> mContexts;
     private int mDarkTheme = -1;
     private final ThemeResolver mDefaultThemeResolver = new ThemeResolver() {
         @Override
@@ -63,7 +64,9 @@
         }
         AddonThemeWrapper wrapper = null;
         if (mContexts != null) {
-            mContexts.get(context);
+			WeakReference<AddonThemeWrapper> wrapperReference = mContexts
+					.get(context);
+			wrapper = wrapperReference == null ? null : wrapperReference.get();
         }
         if (wrapper == null) {
             final int theme = themeResolver.resolveThemeForContext(context, invalidTheme);
@@ -72,9 +75,10 @@
             }
             wrapper = new AddonThemeWrapper(context, theme);
             if (mContexts == null) {
-                mContexts = new WeakHashMap<Context, AddonThemeWrapper>();
+				mContexts = new WeakHashMap<Context, WeakReference<AddonThemeWrapper>>();
             }
-            mContexts.put(context, wrapper);
+			mContexts.put(context,
+					new WeakReference<AddonThemeWrapper>(wrapper));
         }
         return wrapper;
     }",0
Fixed bug in ActionMenuItem.setVisible method.,"      }
 
      public MenuItem setVisible(boolean visible) {
-         mFlags = (mFlags & HIDDEN) | (visible ? 0 : HIDDEN);
+         mFlags = (mFlags & ~HIDDEN) | (visible ? 0 : HIDDEN);
          return this;
      }
 ",0
Fixed NPE,"     private NotificationManager mNotificationManager;
 
     @Override
+    public void onCreate() {
+        super.onCreate();
+        mNotificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
+    }
+    
+    @Override
     public void onStart(Intent intent, int startId) {
         super.onStart(intent, startId);
-        mNotificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
     }
 
     @Override",0
Fix mouse sensitivity set to 0 when resetting input config.," 
 import org.terasology.context.Context;
 
-/**
- */
 public class InputConfig {
 
     private BindsConfig binds = new BindsConfig();
@@ -39,9 +37,13 @@
 
     public void reset(Context context) {
         binds.setBinds(BindsConfig.createDefault(context));
-        InputConfig defaultConfig = new InputConfig();
-        setMouseSensitivity(defaultConfig.mouseSensitivity);
-        setMouseYAxisInverted(defaultConfig.mouseYAxisInverted);
+        
+        Config defaultConfig = new Config();
+        defaultConfig.loadDefaults();
+        InputConfig defaultInputConfig = defaultConfig.getInput();
+
+        setMouseSensitivity(defaultInputConfig.mouseSensitivity);
+        setMouseYAxisInverted(defaultInputConfig.mouseYAxisInverted);
     }
 
     public boolean isMouseYAxisInverted() {",0
SORRY 修复短信预警的BUG，造成编译不通过," import org.opencloudb.net.mysql.AuthPacket;
 import org.opencloudb.net.mysql.MySQLPacket;
 import org.opencloudb.net.mysql.QuitPacket;
-import org.opencloudb.sms.SmsThread;
 
 /**
  * 前端认证处理器
@@ -113,18 +112,6 @@
 			}
 		
 			if ( forntedsLength >= benchmark ) {				
-				//预警通知
-				String tel = source.getPrivileges().getBenchmarkSmsTel(user);
-				if ( tel != null ) {
-					
-					StringBuffer cBuffer = new StringBuffer();
-					cBuffer.append(""mycat access denied user="").append( user ).append("","");
-					cBuffer.append(""limit="").append( benchmark ).append("","");
-					cBuffer.append(""fornteds="").append( forntedsLength ).append("","");
-					cBuffer.append(""so service degrade"");
-
-					new Thread( new SmsThread(tel, cBuffer.toString()) ).start();;
-				}				
 				return true;
 			}			
     	}",0
Fix picture taking on Android KK and below," import android.content.BroadcastReceiver;
 import android.content.Context;
 import android.content.Intent;
+import android.content.pm.PackageManager;
+import android.content.pm.ResolveInfo;
 import android.net.Uri;
 import android.os.Bundle;
 import android.os.Environment;
@@ -254,6 +256,16 @@
         Intent takePictureIntent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
         takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT, mFileUri);
 
+        // Grant permission to camera (this is required on KitKat and below)
+        List<ResolveInfo> resolveInfos = getPackageManager()
+                .queryIntentActivities(takePictureIntent, PackageManager.MATCH_DEFAULT_ONLY);
+        for (ResolveInfo resolveInfo : resolveInfos) {
+            String packageName = resolveInfo.activityInfo.packageName;
+            grantUriPermission(packageName, mFileUri,
+                    Intent.FLAG_GRANT_WRITE_URI_PERMISSION | Intent.FLAG_GRANT_READ_URI_PERMISSION);
+        }
+
+        // Start picture-taking intent
         startActivityForResult(takePictureIntent, RC_TAKE_PICTURE);
     }
 ",0
"Fix ""withSliderBackgroundDrawableRes""","         } else if (mSliderBackgroundDrawable != null) {
             UIUtils.setBackground(mSliderLayout, mSliderBackgroundDrawable);
         } else if (mSliderBackgroundDrawableRes != -1) {
-            UIUtils.setBackground(mSliderLayout, mSliderBackgroundColorRes);
+            UIUtils.setBackground(mSliderLayout, mSliderBackgroundDrawableRes);
         }
 
         //handle the header",0
[Android] fix crash after using the camera,"       try {
         String isoFormatString = isoFormat.format(exifDatetimeFormat.parse(timestamp)) + ""Z"";
         response.putString(""timestamp"", isoFormatString);
-      } catch (ParseException e) {}
+      } catch (Exception e) {}
 
       int orientation = exif.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL);
       boolean isVertical = true;",0
Fix format in ParticleControllerComponent," 		 TMP_V4 = new Vector3(), 
 		 TMP_V5 = new Vector3(),
 		 TMP_V6 = new Vector3();
-	protected static final Quaternion 	TMP_Q = new Quaternion(),
-													TMP_Q2 = new Quaternion();
+	protected static final Quaternion TMP_Q = new Quaternion(), TMP_Q2 = new Quaternion();
 	protected static final Matrix3 TMP_M3 = new Matrix3();
 	protected static final Matrix4 TMP_M4 = new Matrix4();
 	protected ParticleController controller;",0
Fixed local cache resolution of getAllAsync,"         Set<K> mapKeys = new HashSet<K>(keys);
         for (Iterator<K> iterator = mapKeys.iterator(); iterator.hasNext();) {
             K key = iterator.next();
-            CacheValue value = cache.get(key);
+            final CacheKey cacheKey = toCacheKey(key);
+            CacheValue value = cache.get(cacheKey);
             if (value != null) {
                 result.put(key, (V)value.getValue());
                 iterator.remove();",0
Update JMSEmailServiceProducerImpl.java,"                     return message;
                 }
             });
-        }
+        } else {
         throw new IllegalArgumentException(""The properties map must be Serializable"");
     }
+    }
 
     /**
      * @return the emailServiceTemplate",0
Fix for parsing brokenRids ,"           importIndexes();
         else if (tag.equals(""manualIndexes""))
           importManualIndexes();
+        else if (tag.equals(""brokenRids"")){
+          processBrokenRids();
+          continue;
+        }
         else
           throw new ODatabaseImportException(""Invalid format. Found unsupported tag '"" + tag + ""'"");
       }
@@ -231,6 +235,38 @@
     return this;
   }
 
+  private void processBrokenRids() throws IOException, ParseException{
+    Set<ORID> brokenRids = new HashSet<ORID>();
+    processBrokenRids(brokenRids);
+    jsonReader.readNext(OJSONReader.COMMA_SEPARATOR);
+  }
+  
+  //just read collection so import process can continue
+  private void processBrokenRids(Set<ORID> brokenRids) throws IOException, ParseException{
+    if (exporterVersion >= 12){
+      listener.onMessage(""Reading of set of RIDs of records which were detected as broken during database export\n"");
+      
+      jsonReader.readNext(OJSONReader.BEGIN_COLLECTION);
+
+      while (true) {
+        jsonReader.readNext(OJSONReader.NEXT_IN_ARRAY);
+
+        final ORecordId recordId = new ORecordId(jsonReader.getValue());
+        brokenRids.add(recordId);
+
+        if (jsonReader.lastChar() == ']')
+          break;
+      }
+    }
+    if (migrateLinks) {
+      if (exporterVersion >= 12)
+        listener.onMessage(
+            brokenRids.size() + "" were detected as broken during database export, links on those records will be removed from""
+                + "" result database"");
+      migrateLinksInImportedDocuments(brokenRids);
+    }
+  }
+
   public void rebuildIndexes() {
     database.getMetadata().getIndexManager().reload();
 
@@ -1066,29 +1102,7 @@
     }
 
     final Set<ORID> brokenRids = new HashSet<ORID>();
-
-    if (exporterVersion >= 12) {
-      listener.onMessage(""Reading of set of RIDs of records which were detected as broken during database export\n"");
-
-      jsonReader.readNext(OJSONReader.BEGIN_COLLECTION);
-
-      while (true) {
-        jsonReader.readNext(OJSONReader.NEXT_IN_ARRAY);
-
-        final ORecordId recordId = new ORecordId(jsonReader.getValue());
-        brokenRids.add(recordId);
-
-        if (jsonReader.lastChar() == ']')
-          break;
-      }
-    }
-    if (migrateLinks) {
-      if (exporterVersion >= 12)
-        listener.onMessage(
-            brokenRids.size() + "" were detected as broken during database export, links on those records will be removed from""
-                + "" result database"");
-      migrateLinksInImportedDocuments(brokenRids);
-    }
+    processBrokenRids(brokenRids);
 
     listener.onMessage(String.format(""\n\nDone. Imported %,d records in %,.2f secs\n"", totalRecords,
         ((float) (System.currentTimeMillis() - begin)) / 1000));",0
Fix doc reference to Token.,"  *         id = reader.nextLong();
  *       } else if (name.equals(""text"")) {
  *         text = reader.nextString();
- *       } else if (name.equals(""geo"") && reader.peek() != JsonToken.NULL) {
+ *       } else if (name.equals(""geo"") && reader.peek() != Token.NULL) {
  *         geo = readDoublesArray(reader);
  *       } else if (name.equals(""user"")) {
  *         user = readUser(reader);",0
Fix JavaDoc comment,"      * Indirect the native pointer, copying <em>from</em> memory pointed to by
      * native pointer, into the specified array.
      *
-     * @param offset byte offset from pointer into which data is copied
+     * @param offset byte offset from pointer from which data is copied
      * @param buf    <code>byte</code> array into which data is copied
-     * @param index  array index from which to start copying
+     * @param index  array index to which data is copied
      * @param length number of elements from native pointer that must be copied
      */
     public void read(long offset, byte[] buf, int index, int length) {",0
merge fix from 2.7.0 to 2.6.x," 
     @Override
     public Result invoke(Invocation inv) throws RpcException {
+        // if invoker is destroyed due to address refresh from registry, let's allow the current invoke to proceed
         if (destroyed.get()) {
-            throw new RpcException(""Rpc invoker for service "" + this + "" on consumer "" + NetUtils.getLocalHost()
-                    + "" use dubbo version "" + Version.getVersion()
-                    + "" is DESTROYED, can not be invoked any more!"");
+            logger.warn(""Invoker for service "" + this + "" on consumer "" + NetUtils.getLocalHost() + "" is destroyed, ""
+                    + "", dubbo version is "" + Version.getVersion() + "", this invoker should not be used any longer"");
         }
+
         RpcInvocation invocation = (RpcInvocation) inv;
         invocation.setInvoker(this);
         if (attachment != null && attachment.size() > 0) {",0
fix typo in javadoc for JsonParser.Feature," 
         /**
          * Feature that can be enabled to accept quoting of all character
-         * using backslash qooting mechanism: if not enabled, only characters
+         * using backslash quoting mechanism: if not enabled, only characters
          * that are explicitly listed by JSON specification can be thus
          * escaped (see JSON spec for small list of these characters)
          *<p>",0
Fix empty of enum form property of model created by Activiti modeler,"                                 for (JsonNode enumNode : enumValuesNode) {
                                     if (enumNode.get(""value"") != null && enumNode.get(""value"").isNull() == false) {
                                         FormValue formValue = new FormValue();
+                                        formValue.setId(enumNode.get(""value"").asText());
                                         formValue.setName(enumNode.get(""value"").asText());
                                         formValueList.add(formValue);
                                     }",0
"Revert ""JENKINS-48322# Fix replaceIfNotAtTopLevel warning"""," public class BlueOceanUrlObjectImpl extends BlueOceanUrlObject {
 
     private volatile String mappedUrl;
-    private transient final ModelObject modelObject;
+    private final ModelObject modelObject;
 
     public BlueOceanUrlObjectImpl(ModelObject modelObject) {
         this.modelObject = modelObject;",0
Fixed bug #203,"             openCurrent();
             play();
             notifyChange(InternalIntents.META_CHANGED);
+            notifyChange(InternalIntents.QUEUE_CHANGED);
         }
     }
 
@@ -2224,6 +2225,7 @@
             openCurrentAndNext();
             play();
             notifyChange(InternalIntents.META_CHANGED);
+            notifyChange(InternalIntents.QUEUE_CHANGED);
         }
     }
 ",0
Fixes #351 and authCache Null Pointer exception,"     if (auths != null) {
       for (String sessionID: auths) {
         Auth auth = authCache.remove(sessionID);
+        if (auth != null) {
         auth.cancel();
       }
     }
+    }
     handleSocketClosed(sock);
   }
 
@@ -143,9 +145,14 @@
     if (handleRegister(sock, address)) {
       Handler<Message<JsonObject>> handler = new Handler<Message<JsonObject>>() {
         public void handle(final Message<JsonObject> msg) {
-          if (checkMatches(false, address, msg.body, sockAuths.get(sock) != null)) {
+          Match curMatch = checkMatches(false, address, msg.body);
+          if (curMatch.doesMatch) {
+            if (curMatch.requiresAuth && sockAuths.get(sock) == null) {
+              log.debug(""Outbound message for address "" + address + "" rejected because auth is required and socket is not authed"");
+            } else {
             checkAddAccceptedReplyAddress(msg.replyAddress);
             deliverMessage(sock, address, msg);
+            }
           } else {
             log.debug(""Outbound message for address "" + address + "" rejected because there is no inbound match"");
           }
@@ -229,6 +236,10 @@
       log.debug(""Received msg from client in bridge. address:""  + address + "" message:"" + jsonObject.encode());
     }
 
+    Match curMatch = checkMatches(true, address, jsonObject);
+
+    if (curMatch.doesMatch) {
+      if (curMatch.requiresAuth) {
     final String sessionID = jsonObject.getString(""sessionID"");
     if (sessionID != null) {
       authorise(jsonObject, sessionID, new AsyncResultHandler<Boolean>() {
@@ -236,23 +247,29 @@
           if (res.succeeded()) {
             if (res.result) {
               cacheAuthorisation(sessionID, sock);
+                  checkAndSend(send, address, jsonObject, sock, replyAddress);
+                } else {
+                  log.debug(""Inbound message for address "" + address + "" rejected because sessionID is not authorised"");
             }
-            checkAndSend(send, address, jsonObject, res.result, sock, replyAddress);
           } else {
             log.error(""Error in performing authorisation"", res.exception);
           }
         }
       });
     } else {
-      checkAndSend(send, address, jsonObject, false, sock, replyAddress);
+          log.debug(""Inbound message for address "" + address + "" rejected because it requires auth and sessionID is missing"");
+        }
+      } else {
+        checkAndSend(send, address, jsonObject, sock, replyAddress);
+      }
+    } else {
+      log.debug(""Inbound message for address "" + address + "" rejected because there is no match"");
     }
   }
 
   private void checkAndSend(boolean send, final String address, JsonObject jsonObject,
-                            boolean authed,
                             final SockJSSocket sock,
                             final String replyAddress) {
-    if (checkMatches(true, address, jsonObject, authed)) {
       final Handler<Message<JsonObject>> replyHandler;
       if (replyAddress != null) {
         replyHandler = new Handler<Message<JsonObject>>() {
@@ -275,9 +292,6 @@
       } else {
         eb.publish(address, jsonObject);
       }
-    } else {
-      log.debug(""Inbound message for address "" + address + "" rejected because there is no match"");
-    }
   }
 
   private void authorise(final JsonObject message, final String sessionID,
@@ -300,11 +314,11 @@
   If at least one match is supplied and all the fields of any match match then the message inboundPermitted,
   this means that specifying one match with a JSON empty object means everything is accepted
    */
-  private boolean checkMatches(boolean inbound, String address, JsonObject message, boolean authed) {
+  private Match checkMatches(boolean inbound, String address, JsonObject message) {
 
     if (inbound && acceptedReplyAddresses.remove(address)) {
       // This is an inbound reply, so we accept it
-      return true;
+      return new Match(true, false);
     }
 
     List<JsonObject> matches = inbound ? inboundPermitted : outboundPermitted;
@@ -330,13 +344,6 @@
       }
 
       if (addressOK) {
-        Boolean b = matchHolder.getBoolean(""requires_auth"");
-        boolean requiresAuth = b != null && b;
-        if (requiresAuth && !authed) {
-          // No match since user is not authed
-          log.debug(""Rejecting match since user is not authorised"");
-          break;
-        }
         boolean matched = true;
         JsonObject match = matchHolder.getObject(""match"");
         if (match != null) {
@@ -348,11 +355,12 @@
           }
         }
         if (matched) {
-          return true;
+          Boolean b = matchHolder.getBoolean(""requires_auth"");
+          return new Match(true, b != null && b);
         }
       }
     }
-    return false;
+    return new Match(false, false);
   }
 
   private boolean regexMatches(String matchRegex, String address) {
@@ -387,6 +395,17 @@
     }
   }
 
+  private class Match {
+    public final boolean doesMatch;
+    public final boolean requiresAuth;
+
+    Match(final boolean doesMatch, final boolean requiresAuth) {
+      this.doesMatch = doesMatch;
+      this.requiresAuth = requiresAuth;
+    }
+
+  }
+
   private class Auth {
     private final long timerID;
 ",0
Fix for issue #5245.,"       if (rebuildIndexes)
         rebuildIndexes();
 
+      // This is needed to insure functions loaded into an open
+      // in memory database are available after the import.
+      // see issue #5245
+      database.getMetadata().reload();
+      
       database.getStorage().synch();
       database.setStatus(STATUS.OPEN);
 ",0
CpuSpriteBatch - fix #2630," 		super(size, defaultShader);
 	}
 
-	/** Finishes off rendering and realigns the real matrix on the GPU. */
-	@Override
-	public void end () {
-		super.end();
-		flushAndSyncTransformMatrix();
-	}
-
-	/** Flushes the batch and realigns the real matrix on the GPU. Subsequent draws won't need adjustment and will be slightly
+	/** <p>
+	 * Flushes the batch and realigns the real matrix on the GPU. Subsequent draws won't need adjustment and will be slightly
 	 * faster as long as the transform matrix is not {@link #setTransformMatrix(Matrix4) changed}.
+	 * </p>
+	 * <p>
+	 * Note: The real transform matrix <em>must</em> be invertible. If a singular matrix is detected, GdxRuntimeException will be
+	 * thrown.
+	 * </p>
 	 * @see SpriteBatch#flush() */
 	public void flushAndSyncTransformMatrix () {
 		flush();
 
 		if (adjustNeeded) {
-			// done rendering, safe now to replace matrix
+			// vertices flushed, safe now to replace matrix
+			haveIdentityRealMatrix = checkIdt(virtualMatrix);
+
+			if (!haveIdentityRealMatrix && virtualMatrix.det() == 0)
+				throw new GdxRuntimeException(""Transform matrix is singular, can't sync"");
+
 			adjustNeeded = false;
 			super.setTransformMatrix(virtualMatrix);
-			haveIdentityRealMatrix = checkIdt(virtualMatrix);
 		}
 	}
 
@@ -86,7 +89,7 @@
 	/** Sets the transform matrix to be used by this Batch. Even if this is called inside a {@link #begin()}/{@link #end()} block,
 	 * the current batch is <em>not</em> flushed to the GPU. Instead, for every subsequent draw() the vertices will be transformed
 	 * on the CPU to match the original batch matrix. This adjustment must be performed until the matrices are realigned by
-	 * restoring the original matrix, or by calling {@link #flushAndSyncTransformMatrix()} or {@link #end()}. */
+	 * restoring the original matrix, or by calling {@link #flushAndSyncTransformMatrix()}. */
 	@Override
 	public void setTransformMatrix (Matrix4 transform) {
 		Matrix4 realMatrix = super.getTransformMatrix();
@@ -590,6 +593,8 @@
 	}
 
 	private void drawAdjusted (Texture texture, float[] spriteVertices, int offset, int count) {
+		if (!drawing) throw new IllegalStateException(""CpuSpriteBatch.begin must be called before draw."");
+
 		if (texture != lastTexture) switchTexture(texture);
 
 		Affine2 t = adjustAffine;",0
Fixed an issue where the hud throw marker would get stuck if player d…," 
 package org.terasology.logic.inventory;
 
+import org.terasology.logic.characters.events.DeathEvent;
 import org.terasology.utilities.Assets;
 import org.terasology.audio.events.PlaySoundForOwnerEvent;
 import org.terasology.engine.Time;
@@ -217,4 +218,10 @@
         }
     }
 
+    @ReceiveEvent(netFilter = RegisterMode.CLIENT)
+    public void onPlayerDeath(DeathEvent event, EntityRef entity)
+    {
+        resetDropMark();
+    }
+
 }",0
Fix channel loss on reconnect," 
         if (!channels.isEmpty()) {
             subscribe(toArray(channels));
-            channels.clear();
         }
 
         if (!patterns.isEmpty()) {
             psubscribe(toArray(patterns));
-            patterns.clear();
         }
     }
 ",0
Escape regular expression character in split,"                                                 String ceilingEntityFullyQualifiedClassname, Boolean isComponentPrefix) {
         Boolean includeField = true;
         //don't want to shun a self-referencing property in an @Embeddable
-        boolean shouldTest = !StringUtils.isEmpty(prefix) && (!isComponentPrefix || prefix.split(""."").length > 1);
+        boolean shouldTest = !StringUtils.isEmpty(prefix) && (!isComponentPrefix || prefix.split(""\\."").length > 1);
         if (shouldTest) {
             Field testField = getFieldManager().getField(targetClass, propertyName);
             if (testField == null) {",0
Update MyActivity.java for fixing NULLPOINTEREXCEPTION,"         findViewById(R.id.hello_world).setOnClickListener(new View.OnClickListener() {
             @Override
             public void onClick(View v) {
+                if (rope != null) {
                 rope.stop(true);
             }
+            }
         });
     }
     private YoYo.YoYoString rope;",0
[1.8] Fix Scoreboard rendering for the sidebar.,"             if (slot >= 0) objective = scoreboard.getObjectiveInDisplaySlot(3 + slot);
         }
         ScoreObjective scoreobjective1 = objective != null ? objective : scoreboard.getObjectiveInDisplaySlot(1);
-        if (renderObjective && objective != null)
+        if (renderObjective && scoreobjective1 != null)
         {
-            this.func_180475_a(objective, res);
+            this.func_180475_a(scoreobjective1, res);
         }
 
         GlStateManager.enableBlend();",0
 Fix for simulator tests MangleICacheTest and MangleICacheTest," 
 package com.hazelcast.client.impl.protocol.task.cache;
 
+import com.hazelcast.cache.CacheNotExistsException;
 import com.hazelcast.cache.impl.CacheOperationProvider;
 import com.hazelcast.cache.impl.CacheService;
 import com.hazelcast.cache.impl.ICacheService;
@@ -41,6 +42,10 @@
     protected CacheOperationProvider getOperationProvider(String name) {
         ICacheService service = getService(CacheService.SERVICE_NAME);
         final CacheConfig cacheConfig = service.getCacheConfig(name);
+        if (cacheConfig == null) {
+            throw new CacheNotExistsException(""Cache is already destroyed or not created yet, on ""
+                    + nodeEngine.getLocalMember());
+        }
         final InMemoryFormat inMemoryFormat = cacheConfig.getInMemoryFormat();
         return service.getCacheOperationProvider(name, inMemoryFormat);
     }",0
CAMEL-10273 - Jetty. Fixes jmx for custom ThreadPools,"                     
                 } else {
                     s = new Server();
+                    if (isEnableJmx()) {
+                        enableJmx(s);
+                    }
                     Server.class.getMethod(""setThreadPool"", ThreadPool.class).invoke(s, tp);
                 }
             } catch (Exception e) {",0
Fix style,,0
Try and AcquireConnection when entry is FreezeReason SYSTEM not only for MASTER,"     }
 
     public RFuture<T> get(RedisCommand<?> command, ClientConnectionsEntry entry) {
-        if (((entry.getNodeType() == NodeType.MASTER && entry.getFreezeReason() == FreezeReason.SYSTEM) || !entry.isFreezed())
-                && tryAcquireConnection(entry)) {
+        if ((!entry.isFreezed() || entry.getFreezeReason() == FreezeReason.SYSTEM) && 
+        		tryAcquireConnection(entry)) {
             return acquireConnection(command, entry);
         }
 ",0
Fix cannot finish PurchaseActivity from toolbar," import android.support.annotation.Nullable;
 import android.support.v7.widget.Toolbar;
 import android.util.Log;
+import android.view.MenuItem;
 import android.view.View;
 import android.widget.Button;
 import android.widget.Toast;
@@ -121,6 +122,17 @@
     }
 
     @Override
+    public boolean onOptionsItemSelected(MenuItem item) {
+        switch (item.getItemId()) {
+            case android.R.id.home:
+                finish();
+                break;
+        }
+
+        return super.onOptionsItemSelected(item);
+    }
+
+    @Override
     public void onDestroy() {
         if (billingProcessor != null) {
             billingProcessor.release();",0
Fix: NPE in requestFromChild method.," 
         private void requestFromChild(long n) {
             // we track 'requested' so we know whether we should subscribe the next or not
+            ConcatInnerSubscriber<T> actualSubscriber = currentSubscriber;
             if (REQUESTED_UPDATER.getAndAdd(this, n) == 0) {
-                if (currentSubscriber == null && wip > 0) {
+                if (actualSubscriber == null && wip > 0) {
                     // this means we may be moving from one subscriber to another after having stopped processing
                     // so need to kick off the subscribe via this request notification
                     subscribeNext();
@@ -124,9 +125,9 @@
                 }
             } 
                 
-            if (currentSubscriber != null) {
+            if (actualSubscriber != null) {
                 // otherwise we are just passing it through to the currentSubscriber
-                currentSubscriber.requestMore(n);
+                actualSubscriber.requestMore(n);
             }
         }
 ",0
fix typo in javadoc,"  * Wrapper for write timeout. This should always be the first wrapper applied to the underlying channel.
  *
  * @author Stuart Douglas
- * @see org.xnio.Options#READ_TIMEOUT
+ * @see org.xnio.Options#WRITE_TIMEOUT
  */
 public final class WriteTimeoutStreamSinkConduit extends AbstractStreamSinkConduit<StreamSinkConduit> {
 ",0
[#171] Allow running on JDK 8 and possibly on JDK 7 as well. Fixes #171,"                 Class<?> defineClass(String name, byte[] b, int off, int len,
                         ClassLoader loader, ProtectionDomain protectionDomain)
                                 throws ClassFormatError {
-                    if (stack.getCallerClass() != SecuredPrivileged.JAVA_9.getClass())
+                    try {
+                        if (getCallerClass.invoke(stack) != SecuredPrivileged.JAVA_9.getClass())
                         throw new IllegalAccessError(""Access denied for caller."");
+                    } catch (Exception e) {
+                        throw new RuntimeException(""cannot initialize"", e);
+                    }
                     try {
                         return (Class<?>) defineClass.invokeWithArguments(
                                 sunMiscUnsafeTheUnsafe.theUnsafe,
@@ -64,14 +68,40 @@
                     }
                 }
             }
-            private final StackWalker stack = StackWalker
-                    .getInstance(StackWalker.Option.RETAIN_CLASS_REFERENCE);
+            private final Object stack;
+            private final Method getCallerClass;
+            {
+                Class<?> stackWalkerClass = null;
+                try {
+                    stackWalkerClass = Class.forName(""java.lang.StackWalker"");
+                } catch (ClassNotFoundException e) {
+                    // Skip initialization when the class doesn't exist i.e. we are on JDK < 9
+                }
+                if (stackWalkerClass != null) {
+                    try {
+                        Class<?> optionClass = Class.forName(""java.lang.StackWalker$Option"");
+                        stack = stackWalkerClass.getMethod(""getInstance"", optionClass)
+                                // The first one is RETAIN_CLASS_REFERENCE
+                                .invoke(null, optionClass.getEnumConstants()[0]);
+                        getCallerClass = stackWalkerClass.getMethod(""getCallerClass"");
+                    } catch (Throwable e) {
+                        throw new RuntimeException(""cannot initialize"", e);
+                    }
+                } else {
+                    stack = null;
+                    getCallerClass = null;
+                }
+            }
             private final ReferencedUnsafe sunMiscUnsafe = getReferencedUnsafe();
             private final ReferencedUnsafe getReferencedUnsafe()
             {
+                try {
                 if (null != SecuredPrivileged.JAVA_9
-                        && stack.getCallerClass() != this.getClass())
+                            && getCallerClass.invoke(stack) != this.getClass())
                     throw new IllegalAccessError(""Access denied for caller."");
+                } catch (Exception e) {
+                    throw new RuntimeException(""cannot initialize"", e);
+                }
                 try {
                     SecurityActions.TheUnsafe usf = SecurityActions.getSunMiscUnsafeAnonymously();
                     List<Method> defineClassMethod = usf.methods.get(""defineClass"");
@@ -91,8 +121,12 @@
                     ClassLoader loader, ProtectionDomain protectionDomain)
                             throws ClassFormatError
             {
-                if (stack.getCallerClass() != DefineClassHelper.class)
+                try {
+                    if (getCallerClass.invoke(stack) != DefineClassHelper.class)
                     throw new IllegalAccessError(""Access denied for caller."");
+                } catch (Exception e) {
+                    throw new RuntimeException(""cannot initialize"", e);
+                }
                 return sunMiscUnsafe.defineClass(name, b, off, len, loader,
                         protectionDomain);
             }",0
Only abort transaction if query actually failed," 
         recordDoneStats();
 
-        failureCause.compareAndSet(null, toFailure(throwable));
         boolean failed = queryState.setIf(FAILED, currentState -> !currentState.isDone());
         if (failed) {
             log.debug(throwable, ""Query %s failed"", queryId);
+            failureCause.compareAndSet(null, toFailure(throwable));
+            session.getTransactionId().ifPresent(autoCommit ? transactionManager::asyncAbort : transactionManager::fail);
         }
         else {
             log.debug(throwable, ""Failure after query %s finished"", queryId);
         }
 
-        session.getTransactionId().ifPresent(autoCommit ? transactionManager::asyncAbort : transactionManager::fail);
-
         return failed;
     }
 ",0
ContextSource.startActivity keep intent flags,"         if (mContext instanceof Activity) {
             mContext.startActivity(intent);
         } else {
-            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
+            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
             mContext.startActivity(intent);
         }
     }
@@ -56,7 +56,7 @@
             Activity activity = (Activity) mContext;
             activity.startActivityForResult(intent, requestCode);
         } else {
-            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
+            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
             mContext.startActivity(intent);
         }
     }",0
Fixed wrongly set vertices," 		vertices[vertexOffset++] = offset.x + x + 1;
 		vertices[vertexOffset++] = offset.y + y;
 		vertices[vertexOffset++] = offset.z + z;
-		vertices[vertexOffset++] = 0;
 		vertices[vertexOffset++] = 1;
 		vertices[vertexOffset++] = 0;
+		vertices[vertexOffset++] = 0;
 
 		vertices[vertexOffset++] = offset.x + x + 1;
 		vertices[vertexOffset++] = offset.y + y;
 		vertices[vertexOffset++] = offset.z + z + 1;
-		vertices[vertexOffset++] = 0;
 		vertices[vertexOffset++] = 1;
 		vertices[vertexOffset++] = 0;
+		vertices[vertexOffset++] = 0;
 
 		vertices[vertexOffset++] = offset.x + x + 1;
 		vertices[vertexOffset++] = offset.y + y + 1;
 		vertices[vertexOffset++] = offset.z + z + 1;
-		vertices[vertexOffset++] = 0;
 		vertices[vertexOffset++] = 1;
 		vertices[vertexOffset++] = 0;
+		vertices[vertexOffset++] = 0;
 
 		vertices[vertexOffset++] = offset.x + x + 1;
 		vertices[vertexOffset++] = offset.y + y + 1;
 		vertices[vertexOffset++] = offset.z + z;
-		vertices[vertexOffset++] = 0;
 		vertices[vertexOffset++] = 1;
 		vertices[vertexOffset++] = 0;
+		vertices[vertexOffset++] = 0;
 		return vertexOffset;
 	}
 ",0
JavaScript getPixels Bug: format <==> type confused...," 	@Override
 	public void glReadPixels (int x, int y, int width, int height, int format, int type, Buffer pixels) {
 		// verify request
-		if ((format != WebGLRenderingContext.UNSIGNED_BYTE) || (type != WebGLRenderingContext.RGBA)) {
+		if ((format != WebGLRenderingContext.RGBA) || (type != WebGLRenderingContext.UNSIGNED_BYTE)) {
 			throw new GdxRuntimeException(""Only format UNSIGNED_BYTE for type RGBA is currently supported."");
 		}
 		if (!(pixels instanceof ByteBuffer)) {",0
[#4661] Fix missing field set," 
     private TDataSource toTDataSource(DataSource dataSource) {
         TDataSource tDataSource = new TDataSource(dataSource.getId());
+
+        tDataSource.setServiceTypeCode(dataSource.getServiceTypeCode());
+
         if (dataSource.getDatabaseName() != null) {
             tDataSource.setDatabaseName(dataSource.getDatabaseName());
         }
@@ -66,6 +69,11 @@
         if (dataSource.getActiveConnectionSize() != 0) {
             tDataSource.setActiveConnectionSize(dataSource.getActiveConnectionSize());
         }
+
+        if (dataSource.getUrl() != null) {
+            tDataSource.setUrl(dataSource.getUrl());
+        }
+
         tDataSource.setMaxConnectionSize(dataSource.getMaxConnectionSize());
         return tDataSource;
     }",0
Fix condition precedence,"                 Contact srcContact = findContactById(ev.getFrom());
 
                 if(srcContact == null)
+                {
                     if (logger.isTraceEnabled())
                         logger.trace(""No contact found"");
+                }
                 else
                     handler.processAuthorizationResponse(
                         new AuthorizationResponse(
@@ -1215,8 +1217,10 @@
                 Contact srcContact = findContactById(ev.getFrom());
 
                 if(srcContact == null)
+                {
                     if (logger.isTraceEnabled())
                         logger.trace(""No contact found"");
+                }
                 else
                 {
                     handler.processAuthorizationResponse(",0
Fix the broken viewing of behavior trees.," package org.terasology.logic.behavior.nui;
 
 import com.google.common.collect.Lists;
+import org.terasology.context.Context;
 import org.terasology.entitySystem.Component;
 import org.terasology.entitySystem.entity.EntityRef;
 import org.terasology.logic.behavior.BehaviorComponent;
@@ -38,7 +39,7 @@
 import org.terasology.rendering.nui.widgets.UIDropdown;
 import org.terasology.rendering.nui.widgets.UIList;
 
-import java.awt.*;
+import java.awt.Toolkit;
 import java.awt.datatransfer.Clipboard;
 import java.awt.datatransfer.StringSelection;
 import java.util.List;
@@ -71,6 +72,9 @@
     @In
     private OneOfProviderFactory providerFactory;
 
+    @In
+    private Context context;
+
     @Override
     public void initialise() {
         debugger = new BehaviorDebugger(nodeFactory);
@@ -81,6 +85,7 @@
         selectEntity = find(""select_entity"", UIDropdown.class);
         palette = find(""palette"", UIList.class);
 
+        behaviorEditor.initialize(context);
         behaviorEditor.bindSelection(new Binding<RenderableNode>() {
             private PropertyProvider provider = new PropertyProvider();
 ",0
Fixes #2489 - ESC now recompiles shaders while exiting video settings," import org.terasology.engine.GameEngine;
 import org.terasology.engine.subsystem.DisplayDevice;
 import org.terasology.i18n.TranslationSystem;
+import org.terasology.input.Keyboard;
 import org.terasology.logic.players.LocalPlayer;
 import org.terasology.registry.CoreRegistry;
 import org.terasology.registry.In;
@@ -32,6 +33,7 @@
 import org.terasology.rendering.nui.animation.MenuAnimationSystems;
 import org.terasology.rendering.nui.databinding.BindHelper;
 import org.terasology.rendering.nui.databinding.Binding;
+import org.terasology.rendering.nui.events.NUIKeyEvent;
 import org.terasology.rendering.nui.itemRendering.StringTextRenderer;
 import org.terasology.rendering.nui.itemRendering.ToStringTextRenderer;
 import org.terasology.rendering.nui.widgets.UIDropdown;
@@ -263,11 +265,24 @@
         }
 
         WidgetUtil.trySubscribe(this, ""close"", button -> {
+            saveSettings();
+        });
+    }
+
+
+    @Override
+    public boolean onKeyEvent(NUIKeyEvent event) {
+        if (event.isDown() && event.getKey() == Keyboard.Key.ESCAPE) {
+            saveSettings();
+        }
+        return false;
+    }
+
+    public void saveSettings() {
             logger.info(""Video Settings: {}"", config.renderConfigAsJson(config.getRendering()));
             // TODO: add a dirty flag that checks if recompiling is needed
             CoreRegistry.get(ShaderManager.class).recompileAllShaders();
             triggerBackAnimation();
-        });
     }
 
     @Override",0
"UpdateExecutor can create a parameterized query with an IN clause that has no params, causing a SQLException","             } else {
                 arraySize = 800;
                 test -= arraySize;
+                if (test == 0) {
+                    eof = true;
+                }
             }
             Long[] temp = new Long[arraySize];
             System.arraycopy(all, pos, temp, 0, arraySize);",0
Fix Observable.range race condition," 
         @Override
         public void request(long n) {
-            if (REQUESTED_UPDATER.get(this) == Long.MAX_VALUE) {
+            if (requested == Long.MAX_VALUE) {
                 // already started with fast-path
                 return;
             }
-            if (n == Long.MAX_VALUE) {
-                REQUESTED_UPDATER.set(this, n);
+            if (n == Long.MAX_VALUE && REQUESTED_UPDATER.compareAndSet(this, 0, Long.MAX_VALUE)) {
                 // fast-path without backpressure
                 for (long i = index; i <= end; i++) {
                     if (o.isUnsubscribed()) {",0
[BACKLOG-6046] Fix cluster label displaying on Linux,"     fdVariables.top = new FormAttachment( 0, 10 );
     fdVariables.left = new FormAttachment( 0, 10 );
     fdVariables.bottom = new FormAttachment( 0, 221 );
-    fdVariables.right = new FormAttachment( 0, 601 );
+    fdVariables.right = new FormAttachment( 100, -10 );
 
     wVariables.setLayoutData( fdVariables );
   }
@@ -432,7 +432,7 @@
       shell.setSize( 653, 671 );
     }
     if ( Const.isLinux() ) {
-      shell.setSize( 653, 678 );
+      shell.setSize( 740, 678 );
     }
     if ( Const.isOSX() ) {
       shell.setSize( 653, 678 );",0
Fix crystal chest in loot tracker," package net.runelite.client.plugins.loottracker;
 
 import com.google.common.collect.HashMultiset;
+import com.google.common.collect.ImmutableMap;
 import com.google.common.collect.Multiset;
 import com.google.common.collect.Multisets;
 import com.google.inject.Provides;
@@ -37,6 +38,7 @@
 import java.util.Collection;
 import java.util.HashSet;
 import java.util.List;
+import java.util.Map;
 import java.util.Set;
 import java.util.concurrent.ScheduledExecutorService;
 import java.util.regex.Matcher;
@@ -97,9 +99,12 @@
 	private static final Pattern CLUE_SCROLL_PATTERN = Pattern.compile(""You have completed [0-9]+ ([a-z]+) Treasure Trails."");
 	private static final int THEATRE_OF_BLOOD_REGION = 12867;
 
-	// Brimstone loot handling
-	private static final String BRIMSTONE_CHEST_MESSAGE = ""You find some treasure in the chest!"";
-	private static final String BRIMSTONE_CHEST_EVENT_TYPE = ""Brimstone Chest"";
+	// Chest loot handling
+	private static final String CHEST_LOOTED_MESSAGE = ""You find some treasure in the chest!"";
+	private static final Map<Integer, String> CHEST_EVENT_TYPES = ImmutableMap.of(
+		5179, ""Brimstone Chest"",
+		11573, ""Crystal Chest""
+	);
 
 	@Inject
 	private ClientToolbar clientToolbar;
@@ -375,9 +380,15 @@
 
 		final String message = event.getMessage();
 
-		if (message.equals(BRIMSTONE_CHEST_MESSAGE))
+		if (message.equals(CHEST_LOOTED_MESSAGE))
 		{
-			eventType = BRIMSTONE_CHEST_EVENT_TYPE;
+			final int regionID = client.getLocalPlayer().getWorldLocation().getRegionID();
+			if (!CHEST_EVENT_TYPES.containsKey(regionID))
+			{
+				return;
+			}
+
+			eventType = CHEST_EVENT_TYPES.get(regionID);
 
 			final ItemContainer itemContainer = client.getItemContainer(InventoryID.INVENTORY);
 			if (itemContainer != null)
@@ -419,21 +430,19 @@
 	@Subscribe
 	public void onItemContainerChanged(ItemContainerChanged event)
 	{
-		if (eventType == null || !eventType.equals(BRIMSTONE_CHEST_EVENT_TYPE))
+		if (eventType != null && CHEST_EVENT_TYPES.containsValue(eventType))
 		{
-			return;
-		}
-
 		if (event.getItemContainer() != client.getItemContainer(InventoryID.INVENTORY))
 		{
 			return;
 		}
 
-		processBrimstoneChestLoot(event.getItemContainer());
+			processChestLoot(eventType, event.getItemContainer());
 		eventType = null;
 	}
+	}
 
-	private void processBrimstoneChestLoot(ItemContainer inventoryContainer)
+	private void processChestLoot(String chestType, ItemContainer inventoryContainer)
 	{
 		if (inventorySnapshot != null)
 		{
@@ -448,11 +457,11 @@
 				.collect(Collectors.toList());
 
 			final LootTrackerItem[] entries = buildEntries(stack(items));
-			SwingUtilities.invokeLater(() -> panel.add(BRIMSTONE_CHEST_EVENT_TYPE, -1, entries));
+			SwingUtilities.invokeLater(() -> panel.add(chestType, -1, entries));
 
 			if (lootTrackerClient != null && config.saveLoot())
 			{
-				LootRecord lootRecord = new LootRecord(BRIMSTONE_CHEST_EVENT_TYPE, LootRecordType.EVENT, toGameItems(items), Instant.now());
+				LootRecord lootRecord = new LootRecord(chestType, LootRecordType.EVENT, toGameItems(items), Instant.now());
 				lootTrackerClient.submit(lootRecord);
 			}
 ",0
CAMEL-10520 fix the acknowledgment mechanism for lumberjack protocol v1,"  */
 final class LumberjackSessionHandler {
     private static final Logger LOG = LoggerFactory.getLogger(LumberjackSessionHandler.class);
+    private static final int ACK_UNSET = -1;
 
     private volatile int version = -1;
     private volatile int windowSize = 1;
+    private volatile int nextAck = ACK_UNSET;
 
     void versionRead(int version) {
         if (this.version == -1) {
@@ -50,10 +52,15 @@
     void windowSizeRead(int windowSize) {
         LOG.debug(""Lumberjack window size is {}"", windowSize);
         this.windowSize = windowSize;
+        nextAck = ACK_UNSET;
     }
 
     void notifyMessageProcessed(ChannelHandlerContext ctx, int sequenceNumber) {
-        if (sequenceNumber == windowSize) {
+        if (nextAck == ACK_UNSET) {
+            nextAck = sequenceNumber + windowSize - 1;
+        }
+
+        if (sequenceNumber == nextAck) {
             LOG.debug(""Sequence number is {}. Sending ACK"", sequenceNumber);
             ByteBuf response = ctx.alloc().heapBuffer(FRAME_ACKNOWLEDGE_LENGTH, FRAME_ACKNOWLEDGE_LENGTH);
             response.writeByte(version);",0
fix doc,"  * ...
  * rewriter.insertAfter(t, ""text to put after t"");}
  * rewriter.insertAfter(u, ""text after u"");}
- * System.out.println(tokens.toString());
+ * System.out.println(rewriter.toString());
  * </pre>
  *
  * <p>
@@ -103,10 +103,10 @@
  * a C file and also its header file--all from the same buffer:</p>
  *
  * <pre>
- * tokens.insertAfter(""pass1"", t, ""text to put after t"");}
- * tokens.insertAfter(""pass2"", u, ""text after u"");}
- * System.out.println(tokens.toString(""pass1""));
- * System.out.println(tokens.toString(""pass2""));
+ * rewriter.insertAfter(""pass1"", t, ""text to put after t"");}
+ * rewriter.insertAfter(""pass2"", u, ""text after u"");}
+ * System.out.println(rewriter.toString(""pass1""));
+ * System.out.println(rewriter.toString(""pass2""));
  * </pre>
  *
  * <p>",0
Fix #94 test in forWebInfLib() if WEB-INF/lib exist," package org.reflections.util;
 
-import com.google.common.collect.Sets;
 import org.reflections.Reflections;
 
 import javax.servlet.ServletContext;
@@ -8,7 +7,6 @@
 import java.io.IOException;
 import java.io.UnsupportedEncodingException;
 import java.net.MalformedURLException;
-import java.net.URI;
 import java.net.URL;
 import java.net.URLClassLoader;
 import java.net.URLDecoder;
@@ -229,7 +227,11 @@
      */
     public static Collection<URL> forWebInfLib(final ServletContext servletContext) {
         final Collection<URL> urls = new ArrayList<URL>();
-        for (Object urlString : servletContext.getResourcePaths(""/WEB-INF/lib"")) {
+        Set<?> resourcePaths = servletContext.getResourcePaths(""/WEB-INF/lib"");
+        if (resourcePaths == null) {
+            return urls;
+        }
+        for (Object urlString : resourcePaths) {
             try {
                 urls.add(servletContext.getResource((String) urlString));
             } catch (MalformedURLException e) { /*fuck off*/ }",0
Fixed issue that could lead to deadlock and therefore freezing of a node," 
 public class DocTableInfo extends AbstractDynamicTableInfo {
 
-    private static final int MAX_ROUTING_RETRIES = 20;
+    private static final TimeValue ROUTING_FETCH_TIMEOUT = new TimeValue(5, TimeUnit.SECONDS);
 
     private final List<ReferenceInfo> columns;
     private final List<ReferenceInfo> partitionedByColumns;
@@ -162,19 +162,6 @@
         shards.add(shardRouting.id());
     }
 
-    /**
-     * retrieves the routing
-     *
-     * In case some shards are still unassigned or initializing this method might block up to
-     * 1 second and wait for the shards to become ready.
-     */
-    @Override
-    public Routing getRouting(WhereClause whereClause, @Nullable String preference) {
-        ClusterStateObserver observer = new ClusterStateObserver(
-                clusterService, new TimeValue(1, TimeUnit.SECONDS), logger);
-        return getRouting(observer, whereClause, preference, 0, true);
-    }
-
     private GroupShardsIterator getShardIterators(WhereClause whereClause,
                                                   @Nullable String preference,
                                                   ClusterState clusterState) throws IndexMissingException {
@@ -197,44 +184,71 @@
         );
     }
 
-    private Routing getRouting(final ClusterStateObserver observer,
-                               final WhereClause whereClause,
-                               @Nullable final String preference,
-                               final int currentRetry,
-                               final boolean retry) {
-        ClusterState clusterState = observer.observedState();
+    public Routing getRouting(ClusterState state, WhereClause whereClause, String preference, final List<ShardId> missingShards) {
         final Map<String, Map<String, List<Integer>>> locations = new TreeMap<>();
-
         GroupShardsIterator shardIterators;
         try {
-            shardIterators = getShardIterators(whereClause, preference, clusterState);
+            shardIterators = getShardIterators(whereClause, preference, state);
         } catch (IndexMissingException e) {
             return new Routing();
         }
 
-        final List<ShardId> missingShards = new ArrayList<>(0);
         fillLocationsFromShardIterators(locations, shardIterators, missingShards);
 
         if (missingShards.isEmpty()) {
             return new Routing(locations);
         } else {
-            if (!retry || currentRetry > MAX_ROUTING_RETRIES) {
-                throw new UnavailableShardsException(missingShards.get(0));
+            return null;
+        }
             }
 
-            final SettableFuture<Routing> futureRouting = SettableFuture.create();
+    @Override
+    public Routing getRouting(final WhereClause whereClause, @Nullable final String preference) {
+        Routing routing = getRouting(clusterService.state(), whereClause, preference, new ArrayList<ShardId>(0));
+        if (routing != null) return routing;
+
+        ClusterStateObserver observer = new ClusterStateObserver(clusterService, ROUTING_FETCH_TIMEOUT, logger);
+        final SettableFuture<Routing> routingSettableFuture = SettableFuture.create();
             observer.waitForNextChange(
-                    new FetchRoutingListener(futureRouting, observer, whereClause, preference, currentRetry));
+                new FetchRoutingListener(routingSettableFuture, whereClause, preference),
+                new ClusterStateObserver.ChangePredicate() {
+
+                    @Override
+                    public boolean apply(ClusterState previousState, ClusterState.ClusterStateStatus previousStatus, ClusterState newState, ClusterState.ClusterStateStatus newStatus) {
+                        return validate(newState);
+                    }
+
+                    @Override
+                    public boolean apply(ClusterChangedEvent changedEvent) {
+                        return validate(changedEvent.state());
+                    }
+
+                    private boolean validate(ClusterState state) {
+                        final Map<String, Map<String, List<Integer>>> locations = new TreeMap<>();
+
+                        GroupShardsIterator shardIterators;
+                        try {
+                            shardIterators = getShardIterators(whereClause, preference, state);
+                        } catch (IndexMissingException e) {
+                            return true;
+                        }
+
+                        final List<ShardId> missingShards = new ArrayList<>(0);
+                        fillLocationsFromShardIterators(locations, shardIterators, missingShards);
+
+                        return missingShards.isEmpty();
+                    }
+
+                });
 
             try {
-                return futureRouting.get();
+            return routingSettableFuture.get();
             } catch (ExecutionException e) {
                 throw Throwables.propagate(e.getCause());
             } catch (Exception e) {
                 throw Throwables.propagate(e);
             }
         }
-    }
 
     private void fillLocationsFromShardIterators(Map<String, Map<String, List<Integer>>> locations,
                                                  GroupShardsIterator shardIterators,
@@ -346,58 +360,51 @@
 
     private class FetchRoutingListener implements ClusterStateObserver.Listener {
 
-        private final SettableFuture<Routing> futureRouting;
-        private final ClusterStateObserver observer;
+        private final SettableFuture<Routing> routingFuture;
         private final WhereClause whereClause;
         private final String preference;
-        private final int currentRetry;
         Future<?> innerTaskFuture;
 
-        public FetchRoutingListener(SettableFuture<Routing> futureRouting,
-                                    ClusterStateObserver observer,
-                                    WhereClause whereClause,
-                                    String preference,
-                                    int currentRetry) {
-            this.futureRouting = futureRouting;
-            this.observer = observer;
+        public FetchRoutingListener(SettableFuture<Routing> routingFuture, WhereClause whereClause, String preference) {
+            this.routingFuture = routingFuture;
             this.whereClause = whereClause;
             this.preference = preference;
-            this.currentRetry = currentRetry;
         }
 
         @Override
-        public void onNewClusterState(ClusterState state) {
+        public void onNewClusterState(final ClusterState state) {
             try {
                 innerTaskFuture = executorService.submit(new Runnable() {
                     @Override
                     public void run() {
-                        try {
-                            futureRouting.set(getRouting(observer, whereClause, preference, currentRetry + 1, true));
-                        } catch (Throwable e) {
-                            futureRouting.setException(e);
+                        final List<ShardId> missingShards = new ArrayList<>(0);
+                        Routing routing = getRouting(state, whereClause, preference, missingShards);
+                        if (routing == null) {
+                            routingFuture.setException(new UnavailableShardsException(missingShards.get(0)));
+                        } else {
+                            routingFuture.set(routing);
                         }
                     }
                 });
             } catch (RejectedExecutionException e) {
-                futureRouting.setException(e);
+                routingFuture.setException(e);
             }
         }
 
         @Override
         public void onClusterServiceClose() {
-            futureRouting.setException(new IllegalStateException(""ClusterService closed""));
             if (innerTaskFuture != null) {
                 innerTaskFuture.cancel(true);
             }
+            routingFuture.setException(new IllegalStateException(""ClusterService closed""));
         }
 
         @Override
         public void onTimeout(TimeValue timeout) {
-            // one last retry before giving up
-            futureRouting.set(getRouting(observer, whereClause, preference, currentRetry + 1, false));
             if (innerTaskFuture != null) {
                 innerTaskFuture.cancel(true);
             }
+            routingFuture.setException(new IllegalStateException(""Fetching table info routing timed out.""));
         }
     }
 }",0
Fix the logging event to use placeholders correctly.,"                     result.put(entry.getKey(), mav);
                 } else {
                     // cannot translate the message header to message attribute value
-                    LOG.warn(""Cannot put the message header key={0}, value={1} into Sqs MessageAttribute"", entry.getKey(), entry.getValue());
+                    LOG.warn(""Cannot put the message header key={}, value={} into Sqs MessageAttribute"", entry.getKey(), entry.getValue());
                 }
             }
         }",0
Fix typo: Engine.isDataBseRequired(),"          *
          * @return whether or not the database is required
          */
-        public boolean isDatabseRequired() {
+        private boolean isDatabaseRequired() {
             return databaseRequired;
         }
 
@@ -255,7 +255,7 @@
      */
     @Override
     public void close() {
-        if (mode.isDatabseRequired()) {
+        if (mode.isDatabaseRequired()) {
             if (database != null) {
                 database.close();
                 database = null;
@@ -698,7 +698,7 @@
      * @throws ExceptionCollection thrown if fatal exceptions occur
      */
     private void initializeAndUpdateDatabase(final List<Throwable> exceptions) throws ExceptionCollection {
-        if (!mode.isDatabseRequired()) {
+        if (!mode.isDatabaseRequired()) {
             return;
         }
         boolean autoUpdate = true;
@@ -866,7 +866,7 @@
      * @throws UpdateException thrown if the operation fails
      */
     public void doUpdates(boolean remainOpen) throws UpdateException {
-        if (mode.isDatabseRequired()) {
+        if (mode.isDatabaseRequired()) {
             H2DBLock dblock = null;
             try {
                 if (ConnectionFactory.isH2Connection(settings)) {
@@ -927,7 +927,7 @@
      * opening the database
      */
     public void openDatabase(boolean readOnly, boolean lockRequired) {
-        if (mode.isDatabseRequired() && database == null) {
+        if (mode.isDatabaseRequired() && database == null) {
             //needed to update schema any required schema changes
             database = new CveDB(settings);
             if (readOnly
@@ -1045,7 +1045,7 @@
      * @throws NoDataException thrown if no data exists in the CPE Index
      */
     private void ensureDataExists() throws NoDataException {
-        if (mode.isDatabseRequired() && (database == null || !database.dataExists())) {
+        if (mode.isDatabaseRequired() && (database == null || !database.dataExists())) {
             throw new NoDataException(""No documents exist"");
         }
     }",0
 fix bug with upload date + better way to parse it," import java.net.URL;
 import java.text.DateFormat;
 import java.text.NumberFormat;
+import java.text.ParseException;
+import java.text.SimpleDateFormat;
 import java.util.ArrayList;
-import java.util.Calendar;
 import java.util.Date;
 import java.util.Locale;
 import java.util.Vector;
@@ -240,15 +241,14 @@
                     thumbsUpView.setText(nf.format(info.like_count));
                     thumbsDownView.setText(nf.format(info.dislike_count));
 
-                    //this is horribly convoluted
-                    //TODO: find a better way to convert YYYY-MM-DD to a locale-specific date
-                    //suggestions are welcome
-                    int year  = Integer.parseInt(info.upload_date.substring(0, 4));
-                    int month = Integer.parseInt(info.upload_date.substring(5, 7));
-                    int date  = Integer.parseInt(info.upload_date.substring(8, 10));
-                    Calendar cal = Calendar.getInstance();
-                    cal.set(year, month, date);
-                    Date datum = cal.getTime();
+                    SimpleDateFormat formatter = new SimpleDateFormat(""yyyy-MM-dd"");
+                    Date datum = null;
+                    try {
+                        datum = formatter.parse(info.upload_date);
+                    } catch (ParseException e) {
+                        e.printStackTrace();
+                    }
+
                     DateFormat df = DateFormat.getDateInstance(DateFormat.MEDIUM, locale);
 
                     String localisedDate = df.format(datum);",0
"Fixed the Spanish translation for the word ""minute""","         } else if (""es"".equals(language)) {
             formats[NOW] = new MessageFormat(""Ahora"");
             formats[N_SECONDS_AGO] = new MessageFormat(""hace {0} segundos"");
-            formats[A_MINUTE_AGO] = new MessageFormat(""hace 1 munito"");
-            formats[N_MINUTES_AGO] = new MessageFormat(""hace {0} munitos"");
+            formats[A_MINUTE_AGO] = new MessageFormat(""hace 1 minuto"");
+            formats[N_MINUTES_AGO] = new MessageFormat(""hace {0} minutos"");
             formats[AN_HOUR_AGO] = new MessageFormat(""hace 1 hora"");
             formats[N_HOURS_AGO] = new MessageFormat(""hace {0} horas"");
             dateMonth = new SimpleDateFormat(""d MMM"", locale);",0
Fix #364 if-else autoformatting,"   private void writeIndentedLine() {
     if (buf.length() == 0) {
       if (s_flag) {
-        s_flag = a_flg = false;
+        s_flag = a_flg = e_flg = false;
       }
       return;
     }
@@ -150,11 +150,28 @@
       }
       a_flg = false;
     }
+    if (e_flg) {
+      if (lastNonSpaceChar() == '}') {
+        trimRight(result);
+        result.append("" "");
+      }
+      e_flg = false;
+    }
     result.append(buf);
     buf.setLength(0);
   }
 
 
+  private char lastNonSpaceChar() {
+    for (int i=result.length()-1; i>=0; i--) {
+      char c_i = result.charAt(i);
+      if (c_i == ' ' || c_i == '\n') continue;
+      else return c_i;
+    }
+    return 0;
+  }
+
+
   private void writeIndentedComment() {
     final boolean saved_s_flag = s_flag;
     if (buf.length() > 0) {
@@ -371,16 +388,12 @@
 
       case ' ':
       case '\t':
-        if (lookup(""else"")) {
+        e_flg = lookup(""else"");
+        if (e_flg) {
           gotelse();
           if ((!s_flag) || buf.length() > 0) {
             buf.append(c);
           }
-//          // issue https://github.com/processing/processing/issues/364
-//          s_flag = false;
-//          trimRight(result);
-//          result.append("" "");
-
           writeIndentedLine();
           s_flag = false;
           break;
@@ -418,7 +431,8 @@
         break;
 
       case '{':
-        if (lookup(""else"")) {
+        e_flg = lookup(""else"");
+        if (e_flg) {
           gotelse();
         }
         if (s_if_lev.length == c_level) {",0
Fix Blocky UI behavior while scanning," 
   @Override
   public void onUrlDeviceDiscoveryUpdate() {
-    // Since this callback is given on a background thread and we want
-    // to update the list adapter (which can only be done on the UI thread)
-    // we have to interact with the adapter on the UI thread.
-    new Handler(Looper.getMainLooper()).post(new Runnable() {
-      @Override
-      public void run() {
-        if (SwipeDismissListViewTouchListener.isLocked()) {
-          return;
-        }
         for (PwPair pwPair : mPwCollection.getGroupedPwPairsSortedByRank(
             new Utils.PwPairRelevanceComparator())) {
           String groupId = Utils.getGroupId(pwPair.getPwsResult());
@@ -314,15 +305,20 @@
           } else if (!mGroupIdQueue.contains(groupId)
               && !Utils.isBlocked(pwPair)) {
             mGroupIdQueue.add(groupId);
-            if (mSecondScanComplete) {
-              // If we've already waited for the second scan timeout,
-              // go ahead and put the item in the listview.
+      }
+    }
+
+    if(mGroupIdQueue.isEmpty() || !mSecondScanComplete) {
+      return;
+    }
+    // Since this callback is given on a background thread and we want
+    // to update the list adapter (which can only be done on the UI thread)
+    // we have to interact with the adapter on the UI thread.
+    new Handler(Looper.getMainLooper()).post(new Runnable() {
+      @Override
+      public void run() {
               emptyGroupIdQueue();
             }
-          }
-        }
-        mNearbyDeviceAdapter.notifyDataSetChanged();
-      }
     });
   }
 ",0
bug fix #822,"         for (int i = 0; i < imgs.length; i++) {
             ret = StringUtils.substringBetween(imgs[i], ""data-src=\"""", ""\"""");
             if (StringUtils.isBlank(ret)) {
-                ret = StringUtils.substringBetween(ret, ""src=\"""", ""\"""");
+                ret = StringUtils.substringBetween(imgs[i], ""src=\"""", ""\"""");
             }
 
             if (!StringUtils.containsIgnoreCase(ret, "".ico"")) {",0
Fix up out-of-date comments.,"   private long peekedLong;
 
   /**
-   * The number of characters in a peeked number literal. Increment 'pos' by
-   * this after reading a number.
+   * The number of characters in a peeked number literal.
    */
   private int peekedNumberLength;
 
@@ -564,7 +563,7 @@
   }
 
   /**
-   * If {@code name} is in {@code options} this consumes it and returns it's index.
+   * If {@code name} is in {@code options} this consumes it and returns its index.
    * Otherwise this returns -1 and no name is consumed.
    */
   private int findName(String name, Options options) {
@@ -639,7 +638,7 @@
   }
 
   /**
-   * If {@code string} is in {@code options} this consumes it and returns it's index.
+   * If {@code string} is in {@code options} this consumes it and returns its index.
    * Otherwise this returns -1 and no string is consumed.
    */
   private int findString(String string, Options options) {
@@ -751,7 +750,7 @@
         pathIndices[stackSize - 1]++;
         return result;
       } catch (NumberFormatException ignored) {
-        // Fall back to parse as a double below.
+        // Fall back to parse as a BigDecimal below.
       }
     } else if (p != PEEKED_BUFFERED) {
       throw new JsonDataException(""Expected a long but was "" + peek()
@@ -939,8 +938,7 @@
   /**
    * Returns the next character in the stream that is neither whitespace nor a
    * part of a comment. When this returns, the returned character is always at
-   * {@code buffer[pos-1]}; this means the caller can always push back the
-   * returned character by decrementing {@code pos}.
+   * {@code buffer.getByte(0)}.
    */
   private int nextNonWhitespace(boolean throwOnEof) throws IOException {
     /*",0
Fixed restoreSpeed debug command to restore correct speed values and to ...,"  */
 package org.terasology.logic.debug;
 
+import org.terasology.asset.Asset;
+import org.terasology.asset.AssetUri;
+import org.terasology.asset.Assets;
 import org.terasology.entitySystem.entity.EntityRef;
+import org.terasology.entitySystem.prefab.internal.PojoPrefab;
 import org.terasology.entitySystem.systems.BaseComponentSystem;
 import org.terasology.entitySystem.systems.RegisterSystem;
 import org.terasology.logic.characters.CharacterMovementComponent;
@@ -127,20 +131,30 @@
     @Command(shortDescription = ""Restore normal speed values"", runOnServer = true)
     public String restoreSpeed(EntityRef client) {
         ClientComponent clientComp = client.getComponent(ClientComponent.class);
-        CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);
-        if (move != null) {
-            move.jumpSpeed = 10f;
-            move.speedMultiplier = 1f;
-            move.runFactor = 1.5f;
-            move.stepHeight = 0.35f;
-            move.slopeFactor = 0.6f;
-            move.distanceBetweenFootsteps = 1f;
-            clientComp.character.saveComponent(move);
             
-            return ""Normal speed values restored"";
+        Asset<?> asset = Assets.get(new AssetUri(""prefab:engine:player""));
+        CharacterMovementComponent moveDefault = ((PojoPrefab) asset).getComponent(CharacterMovementComponent.class);
+        CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);
+        if (move != null && moveDefault != null) {
+            move.jumpSpeed = moveDefault.jumpSpeed;
+            move.speedMultiplier = moveDefault.speedMultiplier;
+            move.runFactor = moveDefault.runFactor;
+            move.stepHeight = moveDefault.stepHeight;
+            move.slopeFactor = moveDefault.slopeFactor;
+            move.distanceBetweenFootsteps = moveDefault.distanceBetweenFootsteps;
+            clientComp.character.saveComponent(move);
         }
         
-        return """";
+        HealthComponent healthDefault = ((PojoPrefab) asset).getComponent(HealthComponent.class);
+        HealthComponent health = clientComp.character.getComponent(HealthComponent.class);
+        if(health != null && healthDefault != null){
+            health.fallingDamageSpeedThreshold = healthDefault.fallingDamageSpeedThreshold;
+            health.horizontalDamageSpeedThreshold = healthDefault.horizontalDamageSpeedThreshold;
+            health.excessSpeedDamageMultiplier = healthDefault.excessSpeedDamageMultiplier;
+            clientComp.character.saveComponent(health);
+        }
+
+        return ""Normal speed values restored"";
     }
 
     @Command(shortDescription = ""Toggles the maximum slope the player can walk up"", runOnServer = true)",0
Fix null pointer exception in DecodeWorker.java,"         output.write(""Found "" + result.getResultPoints().length + "" result points.\n"");
         for (int pointIndex = 0; pointIndex < result.getResultPoints().length; pointIndex++) {
           ResultPoint rp = result.getResultPoints()[pointIndex];
+          if (rp == null) {
+            continue;
+          }
           output.write(""  Point "" + pointIndex + "": ("" + rp.getX() + ',' + rp.getY() + ')');
           if (pointIndex != result.getResultPoints().length - 1) {
             output.write('\n');",0
Fix bug back navigation key,"         if(vholder instanceof ItemViewHolder) {
             final ItemViewHolder holder = (ItemViewHolder) vholder;
             final boolean isBackButton = mainFrag.GO_BACK_ITEM && p == 0;
-
+            if(isBackButton){
+                holder.about.setVisibility(View.GONE);
+            }
             if (mainFrag.IS_LIST) {
                 if (p == getItemCount() - 1) {
                     holder.rl.setMinimumHeight((int) minRowHeight);",0
fix for #787 - randomized cnonce," import com.ning.http.client.uri.Uri;
 import com.ning.http.util.StringUtils;
 
-import java.io.UnsupportedEncodingException;
 import java.nio.charset.Charset;
 import java.security.MessageDigest;
 import java.security.NoSuchAlgorithmException;
+import java.util.concurrent.ThreadLocalRandom;
 
 /**
  * This class is required when authentication is needed. The class support DIGEST and BASIC.
@@ -300,6 +300,17 @@
         private boolean omitQuery = false;
         private boolean targetProxy = false;
 
+        private static final ThreadLocal<MessageDigest> digestThreadLocal = new ThreadLocal<MessageDigest>() {
+            @Override
+            protected MessageDigest initialValue() {
+                try {
+                    return MessageDigest.getInstance(""MD5"");
+                } catch (NoSuchAlgorithmException e) {
+                    throw new RuntimeException(e);
+                }
+            }
+        };
+
         public String getNtlmDomain() {
             return ntlmDomain;
         }
@@ -516,14 +527,12 @@
             return this;
         }
 
-        private void newCnonce() {
-            try {
-                MessageDigest md = MessageDigest.getInstance(""MD5"");
-                byte[] b = md.digest(String.valueOf(System.currentTimeMillis()).getBytes(ISO_8859_1));
+        private void newCnonce(MessageDigest md) {
+            byte[] b = new byte[8];
+            ThreadLocalRandom.current().nextBytes(b);
+            b = md.digest(b);
+
                 cnonce = toHexString(b);
-            } catch (Exception e) {
-                throw new SecurityException(e);
-            }
         }
 
         /**
@@ -554,14 +563,7 @@
             return this;
         }
 
-        private void newResponse() throws UnsupportedEncodingException {
-            MessageDigest md = null;
-            try {
-                md = MessageDigest.getInstance(""MD5"");
-            } catch (NoSuchAlgorithmException e) {
-                throw new SecurityException(e);
-            }
-            
+        private void newResponse(MessageDigest md) {
             StringBuilder sb = StringUtils.stringBuilder();
             md.update(sb.append(principal)
                     .append("":"")
@@ -639,12 +641,11 @@
 
             // Avoid generating
             if (isNonEmpty(nonce)) {
-                newCnonce();
-                try {
-                    newResponse();
-                } catch (UnsupportedEncodingException e) {
-                    throw new RuntimeException(e);
-                }
+                MessageDigest md = digestThreadLocal.get();
+                newCnonce(md);
+                md.reset();
+
+                newResponse(md);
             }
 
             return new Realm(scheme,",0
Fix back button in NearbyBeaconsFragment," 
 import android.app.Activity;
 import android.app.Fragment;
+import android.app.FragmentTransaction;
 import android.bluetooth.BluetoothAdapter;
 import android.bluetooth.BluetoothManager;
 import android.content.Intent;
@@ -39,7 +40,6 @@
   private static final int REQUEST_ENABLE_BT = 0;
   private static final int REQUEST_LOCATION = 1;
   private static final String NEARBY_BEACONS_FRAGMENT_TAG = ""NearbyBeaconsFragmentTag"";
-  private static final String BEACON_CONGFIG_FRAGMENT_TAG = ""EditUrlsFragmentTag"";
   private static final String SETTINGS_FRAGMENT_TAG = ""SettingsFragmentTag"";
   private static final String BLOCKED_URLS_FRAGMENT_TAG = ""BlockedUrlsFragmentTag"";
   private static final String ABOUT_FRAGMENT_TAG = ""AboutFragmentTag"";
@@ -178,7 +178,7 @@
     if (nearbyBeaconsFragment != null) {
       nearbyBeaconsFragment.restartScan();
     } else {
-      showFragment(new NearbyBeaconsFragment(), NEARBY_BEACONS_FRAGMENT_TAG);
+      showFragment(new NearbyBeaconsFragment(), NEARBY_BEACONS_FRAGMENT_TAG, false);
     }
   }
 
@@ -186,36 +186,38 @@
    * Show the fragment to configure the app.
    */
   private void showSettingsFragment() {
-    showFragment(new SettingsFragment(), SETTINGS_FRAGMENT_TAG);
+    showFragment(new SettingsFragment(), SETTINGS_FRAGMENT_TAG, true);
   }
 
   /**
    * Show the fragment displaying information about this application.
    */
   private void showAboutFragment() {
-    showFragment(new AboutFragment(), ABOUT_FRAGMENT_TAG);
+    showFragment(new AboutFragment(), ABOUT_FRAGMENT_TAG, true);
   }
 
   /**
    * Show the fragment displaying the blocked URLs.
    */
   private void showBlockedFragment() {
-    showFragment(new BlockedFragment(), BLOCKED_URLS_FRAGMENT_TAG);
+    showFragment(new BlockedFragment(), BLOCKED_URLS_FRAGMENT_TAG, true);
   }
 
   /**
    * Show the fragment displaying the demos.
    */
   private void showDemosFragment() {
-    showFragment(new DemosFragment(), DEMOS_FRAGMENT_TAG);
+    showFragment(new DemosFragment(), DEMOS_FRAGMENT_TAG, true);
   }
 
-  private void showFragment(Fragment newFragment, String fragmentTag) {
-    getFragmentManager().beginTransaction()
+  private void showFragment(Fragment newFragment, String fragmentTag, boolean addToBackStack) {
+    FragmentTransaction transaction = getFragmentManager().beginTransaction()
         .setCustomAnimations(R.animator.fade_in_and_slide_up_fragment, R.animator.fade_out_fragment,
             R.animator.fade_in_activity, R.animator.fade_out_fragment)
-        .replace(R.id.main_activity_container, newFragment, fragmentTag)
-        .addToBackStack(null)
-        .commit();
+        .replace(R.id.main_activity_container, newFragment, fragmentTag);
+    if (addToBackStack) {
+      transaction.addToBackStack(null);
+    }
+    transaction.commit();
   }
 }",0
fixed loading of linked module and lib directory into classpath,"   }
 
   private ModuleInfo loadModuleInfo(File modDir, ModuleIdentifier modID) {
-    List<URL> cpList;
-    JsonObject modJSON;
-    File modJSONFile = createModJSONFile(modDir);
-    if (!modJSONFile.exists()) {
+
+      List<URL> cpList = new ArrayList<>();
+      JsonObject modJSON = null;
+      File targetModDir = modDir;
       // Look for link file
       File linkFile = new File(modDir, MODULE_LINK_FILE);
       if (linkFile.exists()) {
@@ -1220,13 +1220,19 @@
         } catch (Exception e) {
           throw new PlatformManagerException(e);
         }
-      } else {
+      }
+
+      File modJSONFile = createModJSONFile(targetModDir);
+      if (modJSONFile.exists() && modJSON == null) {
+        modJSON = loadModuleConfig(modJSONFile, modID);
+      }
+      cpList.addAll(getModuleLibClasspath(targetModDir));
+
+      if (modJSON == null) {
         throw new PlatformManagerException(""Module directory "" + modDir + "" contains no mod.json nor module.link file"");
       }
-    } else {
-      modJSON = loadModuleConfig(modJSONFile, modID);
-      cpList = getModuleClasspath(modDir);
-    }
+
+      cpList.addAll(getModuleLibClasspath(modDir));
     return new ModuleInfo(modJSON, cpList, modDir);
   }
 
@@ -1327,7 +1333,7 @@
     }
   }
 
-  private List<URL> getModuleClasspath(File modDir) {
+  private List<URL> getModuleLibClasspath(File modDir) {
     List<URL> urls = new ArrayList<>();
     // Add the classpath for this module
     try {",0
JERSEY-2871: use same prefix id for request and its response,"     private static final String REQUEST_PREFIX = ""> "";
     private static final String RESPONSE_PREFIX = ""< "";
     private static final String ENTITY_LOGGER_PROPERTY = LoggingFilter.class.getName() + "".entityLogger"";
+    private static final String LOGGING_ID_PROPERTY = LoggingFilter.class.getName() + "".id"";
 
     private static final Comparator<Map.Entry<String, List<String>>> COMPARATOR =
             new Comparator<Map.Entry<String, List<String>>>() {
@@ -228,6 +229,7 @@
     @Override
     public void filter(final ClientRequestContext context) throws IOException {
         final long id = this._id.incrementAndGet();
+        context.setProperty(LOGGING_ID_PROPERTY, id);
         final StringBuilder b = new StringBuilder();
 
         printRequestLine(b, ""Sending client request"", id, context.getMethod(), context.getUri());
@@ -246,7 +248,7 @@
     @Override
     public void filter(final ClientRequestContext requestContext, final ClientResponseContext responseContext)
             throws IOException {
-        final long id = this._id.incrementAndGet();
+        final long id = (Long) requestContext.getProperty(LOGGING_ID_PROPERTY);
         final StringBuilder b = new StringBuilder();
 
         printResponseLine(b, ""Client response received"", id, responseContext.getStatus());
@@ -263,6 +265,7 @@
     @Override
     public void filter(final ContainerRequestContext context) throws IOException {
         final long id = this._id.incrementAndGet();
+        context.setProperty(LOGGING_ID_PROPERTY, id);
         final StringBuilder b = new StringBuilder();
 
         printRequestLine(b, ""Server has received a request"", id, context.getMethod(), context.getUriInfo().getRequestUri());
@@ -279,7 +282,7 @@
     @Override
     public void filter(final ContainerRequestContext requestContext, final ContainerResponseContext responseContext)
             throws IOException {
-        final long id = this._id.incrementAndGet();
+        long id = (Long) requestContext.getProperty(LOGGING_ID_PROPERTY);
         final StringBuilder b = new StringBuilder();
 
         printResponseLine(b, ""Server responded with a response"", id, responseContext.getStatus());",0
Checking expiration time for access token fixed (#2737),"     /** Maximum time this token is valid.  */
     private long maxTimeToLiveInSeconds;
 
-    /** Time to kill in milliseconds. */
+    /** Time to kill in seconds. */
     private long timeToKillInSeconds;
 
     public OAuthAccessTokenExpirationPolicy() {}
@@ -60,9 +60,9 @@
         }
 
         // token is within hard window, check timeToKill (sliding window)
-        expirationTime = creationTime.plus(this.timeToKillInSeconds, ChronoUnit.SECONDS);
-        if (ticketState.getLastTimeUsed().isAfter(expirationTime)) {
-            LOGGER.debug(""Access token is expired because the time since last use is greater than timeToKillInMilliseconds"");
+        expirationTime = ticketState.getLastTimeUsed().plus(this.timeToKillInSeconds, ChronoUnit.SECONDS);
+        if (currentSystemTime.isAfter(expirationTime)) {
+            LOGGER.debug(""Access token is expired because the time since last use is greater than timeToKillInSeconds"");
             return true;
         }
 ",0
Fix SecurityException when running HadoopStoreJobRunner in an oozie java action,"     }
 
     public static void main(String[] args) {
-        int res;
+        int res = 1; // Init to 1 to please the compiler
         try {
             res = ToolRunner.run(new Configuration(), new HadoopStoreJobRunner(), args);
-            System.exit(res);
         } catch(Exception e) {
             e.printStackTrace();
             System.err.print(""\nTry '--help' for more information."");
             System.exit(1);
         }
+        System.exit(res);
     }
 }",0
bugfix-修复Colomn非常规数据库字段，获取表名失败导致输出异常," 
 			for (int i = 1; i <= length; i++) {
 
-				if (hasJoin && viceColumnStart > length && config.getSQLTable().equalsIgnoreCase(rsmd.getTableName(i)) == false) {
+				// if (hasJoin && viceColumnStart > length && config.getSQLTable().equalsIgnoreCase(rsmd.getTableName(i)) == false) {
+				// 	viceColumnStart = i;
+				// }
+
+				// FIXME bugfix-修复非常规数据库字段，获取表名失败导致输出异常
+				if (hasJoin && viceColumnStart > length) {
+					List<String> column = config.getColumn();
+
+					if (column != null && column.isEmpty() == false) {
+						viceColumnStart = column.size() + 1;
+					}
+					else if (config.getSQLTable().equalsIgnoreCase(rsmd.getTableName(i)) == false) {
 					viceColumnStart = i;
 				}
+				}
 
 				result = onPutColumn(config, rs, rsmd, index, result, i, hasJoin && i >= viceColumnStart ? childMap : null);
 			}",0
ACT-2112 Fixjtainterceptor,"  * @author Guillaume Nodet
  */
 public class JtaTransactionInterceptor extends AbstractCommandInterceptor {
+
   private static final Logger LOGGER = LoggerFactory.getLogger(JtaTransactionInterceptor.class);
 
   private final TransactionManager transactionManager;
@@ -41,6 +42,7 @@
     this.transactionManager = transactionManager;
   }
 
+  @Override
   public <T> T execute(CommandConfig config, Command<T> command) {
     LOGGER.debug(""Running command with propagation {}"", config.getTransactionPropagation());
     
@@ -63,13 +65,13 @@
       try {
         result = next.execute(config, command);
       } catch (RuntimeException ex) {
-        doRollback(isNew);
+        doRollback(isNew, ex);
         throw ex;
       } catch (Error err) {
-        doRollback(isNew);
+        doRollback(isNew, err);
         throw err;
       } catch (Exception ex) {
-        doRollback(isNew);
+        doRollback(isNew, ex);
         throw new UndeclaredThrowableException(ex, ""TransactionCallback threw undeclared checked exception"");
       }
       if (isNew) {
@@ -131,15 +133,16 @@
     } catch (SystemException e) {
       throw new TransactionException(""Unable to commit transaction"", e);
     } catch (RuntimeException e) {
-      doRollback(true);
+      doRollback(true, e);
       throw e;
     } catch (Error e) {
-      doRollback(true);
+      doRollback(true, e);
       throw e;
     }
   }
 
-  private void doRollback(boolean isNew) {
+  private void doRollback(boolean isNew, Throwable originalException) {
+    Throwable rollbackEx = null;
     try {
       if (isNew) {
         transactionManager.rollback();
@@ -148,10 +151,21 @@
       }
     } catch (SystemException e) {
       LOGGER.debug(""Error when rolling back transaction"", e);
+    } catch (RuntimeException e) {
+      rollbackEx = e;
+      throw e;
+    } catch (Error e) {
+      rollbackEx = e;
+      throw e;
+    } finally {
+      if (rollbackEx != null && originalException != null) {
+        LOGGER.error(""Error when rolling back transaction caused by: "" + originalException.getMessage(), originalException);
+      }
     }
   }
 
   private static class TransactionException extends RuntimeException {
+
     private static final long serialVersionUID = 1L;
 
     private TransactionException() {",0
Fixes RestTemplate generation with ResponseEntity as return type," 		IJExpression responseClassExpr = nullCastedToNarrowedClass(holder);
 		TypeMirror returnType = executableElement.getReturnType();
 		if (returnType.getKind() != TypeKind.VOID) {
-			if (getElementUtils().getTypeElement(RestSpringClasses.PARAMETERIZED_TYPE_REFERENCE) != null && !returnType.toString().startsWith(RestSpringClasses.RESPONSE_ENTITY)
-					&& checkIfParameterizedTypeReferenceShouldBeUsed(returnType)) {
+			if (getElementUtils().getTypeElement(RestSpringClasses.PARAMETERIZED_TYPE_REFERENCE) != null) {
+				if (returnType.toString().startsWith(RestSpringClasses.RESPONSE_ENTITY)) {
+
+					List<? extends TypeMirror> typeArguments = ((DeclaredType) returnType).getTypeArguments();
+
+					if (!typeArguments.isEmpty()) {
+						returnType = typeArguments.get(0);
+					}
+				}
+
+				if (checkIfParameterizedTypeReferenceShouldBeUsed(returnType)) {
 				return createParameterizedTypeReferenceAnonymousSubclassInstance(returnType);
 			}
+			}
 
 			AbstractJClass responseClass = retrieveResponseClass(returnType, holder);
 			if (responseClass != null) {",0
Fixed 1px border is drawn even when border width is set to 0,"         }
 
         canvas.drawCircle(getWidth() / 2, getHeight() / 2, mDrawableRadius, mBitmapPaint);
+        if(mBorderWidth != 0){
         canvas.drawCircle(getWidth() / 2, getHeight() / 2, mBorderRadius, mBorderPaint);
     }
+    }
 
     @Override
     protected void onSizeChanged(int w, int h, int oldw, int oldh) {",0
默认节点 null bug修复," 			TableConfig tableConfig = schema.getTables().get(table);
 			if(tableConfig!=null && tableConfig.isGlobalTable()) {
 				isAllGlobal = true;
-				break;
+			} else {
+				return false;
 			}
 		}
 		return isAllGlobal;",0
loot tracker service: fix getting loot records," 				.executeAndFetch(LootResult.class);
 		}
 
-		int killId = -1;
+		LootResult current = null;
 		List<LootRecord> lootRecords = new ArrayList<>();
 		List<GameItem> gameItems = new ArrayList<>();
 
 		for (LootResult lootResult : lootResults)
 		{
-			if (killId != lootResult.getKillId())
+			if (current == null || current.getKillId() != lootResult.getKillId())
 			{
-				killId = lootResult.getKillId();
-
 				if (!gameItems.isEmpty())
 				{
-					LootRecord lootRecord = new LootRecord(lootResult.getEventId(), lootResult.getType(), gameItems);
+					LootRecord lootRecord = new LootRecord(current.getEventId(), current.getType(), gameItems);
 					lootRecords.add(lootRecord);
-				}
 
 				gameItems = new ArrayList<>();
 			}
 
+				current = lootResult;
+			}
+
 			GameItem gameItem = new GameItem(lootResult.getItemId(), lootResult.getItemQuantity());
 			gameItems.add(gameItem);
 		}
 
 		if (!gameItems.isEmpty())
 		{
-			LootResult lootResult = lootResults.get(lootResults.size() - 1);
-			LootRecord lootRecord = new LootRecord(lootResult.getEventId(), lootResult.getType(), gameItems);
+			LootRecord lootRecord = new LootRecord(current.getEventId(), current.getType(), gameItems);
 			lootRecords.add(lootRecord);
 		}
 ",0
Fix lock manager NPE,"     private Action killAction = new Action(""Kill waiting session"", UIUtils.getShardImageDescriptor(ISharedImages.IMG_ELCL_STOP)) {
         @Override
         public void run() {
+        	if (curLock != null) {
             DBAServerLock<?> root = graphManager.getGraph(curLock).getLockRoot();
             alterSession();
             refreshLocks(root);
             setTableLockSelect(root);
         }
+        }
     };
 
 ",0
Work around Java 8 compiler bug (JDK-8037388).,"         HadoopGremlin.load();
         final CompilerConfiguration conf = new CompilerConfiguration();
         conf.addCompilationCustomizers(FaunusGremlinScriptEngine.getImportCustomizer());
-        this.loader = new GroovyClassLoader(getParentLoader(), conf);
+        this.loader = new GroovyClassLoader(this.getParentLoader(), conf);
         try {
             this.setBindings(Imports.getEvaluateBindings(), ScriptContext.GLOBAL_SCOPE);
         } catch (IOException e) {",0
Send buffer for client using wrong property,"         IOService ioService = connection.getConnectionManager().getIoService();
         int sizeKb = CLUSTER.equals(protocol)
                 ? ioService.getSocketSendBufferSize()
-                : ioService.getSocketClientReceiveBufferSize();
+                : ioService.getSocketClientSendBufferSize();
         int size = KILO_BYTE * sizeKb;
 
         ByteBuffer outputBuffer = newByteBuffer(size, ioService.isSocketBufferDirect());",0
fix my flawed attempt to recompute the delta,"             } catch (InterruptedException e) {
                 // do nothing
             }
+            now = getRawTimeInMs();
             newDelta = now - last.get();
         }
         if (newDelta >= UPDATE_CAP) {",0
fix thread unsafe statistics,"  */
 package com.dianping.cat.analysis;
 
-import java.util.List;
-
+import com.dianping.cat.CatConstants;
+import com.dianping.cat.config.server.ServerConfigManager;
+import com.dianping.cat.message.CodecHandler;
+import com.dianping.cat.message.io.BufReleaseHelper;
+import com.dianping.cat.message.io.ClientMessageEncoder;
+import com.dianping.cat.message.spi.internal.DefaultMessageTree;
+import com.dianping.cat.statistic.ServerStatisticManager;
 import io.netty.bootstrap.ServerBootstrap;
 import io.netty.buffer.ByteBuf;
 import io.netty.buffer.PooledByteBufAllocator;
-import io.netty.channel.ChannelFuture;
-import io.netty.channel.ChannelHandlerContext;
-import io.netty.channel.ChannelInitializer;
-import io.netty.channel.ChannelOption;
-import io.netty.channel.ChannelPipeline;
-import io.netty.channel.EventLoopGroup;
+import io.netty.channel.*;
 import io.netty.channel.epoll.EpollEventLoopGroup;
 import io.netty.channel.epoll.EpollServerSocketChannel;
 import io.netty.channel.nio.NioEventLoopGroup;
@@ -40,13 +40,7 @@
 import org.unidal.lookup.annotation.Inject;
 import org.unidal.lookup.annotation.Named;
 
-import com.dianping.cat.CatConstants;
-import com.dianping.cat.config.server.ServerConfigManager;
-import com.dianping.cat.message.CodecHandler;
-import com.dianping.cat.message.io.BufReleaseHelper;
-import com.dianping.cat.message.io.ClientMessageEncoder;
-import com.dianping.cat.message.spi.internal.DefaultMessageTree;
-import com.dianping.cat.statistic.ServerStatisticManager;
+import java.util.List;
 
 @Named(type = TcpSocketReceiver.class)
 public final class TcpSocketReceiver implements LogEnabled {
@@ -70,8 +64,6 @@
 
 	private int m_port = 2280; // default port number from phone, C:2, A:2, T:8
 
-	private volatile long m_processCount;
-
 	public synchronized void destory() {
 		try {
 			m_logger.info(""start shutdown socket, port "" + m_port);
@@ -140,6 +132,7 @@
 	}
 
 	public class MessageDecoder extends ByteToMessageDecoder {
+		private long m_processCount;
 
 		@Override
 		protected void decode(ChannelHandlerContext ctx, ByteBuf buffer, List<Object> out) throws Exception {",0
Fix ArrayIndexOutOfBoundsException when using autoplay," 
             initSimilarVideos(info, videoItemViewCreator);
 
+            setupActionBarHandler(info);
+
             if(autoPlayEnabled) {
                 playVideo(info);
             }
@@ -321,7 +323,6 @@
                 }
             });
 
-            setupActionBarHandler(info);
         } catch (java.lang.NullPointerException e) {
             Log.w(TAG, ""updateInfo(): Fragment closed before thread ended work... or else"");
             e.printStackTrace();",0
Fixed NPE,"   }
 
   void setMessage(String message) {
+    if (label != null) {
     label.setForeground(Color.BLACK);
     label.setText(message);
     label.repaint();
   }
+  }
 
   void setErrorMessage(String message) {
+    if (label != null) {
     //setForeground(Color.RED);
     label.setForeground(new Color(160, 0, 0));
     label.setText(message);
     label.repaint();
   }
+  }
 
   void clear() {
     if (label != null) {",0
Fixed place of if check,"             return;
         }
 
-        if (invalidation instanceof SingleNearCacheInvalidation && canSendInvalidation(invalidation)) {
+        if (invalidation instanceof SingleNearCacheInvalidation) {
+            if (canSendInvalidation(invalidation)) {
             ClientMessage message = encodeSingleInvalidation(invalidation.getName(), invalidation.getKey(),
                     invalidation.getSourceUuid(), invalidation.getPartitionUuid(), invalidation.getSequence());
 
             sendMessageWithOrderKey(message, invalidation.getKey());
+            }
             return;
         }
 ",0
Fix infinite loop in RecipeSorter," 
         if (ret == null)
         {
-            cls = cls.getSuperclass();
             while (cls != Object.class)
             {
+                cls = cls.getSuperclass();
                 ret = categories.get(cls);
                 if (ret != null)
                 {",0
Fix Array Out of Bounds crash if no video tracks present,"         }
 
         if (groupIndex == C.INDEX_UNSET && trackType == C.TRACK_TYPE_VIDEO) { // Video auto
+            if (groups.length != 0) {
             TrackGroup group = groups.get(0);
             tracks = new int[group.length];
             groupIndex = 0;
             for (int j = 0; j < group.length; j++) {
                 tracks[j] = j;
             }
+            }
         } else if (groupIndex == C.INDEX_UNSET) {
             trackSelector.setParameters(disableParameters);
             return;",0
Fix Raids plugin varbit access not happening on client thread," 		}
 
 		updateLists();
-		checkRaidPresence(true);
+		clientThread.invokeLater(() -> checkRaidPresence(true));
 	}
 
 	@Subscribe",0
Fix comparison stability of the Recipe Sorter with unknown recipes,"     {
         Category c1 = getCategory(r1);
         Category c2 = getCategory(r2);
-        if (c1 == SHAPELESS && c2 == SHAPED) return  1;
-        if (c1 == SHAPED && c2 == SHAPELESS) return -1;
+        int categoryComparison = -c1.compareTo(c2);
+        if (categoryComparison != 0)
+        {
+            return categoryComparison;
+        }
+        else
+        {
         if (r2.getRecipeSize() < r1.getRecipeSize()) return -1;
         if (r2.getRecipeSize() > r1.getRecipeSize()) return  1;
         return getPriority(r2) - getPriority(r1); // high priority value first!
     }
+    }
 
     private static Set<Class<?>> warned = Sets.newHashSet();
     public static void sortCraftManager()",0
Fixes frozen GUI when updating alert tree in non EDT,"         if (Constant.isLowMemoryOptionSet()) {
             return;
         }
+        
+        if (getView() == null || EventQueue.isDispatchThread()) {
+        	updateAlertInTreeEventHandler(originalAlert, alert);
+        }
+        else {
+            try {
+                EventQueue.invokeAndWait(new Runnable() {
+                    @Override
+                    public void run() {
+                    	updateAlertInTreeEventHandler(originalAlert, alert);
+                    }
+                });
+            } catch (Exception e) {
+                logger.error(e.getMessage(), e);
+            }
+        }
+    }
+    
+    private void updateAlertInTreeEventHandler(Alert originalAlert, Alert alert) {
         this.getTreeModel().updatePath(originalAlert, alert);
     	if (isInFilter(alert)) {
     		this.getFilteredTreeModel().updatePath(originalAlert, alert);",0
Fix misaligned custom vectors indices,"     public void init(HttpMessage msg, HostProcess parent) {
         this.msg = msg.cloneAll();
         this.parent = parent;
-        if (this.parent.getScannerParam().isInjectPluginIdInHeader()) {
-    		this.msg.getRequestHeader().setHeader(HttpHeader.X_ZAP_SCAN_ID, Integer.toString(getId()));
-    	}
         init();
     }
 
@@ -273,6 +270,10 @@
             }
         }
 
+        if (this.parent.getScannerParam().isInjectPluginIdInHeader()) {
+    		this.msg.getRequestHeader().setHeader(HttpHeader.X_ZAP_SCAN_ID, Integer.toString(getId()));
+    	}
+
         // always get the fresh copy
         message.getRequestHeader().setHeader(HttpHeader.IF_MODIFIED_SINCE, null);
         message.getRequestHeader().setHeader(HttpHeader.IF_NONE_MATCH, null);",0
fixed javadoc,"     /**
      * Converts this instance to a Java array.
      *
+     * @param componentType Component type of the array
      * @return A new Java array.
      * @throws NullPointerException if componentType is null
      */",0
Fix CAMEL-7680 : Throw NPE when stopping if transport client is used,"             LOG.info(""Leaving ElasticSearch cluster "" + configuration.getClusterName());
         }
         client.close();
+        if (node != null) {
         node.close();
+        }
         super.doStop();
     }
 ",0
Fix scrub comments for empty block comment /**/,"           }
           break;
         case IN_BLOCK_COMMENT:
-          if (pch == '*' && ch == '/' && (i - blockStart) > 1) {
+          if (pch == '*' && ch == '/' && (i - blockStart) > 0) {
             state = OUT;
           }
           break;",0
Fix West of the Keldagrim entrance Hot/Cold clue location," 	FELDIP_HILLS_CW_BALLOON(new WorldPoint(2452, 3108, 0), FELDIP_HILLS, ""Directly west of the Castle Wars balloon.""),
 	FREMENNIK_PROVINCE_MTN_CAMP(new WorldPoint(2804, 3672, 0), FREMENNIK_PROVINCE, ""At the Mountain Camp.""),
 	FREMENNIK_PROVINCE_RELLEKKA_HUNTER(new WorldPoint(2724, 3783, 0), FREMENNIK_PROVINCE, ""At the Rellekka Hunter area, near the icon.""),
-	FREMENNIK_PROVINCE_KELGADRIM_ENTRANCE(new WorldPoint(2712, 3689, 0), FREMENNIK_PROVINCE, ""West of the Keldagrim entrance mine.""),
+	FREMENNIK_PROVINCE_KELGADRIM_ENTRANCE(new WorldPoint(2715, 3689, 0), FREMENNIK_PROVINCE, ""West of the Keldagrim entrance mine.""),
 	FREMENNIK_PROVINCE_SW(new WorldPoint(2605, 3648, 0), FREMENNIK_PROVINCE, ""Outside the fence in the south-western corner of Rellekka.""),
 	FREMENNIK_PROVINCE_LIGHTHOUSE(new WorldPoint(2589, 3598, 0), FREMENNIK_PROVINCE, ""South-east of the Lighthouse.""),
 	FREMENNIK_PROVINCE_ETCETERIA_CASTLE(new WorldPoint(2614, 3867, 0), FREMENNIK_PROVINCE, ""Inside Etceteria's castle, in the southern staircase.""),",0
Increase http timeout,"     private static final String ACTION_LOOKUP_USER_ID = ""users/:provider:/:providerId:""; // Auth end point for looking up user id
 
     private final OkHttpClient client = new OkHttpClient.Builder()
-            .connectTimeout(10, TimeUnit.SECONDS)
-            .writeTimeout(10, TimeUnit.SECONDS)
+            .connectTimeout(15, TimeUnit.SECONDS)
+            .writeTimeout(15, TimeUnit.SECONDS)
             .readTimeout(30, TimeUnit.SECONDS)
             // using custom Connection Pool to evict idle connection after 5 seconds rather than 5 minutes (which is the default)
             // keeping idle connection on the pool will prevent the ROS to be stopped, since the HttpUtils#stopSyncServer query",0
#5847 %defaultDatasource crashes SQL kernel fix.,"   public static final String DATASOURCES = ""%datasources"";
 
   public static final String USAGE_ERROR_MSG = ""UsageError: %s is a cell magic, but the cell body is empty."";
+  public static final String WRONG_FORMAT_MSG = ""Wrong format. "";
 
   private MessageCreator messageCreator;
   private KernelFunctionality kernel;
@@ -113,8 +114,11 @@
     return (code, command, message, executionCount) -> {
       String[] parts = command.split("" "");
       if (parts.length != 2) {
-        throw new RuntimeException(""Wrong format."");
+        return sendErrorMessage(message, WRONG_FORMAT_MSG, executionCount);
+      } else if (!parts[1].contains(""jdbc:"")) {
+        return sendErrorMessage(message, ""Incorrect jdbc url."", executionCount);
       }
+
       HashMap<String, Object> params = new HashMap<>();
       params.put(source, parts[1]);
       this.kernel.setShellOptions(new KernelParameters(params));
@@ -126,7 +130,7 @@
     return (code, command, message, executionCount) -> {
       String[] parts = command.split("" "");
       if (parts.length != 3) {
-        sendErrorMessage(message, ""Wrong import static format."", executionCount);
+        sendErrorMessage(message, WRONG_FORMAT_MSG, executionCount);
       }
 
       this.kernel.addImport(new ImportPath(parts[1] + "" "" + parts[2]));
@@ -156,7 +160,7 @@
     return (code, command, message, executionCount) -> {
       String[] parts = command.split("" "");
       if (parts.length != 2) {
-        return sendErrorMessage(message, ""Wrong import format."", executionCount);
+        return sendErrorMessage(message, WRONG_FORMAT_MSG, executionCount);
       }
       this.kernel.removeImport(new ImportPath(parts[1]));
       return getMagicCommandItem(code, message, executionCount);
@@ -186,7 +190,7 @@
       return (code, command, message, executionCount) -> {
           String[] split = splitPath(command);
           if (split.length != 4) {
-            return sendErrorMessage(message, ""Wrong command format: "" + CLASSPATH_ADD_JAR, executionCount);
+            return sendErrorMessage(message, WRONG_FORMAT_MSG + CLASSPATH_ADD_JAR, executionCount);
           }
 
           String path = split[3];",0
Fixed bug where getActionBarHeight would throw a ResourcesNotFoundException,"             if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
                 TypedValue tv = new TypedValue();
                 context.getTheme().resolveAttribute(android.R.attr.actionBarSize, tv, true);
-                result = context.getResources().getDimensionPixelSize(tv.resourceId);
+                result = TypedValue.complexToDimensionPixelSize(tv.data, context.getResources().getDisplayMetrics());
             }
             return result;
         }",0
fix height of last hour,"                 mScroller.fling((int) mCurrentOrigin.x, 0, (int) (velocityX * mXScrollingSpeed), 0, Integer.MIN_VALUE, Integer.MAX_VALUE, 0, 0);
             }
             else if (mCurrentFlingDirection == Direction.VERTICAL){
-                mScroller.fling(0, (int) mCurrentOrigin.y, 0, (int) velocityY, 0, 0, (int) -(mHourHeight * 24 + mHeaderTextHeight + mHeaderRowPadding * 2 - getHeight()), 0);
+                mScroller.fling(0, (int) mCurrentOrigin.y, 0, (int) velocityY, 0, 0, (int) -(mHourHeight * 24 + mHeaderTextHeight + mHeaderRowPadding * 2 + mHeaderMarginBottom + mTimeTextHeight/2 - getHeight()), 0);
             }
 
             ViewCompat.postInvalidateOnAnimation(WeekView.this);
@@ -500,8 +500,8 @@
         }
 
         //if the new mCurrentOrigin.y is invalid, make it valid.
-        if (mCurrentOrigin.y < getHeight() - mHourHeight * 24 - mHeaderTextHeight - mHeaderRowPadding * 2 - mHeaderMarginBottom)
-            mCurrentOrigin.y = getHeight() - mHourHeight * 24 - mHeaderTextHeight - mHeaderRowPadding * 2 - mHeaderMarginBottom;
+        if (mCurrentOrigin.y < getHeight() - mHourHeight * 24 - mHeaderTextHeight - mHeaderRowPadding * 2 - mHeaderMarginBottom - mTimeTextHeight/2)
+            mCurrentOrigin.y = getHeight() - mHourHeight * 24 - mHeaderTextHeight - mHeaderRowPadding * 2 - mHeaderMarginBottom - mTimeTextHeight/2;
         //Don't put an else if because it will trigger a glitch when completly zoomed out and scrolling vertically.
         if(mCurrentOrigin.y > 0)
             mCurrentOrigin.y = 0;",0
Fix potential NPE,"     @Override
     public void setText(CharSequence text, BufferType type) {
         if (TextUtils.isEmpty(text)) {
+            super.setText(text, type);
             return;
         }
         StringBuffer stringBuffer = new StringBuffer();",0
Fixes #142 changeBufferData is now overloaded to be more robust," 	}
 	
 	/**
-	 * Change a specific buffer's data. Either the whole buffer or a subset.
+	 * Change a specific buffer's data at the given offset to the end of the passed buffer.
 	 * 
 	 * @param bufferInfo
 	 * @param newData
 	 * @param index
 	 */
 	public void changeBufferData(BufferInfo bufferInfo, Buffer newData, int index) {
-		int num = newData.limit();
-		int size = bufferInfo.byteSize * num;
+	    changeBufferData(bufferInfo, newData, index, newData.limit());
+	}
+
+	/**
+	 * Change a specific subset of the buffer's data at the given offset to the given length.
+	 * 
+	 * @param bufferInfo
+	 * @param newData
+	 * @param index
+	 * @param length
+	 */
+	public void changeBufferData(BufferInfo bufferInfo, Buffer newData, int index, int length) {
 		GLES20.glBindBuffer(bufferInfo.target, bufferInfo.bufferHandle);
-		GLES20.glBufferSubData(bufferInfo.target, index * size, size, newData);
+	    GLES20.glBufferSubData(bufferInfo.target, index * bufferInfo.byteSize, length * bufferInfo.byteSize, newData);
 		GLES20.glBindBuffer(bufferInfo.target, 0);
 	}
 ",0
Fix StrictMode crashes by calling `close` on our DexFiles,"         String packageName = ManifestHelper.getDomainPackageName(context);
         String path = getSourcePath(context);
         List<String> classNames = new ArrayList<String>();
+        DexFile dexfile = null;
         try {
-            DexFile dexfile = new DexFile(path);
+            dexfile = new DexFile(path);
             Enumeration<String> dexEntries = dexfile.entries();
             while (dexEntries.hasMoreElements()) {
                 String className = dexEntries.nextElement();
@@ -314,6 +315,8 @@
                     }
                 }
             }
+        } finally {
+            if (null != dexfile) dexfile.close();
         }
         return classNames;
     }",0
Fix NPE when activity is relaunched on changing font size of the phone,"     @Override
     protected void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
-        if (!NavigationApplication.instance.getReactGateway().hasStartedCreatingContext()) {
+         if (!NavigationApplication.instance.getReactGateway().hasStartedCreatingContext() || 
+                getIntent() == null || 
+                getIntent().getBundleExtra(""ACTIVITY_PARAMS_BUNDLE"") == null) {
             SplashActivity.start(this);
             finish();
             return;",0
Bug in ChunkedStreamSinkConduit#putIntAsHexString,"         byte int2 = (byte) (v >> 16);
         byte int1 = (byte) (v >>  8);
         byte int0 = (byte) (v      );
+        boolean nonZeroFound = false;
         if (int3 != 0) {
             buf.put(DIGITS[(0xF0 & int3) >>> 4])
                .put(DIGITS[0x0F & int3]);
+            nonZeroFound = true;
         }
-        if (int2 != 0) {
+        if (nonZeroFound || int2 != 0) {
             buf.put(DIGITS[(0xF0 & int2) >>> 4])
                .put(DIGITS[0x0F & int2]);
+            nonZeroFound = true;
         }
-        if (int1 != 0) {
+        if (nonZeroFound || int1 != 0) {
             buf.put(DIGITS[(0xF0 & int1) >>> 4])
                .put(DIGITS[0x0F & int1]);
         }",0
Fix the comment for Flux.blockLast() method," 
 	/**
 	 * Subscribe to this {@link Flux} and <strong>block indefinitely</strong>
-	 * until the upstream signals its first value or completes. Returns that value,
+	 * until the upstream signals its last value or completes. Returns that value,
 	 * or null if the Flux completes empty. In case the Flux errors, the original
 	 * exception is thrown (wrapped in a {@link RuntimeException} if it was a checked
 	 * exception).
@@ -1944,7 +1944,7 @@
 
 	/**
 	 * Subscribe to this {@link Flux} and <strong>block</strong> until the upstream
-	 * signals its first value, completes or a timeout expires. Returns that value,
+	 * signals its last value, completes or a timeout expires. Returns that value,
 	 * or null if the Flux completes empty. In case the Flux errors, the original
 	 * exception is thrown (wrapped in a {@link RuntimeException} if it was a checked
 	 * exception). If the provided timeout expires,a {@link RuntimeException} is thrown.",0
Fixed javadocs for skipStochasticTests," 
   /**
    * Override and return {@code true} in order to skip executing tests marked as {@code Stochastic}.
-   * Such tests MAY sometimes fail even though the impl
+   * Stochastic in this case means that the Rule is impossible or infeasible to deterministically verify—
+   * usually this means that this test case can yield false positives (""be green"") even if for some case,
+   * the given implementation may violate the tested behaviour.
    */
   public boolean skipStochasticTests() {
     return false;",0
Fix navbar coloration defaulting to true,"             SystemBarTintManager.SystemBarConfig config = tintManager.getConfig();
             p.setMargins(0, config.getStatusBarHeight(), 0, 0);
         } else if (SDK_INT >= 21) {
-            boolean colourednavigation = Sp.getBoolean(""colorednavigation"", true);
+            boolean colourednavigation = Sp.getBoolean(""colorednavigation"", false);
             Window window = getWindow();
             window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);
             window.clearFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);",0
Warnings reported by FindBugs et al.,"     /** Keep track of structure layout information.  Alignment type, type
         mapper, and explicit field order will affect this information.
     */
-    private static class LayoutInfo {
+    private class LayoutInfo {
         int size = CALCULATE_SIZE;
         int alignment = 1;
         Map fields = Collections.synchronizedMap(new LinkedHashMap());
@@ -1285,7 +1285,7 @@
     }
 
     /** Override to supply native type information for the given field. */
-    Pointer getFieldTypeInfo(StructField f) {
+    protected Pointer getFieldTypeInfo(StructField f) {
         Class type = f.type;
         Object value = getField(f);
         if (typeMapper != null) {
@@ -1375,7 +1375,7 @@
         }
     }
 
-    static class StructField extends Object {
+    class StructField extends Object {
         public String name;
         public Class type;
         public Field field;
@@ -1546,7 +1546,7 @@
         }
     }
 
-    private static class AutoAllocated extends Memory {
+    private class AutoAllocated extends Memory {
         public AutoAllocated(int size) {
             super(size);
             // Always clear new structure memory",1
KEYCLOAK-2149 Fix possible NPE during migration,"         if (migrate) {
             // Try to read OTP requirement from browser flow
             AuthenticationFlowModel browserFlow = realm.getBrowserFlow();
-            if (browserFlow == null) {
-                browserFlow = realm.getFlowByAlias(DefaultAuthenticationFlows.BROWSER_FLOW);
-            }
-            
             List<AuthenticationExecutionModel> browserExecutions = new LinkedList<>();
             KeycloakModelUtils.deepFindAuthenticationExecutions(realm, browserFlow, browserExecutions);
             for (AuthenticationExecutionModel browserExecution : browserExecutions) {",1
Fixes exception typo,"         throw new MockitoException(join(
                 ""Mockito cannot mock this class: "" + mockFeatures.getTypeToMock() + ""."",
                 """",
-                ""Mockito can only mock non-private & non-final classes."",
+                ""Mockito can only non-private & non-final classes."",
                 ""If you're not sure why you're getting this error, please report to the mailing list."",
                 """",
                 Platform.isJava8BelowUpdate45() ? ""Java 8 early builds have bugs that were addressed in Java 1.8.0_45, please update your JDK!\n"" : """",",1
fix concurrency exception when multiple consumer bound on start,"  */
 package org.altbeacon.beacon;
 
+import java.security.acl.LastOwnerException;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+
+import org.altbeacon.beacon.logging.LogManager;
+import org.altbeacon.beacon.logging.Loggers;
+import org.altbeacon.beacon.service.BeaconService;
+import org.altbeacon.beacon.simulator.BeaconSimulator;
+import org.altbeacon.beacon.service.StartRMData;
+
 import android.annotation.TargetApi;
 import android.bluetooth.BluetoothManager;
 import android.content.ComponentName;
@@ -35,22 +50,6 @@
 import android.os.Messenger;
 import android.os.RemoteException;
 
-import org.altbeacon.beacon.logging.LogManager;
-import org.altbeacon.beacon.logging.Loggers;
-import org.altbeacon.beacon.service.BeaconService;
-import org.altbeacon.beacon.service.StartRMData;
-import org.altbeacon.beacon.simulator.BeaconSimulator;
-
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Collections;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-import java.util.Set;
-import java.util.concurrent.ConcurrentHashMap;
-import java.util.concurrent.ConcurrentMap;
-
 /**
  * An class used to set up interaction with beacons from an <code>Activity</code> or <code>Service</code>.
  * This class is used in conjunction with <code>BeaconConsumer</code> interface, which provides a callback
@@ -101,7 +100,7 @@
 	private static final String TAG = ""BeaconManager"";
 	private Context mContext;
 	protected static BeaconManager client = null;
-	private final ConcurrentMap<BeaconConsumer, ConsumerInfo> consumers = new ConcurrentHashMap<BeaconConsumer,ConsumerInfo>();
+	private final Map<BeaconConsumer, ConsumerInfo> consumers = new HashMap<BeaconConsumer,ConsumerInfo>();
 	private Messenger serviceMessenger = null;
 	protected RangeNotifier rangeNotifier = null;
     protected RangeNotifier dataRequestNotifier = null;
@@ -270,12 +269,12 @@
             return;
         }
         synchronized (consumers) {
-            ConsumerInfo consumerInfo = consumers.putIfAbsent(consumer, new ConsumerInfo());
-            if (consumerInfo != null) {
+            if (consumers.keySet().contains(consumer)) {
                 LogManager.d(TAG, ""This consumer is already bound"");
             }
             else {
                 LogManager.d(TAG, ""This consumer is not bound.  binding: %s"", consumer);
+                consumers.put(consumer, new ConsumerInfo());
                 Intent intent = new Intent(consumer.getApplicationContext(), BeaconService.class);
                 consumer.bindService(intent, beaconServiceConnection, Context.BIND_AUTO_CREATE);
                 LogManager.d(TAG, ""consumer count is now: %s"", consumers.size());
@@ -295,7 +294,7 @@
             return;
         }
         synchronized (consumers) {
-            if (consumers.containsKey(consumer)) {
+            if (consumers.keySet().contains(consumer)) {
                 LogManager.d(TAG, ""Unbinding"");
                 consumer.unbindService(beaconServiceConnection);
                 consumers.remove(consumer);
@@ -310,7 +309,7 @@
                 LogManager.d(TAG, ""Bound consumers: "");
                 Set<Map.Entry<BeaconConsumer, ConsumerInfo>> consumers = this.consumers.entrySet();
                 for (Map.Entry<BeaconConsumer, ConsumerInfo> consumerEntry : consumers) {
-                    LogManager.d(TAG, String.valueOf(consumerEntry.getValue()));
+                    LogManager.i(TAG, String.valueOf(consumerEntry.getValue()));
                 }
             }
         }
@@ -324,7 +323,7 @@
      */
     public boolean isBound(BeaconConsumer consumer) {
         synchronized(consumers) {
-            return consumer != null && consumers.get(consumer) != null && (serviceMessenger != null);
+            return consumers.get(consumer) != null && (serviceMessenger != null);
         }
     }
 
@@ -334,10 +333,8 @@
      * @return
      */
     public boolean isAnyConsumerBound() {
-        synchronized(consumers) {
         return consumers.size() > 0 && (serviceMessenger != null);
     }
-    }
 
     /**
      * This method notifies the beacon service that the application is either moving to background
@@ -577,13 +574,12 @@
             LogManager.d(TAG, ""we have a connection to the service now"");
             serviceMessenger = new Messenger(service);
             synchronized(consumers) {
-                Iterator<Map.Entry<BeaconConsumer, ConsumerInfo>> iter = consumers.entrySet().iterator();
-                while (iter.hasNext()) {
-                    Map.Entry<BeaconConsumer, ConsumerInfo> entry = iter.next();
-
-                    if (!entry.getValue().isConnected) {
-                        entry.getKey().onBeaconServiceConnect();
-                        entry.getValue().isConnected = true;
+                for (BeaconConsumer consumer : consumers.keySet()) {
+                    Boolean alreadyConnected = consumers.get(consumer).isConnected;
+                    if (!alreadyConnected) {
+                        consumer.onBeaconServiceConnect();
+                        ConsumerInfo consumerInfo = consumers.get(consumer);
+                        consumerInfo.isConnected = true;
                     }
                 }
             }",1
Allow Debug filters to print an identifier," import storm.trident.tuple.TridentTuple;
 
 public class Debug extends BaseFilter {
-    private final String name;
-
-    public Debug() {
-        name = ""DEBUG: "";
-    }
-
-    public Debug(String name) {
-        this.name = ""DEBUG("" + name + ""): "";
-    }
 
     @Override
     public boolean isKeep(TridentTuple tuple) {
-        System.out.println(name + tuple.toString());
+        System.out.println(""DEBUG: "" + tuple.toString());
         return true;
     }
+    
 }",1
Small fix in log message.,"                         append = false;
                         current = 0;
                     } else
-                        Log.v(LOG_TAG, ""Content-Range: "" + header.getValue());
+                        Log.v(LOG_TAG, ""Content-Rnage: "" + header.getValue());
                     sendSuccessMessage(status.getStatusCode(), response.getAllHeaders(), getResponseData(response.getEntity()));
                 }
             }",1
Fix fetching accounts by JIDs," 
 	public Account findAccountByJid(final Jid accountJid) {
 		for (Account account : this.accounts) {
-			if (account.getJid().toBareJid().equals(accountJid.toBareJid())) {
+			if (account.getJid().toBareJid().equals(accountJid)) {
 				return account;
 			}
 		}",1
do not catch exception when registerProcessor,"             LOGGER.info(""Register jaxrs service to base url http://"" + serverConfig.getHost() + "":""
                 + serverConfig.getPort() + serverConfig.getContextPath());
         }
-        Object obj = null;
         try {
-            obj = ProxyFactory.buildProxy(providerConfig.getProxy(), providerConfig.getProxyClass(), instance);
+            Object obj = ProxyFactory.buildProxy(providerConfig.getProxy(), providerConfig.getProxyClass(), instance);
             httpServer.getDeployment().getRegistry()
                 .addResourceFactory(new SofaResourceFactory(providerConfig, obj), serverConfig.getContextPath());
 
             invokerCnt.incrementAndGet();
         } catch (Exception e) {
             LOGGER.error(""Register jaxrs service error"", e);
-            throw new SofaRpcRuntimeException(""Register jaxrs service error"", e);
         }
     }
 ",1
Trivial name spelling fix for SOLR-445," 
 /**
  * Models the basic information related to a single ""tolerated"" error that occured during updates.  
- * This class is only useful when the <code>TolerantUpdateProcessorFactory</code> is used in an update 
+ * This class is only useful when the <code>ToleranteUpdateProcessorFactory</code> is used in an update 
  * processor chain
  */
 public final class ToleratedUpdateError {",1
Fix OIDC expiration date unit," import org.jose4j.jws.AlgorithmIdentifiers;
 import org.jose4j.jws.JsonWebSignature;
 import org.jose4j.jwt.JwtClaims;
-import org.jose4j.jwt.NumericDate;
 import org.jose4j.lang.JoseException;
 import org.pac4j.core.context.J2EContext;
 import org.pac4j.core.profile.ProfileManager;
@@ -98,7 +97,7 @@
         claims.setJwtId(UUID.randomUUID().toString());
         claims.setIssuer(this.issuer);
         claims.setAudience(service.getClientId());
-        claims.setExpirationTime(NumericDate.now().addSeconds(timeout));
+        claims.setExpirationTimeMinutesInTheFuture(timeout);
         claims.setIssuedAtToNow();
         claims.setNotBeforeMinutesInThePast(this.skew);
         claims.setSubject(principal.getId());",1
Fixed world saving error when running with ServerFacade,"         } else {
             gameManifest = createGameManifest();
         }
-
-        Config config = context.get(Config.class);
-        WorldInfo worldInfo = gameManifest.getWorldInfo(TerasologyConstants.MAIN_WORLD);
-        config.getUniverseConfig().addWorldManager(worldInfo);
-        config.getUniverseConfig().setSpawnWorldTitle(worldInfo.getTitle());
-        config.getUniverseConfig().setUniverseSeed(gameManifest.getSeed());
-
         gameEngine.changeState(new StateLoading(gameManifest, NetworkMode.LISTEN_SERVER));
     }
 ",1
Fix duplicate signals with async cancel regression (this needs tests!)," 
 					}
 					catch (InterruptedException | RuntimeException ce) {
-						if (Exceptions.isCancel(ce)){
+						if (Exceptions.isCancel(ce) || isCancelled()){
 							reschedule(event);
 							break;
 						}",1
Fix for issue #2402,"   public void replaceAll() {
     if (findField.getText().length() == 0)
       return;
-    
-    editor.getSketch().setCurrentCode(0); // select the first tab
-    editor.setSelection(0, 0); // move to the beginning
+    // move to the beginning
+    editor.setSelection(0, 0);
 
     boolean foundAtLeastOne = false;
     while (true) {",1
fix #545 Improve javadoc of `Mono.repeatWhenEmpty`," 	}
 
 	/**
-	 * Repeatedly subscribe to this {@link Mono} as long as the current subscription to this
-	 * {@link Mono} completes empty and the companion {@link Publisher} produces an onNext signal.
-	 * <p>
-	 * Any terminal signal will terminate the resulting {@link Mono} with the same signal immediately.
+	 * Repeatedly subscribe to this {@link Mono} until a companion sequence emits an element.
+	 * <p>If the companion sequence signals when this {@link Mono} is active, the repeat
+	 * attempt is suppressed and any terminal signal will terminate this {@link Mono} with the same signal immediately.
 	 *
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/reactor-core/v3.0.6.RELEASE/src/docs/marble/repeatwhenempty.png"" alt="""">
@@ -2536,8 +2535,8 @@
 	 * @param repeatFactory the {@link Function} that returns the associated {@link Publisher}
 	 * companion, given a {@link Flux} that signals each onComplete as a 0-based incrementing {@link Long}.
 	 *
-	 * @return a {@link Mono} that resubscribes to this {@link Mono} if the previous subscription was empty,
-	 * as long as the companion {@link Publisher} produces an onNext signal
+	 * @return an eventually repeated {@link Mono} on onComplete when the companion {@link Publisher} produces an
+	 * onNext signal
 	 *
 	 */
 	public final Mono<T> repeatWhenEmpty(Function<Flux<Long>, ? extends Publisher<?>> repeatFactory) {
@@ -2545,23 +2544,22 @@
 	}
 
 	/**
-	 * Repeatedly subscribe to this {@link Mono} as long as the current subscription to this
-	 * {@link Mono} completes empty and the companion {@link Publisher} produces an onNext signal.
-	 * <p>
-	 * Any terminal signal will terminate the resulting {@link Mono} with the same signal immediately.
-	 * <p>
-	 * Emits an {@link IllegalStateException} if {@code maxRepeat} is exceeded (provided
-	 * it is different from {@code Integer.MAX_VALUE}).
+	 * Repeatedly subscribe to this {@link Mono} until there is an onNext signal when a companion sequence signals a
+	 * number of emitted elements.
+	 * <p>If the companion sequence signals when this {@link Mono} is active, the repeat
+	 * attempt is suppressed and any terminal signal will terminate this {@link Mono} with the same signal immediately.
+	 * <p>Emits an {@link IllegalStateException} if the max repeat is exceeded and different from {@code Integer.MAX_VALUE}.
 	 *
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/reactor-core/v3.0.6.RELEASE/src/docs/marble/repeatwhen1.png"" alt="""">
 	 *
-	 * @param maxRepeat the maximum number of repeats (infinite if {@code Integer.MAX_VALUE})
+	 * @param maxRepeat the maximum repeat number of time (infinite if {@code Integer.MAX_VALUE})
 	 * @param repeatFactory the {@link Function} that returns the associated {@link Publisher}
 	 * companion, given a {@link Flux} that signals each onComplete as a 0-based incrementing {@link Long}.
 	 *
-	 * @return a {@link Mono} that resubscribes to this {@link Mono} if the previous subscription was empty,
-	 * as long as the companion {@link Publisher} produces an onNext signal and the maximum number of repeats isn't exceeded.
+	 * @return an eventually repeated {@link Mono} on onComplete when the companion {@link Publisher} produces an
+	 * onNext signal
+	 * //FIXME
 	 */
 	public final Mono<T> repeatWhenEmpty(int maxRepeat, Function<Flux<Long>, ? extends Publisher<?>> repeatFactory) {
 		return Mono.defer(() -> {",1
TmxMapLoader Parameters fix," 
 	public static class Parameters extends AssetLoaderParameters<TiledMap> {
 		/** Whether to load the map for a y-up coordinate system */
-		public boolean yUp = true;
+		boolean yUp = true;
 	}
 	
 	protected static final int FLAG_FLIP_HORIZONTALLY = 0x80000000;",1
Fixed wordcount example to actually extract words from sentence,"  */
 public class WordCountFunction implements Function<String, Void> {
     @Override
-    public Void process(String input, Context context) {
-        Arrays.asList(input.split(""\\s+"")).forEach(word -> context.incrCounter(word, 1));
+    public Void process(String input, Context context) throws Exception {
+        Arrays.asList(input.split(""\\."")).forEach(word -> context.incrCounter(word, 1));
         return null;
     }
 }",1
#1179: Fix performance regression caused by use of method graph compiler.," import java.io.Serializable;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
-import java.lang.ref.SoftReference;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 import java.lang.reflect.Modifier;
@@ -38,8 +37,6 @@
 
     private final SelfCallInfo selfCallInfo = new SelfCallInfo();
     private final MethodGraph.Compiler compiler = MethodGraph.Compiler.Default.forJavaHierarchy();
-    private final WeakConcurrentMap<Class<?>, SoftReference<MethodGraph>> graphs
-        = new WeakConcurrentMap.WithInlinedExpunction<Class<?>, SoftReference<MethodGraph>>();
 
     public MockMethodAdvice(WeakConcurrentMap<Object, MockMethodInterceptor> interceptors, String identifier) {
         this.interceptors = interceptors;
@@ -122,14 +119,10 @@
 
     @Override
     public boolean isOverridden(Object instance, Method origin) {
-        SoftReference<MethodGraph> reference = graphs.get(instance.getClass());
-        MethodGraph methodGraph = reference == null ? null : reference.get();
-        if (methodGraph == null) {
-            methodGraph = compiler.compile(new TypeDescription.ForLoadedType(instance.getClass()));
-            graphs.put(instance.getClass(), new SoftReference<MethodGraph>(methodGraph));
-        }
-        MethodGraph.Node node = methodGraph.locate(new MethodDescription.ForLoadedMethod(origin).asSignatureToken());
-        return !node.getSort().isResolved() || !node.getRepresentative().represents(origin);
+        MethodGraph.Node node = compiler
+            .compile(new TypeDescription.ForLoadedType(instance.getClass()))
+            .locate(new MethodDescription.ForLoadedMethod(origin).asSignatureToken());
+        return node.getSort().isResolved() && !node.getRepresentative().represents(origin);
     }
 
     private static class SuperMethodCall implements InterceptedInvocation.SuperMethod {",1
Fix for #11," 
     /**
      * Gets all stored items of required type which satisfies where condition as list in memory
-     *
      * @param classOfStorableItem class of StorableItem
      * @param where where clause
      * @param whereArgs args for binding to where clause, same format as for ContentResolver
@@ -142,7 +141,6 @@
     public <T extends IBambooStorableItem> List<T> getAsList(@NonNull Class<T> classOfStorableItem, @Nullable String where, @Nullable String[] whereArgs, @Nullable String orderBy) {
         final Cursor cursor = getAsCursor(classOfStorableItem, where, whereArgs, orderBy);
 
-        try {
         final List<T> list = new ArrayList<T>(cursor == null ? 0 : cursor.getCount());
 
         if (cursor == null || !cursor.moveToFirst()) {
@@ -151,16 +149,15 @@
 
         final String internalIdFieldName = getTypeMetaWithExtra(classOfStorableItem).typeMeta.internalIdFieldName();
 
+        try {
             do {
                 list.add(createStorableItemFromCursor(classOfStorableItem, internalIdFieldName, cursor));
             } while (cursor.moveToNext());
+        } finally {
+            cursor.close();
+        }
 
         return list;
-        } finally {
-            if (cursor != null) {
-                cursor.close();
-            }
-        }
     }
 
     /**",1
Fix small logic error,"       UriBeacon uriBeacon = UriBeacon.parseFromBytes(scanResult.getScanRecord().getBytes());
       if (uriBeacon != null) {
         String url = uriBeacon.getUriString();
-        if (url != null && !url.isEmpty()) {
+        if (url != null && url.isEmpty()) {
           String address = scanResult.getDevice().getAddress();
           int rssi = scanResult.getRssi();
           int txPower = uriBeacon.getTxPowerLevel();",1
#5701 Fixed resetting environment after merge.,"   }
 
   private Collection<String> addJars(String path) {
-    List<String> addedJarsName = Lists.newLinkedList();
-
+    Map<Path, String> addedJars = Maps.newHashMap();
     if (doesPathContainsWildCards(path)) {
-      List<PathToJar> pathsToJars = getPaths(path).keySet().stream()
-          .map(currentPath -> new PathToJar(currentPath.toString()))
-          .collect(Collectors.toList());
-
-      List<Path> addedPaths = kernel.addJarsToClasspath(pathsToJars);
-      addedJarsName.addAll(addedPaths.stream().map(Path::toString).collect(Collectors.toList()));
-
+      Map<Path, String> collect = getPaths(path).keySet().stream()
+              .filter(
+                      currentPath -> kernel.addJarToClasspath(new PathToJar(currentPath.toString())))
+              .collect(Collectors.toMap(o -> o, Path::toString));
+      addedJars.putAll(collect);
     } else {
       Path currentPath = Paths.get(path);
       if (this.kernel.addJarToClasspath(new PathToJar(path))) {
-        addedJarsName.add(currentPath.getFileName().toString());
+        addedJars.put(currentPath, currentPath.getFileName().toString());
       }
     }
-
-    return addedJarsName;
+    return addedJars.values();
   }
 
   private Boolean containsSingleWildcardSymbol(String path) {",1
Issue #3040 - fixed Incorrect Error Transition Configuration for Login Flow,"             createEndState(flow, CasWebflowConstants.STATE_ID_PASSWORD_UPDATE_SUCCESS, CasWebflowConstants.VIEW_ID_PASSWORD_UPDATE_SUCCESS);
 
             if (casProperties.getAuthn().getPm().isEnabled()) {
+                configure(flow, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED);
                 configure(flow, CasWebflowConstants.VIEW_ID_EXPIRED_PASSWORD);
                 configure(flow, CasWebflowConstants.VIEW_ID_MUST_CHANGE_PASSWORD);
                 configurePasswordReset();",1
Bug Exasol,"             + "" object_type, ""
             + "" 'N/A for sysobjects' as view_text ""
             + "" from sys.exa_syscat ""
-            + "" where  ""
-            + ""   SCHEMA_NAME = ? ""
+            + "" where object_type = 'VIEW' ""
+            + ""   and SCHEMA_NAME = ? ""
             + "" ) ""
             + ""order by table_name"";
     private static final String SQL_COLS_VIEW = ""SELECT c.*,CAST(NULL AS INTEGER) as key_seq FROM  \""$ODBCJDBC\"".\""ALL_COLUMNS\""  c WHERE c.table_SCHEM = ? AND c.TABLE_name = ? order by ORDINAL_POSITION"";",1
Fix NPE during loading matrix job,"     @Override
     protected void updateTransientActions(){
         super.updateTransientActions();
-        if(getActiveConfigurations() !=null){
         // update all transient actions in configurations too.
         for(MatrixConfiguration configuration: getActiveConfigurations()){
             configuration.updateTransientActions();
         }
     }
-    }
 
     /**
      * Gets the subset of {@link AxisList} that are not system axes.",1
Aligned exception handling of ClientConnection with server," import com.hazelcast.util.Clock;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 
-import java.io.EOFException;
 import java.io.IOException;
 import java.net.InetAddress;
 import java.net.InetSocketAddress;
-import java.nio.channels.CancelledKeyException;
 import java.util.concurrent.atomic.AtomicInteger;
 import java.util.concurrent.atomic.AtomicLong;
 
@@ -59,7 +57,7 @@
     private final ClientConnectionManagerImpl connectionManager;
     private final LifecycleService lifecycleService;
     private final HazelcastClientInstanceImpl client;
-    private final long startTime = System.currentTimeMillis();
+    private final long startTime = System.currentTimeMillis();;
 
     private volatile Address remoteEndpoint;
     private volatile boolean isHeartBeating = true;
@@ -192,7 +190,12 @@
         closeCause = cause;
         closeReason = reason;
 
-        logClose();
+        String message = this + "" lost. Reason: "";
+        if (cause != null) {
+            message += cause.getClass().getName() + '[' + cause.getMessage() + ']';
+        } else {
+            message += ""Socket explicitly closed"";
+        }
 
         try {
             innerClose();
@@ -200,36 +203,17 @@
             logger.warning(""Exception while closing connection"" + e.getMessage());
         }
 
+        if (lifecycleService.isRunning()) {
+            logger.warning(message);
+        } else {
+            logger.finest(message);
+        }
+
         connectionManager.onClose(this);
 
         client.getMetricsRegistry().discardMetrics(this);
     }
 
-    private void logClose() {
-        String message = toString() + "" closed. Reason: "";
-        if (closeReason != null) {
-            message += closeReason;
-        } else if (closeCause != null) {
-            message += closeCause.getClass().getName() + ""["" + closeCause.getMessage() + ""]"";
-        } else {
-            message += ""Socket explicitly closed"";
-        }
-
-        if (lifecycleService.isRunning()) {
-            if (closeCause == null || closeCause instanceof EOFException || closeCause instanceof CancelledKeyException) {
-                logger.info(message);
-            } else {
-                logger.warning(message, closeCause);
-            }
-        } else {
-            if (closeCause == null) {
-                logger.finest(message);
-            } else {
-                logger.finest(message, closeCause);
-            }
-        }
-    }
-
     protected void innerClose() throws IOException {
         channel.close();
     }",1
Check that the order item can be cast to a SkuAccessor before casting.,"             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {
                 OrderItem orderItem = fulfillmentGroupItem.getOrderItem();
 
+                if (orderItem instanceof DiscreteOrderItem) {
+                    Sku sku = ((SkuAccessor) orderItem).getSku();
 
-                if (orderItem instanceof DiscreteOrderItem) {
-                  if (SkuAccessor.class.isAssignableFrom(orderItem.getClass())) {               
-                      Sku sku = ((SkuAccessor) orderItem).getSku();
                     sb.append(""ga('"" + trackerPrefix + ""ecommerce:addItem', {"");
                     sb.append(""'id': '"" + order.getOrderNumber() + ""'"");
                     sb.append("",'name': '"" + sku.getName() + ""'"");
@@ -273,7 +272,6 @@
                 }
             }
         }
-        }
         return sb.toString();
     }
     ",1
javadoc fixes," 	 *     (similar to merging the inner sequences).</li>
 	 * </ul>
 	 * The concurrency argument allows to control how many {@link Publisher} can be
-	 * subscribed to and merged in parallel. In turn, that argument shows the size of
-	 * the first {@link Subscription#request} to the upstream.
+	 * subscribed to and merged in parallel.
 	 *
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/reactor-core/v3.1.3.RELEASE/src/docs/marble/flatmapc.png"" alt="""">
@@ -4347,11 +4346,8 @@
 	 *     (similar to merging the inner sequences).</li>
 	 * </ul>
 	 * The concurrency argument allows to control how many {@link Publisher} can be
-	 * subscribed to and merged in parallel. In turn, that argument shows the size of
-	 * the first {@link Subscription#request} to the upstream.
-	 * The prefetch argument allows to give an arbitrary prefetch size to the merged
-	 * {@link Publisher} (in other words prefetch size means the size of the first
-	 * {@link Subscription#request} to the merged {@link Publisher}).
+	 * subscribed to and merged in parallel. The prefetch argument allows to give an
+	 * arbitrary prefetch size to the merged {@link Publisher}.
 	 *
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/reactor-core/v3.1.3.RELEASE/src/docs/marble/flatmapc.png"" alt="""">
@@ -6029,9 +6025,8 @@
 	 * Reduce the values from this {@link Flux} sequence into an single object of the same
 	 * type than the emitted items. Reduction is performed using a {@link BiFunction} that
 	 * takes the intermediate result of the reduction and the current value and returns
-	 * the next intermediate value of the reduction. Note, {@link BiFunction} will not
-	 * be invoked for a sequence with 0 or 1 elements. In case of one element's
-	 * sequence, the result will be directly sent to the subscriber.
+	 * the next intermediate value of the reduction. It will ignore sequence with 0 or 1
+	 * elements.
 	 *
 	 * <p>
 	 * <img class=""marble"" src=""https://raw.githubusercontent.com/reactor/reactor-core/v3.1.3.RELEASE/src/docs/marble/aggregate.png"" alt="""">",1
HHH-10538 Fix the javadoc of TableInformation.getIndex(Identifier indexName)," 	public Iterable<IndexInformation> getIndexes();
 
 	/**
-	 * Retrieve the named IndexInformation
-	 * 
-	 * @param indexName The index identifier (simple name)
-	 * 
-	 * @return The matching index information.  May return {@code null}
+	 * Obtain an iterable over all the table's defined indexes
 	 */
 	public IndexInformation getIndex(Identifier indexName);
 }",1
[BACKLOG-23831] Fixing a mis-configured localized error message in the UserRoleListDelegate," /*!
- * Copyright 2010 - 2018 Hitachi Vantara.  All rights reserved.
+ * Copyright 2010 - 2017 Hitachi Vantara.  All rights reserved.
  *
  * Licensed under the Apache License, Version 2.0 (the ""License"");
  * you may not use this file except in compliance with the License.
@@ -27,8 +27,6 @@
 
 public class UserRoleListDelegate implements java.io.Serializable {
 
-  private static final Class PKG = UserRoleListDelegate.class;
-
   private static final long serialVersionUID = -2895663865550206386L; /* EESOURCE: UPDATE SERIALVERUID */
   IUserRoleListWebService userDetailsRoleListWebService;
   UserRoleInfo userRoleInfo;
@@ -46,8 +44,8 @@
           serviceManager.createService( userInfo.getLogin(), userInfo.getPassword(), IUserRoleListWebService.class );
       updateUserRoleList();
     } catch ( Exception e ) {
-      this.logger.error( BaseMessages.getString( PKG,
-        ""UserRoleListDelegate.ERROR_0001_UNABLE_TO_INITIALIZE_USER_ROLE_LIST_WEBSVC"" ), e ); //$NON-NLS-1$
+      this.logger.error( BaseMessages
+          .getString( ""UserRoleListDelegate.ERROR_0001_UNABLE_TO_INITIALIZE_USER_ROLE_LIST_WEBSVC"" ), e ); //$NON-NLS-1$
     }
 
   }",1
"Fix wrong ""Delete"" message for single media.","                 cv_Delete_Dialog.setBackgroundColor(getCardBackgroundColor());
                 txt_Delete_title.setBackgroundColor(getPrimaryColor());
                 txt_Delete_title.setText(getString(R.string.delete));
-                txt_Delete_message.setText(R.string.delete_photo_message);
+                txt_Delete_message.setText(R.string.delete_album_message);
                 txt_Delete_message.setTextColor(getTextColor());
                 DeleteDialog.setView(Delete_dialogLayout);
 ",1
Important fix to fix security alert and https sertificate exception,"  */
 public class VkontakteApi extends DefaultApi20
 {
-  private static final String AUTHORIZE_URL = ""https://oauth.vk.com/authorize?client_id=%s&redirect_uri=%s&response_type=code"";
+  private static final String AUTHORIZE_URL = ""https://api.vkontakte.ru/oauth/authorize?client_id=%s&redirect_uri=%s&response_type=code"";
   private static final String SCOPED_AUTHORIZE_URL = String.format(""%s&scope=%%s"", AUTHORIZE_URL);
 
   @Override",1
"Resolved issue “Samsung Android 5.1, according to the volume button, crash”","                 mPackageInfo.applicationInfo.sourceDir = mPath;
                 mPackageInfo.applicationInfo.publicSourceDir = mPath;
 
-                if (TextUtils.isEmpty(mPackageInfo.applicationInfo.processName)) {
-                    mPackageInfo.applicationInfo.processName = mPackageInfo.applicationInfo.packageName;
-                }
-
                 // 添加针对SO库的加载
                 // 此属性最终用于ApplicationLoaders.getClassLoader，在创建PathClassLoader时成为其参数
                 // 这样findLibrary可不用覆写，即可直接实现SO的加载",1
Fix: in some rare cases the tables in the information_schema,"                     new CacheLoader<String, DocTableInfo>() {
                         @Override
                         public DocTableInfo load(@Nonnull String key) throws Exception {
-                            synchronized (DocSchemaInfo.this) {
                             return innerGetTableInfo(key);
                         }
                     }
-                    }
             );
 
     private final Function<String, TableInfo> tableInfoFunction;
@@ -264,29 +262,36 @@
     }
 
     @Override
-    public synchronized void clusterChanged(ClusterChangedEvent event) {
-        if (event.metaDataChanged()) {
+    public void clusterChanged(ClusterChangedEvent event) {
+        if (event.metaDataChanged() && cache.size() > 0) {
             cache.invalidateAll(event.indicesDeleted());
 
             // search for aliases of deleted and created indices, they must be invalidated also
+            if (cache.size() > 0) {
                 for (String index : event.indicesDeleted()) {
                     invalidateAliases(event.previousState().metaData().index(index).aliases());
                 }
+            }
+            if (cache.size() > 0) {
                 for (String index : event.indicesCreated()) {
                     invalidateAliases(event.state().metaData().index(index).aliases());
                 }
+            }
 
             // search for templates with changed meta data => invalidate template aliases
-            if (!event.state().metaData().templates().equals(event.previousState().metaData().templates())) {
+            if (cache.size() > 0
+                    && !event.state().metaData().templates().equals(event.previousState().metaData().templates())) {
                 // current state templates
                 for (ObjectCursor<IndexTemplateMetaData> cursor : event.state().metaData().getTemplates().values()) {
                     invalidateAliases(cursor.value.aliases());
                 }
                 // previous state templates
+                if (cache.size() > 0) {
                     for (ObjectCursor<IndexTemplateMetaData> cursor : event.previousState().metaData().getTemplates().values()) {
                         invalidateAliases(cursor.value.aliases());
                     }
                 }
+            }
 
             // search indices with changed meta data
             Iterator<String> it = cache.asMap().keySet().iterator();",1
Fix issue where latitude was used instead of longitude,"                         if (q.location == null) return Observable.empty();
 
                         double latitude = q.location.getLatitude();
-                        double longitude = q.location.getLongitude();
+                        double longitude = q.location.getLatitude();
                         LatLngBounds bounds = new LatLngBounds(
                                 new LatLng(latitude - 0.05, longitude - 0.05),
                                 new LatLng(latitude + 0.05, longitude + 0.05)",1
removeValidator signature fix," 		}
 	}
 	
-	public void removeValidator(Class<? extends Validator> validatorClass) {
+	public void removeValidator(Class<Validator> validatorClass) {
 		validators.remove(validatorClass);
 	}
 ",1
"If connection _is_ available, suppress any future showing of the down…","                 }
                 scheduleReconnect(false);
                 throw new AxonServerException(ErrorCode.CONNECTION_FAILED.errorCode(), ""No connection to AxonServer available"");
-            } else if (!connectInformation.getSuppressDownloadMessage()) {
-                connectInformation.setSuppressDownloadMessage(true);
             }
         }
         return channel;",1
Fix for Music (isPlaying when paused) on iOS," 
 	@Override
 	public boolean isPlaying () {
-		return track.isPlaying() && !track.isPaused();
+		return track.isPlaying();
 	}
 
 	@Override",1
PathManager fix - better identify working directory on launch,"         try {
             URL urlToSource = PathManager.class.getProtectionDomain().getCodeSource().getLocation();
 
-            // TODO: Probably remove this after a while, confirming via logs that this is no longer needed
             Path codeLocation = Paths.get(urlToSource.toURI());
-            System.out.println(""PathManager being initialized. Initial code location is "" + codeLocation.toAbsolutePath());
-
-            // Theory that whatever reason we needed to get the path that way isn't needed anymore - try just current dir ...
-            codeLocation = Paths.get("""").toAbsolutePath();
-            System.out.println(""Switched it to expected working dir: "" + codeLocation.toAbsolutePath());
-
-            // If that fails in some situations a different approach could test for the following in the path:
-            // if (codeLocation.toString().contains("".gradle"") || codeLocation.toString().contains("".m2"")) {
-
+            System.out.println(""codeLocation: "" + codeLocation);
             if (Files.isRegularFile(codeLocation)) {
                 installPath = findNativesHome(codeLocation.getParent(), 5);
                 if (installPath == null) {",1
Fix variable name,"         // copy list
         routers = routers == null ? new ArrayList<Router>() : new ArrayList<Router>(routers);
         // append url router
-        String routerKey = url.getParameter(Constants.ROUTER_KEY);
-        if (routerKey != null && routerKey.length() > 0) {
-            RouterFactory routerFactory = ExtensionLoader.getExtensionLoader(RouterFactory.class).getExtension(routerKey);
+        String routerkey = url.getParameter(Constants.ROUTER_KEY);
+        if (routerkey != null && routerkey.length() > 0) {
+            RouterFactory routerFactory = ExtensionLoader.getExtensionLoader(RouterFactory.class).getExtension(routerkey);
             routers.add(routerFactory.getRouter(url));
         }
         // append mock invoker selector",1
Fix MusicType enumhelper not working,"     {
         {GameType.class, int.class, String.class, String.class},
         {Options.class, String.class, boolean.class, boolean.class},
-        {EnumOS.class},
-        {MusicTicker.MusicType.class, SoundEvent.class, int.class, int.class}
+        {EnumOS.class}
     };
 
     @Nullable",1
Rel-wright-PUBDEV-5727: GLRM bug causing difference between H2O predict and mojo predict,"     if (orig.checksum()!=(_parms.train().checksum())) { // compare with checksum instead of frame keys.
       // need to generate the X matrix and put it in as a frame ID.  Mojo predict will return one row of x as a double[]
       GLRMGenX gs = new GLRMGenX(this, _parms._k);
-      gs.doAll(gs._k, Vec.T_NUM, adaptedFr);
+      gs.doAll(gs._k, Vec.T_NUM, orig);
       String[] loadingFrmNames = new String[gs._k];
       for (int index=1; index <= gs._k; index++)
         loadingFrmNames[index-1] = ""Arch""+index;",1
Fix: msg rate acquire permit for msg/bytes,"                 start += messagesForC;
                 entriesToDispatch -= messagesForC;
                 totalAvailablePermits -= msgSent;
-                totalMessagesSent += sentMsgInfo.getTotalSentMessages();
-                totalBytesSent += sentMsgInfo.getTotalSentMessageBytes();
+                totalMessagesSent += sentMsgInfo.getTotalSentMessageBytes();
+                totalBytesSent += sentMsgInfo.getTotalSentMessages();
             }
         }
 ",1
Fix banner extaction,"             if(!isAjaxPage) {
                 Element el = doc.select(""div[id=\""gh-banner\""]"").first().select(""style"").first();
                 String cssContent = el.html();
-                String url = ""https:"" + Parser.matchGroup1(""url\\(([^)]+)\\)"", cssContent);
+                String url = ""https:"" + Parser.matchGroup1(""url\\((.*)\\)"", cssContent);
                 if (url.contains(""s.ytimg.com"")) {
                     bannerUrl = null;
                 } else {",1
Fix for #2968," 		FocusEvent event = Pools.obtain(FocusEvent.class);
 		event.setStage(this);
 		event.setType(FocusEvent.Type.scroll);
-		Actor oldScrollFocus = scrollFocus;
+		Actor oldScrollFocus = keyboardFocus;
 		if (oldScrollFocus != null) {
 			event.setFocused(false);
 			event.setRelatedActor(actor);",1
Fix typo in log message,"             if (item != null) {
                 item.unbindView(viewHolder);
             } else {
-                Log.e(""FastAdapter"", ""The bindView method of this item should set the `Tag` on its itemView (https://github.com/mikepenz/FastAdapter/blob/develop/library-core/src/main/java/com/mikepenz/fastadapter/items/AbstractItem.java#L189)"");
+                Log.e(""FastAdapter"", ""The bindView method of this item should set the `Tag` on it's itemView (https://github.com/mikepenz/FastAdapter/blob/develop/library-core/src/main/java/com/mikepenz/fastadapter/items/AbstractItem.java#L189)"");
             }
         }
     }",1
Fix playInBackground props in ExoPlayer,"     private long resumePosition;
     private boolean loadVideoStarted;
     private boolean isFullscreen;
-    private boolean isInBackground;
     private boolean isPaused = true;
     private boolean isBuffering;
     private float rate = 1f;
@@ -187,15 +186,14 @@
 
     @Override
     public void onHostResume() {
-        if (!playInBackground || !isInBackground) {
+        if (playInBackground) {
+            return;
+        }
         setPlayWhenReady(!isPaused);
     }
-        isInBackground = false;
-    }
 
     @Override
     public void onHostPause() {
-        isInBackground = true;
         if (playInBackground) {
             return;
         }",1
ParticleMaterial setVelocity() fix," 	public void setVelocity(final int velocityBufferHandle) {
 		GLES20.glBindBuffer(GLES20.GL_ARRAY_BUFFER, velocityBufferHandle);
 		GLES20.glEnableVertexAttribArray(maVelocityHandle);
-		fix.android.opengl.GLES20.glVertexAttribPointer(maVelocityHandle, 3, GLES20.GL_FLOAT, false,
+		fix.android.opengl.GLES20.glVertexAttribPointer(maVelocityHandle, 4, GLES20.GL_FLOAT, false,
 				0, 0);
     }
 	",1
[BACKLOG-12856]Fix Creating Operations,"   }
 
   public Operation createOperation( String id ) {
-    Operation operation = new Operation( id, this );
-    operations.add( operation );
-    return operation;
+    return new Operation( id, this );
   }
 
   public Hop createHop( IOperation from, IOperation to ) {",1
Fix for #886,"  */
 package org.activiti.engine.delegate.event.impl;
 
+import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
-import java.util.concurrent.CopyOnWriteArrayList;
 
 import org.activiti.engine.ActivitiException;
 import org.activiti.engine.ActivitiIllegalArgumentException;
@@ -39,7 +39,7 @@
 	protected Map<ActivitiEventType, List<ActivitiEventListener>> typedListeners;
 
 	public ActivitiEventSupport() {
-		eventListeners = new CopyOnWriteArrayList<ActivitiEventListener>();
+		eventListeners = new ArrayList<ActivitiEventListener>();
 		typedListeners = new HashMap<ActivitiEventType, List<ActivitiEventListener>>();
 	}
 
@@ -119,7 +119,7 @@
 		List<ActivitiEventListener> listeners = typedListeners.get(type);
 		if (listeners == null) {
 			// Add an empty list of listeners for this type
-			listeners = new CopyOnWriteArrayList<ActivitiEventListener>();
+			listeners = new ArrayList<ActivitiEventListener>();
 			typedListeners.put(type, listeners);
 		}
 ",1
PushParser fix for tap callback method call,"                     TapCallback callback = mCallback;
                     mCallback = null;
                     Method method = getTap(callback);
-                    method.setAccessible(true);
                     method.invoke(callback, args);
                 }
                 catch (Exception ex) {
@@ -256,6 +255,11 @@
         Method found = mTable.get(callback.getClass());
         if (found != null)
             return found;
+        // try the proguard friendly route, take the first/only method
+        // in case ""tap"" has been renamed
+        Method[] candidates = callback.getClass().getDeclaredMethods();
+        if (candidates.length == 1)
+            return candidates[0];
 
         for (Method method : callback.getClass().getMethods()) {
             if (""tap"".equals(method.getName())) {
@@ -263,13 +267,6 @@
                 return method;
             }
         }
-
-        // try the proguard friendly route, take the first/only method
-        // in case ""tap"" has been renamed
-        Method[] candidates = callback.getClass().getDeclaredMethods();
-        if (candidates.length == 1)
-            return candidates[0];
-
         String fail =
         ""-keep class * extends com.koushikdutta.async.TapCallback {\n"" +
         ""    *;\n"" +",1
Fix NPE on surrogate mail notification,"         }
         if (communicationsManager.isMailSenderDefined()) {
             final EmailProperties mail = casProperties.getAuthn().getSurrogate().getMail();
-            final String emailAttribute = mail.getAttributeName();
-            final Object to = principal.getAttributes().get(emailAttribute);
-            if (to != null) {
+            final String to = principal.getAttributes().get(mail.getAttributeName()).toString();
             final String text = mail.getText().concat(""\n"").concat(eventDetails);
-                this.communicationsManager.email(text, mail.getFrom(), mail.getSubject(), to.toString(), mail.getCc(), mail.getBcc());
-            } else {
-                LOGGER.trace(""The principal has no {} attribute, cannot send email notification"", emailAttribute);
-            }
+            this.communicationsManager.email(text, mail.getFrom(), mail.getSubject(), to, mail.getCc(), mail.getBcc());
         } else {
             LOGGER.trace(""CAS is unable to send surrogate-authentication email messages given no settings are defined to account for servers, etc"");
         }",1
Fixed #104 Pinch-to-zoom and lifting one finger will result in a jumpy drag gesture.,"             // TRICKY CASE : FIRST POINTER UP WHEN SECOND STILL DOWN
             case MotionEvent.ACTION_POINTER_1_UP:
 
+                // FIXME Probably not the good value
                 dragLastX = pointer2LastX;
                 dragLastY = pointer2LastY;
+                startDrag(event);
                 state = State.DRAG;
                 break;
 ",1
[BACKPORT] Repositioned byte-buffer to read next chunk size if next expected cha…,"     // 65536, no specific reason, similar to UDP packet size limit
     @SuppressWarnings(""checkstyle:magicnumber"")
     private static final int MAX_CAPACITY = 1 << 16;
-    private static final byte LINE_FEED = 0x0A;
-    private static final byte CARRIAGE_RETURN = 0x0D;
 
-    private final TextReadHandler readHandler;
-
-    private boolean chunked;
     private boolean nextLine;
     private boolean readyToReadData;
+
     private ByteBuffer data;
+    private ByteBuffer lineBuffer = ByteBuffer.allocate(INITIAL_CAPACITY);
     private String contentType;
-    private ByteBuffer lineBuffer = ByteBuffer.allocate(INITIAL_CAPACITY);
+    private final TextReadHandler readHandler;
+    private boolean chunked;
 
     public HttpPostCommand(TextReadHandler readHandler, String uri) {
         super(HTTP_POST, uri);
@@ -79,46 +77,6 @@
         return complete;
     }
 
-    private boolean doActualRead(ByteBuffer cb) {
-        if (readyToReadData) {
-            if (chunked && (data == null || !data.hasRemaining())) {
-
-                if (data != null && cb.hasRemaining()) {
-                    readCRLFOrPositionChunkSize(cb);
-                }
-
-                boolean done = readChunkSize(cb);
-                if (done) {
-                    return true;
-                }
-            }
-
-            IOUtil.copyToHeapBuffer(cb, data);
-        }
-
-        setReadyToReadData(cb);
-
-        return !chunked && ((data != null) && !data.hasRemaining());
-    }
-
-    private void setReadyToReadData(ByteBuffer cb) {
-        while (!readyToReadData && cb.hasRemaining()) {
-            byte b = cb.get();
-            if (b == CARRIAGE_RETURN) {
-                readLF(cb);
-                processLine(StringUtil.lowerCaseInternal(toStringAndClear(lineBuffer)));
-                if (nextLine) {
-                    readyToReadData = true;
-                }
-                nextLine = true;
-                break;
-            }
-
-            nextLine = false;
-            appendToBuffer(b);
-        }
-    }
-
     public byte[] getData() {
         if (data == null) {
             return null;
@@ -135,21 +93,61 @@
         }
     }
 
-    private void readCRLFOrPositionChunkSize(ByteBuffer cb) {
+    private void setReadyToReadData(ByteBuffer cb) {
+        while (!readyToReadData && cb.hasRemaining()) {
             byte b = cb.get();
-        if (b == CARRIAGE_RETURN) {
-            readLF(cb);
-        } else {
-            cb.position(cb.position() - 1);
+            char c = (char) b;
+
+            if (c == '\r') {
+                ensureReadLF(cb);
+
+                processLine(StringUtil.lowerCaseInternal(toStringAndClear(lineBuffer)));
+                if (nextLine) {
+                    readyToReadData = true;
+                }
+                nextLine = true;
+                break;
+            }
+
+            nextLine = false;
+            appendToBuffer(b);
         }
     }
 
-    private void readLF(ByteBuffer cb) {
-        assert cb.hasRemaining() : ""'\\n' should follow '\\r'"";
+    private boolean doActualRead(ByteBuffer cb) {
+        if (readyToReadData) {
+            if (chunked && (data == null || !data.hasRemaining())) {
 
-        byte b = cb.get();
-        if (b != LINE_FEED) {
-            throw new IllegalStateException(""'\\n' should follow '\\r', but got '"" + (char) b + ""'"");
+                if (data != null && cb.hasRemaining()) {
+                    ensureReadCRLF(cb);
+                }
+
+                boolean done = readChunkSize(cb);
+                if (done) {
+                    return true;
+                }
+            }
+            IOUtil.copyToHeapBuffer(cb, data);
+        }
+
+        setReadyToReadData(cb);
+
+        return !chunked && ((data != null) && !data.hasRemaining());
+    }
+
+    private void ensureReadCRLF(ByteBuffer cb) {
+        char c = (char) cb.get();
+        if (c != '\r') {
+            throw new IllegalStateException(""'\r' should be read, but got '"" + c + ""'"");
+        }
+        ensureReadLF(cb);
+    }
+
+    private void ensureReadLF(ByteBuffer cb) {
+        assert cb.hasRemaining() : ""'\n' should follow '\r'"";
+        char c = (char) cb.get();
+        if (c != '\n') {
+            throw new IllegalStateException(""'\n' should follow '\r', but got '"" + c + ""'"");
         }
     }
 
@@ -171,8 +169,9 @@
         boolean hasLine = false;
         while (cb.hasRemaining()) {
             byte b = cb.get();
-            if (b == CARRIAGE_RETURN) {
-                readLF(cb);
+            char c = (char) b;
+            if (c == '\r') {
+                ensureReadLF(cb);
                 hasLine = true;
                 break;
             }",1
fix firstLine when modifying lines above it (fixes #2654),"    * updating the scroll bars.
    */
   public void setFirstLine(int firstLine) {
-    if(firstLine < 0 || firstLine > getLineCount()) {
-      throw new IllegalArgumentException(""First line out of range: ""
-        + firstLine + "" [0, "" + getLineCount() + ""]"");
-    }
-
     if (firstLine == this.firstLine) return;
 
     this.firstLine = firstLine;
@@ -2091,7 +2086,7 @@
     // do magic stuff
     else if(line < firstLine)
     {
-      setFirstLine(line);
+      setFirstLine(firstLine + count);
     }
     // end of magic stuff
     else",1
[WIP] MultiLayerConfiguration legacy JSON fix,"                     if (layers[i] instanceof BaseLayer && ((BaseLayer) layers[i]).getRegularization() == null) {
                         if(on.has(""layer"")){
                             //Legacy format
-                            ObjectNode layerNode = (ObjectNode)on.get(""layer"");
-                            if(layerNode.has(""@class"")){
-                                //Later legacy format: class field for JSON subclass
-                                on = layerNode;
-                            } else {
-                                //Early legacy format: wrapper object for JSON subclass
                             on = (ObjectNode) on.get(""layer"").elements().next();
                         }
-                        }
                         handleL1L2BackwardCompatibility((BaseLayer) layers[i], on);
                     }
                 }
@@ -136,15 +129,8 @@
                     if (layers[i] instanceof BaseLayer && ((BaseLayer) layers[i]).getWeightInitFn() == null) {
                         if(on.has(""layer"")){
                             //Legacy format
-                            ObjectNode layerNode = (ObjectNode)on.get(""layer"");
-                            if(layerNode.has(""@class"")){
-                                //Later legacy format: class field for JSON subclass
-                                on = layerNode;
-                            } else {
-                                //Early legacy format: wrapper object for JSON subclass
                             on = (ObjectNode) on.get(""layer"").elements().next();
                         }
-                        }
                         handleWeightInitBackwardCompatibility((BaseLayer) layers[i], on);
                     }
                 }",1
"Fixing lint error ""SuspiciousImport: 'import android.R' statement"""," 
 package com.github.mobile.ui;
 
+import android.R;
 import android.content.Context;
 import android.graphics.Canvas;
 import android.graphics.Color;
@@ -64,7 +65,7 @@
         final float density = getResources().getDisplayMetrics().density;
 
         TypedValue outValue = new TypedValue();
-        context.getTheme().resolveAttribute(android.R.attr.colorForeground, outValue, true);
+        context.getTheme().resolveAttribute(R.attr.colorForeground, outValue, true);
         final int themeForegroundColor =  outValue.data;
 
         mDefaultBottomBorderColor = setColorAlpha(themeForegroundColor,",1
"Fixed #806,TextRank提取关键词提升算法速度","         }
 //        System.out.println(words);
         Map<String, Float> score = new HashMap<String, Float>();
-        //依据TF来设置初值
-        for (Map.Entry<String, Set<String>> entry : words.entrySet()){ 
-        	score.put(entry.getKey(),sigMoid(entry.getValue().size()));
-        }        
         for (int i = 0; i < max_iter; ++i)
         {
             Map<String, Float> m = new HashMap<String, Float>();
@@ -169,13 +165,4 @@
 
         return score;
     }
-    
-    /**
-     * sigmoid函数
-     * @param value
-     * @return
-     */
-    public static float sigMoid(float value) {
-    	return (float)(1d/(1d+Math.exp(-value)));
-    }    
 }",1
Fixed SpnegoWebflowConfigurer to use the evaluateClientRequest as documented," 
     private void augmentWebflowToStartSpnego(final Flow flow) {
         val state = getState(flow, CasWebflowConstants.STATE_ID_INIT_LOGIN_FORM, ActionState.class);
-        if (casProperties.getAuthn().getSpnego().isMixedModeAuthentication()) {
-            createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, EVALUATE_SPNEGO_CLIENT, true);
-        } else {
         createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, START_SPNEGO_AUTHENTICATE, true);
     }
-    }
 
     private void createStartSpnegoAction(final Flow flow) {
         val actionState = createActionState(flow, START_SPNEGO_AUTHENTICATE, createEvaluateAction(SPNEGO_NEGOTIATE));
@@ -76,6 +72,6 @@
         val evaluateClientRequest = createActionState(flow, EVALUATE_SPNEGO_CLIENT,
                 createEvaluateAction(casProperties.getAuthn().getSpnego().getHostNameClientActionStrategy()));
         evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_YES, START_SPNEGO_AUTHENTICATE));
-        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, CasWebflowConstants.STATE_ID_VIEW_LOGIN_FORM));
+        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, getStartState(flow)));
     }
 }",1
Fix peekJson Javadoc paragraph formatting.,"    * Returns a new {@code JsonReader} that can read data from this {@code JsonReader} without
    * consuming it. The returned reader becomes invalid once this one is next read or closed.
    *
-   * <p>For example, we can use {@code peek()} to lookahead and read the same data multiple times.
+   * For example, we can use {@code peek()} to lookahead and read the same data multiple times.
    *
    * <pre> {@code
    *",1
Roidmi: fix duplicated DeviceType key,"     ZETIME(80, R.drawable.ic_device_default, R.drawable.ic_device_default_disabled, R.string.devicetype_mykronoz_zetime),
     ID115(90, R.drawable.ic_device_h30_h10, R.drawable.ic_device_h30_h10_disabled, R.string.devicetype_id115),
     WATCH9(100, R.drawable.ic_device_default, R.drawable.ic_device_default_disabled, R.string.devicetype_watch9),
-    ROIDMI(110, R.drawable.ic_device_roidmi, R.drawable.ic_device_roidmi_disabled, R.string.devicetype_roidmi),
-    ROIDMI3(112, R.drawable.ic_device_roidmi, R.drawable.ic_device_roidmi_disabled, R.string.devicetype_roidmi3),
+    ROIDMI(100, R.drawable.ic_device_roidmi, R.drawable.ic_device_roidmi_disabled, R.string.devicetype_roidmi),
+    ROIDMI3(102, R.drawable.ic_device_roidmi, R.drawable.ic_device_roidmi_disabled, R.string.devicetype_roidmi3),
     TEST(1000, R.drawable.ic_device_default, R.drawable.ic_device_default_disabled, R.string.devicetype_test);
 
     private final int key;",1
Fixed JavaDoc again," 
 /** <p>
  * This interface encapsulates communication with the graphics processor. Depending on the available hardware and the current
- * {@link Application} configuration, access to the {@link GL20}, {@link GL30}, and/or {@link GLCommon} are provided
+ * {@link Application} configuration, access to the {@link GL10}, {@link GL11}, {@link GL20}, and/or {@link GLCommon} are provided
  * here.
  * </p>
  * ",1
Fix missing TargetApi import," package com.brentvatne.react;
 
 import android.annotation.SuppressLint;
-import android.annotation.TargetApi;
 import android.app.Activity;
 import android.content.res.AssetFileDescriptor;
 import android.graphics.Matrix;",1
Log non existent messages with debug level,"      * {@inheritDoc}
      * <p>
      * <strong>Note:</strong> The returned message will be {@code null} if an error occurred while loading the message from the
-     * database (for example, no longer exists).
+     * database.
      */
     @Override
     public HttpMessage get(int index) {
         try {
             return historyReferences.get(index).getHttpMessage();
         } catch (HttpMalformedHeaderException | DatabaseException e) {
-            if (LOGGER.isDebugEnabled()) {
-                LOGGER.debug(""Failed to get the message from DB: "" + e.getMessage(), e);
-            }
+            LOGGER.error(""Failed to get the message from DB: "" + e.getMessage(), e);
         }
         return null;
     }",1
"Ignore out of bounds exception in NearestSortingList, Closes #2742","  * sorting of the entities. This class only tries to keep the elements sorted,
  * but does not guarantee it.
  * <br><br>
- * It it therefore use full for graphics purposes, to keep track of the nearest
+ * It it therefor use full for graphics purposes, to keep track of the nearest
  * entities to draw.
  *
  */
@@ -99,12 +99,11 @@
      * from this container.
      *
      * @param e The entity to add. Must have a LocationComponent or an
-     *          IllegalArgumentException is thrown.
+     *          IlligalArgumentException is thrown.
      */
     public synchronized void add(EntityRef e) {
         if (e.getComponent(LocationComponent.class) == null) {
             logger.warn(""Adding entity without LocationComponent to container that sorts on location. Entity: {}"", e);
-            throw new IllegalArgumentException(""Entity has no LocationComponent"");
         }
         //new entities are inserted to make sure that new entities are drawn first.
         //Since it is likely the players wants to see new entities over existing ones
@@ -453,14 +452,6 @@
                 logger.warn(""Entities destroyed during sorting process. Sorting is skipped this round."");
                 clearQueue();
                 return;
-            } catch (ArrayIndexOutOfBoundsException e) {
-                // see https://github.com/MovingBlocks/Terasology/issues/2742
-                // This happens when the component lookup used for sorting is async with the game thread, 
-                // e.g. when a large amount of entities is destroyed or created in a short timespan.
-                // as long as this occurs rarely, it can be ignored.
-                logger.warn(""Something went wrong during sorting process. Sorting is skipped this round."");
-                clearQueue();
-                return;
             }
             processQueueAndSetEntities(newEnts);
         }",1
Fix flawed logic on BeaconManager#isBound,"         synchronized(consumers) {
             // Annotation doesn't guarantee we get a non-null, but raising an NPE here is excessive
             //noinspection ConstantConditions
-            return consumer != null && consumers.get(consumer) != null &&
-                    (mScheduledScanJobsEnabled || serviceMessenger != null);
+            return consumer != null && consumers.get(consumer) != null && (serviceMessenger != null);
         }
     }
 
@@ -496,8 +495,7 @@
      */
     public boolean isAnyConsumerBound() {
         synchronized(consumers) {
-            return !consumers.isEmpty() &&
-                    (mScheduledScanJobsEnabled || serviceMessenger != null);
+            return consumers.isEmpty() && (serviceMessenger != null);
         }
     }
 ",1
[Dubbo- typo]fix typo," import java.util.concurrent.ConcurrentHashMap;
 
 /**
- * NettyServerHandler
+ * NettyClientHandler
  */
 @io.netty.channel.ChannelHandler.Sharable
 public class NettyServerHandler extends ChannelDuplexHandler {",1
Fix proposal for #70,"                 // favor 'max-age' field over 'expires'
                 if (!maxAgeSet && ""max-age"".equalsIgnoreCase(f[0])) {
                     try {
-                        maxAge = Math.max(Integer.valueOf(removeQuote(f[1])), 0);
+                        maxAge = Integer.valueOf(removeQuote(f[1]));
                     } catch (NumberFormatException e1) {
                         // ignore failure to parse -> treat as session cookie
                         // invalidate a previously parsed expires-field
@@ -469,11 +469,11 @@
                     maxAgeSet = true;
                 } else if (!maxAgeSet && !expiresSet && ""expires"".equalsIgnoreCase(f[0])) {
                     try {
-                        maxAge = Math.max(convertExpireField(f[1]), 0);
+                        maxAge = convertExpireField(f[1]);
                     } catch (Exception e) {
                         // original behavior, is this correct at all (expires field with max-age semantics)?
                         try {
-                            maxAge = Math.max(Integer.valueOf(f[1]), 0);
+                            maxAge = Integer.valueOf(f[1]);
                         } catch (NumberFormatException e1) {
                             // ignore failure to parse -> treat as session cookie
                         }
@@ -487,6 +487,10 @@
             }
         }
 
+        if (maxAge < -1) {
+            maxAge = -1;
+        }
+
         return new Cookie(domain, cookieName, cookieValue, path, maxAge, secure);
     }
 ",1
Fix incorrect type referenced in javadoc of JsonParser,"      *  return (nextToken() == JsonToken.VALUE_NUMBER_INT) ? getIntValue() : defaultValue;
      *</pre>
      * but may be faster for parser to process, and can therefore be used if caller
-     * expects to get an int value next from input.
+     * expects to get a String value next from input.
      */
     public int nextIntValue(int defaultValue) throws IOException {
         return (nextToken() == JsonToken.VALUE_NUMBER_INT) ? getIntValue() : defaultValue;
@@ -747,7 +747,7 @@
      *  return (nextToken() == JsonToken.VALUE_NUMBER_INT) ? getLongValue() : defaultValue;
      *</pre>
      * but may be faster for parser to process, and can therefore be used if caller
-     * expects to get a long value next from input.
+     * expects to get a String value next from input.
      */
     public long nextLongValue(long defaultValue) throws IOException {
         return (nextToken() == JsonToken.VALUE_NUMBER_INT) ? getLongValue() : defaultValue;
@@ -765,7 +765,7 @@
      *  return null;
      *</pre>
      * but may be faster for parser to process, and can therefore be used if caller
-     * expects to get a Boolean value next from input.
+     * expects to get a String value next from input.
      */
     public Boolean nextBooleanValue() throws IOException {
         JsonToken t = nextToken();",1
Issue460/FixedMisspelledMethods,"     private Messenger serviceMessenger = null;
     protected final Set<RangeNotifier> rangeNotifiers = new CopyOnWriteArraySet<>();
     protected RangeNotifier dataRequestNotifier = null;
-    protected final Set<MonitorNotifier> monitorNotifiers = new CopyOnWriteArraySet<>();
+    protected Set<MonitorNotifier> monitorNotifiers = new CopyOnWriteArraySet<>();
     private final ArrayList<Region> rangedRegions = new ArrayList<Region>();
     private final List<BeaconParser> beaconParsers = new CopyOnWriteArrayList<>();
     private NonBeaconLeScanCallback mNonBeaconLeScanCallback;
@@ -422,7 +422,7 @@
      * activities or services set different RangeNotifier instances, the last one set will receive
      * all the notifications.
      *
-     * @param notifier The {@link RangeNotifier} to register.
+     * @param notifier
      * @see RangeNotifier
      * @deprecated replaced by (@link #addRangeNotifier)
      */
@@ -442,7 +442,7 @@
      * <p/>
      *The notifier must be unregistered using (@link #removeRangeNotifier)
      *
-     * @param notifier The {@link RangeNotifier} to register.
+     * @param notifier
      * @see RangeNotifier
      */
     public void addRangeNotifier(RangeNotifier notifier){
@@ -456,7 +456,7 @@
     /**
      * Specifies a class to remove from the array of <code>RangeNotifier</code>
      *
-     * @param notifier The {@link RangeNotifier} to unregister.
+     * @param notifier
      * @see RangeNotifier
      */
     public boolean removeRangeNotifier(RangeNotifier notifier){
@@ -466,7 +466,7 @@
     }
 
     /**
-     * Remove all the Range Notifiers.
+     * Remove all the Range Notifiers
      */
     public void removeAllRangeNotifiers(){
         synchronized (rangeNotifiers){
@@ -482,11 +482,11 @@
      * activities or services set different MonitorNotifier instances, the last one set will receive
      * all the notifications.
      *
-     * @param notifier The {@link MonitorNotifier} to register.
+     * @param notifier
      * @see MonitorNotifier
-     * @see #startMonitoringBeaconsInRegion(Region)
+     * @see #startMonitoringBeaconsInRegion(Region region)
      * @see Region
-     * @deprecated replaced by {@link #addMonitorNotifier}
+     * @deprecated replaced by (@link #addMonitorNotifier)
      */
     @Deprecated
     public void setMonitorNotifier(MonitorNotifier notifier) {
@@ -497,16 +497,16 @@
     }
 
     /**
-     * Specifies a class that should be called each time the <code>BeaconService</code> sees or
-     * stops seeing a Region of beacons.
+     * Specifies a class that should be called each time the <code>BeaconService</code> sees
+     * or stops seeing a Region of beacons.
      * <p/>
-     * Permits to register several <code>MonitorNotifier</code> objects.
+     * Permits to register severals <code>MonitorNotifier</code> objects.
      *<p/>
-     * Unregister the notifier using {@link #removeMonitoreNotifier}
+     * Unregister the notifier using (@link #removeMonitoreNotifier)
      *
-     * @param notifier The {@link MonitorNotifier} to register.
+     * @param notifier
      * @see MonitorNotifier
-     * @see #startMonitoringBeaconsInRegion(Region)
+     * @see #startMonitoringBeaconsInRegion(Region region)
      * @see Region
      */
     public void addMonitorNotifier(MonitorNotifier notifier){
@@ -518,30 +518,21 @@
     }
 
     /**
-     * @see #removeMonitorNotifier
-     * @deprecated Misspelled. Replaced by {@link #removeMonitorNotifier}
-     */
-    @Deprecated
-    public boolean removeMonitoreNotifier(MonitorNotifier notifier) {
-        return removeMonitorNotifier(notifier);
-    }
-
-    /**
      * Specifies a class to remove from the array of <code>MonitorNotifier</code>.
      *
-     * @param notifier The {@link MonitorNotifier} to unregister.
+     * @param notifier
      * @see MonitorNotifier
-     * @see #startMonitoringBeaconsInRegion(Region)
+     * @see #startMonitoringBeaconsInRegion(Region region)
      * @see Region
      */
-    public boolean removeMonitorNotifier(MonitorNotifier notifier) {
+    public boolean removeMonitoreNotifier(MonitorNotifier notifier){
         synchronized (monitorNotifiers){
             return monitorNotifiers.remove(notifier);
         }
     }
 
     /**
-     * Remove all the Monitor Notifiers.
+     * Remove all the Monitor Notifers
      */
     public void removeAllMonitorNotifiers(){
         synchronized (monitorNotifiers){
@@ -550,27 +541,19 @@
     }
 
     /**
-     * @see #setRegionStatePersistenceEnabled
-     * @deprecated Misspelled. Replaced by {@link #setRegionStatePersistenceEnabled}
+     * Turns off saving the state of monitored regions to persistent storage so it is retained
+     * over app restarts.  Defaults to enabled.  When enabled, there will not be an ""extra"" region
+     * entry event when the app starts up and a beacon for a monitored region was previously visible
+     * within the past 15 minutes.  Note that there is a limit to 50 monitored regions that may be
+     * perisisted.  If more than 50 regions are monitored, state is not persisted for any.
+     *
+     * @param enabled
      */
-    @Deprecated
     public void setRegionStatePeristenceEnabled(boolean enabled) {
-        setRegionStatePersistenceEnabled(enabled);
-    }
-
-    /**
-     * Turns off saving the state of monitored regions to persistent storage so it is retained over
-     * app restarts.  Defaults to enabled.  When enabled, there will not be an ""extra"" region entry
-     * event when the app starts up and a beacon for a monitored region was previously visible
-     * within the past 15 minutes.  Note that there is a limit to 50 monitored regions that may be
-     * persisted.  If more than 50 regions are monitored, state is not persisted for any.
-     *
-     * @param enabled true to enable the region state persistence, false to disable it.
-     */
-    public void setRegionStatePersistenceEnabled(boolean enabled) {
         if (enabled) {
             MonitoringStatus.getInstanceForApplication(mContext).startStatusPreservation();
-        } else {
+        }
+        else {
             MonitoringStatus.getInstanceForApplication(mContext).stopStatusPreservation();
         }
     }",1
Fix crash on remote clien by initializing the CelestialSystem on remote clients too.," import org.terasology.world.internal.EntityAwareWorldProvider;
 import org.terasology.world.internal.WorldProviderCoreImpl;
 import org.terasology.world.internal.WorldProviderWrapper;
-import org.terasology.world.sun.BasicCelestialModel;
-import org.terasology.world.sun.CelestialSystem;
-import org.terasology.world.sun.DefaultCelestialSystem;
 
 /**
  * @author Immortius
@@ -66,10 +63,6 @@
         CoreRegistry.put(BlockEntityRegistry.class, entityWorldProvider);
         CoreRegistry.get(ComponentSystemManager.class).register(entityWorldProvider, ""engine:BlockEntityRegistry"");
 
-        DefaultCelestialSystem celestialSystem = new DefaultCelestialSystem(new BasicCelestialModel());
-        CoreRegistry.put(CelestialSystem.class, celestialSystem);
-        CoreRegistry.get(ComponentSystemManager.class).register(celestialSystem);
-
         // Init. a new world
         RenderingSubsystemFactory engineSubsystemFactory = CoreRegistry.get(RenderingSubsystemFactory.class);
         WorldRenderer worldRenderer = engineSubsystemFactory.createWorldRenderer(worldProvider, chunkProvider, CoreRegistry.get(LocalPlayerSystem.class));",1
Fix this rate app feature. ," 
     @OnClick(R.id.about_link_rate)
     public void onRate() {
-        Uri uri = Uri.parse(""market://details?id=org.horaapps.leafpic"");
-        Intent goToMarket = new Intent(Intent.ACTION_VIEW, uri);
-        // To count with Play market backstack, After pressing back button,
-        // to taken back to our application, we need to add following flags to intent.
-        goToMarket.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY |
-                Intent.FLAG_ACTIVITY_NEW_DOCUMENT |
-                Intent.FLAG_ACTIVITY_MULTIPLE_TASK);
-        try {
-            startActivity(goToMarket);
-        } catch (ActivityNotFoundException e) {
-            startActivity(new Intent(Intent.ACTION_VIEW,
-                    Uri.parse(""http://play.google.com/store/apps/details?id=org.horaapps.leafpic"" )));
-        }
+
+        //Until app is released this will not work because of conflicting package names
+        Intent intent = new Intent(Intent.ACTION_VIEW);
+        intent.setData(Uri.parse(""market://details?id=""+getPackageName()));
+        startActivity(intent);
     }
 
     @OnClick(R.id.about_link_github)",1
Fix not to throw NPE if username or password is null,"          if (username != null && !username.equals(otherKey.username)) {
             return false;
          }
-         else if (username != otherKey.username) {
+         else if (!username.equals(otherKey.username)) {
             return false;
          }
          else if (password != null && !password.equals(otherKey.password)) {
             return false;
          }
-         else if (password != otherKey.password) {
+         else if (!password.equals(otherKey.password)) {
             return false;
          }
 ",1
#3539 Text generator parameters processing fix,"         if (min != null) {
             this.minLength = min;
         }
-        if (minLength > templateString.length()) {
-            minLength = templateString.length();
-        }
 
         Integer max = (Integer) properties.get(""maxLength""); //$NON-NLS-1$
         if (max != null) {
@@ -64,9 +61,6 @@
         if (maxLength > templateString.length()) { // TODO check templateString shouldn't be empty
             maxLength = templateString.length();
         }
-        if (minLength > maxLength) {
-            maxLength = minLength;
-        }
     }
 
     @Override",1
Checking expiration time for access token fixed.,"     /** Maximum time this token is valid.  */
     private long maxTimeToLiveInSeconds;
 
-    /** Time to kill in seconds. */
+    /** Time to kill in milliseconds. */
     private long timeToKillInSeconds;
 
     public OAuthAccessTokenExpirationPolicy() {}
@@ -60,9 +60,9 @@
         }
 
         // token is within hard window, check timeToKill (sliding window)
-        expirationTime = ticketState.getLastTimeUsed().plus(this.timeToKillInSeconds, ChronoUnit.SECONDS);
-        if (currentSystemTime.isAfter(expirationTime)) {
-            LOGGER.debug(""Access token is expired because the time since last use is greater than timeToKillInSeconds"");
+        expirationTime = creationTime.plus(this.timeToKillInSeconds, ChronoUnit.SECONDS);
+        if (ticketState.getLastTimeUsed().isAfter(expirationTime)) {
+            LOGGER.debug(""Access token is expired because the time since last use is greater than timeToKillInMilliseconds"");
             return true;
         }
 ",1
Fixes java mode loading," import java.io.File;
 import java.io.IOException;
 import java.lang.reflect.Constructor;
-import java.net.URL;
 import java.net.URLClassLoader;
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.HashSet;
-import java.util.List;
-import java.util.Map;
+import java.util.*;
 
 import processing.app.Base;
 import processing.app.Mode;
-import processing.app.contrib.LocalContribution.IgnorableException;
 
 
 public class ModeContribution extends LocalContribution {
@@ -83,7 +77,8 @@
   private ModeContribution(Base base, File folder,
                            String className) throws Exception {
     super(folder);
-    className = initLoader(base, className);
+
+    className = initLoader(className);
     if (className != null) {
       Class<?> modeClass = loader.loadClass(className);
       Base.log(""Got mode class "" + modeClass);
@@ -181,88 +176,6 @@
     return loader.equals(other.loader) && mode.equals(other.getMode());
   }
 
-  public String initLoader(Base base, String className) throws Exception {
-    
-    File modeDirectory = new File(folder, getTypeName());
-    if (modeDirectory.exists()) {
-      Base.log(""checking mode folder regarding "" + className);
-      // If no class name specified, search the main <modename>.jar for the
-      // full name package and mode name.
-      if (className == null) {
-        String shortName = folder.getName();
-        File mainJar = new File(modeDirectory, shortName + "".jar"");
-        if (mainJar.exists()) {
-          className = findClassInZipFile(shortName, mainJar);
-        } else {
-          throw new IgnorableException(mainJar.getAbsolutePath() + "" does not exist."");
-        }
-
-        if (className == null) {
-          throw new IgnorableException(""Could not find "" + shortName +
-                                       "" class inside "" + mainJar.getAbsolutePath());
-        }
-      }
-      
-      ArrayList<URL> extraUrls = new ArrayList<>();
-      if (imports != null && imports.size() > 0) {
-        // if the mode has any dependencies (defined as imports in mode.properties),
-        // add the dependencies to the classloader
-        
-        HashMap<String, Mode> installedModes = new HashMap<>();
-        for(Mode m: base.getModeList()){
-          // Base.log(""Mode contrib: "" + m.getClass().getName() + "" : ""+ m.getFolder());
-          installedModes.put(m.getClass().getName(), m);
-        }
-        
-        for(String modeImport: imports){
-          if (installedModes.containsKey(modeImport)) {
-            Base.log(""Found mode dependency "" + modeImport);
-            File[] archives = Base.listJarFiles(new File(installedModes.get(modeImport).
-                               getFolder().getAbsolutePath() + File.separator + ""mode""));
-            if (archives != null && archives.length > 0) {
-              for (int i = 0; i < archives.length; i++) {
-                // Base.log(""Adding jar dependency: "" + archives[i].getAbsolutePath());
-                extraUrls.add(archives[i].toURI().toURL());
-              }
-            }
-          } else {
-            throw new IgnorableException(""Dependency mode ""+ modeImport + "" could not be""
-              + "" found. Can't load "" + className);
-          }
-        }
-      }
-
-      // Add .jar and .zip files from the ""mode"" folder into the classpath
-      File[] archives = Base.listJarFiles(modeDirectory);
-      if (archives != null && archives.length > 0) {
-        int arrLen = archives.length + extraUrls.size();
-        URL[] urlList = new URL[arrLen];
-        
-        int j = 0;
-        for (; j < extraUrls.size(); j++) {
-          //Base.log(""Found archive "" + archives[j] + "" for "" + getName());
-          urlList[j] = extraUrls.get(j);
-        }
-        
-        for (int k = 0; k < archives.length; k++,j++) {
-          Base.log(""Found archive "" + archives[k] + "" for "" + getName());
-          urlList[j] = archives[k].toURI().toURL();
-        }
-
-        loader = new URLClassLoader(urlList);
-        Base.log(""loading above JARs with loader "" + loader);
-//        System.out.println(""listing classes for loader "" + loader);
-//        listClasses(loader);
-      }
-    }
-
-    // If no archives were found, just use the regular ClassLoader
-    if (loader == null) {
-      loader = Thread.currentThread().getContextClassLoader();
-    }
-    return className;
-  }
-
 
 //  static protected List<File> discover(File folder) {
 //    File[] folders = listCandidates(folder, ""mode"");",1
Fix BTC status incorrectly hidden on splash screen,"         Timer showTorNetworkSettingsTimer = UserThread.runAfter(() -> {
             showTorNetworkSettingsButton.setVisible(true);
             showTorNetworkSettingsButton.setManaged(true);
+            if (btcSyncIndicator.progressProperty().getValue() <= 0) {
+                // If no progress has been made, hide the BTC status since tor is not working
+                btcSyncIndicator.setVisible(false);
+                btcSplashInfo.setVisible(false);
+            }
         }, SHOW_TOR_SETTINGS_DELAY_SEC);
 
         splashP2PNetworkIconIdListener = (ov, oldValue, newValue) -> {",1
mdns on resume fix," import android.graphics.Bitmap;
 import android.net.Uri;
 import android.os.IBinder;
-import android.os.PowerManager;
 import android.support.v4.app.NotificationCompat;
 import android.support.v4.app.NotificationManagerCompat;
 import android.util.Log;
@@ -140,6 +139,8 @@
     mDeviceAddressToUrl = new HashMap<>();
     mMdnsUrlDiscoverer = new MdnsUrlDiscoverer(this, UriBeaconDiscoveryService.this);
     initializeScreenStateBroadcastReceiver();
+    startSearchingForUriBeacons();
+    mMdnsUrlDiscoverer.startScanning();
   }
 
   /**
@@ -166,13 +167,6 @@
 
   @Override
   public int onStartCommand(Intent intent, int flags, int startId) {
-    // Start scanning only if the screen is on
-    PowerManager powerManager = (PowerManager) getSystemService(Context.POWER_SERVICE);
-    if (powerManager.isScreenOn()) {
-      startSearchingForUriBeacons();
-      mMdnsUrlDiscoverer.startScanning();
-    }
-
     //make sure the service keeps running
     return START_STICKY;
   }",1
JDK provider does not call any callback handler for some exceptions,"                 } catch (Throwable t2) {
                     logger.error(t2.getMessage(), t2);
                 }
-                asyncHandler.onThrowable(t);
             } finally {
                 if (terminate) {
                     if (config.getMaxConnections() != -1) {",1
Fixed an issue where overriding a product's additional sku would cause the add to cart to fail (MT Only),"  */
 package org.broadleafcommerce.core.catalog.dao;
 
-import org.apache.commons.collections4.CollectionUtils;
 import org.broadleafcommerce.common.persistence.EntityConfiguration;
 import org.broadleafcommerce.common.persistence.Status;
 import org.broadleafcommerce.common.sandbox.SandBoxHelper;
@@ -165,13 +164,10 @@
         predicates.add(cb.equal(root.get(""productOptionValue"").get(""attributeValue""), attributeValue));
 
         // restrict to skus that have ids within the given list of skus ids
-        if (CollectionUtils.isNotEmpty(possibleSkuIds)) {
-            possibleSkuIds = sandBoxHelper.mergeCloneIds(SkuImpl.class, possibleSkuIds.toArray(new Long[possibleSkuIds.size()]));
         Predicate skuDomainPredicate = buildSkuDomainPredicate(cb, root.get(""sku"").get(""id""), possibleSkuIds);
         if (skuDomainPredicate != null) {
             predicates.add(skuDomainPredicate);
         }
-        }
 
         // restrict archived values
         attachArchivalConditionIfPossible(SkuProductOptionValueXrefImpl.class, root, cb, predicates);",1
Fix text zoom when high-precision scrolling input is used," 		scrollPane.addMouseWheelListener(new MouseWheelListener() {
 			@Override
 			public void mouseWheelMoved(MouseWheelEvent e) {
-				if (e.getWheelRotation() == 0) {
-					// Nothing to do here. This happens when scroll event is delivered from a touchbar
-					// or MagicMouse. There's getPreciseWheelRotation, however it looks like there's no
-					// trivial and consistent way to use that
-					// See https://github.com/JetBrains/intellij-community/blob/21c99af7c78fc82aefc4d05646389f4991b08b38/bin/idea.properties#L133-L156
-					return;
-				}
 
 				if ((e.getModifiersEx() & InputEvent.CTRL_DOWN_MASK) != 0) {
 					Font font = textArea.getFont();",1
Fixed hard coded class names," 
 import com.googlecode.androidannotations.annotations.TextChange;
 import com.googlecode.androidannotations.helper.APTCodeModelHelper;
-import com.googlecode.androidannotations.helper.CanonicalNameConstants;
 import com.googlecode.androidannotations.helper.TextWatcherHelper;
 import com.googlecode.androidannotations.rclass.IRClass;
 import com.googlecode.androidannotations.rclass.IRClass.Res;
@@ -78,9 +77,9 @@
 			String parameterName = parameter.toString();
 			TypeMirror parameterType = parameter.asType();
 
-			if (CanonicalNameConstants.CHAR_SEQUENCE.equals(parameterType.toString())) {
+			if (""java.lang.CharSequence"".equals(parameterType.toString())) {
 				charSequenceParameterPosition = i;
-			} else if (parameterType.getKind() == TypeKind.INT || CanonicalNameConstants.INTEGER.equals(parameterType.toString())) {
+			} else if (parameterType.getKind() == TypeKind.INT || ""java.lang.integer"".equals(parameterType.toString())) {
 				if (""start"".equals(parameterName)) {
 					startParameterPosition = i;
 				} else if (""count"".equals(parameterName)) {
@@ -89,7 +88,7 @@
 					beforeParameterPosition = i;
 				}
 			} else {
-				TypeMirror textViewType = helper.typeElementFromQualifiedName(CanonicalNameConstants.TEXT_VIEW).asType();
+				TypeMirror textViewType = helper.typeElementFromQualifiedName(""android.widget.TextView"").asType();
 				if (helper.isSubtype(parameterType, textViewType)) {
 					viewParameterPosition = i;
 					viewParameterType = parameterType;",1
Fix windowInHours checking.," import javax.servlet.http.HttpServletRequest;
 import java.math.BigDecimal;
 import java.time.ZonedDateTime;
-import java.time.ZoneOffset;
 import java.util.Collection;
 
 /**
@@ -32,20 +31,17 @@
     @Override
     protected BigDecimal calculateScore(final HttpServletRequest request, final Authentication authentication,
                                         final RegisteredService service, final Collection<CasEvent> events) {
-        final ZonedDateTime timestamp = ZonedDateTime.now(ZoneOffset.UTC);
+        final ZonedDateTime timestamp = ZonedDateTime.now();
         LOGGER.debug(""Filtering authentication events for timestamp [{}]"", timestamp);
-        long count = 0;
 
-        if (timestamp.getHour() <= timestamp.plusHours(windowInHours).getHour()
-                && timestamp.getHour() >= timestamp.minusHours(windowInHours).getHour()){
-            count = events.stream().filter(e->e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
-                && e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
-        } else {
-            count = events.stream().filter(e -> e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
-                || e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
-        }
+        final long count = events.stream().filter(e -> {
+            final int hour = timestamp.getHour();
+            return e.getCreationTime().getHour() == hour
+                    || e.getCreationTime().plusHours(windowInHours).getHour() == hour
+                    || e.getCreationTime().minusHours(windowInHours).getHour() == hour;
+        }).count();
         
-        LOGGER.debug(""Total authentication events found for [{}] in a [{}]h window: [{}]"", timestamp, windowInHours, count);
+        LOGGER.debug(""Total authentication events found for [{}]: [{}]"", timestamp, count);
         if (count == events.size()) {
             LOGGER.debug(""Principal [{}] has always authenticated from [{}]"", authentication.getPrincipal(), timestamp);
             return LOWEST_RISK_SCORE;",1
修复UnsafeRowGrouper中对AVG处理精度时写死别名导致处理异常的BUG," 	 * 处理AVG列精度
 	 */
 	private void processAvgFieldPrecision() {
-	    for (MergeCol mergCol : mergCols) {
-            if (mergCol.mergeType != MergeCol.MERGE_AVG) {
-                continue ;
-            }
 		for(String key : columToIndx.keySet()) {
+			if(isAvgField(key)) { // AVG列的小数点精度默认取SUM小数点精度, 计算和返回的小数点精度应该扩展4
 				ColMeta colMeta = columToIndx.get(key);
-                // AVG列的小数点精度默认取SUM小数点精度, 计算和返回的小数点精度应该扩展4
-                if (colMeta.colIndex == mergCol.colMeta.avgSumIndex) {
 				colMeta.decimals += 4;
-                    break ;
-                }
 			}
 		}
 	}",1
1.x: fix ScalarSynchronousObservable expects EventLoopsScheduler from," import rx.internal.producers.SingleProducer;
 import rx.internal.schedulers.EventLoopsScheduler;
 import rx.observers.Subscribers;
+import rx.schedulers.Schedulers;
 
 /**
  * An Observable that emits a single constant scalar value to Subscribers.
@@ -33,6 +34,19 @@
  * @param <T> the value type
  */
 public final class ScalarSynchronousObservable<T> extends Observable<T> {
+
+    /**
+     * We expect the Schedulers.computation() to return an EventLoopsScheduler all the time.
+     */
+    static final Func1<Action0, Subscription> COMPUTATION_ONSCHEDULE = new Func1<Action0, Subscription>() {
+        final EventLoopsScheduler els = (EventLoopsScheduler)Schedulers.computation();
+        
+        @Override
+        public Subscription call(Action0 t) {
+            return els.scheduleDirect(t);
+        }
+    };
+
     /**
      * Indicates that the Producer used by this Observable should be fully
      * threadsafe. It is possible, but unlikely that multiple concurrent
@@ -101,13 +115,7 @@
     public Observable<T> scalarScheduleOn(final Scheduler scheduler) {
         final Func1<Action0, Subscription> onSchedule;
         if (scheduler instanceof EventLoopsScheduler) {
-            final EventLoopsScheduler els = (EventLoopsScheduler) scheduler;
-            onSchedule = new Func1<Action0, Subscription>() {
-                @Override
-                public Subscription call(Action0 a) {
-                    return els.scheduleDirect(a);
-                }
-            };
+            onSchedule = COMPUTATION_ONSCHEDULE;
         } else {
             onSchedule = new Func1<Action0, Subscription>() {
                 @Override",1
Fixed for JEP-223 support," 
 package processing.core;
 
-// dummy object for backwards compatibility, plus the select methods
+// used by link()
+import java.awt.Desktop;
+import java.awt.DisplayMode;
+import java.awt.EventQueue;
+import java.awt.FileDialog;
 import java.awt.Frame;
-
-// before calling settings() to get displayWidth/Height
-import java.awt.DisplayMode;
-// handleSettings() and displayDensity()
 import java.awt.GraphicsDevice;
 import java.awt.GraphicsEnvironment;
-// used to present the fullScreen() warning about Spaces on OS X
-import javax.swing.JOptionPane;
-
-// inside runSketch() to warn users about headless
 import java.awt.HeadlessException;
+import java.awt.Image;
 import java.awt.Toolkit;
-
-// used by loadImage()
-import java.awt.Image;
 import java.awt.color.ColorSpace;
 import java.awt.image.BufferedImage;
+
+// used by loadImage() functions
 import javax.imageio.ImageIO;
 // allows us to remove our own MediaTracker code
 import javax.swing.ImageIcon;
-
 // used by selectInput(), selectOutput(), selectFolder()
-import java.awt.EventQueue;
-import java.awt.FileDialog;
 import javax.swing.JFileChooser;
-
-// set the look and feel, if specified
 import javax.swing.UIManager;
-
-// used by link()
-import java.awt.Desktop;
-
+// used to present the fullScreen() warning about Spaces on OS X
+import javax.swing.JOptionPane;
 // used by desktopFile() method
 import javax.swing.filechooser.FileSystemView;
 
@@ -130,11 +119,8 @@
     String version = javaVersionName;
     if (javaVersionName.startsWith(""1."")) {
       version = version.substring(2);
+    }
     javaPlatform = parseInt(version.substring(0, version.indexOf('.')));
-    } else {
-      // Remove -xxx and .yyy from java.version (@see JEP-223)
-      javaPlatform = parseInt(version.replaceAll(""-.*"","""").replaceAll(""\\..*"",""""));
-    }
   }
 
   /**",1
Fix a possible NPE when checking supertypes of interfaces.,"             .put(""minecraft:items"", Item.class).build());
 
     private void findSuperTypes(Class<?> type, Set<Class<?>> types) {
-        if (type == null || type == Object.class) {
+        if (type == Object.class) {
             return;
         }
         types.add(type);",1
Fixed typo in OSecurityProxy," 
   @Override
   public OIdentifiable allowUser(ODocument iDocument, ORestrictedOperation iOperationType, String iUserName) {
-    return delegate.allowUser(iDocument, iOperationType, iUserName);
+    return delegate.allowRole(iDocument, iOperationType, iUserName);
   }
 
   @Override",1
fix #1453 Converted eager toString call from index operator to lazy," 	FluxIndex(Flux<T> source,
 			BiFunction<? super Long, ? super T, ? extends I> indexMapper) {
 		super(source);
-		this.indexMapper = new NullSafeIndexMapper(Objects.requireNonNull(indexMapper,
-				""indexMapper must be non null""));
+		this.indexMapper = Objects.requireNonNull(indexMapper, ""indexMapper must be non null"");
 	}
 
 	@Override
@@ -90,7 +89,9 @@
 
 			long i = this.index;
 			try {
-				I typedIndex = indexMapper.apply(i, t);
+				I typedIndex = Objects.requireNonNull(indexMapper.apply(i, t),
+						""indexMapper returned a null value at raw index "" + i +
+								"" for value "" + t);
 				this.index = i + 1L;
 				actual.onNext(typedIndex);
 			}
@@ -181,7 +182,9 @@
 			I typedIndex;
 			long i = this.index;
 			try {
-				typedIndex = indexMapper.apply(i, t);
+				typedIndex = Objects.requireNonNull(indexMapper.apply(i, t),
+						""indexMapper returned a null value at raw index "" + i +
+								"" for value "" + t);
 				this.index = i + 1L;
 			}
 			catch (Throwable e) {
@@ -201,7 +204,9 @@
 
 			long i = this.index;
 			try {
-				I typedIndex = indexMapper.apply(i, t);
+				I typedIndex = Objects.requireNonNull(indexMapper.apply(i, t),
+						""indexMapper returned a null value at raw index "" + i +
+								"" for value "" + t);
 				this.index = i + 1L;
 				actual.onNext(typedIndex);
 			}
@@ -257,22 +262,4 @@
 		}
 	}
 
-	private class NullSafeIndexMapper implements BiFunction<Long, T, I> {
-
-		private final BiFunction<? super Long, ? super T, ? extends I> indexMapper;
-
-		public NullSafeIndexMapper(BiFunction<? super Long, ? super T, ? extends I> indexMapper) {
-			this.indexMapper = indexMapper;
-		}
-
-		@Override
-		public I apply(Long i, T t) {
-			I typedIndex = indexMapper.apply(i, t);
-			if (typedIndex == null) {
-				throw new NullPointerException(""indexMapper returned a null value"" +
-						"" at raw index "" + i + "" for value "" + t);
-			}
-			return typedIndex;
-		}
-	}
 }",1
fix clearityPopWindow position,"             clarityPopWindow.setContentView(layout);
             clarityPopWindow.showAsDropDown(clarity);
             layout.measure(View.MeasureSpec.UNSPECIFIED, View.MeasureSpec.UNSPECIFIED);
-            int offsetX = clarity.getMeasuredWidth() / 3;
-            int offsetY = clarity.getMeasuredHeight() / 3;
-            clarityPopWindow.update(clarity, - offsetX, - offsetY, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
+            clarityPopWindow.update(clarity, -40, 46, Math.round(layout.getMeasuredWidth() * 2), layout.getMeasuredHeight());
         } else if (i == R.id.retry_btn) {
             if (dataSourceObjects == null || JZUtils.getCurrentFromDataSource(dataSourceObjects, currentUrlMapIndex) == null) {
                 Toast.makeText(getContext(), getResources().getString(R.string.no_url), Toast.LENGTH_SHORT).show();",1
fixes #468 resolve backward compatible issue for server.config,"     // service_id in slf4j MDC
     static final String SID = ""sId"";
 
-    @Deprecated
-    public static ServerConfig config = getServerConfig(); // there are a lot of users are using the static variable in their code.
     public final static TrustManager[] TRUST_ALL_CERTS = new X509TrustManager[]{new DummyTrustManager()};
 
     static protected boolean shutdownRequested = false;
@@ -163,7 +161,6 @@
         if (serverConfig.dynamicPort) {
             if (serverConfig.minPort > serverConfig.maxPort) {
                 String errMessage = ""No ports available to bind to - the minPort is larger than the maxPort in server.yml"";
-                System.out.println(errMessage);
                 logger.error(errMessage);
                 throw new RuntimeException(errMessage);
             }          ",1
MessageParser: fix the regex for otr query messages.," 		}
 		updateLastseen(packet, account, true);
 		String body = packet.getBody();
-		if (body.matches(""^\\?OTRv\\d{1,2}\\?.*"")) {
+		if (body.matches(""^\\?OTRv\\d*\\?"")) {
 			conversation.endOtrIfNeeded();
 		}
 		if (!conversation.hasValidOtrSession()) {",1
"bug fixed, AccessibilityManager injected instead of AudioManager","         mapSystemSericeClassToName.put(InputMethodManager.class, Context.INPUT_METHOD_SERVICE);
         mapSystemSericeClassToName.put(SensorManager.class, Context.SENSOR_SERVICE);
         mapSystemSericeClassToName.put(TelephonyManager.class, Context.TELEPHONY_SERVICE);
-        mapSystemSericeClassToName.put(AudioManager.class, Context.AUDIO_SERVICE);
+        mapSystemSericeClassToName.put(AudioManager.class, Context.ACCESSIBILITY_SERVICE);
     }
 
 ",1
Fix Issue 375 ..restore thing that was not broken," 
 package com.zaxxer.hikari;
 
-import java.io.File;
-import java.io.FileInputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.lang.reflect.Field;
 import java.lang.reflect.Modifier;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.nio.file.Paths;
 import java.util.Properties;
 import java.util.Set;
 import java.util.TreeSet;
@@ -848,8 +849,8 @@
 
    protected void loadProperties(String propertyFileName)
    {
-      final File propFile = new File(propertyFileName);
-      try (final InputStream is = propFile.isFile() ? new FileInputStream(propFile) : this.getClass().getResourceAsStream(propertyFileName)) {
+      final Path propFile = Paths.get(propertyFileName);
+      try (final InputStream is = Files.isRegularFile(propFile) ? Files.newInputStream(propFile) : HikariConfig.class.getResourceAsStream(propertyFileName)) {
          if (is != null) {
             Properties props = new Properties();
             props.load(is);",1
Fixes the grateful shutdown of cas,"     private CasConfigurationProperties casProperties;
 
     @Bean
-    public JdbcAuditTrailManager jdbcAuditTrailManager() {
+    public DelegatingAuditTrailManager auditTrailManager() {
         final AuditProperties.Jdbc jdbc = casProperties.getAudit().getJdbc();
         final JdbcAuditTrailManager t = new JdbcAuditTrailManager(inspektrAuditTransactionTemplate());
         t.setCleanupCriteria(auditCleanupCriteria());
@@ -55,12 +55,7 @@
             tableName = jdbc.getDefaultCatalog() + '.' + tableName;
         }
         t.setTableName(tableName);
-        return t;
-    }
-
-    @Bean
-    public DelegatingAuditTrailManager auditTrailManager() {
-        return new DefaultDelegatingAuditTrailManager(jdbcAuditTrailManager());
+        return new DefaultDelegatingAuditTrailManager(t);
     }
 
     @Lazy",1
fix sofa rest to extends,"         httpServer = buildServer();
     }
 
-    protected SofaNettyJaxrsServer buildServer() {
+    private SofaNettyJaxrsServer buildServer() {
         // 生成Server对象
         SofaNettyJaxrsServer httpServer = new SofaNettyJaxrsServer(serverConfig);
 
@@ -99,7 +99,7 @@
         return httpServer;
     }
 
-    protected void registerProvider(ResteasyProviderFactory providerFactory) {
+    private void registerProvider(ResteasyProviderFactory providerFactory) {
         // 注册内置
         Set<Class> internalProviderClasses = JAXRSProviderManager.getInternalProviderClasses();
         if (CommonUtils.isNotEmpty(internalProviderClasses)) {",1
Fixing bug when using a token issued for a user in subclass of OUser,"     ORID userRid = ((OrientJwtPayload) payload).getUserRid();
     ODocument result;
     result = db.load(userRid, ""roles:1"");
-    if (!result.getSchemaClass().isSubClassOf(OUser.CLASS_NAME)) {
+    if (!result.getClassName().equals(OUser.CLASS_NAME)) {
       result = null;
     }
     return new OUser(result);",1
PUBDEV-4735: Fix sharing stage between threads in DeepLearning POJO,"       JCodeGen.toClassWithArray(sb, ""static"", ""NORMSUB"", model_info().data_info()._normSub);//, ""Standardization/Normalization offset for numerical variables."");
     }
     if (model_info().data_info()._cats > 0) {
-      sb.i(0).p(""// Thread-local workspace for storing categorical input variables."").nl();
-      sb.i(0).p(""final int[] CATS = new int["" + model_info().data_info()._cats +""];"").nl();
+      JCodeGen.toStaticVar(sb, ""CATS"", new int[model_info().data_info()._cats], ""Workspace for storing categorical input variables."");
     }
-    JCodeGen.toStaticVar(sb, ""CATOFFSETS"", model_info().data_info()._catOffsets, ""Offset into the workspace for categorical variables."");
+    JCodeGen.toStaticVar(sb, ""CATOFFSETS"", model_info().data_info()._catOffsets, ""Workspace for categorical offsets."");
     if (model_info().data_info()._normRespMul != null) {
       JCodeGen.toStaticVar(sb, ""NORMRESPMUL"", model_info().data_info()._normRespMul, ""Standardization/Normalization scaling factor for response."");
       JCodeGen.toStaticVar(sb, ""NORMRESPSUB"", model_info().data_info()._normRespSub, ""Standardization/Normalization offset for response."");",1
Handle null album cursor,"         Cursor albums = super.loadInBackground();
         MatrixCursor allAlbum = new MatrixCursor(COLUMNS);
         int totalCount = 0;
-        String allAlbumCoverPath = """";
-        if (albums != null) {
         while (albums.moveToNext()) {
             totalCount += albums.getInt(albums.getColumnIndex(COLUMN_COUNT));
         }
+        String allAlbumCoverPath;
         if (albums.moveToFirst()) {
             allAlbumCoverPath = albums.getString(albums.getColumnIndex(MediaStore.MediaColumns.DATA));
-            }
+        } else {
+            allAlbumCoverPath = """";
         }
         allAlbum.addRow(new String[]{Album.ALBUM_ID_ALL, Album.ALBUM_ID_ALL, Album.ALBUM_NAME_ALL, allAlbumCoverPath,
                 String.valueOf(totalCount)});",1
[PDI-13132] - Fix for Netezza sequence usage - test fix,"   @Test
   public void testSupport() {
 
+    DatabaseInterface databaseInterface;
+
     // According to our Meta, Oracle, PostGres,
     // Greenplum and Vertica support sequences
-    DatabaseInterface[] support = new DatabaseInterface[] {
-      new OracleDatabaseMeta(),
-      new OracleRDBDatabaseMeta(),
-      new VerticaDatabaseMeta(),
-      new PostgreSQLDatabaseMeta(),
-      new GreenplumDatabaseMeta(),
-      new AS400DatabaseMeta(),
-      new DB2DatabaseMeta(),
-      new HypersonicDatabaseMeta(),
-      new KingbaseESDatabaseMeta(),
-      new NetezzaDatabaseMeta()
-    };
+    databaseInterface = new OracleDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new OracleRDBDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new VerticaDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new PostgreSQLDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new GreenplumDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new AS400DatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new DB2DatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new HypersonicDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new KingbaseESDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
+
+    databaseInterface = new NetezzaDatabaseMeta();
+    assertTrue( databaseInterface.supportsSequences() );
 
     // the rest of the database metas say they don't support sequences
-    DatabaseInterface[] doNotSupport = new DatabaseInterface[] {
-      new MySQLDatabaseMeta(),
-      new InfiniDbDatabaseMeta(),
-      new InfobrightDatabaseMeta(),
-      new DbaseDatabaseMeta(),
-      new DerbyDatabaseMeta(),
-      new ExtenDBDatabaseMeta(),
-      new FirebirdDatabaseMeta(),
-      new GenericDatabaseMeta(),
-      new GuptaDatabaseMeta(),
-      new H2DatabaseMeta(),
-      new InformixDatabaseMeta(),
-      new IngresDatabaseMeta(),
-      new InterbaseDatabaseMeta(),
-      new LucidDBDatabaseMeta(),
-      new MonetDBDatabaseMeta(),
-      new MSAccessDatabaseMeta(),
-      new MSSQLServerDatabaseMeta(),
-      new MSSQLServerNativeDatabaseMeta(),
-      new NeoviewDatabaseMeta(),
-      new RemedyActionRequestSystemDatabaseMeta(),
-      new SAPDBDatabaseMeta(),
-      new SAPR3DatabaseMeta(),
-      new SQLiteDatabaseMeta(),
-      new SybaseDatabaseMeta(),
-      new SybaseIQDatabaseMeta(),
-      new TeradataDatabaseMeta(),
-      new UniVerseDatabaseMeta()
-    };
 
-    for ( DatabaseInterface db : support ) {
-      assertSupports( db, true );
-    }
+    databaseInterface = new MySQLDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
 
-    for ( DatabaseInterface db : doNotSupport ) {
-      assertSupports( db, false );
-    }
-  }
+    databaseInterface = new InfiniDbDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
 
-  private static void assertSupports( DatabaseInterface db, boolean expected ) {
-    if (expected) {
-      assertTrue( db.getClass().getSimpleName(), db.supportsSequences() );
-    } else {
-      assertFalse( db.getClass().getSimpleName(), db.supportsSequences() );
-    }
+    databaseInterface = new InfobrightDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new DbaseDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new DerbyDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new ExtenDBDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new FirebirdDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new GenericDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new GuptaDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new H2DatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new InformixDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new IngresDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new InterbaseDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new LucidDBDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new MonetDBDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new MSAccessDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new MSSQLServerDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new MSSQLServerNativeDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new NeoviewDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new RemedyActionRequestSystemDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new SAPDBDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new SAPR3DatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new SQLiteDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new SybaseDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new SybaseIQDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new TeradataDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
+
+    databaseInterface = new UniVerseDatabaseMeta();
+    assertFalse( databaseInterface.supportsSequences() );
   }
 
   @Test
@@ -153,7 +208,7 @@
     assertEquals( ""SELECT currval('sequence_name')"", databaseInterface.getSQLCurrentSequenceValue( sequenceName ) );
 
     databaseInterface = new NetezzaDatabaseMeta();
-    assertEquals( ""select next value for sequence_name"", databaseInterface.getSQLNextSequenceValue( sequenceName ) );
+    assertEquals( ""select nextval('sequence_name')"", databaseInterface.getSQLNextSequenceValue( sequenceName ) );
     assertEquals( ""select last_value from sequence_name"", databaseInterface
       .getSQLCurrentSequenceValue( sequenceName ) );
 ",1
IssueFix1196,"     private UtilsHandler mUtilsHandler;
 
     private static Handler mApplicationHandler = new Handler();
-    private HandlerThread sBackgroundHandlerThread;
+    private static HandlerThread sBackgroundHandlerThread = new HandlerThread(""app_background"");
     private static Handler sBackgroundHandler;
     private static Context sActivityContext;
     private static ScreenUtils screenUtils;
@@ -66,7 +66,6 @@
     public void onCreate() {
         super.onCreate();
         AppCompatDelegate.setCompatVectorFromResourcesEnabled(true);//selector in srcCompat isn't supported without this
-        sBackgroundHandlerThread = new HandlerThread(""app_background"");
         mInstance = this;
 
         utilsProvider = new UtilitiesProvider(this);",1
Fix exception in testapp caused by bad int input," import android.databinding.ObservableBoolean;
 import android.databinding.ObservableField;
 import android.databinding.ObservableInt;
-import android.text.TextUtils;
 import android.widget.EditText;
 
 import com.firebase.jobdispatcher.RetryStrategy;
@@ -41,11 +40,11 @@
     }
 
     public void setWinStartSecondsStr(String in) {
-        winStartSeconds = convertToInt(in);
+        winStartSeconds = Integer.valueOf(in, 10);
     }
 
     public void setWinEndSecondsStr(String in) {
-        winEndSeconds = convertToInt(in);
+        winEndSeconds = Integer.valueOf(in, 10);
     }
 
     @Bindable
@@ -82,7 +81,4 @@
         return maximumBackoffSeconds;
     }
 
-    private int convertToInt(String in) {
-        return !TextUtils.isEmpty(in) ? Integer.valueOf(in, 10) : 0;
-    }
 }",1
fix preview size selection,"                 SizeSelectors.minWidth(targetMinSize.getWidth()));
         SizeSelector matchAll = SizeSelectors.or(
                 SizeSelectors.and(matchRatio, matchSize),
-                SizeSelectors.and(matchRatio, SizeSelectors.biggest()), // If couldn't match both, match ratio and biggest.
+                matchRatio, // If couldn't match both, match ratio.
                 SizeSelectors.biggest() // If couldn't match any, take the biggest.
         );
         Size result = matchAll.select(previewSizes).get(0);",1
Fixed fetching detail metrics.(Fix incorrectly typed values in metrics),"         this.profileJvmVendorName = readString(""profiler.jvm.vendor.name"", null);
         this.profileJvmStatCollectIntervalMs = readInt(""profiler.jvm.stat.collect.interval"", DEFAULT_AGENT_STAT_COLLECTION_INTERVAL_MS);
         this.profileJvmStatBatchSendCount = readInt(""profiler.jvm.stat.batch.send.count"", DEFAULT_NUM_AGENT_STAT_BATCH_SEND);
-        this.profilerJvmStatCollectDetailedMetrics = readBoolean(""profiler.jvm.stat.collect.detailed.metrics"", false);
+        this.profilerJvmStatCollectDetailedMetrics = readBoolean(""profiler.stat.jvm.collect.detailed.metrics"", false);
 
         this.agentInfoSendRetryInterval = readLong(""profiler.agentInfo.send.retry.interval"", DEFAULT_AGENT_INFO_SEND_RETRY_INTERVAL);
 ",1
"Fixes #4035 and missing ""iPad 6,7"""," 	IPAD_MINI_AIR_2_WIFI_CELLULAR(""iPad5,4"", 264),
 	IPAD_PRO_WIFI(""iPad6,7"", 264),
 	IPAD_PRO(""iPad6,8"", 264),
-	IPAD_PRO_97_WIFI(""iPad6,3"", 264),
-	IPAD_PRO_97(""iPad6,4"", 264),
 	
 	SIMULATOR_32(""i386"", 264),
 	SIMULATOR_64(""x86_64"", 264);",1
[PUBDEV-5403] Fix wrong comment in h2odriver,"                     ""          o  Only one mapper may be run per host.\n"" +
                     ""          o  There are no combiners or reducers.\n"" +
                     ""          o  Each H2O cluster should have a unique jobname.\n"" +
-                    ""          o  -mapperXmx and -nodes are required.\n"" +
+                    ""          o  -mapperXmx, -nodes and -output are required.\n"" +
                     ""\n"" +
                     ""          o  -mapperXmx is set to both Xms and Xmx of the mapper to reserve\n"" +
                     ""             memory up front.\n"" +",1
"Quick fix for #2329, disposes loaded assets for correct initialization","  */
 package org.terasology.logic.console.suggesters;
 
-import com.google.api.client.util.Maps;
 import com.google.common.collect.Sets;
 import org.terasology.assets.ResourceUrn;
 import org.terasology.assets.management.AssetManager;
@@ -24,7 +23,7 @@
 import org.terasology.rendering.nui.UIScreenLayer;
 import org.terasology.rendering.nui.asset.UIElement;
 
-import java.util.Map;
+import java.util.HashMap;
 import java.util.Optional;
 import java.util.Set;
 
@@ -37,22 +36,19 @@
 
     @Override
     public Set<String> suggest(EntityRef sender, Object... resolvedParameters) {
-        Map<String, Set<ResourceUrn>> resourceMap = Maps.newHashMap();
+
+        HashMap<String, Set<ResourceUrn>> resourceMap = new HashMap<>();
         Set<String> suggestions = Sets.newHashSet();
 
         for (ResourceUrn resolvedParameter : assetManager.getAvailableAssets(UIElement.class)) {
             Optional<UIElement> element = assetManager.getAsset(resolvedParameter, UIElement.class);
             if (element.isPresent() && element.get().getRootWidget() instanceof UIScreenLayer) {
                 String resourceName = resolvedParameter.getResourceName().toString();
-                if (!resourceMap.containsKey(resourceName)) {
+                if (!resourceMap.containsKey(resourceName))
                     resourceMap.put(resourceName, Sets.newHashSet());
-                }
 
                 resourceMap.get(resourceName).add(resolvedParameter);
             }
-            if (element.isPresent()) {
-                element.get().dispose();
-            }
         }
 
         for (String key : resourceMap.keySet()) {",1
Fixed stack overflow on toString(),"         return ""GraphQLInterfaceType{"" +
                 ""name='"" + name + '\'' +
                 "", description='"" + description + '\'' +
-                "", fieldDefinitionsByName="" + fieldDefinitionsByName.keySet() +
+                "", fieldDefinitionsByName="" + fieldDefinitionsByName +
                 "", typeResolver="" + typeResolver +
                 '}';
     }",1
Fetch partitions from owner only," import com.hazelcast.nio.Connection;
 import com.hazelcast.nio.serialization.Data;
 import com.hazelcast.partition.NoDataMemberInClusterException;
-import com.hazelcast.util.ExceptionUtil;
 import com.hazelcast.util.HashUtil;
 
 import java.util.Collection;
@@ -56,7 +55,7 @@
 
     private static final long PERIOD = 10;
     private static final long INITIAL_DELAY = 10;
-    private static final long BLOCKING_GET_ONCE_SLEEP_MILLIS = 100;
+
     private final ExecutionCallback<ClientMessage> refreshTaskCallback = new RefreshTaskCallback();
     private final ConcurrentHashMap<Integer, Address> partitions = new ConcurrentHashMap<Integer, Address>(271, 0.75f, 1);
     private final ClientExecutionServiceImpl clientExecutionService;
@@ -65,7 +64,6 @@
 
     private volatile int partitionCount;
     private volatile int lastPartitionStateVersion = -1;
-    private volatile Connection ownerConnection;
     private final Object lock = new Object();
 
     public ClientPartitionServiceImpl(HazelcastClientInstanceImpl client) {
@@ -82,7 +80,6 @@
     public void listenPartitionTable(Connection ownerConnection) throws Exception {
         //when we connect to cluster back we need to reset partition state version
         lastPartitionStateVersion = -1;
-        this.ownerConnection = ownerConnection;
         if (((ClientConnection) ownerConnection).getConnectedServerVersion() >= BuildInfo.calculateVersion(""3.9"")) {
             //Servers after 3.9 supports listeners
             ClientMessage clientMessage = ClientAddPartitionListenerCodec.encodeRequest();
@@ -118,21 +115,12 @@
 
     private void waitForPartitionsFetchedOnce() {
         while (partitionCount == 0 && client.getConnectionManager().isAlive()) {
-            Connection ownerConnection = this.ownerConnection;
-            if (ownerConnection == null) {
-                sleepBeforeNextTry();
-                continue;
-            }
             if (isClusterFormedByOnlyLiteMembers()) {
                 throw new NoDataMemberInClusterException(
                         ""Partitions can't be assigned since all nodes in the cluster are lite members"");
             }
-
             ClientMessage requestMessage = ClientGetPartitionsCodec.encodeRequest();
-            // invocation should go to owner connection because the listener is added to owner connection
-            // and partition state version should be fetched from one member to keep it consistent
-            ClientInvocationFuture future =
-                    new ClientInvocation(client, requestMessage, null, ownerConnection).invokeUrgent();
+            ClientInvocationFuture future = new ClientInvocation(client, requestMessage, null).invokeUrgent();
             try {
                 ClientMessage responseMessage = future.get();
                 ClientGetPartitionsCodec.ResponseParameters response =
@@ -147,15 +135,6 @@
         }
     }
 
-    private void sleepBeforeNextTry() {
-        try {
-            Thread.sleep(BLOCKING_GET_ONCE_SLEEP_MILLIS);
-        } catch (InterruptedException e) {
-            Thread.currentThread().interrupt();
-            throw ExceptionUtil.rethrow(e);
-        }
-    }
-
     private boolean isClusterFormedByOnlyLiteMembers() {
         final ClientClusterService clusterService = client.getClientClusterService();
         return clusterService.getMembers(MemberSelectors.DATA_MEMBER_SELECTOR).isEmpty();",1
Fix typo in SyntheticAddress comments,"  * Methods for creating and decoding synthetic addresses.
  * A synthetic address is a physical position within an array of Slices.  The address is encoded
  * as a long with the high 32 bits containing the index of the slice in the array and the low 32
- * bits containing an offset within the slice.
+ * bits containing an offset with the slice.
  */
 public final class SyntheticAddress
 {",1
Fix/autovalue,"                     PsiAnnotation annotationFromText = mFactory.createAnnotationFromText(""@com.bluelinelabs.logansquare.annotation.JsonObject"", mClass);
                     modifierList.addBefore(annotationFromText, firstChild);
                 }
-            } else if (Config.getInstant().getAnnotationStr().equals(Strings.autoValueAnnotation)) {
-                hanleAutoValueAnnotation(mFactory, mClass);
             }
         } catch (Throwable e) {
         }
 
+        createExtraMethod(mFactory, mClass);
 
         for (FieldEntity fieldEntity : getFields()) {
             if (fieldEntity instanceof InnerClassEntity) {
@@ -174,31 +173,10 @@
             }
         }
 
-        configGetterAndSetter(mFactory, mClass);
-
-        createExtraMethod(mFactory, mClass);
-    }
-
-    private void hanleAutoValueAnnotation(PsiElementFactory mFactory, PsiClass mClass) {
-        PsiModifierList modifierList = mClass.getModifierList();
-        PsiElement firstChild = modifierList.getFirstChild();
-        Pattern pattern = Pattern.compile(""@.*?AutoValue"");
-        if (firstChild != null && !pattern.matcher(firstChild.getText()).find()) {
-            PsiAnnotation annotationFromText = mFactory.createAnnotationFromText(""@com.google.auto.value.AutoValue"", mClass);
-            modifierList.addBefore(annotationFromText, firstChild);
-        }
-
-        if (!modifierList.hasModifierProperty(PsiModifier.ABSTRACT)) {
-            modifierList.setModifierProperty(PsiModifier.ABSTRACT, true);
-        }
-    }
-
-    private void configGetterAndSetter(PsiElementFactory mFactory, PsiClass mClass) {
-        if (!Config.getInstant().getAnnotationStr().equals(Strings.autoValueAnnotation)) {
         if (Config.getInstant().isFieldPrivateMode()) {
             createGetAndSetMethod(mFactory, getFields(), mClass);
         }
-        }
+
     }
 
     private void createExtraMethod(PsiElementFactory mFactory, PsiClass mClass) {
@@ -224,22 +202,27 @@
         if (isGenerate()) {
             String classContent =
                     ""public static class "" + className + ""{}"";
+            if (Config.getInstant().getAnnotationStr().equals(Strings.autoValueAnnotation)) {
+                classContent = ""public abstract static class "" + className + ""{}"";
+            }
             PsiClass subClass = mFactory.createClassFromText(classContent, null).getInnerClasses()[0];
 
+            createExtraMethod(mFactory, subClass);
+
+
             for (FieldEntity fieldEntity : getFields()) {
                 if (fieldEntity instanceof InnerClassEntity) {
                     ((InnerClassEntity) fieldEntity).generateSupperFiled(mFactory, subClass);
                     ((InnerClassEntity) fieldEntity).setFieldTypeSuffix(getClassFieldType());
                     ((InnerClassEntity) fieldEntity).generateClass(mFactory, subClass);
-                    fieldEntity.generateFiled(mFactory, subClass, this);
                 } else {
+
                     fieldEntity.generateFiled(mFactory, subClass, this);
                 }
             }
-
-            configGetterAndSetter(mFactory, subClass);
-            createExtraMethod(mFactory, subClass);
-
+            if (Config.getInstant().isFieldPrivateMode()) {
+                createGetAndSetMethod(mFactory, getFields(), subClass);
+            }
             parentClass.add(subClass);
 
             if (Config.getInstant().getAnnotationStr().equals(Strings.jackAnnotation)) {
@@ -264,11 +247,6 @@
                     PsiElement firstChild = modifierList.getFirstChild();
                     modifierList.addBefore(annotationFromText, firstChild);
                 }
-            } else if (Config.getInstant().getAnnotationStr().equals(Strings.autoValueAnnotation)) {
-                subClass = parentClass.findInnerClassByName(className, false);
-                if (subClass != null) {
-                    hanleAutoValueAnnotation(mFactory, subClass);
-                }
             }
         }
     }",1
Fixed classloading if classes are not in the default classloader but tccl,"             try {
                 return theClassLoader.loadClass(className);
             } catch (ClassNotFoundException ignore) {
-
-                // Reset selected classloader and try with others
-                theClassLoader = null;
             }
         }
-
         // If failed and this is a Hazelcast class try again with our classloader
         if (className.startsWith(HAZELCAST_BASE_PACKAGE) || className.startsWith(HAZELCAST_ARRAY)) {
             theClassLoader = ClassLoaderUtil.class.getClassLoader();",1
Add methods into the class generated in case of error to make the cod…,"             }
 
             if (currentGenerator == null) {
-                generateErrorClass(e, pkg, fqn, clazzName, null);
+                generateErrorClass(e, pkg, fqn, clazzName);
                 emitError(""Unknown message type: "" + message.value(), e);
                 continue;
             }
 
             if (isInstanceMissing(receiverTypeFullClassName)) {
-                generateErrorClass(e, pkg, fqn, clazzName, null);
+                generateErrorClass(e, pkg, fqn, clazzName);
                 emitError(""Missing isInstance method in class "" + receiverTypeFullClassName, e);
                 continue;
             }
 
             if (!e.getModifiers().contains(javax.lang.model.element.Modifier.FINAL)) {
-                generateErrorClass(e, pkg, fqn, clazzName, null);
+                generateErrorClass(e, pkg, fqn, clazzName);
                 emitError(""Class must be final"", e);
                 continue;
             }
 
             List<ExecutableElement> methods = currentGenerator.getAccessMethods();
-            if (methods.isEmpty()) {
-                generateErrorClass(e, pkg, fqn, clazzName, null);
+            if (methods.size() == 0) {
+                generateErrorClass(e, pkg, fqn, clazzName);
                 emitError(""There needs to be at least one access method."", e);
                 continue;
             }
@@ -170,16 +170,15 @@
             for (ExecutableElement m : methods) {
                 params = m.getParameters();
                 if (argumentSize != params.size()) {
-                    generateErrorClass(e, pkg, fqn, clazzName, methods);
                     emitError(""Inconsistent argument length."", e);
-                    continue top;
+                    continue;
                 }
             }
 
             for (ExecutableElement m : methods) {
                 String errorMessage = currentGenerator.checkSignature(m);
                 if (errorMessage != null) {
-                    generateErrorClass(e, pkg, fqn, clazzName, null);
+                    generateErrorClass(e, pkg, fqn, clazzName);
                     emitError(errorMessage, m);
                     continue top;
                 }
@@ -211,7 +210,7 @@
         return true;
     }
 
-    private void generateErrorClass(Element e, final String pkg, final String fqn, final String clazzName, List<ExecutableElement> methods) {
+    private void generateErrorClass(Element e, final String pkg, final String fqn, final String clazzName) {
         try {
             JavaFileObject file = processingEnv.getFiler().createSourceFile(fqn, e);
             Writer w = file.openWriter();
@@ -219,11 +218,6 @@
 
             w.append(""abstract class "").append(clazzName).append("" {\n"");
             w.append(""  // An error occured, fix "").append(e.getSimpleName()).append("" first.\n"");
-            if (methods != null) {
-                for (ExecutableElement m : methods) {
-                    generateAbstractMethod(w, m, null);
-                }
-            }
             w.append(""}\n"");
             w.close();
         } catch (IOException ex1) {
@@ -283,19 +277,6 @@
         processingEnv.getMessager().printMessage(Kind.ERROR, msg, e);
     }
 
-    static void generateAbstractMethod(Writer w, ExecutableElement method, String extraName) throws IOException {
-        String methodName = extraName == null ? method.getSimpleName().toString() : extraName;
-        w.append(""  protected abstract "").append(method.getReturnType().toString()).append("" "").append(methodName);
-        w.append(""("");
-        final List<? extends VariableElement> params = method.getParameters();
-        String sep = """";
-        for (VariableElement p : params) {
-            w.append(sep).append(p.asType().toString()).append("" "").append(p.getSimpleName());
-            sep = "", "";
-        }
-        w.append("");\n"");
-    }
-
     private abstract static class MessageGenerator {
         protected static final String ACCESS_METHOD_NAME = ""access"";
 
@@ -371,7 +352,15 @@
 
         void appendAbstractMethods(Writer w) throws IOException {
             for (ExecutableElement method : getAccessMethods()) {
-                generateAbstractMethod(w, method, ACCESS_METHOD_NAME);
+                w.append(""  protected abstract "").append(method.getReturnType().toString()).append("" "").append(ACCESS_METHOD_NAME);
+                w.append(""("");
+                final List<? extends VariableElement> params = method.getParameters();
+                String sep = """";
+                for (VariableElement p : params) {
+                    w.append(sep).append(p.asType().toString()).append("" "").append(p.getSimpleName());
+                    sep = "", "";
+                }
+                w.append("");\n"");
             }
         }
 ",1
Fix for LossBinaryXENT," import org.nd4j.linalg.activations.impl.ActivationSoftmax;
 import org.nd4j.linalg.api.ndarray.INDArray;
 import org.nd4j.linalg.api.ops.impl.transforms.LogSoftMax;
-import org.nd4j.linalg.api.ops.impl.transforms.TimesOneMinus;
 import org.nd4j.linalg.factory.Nd4j;
 import org.nd4j.linalg.lossfunctions.ILossFunction;
 import org.nd4j.linalg.lossfunctions.LossUtil;
@@ -146,7 +145,7 @@
         INDArray output = activationFn.getActivation(preOutput.dup(), true);
 
         INDArray numerator = output.sub(labels);
-        INDArray denominator = Nd4j.getExecutioner().execAndReturn(new TimesOneMinus(output));  // output * (1-output)
+        INDArray denominator = output.mul(output.rsubi(1)); // output * (1-output)
         INDArray dLda = numerator.divi(denominator);
 
         if(mask != null && LossUtil.isPerOutputMasking(dLda, mask)) {",1
Fix node state returned by FailureDetector,"                 }
 
                 Exception lastFailureException = task.getStats().getLastFailureException();
-                if (lastFailureException instanceof ConnectException) {
+                if (lastFailureException instanceof SocketTimeoutException || lastFailureException instanceof UnknownHostException) {
                     return GONE;
                 }
 
-                if (lastFailureException instanceof SocketTimeoutException) {
-                    // TODO: distinguish between process unresponsiveness (e.g GC pause) and host reboot
+                if (lastFailureException instanceof ConnectException) {
                     return UNRESPONSIVE;
                 }
 ",1
Fixed JavaDoc for deprecated Computer.cliOnline(),"     }
 
     /**
-     * @deprecated Implementation of CLI command ""online-node"" moved to {@link hudson.cli.OnlineNodeCommand}.
+     * Deprecated - implementation of CLI command ""online-node"" moved to {@link hudson.cli.OnlineNodeCommand}.
      */
     @Deprecated
     public void cliOnline() throws ExecutionException, InterruptedException {",1
Fixing DefaultServlet Content-Range header counting,"  * otherwise the request is handled as a normal servlet request.
  * <p>
  * By default we only allow a restricted set of extensions.
- * </p>
+ * <p>
  * todo: this thing needs a lot more work. In particular:
  * - caching for blocking requests
  * - correct mime type
@@ -319,7 +319,7 @@
                                 range = null;
                             }
                             start = contentLength - end;
-                            end = contentLength - 1;
+                            end = contentLength;
                         } else if(end == -1) {
                             //prefix range
                             long toWrite = contentLength - start;
@@ -333,7 +333,7 @@
                                 //ignore the range request
                                 range = null;
                             }
-                            end = contentLength - 1;
+                            end = contentLength;
                         } else {
                             long toWrite = end - start + 1;
                             if(toWrite > Integer.MAX_VALUE) {
@@ -344,7 +344,7 @@
                         }
                         if(range != null) {
                             resp.setStatus(StatusCodes.PARTIAL_CONTENT);
-                            resp.setHeader(Headers.CONTENT_RANGE_STRING, ""bytes "" + start + ""-"" + end + ""/"" + contentLength);
+                            resp.setHeader(Headers.CONTENT_RANGE_STRING, ""bytes "" + range.getStart(0) + ""-"" + range.getEnd(0) + ""/"" + contentLength);
                         }
                     }
                 }",1
修复去库名bug," 			}
 		}
 		StringBuilder sb = new StringBuilder();
-		int firstE=upStmt.indexOf(""'"");
-		int endE=upStmt.lastIndexOf(""'"");
 		while (indx > 0) {
 			sb.append(stmt.substring(strtPos, indx));
 			strtPos = indx + upSchema.length();
 			if (flag) {
 				strtPos += 2;
 			}
-			if(indx>firstE&&indx<endE&&countChar(stmt,indx)%2==1)
-			{
-				sb.append(stmt.substring( indx,indx+schema.length()+1))  ;
-			}
 			indx = upStmt.indexOf(upSchema, strtPos);
 		}
 		sb.append(stmt.substring(strtPos));
 		return sb.toString();
 	}
-	private static int countChar(String sql,int end)
-	{
-		int count=0;
-		for (int i = 0; i < end; i++) {
-			if(sql.charAt(i)=='\'') {
-				count++;
-			}
-		}
-		return count;
-	}
+
 	/**
 	 * 获取第一个节点作为路由
 	 *",1
Crash fix for a case where the EndCallback is not set and used,"         if (mDataCallback != null && !mPaused && mBuffers.remaining() > 0)
             mDataCallback.onDataAvailable(this, mBuffers);
         
-        if (mEnded && mBuffers.remaining() == 0 && mEndCallback != null)
+        if (mEnded && mBuffers.remaining() == 0)
             mEndCallback.onCompleted(mEndException);
     }
     ",1
Fix unserialized access to subject on Marshmallow," import io.reactivex.Observable;
 import io.reactivex.functions.Action;
 import io.reactivex.subjects.PublishSubject;
-import io.reactivex.subjects.Subject;
 
 import static com.github.pwittchen.reactivenetwork.library.rx2.ReactiveNetwork.LOG_TAG;
 
@@ -49,13 +48,12 @@
 
   @SuppressWarnings(""NullAway"") // it has to be initialized in the Observable due to Context
   private ConnectivityManager.NetworkCallback networkCallback;
-  private final Subject<Connectivity> connectivitySubject;
-  private final BroadcastReceiver idleReceiver;
+  private PublishSubject<Connectivity> connectivitySubject = PublishSubject.create();
+  private BroadcastReceiver idleReceiver;
 
   @SuppressWarnings(""NullAway"") // networkCallback cannot be initialized here
   public MarshmallowNetworkObservingStrategy() {
     this.idleReceiver = createIdleBroadcastReceiver();
-    this.connectivitySubject = PublishSubject.<Connectivity>create().toSerialized();
   }
 
   @Override public Observable<Connectivity> observeNetworkConnectivity(final Context context) {",1
Don't use VM.maxDirectMemory() on IBM J9 / Eclipse OpenJ9 to retrieve…,"         try {
             systemClassLoader = getSystemClassLoader();
 
-            // When using IBM J9 / Eclipse OpenJ9 we should not use VM.maxDirectMemory() as it not reflects the
-            // correct value.
+            // On z/OS we should not use VM.maxDirectMemory() as it not reflects the correct value.
             // See:
             //  - https://github.com/netty/netty/issues/7654
-            String vmName = SystemPropertyUtil.get(""java.vm.name"", """").toLowerCase();
-            if (!vmName.startsWith(""ibm j9"") &&
-                    // https://github.com/eclipse/openj9/blob/openj9-0.8.0/runtime/include/vendor_version.h#L53
-                    !vmName.startsWith(""eclipse openj9"")) {
+            if (!SystemPropertyUtil.get(""os.name"", """").toLowerCase().contains(""z/os"")) {
                 // Try to get from sun.misc.VM.maxDirectMemory() which should be most accurate.
                 Class<?> vmClass = Class.forName(""sun.misc.VM"", true, systemClassLoader);
                 Method m = vmClass.getDeclaredMethod(""maxDirectMemory"");",1
Fix to allow parent category search facets to be used by children categories.," 
         // Add in parent facets unless they are excluded
         List<CategorySearchFacet> parentFacets = null;
-        if (getDefaultParentCategory() != null) {
-            parentFacets = getDefaultParentCategory().getCumulativeSearchFacets();   
+        if (defaultParentCategory != null) {
+            parentFacets = defaultParentCategory.getCumulativeSearchFacets();   
             CollectionUtils.filter(parentFacets, new Predicate() {
                 @Override
                 public boolean evaluate(Object arg) {
@@ -1257,8 +1257,8 @@
             CategoryXref clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
             cloned.getAllParentCategoryXrefs().add(clonedEntry);
         }
-        if (getDefaultParentCategory() != null) {
-            cloned.setDefaultParentCategory(getDefaultParentCategory().createOrRetrieveCopyInstance(context).getClone());
+        if (defaultParentCategory != null) {
+            cloned.setDefaultParentCategory(defaultParentCategory.createOrRetrieveCopyInstance(context).getClone());
         }
         for(CategoryXref entry : allChildCategoryXrefs){
             CategoryXref clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();",1
Fix occasional null pointer when accessing the context,"    */
   public static void announceForAccessibilityCompat(Context context, CharSequence text) {
     if (Build.VERSION.SDK_INT >= 4) {
-      AccessibilityManager accessibilityManager = null;
-      if (context != null) {
-        accessibilityManager = (AccessibilityManager) context.getSystemService(
+      AccessibilityManager accessibilityManager = (AccessibilityManager) context.getSystemService(
           Context.ACCESSIBILITY_SERVICE);
-      }
-      if (accessibilityManager == null || !accessibilityManager.isEnabled()) {
+      if (!accessibilityManager.isEnabled()) {
         return;
       }
 ",1
fix compile error,"         Calendar oldFirstVisibleDay = mFirstVisibleDay;
         mFirstVisibleDay = (Calendar) today.clone();
         mFirstVisibleDay.add(Calendar.DATE, -(Math.round(mCurrentOrigin.x / (mWidthPerDay + mColumnGap))));
-        if(!mFirstVisibleDay.equals(oldFirstVisibleDay) && mScrollListener != null){
-            mScrollListener.onFirstVisibleDayChanged(mFirstVisibleDay, oldFirstVisibleDay);
+        if(!mFirstVisibleDay.equals(oldFirstVisibleDay) && mScrolledListener != null){
+            mScrolledListener.onFirstVisibleDayChanged(mFirstVisibleDay, oldFirstVisibleDay);
         }
         for (int dayNumber = leftDaysWithGaps + 1;
              dayNumber <= leftDaysWithGaps + mNumberOfVisibleDays + 1;",1
Fixed NPE in ConsecutiveAppendsShouldReuseRule.getVariableAppended() ,"                 ASTPrimaryPrefix primaryPrefix = stmtExp.getFirstDescendantOfType(ASTPrimaryPrefix.class);
                 if (primaryPrefix != null) {
                     ASTName name = primaryPrefix.getFirstChildOfType(ASTName.class);
-                    if (name != null) {
                     String image = name.getImage();
                     if (image.endsWith("".append"")) {
                         String variable = image.substring(0, image.indexOf('.'));
@@ -97,7 +96,6 @@
                 }
             }
         }
-        }
         return null;
     }
     private boolean isAStringBuilderBuffer(ASTPrimaryPrefix prefix, String name) {",1
Fix Bugs 1106 and 1614,"         String[] produces = new String[0];
         final Set<Scheme> globalSchemes = EnumSet.noneOf(Scheme.class);
 
-        // only generate tag if not a child resource, @Api exists & @Api is not hidden; otherwise use parentTags
-        if (!readHidden && api != null && !api.hidden()) {
+        // only read if allowing hidden apis OR api is not marked as hidden
+        final boolean readable = (api != null && readHidden) || (api != null && !api.hidden());
+        if (readable) {
             // the value will be used as a tag for 2.0 UNLESS a Tags annotation is present
             Set<String> tagStrings = extractTags(api);
             for (String tagString : tagStrings) {
                 Tag tag = new Tag().name(tagString);
                 tags.put(tagString, tag);
             }
+            if (parentTags != null) {
+                tags.putAll(parentTags);
+            }
             for (String tagName : tags.keySet()) {
                 swagger.tag(tags.get(tagName));
             }
@@ -228,13 +232,10 @@
                     securities.add(security);
                 }
             }
-        } else if (parentTags != null) {
-            tags.putAll(parentTags);
         }
 
-        // allow reading the JAX-RS APIs without @Api annotation if scanAllResources is enabled or
-        // readHidden is set by parent resource.
-        if (readHidden || (api != null && !api.hidden()) || (api == null && config.isScanAllResources())) {
+        // allow reading the JAX-RS APIs without @Api annotation
+        if (readable || (api == null && config.isScanAllResources())) {
             // merge consumes, produces
 
             // look for method-level annotated properties
@@ -552,12 +553,14 @@
             return type;
         }
 
+        if (config.isScanAllResources()) {
             // For sub-resources that are not annotated with  @Api, look for any HttpMethods.
             for (Method m : type.getMethods()) {
                 if (extractOperationMethod(null, m, null) != null) {
                     return type;
                 }
             }
+        }
 
         return null;
     }",1
Fix ColorChooser cursor,"   
   public void show() {
     window.setVisible(true);
+    window.setCursor(Cursor.getPredefinedCursor(Cursor.CROSSHAIR_CURSOR));
   }
   
   
@@ -489,8 +490,6 @@
     private int lastX, lastY;
 
     public ColorRange() {
-      setCursor(Cursor.getPredefinedCursor(Cursor.CROSSHAIR_CURSOR));
-
       addMouseListener(new MouseAdapter() {
         @Override
         public void mousePressed(MouseEvent e) {
@@ -571,8 +570,6 @@
     static final int HIGH = 256;
 
     public ColorSlider() {
-      setCursor(Cursor.getPredefinedCursor(Cursor.CROSSHAIR_CURSOR));
-
       addMouseListener(new MouseAdapter() {
         @Override
         public void mousePressed(MouseEvent e) {",1
fix withNewChildren to also copy the errors," import java.util.Collections;
 import java.util.List;
 
-import static graphql.Assert.assertShouldNeverHappen;
-
 public class RootExecutionResultNode extends ObjectExecutionResultNode {
 
     private final List<GraphQLError> errors;
@@ -25,20 +23,14 @@
 
     @Override
     public FetchedValueAnalysis getFetchedValueAnalysis() {
-        return assertShouldNeverHappen(""not supported at root node"");
+        throw new RuntimeException(""Root node"");
     }
 
     @Override
-    public RootExecutionResultNode withNewChildren(List<ExecutionResultNode> children) {
-        return new RootExecutionResultNode(children, errors);
+    public ObjectExecutionResultNode withNewChildren(List<ExecutionResultNode> children) {
+        return new RootExecutionResultNode(children);
     }
 
-    @Override
-    public RootExecutionResultNode withNewFetchedValueAnalysis(FetchedValueAnalysis fetchedValueAnalysis) {
-        return assertShouldNeverHappen(""not supported at root node"");
-    }
-
-
     public List<GraphQLError> getErrors() {
         return new ArrayList<>(errors);
     }",1
 Assertion filter is initialized.," 
     public final void init() {
         onInit();
+        isInitialized = true;
         onInitialized();
     }
 
@@ -166,8 +167,6 @@
     }
 
     protected void setInteger(final int location, final int intValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -177,8 +176,6 @@
     }
 
     protected void setFloat(final int location, final float floatValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -188,8 +185,6 @@
     }
 
     protected void setFloatVec2(final int location, final float[] arrayValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -199,8 +194,6 @@
     }
 
     protected void setFloatVec3(final int location, final float[] arrayValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -210,8 +203,6 @@
     }
 
     protected void setFloatVec4(final int location, final float[] arrayValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -221,8 +212,6 @@
     }
 
     protected void setFloatArray(final int location, final float[] arrayValue) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
             @Override
             public void run() {
@@ -232,8 +221,6 @@
     }
 
     protected void setPoint(final int location, final PointF point) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
 
             @Override
@@ -247,8 +234,6 @@
     }
 
     protected void setUniformMatrix3f(final int location, final float[] matrix) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
 
             @Override
@@ -259,8 +244,6 @@
     }
 
     protected void setUniformMatrix4f(final int location, final float[] matrix) {
-        checkIsInitialized();
-        
         runOnDraw(new Runnable() {
 
             @Override
@@ -295,10 +278,4 @@
         java.util.Scanner s = new java.util.Scanner(is).useDelimiter(""\\A"");
         return s.hasNext() ? s.next() : """";
     }
-    
-    private void checkIsInitialized() {
-        if (!isInitialized) {
-            throw new AssertionError(""Filter should be initialized"");
-        }
-    }
 }",1
Fix #1214 DelayUntil request Integer.MAX_VALUE onSubscribe," 		@Override
 		public void onSubscribe(Subscription s) {
 			if (Operators.setOnce(S, this, s)) {
-				s.request(Long.MAX_VALUE);
+				s.request(Integer.MAX_VALUE);
 			} else {
 				s.cancel();
 			}",1
Fixed ArrayIndexOutOfBoundsException in getOreName,"      */
     public static String getOreName(int id)
     {
-        return (id >= 0 && id < idToName.size()) ? idToName.get(id) : ""Unknown"";
+        return id < idToName.size() ? idToName.get(id) : ""Unknown"";
     }
 
     /**",1
GWT Reflection: Fixed getSuperClass to return null for Object.class," 	/** @return the super class of this type or null */
 	public Type getSuperclass () {
 		try {
-			return superClass == null ? null : ReflectionCache.forName(superClass.getName());
+			return ReflectionCache.forName(superClass.getName());
 		} catch (ClassNotFoundException e) {
 			return null;
 		}",1
"extended serializable interface on amount item interface, this fixes an ...","  */
 package org.broadleafcommerce.core.payment.domain;
 
-import java.io.Serializable;
 import java.math.BigDecimal;
 
 /**
@@ -26,7 +25,7 @@
  * @author jfischer
  *
  */
-public interface AmountItem extends Serializable {
+public interface AmountItem {
 
     public abstract Long getId();
 ",1
Minor fix to javadoc,,1
#1408 Reference Spring Instrument as a potential startup exception fix,"                             + ""\ncontainer which can trigger early class loading. If the problem persists, ensure that""
                             + ""\nthere are no bean references to your entity class anywhere else in your Spring applicationContext""
                             + ""\nand consult the documentation for your servlet container to determine if classes are loaded""
-                            + ""\nprior to the Spring context initialization. Also, it is a necessity that ""
-                            + ""\n'-javaagent:/path/to/spring-instrument-4.1.5.jar' be added to the JVM args of the server.""
-                            + ""\nFinally, ensure that Session Persistence is also disabled by your Servlet Container."" 
-                            + ""\nTo do this in Tomcat, add <Manager pathname=\""\"" /> inside of the <Context> element""
-                            + ""\nin context.xml in your app's META-INF folder or your server's conf folder."";
+                            + ""\nprior to the Spring context initialization. Finally, ensure that Session Persistence is""
+                            + ""\nalso disabled by your Servlet Container. To do this in Tomcat, add <Manager pathname=\""\"" />""
+                            + ""\ninside of the <Context> element in context.xml in your app's META-INF folder or your server's conf folder"";
                     LOG.error(message);
                     throw new IllegalStateException(message);
                 }",1
fix : issue #454,"     @Override
     public void onUpdateEmptyView(int size) {
         Log.d(""onUpdateEmptyView size=%s"", size);
-        if (mAdapter != null) {
         FastScroller fastScroller = mAdapter.getFastScroller();
         View emptyView = findViewById(R.id.empty_view);
         TextView emptyText = findViewById(R.id.empty_text);
@@ -829,7 +828,6 @@
             Snackbar.make(findViewById(R.id.main_view), message, Snackbar.LENGTH_SHORT).show();
         }
     }
-    }
 
     @Override
     public void onActionCanceled(@UndoHelper.Action int action) {",1
1.x: fix RxRingBuffer-pool depending on the computation scheduler," import java.util.concurrent.*;
 import java.util.concurrent.atomic.AtomicReference;
 
-import rx.internal.schedulers.*;
+import rx.Scheduler.Worker;
+import rx.functions.Action0;
+import rx.internal.schedulers.SchedulerLifecycle;
 import rx.internal.util.unsafe.*;
+import rx.schedulers.Schedulers;
 
 public abstract class ObjectPool<T> implements SchedulerLifecycle {
     Queue<T> pool;
@@ -30,7 +33,7 @@
     final int maxSize;
     private final long validationInterval;
 
-    private final AtomicReference<Future<?>> periodicTask;
+    private final AtomicReference<Worker> schedulerWorker;
 
     public ObjectPool() {
         this(0, 0, 67);
@@ -52,7 +55,7 @@
         this.minSize = min;
         this.maxSize = max;
         this.validationInterval = validationInterval;
-        this.periodicTask = new AtomicReference<Future<?>>();
+        this.schedulerWorker = new AtomicReference<Worker>();
         // initialize pool
         initialize(min);
 
@@ -93,26 +96,20 @@
      */
     @Override
     public void shutdown() {
-        Future<?> f = periodicTask.getAndSet(null);
-        if (f != null) {
-            f.cancel(false);
+        Worker w = schedulerWorker.getAndSet(null);
+        if (w != null) {
+            w.unsubscribe();
         }
     }
 
     @Override
     public void start() {
-        for (;;) {
-            if (periodicTask.get() != null) {
-                return;
-            }
-            ScheduledExecutorService w = GenericScheduledExecutorService.getInstance();
-            
-            Future<?> f;
-            try {
-                f = w.scheduleAtFixedRate(new Runnable() {
+        Worker w = Schedulers.computation().createWorker();
+        if (schedulerWorker.compareAndSet(null, w)) {
+            w.schedulePeriodically(new Action0() {
     
                 @Override
-                    public void run() {
+                public void call() {
                     int size = pool.size();
                     if (size < minSize) {
                         int sizeToBeAdded = maxSize - size;
@@ -129,15 +126,8 @@
                 }
     
             }, validationInterval, validationInterval, TimeUnit.SECONDS);
-            } catch (RejectedExecutionException ex) {
-                RxJavaPluginUtils.handleException(ex);
-                break;
-            }
-            if (!periodicTask.compareAndSet(null, f)) {
-                f.cancel(false);
         } else {
-                break;
-            }
+            w.unsubscribe();
         }
     }
     ",1
N7 notifications fix,"     if (mSortedDevices.size() == 0) {
       // Remove all existing notifications
       mNotificationManager.cancelAll();
-    } else if (mSortedDevices.size() == 1) {
-      updateNearbyBeaconNotification(true, mDeviceAddressToUrl.get(mSortedDevices.get(0)),
-          NEAREST_BEACON_NOTIFICATION_ID);
-    } else {
+      return;
+    }
+
+    // If at least two beacons have been found
+    if (mSortedDevices.size() > 1) {
       // Create a summary notification for both beacon notifications.
       // Do this first so that we don't first show the individual notifications
       updateSummaryNotification();
-      // Create or update a notification for second beacon
-      updateNearbyBeaconNotification(false, mDeviceAddressToUrl.get(mSortedDevices.get(1)),
+      // Create or update a notification for this beacon
+      updateNearbyBeaconNotification(mDeviceAddressToUrl.get(mSortedDevices.get(1)),
           SECOND_NEAREST_BEACON_NOTIFICATION_ID);
-      // Create or update a notification for first beacon. Needs to be added last to show up top
-      updateNearbyBeaconNotification(false, mDeviceAddressToUrl.get(mSortedDevices.get(0)),
+    }
+
+    // If at least one beacon has been found
+    if (mSortedDevices.size() > 0) {
+      // Create or update a notification for this beacon
+      updateNearbyBeaconNotification(mDeviceAddressToUrl.get(mSortedDevices.get(0)),
           NEAREST_BEACON_NOTIFICATION_ID);
-
     }
   }
 
@@ -384,7 +388,7 @@
    * Create or update a notification with the given id
    * for the beacon with the given address
    */
-  private void updateNearbyBeaconNotification(boolean single, String url, int notificationId) {
+  private void updateNearbyBeaconNotification(String url, int notificationId) {
     MetadataResolver.UrlMetadata urlMetadata = mUrlToUrlMetadata.get(url);
     if (urlMetadata == null) {
       return;
@@ -403,12 +407,8 @@
         .setContentTitle(title)
         .setContentText(description)
         .setPriority(NOTIFICATION_PRIORITY)
+        .setGroup(NOTIFICATION_GROUP_KEY)
         .setContentIntent(pendingIntent);
-    // For some reason if there is only one notification and you call setGroup
-    // the notification doesn't show up on the N7 running kit kat
-    if (!single) {
-      builder = builder.setGroup(NOTIFICATION_GROUP_KEY);
-    }
     Notification notification = builder.build();
 
     mNotificationManager.notify(notificationId, notification);",1
Fix missing schema error message for SHOW TABLES,"             QualifiedSchemaName schema = createQualifiedSchemaName(session, showTables, showTables.getSchema());
 
             if (!metadata.schemaExists(session, schema)) {
-                throw new SemanticException(MISSING_SCHEMA, showTables, ""Schema '%s' does not exist"", schema.getSchemaName());
+                throw new SemanticException(MISSING_SCHEMA, showTables, ""Schema '%s' does not exist"", schema);
             }
 
             Expression predicate = equal(nameReference(""table_schema""), new StringLiteral(schema.getSchemaName()));",1
Fix typo,"     /**
      * Bind the BottomBar to your Activity, and inflate your layout here.
      * <p/>
-     * Remember to also call {@link #onSaveInstanceState(Bundle)} inside
+     * Remember to also call {@link #onRestoreInstanceState(Bundle)} inside
      * of your {@link Activity#onSaveInstanceState(Bundle)} to restore the state.
      *
      * @param activity           an Activity to attach to.",1
Fix serverside startup failure when checking for vanilla acceptance," 
 package net.minecraftforge.fml.common.versioning;
 
-import net.minecraft.util.text.translation.I18n;
+import net.minecraft.client.resources.I18n;
 
 import javax.annotation.Nullable;
 
@@ -208,7 +208,7 @@
     {
         if ( getLowerBound() == null && getUpperBound() == null )
         {
-            return I18n.translateToLocal(""fml.messages.version.restriction.any"");
+            return I18n.format(""fml.messages.version.restriction.any"");
         }
         else if ( getLowerBound() != null && getUpperBound() != null )
         {
@@ -220,19 +220,19 @@
             {
                 if (isLowerBoundInclusive() && isUpperBoundInclusive()) 
                 {
-                    return I18n.translateToLocalFormatted(""fml.messages.version.restriction.bounded.inclusive"", getLowerBound(), getUpperBound());
+                    return I18n.format(""fml.messages.version.restriction.bounded.inclusive"", getLowerBound(), getUpperBound());
                 } 
                 else if (isLowerBoundInclusive()) 
                 {
-                    return I18n.translateToLocalFormatted(""fml.messages.version.restriction.bounded.upperexclusive"", getLowerBound(), getUpperBound());
+                    return I18n.format(""fml.messages.version.restriction.bounded.upperexclusive"", getLowerBound(), getUpperBound());
                 } 
                 else if (isUpperBoundInclusive()) 
                 {
-                    return I18n.translateToLocalFormatted(""fml.messages.version.restriction.bounded.lowerexclusive"", getLowerBound(), getUpperBound());
+                    return I18n.format(""fml.messages.version.restriction.bounded.lowerexclusive"", getLowerBound(), getUpperBound());
                 } 
                 else 
                 {
-                    return I18n.translateToLocalFormatted(""fml.messages.version.restriction.bounded.exclusive"", getLowerBound(), getUpperBound());
+                    return I18n.format(""fml.messages.version.restriction.bounded.exclusive"", getLowerBound(), getUpperBound());
                 }
             }
         }
@@ -240,22 +240,22 @@
         {
             if ( isLowerBoundInclusive() )
             {
-                return I18n.translateToLocalFormatted(""fml.messages.version.restriction.lower.inclusive"", getLowerBound());
+                return I18n.format(""fml.messages.version.restriction.lower.inclusive"", getLowerBound());
             }
             else
             {
-                return I18n.translateToLocalFormatted(""fml.messages.version.restriction.lower.exclusive"", getLowerBound());
+                return I18n.format(""fml.messages.version.restriction.lower.exclusive"", getLowerBound());
             }
         }
         else
         {
             if ( isUpperBoundInclusive() )
             {
-                return I18n.translateToLocalFormatted(""fml.messages.version.restriction.upper.inclusive"", getUpperBound());
+                return I18n.format(""fml.messages.version.restriction.upper.inclusive"", getUpperBound());
             }
             else
             {
-                return I18n.translateToLocalFormatted(""fml.messages.version.restriction.upper.exclusive"", getUpperBound());
+                return I18n.format(""fml.messages.version.restriction.upper.exclusive"", getUpperBound());
             }
         }
     }",1
Optionally autowire the EmailServiceProducer into the EmailService,"  */
 package org.broadleafcommerce.common.email.service;
 
+import java.util.HashMap;
+import java.util.Map;
+
+import javax.annotation.Resource;
+
 import org.broadleafcommerce.common.email.dao.EmailReportingDao;
 import org.broadleafcommerce.common.email.domain.EmailTarget;
 import org.broadleafcommerce.common.email.service.exception.EmailException;
@@ -26,14 +31,8 @@
 import org.broadleafcommerce.common.email.service.message.EmailPropertyType;
 import org.broadleafcommerce.common.email.service.message.EmailServiceProducer;
 import org.broadleafcommerce.common.email.service.message.MessageCreator;
-import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.stereotype.Service;
 
-import java.util.HashMap;
-import java.util.Map;
-
-import javax.annotation.Resource;
-
 /**
  * @author jfischer
  */
@@ -46,7 +45,6 @@
     @Resource(name = ""blServerInfo"")
     protected ServerInfo serverInfo;
 
-    @Autowired(required = false)
     protected EmailServiceProducer emailServiceProducer;
 
     @Resource(name = ""blMessageCreator"")
@@ -55,7 +53,6 @@
     @Resource(name = ""blEmailReportingDao"")
     protected EmailReportingDao emailReportingDao;
 
-    @Override
     public boolean sendTemplateEmail(EmailTarget emailTarget, EmailInfo emailInfo, Map<String, Object> props) {
         if (props == null) {
             props = new HashMap<String, Object>();
@@ -72,7 +69,6 @@
         return sendBasicEmail(emailInfo, emailTarget, props);
     }
 
-    @Override
     public boolean sendTemplateEmail(String emailAddress, EmailInfo emailInfo, Map<String, Object> props) {
         if (!(emailInfo instanceof NullEmailInfo)) {
             EmailTarget emailTarget = emailReportingDao.createTarget();
@@ -83,7 +79,6 @@
         }
     }
 
-    @Override
     public boolean sendBasicEmail(EmailInfo emailInfo, EmailTarget emailTarget, Map<String, Object> props) {
         if (props == null) {
             props = new HashMap<String, Object>();",1
Fixing random crash by ignoring this case. ," 			Set<AnnotatedAndRootElements> ancestorAnnotatedElements = validatedModel.getAncestorAnnotatedElements(target.getName());
 			for (AnnotatedAndRootElements elements : ancestorAnnotatedElements) {
 				EBeanHolder holder = eBeansHolder.getEBeanHolder(elements.rootTypeElement);
-				/*
-				 * Annotations coming from ancestors may be applied to root
-				 * elements that are not validated, and therefore not available.
-				 */
-				if (holder != null) {
 				processor.process(elements.annotatedElement, codeModel, holder);
 			}
 		}
-		}
 
 		return codeModel;
 	}",1
Fix for exception being thrown on programmatic verticle deployment without a done handler,"     AsyncResultHandler<String> handler = new AsyncResultHandler<String>() {
       public void handle(AsyncResult<String> res) {
         if (res.succeeded()) {
-          if (doneHandler != null) {
           doneHandler.handle(res.result);
-          }
         } else {
           res.exception.printStackTrace();
         }",1
Fix Yarn version comparison,"                 final String version =
                     new YarnExecutor(executorConfig, Arrays.asList(""--version""), null).executeAndGetResult();
 
-                if (version.equals(yarnVersion.replaceFirst(""^v"", """"))) {
+                if (version.equals(yarnVersion)) {
                     logger.info(""Yarn {} is already installed."", version);
                     return true;
                 } else {",1
Fixed NPE in DisconnectionRouter," package com.polidea.rxandroidble2.internal.connection;
 
 
-import com.jakewharton.rxrelay2.BehaviorRelay;
 import com.polidea.rxandroidble2.RxBleAdapterStateObservable;
 import com.polidea.rxandroidble2.exceptions.BleDisconnectedException;
 import com.polidea.rxandroidble2.exceptions.BleException;
@@ -10,12 +9,16 @@
 import com.polidea.rxandroidble2.internal.RxBleLog;
 import com.polidea.rxandroidble2.internal.util.RxBleAdapterWrapper;
 
+import java.util.concurrent.ConcurrentLinkedQueue;
+import java.util.Queue;
+
 import bleshadow.javax.inject.Inject;
 import bleshadow.javax.inject.Named;
 import io.reactivex.Observable;
-import io.reactivex.ObservableSource;
+import io.reactivex.ObservableEmitter;
+import io.reactivex.ObservableOnSubscribe;
 import io.reactivex.disposables.Disposable;
-import io.reactivex.functions.Action;
+import io.reactivex.functions.Cancellable;
 import io.reactivex.functions.Consumer;
 import io.reactivex.functions.Function;
 import io.reactivex.functions.Predicate;
@@ -26,9 +29,9 @@
 @ConnectionScope
 class DisconnectionRouter implements DisconnectionRouterInput, DisconnectionRouterOutput {
 
-    private final BehaviorRelay<BleException> bleExceptionBehaviorRelay = BehaviorRelay.create();
-    private final Observable<BleException> firstDisconnectionValueObs;
-    private final Observable<Object> firstDisconnectionExceptionObs;
+    private final Queue<ObservableEmitter<BleException>> exceptionEmitters = new ConcurrentLinkedQueue<>();
+    private BleException exceptionOccurred;
+    private Disposable adapterMonitoringDisposable;
 
     @Inject
     DisconnectionRouter(
@@ -46,45 +49,27 @@
          One of those events must happen eventually. Then the adapterStateObservable (which uses BroadcastReceiver on a Context) will
          get unsubscribed. The rest of this chain lives only in the @ConnectionScope context and will get Garbage Collected eventually.
          */
-        final Disposable adapterMonitoringDisposable = awaitAdapterNotUsable(adapterWrapper, adapterStateObservable)
+        adapterMonitoringDisposable = awaitAdapterNotUsable(adapterWrapper, adapterStateObservable)
                 .map(new Function<Boolean, BleException>() {
                     @Override
                     public BleException apply(Boolean isAdapterUsable) {
                         return BleDisconnectedException.adapterDisabled(macAddress);
                     }
                 })
-                .doOnNext(new Consumer<BleException>() {
+                .firstElement()
+                .subscribe(new Consumer<BleException>() {
                     @Override
-                    public void accept(BleException e) {
+                    public void accept(BleException exception) {
                         RxBleLog.d(""An exception received, indicating that the adapter has became unusable."");
+                        exceptionOccurred = exception;
+                        notifySubscribersAboutException();
                     }
-                })
-                .subscribe(bleExceptionBehaviorRelay, new Consumer<Throwable>() {
+                }, new Consumer<Throwable>() {
                     @Override
                     public void accept(Throwable throwable) {
                         RxBleLog.w(throwable, ""Failed to monitor adapter state."");
                     }
                 });
-
-        firstDisconnectionValueObs = bleExceptionBehaviorRelay
-                .firstElement()
-                .toObservable()
-                .doOnTerminate(new Action() {
-                    @Override
-                    public void run() {
-                        adapterMonitoringDisposable.dispose();
-                    }
-                })
-                .replay()
-                .autoConnect(0);
-
-        firstDisconnectionExceptionObs = firstDisconnectionValueObs
-                .flatMap(new Function<BleException, ObservableSource<?>>() {
-                    @Override
-                    public ObservableSource<?> apply(BleException e) {
-                        return Observable.error(e);
-                    }
-                });
     }
 
     private static Observable<Boolean> awaitAdapterNotUsable(RxBleAdapterWrapper adapterWrapper,
@@ -105,24 +90,82 @@
                 });
     }
 
+    /**
+     * @inheritDoc
+     */
     @Override
     public void onDisconnectedException(BleDisconnectedException disconnectedException) {
-        bleExceptionBehaviorRelay.accept(disconnectedException);
+        onExceptionOccurred(disconnectedException);
     }
 
+    /**
+     * @inheritDoc
+     */
     @Override
     public void onGattConnectionStateException(BleGattException disconnectedGattException) {
-        bleExceptionBehaviorRelay.accept(disconnectedGattException);
+        onExceptionOccurred(disconnectedGattException);
     }
 
+    private synchronized void onExceptionOccurred(BleException exception) {
+        if (exceptionOccurred == null) {
+            exceptionOccurred = exception;
+            notifySubscribersAboutException();
+        }
+    }
+
+    private void notifySubscribersAboutException() {
+        if (adapterMonitoringDisposable != null) {
+            adapterMonitoringDisposable.dispose();
+        }
+
+        while (!exceptionEmitters.isEmpty()) {
+            final ObservableEmitter<BleException> exceptionEmitter = exceptionEmitters.poll();
+            exceptionEmitter.onNext(exceptionOccurred);
+            exceptionEmitter.onComplete();
+        }
+    }
+
+    /**
+     * @inheritDoc
+     */
     @Override
     public Observable<BleException> asValueOnlyObservable() {
-        return firstDisconnectionValueObs;
+        return Observable.create(new ObservableOnSubscribe<BleException>() {
+            @Override
+            public void subscribe(final ObservableEmitter<BleException> emitter) {
+                synchronized (DisconnectionRouter.this) {
+                    if (exceptionOccurred != null) {
+                        emitter.onNext(exceptionOccurred);
+                        emitter.onComplete();
+                    } else {
+                        storeEmitterToBeNotifiedInTheFuture(emitter);
+                    }
+                }
+            }
+        });
     }
 
+    private void storeEmitterToBeNotifiedInTheFuture(final ObservableEmitter<BleException> emitter) {
+        exceptionEmitters.add(emitter);
+        emitter.setCancellable(new Cancellable() {
+            @Override
+            public void cancel() {
+                exceptionEmitters.remove(emitter);
+            }
+        });
+    }
+
+    /**
+     * @inheritDoc
+     */
     @Override
     public <T> Observable<T> asErrorOnlyObservable() {
-        // [DS 11.03.2019] Not an elegant solution but it should decrease amount of allocations. Should not emit values so —> safe to cast.
-        return (Observable<T>) firstDisconnectionExceptionObs;
+        return asValueOnlyObservable()
+                .flatMap(new Function<BleException, Observable<T>>() {
+                    @Override
+                    public Observable<T> apply(BleException e) {
+                        return Observable.error(e);
+                    }
+                });
     }
 }",1
fixed comment,"    /**
     * Construct a HikariConfig from the specified property file name.  <code>propertyFileName</code>
     * will first be treated as a path in the file-system, and if that fails the 
-    * Class.getResourceAsStream(propertyFileName) will be tried.
+    * ClassLoader.getResourceAsStream(propertyFileName) will be tried.
     *
     * @param propertyFileName the name of the property file
     */",1
Fix javadoc for bodyEndHandler,"   HttpServerResponse headersEndHandler(@Nullable Handler<Void> handler);
 
   /**
-   * Provides a handler that will be called after the last part of the body is written to the wire.
-   * The handler is called asynchronously of when the response has been received by the client.
-   * This provides a hook allowing you to do more operations once the request has been sent over the wire
-   * such as resource cleanup.
+   * Provide a handler that will be called just before the last part of the body is written to the wire
+   * and the response is ended.<p>
+   * This provides a hook allowing you to do any more operations before this occurs.
    *
    * @param handler  the handler
    * @return a reference to this, so the API can be used fluently",1
Fix issue creation for non-collaborators," 
 import java.util.List;
 
-import retrofit.RetrofitError;
 import rx.android.schedulers.AndroidSchedulers;
 import rx.schedulers.Schedulers;
 
@@ -390,15 +389,6 @@
                         if (isCollaborator)
                             showCollaboratorOptions();
                     }
-
-                    @Override
-                    public void onError(Throwable e) {
-                        if(e instanceof RetrofitError && ((RetrofitError) e).getResponse().getStatus() == 403){
-                            //403 -> Forbidden
-                            //The user is not a collaborator.
-                            showMainContent();
-                        }
-                    }
                 });
     }
 }",1
Fix gradle builds with JitPack,"     /**
      * Checks that we have appropriate permissions for this session type.
      * Throws if session = audio and manifest did not add the microphone permissions.
-     * @param sessionType
-     * @param audio
      * @return true if we can go on, false otherwise.
      */
     @SuppressLint(""NewApi"")
@@ -1276,7 +1274,7 @@
     /**
      * Controls whether CameraView should play sound effects on certain
      * events (picture taken, focus complete). Note that:
-     * - On API level {@literal <} 16, this flag is always false
+     * - On API level < 16, this flag is always false
      * - Camera1 will always play the shutter sound when taking pictures
      *
      * @param playSounds whether to play sound effects",1
[SP-4947] - Fixed missing error message in Abort step,"  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2019 by Hitachi Vantara : http://www.pentaho.com
+ * Copyright (C) 2002-2017 by Pentaho : http://www.pentaho.com
  *
  *******************************************************************************
  *
@@ -83,11 +83,8 @@
         //
         // Here we abort!!
         //
-        String rowData = getInputRowMeta().getString( r );
-        rowData = rowData.equals( """" ) ? ""No data in row"" : rowData;
-
         logError( BaseMessages.getString(
-          PKG, ""Abort.Log.Wrote.AbortRow"", Long.toString( nrInputRows ), rowData ) );
+          PKG, ""Abort.Log.Wrote.AbortRow"", Long.toString( nrInputRows ), getInputRowMeta().getString( r ) ) );
 
         String message = environmentSubstitute( meta.getMessage() );
         if ( message == null || message.length() == 0 ) {",1
Provide Hazelcast with orient-distributed bundle classloader.,"   }
 
   protected HazelcastInstance configureHazelcast() throws FileNotFoundException {
-    FileSystemXmlConfig config = new FileSystemXmlConfig(hazelcastConfigFile);
-    config.setClassLoader(this.getClass().getClassLoader());
-    return Hazelcast.newHazelcastInstance(config);
+    return Hazelcast.newHazelcastInstance(new FileSystemXmlConfig(hazelcastConfigFile));
   }
 
   /**",1
fix for knime,"     private final Map<Integer, ReferenceQueue<BaseDataBuffer>> queueMap = new ConcurrentHashMap<>();
 
     private ConstantHandler constantHandler = Nd4j.getConstantHandler();
-    private AtomicLong useTracker = new AtomicLong(System.currentTimeMillis());
 
     public static AtomicAllocator getInstance() {
         if (INSTANCE == null)
@@ -356,8 +355,6 @@
     public AllocationPoint allocateMemory(DataBuffer buffer,AllocationShape requiredMemory, AllocationStatus location, boolean initialize) {
         AllocationPoint point = new AllocationPoint();
 
-        useTracker.set(System.currentTimeMillis());
-
         // we use these longs as tracking codes for memory tracking
         Long allocId = objectsTracker.getAndIncrement();
         //point.attachBuffer(buffer);
@@ -577,7 +574,6 @@
         private final ReferenceQueue<BaseDataBuffer> queue;
         private int threadId;
         private int deviceId;
-        private AtomicLong stopper = new AtomicLong(System.currentTimeMillis());
 
         public UnifiedGarbageCollectorThread(Integer threadId, @NonNull ReferenceQueue<BaseDataBuffer> queue) {
             this.queue = queue;
@@ -593,9 +589,6 @@
                 if (reference != null) {
                     AllocationPoint point = reference.getPoint();
 
-                    if (threadId == 0)
-                        stopper.set(System.currentTimeMillis());
-
                     if (point.getAllocationStatus() == AllocationStatus.HOST) {
                         purgeZeroObject(point.getBucketId(), point.getObjectId(), point, false);
                     } else if (point.getAllocationStatus() == AllocationStatus.DEVICE) {
@@ -608,8 +601,6 @@
                 } else {
                     try {
                         if (threadId == 0) {
-                            // we don't call for System.gc if last memory allocation was more then 3 seconds ago
-                            if (useTracker.get() > System.currentTimeMillis() - 3000)
                             System.gc();
                             Thread.sleep(100);
                         } else Thread.sleep(50);",1
Fixes rss url; otherwise it gets 302 status code and shows a blank list.," 
 public class APODRssFetcher {
   private static final String TAG = ""APODRssFetcher"";
-  
-  private static final String APOD_RSS_URL = ""https://apod.nasa.gov/apod.rss"";
+  private static final String APOD_RSS_URL = ""http://apod.nasa.gov/apod.rss"";
 
   private final ContentResolver mContentResolver;
 ",1
Fix images total display error," import android.support.v4.util.ArrayMap;
 import android.text.TextUtils;
 
-import com.bilibili.boxing.model.BoxingManager;
 import com.bilibili.boxing.model.callback.IAlbumTaskCallback;
-import com.bilibili.boxing.model.config.BoxingConfig;
 import com.bilibili.boxing.model.entity.AlbumEntity;
 import com.bilibili.boxing.model.entity.impl.ImageMedia;
 import com.bilibili.boxing.utils.BoxingExecutor;
@@ -44,27 +42,37 @@
 public class AlbumTask {
     private static final String UNKNOWN_ALBUM_NAME = ""unknow"";
     private static final String SELECTION_IMAGE_MIME_TYPE = Media.MIME_TYPE + ""=? or "" + Media.MIME_TYPE + ""=? or "" + Media.MIME_TYPE + ""=? or "" + Media.MIME_TYPE + ""=?"";
-    private static final String SELECTION_IMAGE_MIME_TYPE_WITHOUT_GIF = Media.MIME_TYPE + ""=? or "" + Media.MIME_TYPE + ""=? or "" + Media.MIME_TYPE + ""=?"";
     private static final String SELECTION_ID = Media.BUCKET_ID + ""=? and ("" + SELECTION_IMAGE_MIME_TYPE + "" )"";
-    private static final String SELECTION_ID_WITHOUT_GIF = Media.BUCKET_ID + ""=? and ("" + SELECTION_IMAGE_MIME_TYPE_WITHOUT_GIF + "" )"";
-    private static final String[] SELECTION_ARGS_IMAGE_MIME_TYPE = {""image/jpeg"", ""image/png"", ""image/jpg"", ""image/gif""};
-    private static final String[] SELECTION_ARGS_IMAGE_MIME_TYPE_WITHOUT_GIF = {""image/jpeg"", ""image/png"", ""image/jpg""};
     private int mUnknownAlbumNumber = 1;
     private Map<String, AlbumEntity> mBucketMap;
     private AlbumEntity mDefaultAlbum;
-    private BoxingConfig mPickerConfig;
 
     public AlbumTask() {
         this.mBucketMap = new ArrayMap<>();
         this.mDefaultAlbum = AlbumEntity.createDefaultAlbum();
-        this.mPickerConfig = BoxingManager.getInstance().getBoxingConfig();
     }
 
     public void start(@NonNull final ContentResolver cr, @NonNull final IAlbumTaskCallback callback) {
+        buildDefaultAlbum(cr);
         buildAlbumInfo(cr);
         getAlbumList(callback);
     }
 
+    private void buildDefaultAlbum(ContentResolver cr) {
+        Cursor cursor = null;
+        try {
+            cursor = cr.query(Media.EXTERNAL_CONTENT_URI, new String[]{Media.BUCKET_ID}, null,
+                    null, null);
+            if (cursor != null) {
+                mDefaultAlbum.mCount = cursor.getCount();
+            }
+        } finally {
+            if (cursor != null) {
+                cursor.close();
+            }
+        }
+    }
+
     private void buildAlbumInfo(ContentResolver cr) {
         String[] distinctBucketColumns = new String[]{Media.BUCKET_ID, Media.BUCKET_DISPLAY_NAME};
         Cursor bucketCursor = null;
@@ -95,16 +103,8 @@
      */
     private void buildAlbumCover(ContentResolver cr, String buckId, AlbumEntity album) {
         String[] photoColumn = new String[]{Media._ID, Media.DATA};
-        boolean isNeedGif = mPickerConfig != null && mPickerConfig.isNeedGif();
-        String selectionId = isNeedGif ? SELECTION_ID : SELECTION_ID_WITHOUT_GIF;
-        String[] args = isNeedGif ? SELECTION_ARGS_IMAGE_MIME_TYPE : SELECTION_ARGS_IMAGE_MIME_TYPE_WITHOUT_GIF;
-        String[] selectionArgs = new String[args.length + 1];
-        selectionArgs[0] = buckId;
-        for (int i = 1; i < selectionArgs.length; i++) {
-            selectionArgs[i] = args[i-1];
-        }
-        Cursor coverCursor = cr.query(Media.EXTERNAL_CONTENT_URI, photoColumn, selectionId,
-                selectionArgs, Media.DATE_MODIFIED + "" desc"");
+        Cursor coverCursor = cr.query(Media.EXTERNAL_CONTENT_URI, photoColumn, SELECTION_ID,
+                new String[]{buckId, ""image/jpeg"", ""image/png"", ""image/jpg"", ""image/gif""}, Media.DATE_MODIFIED + "" desc"");
         try {
             if (coverCursor != null && coverCursor.moveToFirst()) {
                 String picPath = coverCursor.getString(coverCursor.getColumnIndex(Media.DATA));
@@ -123,14 +123,12 @@
     }
 
     private void getAlbumList(@NonNull final IAlbumTaskCallback callback) {
-        mDefaultAlbum.mCount = 0;
         List<AlbumEntity> tmpList = new ArrayList<>();
         if (mBucketMap == null) {
             postAlbums(callback, tmpList);
         }
         for (Map.Entry<String, AlbumEntity> entry : mBucketMap.entrySet()) {
             tmpList.add(entry.getValue());
-            mDefaultAlbum.mCount += entry.getValue().mCount;
         }
         if (tmpList.size() > 0 && tmpList.get(0) != null) {
             mDefaultAlbum.mImageList = tmpList.get(0).mImageList;",1
Fix format in CheckRequiresForConstructors.java,"     Node extendClass = classNode.getSecondChild();
     
     // If the superclass is something other than a qualified name, ignore it.
-    if (!extendClass.isQualifiedName()) {
-      return;
-    }
+    if (!extendClass.isQualifiedName()) return;
     
     Node root = NodeUtil.getRootOfQualifiedName(extendClass);
 	  ",1
Fixed issue with TicketRegistryCleaner schedule,"         @Scheduled(initialDelayString = ""${cas.ticket.registry.cleaner.schedule.startDelay:PT30S}"",
             fixedDelayString = ""${cas.ticket.registry.cleaner.schedule.repeatInterval:PT120S}"")
         public void run() {
-            try {
             this.ticketRegistryCleaner.clean();
-            } catch (final Exception e) {
-                LOGGER.error(e.getMessage(), e);
-            }
         }
     }
 }",1
Fixed missing support for scope for refresh_token grant_type.,"             throw new IllegalArgumentException(""The refreshToken cannot be null or empty"");
         }
         final OAuthRequest request = new OAuthRequest(api.getAccessTokenVerb(), api.getRefreshTokenEndpoint());
-        final OAuthConfig config = getConfig();
 
-        api.getClientAuthenticationType().addClientAuthentication(request, config);
-
-        final String scope = config.getScope();
-        if (scope != null) {
-            request.addParameter(OAuthConstants.SCOPE, scope);
-        }
+        api.getClientAuthenticationType().addClientAuthentication(request, getConfig());
 
         request.addParameter(OAuthConstants.REFRESH_TOKEN, refreshToken);
         request.addParameter(OAuthConstants.GRANT_TYPE, OAuthConstants.REFRESH_TOKEN);",1
"Remove oredict for Bone Block recipe, stop white dye to bonemeal exploit","             new ItemStack(Blocks.DARK_OAK_STAIRS),
             new ItemStack(Blocks.WOODEN_SLAB),
             new ItemStack(Blocks.GLASS_PANE),
-            new ItemStack(Blocks.field_189880_di), // Bone Block, to prevent conversion of dyes into bone meal.
             null //So the above can have a comma and we don't have to keep editing extra lines.
         };
 ",1
fix navicat INFORMATION_SCHEMA.PROFILING," 		}
 
 		//fix navicat   SELECT STATE AS `State`, ROUND(SUM(DURATION),7) AS `Duration`, CONCAT(ROUND(SUM(DURATION)/*100,3), '%') AS `Percentage` FROM INFORMATION_SCHEMA.PROFILING WHERE QUERY_ID= GROUP BY STATE ORDER BY SEQ
-		if(ServerParse.SELECT == type &&sql.contains("" INFORMATION_SCHEMA.PROFILING "")&&sql.contains(""CONCAT(ROUND(SUM(DURATION)/""))
+		if(ServerParse.SELECT == type &&sql.contains("" INFORMATION_SCHEMA.PROFILING "")&&sql.contains(""CONCAT(ROUND(SUM(DURATION)/*100,3)""))
 		{
 			InformationSchemaProfiling.response(this);
 			return;",1
"Fix missing ""url""","             setStart(indicesArray.getInt(0));
             setEnd(indicesArray.getInt(1));
 
-            if (!json.isNull(""url"")) {
             this.url = json.getString(""url"");
-            }
-
             if (!json.isNull(""expanded_url"")) {
                 // sets expandedURL to url if expanded_url is null
                 // http://jira.twitter4j.org/browse/TFJ-704",1
CAMEL-7321: Fix inconsistent synchronization to prevent freezing of JcrConsumer," 
             boolean isSessionLive = false;
 
-            synchronized (this) {
             if (JcrConsumer.this.session != null) {
                 try {
                     isSessionLive = JcrConsumer.this.session.isLive();
@@ -187,7 +186,6 @@
                     LOG.debug(""Exception while checking jcr session"", e);
                 }
             }
-            }
 
             if (!isSessionLive) {
                 try {",1
fix typo," import org.apache.ibatis.cache.Cache;
 
 /**
- * Lru (least recently used) cache decorator
+ * Lru (first in, first out) cache decorator
  *
  * @author Clinton Begin
  */",1
Fix app crash on enabling FTP service,"         notificationIntent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_SINGLE_TOP);
         PendingIntent contentIntent = PendingIntent.getActivity(context, 0, notificationIntent, 0);
 
-        Notification.Builder notificationBuilder = new Notification.Builder(context)
+        Notification.Builder notificationBuilder = new Notification.Builder(context, NotificationConstants.CHANNEL_NORMAL_ID)
                 .setContentTitle(contentTitle)
                 .setContentText(contentText)
                 .setContentIntent(contentIntent)
@@ -72,9 +72,6 @@
                 .setWhen(when)
                 .setOngoing(true);
 
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O)
-            notificationBuilder.setChannelId(NotificationConstants.CHANNEL_NORMAL_ID);
-
         Notification notification;
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
             notificationBuilder.setVisibility(Notification.VISIBILITY_PUBLIC);",1
Fixes #341 by creating proxy HttpHost with default scheme (HTTP),"             proxyClient = buildHttpClient(null);
         }
 
-        final HttpHost proxyHttpHost = new HttpHost(proxy.host, proxy.port);
+        final HttpHost proxyHttpHost = new HttpHost(proxy.host, proxy.port, proxy.protocol);
 
         final RequestConfig requestConfig = RequestConfig.custom().setProxy(proxyHttpHost).build();
 ",1
#532 Wrap invocation of both default and fallback selectors in a lambda,"                 Optional<Map<String, Object>> annAttr = AnnotationUtils.findAnnotationAttributes(handlerType,
                                                                                                  ProcessingGroup.class);
                 return Optional.of(annAttr.map(attr -> (String) attr.get(""processingGroup""))
-                                          .orElseGet(() -> fallback.apply(o)));
+                                          .orElse(fallback.apply(o)));
             });
     private Configuration config;
     private final Component<ListenerInvocationErrorHandler> defaultListenerInvocationErrorHandler = new Component<>(
@@ -447,7 +447,7 @@
             String processor =
                     selectors.stream().map(s -> s.select(handler)).filter(Optional::isPresent).map(Optional::get)
                              .findFirst()
-                             .orElseGet(() -> defaultSelector.select(handler).orElseThrow(IllegalStateException::new));
+                             .orElse(defaultSelector.select(handler).orElseThrow(IllegalStateException::new));
             assignments.computeIfAbsent(processor, k -> new ArrayList<>()).add(handler);
         });
 ",1
Fix IBluetooth$Stub,"      * @see android.bluetooth.IBluetooth.Stub
      * */
     public static class Stub {
-        public static Class<?> TYPE = RefClass.load(Stub.class, ""android.bluetooth.IBluetooth$Stub"");
+        public static Class<?> TYPE = RefClass.load(Stub.class, ""android.net.IConnectivityManager$Stub"");
         @MethodParams({IBinder.class})
         public static RefStaticMethod<IInterface> asInterface;
     }",1
Fix @return documentation of JsonArray.getJsonObject,"    * Get the JsonObject at position {@code pos} in the array.
    *
    * @param pos  the position in the array
-   * @return  the JsonObject, or null if a null value present
+   * @return  the Integer, or null if a null value present
    * @throws java.lang.ClassCastException if the value cannot be converted to JsonObject
    */
   public JsonObject getJsonObject(int pos) {",1
CertificateServiceImpl.java: fixed ambiguous Extension," 
 import org.bouncycastle.asn1.*;
 import org.bouncycastle.asn1.x509.*;
-import org.bouncycastle.asn1.x509.Extension;
 import org.bouncycastle.x509.extension.*;
 import org.jitsi.service.configuration.*;
 import org.jitsi.service.resources.*;",1
Fix underwater tint not working,"     public void process() {
         PerformanceMonitor.startActivity(""rendering/initialPostProcessing"");
 
-        // Common Shader Parameters
-
-        initialPostMaterial.setFloat(""swimming"", activeCamera.isUnderWater() ? 1.0f : 0.0f, true);
-
         // Shader Parameters
 
         initialPostMaterial.setFloat3(""inLiquidTint"", worldProvider.getBlock(activeCamera.getPosition()).getTint(), true);",1
Fix MviLinearLayout signature. ,"  * @author Hannes Dorfmann
  * @since 3.0.0
  */
-public abstract class MviLinearLayout<V extends MvpView, P extends MviPresenter<V, ?>>
+public abstract class MviLinearLayout<V extends MvpView, P extends MviPresenter<V, P>>
     extends LinearLayout implements MvpView, ViewGroupMviDelegateCallback<V, P> {
 
   private boolean isRestoringViewState = false;",1
Fixing checksum error in UPC-E barcodes,"         break;
       case 8:
         try {
-          if (!UPCEANReader.checkStandardUPCEANChecksum(UPCEReader.convertUPCEtoUPCA(contents))) {
+          if (!UPCEANReader.checkStandardUPCEANChecksum(contents)) {
             throw new IllegalArgumentException(""Contents do not pass checksum"");
           }
         } catch (FormatException ignored) {",1
Fixes #2406,"   }
 
   synchronized void start(boolean checkExpired) {
-    this.timerID = checkExpired ? client.getVertx().setTimer(1000, id -> checkExpired()) : -1;
+    this.timerID = checkExpired ? client.getVertx().setTimer(1, id -> checkExpired()) : -1;
   }
 
   private synchronized void checkExpired() {
     long timestamp = System.currentTimeMillis();
     endpointMap.values().forEach(e -> e.pool.closeIdle(timestamp));
-    timerID = client.getVertx().setTimer(1000, id -> checkExpired());
+    timerID = client.getVertx().setTimer(1, id -> checkExpired());
   }
 
   private static final class EndpointKey {",1
Fix selection/unselection when using badges,"         parent.removeView(tabToAddTo);
 
         container.setTag(tabToAddTo.getTag());
-        tabToAddTo.setTag(null);
         container.addView(tabToAddTo);
         container.addView(this);
 ",1
one more index start fix,"         return commandExecutor.evalWriteReactive(getName(), codec, new RedisCommand<Boolean>(""EVAL"", new BooleanReplayConvertor(), 4, ValueType.OBJECTS),
                     ""local changed = 0 "" +
                     ""local s = redis.call('zrange', KEYS[1], 0, -1) ""
-                       + ""local i = 1 ""
+                       + ""local i = 0 ""
                        + ""while i <= table.getn(s) do ""
                             + ""local element = s[i] ""
                             + ""local isInAgrs = false """,1
Fix setExpiration being called before setMinYear.,"         mPicker.setSetButton(doneButton);
         mPicker.setTheme(mTheme);
 
+        if (mMonthOfYear != -1 || mYear != 0)
+            mPicker.setExpiration(mYear, mMonthOfYear);
+
         if (mMinimumYear != 0) {
             mPicker.setMinYear(mMinimumYear);
         }
 
-        if (mMonthOfYear != -1 || mYear != 0) {
-            mPicker.setExpiration(mYear, mMonthOfYear);
-		}
-
         getDialog().getWindow().setBackgroundDrawableResource(mDialogBackgroundResId);
         return view;
     }",1
fixed in: IntelliJ IDEA 2016.1.1 Build #IU-145.597,"         return map(keyComparator(), (k, v) -> Tuple.of(k, valueMapper.apply(v)));
     }
 
+    // DEV-NOTE: this overridden method fixes compilation failure in IntelliJ Idea 2016.1
+    @Override
+    public <U extends V> TreeMap<K, V> merge(Map<? extends K, U> that, BiFunction<? super V, ? super U, ? extends V> collisionResolution) {
+        return super.merge(that, collisionResolution);
+    }
+
     @Override
     public TreeMap<K, V> put(K key, V value) {
         return new TreeMap<>(entries.insert(new Tuple2<>(key, value)));",1
Fixed wrong item range removed notification.,"         if (group == null) throw new RuntimeException(""Group cannot be null"");
         int position = groups.indexOf(group);
         int count = groups.get(position).getItemCount();
-        int itemCountBeforeGroup = getItemCountBeforeGroup(position);
         group.setGroupDataObserver(null);
         groups.remove(position);
-        notifyItemRangeRemoved(itemCountBeforeGroup, count);
+        notifyItemRangeRemoved(position, count);
     }
 
     public void add(@NonNull int index, Group group) {",1
Fixed setAdapter bug,"         }
 
         mDataChanged = true;
-        mItemCount = mAdapter != null ? mAdapter.getCount() : 0;
+        mItemCount = adapter != null ? adapter.getCount() : 0;
 
         if (adapter != null) {
             adapter.registerDataSetObserver(mObserver);",1
"cleans up Memory leak, because raw data was not released","             bitmapProvider.release(previousImage);
         }
         previousImage = null;
-        rawData = null;
     }
 
     public void setData(GifHeader header, byte[] data) {",1
Fix arsc decoder for wrong chunk header read and table config size 64 processing,"     private final static short ENTRY_FLAG_WEAK = 0x0004;
 
     private static final Logger LOGGER             = Logger.getLogger(ARSCDecoder.class.getName());
-    private static final int    KNOWN_CONFIG_BYTES = 64;
+    private static final int    KNOWN_CONFIG_BYTES = 56;
 
     private static HashMap<Integer, Set<String>> mExistTypeNames;
 
@@ -138,24 +138,18 @@
             System.out.printf(""Decoding Shared Library (%s), pkgId: %d\n"", packageName, packageId);
         }
 
-        nextChunk();
-        while(mHeader.type == Header.TYPE_TYPE) {
+        while(nextChunk().type == Header.TYPE_TYPE) {
             readTableTypeSpec();
         }
     }
 
     private void readTableTypeSpec() throws AndrolibException, IOException {
         readSingleTableTypeSpec();
-
-        nextChunk();
-        while (mHeader.type == Header.TYPE_SPEC_TYPE) {
+        while (nextChunk().type == Header.TYPE_SPEC_TYPE) {
             readSingleTableTypeSpec();
-            nextChunk();
         }
-
-        while (mHeader.type == Header.TYPE_TYPE) {
+        while (nextChunk().type == Header.TYPE_TYPE) {
             readConfig();
-            nextChunk();
         }
     }
 
@@ -166,10 +160,6 @@
         int entryCount = mIn.readInt();
 
         /* flags */mIn.skipBytes(entryCount * 4);
-
-        mCurTypeID = id;
-        mResId = (0xff000000 & mResId) | id << 16;
-        mType = new ResType(mTypeNames.getString(id - 1), mPkg);
     }
 
     private void readConfig() throws IOException, AndrolibException {
@@ -299,11 +289,6 @@
             read = 56;
         }
 
-        if (size >= 64) {
-            mIn.skipBytes(8);
-            read = 64;
-        }
-
         int exceedingSize = size - KNOWN_CONFIG_BYTES;
         if (exceedingSize > 0) {
             byte[] buf = new byte[exceedingSize];
@@ -320,13 +305,12 @@
                 ));
                 isInvalid = true;
             }
-        } else {
+        }
         int remainingSize = size - read;
         if (remainingSize > 0) {
             mIn.skipBytes(remainingSize);
         }
     }
-    }
 
     private String readScriptOrVariantChar(int length) throws AndrolibException, IOException {
         StringBuilder string = new StringBuilder(16);",1
[BACKLOG-6305] Fixing Job saving for root directory,"           // Try to find the same directory in the new repository...
           RepositoryDirectoryInterface rdi =
             repository.findDirectory( jobMeta.getRepositoryDirectory().getPath() );
-          if ( rdi != null && !rdi.getPath().equals( ""/"" ) ) {
+          if ( rdi != null ) {
             jobMeta.setRepositoryDirectory( rdi );
           } else {
             // the root is the default!",1
Fix: unloading namespace logging," 
     @SuppressWarnings(""deprecation"")
     protected void internalUnloadNamespace() {
-        log.info(""[{}] Unloading namespace {}"", clientAppId(), namespaceName);
+        log.info(""[{}] Unloading namespace {}"", clientAppId());
 
         validateSuperUserAccess();
 ",1
Fix the empty drawer bug on quick consecutive profile switches,"             if (drawerItem != null && drawerItem instanceof IProfile && ((IProfile) drawerItem).isSelectable()) {
                 switchProfiles((IProfile) drawerItem);
             }
-            mDrawer.setOnDrawerItemClickListener(null);
+
             //wrap the onSelection call and the reset stuff within a handler to prevent lag
             new Handler().postDelayed(new Runnable() {
                 @Override",1
fix bug in PrimitiveTypes," 
   private void add(final Class<?> primitiveType, final Class<?> wrapperType) {
     primitiveToWrappers.put(primitiveType, wrapperType);
-    wrappersToPrimitives.put(wrapperType, primitiveType);
+    primitiveToWrappers.put(wrapperType, primitiveType);
   }
 
   public Class<?> getWrapper(final Class<?> primitiveType) {",1
Fix notification itents by cancelling the old ones," import javax.inject.Provider;
 import timber.log.Timber;
 
-import static android.app.PendingIntent.FLAG_CANCEL_CURRENT;
 import static android.content.Context.MEDIA_PROJECTION_SERVICE;
 import static android.content.Context.NOTIFICATION_SERVICE;
 import static android.content.Context.WINDOW_SERVICE;
@@ -289,20 +288,17 @@
 
   private void showNotification(final Uri uri, Bitmap bitmap) {
     Intent viewIntent = new Intent(ACTION_VIEW, uri);
-    PendingIntent pendingViewIntent =
-        PendingIntent.getActivity(context, 0, viewIntent, FLAG_CANCEL_CURRENT);
+    PendingIntent pendingViewIntent = PendingIntent.getActivity(context, 0, viewIntent, 0);
 
     Intent shareIntent = new Intent(ACTION_SEND);
     shareIntent.setType(MIME_TYPE);
     shareIntent.putExtra(Intent.EXTRA_STREAM, uri);
     shareIntent = Intent.createChooser(shareIntent, null);
-    PendingIntent pendingShareIntent =
-        PendingIntent.getActivity(context, 0, shareIntent, FLAG_CANCEL_CURRENT);
+    PendingIntent pendingShareIntent = PendingIntent.getActivity(context, 0, shareIntent, 0);
 
     Intent deleteIntent = new Intent(context, DeleteRecordingBroadcastReceiver.class);
     deleteIntent.setData(uri);
-    PendingIntent pendingDeleteIntent =
-        PendingIntent.getBroadcast(context, 0, deleteIntent, FLAG_CANCEL_CURRENT);
+    PendingIntent pendingDeleteIntent = PendingIntent.getBroadcast(context, 0, deleteIntent, 0);
 
     CharSequence title = context.getText(R.string.notification_captured_title);
     CharSequence subtitle = context.getText(R.string.notification_captured_subtitle);",1
修复bug #938 当分库字段为uuid时，使用sharding-by-murmur规则配置主子表关系，导致主子表关联数据无法插入到同一个库中 ," 			}
 			//取得joinkey的值
 			String joinKeyVal = insertStmt.getValues().getValues().get(joinKeyIndex).toString();
-			//解决bug #938，当关联字段的值为char类型时，去掉前后""'""
-			String realVal = joinKeyVal;
-			if (joinKeyVal.startsWith(""'"") && joinKeyVal.endsWith(""'"") && joinKeyVal.length() > 2) {
-				realVal = joinKeyVal.substring(1, joinKeyVal.length() - 1);
-			}
 
 			String sql = insertStmt.toString();
 
 			// try to route by ER parent partion key
 			//如果是二级子表（父表不再有父表）,并且分片字段正好是joinkey字段，调用routeByERParentKey
-			RouteResultset theRrs = RouterUtil.routeByERParentKey(sc, schema, ServerParse.INSERT, sql, rrs, tc, realVal);
+			RouteResultset theRrs = RouterUtil.routeByERParentKey(sc, schema, ServerParse.INSERT, sql, rrs, tc, joinKeyVal);
 			if (theRrs != null) {
 				boolean processedInsert=false;
 				//判断是否需要全局序列号",1
Fix AsyncTask blocking beacon parsing," import android.content.pm.ApplicationInfo;
 import android.os.AsyncTask;
 import android.os.Binder;
-import android.os.Build;
 import android.os.Handler;
 import android.os.IBinder;
 import android.os.Message;
@@ -56,7 +55,6 @@
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
-import java.util.concurrent.Executor;
 
 /**
  * @author dyoung
@@ -294,11 +292,9 @@
     }
 
     private CycledLeScanCallback mCycledLeScanCallback = new CycledLeScanCallback() {
-        @TargetApi(Build.VERSION_CODES.HONEYCOMB)
         @Override
         public void onLeScan(BluetoothDevice device, int rssi, byte[] scanRecord) {
-            new ScanProcessor().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,
-                    new ScanData(device, rssi, scanRecord));
+            new ScanProcessor().execute(new ScanData(device, rssi, scanRecord));
         }
 
         @Override",1
Fixes typo in Exception message,"             parameterResolvers[i] = parameterResolverFactory.createInstance(executable, parameters, i);
             if (parameterResolvers[i] == null) {
                 throw new UnsupportedHandlerException(
-                        ""Unable to resolve parameter "" + i + "" ("" + parameters[i].getType().getSimpleName() +
+                        ""Unable to resolver parameter "" + i + "" ("" + parameters[i].getType().getSimpleName() +
                                 "") in handler "" + executable.toGenericString() + ""."", executable);
             }
             if (supportedPayloadType.isAssignableFrom(parameterResolvers[i].supportedPayloadType())) {",1
Fixed javadoc," 
     /**
      * Converts this to a mutable {@link java.util.Set}.
-     * Elements are added by calling {@link java.util.Set#add(Object)}.
+     * Elements are added by calling {@link java.util.Set#add(Object}.
      *
      * <pre>{@code
      * // = []
@@ -902,7 +902,7 @@
 
     /**
      * Converts this to a specific {@link java.util.Set}.
-     * Elements are added by calling {@link java.util.Set#add(Object)}.
+     * Elements are added by calling {@link java.util.Set#add(Object}.
      *
      * <pre>{@code
      * // = []",1
"ReflectionCacheSourceCreator, fixed previous commit"," import java.util.Set;
 import java.util.Map.Entry;
 
+import com.badlogic.gwtref.gen.SwitchedCodeBlocks.Code;
 import com.google.gwt.core.ext.BadPropertyValueException;
 import com.google.gwt.core.ext.ConfigurationProperty;
 import com.google.gwt.core.ext.GeneratorContext;",1
"Revert ""[SP-4519] Backport of BACKLOG-24282 - Minor fix to the MDI analyzer -…""","     }
   }
 
-  @Override public IClonableStepAnalyzer cloneAnalyzer() {
+  @Override protected IClonableStepAnalyzer newInstance() {
     return new MetaInjectAnalyzer();
   }
 ",1
Fix IllegalStateException being thrown for all event types.,"       switch (event.getEventType()) {
         case CREATED:
           onCreated(event);
-          return;
+          break;
         case UPDATED:
           onUpdated(event);
-          return;
+          break;
         case REMOVED:
           onRemoved(event);
-          return;
+          break;
         case EXPIRED:
           onExpired(event);
-          return;
+          break;
       }
       throw new IllegalStateException(""Unknown event type: "" + event.getEventType());
     } catch (Exception e) {",1
Start function worker service after broker is fully started," 
             leaderElectionService.start();
 
+            // start function worker service if necessary
+            this.startWorkerService();
+
             LOG.info(""Starting Pulsar Broker service; version: '{}'"", ( brokerVersion != null ? brokerVersion : ""unknown"" )  );
 
             webService.start();
@@ -422,9 +425,6 @@
 
             acquireSLANamespace();
 
-            // start function worker service if necessary
-            this.startWorkerService();
-
             LOG.info(""messaging service is ready, bootstrap service on port={}, broker url={}, cluster={}, configs={}"",
                     config.getWebServicePort(), brokerServiceUrl, config.getClusterName(),
                     ReflectionToStringBuilder.toString(config));",1
Fixed issue 1309.," 
 						connection.connect();
 
-						final HttpClientResponse clientResponse = new HttpClientResponse(connection);
 						// post a runnable to sync the handler with the main thread
 						Gdx.app.postRunnable(new Runnable() {
 							@Override
 							public void run () {
 								try {
-									httpResponseListener.handleHttpResponse(clientResponse);
+									httpResponseListener.handleHttpResponse(new HttpClientResponse(connection));
+								} catch (IOException e) {
+									httpResponseListener.failed(e);
 								} finally {
 									connection.disconnect();
 								}",1
fix the default config," 			Map<Server, Integer> map = new HashMap<Server, Integer>();
 			List<Server> servers = queryEnableServers();
 			int length = servers.size();
-			int index = domain.hashCode();
+			int index = domain.hashCode() * length;
 
 			for (int i = 0; i < 2; i++) {
-				map.put(servers.get((index + i) % length), 0);
+				map.put(servers.get((index + 1) % length), 0);
 			}
 			map.put(queryBackUpServer(), 0);
 ",1
fix partial delete multi value index unexpected behavior,"             return false;
           }
 
-          if (value == null) {
-            indexEngine.remove(key);
-          }
-          else if (values.remove(value)) {
+          if (values.remove(value)) {
             if (values.isEmpty())
               indexEngine.remove(key);
             else",1
"Fix compile error on GWT, sorry!"," 				throw new IllegalStateException(""frame buffer couldn't be constructed: missing attachment"");
 			if (result == GL20.GL_FRAMEBUFFER_UNSUPPORTED)
 				throw new IllegalStateException(""frame buffer couldn't be constructed: unsupported combination of formats"");
-			throw new IllegalStateException(""frame buffer couldn't be constructed: unknown error "" + result);
+      throw new IllegalStateException(String.format(""frame buffer couldn't be constructed: unknown error 0x%04x"", result));
 		}
 	}
 ",1
"Notify AbstractPlugin completed, always"," // ZAP: 2017/03/27 Use HttpRequestConfig.
 // ZAP: 2017/05/31 Remove re-declaration of methods.
 // ZAP: 2017/10/31 Use ExtensionLoader.getExtension(Class).
-// ZAP: 2017/11/14 Notify completion in a finally block.
 
 package org.parosproxy.paros.core.scanner;
 
@@ -382,11 +381,11 @@
             
         } catch (Exception e) {
             getLog().error(e.getMessage(), e);
-        } finally {
+        }
+        
         notifyPluginCompleted(getParent());
         this.finished = new Date();
     }
-    }
 
     /**
      * Generate an alert when a security issue (risk/info) is found. Default",1
"schema.xml中 配置 checkSQLschema=""true"" ，sql语句中含schema时，有bug #815"," 	public RouteResultset route(SystemConfig sysConfig, SchemaConfig schema, int sqlType, String origSQL,
 			String charset, ServerConnection sc, LayerCachePool cachePool) throws SQLNonTransientException {
 
-		//对应schema标签checkSQLschema属性，把表示schema的字符去掉
-		if (schema.isCheckSQLSchema()) {
-			origSQL = RouterUtil.removeSchema(origSQL, schema.getName());
-		}
-
 		/**
 		 * 处理一些路由之前的逻辑
 		 * 全局序列号，父子表插入
@@ -45,6 +40,10 @@
 			LOGGER.debug(""sql intercepted to "" + stmt + "" from "" + origSQL);
 		}
 
+		//对应schema标签checkSQLschema属性，把表示schema的字符去掉
+		if (schema.isCheckSQLSchema()) {
+			stmt = RouterUtil.removeSchema(stmt, schema.getName());
+		}
 
 		RouteResultset rrs = new RouteResultset(stmt, sqlType);
 ",1
Fix Sonic still send request in FirstLoad mode when server return Cache-Offline: http,"             return;
         }
 
-        String cacheOffline = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_CACHE_OFFLINE);
-        SonicUtils.log(TAG, Log.INFO, ""session("" + sId + "") handleFlow_Connection: cacheOffline is "" + cacheOffline + ""."");
-
-        // When cache-offline is ""http"": which means sonic server is in bad condition, need feed back to run standard http request.
-        if (OFFLINE_MODE_HTTP.equalsIgnoreCase(cacheOffline)) {
-            if (!TextUtils.isEmpty(cacheHtml)) {
-                //stop loading local sonic cache.
-                handleFlow_ServiceUnavailable();
-            }
-            long unavailableTime = System.currentTimeMillis() + SonicEngine.getInstance().getConfig().SONIC_UNAVAILABLE_TIME;
-            SonicDataHelper.setSonicUnavailableTime(id, unavailableTime);
-            return;
-        }
-
         // When cacheHtml is empty, run First-Load flow
         if (TextUtils.isEmpty(cacheHtml)) {
             handleFlow_FirstLoad();
             return;
         }
 
-        // Handle cache-offline : false or null.
+        // Handle cache-offline
+        String cacheOffline = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_CACHE_OFFLINE);
+        SonicUtils.log(TAG, Log.INFO, ""session("" + sId + "") handleFlow_Connection: cacheOffline is "" + cacheOffline + ""."");
         if (TextUtils.isEmpty(cacheOffline) || OFFLINE_MODE_FALSE.equalsIgnoreCase(cacheOffline)) {
             SonicUtils.log(TAG, Log.ERROR, ""session("" + sId + "") handleFlow_Connection error: Cache-Offline is empty or false!"");
             SonicUtils.removeSessionCache(id);
             return;
         }
 
+        // When cache-offline is ""http"": which means sonic server is in bad condition, need feed back to run standard http request.
+        if (OFFLINE_MODE_HTTP.equalsIgnoreCase(cacheOffline)) {
+            handleFlow_ServiceUnavailable();
+            long unavailableTime = System.currentTimeMillis() + SonicEngine.getInstance().getConfig().SONIC_UNAVAILABLE_TIME;
+            SonicDataHelper.setSonicUnavailableTime(id, unavailableTime);
+            return;
+        }
 
         String eTag = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_ETAG);
         String templateChange = server.getResponseHeaderField(SonicSessionConnection.CUSTOM_HEAD_FILED_TEMPLATE_CHANGE);",1
Kick feature now working,"     private Time time;
     private long nextNetworkTick;
 
-    private boolean kicked;
 
     // Server only
     private ChannelGroup allChannels = new DefaultChannelGroup(""tera-channels"");
@@ -746,15 +745,10 @@
     public void forceDisconnect(Client client) {
         if (client instanceof NetClient) {
             NetClient nc = (NetClient) client;
-            removeKickedClient(nc);
+            removeClient(nc);
         }
     }
 
-    void removeKickedClient(NetClient client) {
-        kicked = true;
-        disconnectedClients.offer(client);
-    }
-
     void registerChannel(Channel channel) {
         allChannels.add(channel);
     }
@@ -764,10 +758,8 @@
     }
 
     void removeClient(NetClient client) {
-        if (!kicked) {
         disconnectedClients.offer(client);
     }
-    }
 
     private void processRemovedClient(Client client) {
         if (client instanceof NetClient) {",1
"Admin-api-tool doc: Fix REST api url, add expire-messge api doc","         }
     }
     
-    @Parameters(commandDescription = ""Expire messages that older than given expiry time (in seconds) for the subscription"")
+    @Parameters(commandDescription = ""Expire messages for the subscription"")
     private class ExpireMessages extends CliCommand {
         @Parameter(description = ""persistent://property/cluster/namespace/destination"", required = true)
         private java.util.List<String> params;
@@ -317,7 +317,7 @@
         }
     }
     
-    @Parameters(commandDescription = ""Expire messages that older than given expiry time (in seconds) for all subscriptions"")
+    @Parameters(commandDescription = ""Expire messages for all subscriptions"")
     private class ExpireMessagesForAllSubscriptions extends CliCommand {
         @Parameter(description = ""persistent://property/cluster/namespace/destination"", required = true)
         private java.util.List<String> params;",1
Fixed formatting," 
 	@Override
 	public void create () {
-		// @off
-		String vertexShader =
-			  ""uniform mat4 u_mvpMatrix;                   \n""
-			+ ""attribute vec4 a_position;                  \n""
-			+ ""void main()                                 \n""
-			+ ""{                                           \n""
-			+ ""   gl_Position = u_mvpMatrix * a_position;  \n""
-			+ ""}                            \n"";
-		String fragmentShader =
-			""#ifdef GL_ES\n""
-			+ ""precision mediump float;\n""
-			+ ""#endif\n""
-			+ ""void main()                                  \n""
-			+ ""{                                            \n""
-			+ ""  gl_FragColor = vec4 ( 1.0, 0.0, 0.0, 1.0 );\n""
-			+ ""}"";
-		// @on
+		String vertexShader = ""uniform mat4 u_mvpMatrix;                   \n"" + ""attribute vec4 a_position;                  \n""
+			+ ""void main()                                 \n"" + ""{                                           \n""
+			+ ""   gl_Position = u_mvpMatrix * a_position;  \n"" + ""}                            \n"";
+		String fragmentShader = ""#ifdef GL_ES\n"" + ""precision mediump float;\n"" + ""#endif\n""
+			+ ""void main()                                  \n"" + ""{                                            \n""
+			+ ""  gl_FragColor = vec4 ( 1.0, 0.0, 0.0, 1.0 );\n"" + ""}"";
 
 		shader = new ShaderProgram(vertexShader, fragmentShader);
 		mesh = Shapes.genCube();",1
"Issue 1091: Render on resize, half fix"," 		synchronized (this) {
 			boolean rq = requestRendering;
 			requestRendering = false;
-			return rq || isContinuous || Display.isDirty();
+			return rq || isContinuous;
 		}
 	}
 ",1
Add fix suggestion for ClipboardUIManager leak.,"       SAMSUNG.equals(MANUFACTURER) && SDK_INT >= KITKAT && SDK_INT <= LOLLIPOP) {
     @Override void add(ExcludedRefs.Builder excluded) {
       // ClipboardUIManager is a static singleton that leaks an activity context.
-      // Fix: trigger a call to ClipboardUIManager.getInstance() in Application.onCreate(), so
-      // that the ClipboardUIManager instance gets cached with a reference to the
-      // application context. Example: https://gist.github.com/pepyakin/8d2221501fd572d4a61c
-      excluded.instanceField(""android.sec.clipboard.ClipboardUIManager"", ""mContext"");
+      excluded.staticField(""android.sec.clipboard.ClipboardUIManager"", ""sInstance"");
     }
   },
 ",1
bug:修复在部分场景下重复点击无法找到View的情况,"                 } else if (parentElement != null) {
                     parentElement = parentElement.getParentElement();
                 }
-                target = parentElement == null ? element : parentElement;
+                target = parentElement;
                 break;
             }
         }",1
Effectively change user permissions when listing inputs.,"     @ApiOperation(value = ""Get all inputs"")
     public InputsList list() {
         final Set<InputSummary> inputs = inputService.all().stream()
-                .filter(input -> isPermitted(RestPermissions.INPUTS_READ, input.getId()))
-                .map(this::getInputSummary)
+                .map(input -> getInputSummary(input))
                 .collect(Collectors.toSet());
 
         return InputsList.create(inputs);",1
Add missing functions to ModifierVisitorAdapter," import com.github.javaparser.ast.expr.InstanceOfExpr;
 import com.github.javaparser.ast.expr.IntegerLiteralExpr;
 import com.github.javaparser.ast.expr.IntegerLiteralMinValueExpr;
-import com.github.javaparser.ast.expr.LambdaExpr;
 import com.github.javaparser.ast.expr.LongLiteralExpr;
 import com.github.javaparser.ast.expr.LongLiteralMinValueExpr;
 import com.github.javaparser.ast.expr.MarkerAnnotationExpr;
 import com.github.javaparser.ast.expr.MemberValuePair;
 import com.github.javaparser.ast.expr.MethodCallExpr;
-import com.github.javaparser.ast.expr.MethodReferenceExpr;
 import com.github.javaparser.ast.expr.NameExpr;
 import com.github.javaparser.ast.expr.NormalAnnotationExpr;
 import com.github.javaparser.ast.expr.NullLiteralExpr;
@@ -81,7 +79,6 @@
 import com.github.javaparser.ast.expr.StringLiteralExpr;
 import com.github.javaparser.ast.expr.SuperExpr;
 import com.github.javaparser.ast.expr.ThisExpr;
-import com.github.javaparser.ast.expr.TypeExpr;
 import com.github.javaparser.ast.expr.UnaryExpr;
 import com.github.javaparser.ast.expr.VariableDeclarationExpr;
 import com.github.javaparser.ast.stmt.AssertStmt;
@@ -951,18 +948,6 @@
 		return n;
 	}
 
-	@Override public Node visit(final LambdaExpr n, final A arg) {
-		return n;
-	}
-
-	@Override public Node visit(final MethodReferenceExpr n, final A arg){
-		return n;
-	}
-
-	@Override public Node visit(final TypeExpr n, final A arg){
-		return n;
-	}
-
 	@Override public Node visit(final BlockComment n, final A arg) {
 		return n;
 	}",1
Fixes #4322: Restore window on correct monitor," 			Lwjgl3DisplayMode currentMode = (Lwjgl3DisplayMode) getDisplayMode();
 			int windowPosX = (currentMode.width - width) / 2;
 			int windowPosY = (currentMode.height - height) / 2;
-			GLFW.glfwSetWindowMonitor(window.getWindowHandle(), currentMode.getMonitor(),
+			GLFW.glfwSetWindowMonitor(window.getWindowHandle(), 0,
 					windowPosX, windowPosY, width, height, currentMode.refreshRate);
 		}
 		updateFramebufferInfo();",1
Check for a changed BigDecimal value fails due to handling of numerical scale,"                 value = ((String) value).trim();
             }
             if (value instanceof BigDecimal) {
-                BigDecimal origValue = (BigDecimal) value;
-                BigDecimal newValue = (BigDecimal) checkValue;
-                //set the scale of one of the BigDecimal values to the larger of the two scales
-                if (newValue.scale() < origValue.scale()) {
-                    checkValue = newValue.setScale(origValue.scale(), RoundingMode.UNNECESSARY);
-                } else if (origValue.scale() < newValue.scale()) {
-                    value = origValue.setScale(newValue.scale(), RoundingMode.UNNECESSARY);
-                }
+                checkValue = ((BigDecimal) checkValue).setScale(((BigDecimal) value).scale(), RoundingMode.HALF_UP);
             }
             dirty = value == null || !value.equals(checkValue);
         }",1
Fixing package name of incorrect import from shaded dependency.," 
 import com.codahale.metrics.annotation.Timed;
 import com.google.common.annotations.VisibleForTesting;
-import com.google.common.base.Strings;
 import io.swagger.annotations.Api;
 import io.swagger.annotations.ApiOperation;
 import io.swagger.annotations.ApiParam;
@@ -26,6 +25,7 @@
 import io.swagger.annotations.ApiResponses;
 import org.apache.shiro.authz.annotation.RequiresAuthentication;
 import org.apache.shiro.authz.annotation.RequiresPermissions;
+import org.elasticsearch.common.Strings;
 import org.graylog2.audit.AuditEventTypes;
 import org.graylog2.audit.jersey.AuditEvent;
 import org.graylog2.inputs.Input;",1
Fix Discovery Endpoint 400 Error," import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.ResponseBody;
 
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
 import java.util.HashMap;
 import java.util.Map;
 
@@ -43,11 +45,13 @@
     /**
      * Discovery.
      *
+     * @param request  the request
+     * @param response the response
      * @return the map
      */
     @GetMapping
     @ResponseBody
-    public Map<String, Object> discovery() {
+    public Map<String, Object> discovery(final HttpServletRequest request, final HttpServletResponse response) {
         val results = new HashMap<String, Object>();
         results.put(""profile"", casServerProfileRegistrar.getProfile());
         return results;",1
Fix method call,"     }
 
     public long extractMillis(Settings settings) {
-        return extractTimeValue(settings).millis();
+        return extractTimeValue(settings, null).millis();
     }
 
     public TimeValue extractTimeValue(Settings settings) {",1
"Fixes in IOSGraphics, + formatting"," import com.badlogic.gdx.utils.Array;
 
 // FIXME add GL 1.x support by ripping Android's classes
-public class IOSGraphics extends NSObject implements Graphics, GLKViewDelegate, GLKViewControllerDelegate {
+public class IOSGraphics extends NSObject implements Graphics, GLKViewDelegate,
+		GLKViewControllerDelegate {
 
 	private static final String tag = ""IOSGraphics"";
 
@@ -79,7 +80,8 @@
 			app.listener.resize(graphics.width, graphics.height);
 		}
 
-		public boolean shouldAutorotateToInterfaceOrientation (UIInterfaceOrientation orientation) {
+		public boolean shouldAutorotateToInterfaceOrientation(
+				UIInterfaceOrientation orientation) {
 			// we return ""true"" if we support the orientation
 			switch (orientation) {
 			case LandscapeLeft:
@@ -93,7 +95,8 @@
 
 		@Callback
 		@BindSelector(""shouldAutorotateToInterfaceOrientation:"")
-		private static boolean shouldAutorotateToInterfaceOrientation (IOSUIViewController self, Selector sel,
+		private static boolean shouldAutorotateToInterfaceOrientation(
+				IOSUIViewController self, Selector sel,
 				UIInterfaceOrientation orientation) {
 			return self.shouldAutorotateToInterfaceOrientation(orientation);
 		}
@@ -126,6 +129,7 @@
 	private float density = 1;
 
 	volatile boolean paused;
+	boolean wasPaused;
 
 	IOSApplicationConfiguration config;
 	EAGLContext context;
@@ -192,10 +196,7 @@
 		// IOSApplicationConfiguration
 		int r = 0, g = 0, b = 0, a = 0, depth = 0, stencil = 0, samples = 0;
 		if(config.colorFormat == GLKViewDrawableColorFormat.RGB565) {
-			r = 5;
-			g = 6;
-			b = 5;
-			a = 0;
+			r = 5; g = 6; b = 5; a = 0;
 		} else {
 			r = g = b = a = 8;
 		}
@@ -243,12 +244,13 @@
 		framesStart = lastFrameTime;
 
 		paused = false;
+		wasPaused = true;
 	}
 
 	public void resume() {
-		if (!paused) return;
 		paused = false;
 		
+		if (wasPaused) {
 			Array<LifecycleListener> listeners = app.lifecycleListeners;
 			synchronized (listeners) {
 				for (LifecycleListener listener : listeners) {
@@ -256,12 +258,14 @@
 				}
 			}
 			app.listener.resume();
+			wasPaused = false;
+		}
 	}
 
 	public void pause() {
-		if (paused) return;
 		paused = true;
 		
+		if (!wasPaused) {
 			Array<LifecycleListener> listeners = app.lifecycleListeners;
 			synchronized (listeners) {
 				for (LifecycleListener listener : listeners) {
@@ -269,10 +273,11 @@
 				}
 			}
 			app.listener.pause();
+			wasPaused = true;
+		}
 	}
 
 	boolean created = false;
-
 	@Override
 	public void draw(GLKView view, CGRect rect) {
 		if(!created) {
@@ -314,10 +319,8 @@
 	@Override
 	public void willPause(GLKViewController controller, boolean pause) {
 		if (pause) {
-			if (paused) return;
 			pause();
 		} else {
-			if (!paused) return;
 			resume();
 		}
 	}
@@ -402,9 +405,11 @@
 		return ppcY;
 	}
 
-	/** Returns the display density.
+	/**
+	 * Returns the display density.
 	 * 
-	 * @return 1.0f for non-retina devices, 2.0f for retina devices. */
+	 * @return 1.0f for non-retina devices, 2.0f for retina devices.
+	 */
 	@Override
 	public float getDensity() {
 		return density;
@@ -422,12 +427,12 @@
 
 	@Override
 	public DisplayMode getDesktopDisplayMode() {
-		return new IOSDisplayMode(getWidth(), getHeight(), config.preferredFramesPerSecond, bufferFormat.r + bufferFormat.g
-			+ bufferFormat.b + bufferFormat.a);
+		return new IOSDisplayMode(getWidth(), getHeight(), config.preferredFramesPerSecond, bufferFormat.r + bufferFormat.g + bufferFormat.b + bufferFormat.a);
 	}
 
 	private class IOSDisplayMode extends DisplayMode {
-		protected IOSDisplayMode (int width, int height, int refreshRate, int bitsPerPixel) {
+		protected IOSDisplayMode(int width, int height, int refreshRate,
+				int bitsPerPixel) {
 			super(width, height, refreshRate, bitsPerPixel);
 		}
 	}
@@ -457,7 +462,8 @@
 
 	@Override
 	public boolean supportsExtension(String extension) {
-		if (extensions == null) extensions = Gdx.gl.glGetString(GL10.GL_EXTENSIONS);
+		if (extensions == null)
+			extensions = Gdx.gl.glGetString(GL10.GL_EXTENSIONS);
 		return extensions.contains(extension);
 	}
 ",1
fix query no data when partion column as filter ,"         // prune segments via extracted time ranges
         RangeSet<Long> segmentRanges = TreeRangeSet.create();
         for (CubeSegment segment : cube.getSegments(SegmentStatusEnum.READY)) {
-            Range<Long> segmentRange = Range.closedOpen(segment.getTSRange().start.v, segment.getTSRange().end.v);
+            Range<Long> segmentRange = Range.closedOpen(segment.getTSRange().start.v, segment.getTSRange().start.v);
             boolean containQueryRange = !result.timeRanges.subRangeSet(segmentRange).isEmpty();
             if (segment.getInputRecords() > 0 && containQueryRange) {
                 segmentRanges.add(segmentRange);",1
fixed ConcurrentModificationException on BeaconManager,"                         consumer.onBeaconServiceConnect();
                         ConsumerInfo consumerInfo = consumers.get(consumer);
                         consumerInfo.isConnected = true;
+                        consumers.put(consumer, consumerInfo);
                     }
                 }
             }",1
add keyword 'try' (fix #71),"         keyWordList.add(""throw"");
         keyWordList.add(""throws"");
         keyWordList.add(""transient"");
-        keyWordList.add(""try"");
         keyWordList.add(""abstract"");
         keyWordList.add(""void"");
         keyWordList.add(""volatile"");",1
Fix #3147 (with MathUtils)," 	 * @param intersection The intersection point (optional)
 	 * @return True in case an intersection is present. */
 	public static boolean intersectRayTriangle (Ray ray, Vector3 t1, Vector3 t2, Vector3 t3, Vector3 intersection) {
-		Vector3 edge1 = v0.set(t2).sub(t1);
-		Vector3 edge2 = v1.set(t3).sub(t1);
-		
-		Vector3 pvec = v2.set(ray.direction).crs(edge2);
-		float det = edge1.dot(pvec);
-		if (MathUtils.isZero(det)) {
-			p.set(t1, t2, t3);
-			if (p.testPoint(ray.origin) == PlaneSide.OnPlane && Intersector.isPointInTriangle(ray.origin, t1, t2, t3)) {
+		if (t1.idt(ray.origin) || t2.idt(ray.origin) || t3.idt(ray.origin)) {
 			if (intersection != null) intersection.set(ray.origin);
 			return true;
 		}
+
+		p.set(t1, t2, t3);
+		if (!intersectRayPlane(ray, p, i)) return false;
+
+		v0.set(t3).sub(t1);
+		v1.set(t2).sub(t1);
+		v2.set(i).sub(t1);
+
+		float dot00 = v0.dot(v0);
+		float dot01 = v0.dot(v1);
+		float dot02 = v0.dot(v2);
+		float dot11 = v1.dot(v1);
+		float dot12 = v1.dot(v2);
+
+		float denom = dot00 * dot11 - dot01 * dot01;
+		if (denom == 0) return false;
+
+		float u = (dot11 * dot02 - dot01 * dot12) / denom;
+		float v = (dot00 * dot12 - dot01 * dot02) / denom;
+
+		if (u >= 0 && v >= 0 && u + v <= 1) {
+			if (intersection != null) intersection.set(i);
+			return true;
+		} else {
 			return false;
 		}
 
-		det = 1.0f / det;
-
-		Vector3 tvec = i.set(ray.origin).sub(t1);
-		float u = tvec.dot(pvec) * det;
-		if (u < 0.0f || u > 1.0f) return false;
-		
-		Vector3 qvec = tvec.crs(edge1);
-		float v = ray.direction.dot(qvec) * det;
-		if (v < 0.0f || u + v > 1.0f) return false;
-		
-		float t = edge2.dot(qvec) * det;
-		if (t < 0) return false;
-		
-		if (intersection != null) {
-			if (t <= MathUtils.FLOAT_ROUNDING_ERROR) {
-				intersection.set(ray.origin);
-			} else {
-				ray.getEndPoint(intersection, t);
-			}
-		}
-		
-		return true;
 	}
 
 	private static final Vector3 dir = new Vector3();",1
Do not access the EDT in daemon mode," import org.zaproxy.zap.extension.help.ExtensionHelp;
 import org.zaproxy.zap.view.ZapMenuItem;
 
-public class ExtensionSearch extends ExtensionAdaptor {
+public class ExtensionSearch extends ExtensionAdaptor implements SessionChangedListener {
 
     private static final Logger LOGGER = Logger.getLogger(ExtensionSearch.class);
 
@@ -71,9 +71,9 @@
 	@Override
 	public void hook(ExtensionHook extensionHook) {
 	    super.hook(extensionHook);
+	    extensionHook.addSessionListener(this);
 	    extensionHook.addOptionsParamSet(getSearchParam());
 	    if (getView() != null) {
-	        extensionHook.addSessionListener(new ViewSessionChangedListener());
 	        extensionHook.getHookView().addOptionPanel(getOptionsPanel());
 	        extensionHook.getHookView().addStatusPanel(getSearchPanel());
 	        extensionHook.getHookMenu().addEditMenuItem(getMenuSearch());
@@ -143,6 +143,30 @@
         }
     }
 
+	@Override
+	public void sessionChanged(final Session session)  {
+	    if (EventQueue.isDispatchThread()) {
+		    sessionChangedEventHandler(session);
+
+	    } else {
+	        
+	        try {
+	            EventQueue.invokeAndWait(new Runnable() {
+	                @Override
+	                public void run() {
+	        		    sessionChangedEventHandler(session);
+	                }
+	            });
+	        } catch (Exception e) {
+	            logger.error(e.getMessage(), e);
+	        }
+	    }
+	}
+	
+	private void sessionChangedEventHandler(Session session) {
+		this.getSearchPanel().resetSearchResults();
+	}
+	
 	public void search(String filter, Type reqType) {
 		this.search(filter, reqType, false, false);
 	}
@@ -249,6 +273,14 @@
     }
 
 	@Override
+	public void sessionAboutToChange(Session session) {
+	}
+	
+	@Override
+	public void sessionScopeChanged(Session session) {
+	}
+
+	@Override
 	public String getAuthor() {
 		return Constant.ZAP_TEAM;
 	}
@@ -271,6 +303,11 @@
 		this.searchJustInScope = searchJustInScope;
 	}
 	
+	@Override
+	public void sessionModeChanged(Mode mode) {
+		// Ignore
+	}
+
 	/**
 	 * No database tables used, so all supported
 	 */
@@ -278,45 +315,4 @@
 	public boolean supportsDb(String type) {
 		return true;
 	}
-
-	/**
-	 * A {@code SessionChangedListener} for view/UI related functionalities.
-	 */
-	private class ViewSessionChangedListener implements SessionChangedListener {
-
-		@Override
-		public void sessionAboutToChange(Session session) {
-			// Nothing to do.
-		}
-
-		@Override
-		public void sessionScopeChanged(Session session) {
-			// Nothing to do.
-		}
-
-		@Override
-		public void sessionChanged(final Session session) {
-			if (EventQueue.isDispatchThread()) {
-				getSearchPanel().resetSearchResults();
-				return;
-			}
-
-			try {
-				EventQueue.invokeAndWait(new Runnable() {
-
-					@Override
-					public void run() {
-						sessionChanged(session);
-					}
-				});
-			} catch (Exception e) {
-				logger.error(e.getMessage(), e);
-			}
-		}
-
-		@Override
-		public void sessionModeChanged(Mode mode) {
-			// Nothing to do.
-		}
-	}
 }
\ No newline at end of file",1
[java] Fix concurrency error," import java.lang.reflect.Method;
 import java.lang.reflect.Type;
 import java.lang.reflect.TypeVariable;
+import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 import java.util.Set;
-import java.util.concurrent.ConcurrentHashMap;
 
 import org.apache.commons.lang3.ArrayUtils;
 
 
 public abstract class JavaTypeDefinition implements TypeDefinition {
     // contains non-generic and raw EXACT types
-    private static final Map<Class<?>, JavaTypeDefinition> CLASS_EXACT_TYPE_DEF_CACHE = new ConcurrentHashMap<>();
+    private static final Map<Class<?>, JavaTypeDefinition> CLASS_EXACT_TYPE_DEF_CACHE = new HashMap<>();
 
     private final TypeDefinitionType definitionType;
 ",1
Fix IngredientNBT comparing stackSize when checking if ingredient is valid,"     {
         if (input == null)
             return false;
-        //Can't use areItemStacksEqualUsingNBTShareTag because it compares stack size as well
-        return this.stack.getItem() == input.getItem() && this.stack.getItemDamage() == input.getItemDamage() && ItemStack.areItemStackShareTagsEqual(this.stack, input);
+        return ItemStack.areItemStacksEqualUsingNBTShareTag(this.stack, input);
     }
 }",1
Fix GE OSB actively traded price races," 	private static final int OFFER_CONTAINER_ITEM = 21;
 	private static final int OFFER_DEFAULT_ITEM_ID = 6512;
 	private static final GrandExchangeClient CLIENT = new GrandExchangeClient();
-	private static final String OSB_GE_TEXT = ""<br>OSBuddy Actively traded price: "";
 
 	static final String SEARCH_GRAND_EXCHANGE = ""Search Grand Exchange"";
 
@@ -126,6 +125,8 @@
 	private Widget grandExchangeText;
 	private Widget grandExchangeItem;
 
+	private int lastItem = -1;
+
 	@Provides
 	GrandExchangeConfig provideConfig(ConfigManager configManager)
 	{
@@ -161,8 +162,6 @@
 		clientToolbar.removeNavigation(button);
 		mouseManager.unregisterMouseListener(inputListener);
 		keyManager.unregisterKeyListener(inputListener);
-		grandExchangeText = null;
-		grandExchangeItem = null;
 	}
 
 	@Subscribe
@@ -271,14 +270,22 @@
 		{
 			// Grand exchange was opened.
 			case WidgetID.GRAND_EXCHANGE_GROUP_ID:
+				if (!config.enableOsbPrices())
+				{
+					return;
+				}
+
 				Widget grandExchangeOffer = client.getWidget(WidgetInfo.GRAND_EXCHANGE_OFFER_CONTAINER);
 				grandExchangeText = client.getWidget(WidgetInfo.GRAND_EXCHANGE_OFFER_TEXT);
 				grandExchangeItem = grandExchangeOffer.getDynamicChildren()[OFFER_CONTAINER_ITEM];
+				lastItem = -1;
 				break;
+
 			// Grand exchange was closed (if it was open before).
 			case WidgetID.INVENTORY_GROUP_ID:
 				grandExchangeText = null;
 				grandExchangeItem = null;
+				lastItem = -1;
 				break;
 		}
 	}
@@ -292,29 +299,38 @@
 		}
 
 		final Widget geText = grandExchangeText;
-		final String geTextString = geText.getText();
-		final int itemId = grandExchangeItem.getItemId();
 
-		if (itemId == OFFER_DEFAULT_ITEM_ID || itemId == -1)
+		if (!geText.getText().contains(""Actively traded price""))
 		{
-			// This item is invalid/nothing has been searched for
+			// searching for the same item twice without closing the search window will cause this.
+			lastItem = -1;
+		}
+
+		int itemId = grandExchangeItem.getItemId();
+		if (itemId == OFFER_DEFAULT_ITEM_ID
+			|| itemId == -1
+			|| lastItem == itemId)
+		{
 			return;
 		}
 
-		if (!config.enableOsbPrices() || geTextString.contains(OSB_GE_TEXT))
-		{
-			// OSB prices are disabled or price was already looked up, so no need to set it again
-			return;
-		}
+		lastItem = itemId;
 
-		log.debug(""Looking up OSB item price {}"", itemId);
+		log.debug(""Looking up item {}"", itemId);
 
 		executorService.submit(() ->
 		{
 			try
 			{
 				final GrandExchangeResult result = CLIENT.lookupItem(itemId);
-				final String text = geText.getText() + OSB_GE_TEXT + StackFormatter.formatNumber(result.getOverall_average());
+
+				if (result.getItem_id() != lastItem)
+				{
+					// something else has since been looked up?
+					return;
+				}
+
+				final String text = geText.getText() + ""<br>OSBuddy Actively traded price: "" + StackFormatter.formatNumber(result.getOverall_average());
 				geText.setText(text);
 			}
 			catch (IOException e)",1
Fix - getVariableInstancesLocal() returning non-local variables,"   }
   
   public Map<String, VariableInstance> getVariableInstancesLocal(String executionId, Collection<String> variableNames) {
-    return commandExecutor.execute(new GetExecutionVariableInstancesCmd(executionId, variableNames, true));
+    return commandExecutor.execute(new GetExecutionVariableInstancesCmd(executionId, variableNames, false));
   }
 
   public Map<String, VariableInstance> getVariableInstancesLocal(String executionId, Collection<String> variableNames, String locale, boolean withLocalizationFallback) {
-    return commandExecutor.execute(new GetExecutionVariableInstancesCmd(executionId, variableNames, true, locale, withLocalizationFallback));
+    return commandExecutor.execute(new GetExecutionVariableInstancesCmd(executionId, variableNames, false, locale, withLocalizationFallback));
   }
 
   public Object getVariable(String executionId, String variableName) {",1
Fix NPE in NettyConnectionsPool,"         this.sslConnectionPoolEnabled = sslConnectionPoolEnabled;
         this.maxIdleTime = maxIdleTime;
         this.maxConnectionLifeTimeInMs = maxConnectionLifeTimeInMs;
+        this.idleConnectionDetector.schedule(new IdleChannelDetector(), maxIdleTime, maxIdleTime);
         this.idleConnectionDetector = idleConnectionDetector;
-        this.idleConnectionDetector.schedule(new IdleChannelDetector(), maxIdleTime, maxIdleTime);
     }
 
     private static class IdleChannel {",1
Fix typo,"   }
 
   private void renderSeasonCounter(TvShow tvShow) {
-    String seasons = context.getString(R.string.seasons_counter, tvShow.getNumberOfSeasons());
-    seasonsCounterTextView.setText(seasons);
+    String seassons = context.getString(R.string.seasons_counter, tvShow.getNumberOfSeasons());
+    seasonsCounterTextView.setText(seassons);
   }
 }",1
Fixed typo causing the build to fail," import java.util.concurrent.CountDownLatch;
 
 import javax.net.ssl.SSLContext;
-import javax.net.ssl.SSLSocketFactory;
+import javax.net.ssl.SSLSocketFactory
 
 import org.java_websocket.AbstractWebSocket;
 import org.java_websocket.WebSocket;",1
#2436 Fix execution failed networktest.sh script,"     protected boolean check(InetSocketAddress address, byte[] requestData, byte[] expectedResponseData) {
         DatagramSocket socket = null;
         try {
-            socket = createSocket();
+            socket = createSocket(address);
 
-            write(socket, requestData, address);
+            write(socket, requestData);
             byte[] responseData = read(socket, expectedResponseData.length);
 
             return Arrays.equals(expectedResponseData, responseData);
@@ -57,13 +57,6 @@
         return false;
     }
 
-    private DatagramSocket createSocket() throws IOException {
-        DatagramSocket socket = new DatagramSocket();
-
-        socket.setSoTimeout(3000);
-        return socket;
-    }
-
     private DatagramSocket createSocket(InetSocketAddress socketAddress) throws IOException {
         DatagramSocket socket = new DatagramSocket();
         socket.connect(socketAddress);
@@ -72,8 +65,8 @@
         return socket;
     }
 
-    private void write(DatagramSocket socket, byte[] requestData, InetSocketAddress address) throws IOException {
-        DatagramPacket datagramPacket = new DatagramPacket(requestData, requestData.length, address);
+    private void write(DatagramSocket socket, byte[] requestData) throws IOException {
+        DatagramPacket datagramPacket = new DatagramPacket(requestData, requestData.length);
         socket.send(datagramPacket);
     }
 ",1
Fix typo in the private Slave#reportLauncherCreateError() method name,"             // RemoteLauncher requires an active Channel instance to operate correctly
             final Channel channel = c.getChannel();
             if (channel == null) { 
-                reportLauncherCreateError(""The agent has not been fully initialized yet"",
+                reportLauncerCreateError(""The agent has not been fully initialized yet"",
                                          ""No remoting channel to the agent OR it has not been fully initialized yet"", listener);
                 return new Launcher.DummyLauncher(listener);
             }
             if (channel.isClosingOrClosed()) {
-                reportLauncherCreateError(""The agent is being disconnected"",
+                reportLauncerCreateError(""The agent is being disconnected"",
                                          ""Remoting channel is either in the process of closing down or has closed down"", listener);
                 return new Launcher.DummyLauncher(listener);
             }
             final Boolean isUnix = c.isUnix();
             if (isUnix == null) {
                 // isUnix is always set when the channel is not null, so it should never happen
-                reportLauncherCreateError(""The agent has not been fully initialized yet"",
+                reportLauncerCreateError(""The agent has not been fully initialized yet"",
                                          ""Cannot determing if the agent is a Unix one, the System status request has not completed yet. "" +
                                          ""It is an invalid channel state, please report a bug to Jenkins if you see it."", 
                                          listener);
@@ -516,7 +516,7 @@
         }
     }
     
-    private void reportLauncherCreateError(@Nonnull String humanReadableMsg, @CheckForNull String exceptionDetails, @Nonnull TaskListener listener) {
+    private void reportLauncerCreateError(@Nonnull String humanReadableMsg, @CheckForNull String exceptionDetails, @Nonnull TaskListener listener) {
         String message = ""Issue with creating launcher for agent "" + name + "". "" + humanReadableMsg;
         listener.error(message);
         if (LOGGER.isLoggable(Level.WARNING)) {",1
Fixed NPE from missing World Capabilities,"     public void setCapabilities(WorldProvider provider, INBTSerializable<NBTTagCompound> capabilities)
     {
         this.serializable = capabilities;
-        if (this.capNBT != null && serializable != null)
+        if (this.capNBT != null)
         {
             serializable.deserializeNBT(this.capNBT);
             this.capNBT = null;",1
Fixes 1483 - Ensure that fullName is populated on the address from a paymentrequest,"         if (responseDTO.getBillTo() != null && isUseBillingAddressFromGateway()) {
             billingAddress = addressService.create();
             AddressDTO<PaymentResponseDTO> billToDTO = responseDTO.getBillTo();
-            populateAddressInfo(billingAddress, billToDTO);
+            billingAddress.setFirstName(billToDTO.getAddressFirstName());
+            billingAddress.setLastName(billToDTO.getAddressLastName());
+            billingAddress.setAddressLine1(billToDTO.getAddressLine1());
+            billingAddress.setAddressLine2(billToDTO.getAddressLine2());
+            billingAddress.setCity(billToDTO.getAddressCityLocality());
+
+            State state = null;
+            if(billToDTO.getAddressStateRegion() != null) {
+                state = stateService.findStateByAbbreviation(billToDTO.getAddressStateRegion());
+            }
+            if (state == null) {
+                LOG.warn(""The given state from the response: "" + billToDTO.getAddressStateRegion() + "" could not be found""
+                        + "" as a state abbreviation in BLC_STATE"");
+            }
+            billingAddress.setState(state);
+            billingAddress.setStateProvinceRegion(billToDTO.getAddressStateRegion());
+
+            billingAddress.setPostalCode(billToDTO.getAddressPostalCode());
+
+            Country country = null;
+            ISOCountry isoCountry = null;
+            if (billToDTO.getAddressCountryCode() != null) {
+                country = countryService.findCountryByAbbreviation(billToDTO.getAddressCountryCode());
+                isoCountry = isoService.findISOCountryByAlpha2Code(billToDTO.getAddressCountryCode());
+            }
+            if (country == null) {
+                LOG.warn(""The given country from the response: "" + billToDTO.getAddressCountryCode() + "" could not be found""
+                        + "" as a country abbreviation in BLC_COUNTRY"");
+            } else if (isoCountry == null) {
+                LOG.error(""The given country from the response: "" + billToDTO.getAddressCountryCode() + "" could not be found""
+                        + "" as a country alpha-2 code in BLC_ISO_COUNTRY"");
+            }
+
+            billingAddress.setCountry(country);
+            billingAddress.setIsoCountryAlpha2(isoCountry);
+
+            if (billToDTO.getAddressPhone() != null) {
+                Phone billingPhone = phoneService.create();
+                billingPhone.setPhoneNumber(billToDTO.getAddressPhone());
+                billingAddress.setPhonePrimary(billingPhone);
+            }
         }
 
         payment.setBillingAddress(billingAddress);
+
     }
 
     protected void populateShippingInfo(PaymentResponseDTO responseDTO, Order order) {
@@ -247,7 +288,48 @@
         if (responseDTO.getShipTo() != null && shippableFulfillmentGroup != null) {
             shippingAddress = addressService.create();
             AddressDTO<PaymentResponseDTO> shipToDTO = responseDTO.getShipTo();
-            populateAddressInfo(shippingAddress, shipToDTO);
+            shippingAddress.setFirstName(shipToDTO.getAddressFirstName());
+            shippingAddress.setLastName(shipToDTO.getAddressLastName());
+            shippingAddress.setAddressLine1(shipToDTO.getAddressLine1());
+            shippingAddress.setAddressLine2(shipToDTO.getAddressLine2());
+            shippingAddress.setCity(shipToDTO.getAddressCityLocality());
+            
+            State state = null;
+            if(shipToDTO.getAddressStateRegion() != null) {
+                state = stateService.findStateByAbbreviation(shipToDTO.getAddressStateRegion());
+            }
+            if (state == null) {
+                LOG.warn(""The given state from the response: "" + shipToDTO.getAddressStateRegion() + "" could not be found""
+                        + "" as a state abbreviation in BLC_STATE"");
+            }
+            shippingAddress.setState(state);
+            shippingAddress.setStateProvinceRegion(shipToDTO.getAddressStateRegion());
+
+            shippingAddress.setPostalCode(shipToDTO.getAddressPostalCode());
+
+            Country country = null;
+            ISOCountry isoCountry = null;
+            if (shipToDTO.getAddressCountryCode() != null) {
+                country = countryService.findCountryByAbbreviation(shipToDTO.getAddressCountryCode());
+                isoCountry = isoService.findISOCountryByAlpha2Code(shipToDTO.getAddressCountryCode());
+            }
+
+            if (country == null) {
+                LOG.warn(""The given country from the response: "" + shipToDTO.getAddressCountryCode() + "" could not be found""
+                        + "" as a country abbreviation in BLC_COUNTRY"");
+            } else if (isoCountry == null) {
+                LOG.error(""The given country from the response: "" + shipToDTO.getAddressCountryCode() + "" could not be found""
+                        + "" as a country alpha-2 code in BLC_ISO_COUNTRY"");
+            }
+
+            shippingAddress.setCountry(country);
+            shippingAddress.setIsoCountryAlpha2(isoCountry);
+
+            if (shipToDTO.getAddressPhone() != null) {
+                Phone shippingPhone = phoneService.create();
+                shippingPhone.setPhoneNumber(shipToDTO.getAddressPhone());
+                shippingAddress.setPhonePrimary(shippingPhone);
+            }
 
             shippableFulfillmentGroup = fulfillmentGroupService.findFulfillmentGroupById(shippableFulfillmentGroup.getId());
             if (shippableFulfillmentGroup != null) {
@@ -257,51 +339,6 @@
         }
     }
 
-    protected void populateAddressInfo(Address address, AddressDTO<PaymentResponseDTO> dto) {
-        address.setFirstName(dto.getAddressFirstName());
-        address.setLastName(dto.getAddressLastName());
-        address.setFullName(dto.getAddressFirstName() + "" "" + dto.getAddressLastName());
-        address.setAddressLine1(dto.getAddressLine1());
-        address.setAddressLine2(dto.getAddressLine2());
-        address.setCity(dto.getAddressCityLocality());
-
-        State state = null;
-        if(dto.getAddressStateRegion() != null) {
-            state = stateService.findStateByAbbreviation(dto.getAddressStateRegion());
-        }
-        if (state == null) {
-            LOG.warn(""The given state from the response: "" + dto.getAddressStateRegion() + "" could not be found""
-                    + "" as a state abbreviation in BLC_STATE"");
-        }
-        address.setState(state);
-        address.setStateProvinceRegion(dto.getAddressStateRegion());
-
-        address.setPostalCode(dto.getAddressPostalCode());
-
-        Country country = null;
-        ISOCountry isoCountry = null;
-        if (dto.getAddressCountryCode() != null) {
-            country = countryService.findCountryByAbbreviation(dto.getAddressCountryCode());
-            isoCountry = isoService.findISOCountryByAlpha2Code(dto.getAddressCountryCode());
-        }
-        if (country == null) {
-            LOG.warn(""The given country from the response: "" + dto.getAddressCountryCode() + "" could not be found""
-                    + "" as a country abbreviation in BLC_COUNTRY"");
-        } else if (isoCountry == null) {
-            LOG.error(""The given country from the response: "" + dto.getAddressCountryCode() + "" could not be found""
-                    + "" as a country alpha-2 code in BLC_ISO_COUNTRY"");
-        }
-
-        address.setCountry(country);
-        address.setIsoCountryAlpha2(isoCountry);
-
-        if (dto.getAddressPhone() != null) {
-            Phone billingPhone = phoneService.create();
-            billingPhone.setPhoneNumber(dto.getAddressPhone());
-            address.setPhonePrimary(billingPhone);
-        }
-    }
-
     /**
      * This default implementation will mark the entire payment as invalid and boot the user to re-enter their
      * billing info and payment information as there may be an error with either the billing address or credit card.",1
fix bug in selection sort - pass-by-value vs pass-by-reference problem,"     public static int[] sort(int[] arr) {
         for (int i = 0; i < arr.length; i++) {
             int min = findMinIndex(arr, i);
-            swap(arr, i, min);
+            swap(arr, arr[i], min);
         }
         return arr;
     }
 
     private static void swap(int[] arr, int i, int min) {
-        int tmp = arr[i];
-        arr[i] = arr[min];
+        int tmp = i;
+        i = arr[min];
         arr[min] = tmp;
     }
 ",1
Introduce Transactional boundary for this service to ensure that the pricingWorkflow's activities take effect,"  */
 package org.broadleafcommerce.core.pricing.service;
 
+import javax.annotation.Resource;
+
 import org.broadleafcommerce.core.order.domain.Order;
 import org.broadleafcommerce.core.pricing.service.exception.PricingException;
 import org.broadleafcommerce.core.workflow.ProcessContext;
 import org.broadleafcommerce.core.workflow.Processor;
 import org.broadleafcommerce.core.workflow.WorkflowException;
 import org.springframework.stereotype.Service;
-import org.springframework.transaction.annotation.Transactional;
-
-import javax.annotation.Resource;
 
 @Service(""blPricingService"")
 public class PricingServiceImpl implements PricingService {
@@ -33,7 +32,6 @@
     @Resource(name=""blPricingWorkflow"")
     protected Processor pricingWorkflow;
 
-    @Transactional
     public Order executePricing(Order order) throws PricingException {
         try {
             ProcessContext<Order> context = (ProcessContext<Order>) pricingWorkflow.doActivities(order);",1
Bug fix - Shuffle button remains white until pressed ,"         shuffleTracks = DrawableCompat.wrap(ContextCompat.getDrawable(context, R.drawable.ic_shuffle_24dp_scaled)).mutate();
 
         setShuffleMode(QueueManager.ShuffleMode.OFF);
-        setImageDrawable(shuffleOff);
     }
 
     public void setShuffleMode(@QueueManager.ShuffleMode int shuffleMode) {",1
fixes correct releasing of upstream listeners at the PageDownstreamContext,"         // can't trigger failure on pageDownstream immediately as it would remove the context which the other
         // upstreams still require
 
-        exhausted.set(bucketIdx);
+        setExhaustedUpstreams();
         if (bucketsByIdx.size() == numBuckets) {
             rowReceiver.fail(throwable);
             releaseListenersAndCloseContext(throwable);
         } else {
             lastThrowable = throwable;
         }
+        exhausted.set(bucketIdx);
     }
 
     /**",1
Fix typo,"    *         size differs from the average among those patterns the least
    * @throws NotFoundException if 3 such finder patterns do not exist
    */
-  private FinderPattern[][] selectMultipleBestPatterns() throws NotFoundException {
+  private FinderPattern[][] selectMutipleBestPatterns() throws NotFoundException {
     List<FinderPattern> possibleCenters = getPossibleCenters();
     int size = possibleCenters.size();
 
@@ -282,7 +282,7 @@
         handlePossibleCenter(stateCount, i, maxJ);
       }
     } // for i=iSkip-1 ...
-    FinderPattern[][] patternInfo = selectMultipleBestPatterns();
+    FinderPattern[][] patternInfo = selectMutipleBestPatterns();
     List<FinderPatternInfo> result = new ArrayList<>();
     for (FinderPattern[] pattern : patternInfo) {
       ResultPoint.orderBestPatterns(pattern);",1
SortedSet.unzip3 overridden," package javaslang.collection;
 
 import javaslang.Tuple2;
-import javaslang.Tuple3;
 import javaslang.control.Option;
 
 import java.util.Comparator;
@@ -202,9 +201,6 @@
     <T1, T2> Tuple2<? extends SortedSet<T1>, ? extends SortedSet<T2>> unzip(Function<? super T, Tuple2<? extends T1, ? extends T2>> unzipper);
 
     @Override
-    <T1, T2, T3> Tuple3<? extends SortedSet<T1>, ? extends SortedSet<T2>, ? extends SortedSet<T3>> unzip3(Function<? super T, Tuple3<? extends T1, ? extends T2, ? extends T3>> unzipper);
-
-    @Override
     <U> SortedSet<Tuple2<T, U>> zip(Iterable<? extends U> that);
 
     @Override",1
Update Drawer.xml to consider mFooterDivider,"             }
         }
 
-        // set the footer (do this before the setAdapter because some devices will crash else
+        // set the header (do this before the setAdapter because some devices will crash else
         if (mFooterView != null) {
             if (mListView == null) {
                 throw new RuntimeException(""can't use a footerView without a listView"");
             }
 
-            if (mFooterDivider) {
+            if (mHeaderDivider) {
                 LinearLayout footerContainer = (LinearLayout) mActivity.getLayoutInflater().inflate(R.layout.drawer_item_footer, mListView, false);
                 footerContainer.addView(mFooterView, 1);
                 mListView.addFooterView(footerContainer);",1
Added Iterator.concat(java.util.Iterator). Fixes #570," 
     // -- Additional methods of Iterator
 
-    // DEV-NOTE: cannot use arg java.lang.Iterable, it would be ambiguous
-    default Iterator<T> concat(java.util.Iterator<T> that) {
-        Objects.requireNonNull(that, ""that is null"");
-        if (!that.hasNext()) {
-            return this;
-        } else if (!hasNext()) {
-            return Iterator.ofAll(that);
-        } else {
-            return Iterator.concat(this, Iterator.ofAll(that));
-        }
-    }
-
     /**
      * Inserts an element between all elements of this Iterator.
      *",1
Fixes crash when not specifying a @WithModule annotation with the ScreenScoper,"   public MortarScope getScreenScope(Resources resources, MortarScope parentScope, final String name,
       final Object screen) {
     ModuleFactory moduleFactory = getModuleFactory(screen);
-    Object[] childModule;
+    Object childModule;
     if (moduleFactory != NO_FACTORY) {
-      childModule = new Object[]{ moduleFactory.createDaggerModule(resources, screen) };
+      childModule = moduleFactory.createDaggerModule(resources, screen);
     } else {
       // We need every screen to have a scope, so that anything it injects is scoped.  We need
       // this even if the screen doesn't declare a module, because Dagger allows injection of
       // objects that are annotated even if they don't appear in a module.
-      childModule = new Object[0];
+      childModule = null;
     }
 
     MortarScope childScope = parentScope.findChild(name);",1
Prevent NPE from Java 8 lambdas in ClassTransformers," 
     @Override
     public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {
-        // Synthetic classes, e.g. from lambda resolution, may have no name
-        if (className == null) {
-            return null;
-        }
-
         String convertedClassName = className.replace('/', '.');
         
         if (isIgnored(convertedClassName)) {",1
Fixes bosh url encoding of params,"             logger.error(""Failed to connect to XMPP service"", ex);
 
             // server disconnect us after such an error, do cleanup
-            // as we maybe will try again
             disconnectAndCleanConnection();
 
-            // in case this is the last try connecting store the error
-            eventDuringLogin = new RegistrationStateChangeEvent(
-                this,
-                getRegistrationState(),
-                RegistrationState.CONNECTION_FAILED,
-                RegistrationStateChangeEvent.REASON_INTERNAL_ERROR,
-                ex.getMessage());
-
+            // FIXME
             return ConnectState.CONTINUE_TRYING;
         }
     }
@@ -1164,8 +1156,7 @@
                 }
 
                 String file = boshURI.getPath();
-                // use rawQuery as getQuery() decodes the string
-                String query = boshURI.getRawQuery();
+                String query = boshURI.getQuery();
                 if (!StringUtils.isNullOrEmpty(query))
                 {
                     file += ""?"" + query;",1
Fix incorrect alphanumeric sorting of upgrade scripts that can cause them to be applied in the wrong order," import java.io.OutputStream;
 import java.util.ArrayList;
 import java.util.Collections;
-import java.util.Comparator;
 import java.util.Scanner;
-import java.util.regex.Matcher;
-import java.util.regex.Pattern;
 import java.util.zip.ZipEntry;
 import java.util.zip.ZipInputStream;
 
@@ -315,7 +312,7 @@
 			throw new SQLiteAssetException(""no upgrade script path from "" + oldVersion + "" to "" + newVersion);
 		}
 		
-		Collections.sort(paths, new VersionComparator());
+		Collections.sort(paths);
 		for (String path : paths) {
 			try {
 				Log.w(TAG, ""processing upgrade: "" + path);
@@ -461,73 +458,4 @@
 	    return new Scanner(is).useDelimiter(""\\A"").next();
 	}
 
-	/**
-	 * Compare paths by their upgrade version numbers, instead of using
-	 * alphanumeric comparison on plain file names. This prevents the upgrade
-	 * scripts from being applied out of order when they first move to double-,
-	 * triple-, etc. digits.
-	 * <p>
-	 * For example, this fixes an upgrade that would apply 2 different upgrade
-	 * files from version 9 to 11 (<code>..._updated_9_10</code> and
-	 * <code>..._updated_10_11</code>) from using the <em>incorrect</em>
-	 * alphanumeric order of <code>10_11</code> before <code>9_10</code>.
-	 * </p>
-	 */
-	private class VersionComparator implements Comparator<String> {
-		private Pattern pattern = Pattern
-				.compile("".*_upgrade_([0-9]+)-([0-9]+).*"");
-
-		/**
-		 * Compares the two specified upgrade script strings to determine their
-		 * relative ordering considering their two version numbers. Assumes all
-		 * database names used are the same, as this function only compares the
-		 * two version numbers.
-		 * 
-		 * @param file0
-		 *            an upgrade script file name
-		 * @param file1
-		 *            a second upgrade script file name to compare with file0
-		 * @return an integer < 0 if file0 should be applied before file1, 0 if
-		 *         they are equal (though that shouldn't happen), and > 0 if
-		 *         file0 should be applied after file1.
-		 * 
-		 * @exception SQLiteAssetException
-		 *                thrown if the strings are not in the correct upgrade
-		 *                script format of:
-		 *                <code>databasename_fromVersionInteger_toVersionInteger</code>
-		 */
-		@Override
-		public int compare(String file0, String file1) {
-			Matcher m0 = pattern.matcher(file0);
-			Matcher m1 = pattern.matcher(file1);
-
-			if (!m0.matches()) {
-				Log.w(TAG, ""could not parse upgrade script file: "" + file0);
-				throw new SQLiteAssetException(""Invalid upgrade script file"");
-			}
-
-			if (!m1.matches()) {
-				Log.w(TAG, ""could not parse upgrade script file: "" + file1);
-				throw new SQLiteAssetException(""Invalid upgrade script file"");
-			}
-
-			int v0_from = Integer.valueOf(m0.group(1));
-			int v1_from = Integer.valueOf(m1.group(1));
-			int v0_to = Integer.valueOf(m0.group(2));
-			int v1_to = Integer.valueOf(m1.group(2));
-
-			if (v0_from == v1_from) {
-				// 'from' versions match for both; check 'to' version next
-
-				if (v0_to == v1_to) {
-					return 0;
-				}
-
-				return v0_to < v1_to ? -1 : 1;
-			}
-
-			return v0_from < v1_from ? -1 : 1;
-		}
-	}
-
 }",1
word mixup in docu: name instead of group,"  * Uniquely identifies a {@link JobDetail}.
  * 
  * <p>Keys are composed of both a name and group, and the name must be unique
- * within the group.  If only a name is specified then the default group
+ * within the group.  If only a group is specified then the default group
  * name will be used.</p> 
  *
  * <p>Quartz provides a builder-style API for constructing scheduling-related",1
Flip NettyResponse's BodyPart ByteBuffer,"         for (HttpResponseBodyPart part : bodyParts)
             target.put(part.getBodyPartBytes());
 
-        target.flip();
         return target;
     }
 ",1
Fixes leaks with managers (#1336)," 	 */
 	public void registerRenderer(RajawaliRenderer renderer)
 	{
-        boolean alreadyRegistered = false;
-
-        for (int i=0;i<mRenderers.size();i++) {
-            if (renderer == mRenderers.get(i)) {
-                alreadyRegistered = true;
-                break;
-            }
-        }
-
-        if (!alreadyRegistered) {
 		mRenderers.add(renderer);
-        }
-        
 		mRenderer = renderer;
 	}
 ",1
Fix invalid position being used when touch focus is cancelled in Slider," 			public void touchUp (InputEvent event, float x, float y, int pointer, int button) {
 				if (pointer != draggingPointer) return;
 				draggingPointer = -1;
-				// The position is invalid when focus is cancelled
-				if (event.isTouchFocusCancel() || !calculatePositionAndValue(x, y)) {
+				if (!calculatePositionAndValue(x, y)) {
 					// Fire an event on touchUp even if the value didn't change, so listeners can see when a drag ends via isDragging.
 					ChangeEvent changeEvent = Pools.obtain(ChangeEvent.class);
 					fire(changeEvent);",1
PUBDEV-4857: Fix the way proxy propagates auth headers to H2O Node," 
     @Override
     protected void customizeExchange(HttpExchange exchange, HttpServletRequest request) {
-      exchange.setRequestHeader(""Authorization"", _basicAuth);
+      exchange.addRequestHeader(""Authorization"", _basicAuth);
     }
   }
 ",1
Site Map Generator Configurations set up to work with Multi-Tenant," 
 package org.broadleafcommerce.common.sitemap.domain;
 
-import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
-import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
-import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
 import org.broadleafcommerce.common.presentation.AdminPresentation;
 import org.broadleafcommerce.common.presentation.AdminPresentationClass;
 import org.broadleafcommerce.common.presentation.client.SupportedFieldType;
@@ -51,9 +48,6 @@
 @Inheritance(strategy = InheritanceType.JOINED)
 //@Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = ""blConfigurationModuleElements"")
 @AdminPresentationClass(friendlyName = ""SiteMapGeneratorConfigurationImpl"")
-@DirectCopyTransform({
-    @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE)
-})
 public class SiteMapGeneratorConfigurationImpl implements SiteMapGeneratorConfiguration {
 
     private static final long serialVersionUID = 1L;",1
Fix for #1849," 
 import java.io.IOException;
 import java.nio.ByteBuffer;
-import java.security.AccessController;
-import java.security.PrivilegedActionException;
-import java.security.PrivilegedExceptionAction;
 
 /**
  *
@@ -39,7 +36,7 @@
 
     public OggStreamingSoundData(AssetDataFile stream) throws IOException {
         this.stream = stream;
-        reset();
+        reader = new OggReader(stream.openStream());
     }
 
     @Override
@@ -74,8 +71,8 @@
             dispose();
         }
         try {
-           reader = AccessController.doPrivileged((PrivilegedExceptionAction<OggReader>) () -> new OggReader(stream.openStream()));
-        } catch (PrivilegedActionException e) {
+            reader = new OggReader(stream.openStream());
+        } catch (IOException e) {
             throw new RuntimeException(""Failed to reset ogg stream"", e);
         }
     }",1
Add debug log of the measurement result details.,"             measureResult.addMeasureDetail(measureResultDetail);
         }
 
-        logMeasureResult(measureResult, timeWindow, leastWindowCount, averageExceptionRate,
-            leastWindowExceptionRateMultiple);
-
         InvocationStatFactory.updateInvocationStats(invocationStats);
         return measureResult;
     }
 
     /**
-     * Print the measurement result details for each time window.
-     * @param measureResult
-     * @param timeWindow
-     * @param leastWindowCount
-     * @param averageExceptionRate
-     * @param leastWindowExceptionRateMultiple
-     */
-    private void logMeasureResult(MeasureResult measureResult, long timeWindow, long leastWindowCount,
-                                  double averageExceptionRate,
-                                  double leastWindowExceptionRateMultiple) {
-        if (measureResult == null) {
-            return;
-        }
-
-        MeasureModel measureModel = measureResult.getMeasureModel();
-        String appName = measureModel.getAppName();
-        if (!LOGGER.isDebugEnabled(appName)) {
-            return;
-        }
-
-        String service = measureModel.getService();
-        List<InvocationStat> stats = measureModel.getInvocationStats();
-        List<MeasureResultDetail> details = measureResult.getAllMeasureResultDetails();
-
-        StringBuilder info = new StringBuilder();
-
-        info.append(""measure info: service["" + service + ""];stats{"");
-        for (InvocationStat stat : stats) {
-            info.append(stat.getDimension().getIp());
-            info.append("","");
-        }
-        if (stats.size() > 0) {
-            info.deleteCharAt(info.length() - 1);
-        }
-        info.append(""};details{"");
-
-        info.append(""timeWindow["" + timeWindow + ""];leastWindowCount["" + leastWindowCount + ""];averageExceptionRate["" +
-            averageExceptionRate
-            + ""];leastWindowExceptionRateMultiple["" + leastWindowExceptionRateMultiple + ""];"");
-        info.append(""detail["");
-        for (MeasureResultDetail detail : details) {
-
-            String ip = detail.getInvocationStatDimension().getIp();
-            double abnormalRate = detail.getAbnormalRate();
-            long invocationLeastWindowCount = detail.getLeastWindowCount();
-            String measureState = detail.getMeasureState().name();
-
-            info.append(""(ip:"" + ip + "",abnormalRate:"" + abnormalRate + "",invocationLeastWindowCount:"" +
-                invocationLeastWindowCount
-                + "",measureState:"" + measureState + "")"");
-        }
-        info.append(""]"");
-
-        LOGGER.debugWithApp(appName, info.toString());
-    }
-
-    /**
      * 对批量Invocation对应的InvocationStat进行一个快照
      *
      * @param stats Dimensions of invocation statistics",1
Bug Fix: RSA segmentation encrypt and decrypt with chinese," package com.xiaoleilu.hutool.crypto.asymmetric;
 
-import java.io.ByteArrayOutputStream;
 import java.math.BigInteger;
 import java.nio.charset.Charset;
 import java.security.Key;
@@ -15,6 +14,7 @@
 import com.xiaoleilu.hutool.crypto.CryptoException;
 import com.xiaoleilu.hutool.crypto.SecureUtil;
 import com.xiaoleilu.hutool.lang.BCD;
+import com.xiaoleilu.hutool.util.ArrayUtil;
 import com.xiaoleilu.hutool.util.CharsetUtil;
 import com.xiaoleilu.hutool.util.StrUtil;
 
@@ -134,36 +134,24 @@
 	 */
 	public String encryptStr(String data, KeyType keyType, Charset charset) {
 		Key key = getKeyByType(keyType);
+		// 模长
+		int keyLength = ((RSAKey) key).getModulus().bitLength() / 8;
+		StringBuilder sb = StrUtil.builder();
+		lock.lock();
+		try {
+			clipher.init(Cipher.ENCRYPT_MODE, key);
 			// 加密数据长度 <= 模长-11
-		int MAX_ENCRYPT_BLOCK = ((RSAKey) key).getModulus().bitLength() / 8 - 11;
-		byte[] dataBytes = StrUtil.bytes(data, charset);
-		lock.lock();
-		try (
-				ByteArrayOutputStream out = new ByteArrayOutputStream();
-		) {
-			clipher.init(Cipher.ENCRYPT_MODE, key);
-			int inputLen = dataBytes.length;
-			int offSet = 0;
-			byte[] cache;
-			int i = 0;
-			// 对数据分段加密
-			while (dataBytes.length - offSet > 0) {
-				if (inputLen - offSet > MAX_ENCRYPT_BLOCK) {
-					cache = clipher.doFinal(dataBytes, offSet, MAX_ENCRYPT_BLOCK);
-				} else {
-					cache = clipher.doFinal(dataBytes, offSet, inputLen - offSet);
+			String[] datas = StrUtil.split(data, keyLength - 11);
+			// 如果明文长度大于模长-11则要分组加密
+			for (String s : datas) {
+				sb.append(BCD.bcdToStr(clipher.doFinal(StrUtil.bytes(s, charset))));
 			}
-				out.write(cache, 0, cache.length);
-				i++;
-				offSet = i * MAX_ENCRYPT_BLOCK;
-			}
-			byte[] encryptedData = out.toByteArray();
-			return BCD.bcdToStr(encryptedData);
 		} catch (Exception e) {
 			throw new CryptoException(e);
 		}finally{
 			lock.unlock();
 		}
+		return sb.toString();
 	}
 	
 	/**
@@ -189,34 +177,23 @@
 	public String decryptStr(String data, KeyType keyType, Charset charset) {
 		Key key = getKeyByType(keyType);
 		// 模长
-		int MAX_DECRYPT_BLOCK = ((RSAKey) key).getModulus().bitLength() / 8;
-		byte[] dataBytes = BCD.ascToBcd(StrUtil.bytes(data, charset));
+		int keyLength = ((RSAKey) key).getModulus().bitLength() / 8;
+		StringBuilder sb = StrUtil.builder();
 		lock.lock();
-		try (
-				ByteArrayOutputStream out = new ByteArrayOutputStream();
-		) {
+		try {
 			clipher.init(Cipher.DECRYPT_MODE, key);
-			int inputLen = dataBytes.length;
-			int offSet = 0;
-			byte[] cache;
-			int i = 0;
-			// 对数据分段解密
-			while (inputLen - offSet > 0) {
-				if (inputLen - offSet > MAX_DECRYPT_BLOCK) {
-					cache = clipher.doFinal(dataBytes, offSet, MAX_DECRYPT_BLOCK);
-				} else {
-					cache = clipher.doFinal(dataBytes, offSet, inputLen - offSet);
+			// 加密数据长度 <= 模长-11
+			byte[] bcd = BCD.ascToBcd(StrUtil.bytes(data, charset));
+			// 如果密文长度大于模长则要分组解密
+			byte[][] arrays = ArrayUtil.split(bcd, keyLength);
+			for (byte[] arr : arrays) {
+				sb.append(StrUtil.str(clipher.doFinal(arr), charset));
 			}
-				out.write(cache, 0, cache.length);
-				i++;
-				offSet = i * MAX_DECRYPT_BLOCK;
-			}
-			byte[] decryptedData = out.toByteArray();
-			return StrUtil.str(decryptedData, charset);
 		} catch (Exception e) {
 			throw new CryptoException(e);
 		}finally{
 			lock.unlock();
 		}
+		return sb.toString();
 	}
 }",1
Fix bug on println(CoNLLWord),"     public String toString()
     {
         final StringBuilder sb = new StringBuilder();
-        // ID为0时为根节点，ID为-1时为空白节点
-        if (ID!=0 && ID!=-1){
         sb.append(ID).append('\t').append(LEMMA).append('\t').append(LEMMA).append('\t').append(CPOSTAG).append('\t')
                 .append(POSTAG).append('\t').append('_').append('\t').append(HEAD.ID).append('\t').append(DEPREL).append('\t')
                 .append('_').append('\t').append('_');
-        } else {
-            sb.append(ID).append('\t').append(LEMMA).append('\t').append(LEMMA).append('\t').append(CPOSTAG).append('\t')
-                .append(POSTAG).append('\t').append('_').append('\t').append('_').append('\t').append(DEPREL).append('\t')
-                .append('_').append('\t').append('_');  
-        }
         return sb.toString();
     }
 }",1
JENKINS-17508 possible fix,"     }
 
     @Override
-    public synchronized void deleteArtifacts() throws IOException {
-    	super.deleteArtifacts();
-    	for (List<MavenBuild> list : getModuleBuilds().values())
-            for (MavenBuild build : list)
-                build.deleteArtifacts();
-    }
-    
-    @Override
     public Object getDynamic(String token, StaplerRequest req, StaplerResponse rsp) {
         // map corresponding module build under this object
         if(token.indexOf('$')>0) {",1
fix #774," import java.util.concurrent.locks.ReentrantLock;
 
 public class ZookeeperRegistry extends CommandFailbackRegistry implements Closable {
+    private ZkClient zkClient;
+    private Set<URL> availableServices = new ConcurrentHashSet<URL>();
+    private ConcurrentHashMap<URL, ConcurrentHashMap<ServiceListener, IZkChildListener>> serviceListeners = new ConcurrentHashMap<URL, ConcurrentHashMap<ServiceListener, IZkChildListener>>();
+    private ConcurrentHashMap<URL, ConcurrentHashMap<CommandListener, IZkDataListener>> commandListeners = new ConcurrentHashMap<URL, ConcurrentHashMap<CommandListener, IZkDataListener>>();
     private final ReentrantLock clientLock = new ReentrantLock();
     private final ReentrantLock serverLock = new ReentrantLock();
-    private ZkClient zkClient;
-    private Set<URL> availableServices = new ConcurrentHashSet<>();
-    private ConcurrentHashMap<URL, ConcurrentHashMap<ServiceListener, IZkChildListener>> serviceListeners = new ConcurrentHashMap<>();
-    private ConcurrentHashMap<URL, ConcurrentHashMap<CommandListener, IZkDataListener>> commandListeners = new ConcurrentHashMap<>();
     
     public ZookeeperRegistry(URL url, ZkClient client) {
         super(url);
@@ -94,13 +94,9 @@
                 zkChildListener = childChangeListeners.get(serviceListener);
             }
 
-            try {
             // 防止旧节点未正常注销
             removeNode(url, ZkNodeType.CLIENT);
             createNode(url, ZkNodeType.CLIENT);
-            } catch (Exception e) {
-                LoggerUtil.warn(""[ZookeeperRegistry] subscribe service: create node error, path=%s, msg=%s"", ZkUtils.toNodePath(url, ZkNodeType.CLIENT), e.getMessage());
-            }
 
             String serverTypePath = ZkUtils.toNodeTypePath(url, ZkNodeType.AVAILABLE_SERVER);
             zkClient.subscribeChildChanges(serverTypePath, zkChildListener);
@@ -191,7 +187,7 @@
     protected List<URL> discoverService(URL url) {
         try {
             String parentPath = ZkUtils.toNodeTypePath(url, ZkNodeType.AVAILABLE_SERVER);
-            List<String> currentChilds = new ArrayList<>();
+            List<String> currentChilds = new ArrayList<String>();
             if (zkClient.exists(parentPath)) {
                 currentChilds = zkClient.getChildren(parentPath);
             }
@@ -288,7 +284,7 @@
     }
 
     private List<URL> nodeChildsToUrls(URL url, String parentPath, List<String> currentChilds) {
-        List<URL> urls = new ArrayList<>();
+        List<URL> urls = new ArrayList<URL>();
         if (currentChilds != null) {
             for (String node : currentChilds) {
                 String nodePath = parentPath + MotanConstants.PATH_SEPARATOR + node;",1
min max scaler range fix,"         // scale by dataset range
         theFeatures.diviRowVector(maxMinusMin);
         // scale by given or default feature range
-        theFeatures.muli(maxRange - minRange + Nd4j.EPS_THRESHOLD);
+        theFeatures.divi(maxRange - minRange + Nd4j.EPS_THRESHOLD);
         // offset by given min feature value
         theFeatures.addi(minRange);
     }
@@ -120,7 +120,7 @@
         if (min == null || max == null) throw new RuntimeException(""API_USE_ERROR: Preprocessors have to be explicitly fit before use. Usage: .fit(dataset) or .fit(datasetiterator)"");
 
         toPreProcess.getFeatures().subi(minRange);
-        toPreProcess.getFeatures().divi(maxRange - minRange + Nd4j.EPS_THRESHOLD);
+        toPreProcess.getFeatures().muli(maxRange - minRange + Nd4j.EPS_THRESHOLD);
         toPreProcess.getFeatures().muliRowVector(maxMinusMin);
         toPreProcess.getFeatures().addiRowVector(min);
     }",1
Fix TestingConnectorContext.getTypeManager," 
 import com.facebook.presto.GroupByHashPageIndexerFactory;
 import com.facebook.presto.PagesIndexPageSorter;
-import com.facebook.presto.block.BlockEncodingManager;
 import com.facebook.presto.connector.ConnectorAwareNodeManager;
 import com.facebook.presto.connector.ConnectorId;
-import com.facebook.presto.metadata.FunctionRegistry;
 import com.facebook.presto.metadata.InMemoryNodeManager;
 import com.facebook.presto.operator.PagesIndex;
 import com.facebook.presto.spi.NodeManager;
@@ -26,7 +24,6 @@
 import com.facebook.presto.spi.PageSorter;
 import com.facebook.presto.spi.connector.ConnectorContext;
 import com.facebook.presto.spi.type.TypeManager;
-import com.facebook.presto.sql.analyzer.FeaturesConfig;
 import com.facebook.presto.sql.gen.JoinCompiler;
 import com.facebook.presto.type.TypeRegistry;
 
@@ -38,12 +35,6 @@
     private final PageSorter pageSorter = new PagesIndexPageSorter(new PagesIndex.TestingFactory());
     private final PageIndexerFactory pageIndexerFactory = new GroupByHashPageIndexerFactory(new JoinCompiler());
 
-    public TestingConnectorContext()
-    {
-        // associate typeManager with a function registry
-        new FunctionRegistry(typeManager, new BlockEncodingManager(typeManager), new FeaturesConfig());
-    }
-
     @Override
     public NodeManager getNodeManager()
     {",1
Fixed typo in Draft_6455," 					throw new InvalidDataException( CloseFrame.NO_UTF8 );
 				}
 			}
-			//Checking if the current continuous frame contains a correct payload with the other frames combined
+			//Checking if the current continous frame contains a correct payload with the other frames combined
 			if( curop == Framedata.Opcode.CONTINUOUS && current_continuous_frame != null ) {
 				byteBufferList.add( frame.getPayloadData() );
 			}",1
fixes crash with completing and un-completing todo items,"     }
 
     public Builder complete(boolean complete) {
-      values.put(COMPLETE, complete ? Db.BOOLEAN_TRUE : Db.BOOLEAN_FALSE);
+      values.put(COMPLETE, complete);
       return this;
     }
 ",1
Fix AnimationItemOverrideList not falling back to super,"             IModelState state = asm.apply(Animation.getWorldTime(world, Animation.getPartialTickTime())).getLeft();
             return model.bake(new ModelStateComposition(state, this.state), format, bakedTextureGetter);
         }
-        return super.handleItemState(originalModel, stack, world, entity);
+        return originalModel;
     }
 }",1
Fixed bottom tab bar animation setting the wrong value,"             animator.start();
         } else {
             view.setTranslationY(SHOW_END_VALUE);
+            view.setY(SHOW_END_VALUE);
             view.setVisibility(View.VISIBLE);
         }
     }
@@ -56,6 +57,7 @@
             animator.start();
         } else {
             view.setTranslationY(hiddenEndValue);
+            view.setY(hiddenEndValue);
             view.setVisibility(View.GONE);
         }
     }",1
Fixed long presses being handled incorrectly.," 	private final Task longPressTask = new Task() {
 		@Override
 		public void run () {
-			longPressFired = listener.longPress(pointer1.x, pointer1.y);
+			if (listener.longPress(pointer1.x, pointer1.y)) longPressFired = true;
 		}
 	};
 
@@ -128,7 +128,7 @@
 
 	public boolean touchDragged (float x, float y, int pointer) {
 		if (pointer > 1) return false;
-		if (longPressFired) return true;
+		if (longPressFired) return false;
 
 		if (pointer == 0)
 			pointer1.set(x, y);
@@ -175,7 +175,7 @@
 
 		longPressTask.cancel();
 		panning = false;
-		if (longPressFired) return true;
+		if (longPressFired) return false;
 		if (inTapSquare) {
 			// handle taps
 			if (lastTapButton != button || lastTapPointer != pointer || TimeUtils.nanoTime() - lastTapTime > tapCountInterval",1
polish code and fix some documentation errors," import org.apache.dubbo.rpc.RpcException;
 
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.List;
 import java.util.Optional;
 import java.util.Set;
@@ -70,10 +69,11 @@
 
     private final String root;
 
-    private final Set<String> anyServices = new ConcurrentHashSet<>();
+    private final Set<String> anyServices = new ConcurrentHashSet<String>();
 
     private final ConcurrentMap<URL, ConcurrentMap<NotifyListener, ChildListener>> etcdListeners = new ConcurrentHashMap<>();
     private final EtcdClient etcdClient;
+    private long expirePeriod;
 
     public EtcdRegistry(URL url, EtcdTransporter etcdTransporter) {
         super(url);
@@ -121,7 +121,7 @@
         } catch (Throwable e) {
             throw new RpcException(""Failed to register "" + url + "" to etcd "" + getUrl()
                     + "", cause: "" + (OptionUtil.isProtocolError(e)
-                    ? ""etcd3 registry may not be supported yet or etcd3 registry is not available.""
+                    ? ""etcd3 registy maybe not supported yet or etcd3 registry not available.""
                     : e.getMessage()), e);
         }
     }
@@ -142,9 +142,9 @@
             if (Constants.ANY_VALUE.equals(url.getServiceInterface())) {
                 String root = toRootPath();
 
-                /*
-                 *  if we are interested in all interfaces,
-                 *  find out the current container or create one for the url, put or get only once.
+                /**
+                 *  if we interesting all interfaces,
+                 *  we find current or create container for url, put or get only once.
                  */
                 ConcurrentMap<NotifyListener, ChildListener> listeners =
                         Optional.ofNullable(etcdListeners.get(url))
@@ -154,40 +154,42 @@
                                     return prev != null ? prev : container;
                                 });
 
-                /*
-                 *  if we have no interface watcher listener,
-                 *  find the current listener or create one for the current root, put or get only once.
+                /**
+                 *  if we have not interface watcher listener,
+                 *  we find current or create listener for current root, put or get only once.
                  */
                 ChildListener interfaceListener =
                         Optional.ofNullable(listeners.get(listener))
                                 .orElseGet(() -> {
                                     ChildListener childListener, prev;
-                                    prev = listeners.putIfAbsent(listener, childListener = (parentPath, currentChildren) -> {
-                                        /*
-                                         *  because etcd3 does not support direct children watch events,
+                                    prev = listeners.putIfAbsent(listener, childListener = new ChildListener() {
+                                        public void childChanged(String parentPath, List<String> currentChildren) {
+                                            /**
+                                             *  because etcd3 not support direct children watch events,
                                              *  we should filter not interface events. if we watch /dubbo
-                                         *  and /dubbo/interface, when we put a key-value pair {/dubbo/interface/hello hello},
+                                             *  and /dubbo/interface, when we put key-value pair {/dubbo/interface/hello hello},
                                              *  we will got events in watching path /dubbo.
                                              */
                                             for (String child : currentChildren) {
                                                 child = URL.decode(child);
                                                 if (!anyServices.contains(child)) {
                                                     anyServices.add(child);
-                                                /*
-                                                 *  if new interface event arrived, we watch their direct children,
+                                                    /**
+                                                     *  if new interface event arrived, we watching direct children,
                                                      *  eg: /dubbo/interface, /dubbo/interface and so on.
                                                      */
                                                     subscribe(url.setPath(child).addParameters(Constants.INTERFACE_KEY, child,
                                                             Constants.CHECK_KEY, String.valueOf(false)), listener);
                                                 }
                                             }
+                                        }
                                     });
                                     return prev != null ? prev : childListener;
                                 });
 
                 etcdClient.create(root);
-                /*
-                 * at the first time, we want to pull already interface and then watch their direct children,
+                /**
+                 *  first time, we want pull already interface and then watching direct children,
                  *  eg: /dubbo/interface, /dubbo/interface and so on.
                  */
                 List<String> services = etcdClient.addChildListener(root, interfaceListener);
@@ -198,42 +200,47 @@
                             Constants.CHECK_KEY, String.valueOf(false)), listener);
                 }
             } else {
-                List<URL> urls = new ArrayList<>();
+                List<URL> urls = new ArrayList<URL>();
                 for (String path : toCategoriesPath(url)) {
 
-                    /*
-                     *  if we are interested in special categories (providers, consumers, routers and so on),
-                     *  we find out the current container or create one for the url, put or get only once.
+                    /**
+                     *  if we interesting special categories (providers, consumers, routers and so on),
+                     *  we find current or create container for url, put or get only once.
                      */
                     ConcurrentMap<NotifyListener, ChildListener> listeners =
                             Optional.ofNullable(etcdListeners.get(url))
                                     .orElseGet(() -> {
                                         ConcurrentMap<NotifyListener, ChildListener> container, prev;
                                         prev = etcdListeners.putIfAbsent(url,
-                                                container = new ConcurrentHashMap<>());
+                                                container = new ConcurrentHashMap<NotifyListener, ChildListener>());
                                         return prev != null ? prev : container;
                                     });
 
-                    /*
+                    /**
                      *  if we have no category watcher listener,
-                     *  we find out the current listener or create one for the current category, put or get only once.
+                     *  we find current or create listener for current category, put or get only once.
                      */
                     ChildListener childListener =
                             Optional.ofNullable(listeners.get(listener))
                                     .orElseGet(() -> {
                                         ChildListener watchListener, prev;
-                                        prev = listeners.putIfAbsent(listener, watchListener = (parentPath, currentChildren) -> EtcdRegistry.this.notify(url, listener,
-                                                toUrlsWithEmpty(url, parentPath, currentChildren)));
+                                        prev = listeners.putIfAbsent(listener, watchListener = new ChildListener() {
+                                            public void childChanged(String parentPath, List<String> currentChildren) {
+                                                EtcdRegistry.this.notify(url, listener,
+                                                        toUrlsWithEmpty(url, parentPath, currentChildren));
+                                            }
+                                        });
                                         return prev != null ? prev : watchListener;
                                     });
 
                     etcdClient.create(path);
-                    /*
-                     * at the first time, we want to pull already category and then watch their direct children,
+                    /**
+                     *  first time, we want pull already category and then watching direct children,
                      *  eg: /dubbo/interface/providers, /dubbo/interface/consumers and so on.
                      */
                     List<String> children = etcdClient.addChildListener(path, childListener);
                     if (children != null) {
+                        final String watchPath = path;
                         urls.addAll(toUrlsWithEmpty(url, path, children));
                     }
                 }
@@ -242,7 +249,7 @@
         } catch (Throwable e) {
             throw new RpcException(""Failed to subscribe "" + url + "" to etcd "" + getUrl()
                     + "", cause: "" + (OptionUtil.isProtocolError(e)
-                    ? ""etcd3 registry may not be supported yet or etcd3 registry is not available.""
+                    ? ""etcd3 registy maybe not supported yet or etcd3 registry not available.""
                     : e.getMessage()), e);
         }
     }
@@ -253,7 +260,7 @@
         if (listeners != null) {
             ChildListener etcdListener = listeners.get(listener);
             if (etcdListener != null) {
-                // maybe url has many subscribed paths
+                // maybe url has many subscribe path
                 for (String path : toUnsubscribedPath(url)) {
                     etcdClient.removeChildListener(path, etcdListener);
                 }
@@ -296,16 +303,16 @@
     }
 
     protected String[] toCategoriesPath(URL url) {
-        String[] categories;
+        String[] categroies;
         if (Constants.ANY_VALUE.equals(url.getParameter(Constants.CATEGORY_KEY))) {
-            categories = new String[]{Constants.PROVIDERS_CATEGORY, Constants.CONSUMERS_CATEGORY,
+            categroies = new String[]{Constants.PROVIDERS_CATEGORY, Constants.CONSUMERS_CATEGORY,
                     Constants.ROUTERS_CATEGORY, Constants.CONFIGURATORS_CATEGORY};
         } else {
-            categories = url.getParameter(Constants.CATEGORY_KEY, new String[]{Constants.DEFAULT_CATEGORY});
+            categroies = url.getParameter(Constants.CATEGORY_KEY, new String[]{Constants.DEFAULT_CATEGORY});
         }
-        String[] paths = new String[categories.length];
-        for (int i = 0; i < categories.length; i++) {
-            paths[i] = toServicePath(url) + Constants.PATH_SEPARATOR + categories[i];
+        String[] paths = new String[categroies.length];
+        for (int i = 0; i < categroies.length; i++) {
+            paths[i] = toServicePath(url) + Constants.PATH_SEPARATOR + categroies[i];
         }
         return paths;
     }
@@ -328,7 +335,9 @@
             categories.add(group);
             return categories;
         } else {
-            categories.addAll(Arrays.asList(toCategoriesPath(url)));
+            for (String path : toCategoriesPath(url)) {
+                categories.add(path);
+            }
         }
         return categories;
     }",1
Fix UNDERTOW-981 - Filter default ports of a scheme in ProxyPeerAddressHandler,"             if(forwardedPort != null) {
                 try {
                     port = Integer.parseInt(forwardedPort);
-                    String scheme = exchange.getRequestScheme();
-
-                    if (! standardPort(port, scheme)) {
                     hostHeader += "":"" + port;
-                    }
                 } catch (NumberFormatException ignore) {
                     UndertowLogger.REQUEST_LOGGER.debugf(""Cannot parse port: %s"", forwardedPort);
                 }
@@ -112,9 +108,6 @@
         next.handleRequest(exchange);
     }
 
-    private static boolean standardPort(int port, String scheme) {
-        return (port == 80 && ""http"".equals(scheme)) || (port == 443 & ""https"".equals(scheme));
-    }
 
     public static class Builder implements HandlerBuilder {
 ",1
Fix bug that the default case on Touch event,"                 break;
 
             case MotionEvent.ACTION_UP:
+            default:
                 handled = onTouchUp(event);
                 break;
-
-            default:
-                handled = false;
-                break;
         }
 
         notifyTouchMode();",1
Bugfixes for notifyDatasetChanged and bad position checking," 
             mLayoutMode = LAYOUT_SYNC;
             mSyncPosition = Math.min(Math.max(0, mSyncPosition), count - 1);
+            if (mSyncPosition == 0) mLayoutMode = LAYOUT_FORCE_TOP;
             return;
         }
 
@@ -944,7 +945,7 @@
             mPerformClick = new PerformClick();
         }
         final int motionPosition = mMotionPosition;
-        if (!mDataChanged && motionPosition >= 0 && mAdapter.isEnabled(motionPosition)) {
+        if (!mDataChanged && motionPosition > 0 && mAdapter.isEnabled(motionPosition)) {
             final PerformClick performClick = mPerformClick;
             performClick.mClickMotionPosition = motionPosition;
             performClick.rememberWindowAttachCount();",1
fix a bug in the InMemorySagaStore,"     public Set<String> findSagas(Class<?> sagaType, AssociationValue associationValue) {
         return managedSagas.entrySet()
                 .stream()
-                .filter(avEntry -> sagaType.isInstance(avEntry.getValue().saga()))
                 .filter(avEntry -> avEntry.getValue().associationValues().contains(associationValue))
                 .map(Map.Entry::getKey)
                 .collect(Collectors.toSet());",1
Added LDAP admin user provisioning process to add ROLE_ to existing roles," import java.util.ArrayList;
 import java.util.HashSet;
 import java.util.List;
-import java.util.ListIterator;
 import java.util.Map;
 import java.util.Set;
 
@@ -96,23 +95,6 @@
             }
         }
 
-        // Spring security expects everything to begin with ROLE_ for things like hasRole() expressions so this adds additional
-        // authorities with those mappings, as well as new ones with ROLE_ instead of PERMISSION_.
-        // At the end of this, given a permission set like:
-        // PERMISSION_ALL_PRODUCT
-        // The following authorities will appear in the final list to Spring security:
-        // PERMISSION_ALL_PRODUCT, ROLE_PERMISSION_ALL_PRODUCT, ROLE_ALL_PRODUCT
-        ListIterator<SimpleGrantedAuthority> it = new ArrayList<>(newAuthorities).listIterator();
-        while (it.hasNext()) {
-            SimpleGrantedAuthority auth = it.next();
-            if (auth.getAuthority().startsWith(AdminUserDetailsServiceImpl.LEGACY_ROLE_PREFIX)) {
-                it.add(new SimpleGrantedAuthority(AdminUserDetailsServiceImpl.DEFAULT_SPRING_SECURITY_ROLE_PREFIX + auth.getAuthority()));
-                it.add(new SimpleGrantedAuthority(auth.getAuthority().replaceAll(AdminUserDetailsServiceImpl.LEGACY_ROLE_PREFIX, 
-                        AdminUserDetailsServiceImpl.DEFAULT_SPRING_SECURITY_ROLE_PREFIX)));
-            }
-        }
-        
-        
         AdminUser adminUser = securityService.readAdminUserByUserName(details.getUsername());
         if (adminUser == null) {
             adminUser = new AdminUserImpl();",1
Fixed for issue #2767,"                 int alertId = v.get(i).intValue();
                 RecordAlert recAlert = tableAlert.read(alertId);
                 Alert alert = new Alert(recAlert);
-                if (alert.getHistoryRef() != null) {
-                    // Only use the alert if it has a history reference.
                 if (!allAlerts.contains(alert)) {
                     allAlerts.add(alert);
                 }
             }
-            }
         } catch (DatabaseException e) {
             logger.error(e.getMessage(), e);
         }",1
hotfix/JENKINS-48198-node-graph-logging * Cherry pick #1648 to 1.4,"         this.inputAction = run.getAction(InputAction.class);
         FlowExecution execution = run.getExecution();
         if(execution!=null) {
-            try {
             ForkScanner.visitSimpleChunks(execution.getCurrentHeads(), this, new StageChunkFinder());
-            } catch (final Throwable t) {
-                // Log run ID, because the eventual exception handler (probably Stapler) isn't specific enough to do so
-                logger.error(""Caught a "" + t.getClass().getSimpleName() +
-                                 "" traversing the graph for run "" + run.getExternalizableId());
-                throw t;
-            }
-        } else {
-            logger.error(""Could not find execution for run "" + run.getExternalizableId());
         }
     }
 ",1
Fixes #140 Removed line that nulled mChildren causing issues on certain devices.," 			child.destroy();
 		}
 		mChildren.clear();
+		mChildren = null;
 	}
 	
 	public void startRendering() {",1
"Fixes spelling error ""neeed"" to ""need""","                 viewHolder.bindToPost(model, new View.OnClickListener() {
                     @Override
                     public void onClick(View starView) {
-                        // Need to write to both places the post is stored
+                        // Neeed to write to both places the post is stored
                         DatabaseReference globalPostRef = mDatabase.child(""posts"").child(postRef.getKey());
                         DatabaseReference userPostRef = mDatabase.child(""user-posts"").child(model.uid).child(postRef.getKey());
 ",1
Fix a minor typo in a comment,"                 try {
                     request.length = Long.parseLong(contentLength);
                 } catch (NumberFormatException e) {
-                    // NoOp -- we won't specify length so it will be chunked?
+                    // NoOp -- we wdn't specify length so it will be chunked?
                 }
             }
         }",1
NioDatagramChannel invalid usage of internalNioBuffer,"             return true;
         }
 
-        final ByteBuffer nioData = data.nioBufferCount() == 1 ? data.internalNioBuffer(data.readerIndex(), dataLen)
-                                                              : data.nioBuffer(data.readerIndex(), dataLen);
+        final ByteBuffer nioData = data.internalNioBuffer(data.readerIndex(), dataLen);
         final int writtenBytes;
         if (remoteAddress != null) {
             writtenBytes = javaChannel().send(nioData, remoteAddress);",1
fix scroll issues," import android.graphics.RectF;
 import android.graphics.Region;
 import android.graphics.Typeface;
-import android.os.Build;
 import android.support.annotation.Nullable;
 import android.support.v4.view.GestureDetectorCompat;
 import android.support.v4.view.ViewCompat;
-import android.support.v4.view.animation.FastOutLinearInInterpolator;
 import android.text.Layout;
 import android.text.SpannableStringBuilder;
 import android.text.StaticLayout;
@@ -30,7 +28,6 @@
 import android.view.ScaleGestureDetector;
 import android.view.SoundEffectConstants;
 import android.view.View;
-import android.view.ViewConfiguration;
 import android.widget.OverScroller;
 
 import java.text.SimpleDateFormat;
@@ -47,10 +44,6 @@
  */
 public class WeekView extends View {
 
-    private enum Direction {
-        NONE, LEFT, RIGHT, VERTICAL
-    }
-
     @Deprecated
     public static final int LENGTH_SHORT = 1;
     @Deprecated
@@ -93,8 +86,7 @@
     private Calendar mFirstVisibleDay;
     private Calendar mLastVisibleDay;
     private int mDefaultEventColor;
-    private int mMinimumFlingVelocity = 0;
-    private int mScaledTouchSlop = 0;
+
     // Attributes and their default values.
     private int mHourHeight = 50;
     private int mNewHourHeight = -1;
@@ -160,40 +152,20 @@
             if (mIsZooming)
                 return true;
 
-            switch (mCurrentScrollDirection) {
-                case NONE: {
+            // Calculate the direction to scroll.
+            if (mCurrentScrollDirection == Direction.NONE) {
                 // allow scrolling only in one direction
                 if (Math.abs(distanceX) > Math.abs(distanceY)){
-                        if (distanceX > 0) {
-                            mCurrentScrollDirection = Direction.LEFT;
-                        } else {
-                            mCurrentScrollDirection = Direction.RIGHT;
+                    mCurrentScrollDirection = Direction.HORIZONTAL;
                 }
-                    } else {
+                else {
                     mCurrentScrollDirection = Direction.VERTICAL;
                 }
-                    break;
-                }
-                case LEFT: {
-                    // change direction if there was enough change
-                    if (Math.abs(distanceX) > Math.abs(distanceY) && (distanceX < -mScaledTouchSlop)) {
-                        mCurrentScrollDirection = Direction.RIGHT;
-                    }
-                    break;
-                }
-                case RIGHT: {
-                    // change direction if there was enough change
-                    if (Math.abs(distanceX) > Math.abs(distanceY) && (distanceX > mScaledTouchSlop)) {
-                        mCurrentScrollDirection = Direction.LEFT;
-                    }
-                    break;
-                }
             }
 
             // Calculate the new origin after scroll.
             switch (mCurrentScrollDirection) {
-                case LEFT:
-                case RIGHT:
+                case HORIZONTAL:
                     mCurrentOrigin.x -= distanceX * mXScrollingSpeed;
                     ViewCompat.postInvalidateOnAnimation(WeekView.this);
                     break;
@@ -207,20 +179,14 @@
 
         @Override
         public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {
-            if (mIsZooming)
-                return true;
-
             mScroller.forceFinished(true);
 
             mCurrentFlingDirection = mCurrentScrollDirection;
-            switch (mCurrentFlingDirection) {
-                case LEFT:
-                case RIGHT:
+            if (mCurrentFlingDirection == Direction.HORIZONTAL){
                 mScroller.fling((int) mCurrentOrigin.x, (int) mCurrentOrigin.y, (int) (velocityX * mXScrollingSpeed), 0, Integer.MIN_VALUE, Integer.MAX_VALUE, (int) -(mHourHeight * 24 + mHeaderTextHeight + mHeaderRowPadding * 2 + mHeaderMarginBottom + mTimeTextHeight/2 - getHeight()), 0);
-                    break;
-                case VERTICAL:
+            }
+            else if (mCurrentFlingDirection == Direction.VERTICAL){
                 mScroller.fling((int) mCurrentOrigin.x, (int) mCurrentOrigin.y, 0, (int) velocityY, Integer.MIN_VALUE, Integer.MAX_VALUE, (int) -(mHourHeight * 24 + mHeaderTextHeight + mHeaderRowPadding * 2 + mHeaderMarginBottom + mTimeTextHeight/2 - getHeight()), 0);
-                    break;
             }
 
             ViewCompat.postInvalidateOnAnimation(WeekView.this);
@@ -282,6 +248,10 @@
         }
     };
 
+    private enum Direction {
+        NONE, HORIZONTAL, VERTICAL
+    }
+
     public WeekView(Context context) {
         this(context, null);
     }
@@ -345,10 +315,7 @@
     private void init() {
         // Scrolling initialization.
         mGestureDetector = new GestureDetectorCompat(mContext, mGestureListener);
-        mScroller = new OverScroller(mContext, new FastOutLinearInInterpolator());
-
-        mMinimumFlingVelocity = ViewConfiguration.get(mContext).getScaledMinimumFlingVelocity();
-        mScaledTouchSlop = ViewConfiguration.get(mContext).getScaledTouchSlop();
+        mScroller = new OverScroller(mContext);
 
         // Measure settings for time column.
         mTimeTextPaint = new Paint(Paint.ANTI_ALIAS_FLAG);
@@ -1677,7 +1644,7 @@
 
         // Check after call of mGestureDetector, so mCurrentFlingDirection and mCurrentScrollDirection are set.
         if (event.getAction() == MotionEvent.ACTION_UP && !mIsZooming && mCurrentFlingDirection == Direction.NONE) {
-            if (mCurrentScrollDirection == Direction.RIGHT || mCurrentScrollDirection == Direction.LEFT) {
+            if (mCurrentScrollDirection == Direction.HORIZONTAL) {
                 goToNearestOrigin();
             }
             mCurrentScrollDirection = Direction.NONE;
@@ -1687,21 +1654,7 @@
     }
 
     private void goToNearestOrigin(){
-        double leftDays = mCurrentOrigin.x / (mWidthPerDay + mColumnGap);
-
-        if (mCurrentFlingDirection != Direction.NONE) {
-            // snap to nearest day
-            leftDays = Math.round(leftDays);
-        } else if (mCurrentScrollDirection == Direction.LEFT) {
-            // snap to last day
-            leftDays = Math.floor(leftDays);
-        } else if (mCurrentScrollDirection == Direction.RIGHT) {
-            // snap to next day
-            leftDays = Math.ceil(leftDays);
-        } else {
-            // snap to nearest day
-            leftDays = Math.round(leftDays);
-        }
+        float leftDays = Math.round(mCurrentOrigin.x / (mWidthPerDay + mColumnGap));
 
         int nearestOrigin = (int) (mCurrentOrigin.x - leftDays * (mWidthPerDay + mColumnGap));
 
@@ -1709,7 +1662,7 @@
             // Stop current animation.
             mScroller.forceFinished(true);
             // Snap to date.
-            mScroller.startScroll((int) mCurrentOrigin.x, (int) mCurrentOrigin.y, -nearestOrigin, 0, (int) (Math.abs(nearestOrigin) / mWidthPerDay * 500));
+            mScroller.startScroll((int) mCurrentOrigin.x, (int) mCurrentOrigin.y, -nearestOrigin, 0, 50);
             ViewCompat.postInvalidateOnAnimation(WeekView.this);
         }
         // Reset scrolling and fling direction.
@@ -1727,9 +1680,7 @@
                 goToNearestOrigin();
             }
         } else {
-            if (mCurrentFlingDirection != Direction.NONE && forceFinishScroll()) {
-                goToNearestOrigin();
-            } else if (mScroller.computeScrollOffset()) {
+            if (mScroller.computeScrollOffset()) {
                 mCurrentOrigin.y = mScroller.getCurrY();
                 mCurrentOrigin.x = mScroller.getCurrX();
                 ViewCompat.postInvalidateOnAnimation(this);
@@ -1737,19 +1688,6 @@
         }
     }
 
-    /**
-     * check if scrolling should be stopped
-     * @return true if scrolling should be stopped before reaching the end of animation
-     */
-    private boolean forceFinishScroll() {
-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.ICE_CREAM_SANDWICH) {
-            // current velocity only available since api 14
-            return mScroller.getCurrVelocity() <= mMinimumFlingVelocity;
-        } else {
-            return false;
-        }
-    }
-
 
     /////////////////////////////////////////////////////////////////
     //",1
Fix minor typo in AsyncHttpClientConfig.java,"   /**
    * Return the list of {@link RequestFilter}
    *
-   * @return Unmodifiable list of {@link RequestFilter}
+   * @return Unmodifiable list of {@link ResponseFilter}
    */
   List<RequestFilter> getRequestFilters();
 ",1
Switch memory leak fix," package com.gc.materialdesign.views;
 
+import com.gc.materialdesign.R;
+import com.gc.materialdesign.utils.Utils;
+import com.nineoldandroids.animation.ObjectAnimator;
+import com.nineoldandroids.view.ViewHelper;
+
 import android.content.Context;
 import android.graphics.Bitmap;
 import android.graphics.Canvas;
@@ -14,23 +19,17 @@
 import android.view.View;
 import android.widget.RelativeLayout;
 
-import com.gc.materialdesign.R;
-import com.gc.materialdesign.utils.Utils;
-import com.nineoldandroids.animation.ObjectAnimator;
-import com.nineoldandroids.view.ViewHelper;
-
 public class Switch extends CustomView {
 
-    private int backgroundColor = Color.parseColor(""#4CAF50"");
+	int backgroundColor = Color.parseColor(""#4CAF50"");
 
-    private Ball ball;
+	Ball ball;
 
-    private boolean check      = false;
-    private boolean eventCheck = false;
-    private boolean press      = false;
+	boolean check = false;
+	boolean eventCheck = false;
+	boolean press = false;
 
-    private OnCheckListener onCheckListener;
-    private Bitmap bitmap;
+	OnCheckListener onCheckListener;
 
 	public Switch(Context context, AttributeSet attrs) {
 		super(context, attrs);
@@ -122,15 +121,12 @@
 	@Override
 	protected void onDraw(Canvas canvas) {
 		super.onDraw(canvas);
-		if (!placedBall) {
+		if (!placedBall)
 			placeBall();
-        }
 
 		// Crop line to transparent effect
-        if(null == bitmap) {
-            bitmap = Bitmap.createBitmap(canvas.getWidth(),
+		Bitmap bitmap = Bitmap.createBitmap(canvas.getWidth(),
 				canvas.getHeight(), Bitmap.Config.ARGB_8888);
-        }
 		Canvas temp = new Canvas(bitmap);
 		Paint paint = new Paint();
 		paint.setAntiAlias(true);",1
Fix javadoc.,"         }
 
         /**
-         * Returns the singleton instance of the linked list.
+         * Returns the singleton instance of the liked list.
          *
          * @param <T> Component type of the List
          * @return the singleton instance of the linked list.",1
fix bug in ParseOkHttpClient that can cause errors when saving ParseFile,"     // Set Body
     ParseHttpBody parseBody = parseRequest.getBody();
     ParseOkHttpRequestBody okHttpRequestBody = null;
-    if(parseBody != null) {
+    if(parseBody instanceof ParseByteArrayHttpBody) {
       okHttpRequestBody = new ParseOkHttpRequestBody(parseBody);
     }
     switch (method) {",1
Fix NPE for null failed processor in IdentityFlowProcessorVerification," 
   @Override
   public final Publisher<T> createFailedPublisher() {
-    Flow.Publisher<T> failed = createFailedFlowPublisher();
-    if (failed == null) return null; // because `null` means ""SKIP"" in createFailedPublisher
-    else return FlowAdapters.toPublisher(failed);
+    return FlowAdapters.toPublisher(createFailedFlowPublisher());
   }
 
 }",1
Fix Javadocs on MockitoRule.java to correct an error on its usage.,"  * public class ExampleTest {
  *
  *     //Creating new rule with recommended Strictness setting
- *     &#064;Rule public MockitoRule rule = MockitoJUnit.rule().strictness(Strictness.STRICT_STUBS);
+ *     &#064;Rule public MockitoRule rule = MockitoJUnit.strictness(Strictness.STRICT_STUBS).rule();
  *
  *     &#064;Mock
  *     private List list;",1
fix truncated message issue," 
 		private int m_length;
 
-		private long m_totalDurationInMicros; // for truncate message
-
 		public Context(String domain, String hostName, String ipAddress, ClientConfigManager configManager) {
 			m_tree = new DefaultMessageTree();
 			m_stack = new Stack<Transaction>();
@@ -264,20 +262,15 @@
 			long messagePeriod = trimToHour(message.getTimestamp() - 10 * 1000L); // 10 seconds extra time allowed
 
 			if (treePeriod < messagePeriod || m_length >= m_configManager.getMaxMessageLength()) {
-				truncateAndFlushMessage(manager, message.getTimestamp());
+				flushTrancatedMessage(manager, message.getTimestamp());
 			}
 
 			transaction.addChild(message);
 			m_length++;
 		}
 
-		private void adjustForTruncatedMessage(Transaction root) {
-			DefaultEvent next = new DefaultEvent(""TruncatedTransaction"", ""TotalDuration"");
-			long actualDurationInMicros = m_totalDurationInMicros + root.getDurationInMicros();
-
-			next.addData(String.valueOf(actualDurationInMicros));
-			next.setStatus(Message.SUCCESS);
-			root.addChild(next);
+		private long trimToHour(long timestamp) {
+			return timestamp - timestamp % (3600 * 1000L);
 		}
 
 		/**
@@ -306,11 +299,6 @@
 
 					m_tree.setMessageId(null);
 					m_tree.setMessage(null);
-
-					if (m_totalDurationInMicros > 0) {
-						adjustForTruncatedMessage(current);
-					}
-
 					manager.flush(tree);
 					return true;
 				}
@@ -319,6 +307,48 @@
 			return false;
 		}
 
+		private void flushTrancatedMessage(DefaultMessageManager manager, long timestamp) {
+			Message message = m_tree.getMessage();
+
+			if (message instanceof DefaultTransaction) {
+				String id = m_tree.getMessageId();
+				String rootId = m_tree.getRootMessageId();
+				String childId = manager.nextMessageId();
+				DefaultTransaction source = (DefaultTransaction) message;
+				DefaultTransaction target = new DefaultTransaction(source.getType(), source.getName(), manager);
+
+				target.setTimestamp(source.getTimestamp());
+				target.setDurationInMicros(source.getDurationInMicros());
+				target.addData(source.getData().toString());
+				target.setStatus(Message.SUCCESS);
+
+				migrateMessage(manager, source, target, 1);
+
+				for (int i = m_stack.size() - 1; i >= 0; i--) {
+					DefaultTransaction t = (DefaultTransaction) m_stack.get(i);
+
+					t.setTimestamp(timestamp);
+				}
+
+				DefaultEvent next = new DefaultEvent(""RemoteCall"", ""Next"");
+
+				next.addData(childId);
+				next.setStatus(Message.SUCCESS);
+				target.addChild(next);
+
+				// tree is the parent, and m_tree is the child.
+				MessageTree tree = m_tree.copy();
+
+				tree.setMessage(target);
+				manager.flush(tree);
+
+				m_tree.setMessageId(childId);
+				m_tree.setParentMessageId(id);
+				m_tree.setRootMessageId(rootId != null ? rootId : id);
+				m_length = m_stack.size();
+			}
+		}
+
 		private void migrateMessage(DefaultMessageManager manager, Transaction source, Transaction target, int level) {
 			Transaction current = level < m_stack.size() ? m_stack.get(level) : null;
 			boolean shouldKeep = false;
@@ -371,53 +401,6 @@
 			m_stack.push(transaction);
 		}
 
-		private long trimToHour(long timestamp) {
-			return timestamp - timestamp % (3600 * 1000L);
-		}
-
-		private void truncateAndFlushMessage(DefaultMessageManager manager, long timestamp) {
-			Message message = m_tree.getMessage();
-
-			if (message instanceof DefaultTransaction) {
-				String id = m_tree.getMessageId();
-				String rootId = m_tree.getRootMessageId();
-				String childId = manager.nextMessageId();
-				DefaultTransaction source = (DefaultTransaction) message;
-				DefaultTransaction target = new DefaultTransaction(source.getType(), source.getName(), manager);
-
-				target.setTimestamp(source.getTimestamp());
-				target.setDurationInMicros(source.getDurationInMicros());
-				target.addData(source.getData().toString());
-				target.setStatus(Message.SUCCESS);
-
-				migrateMessage(manager, source, target, 1);
-
-				for (int i = m_stack.size() - 1; i >= 0; i--) {
-					DefaultTransaction t = (DefaultTransaction) m_stack.get(i);
-
-					t.setTimestamp(timestamp);
-				}
-
-				DefaultEvent next = new DefaultEvent(""RemoteCall"", ""Next"");
-
-				next.addData(childId);
-				next.setStatus(Message.SUCCESS);
-				target.addChild(next);
-
-				// tree is the parent, and m_tree is the child.
-				MessageTree tree = m_tree.copy();
-
-				tree.setMessage(target);
-				manager.flush(tree);
-
-				m_tree.setMessageId(childId);
-				m_tree.setParentMessageId(id);
-				m_tree.setRootMessageId(rootId != null ? rootId : id);
-				m_length = m_stack.size();
-				m_totalDurationInMicros += source.getDurationInMicros();
-			}
-		}
-
 		void validateTransaction(Transaction transaction) {
 			if (!transaction.isStandalone()) {
 				return;",1
Some fixes for AbstractCommentRule," import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;
 import net.sourceforge.pmd.lang.java.ast.ASTConstructorDeclaration;
-import net.sourceforge.pmd.lang.java.ast.ASTEnumDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTFieldDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;
 import net.sourceforge.pmd.lang.java.ast.AbstractJavaAccessNode;
@@ -149,7 +148,6 @@
 	}
 
 	protected void assignCommentsToDeclarations(ASTCompilationUnit cUnit) {
-				
 		SortedMap<Integer, Node> itemsByLineNumber = orderedCommentsAndDeclarations(cUnit);
 		FormalComment lastComment = null;
 		AbstractJavaAccessNode lastNode = null;
@@ -157,20 +155,28 @@
 		for (Entry<Integer, Node> entry : itemsByLineNumber.entrySet()) {
 			Node value = entry.getValue();
 
+			if (lastComment == null) {
+				if (value instanceof FormalComment) {
+					lastComment = (FormalComment) value;
+				} else {
+				    // else this is declaration without comment
 				    if (value instanceof AbstractJavaAccessNode) {
+				        if (!(value instanceof AbstractJavaAccessTypeNode)) {
+				            lastNode = (AbstractJavaAccessNode) value;
+				        }
+				    }
+				}
+			} else if (value instanceof AbstractJavaAccessNode) {
 				AbstractJavaAccessNode node = (AbstractJavaAccessNode) value;
 
 				// maybe the last comment is within the last node
-				if (lastComment != null && isCommentNotWithin(lastComment, lastNode) && isCommentBefore(lastComment, node)) {
+				if (isCommentNotWithin(lastComment, lastNode) && isCommentBefore(lastComment, node)) {
 				    node.comment(lastComment);
 				    lastComment = null;
 				}
 				if (!(node instanceof AbstractJavaAccessTypeNode)) {
 				    lastNode = node;
 				}
-			} else
-			if (value instanceof FormalComment) {
-				lastComment = (FormalComment) value;
 			}
 		}
 	}
@@ -196,6 +202,12 @@
         }
 	}
 
+    /**
+     * 
+     * @since
+     * @param cUnit
+     * @return bla
+     */
     protected SortedMap<Integer, Node> orderedCommentsAndDeclarations(ASTCompilationUnit cUnit) {
 
         SortedMap<Integer, Node> itemsByLineNumber = new TreeMap<Integer, Node>();
@@ -215,9 +227,6 @@
         List<ASTConstructorDeclaration> constructors = cUnit.findDescendantsOfType(ASTConstructorDeclaration.class);
         addDeclarations(itemsByLineNumber, constructors);
 
-        List<ASTEnumDeclaration> enumDecl = cUnit.findDescendantsOfType(ASTEnumDeclaration.class);
-        addDeclarations(itemsByLineNumber, enumDecl);
-
         return itemsByLineNumber;
     }
 ",1
[java] Fix NPE in type resolution,"             }
         } else {
             JavaTypeDefinition def = JavaTypeDefinition.forClass(myType);
-            if (def != null) {
             node.setTypeDefinition(def.withDimensions(arrayDimens));
         }
     }
-    }
 
     private ASTTypeParameter getTypeParameterDeclaration(Node startNode, String image) {
         for (Node parent = startNode.jjtGetParent(); parent != null; parent = parent.jjtGetParent()) {",1
Fix misspelled method in AccountHeaderBuilder,"     /**
      * set this to false if you want to hide the first line of the selection box in the header (first line would be the name)
      *
-     * @deprecated replaced by {@link #withSelectionFirstLineShown}
-     *
      * @param selectionFirstLineShown
      * @return
      */
-    @Deprecated
     public AccountHeaderBuilder withSelectionFistLineShown(boolean selectionFirstLineShown) {
         this.mSelectionFirstLineShown = selectionFirstLineShown;
         return this;
     }
 
     /**
-     * set this to false if you want to hide the first line of the selection box in the header (first line would be the name)
-     *
-     * @param selectionFirstLineShown
-     * @return
-     */
-    public AccountHeaderBuilder withSelectionFirstLineShown(boolean selectionFirstLineShown) {
-        this.mSelectionFirstLineShown = selectionFirstLineShown;
-        return this;
-    }
-
-    /**
      * set this to false if you want to hide the second line of the selection box in the header (second line would be the e-mail)
      *
      * @param selectionSecondLineShown",1
Fixes #4 Allowing to set parameters at runtime.,"       initAttributes(context, attributeSet);
     }
 
-    updateCircleSize();
+    mCircleSize = getDimension(mSize == SIZE_NORMAL ? R.dimen.fab_size_normal : R.dimen.fab_size_mini);
     mShadowRadius = getDimension(R.dimen.fab_shadow_radius);
     mShadowOffset = getDimension(R.dimen.fab_shadow_offset);
-    updateDrawableSize();
+    mDrawableSize = (int) (mCircleSize + 2 * mShadowRadius);
 
     updateBackground();
   }
 
-  private void updateDrawableSize() {
-    mDrawableSize = (int) (mCircleSize + 2 * mShadowRadius);
-  }
-
-  private void updateCircleSize() {
-    mCircleSize = getDimension(mSize == SIZE_NORMAL ? R.dimen.fab_size_normal : R.dimen.fab_size_mini);
-  }
-
-  public void setSize(int size) {
-    if (this.mSize != size) {
-      this.mSize = size;
-      updateCircleSize();
-      updateDrawableSize();
-      updateBackground();
-    }
-  }
-
-  public int getSize() {
-    return mSize;
-  }
-
-  public void setIcon(@DrawableRes int mIcon) {
-    if (this.mIcon != mIcon) {
-      this.mIcon = mIcon;
-      updateBackground();
-    }
-  }
-
-  /**
-   * @return the current Color for nomal state. Note it returns the color and not the resource!
-   */
-  public int getColorNormal() {
-    return mColorNormal;
-  }
-
-  public void setColorNormal(@ColorRes int colorNormal) {
-    this.mColorNormal = getColor(colorNormal);
-    updateBackground();
-  }
-
-  /**
-   *
-   * @return the current color for pressed state. note that it returns the color and not the resource
-   */
-  public int getColorPressed() {
-    return mColorPressed;
-  }
-
-  public void setColorPressed(@ColorRes int colorPressed) {
-    this.mColorPressed = getColor(colorPressed);
-    updateBackground();
-  }
-
-
   int getColor(@ColorRes int id) {
     return getResources().getColor(id);
   }",1
Fix Trigger functionality for non Java Functions,"         FunctionMetaData functionMetaData = functionMetaDataManager.getFunctionMetaData(tenant, namespace, functionName);
 
         String inputTopicToWrite;
+        // only if the source is PulsarSource and if the function consumes only one topic
+        if (!functionMetaData.getFunctionDetails().getSource().getClassName().equals(PulsarSource.class.getName())) {
+            return Response.status(Status.BAD_REQUEST).build();
+        }
         if (topic != null) {
             inputTopicToWrite = topic;
         } else if (functionMetaData.getFunctionDetails().getSource().getTopicsToSerDeClassNameMap().size() == 1) {
@@ -488,10 +492,6 @@
         } else {
             return Response.status(Status.BAD_REQUEST).build();
         }
-        if (functionMetaData.getFunctionDetails().getSource().getTopicsToSerDeClassNameMap() == null
-            || !functionMetaData.getFunctionDetails().getSource().getTopicsToSerDeClassNameMap().containsKey(inputTopicToWrite)) {
-            return Response.status(Status.BAD_REQUEST).build();
-        }
         String outputTopic = functionMetaData.getFunctionDetails().getSink().getTopic();
         Reader reader = null;
         Producer producer = null;",1
Fixed issue where a system property was incorrectly cached as null when resolved in multiple ways," public class SystemPropertiesServiceImpl implements SystemPropertiesService{
 
     public static final String PROPERTY_SOURCE_NAME = ""systemPropertySource"";
-    protected static final String ENV_CACHE_PREFIX = ""ORIGIN_FROM_ENV"";
 
     /**
      * If the property resoltion comes from the Spring Environment I don't want to try to re-resolve a property from the Environment. This
@@ -156,14 +155,14 @@
      * @return
      */
     protected String buildKey(String propertyName) {
-        Long siteId = null;
+        String key = propertyName;
         BroadleafRequestContext brc = BroadleafRequestContext.getBroadleafRequestContext();
         if (brc != null) {
             if (brc.getSite() != null) {
-                siteId = brc.getSite().getId();
+                key = brc.getSite().getId() + ""-"" + key;
             }
         }
-        return buildKey(propertyName, siteId);
+        return key;
     }
 
     /**
@@ -174,24 +173,10 @@
      * @return
      */
     protected String buildKey(SystemProperty systemProperty) {
-        String propertyName = systemProperty.getName();
-        Long siteId = null;
+        String key = systemProperty.getName();
         if (systemProperty instanceof SiteDiscriminator && ((SiteDiscriminator) systemProperty).getSiteDiscriminator() != null) {
-            siteId = ((SiteDiscriminator) systemProperty).getSiteDiscriminator();
+            key = ((SiteDiscriminator) systemProperty).getSiteDiscriminator() + ""-"" + key;
         }
-        return buildKey(propertyName, siteId);
-    }
-
-    protected String buildKey(String propertyName, Long siteId) {
-        String key = propertyName;
-        if (siteId != null) {
-            key = siteId + ""-"" + key;
-        }
-
-        if (BooleanUtils.isTrue(originatedFromEnvironment.get())) {
-            key = ENV_CACHE_PREFIX + ""-"" + key;
-        }
-
         return key;
     }
 ",1
added empty string check,"     }
 
     public Object getDefault() {
-        if (defaultValue == null || """".equals(defaultValue)) {
+        if (defaultValue == null) {
             return null;
         }
         try {",1
Issue 397: Fix TODO," import java.nio.charset.Charset;
 import java.util.List;
 
+// FIXME this file does not seem to be generated by javacc. Is the doc wrong, or the javacc config?
 /**
+ * <p>
+ * This class was generated automatically by javacc, do not edit.
+ * </p>
+ * <p>
  * Parse Java source code and creates Abstract Syntax Tree classes.
+ * </p>
  *
  * @author Júlio Vilmar Gesser
  */",1
Fix context propagation for bootstrap and server checks," import org.eclipse.che.api.workspace.server.spi.InternalInfrastructureException;
 import org.eclipse.che.api.workspace.server.spi.InternalRuntime;
 import org.eclipse.che.api.workspace.server.spi.environment.InternalMachineConfig;
-import org.eclipse.che.commons.env.EnvironmentContext;
 import org.eclipse.che.workspace.infrastructure.kubernetes.bootstrapper.KubernetesBootstrapperFactory;
 import org.eclipse.che.workspace.infrastructure.kubernetes.environment.KubernetesEnvironment;
 import org.eclipse.che.workspace.infrastructure.kubernetes.namespace.KubernetesNamespace;
@@ -137,8 +136,6 @@
       final List<CompletableFuture<Void>> machinesFutures = new ArrayList<>();
       // futures that must be cancelled explicitly
       final List<CompletableFuture<?>> toCancelFutures = new CopyOnWriteArrayList<>();
-      final EnvironmentContext currentContext = EnvironmentContext.getCurrent();
-
       for (KubernetesMachine machine : machines.values()) {
         final CompletableFuture<Void> machineRunningFuture = machine.waitRunningAsync();
         toCancelFutures.add(machineRunningFuture);
@@ -150,10 +147,10 @@
                 .thenComposeAsync(checkFailure(failure), executor)
                 .thenRun(publishRunningStatus(machine))
                 .thenCompose(checkFailure(failure))
-                .thenCompose(setContext(currentContext, bootstrap(toCancelFutures, machine)))
+                .thenCompose(bootstrap(toCancelFutures, machine))
                 // see comments above why executor is explicitly put into arguments
                 .thenComposeAsync(checkFailure(failure), executor)
-                .thenCompose(setContext(currentContext, checkServers(toCancelFutures, machine)))
+                .thenCompose(checkServers(toCancelFutures, machine))
                 .exceptionally(publishFailedStatus(failure, machine));
         machinesFutures.add(machineBootChain);
       }
@@ -178,18 +175,6 @@
     }
   }
 
-  /** Returns new function that wraps given with set/unset context logic */
-  private <T, R> Function<T, R> setContext(EnvironmentContext context, Function<T, R> func) {
-    return funcArgument -> {
-      try {
-        EnvironmentContext.setCurrent(context);
-        return func.apply(funcArgument);
-      } finally {
-        EnvironmentContext.reset();
-      }
-    };
-  }
-
   /**
    * Waits for readiness of given machines.
    *",1
Fixed timestamp issue with SQL Server DDL Creation,"     @Column(name = ""APPLIC_CD"")
     private String applicationCode;
 
-    @Column(name = ""AUD_DATE"", nullable = false)
+    @Column(name = ""AUD_DATE"", nullable = false, columnDefinition = ""TIMESTAMP"")
     private ZonedDateTime date;
 
     public AuditTrailEntity() {",1
Check a full name instead of just the classSuffix," 			throw new IllegalArgumentException(""'"" + classSuffix + ""' may not be an empty string."");
 		}
 
-		if (!SourceVersion.isName(""ValidName"" + classSuffix) || classSuffix.contains(""."")) {
+		if (!SourceVersion.isName(classSuffix) || classSuffix.contains(""."")) {
 			throw new IllegalArgumentException(""'"" + classSuffix + ""' may not be a valid Java identifier."");
 		}
 	}",1
Add bigger timeout to the login page  methods in the selenium tests,"     this.seleniumWebDriver = seleniumWebDriver;
     PageFactory.initElements(seleniumWebDriver, this);
 
-    webDriverWait = new WebDriverWait(seleniumWebDriver, TestTimeoutsConstants.LOADER_TIMEOUT_SEC);
+    webDriverWait = new WebDriverWait(seleniumWebDriver, TestTimeoutsConstants.ELEMENT_TIMEOUT_SEC);
   }
 
   @Override",1
Fix typo,"         //handle if the drawer should be shown on first launch
         handleShowOnFirstLaunch();
 
-        //we only want to hook a Drawer to the MiniDrawer if it is the main drawer, not the appended one
+        //we only want to hook a Drawer to the MiniDraewr if it is the main drawer, not the appended one
         if (!mAppended && mGenerateMiniDrawer) {
             // if we should create a MiniDrawer we have to do this now
             mMiniDrawer = new MiniDrawer().withDrawer(result).withAccountHeader(mAccountHeader);",1
Fix admin issue when you select an order item," 
 package org.broadleafcommerce.core.order.domain;
 
-import java.io.Serializable;
-
 import org.broadleafcommerce.common.money.Money;
 
-public interface DiscreteOrderItemFeePrice extends Serializable {
+public interface DiscreteOrderItemFeePrice {
 
     public abstract Long getId();
 ",1
Skip Access Control responses for HTTP Sessions," 		if (initiator == HttpSender.ACTIVE_SCANNER_INITIATOR || initiator == HttpSender.SPIDER_INITIATOR
 				|| initiator == HttpSender.AJAX_SPIDER_INITIATOR || initiator == HttpSender.FORCED_BROWSE_INITIATOR
 				|| initiator == HttpSender.CHECK_FOR_UPDATES_INITIATOR || initiator == HttpSender.FUZZER_INITIATOR
-				|| initiator == HttpSender.AUTHENTICATION_INITIATOR || initiator == HttpSender.TOKEN_GENERATOR_INITIATOR
-				|| initiator == HttpSender.ACCESS_CONTROL_SCANNER_INITIATOR) {
+				|| initiator == HttpSender.AUTHENTICATION_INITIATOR || initiator == HttpSender.TOKEN_GENERATOR_INITIATOR) {
 			// Not a session we care about
 			return;
 		}",1
bug fix-1355,"-package com.dianping.cat.plugins;
+package com.wanda.cat.sample.plugins;
 
 import com.alibaba.druid.pool.DruidDataSource;
 import com.dianping.cat.Cat;
 import com.dianping.cat.message.Message;
 import com.dianping.cat.message.Transaction;
-import org.apache.ibatis.datasource.pooled.PooledDataSource;
-import org.apache.ibatis.datasource.unpooled.UnpooledDataSource;
+import org.apache.commons.dbcp.BasicDataSource;
 import org.apache.ibatis.executor.Executor;
-import org.apache.ibatis.mapping.*;
+import org.apache.ibatis.mapping.BoundSql;
+import org.apache.ibatis.mapping.MappedStatement;
+import org.apache.ibatis.mapping.ParameterMapping;
+import org.apache.ibatis.mapping.SqlCommandType;
 import org.apache.ibatis.plugin.*;
 import org.apache.ibatis.reflection.MetaObject;
 import org.apache.ibatis.session.Configuration;
 import org.apache.ibatis.session.ResultHandler;
 import org.apache.ibatis.session.RowBounds;
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
 import org.apache.ibatis.type.TypeHandlerRegistry;
+import org.mybatis.spring.transaction.SpringManagedTransaction;
+import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;
+import org.springframework.util.ReflectionUtils;
 
-import javax.sql.DataSource;
 import java.lang.reflect.Field;
-import java.lang.reflect.InvocationTargetException;
+import java.lang.reflect.Method;
 import java.text.DateFormat;
-import java.util.Date;
-import java.util.List;
-import java.util.Locale;
-import java.util.Properties;
+import java.util.*;
+import java.util.concurrent.ConcurrentHashMap;
 import java.util.regex.Matcher;
 
 
 /**
- *  1.Cat-Mybatis plugin:  Rewrite on the version of Steven;
- *  2.Support DruidDataSource,PooledDataSource(mybatis Self-contained data source);
- * @author zhanzehui(west_20@163.com)
+ * 对MyBatis进行拦截，添加Cat监控
+ * 目前仅支持RoutingDataSource和Druid组合配置的数据源
+ *
+ * @author Steven
  */
 
 @Intercepts({
@@ -40,57 +45,47 @@
 })
 public class CatMybatisPlugin implements Interceptor {
 
-    private static final String MYSQL_DEFAULT_URL = ""jdbc:mysql://UUUUUKnown:3306/%s?useUnicode=true"";
+    private static Log logger = LogFactory.getLog(CatMybatisPlugin.class);
+
+    //缓存，提高性能
+    private static final Map<String, String> sqlURLCache = new ConcurrentHashMap<String, String>(256);
+
+    private static final String EMPTY_CONNECTION = ""jdbc:mysql://unknown:3306/%s?useUnicode=true"";
+
     private Executor target;
 
     @Override
     public Object intercept(Invocation invocation) throws Throwable {
-        MappedStatement mappedStatement = this.getStatement(invocation);
-        String          methodName      = this.getMethodName(mappedStatement);
-        Transaction t = Cat.newTransaction(""SQL"", methodName);
-
-        String sql = this.getSql(invocation,mappedStatement);
-        SqlCommandType sqlCommandType = mappedStatement.getSqlCommandType();
-        Cat.logEvent(""SQL.Method"", sqlCommandType.name().toLowerCase(), Message.SUCCESS, sql);
-
-        String url = this.getSQLDatabaseUrlByStatement(mappedStatement);
-        Cat.logEvent(""SQL.Database"", url);
-
-        return doFinish(invocation,t);
-    }
-
-    private MappedStatement getStatement(Invocation invocation) {
-        return (MappedStatement)invocation.getArgs()[0];
-    }
-
-    private String getMethodName(MappedStatement mappedStatement) {
+        MappedStatement mappedStatement = (MappedStatement) invocation.getArgs()[0];
+        //得到类名，方法
         String[] strArr = mappedStatement.getId().split(""\\."");
         String methodName = strArr[strArr.length - 2] + ""."" + strArr[strArr.length - 1];
 
-        return methodName;
-    }
+        Transaction t = Cat.newTransaction(""SQL"", methodName);
 
-    private String getSql(Invocation invocation, MappedStatement mappedStatement) {
+        //得到sql语句
         Object parameter = null;
         if(invocation.getArgs().length > 1){
             parameter = invocation.getArgs()[1];
         }
-
         BoundSql boundSql = mappedStatement.getBoundSql(parameter);
         Configuration configuration = mappedStatement.getConfiguration();
-        String sql = sqlResolve(configuration, boundSql);
+        String sql = showSql(configuration, boundSql);
 
-        return sql;
-    }
+        //获取SQL类型
+        SqlCommandType sqlCommandType = mappedStatement.getSqlCommandType();
+        Cat.logEvent(""SQL.Method"", sqlCommandType.name().toLowerCase(), Message.SUCCESS, sql);
 
-    private Object doFinish(Invocation invocation,Transaction t) throws InvocationTargetException, IllegalAccessException {
+        String s = this.getSQLDatabase();
+        Cat.logEvent(""SQL.Database"", s);
+
         Object returnObj = null;
         try {
             returnObj = invocation.proceed();
             t.setStatus(Transaction.SUCCESS);
         } catch (Exception e) {
+            t.setStatus(e);
             Cat.logError(e);
-            throw e;
         } finally {
             t.complete();
         }
@@ -98,51 +93,95 @@
         return returnObj;
     }
 
+    private javax.sql.DataSource getDataSource() {
+        org.apache.ibatis.transaction.Transaction transaction = this.target.getTransaction();
+        if (transaction == null) {
+            logger.error(String.format(""Could not find transaction on target [%s]"", this.target));
+            return null;
+        }
+        if (transaction instanceof SpringManagedTransaction) {
+            String fieldName = ""dataSource"";
+            Field field = ReflectionUtils.findField(transaction.getClass(), fieldName, javax.sql.DataSource.class);
 
-    private String getSQLDatabaseUrlByStatement(MappedStatement mappedStatement) {
-        String url = null;
-        DataSource dataSource = null;
-        try {
-            Configuration configuration = mappedStatement.getConfiguration();
-            Environment environment = configuration.getEnvironment();
-            dataSource = environment.getDataSource();
-
-            url = switchDataSource(dataSource);
-
-            return url;
-        } catch (NoSuchFieldException|IllegalAccessException|NullPointerException e) {
-            Cat.logError(e);
+            if (field == null) {
+                logger.error(String.format(""Could not find field [%s] of type [%s] on target [%s]"",
+                        fieldName, javax.sql.DataSource.class, this.target));
+                return null;
             }
 
-        Cat.logError(new Exception(""UnSupport type of DataSource : ""+dataSource.getClass().toString()));
-        return MYSQL_DEFAULT_URL;
+            ReflectionUtils.makeAccessible(field);
+            javax.sql.DataSource dataSource = (javax.sql.DataSource) ReflectionUtils.getField(field, transaction);
+            return dataSource;
         }
 
-    private String switchDataSource(DataSource dataSource) throws NoSuchFieldException, IllegalAccessException {
-        String url = null;
+        logger.error(String.format(""---the transaction is not SpringManagedTransaction:%s"", transaction.getClass().toString()));
 
-        if(dataSource instanceof DruidDataSource) {
-            url = ((DruidDataSource) dataSource).getUrl();
-        }else if(dataSource instanceof PooledDataSource) {
-            Field dataSource1 = dataSource.getClass().getDeclaredField(""dataSource"");
-            dataSource1.setAccessible(true);
-            UnpooledDataSource dataSource2 = (UnpooledDataSource)dataSource1.get(dataSource);
-            url =dataSource2.getUrl();
+        return null;
+    }
+
+    private String getSqlURL() {
+        javax.sql.DataSource dataSource = this.getDataSource();
+
+        if (dataSource == null) {
+            return null;
+        }
+
+        if (dataSource instanceof AbstractRoutingDataSource) {
+            String methodName = ""determineTargetDataSource"";
+            Method method = ReflectionUtils.findMethod(AbstractRoutingDataSource.class, methodName);
+
+            if (method == null) {
+                logger.error(String.format(""---Could not find method [%s] on target [%s]"",
+                        methodName,  dataSource));
+                return null;
+            }
+
+            ReflectionUtils.makeAccessible(method);
+            javax.sql.DataSource dataSource1 = (javax.sql.DataSource) ReflectionUtils.invokeMethod(method, dataSource);
+            if (dataSource1 instanceof DruidDataSource) {
+                DruidDataSource druidDataSource = (DruidDataSource) dataSource1;
+                return druidDataSource.getUrl();
             } else {
-            //other dataSource expand
+                logger.error(""---only surpport DruidDataSource:"" + dataSource1.getClass().toString());
+            }
+        } else if(dataSource instanceof BasicDataSource){
+            return ((BasicDataSource) dataSource).getUrl();
+        }
+        return null;
     }
 
+    private String getSQLDatabase() {
+//        String dbName = RouteDataSourceContext.getRouteKey();
+        String dbName = null; //根据设置的多数据源修改此处,获取dbname
+        if (dbName == null) {
+            dbName = ""DEFAULT"";
+        }
+        String url = CatMybatisPlugin.sqlURLCache.get(dbName);
+        if (url != null) {
             return url;
         }
 
-    public String sqlResolve(Configuration configuration, BoundSql boundSql) {
+        url = this.getSqlURL();//目前监控只支持mysql ,其余数据库需要各自修改监控服务端
+        if (url == null) {
+            url = String.format(EMPTY_CONNECTION, dbName);
+        }
+        CatMybatisPlugin.sqlURLCache.put(dbName, url);
+        return url;
+    }
+    /**
+     * 解析sql语句
+     * @param configuration
+     * @param boundSql
+     * @return
+     */
+    public String showSql(Configuration configuration, BoundSql boundSql) {
         Object parameterObject = boundSql.getParameterObject();
         List<ParameterMapping> parameterMappings = boundSql.getParameterMappings();
         String sql = boundSql.getSql().replaceAll(""[\\s]+"", "" "");
         if (parameterMappings.size() > 0 && parameterObject != null) {
             TypeHandlerRegistry typeHandlerRegistry = configuration.getTypeHandlerRegistry();
             if (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) {
-                sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(resolveParameterValue(parameterObject)));
+                sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(getParameterValue(parameterObject)));
 
             } else {
                 MetaObject metaObject = configuration.newMetaObject(parameterObject);
@@ -150,10 +189,10 @@
                     String propertyName = parameterMapping.getProperty();
                     if (metaObject.hasGetter(propertyName)) {
                         Object obj = metaObject.getValue(propertyName);
-                        sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(resolveParameterValue(obj)));
+                        sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(getParameterValue(obj)));
                     } else if (boundSql.hasAdditionalParameter(propertyName)) {
                         Object obj = boundSql.getAdditionalParameter(propertyName);
-                        sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(resolveParameterValue(obj)));
+                        sql = sql.replaceFirst(""\\?"", Matcher.quoteReplacement(getParameterValue(obj)));
                     }
                 }
             }
@@ -161,13 +200,18 @@
         return sql;
     }
 
-    private String resolveParameterValue(Object obj) {
+    /**
+     * 参数解析
+     * @param obj
+     * @return
+     */
+    private String getParameterValue(Object obj) {
         String value = null;
         if (obj instanceof String) {
             value = ""'"" + obj.toString() + ""'"";
         } else if (obj instanceof Date) {
             DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.DEFAULT, DateFormat.DEFAULT, Locale.CHINA);
-            value = ""'"" + formatter.format(new Date()) + ""'"";
+            value = ""'"" + formatter.format((Date)obj) + ""'"";
         } else {
             if (obj != null) {
                 value = obj.toString();",1
Eliminate potential ReadPendingException for AIO suspend-resume,"     private boolean flushing;
 
     private final AtomicBoolean readSuspended = new AtomicBoolean();
-    private final AtomicBoolean readInProgress = new AtomicBoolean();
 
     private final Runnable readTask = new Runnable() {
         @Override
@@ -192,11 +191,6 @@
             return;
         }
 
-        // prevent ReadPendingException
-        if (!readInProgress.compareAndSet(false, true)) {
-            return;
-        }
-
         ByteBuf byteBuf = pipeline().inboundByteBuffer();
         if (!byteBuf.readable()) {
             byteBuf.discardReadBytes();
@@ -303,9 +297,6 @@
                     }
                 }
             } finally {
-                // see beginRead
-                channel.readInProgress.set(false);
-
                 if (read) {
                     if (!channel.readSuspended.get()) {
                         pipeline.fireInboundBufferUpdated();",1
Fixed layout issues caused when the StickyHeaderTopOffset was set to non...,"         mList.layout(0, 0, mList.getMeasuredWidth(), getHeight());
         if (mHeader != null) {
             MarginLayoutParams lp = (MarginLayoutParams) mHeader.getLayoutParams();
-            int headerTop = lp.topMargin;
+            int headerTop = lp.topMargin + stickyHeaderTop();
             mHeader.layout(mPaddingLeft, headerTop, mHeader.getMeasuredWidth()
                     + mPaddingLeft, headerTop + mHeader.getMeasuredHeight());
         }
@@ -347,17 +347,18 @@
             }
         }
 
-        int headerOffset = stickyHeaderTop();
+        int headerOffset = 0;
 
         // Calculate new header offset
         // Skip looking at the first view. it never matters because it always
         // results in a headerOffset = 0
+        int headerBottom = mHeader.getMeasuredHeight() + stickyHeaderTop();
         for (int i = 0; i < mList.getChildCount(); i++) {
             final View child = mList.getChildAt(i);
             final boolean doesChildHaveHeader = child instanceof WrapperView && ((WrapperView) child).hasHeader();
             final boolean isChildFooter = mList.containsFooterView(child);
             if (child.getTop() >= stickyHeaderTop() && (doesChildHaveHeader || isChildFooter)) {
-                headerOffset = Math.min(child.getTop() - mHeader.getMeasuredHeight(), headerOffset);
+                headerOffset = Math.min(child.getTop() - headerBottom, 0);
                 break;
             }
         }
@@ -394,7 +395,12 @@
     // hides the headers in the list under the sticky header.
     // Makes sure the other ones are showing
     private void updateHeaderVisibilities() {
-        int top = stickyHeaderTop();
+        int top;
+        if (mHeader != null) {
+            top = mHeader.getMeasuredHeight() + (mHeaderOffset != null ? mHeaderOffset : 0) + mStickyHeaderTopOffset;
+        } else {
+            top = stickyHeaderTop();
+        }
         int childCount = mList.getChildCount();
         for (int i = 0; i < childCount; i++) {
 ",1
setContentView(null) NPE fixed,"+
 package android.support.v4.app;
 
 import android.annotation.SuppressLint;
@@ -429,10 +430,8 @@
     public void setContentView(View view, LayoutParams params) {
         if (requestDecorView(view, params, -1)) {
             mDecorView.removeAllViewsInLayout();
-            if(view != null){
             mDecorView.addView(view, params);
         }
-        }
         onSupportContentChanged();
     }
 ",1
Bugfix for iOS IOSFileHandle.exists()," 	 */
 	@Override
 	public boolean exists () {
-		return file().exists();
+		return file.exists();
 	}
 
 	public File file () {",1
Fix the new method allowing us to create sparse chunks from SW,"   // Chunks in a Frame, before filling them.  This can be called in parallel
   // for different Chunk#'s (cidx); each Chunk can be filled in parallel.
   static NewChunk[] createNewChunks(String name, byte[] type, int cidx) {
-    boolean[] sparse = new boolean[type.length];
-    Arrays.fill(sparse, false);
-    return createNewChunks(name, type, cidx, sparse);
+    return createNewChunks(name, type, cidx, false);
   }
 
-  static NewChunk[] createNewChunks(String name, byte[] type, int cidx, boolean[] sparse) {
+  static NewChunk[] createNewChunks(String name, byte[] type, int cidx, boolean sparse) {
     Frame fr = (Frame) Key.make(name).get();
     NewChunk[] nchks = new NewChunk[fr.numCols()];
     for (int i = 0; i < nchks.length; i++) {
-      nchks[i] = new NewChunk(new AppendableVec(fr._keys[i], type[i]), cidx, sparse[i]);
+      nchks[i] = new NewChunk(new AppendableVec(fr._keys[i], type[i]), cidx, sparse);
     }
     return nchks;
   }",1
KYLIN-3500 fix duplicated tablename at createSqoopToFlatHiveStep  wh…,"                 }
             }
 
-            String cmd = String.format(""%s/sqoop import"" + generateSqoopConfigArgString()
+            //related to ""kylin.engine.mr.config-override.mapreduce.job.queuename""
+            String queueName = getSqoopJobQueueName(config);
+            String cmd = String.format(""%s/sqoop import -Dorg.apache.sqoop.splitter.allow_text_splitter=true ""
+                    + generateSqoopConfigArgString()
                     + ""--connect \""%s\"" --driver %s --username %s --password %s --query \""%s AND \\$CONDITIONS\"" ""
-                    + ""--target-dir %s/%s --split-by %s --boundary-query \""%s\"" --null-string '' ""
+                    + ""--target-dir %s/%s --split-by %s.%s --boundary-query \""%s\"" --null-string '' ""
                     + ""--fields-terminated-by '%s' --num-mappers %d"", sqoopHome, connectionUrl, driverClass, jdbcUser,
-                    jdbcPass, selectSql, jobWorkingDir, hiveTable, splitColumn, bquery, filedDelimiter, mapperNum);
+                    jdbcPass, selectSql, jobWorkingDir, hiveTable, splitTable, splitColumn, bquery, filedDelimiter,
+                    mapperNum);
             logger.debug(String.format(""sqoop cmd:%s"", cmd));
             CmdStep step = new CmdStep();
             step.setCmd(cmd);
@@ -208,7 +212,7 @@
             config.putAll(SourceConfigurationUtil.loadSqoopConfiguration());
             config.putAll(kylinConfig.getSqoopConfigOverride());
 
-            StringBuilder args = new StringBuilder("" -Dorg.apache.sqoop.splitter.allow_text_splitter=true "");
+            StringBuilder args = new StringBuilder();
             for (Map.Entry<String, String> entry : config.entrySet()) {
                 args.append("" -D"" + entry.getKey() + ""="" + entry.getValue() + "" "");
             }",1
Bug fix in DialogFragment.findInstance,"     @SuppressWarnings(""unchecked"")
     public static final <T extends DialogFragment> T findInstance(Activity activity,
             Class<T> clazz, boolean makeIfNeed) {
-
         if (activity == null || clazz == null) {
             throw new IllegalArgumentException(""Activity of DialogFragment class is null"");
         }
-
-        return findInstance(activity.getSupportFragmentManager(), clazz, makeIfNeed);
-    }
-
-    @SuppressWarnings(""unchecked"")
-    public static final <T extends DialogFragment> T findInstance(FragmentManager fm,
-            Class<T> clazz, boolean makeIfNeed) {
-
+        FragmentManager ft = activity.getSupportFragmentManager();
         T fragment;
         final String tag = makeTag(clazz);
         try {
-            fragment = (T) fm.findFragmentByTag(tag);
+            fragment = (T) ft.findFragmentByTag(tag);
             if (fragment == null && makeIfNeed) {
                 fragment = Fragment.instantiate(clazz);
+                ft.putFragment(fragment.getArguments(), tag, fragment);
             }
         } catch (Exception e) {
             throw new RuntimeException(""Error of finding DialogFragment instance"", e);",1
Fix OUYA controller mappings on newer firmwares," 		try {
 			Class<?> buildClass = Class.forName(""android.os.Build"");
 			Field deviceField = buildClass.getDeclaredField(""DEVICE"");
-			Object device = deviceField.get(null);
-			isOuya = ""ouya_1_1"".equals(device) || ""cardhu"".equals(device);
+			isOuya = ""cardhu"".equals(deviceField.get(null));
 		} catch(Exception e) {
 		}
 		runningOnOuya = isOuya;",1
Bug fix in updateTexture method," 	}
 	
 	public void updateTexture(Integer textureId, int textureIndex, Bitmap texture) {
-		GLES20.glActiveTexture(textureIndex);
+		GLES20.glActiveTexture(GLES20.GL_TEXTURE0 +  textureIndex);
 		GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId.intValue());
-		GLUtils.texSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, texture);
-	}
-	
-	public void updateTexture(TextureInfo textureInfo, Bitmap texture) {
-		updateTexture(textureInfo.mTextureId, textureInfo.mTextureSlot, texture);
+		GLUtils.texSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, texture, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE);
 	}
 	
 	public void reset() {",1
Check if group lookup worked to avoid a NPE,"                         LOG.trace(""Looking up group {}"", groupDn);
                         try {
                             Entry group = connection.lookup(groupDn, groupIdAttribute);
-                            // The groupDn lookup can return null if the group belongs to a different domain and the
-                            // connection user does not have the permissions to lookup details.
-                            // See: https://github.com/Graylog2/graylog2-server/issues/1453
-                            if (group != null) {
                             final Attribute groupId = group.get(groupIdAttribute);
                             LOG.trace(""Resolved {} to group {}"", groupDn, groupId);
                             if (groupId != null) {
                                 final String string = groupId.getString();
                                 ldapEntry.addGroups(Collections.singleton(string));
                             }
-                            } else {
-                                LOG.debug(""Unable to lookup group: {}"", groupDn);
-                            }
                         } catch (LdapException e) {
                             LOG.warn(""Error while looking up group "" + groupDn, e);
                         }",1
Use the supplied actor passed to ActorQuery#isInteractingWith," 	@SuppressWarnings(""unchecked"")
 	public QueryType isInteractingWith(Actor actor)
 	{
-		predicate = and(a -> a.getInteracting().equals(actor));
+		predicate = and(a -> a.getInteracting().equals(a));
 		return (QueryType) this;
 	}
 ",1
fixing missing node drawing in activiti diagram for ThrowEvent and,"         if (throwEvent.getEventDefinitions() != null && !throwEvent.getEventDefinitions().isEmpty()) {
           if (throwEvent.getEventDefinitions().get(0) instanceof SignalEventDefinition) {
             processDiagramCanvas.drawThrowingSignalEvent(graphicInfo, scaleFactor);
-          } else {
-            processDiagramCanvas.drawThrowingNoneEvent(graphicInfo, scaleFactor);
           }
         } else {
           processDiagramCanvas.drawThrowingNoneEvent(graphicInfo, scaleFactor);
@@ -154,8 +152,6 @@
         if (endEvent.getEventDefinitions() != null && !endEvent.getEventDefinitions().isEmpty()) {
           if (endEvent.getEventDefinitions().get(0) instanceof ErrorEventDefinition) {
             processDiagramCanvas.drawErrorEndEvent(flowNode.getName(), graphicInfo, scaleFactor);
-          } else {
-            processDiagramCanvas.drawNoneEndEvent(graphicInfo, scaleFactor);
           }
         } else {
           processDiagramCanvas.drawNoneEndEvent(graphicInfo, scaleFactor);",1
fix : authentificationHandler order," package org.apereo.cas.authentication;
 
 import org.apereo.cas.authentication.principal.PrincipalResolver;
-import org.apereo.cas.util.CollectionUtils;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.springframework.core.OrderComparator;
@@ -72,7 +71,7 @@
     public Set<AuthenticationHandler> getAuthenticationHandlersForTransaction(final AuthenticationTransaction transaction) {
         final AuthenticationHandler[] handlers = authenticationHandlerPrincipalResolverMap.keySet().toArray(new AuthenticationHandler[]{});
         OrderComparator.sortIfNecessary(handlers);
-        return new LinkedHashSet<>(CollectionUtils.wrapList(handlers));
+        return new LinkedHashSet<>(Arrays.stream(handlers).collect(Collectors.toSet()));
     }
 
     @Override",1
修复limit -1返回空的bug," 			int start = rrs.getLimitStart();
 			int end = start + rrs.getLimitSize();
 
-                        if (start < 0)
-				start = 0;
-
-			if (rrs.getLimitSize() < 0)
-				end = results.size();
-				
 			// 对于不需要排序的语句,返回的数据只有rrs.getLimitSize()
 			if (rrs.getOrderByCols() == null) {
 				end = results.size();",1
Fix RotateAroundAnimation3D for the X axis. ," 			mTransformable3D.setX(mCenter.x + cosVal);
 			mTransformable3D.setZ(mCenter.z + sinVal);
 		} else if(mAxis == Axis.X) {
-			mTransformable3D.setY(mCenter.y + cosVal);
+			mTransformable3D.setY(mCenter.x + cosVal);
 			mTransformable3D.setZ(mCenter.z + sinVal);
 		}
 	}",1
"[GWT] Fix problem with logging, when app is not yet fully initialized"," 		this.net = new GwtNet();
 		Gdx.net = this.net;
 		this.clipboard = new GwtClipboard();
-		updateLogLabelSize();
 
 		// tell listener about app creation
 		try {
@@ -307,29 +306,10 @@
 		return Gdx.net;
 	}
 
-	private void updateLogLabelSize () {
-		if (log != null) {
-			if (graphics != null) {
-				log.setSize(graphics.getWidth() + ""px"", ""200px"");
-			} else {
-				log.setSize(""400px"", ""200px""); // Should not happen at this point, use dummy value
-			}
-		}
-	}
-
 	private void checkLogLabel () {
 		if (log == null) {
 			log = new TextArea();
-			
-			// It's possible that log functions are called
-			// before the app is initialized. E.g. SoundManager can call log functions before the app is initialized. 
-			// Since graphics is null, we're getting errors. The log size will be updated later, in case graphics was null
-			if (graphics != null) {
 			log.setSize(graphics.getWidth() + ""px"", ""200px"");
-			} else {
-				log.setSize(""400px"", ""200px""); // Dummy value
-			} 
-			
 			log.setReadOnly(true);
 			root.add(log);
 		}",1
FIX: DIFFERENCE function - wrong results for stateless mode,"       return null;
     } else {
       // IN-LINE MODE (STATELESS)
-      final Set<Object> result = new HashSet<Object>();
+      final Set<Object> result = new HashSet<Object>((Collection<?>) value);
       final Set<Object> rejected = new HashSet<Object>();
 
       for (Object iParameter : iParameters) {
         if (iParameter instanceof Collection<?>) {
           addItemsToResult((Collection<Object>) value, result, rejected);
         } else {
-          addItemToResult(iParameter, result, rejected);
+          addItemToResult(value, result, rejected);
         }
       }
 ",1
Fixed bug with dividers in ListView,"                     if (mPrevFirstVisibleChildHeight < 0) {
                         mPrevFirstVisibleChildHeight = 0;
                     }
-                    mScrollY = mPrevScrolledChildrenHeight - firstVisibleChild.getTop() + 
-                                firstVisiblePosition * getDividerHeight();
+                    mScrollY = mPrevScrolledChildrenHeight - firstVisibleChild.getTop();
                     mPrevFirstVisiblePosition = firstVisiblePosition;
 
                     dispatchOnScrollChanged(mScrollY, mFirstScroll, mDragging);",1
MINOR: Fixed log in Topology Builder.," 
     public void updateSubscribedTopics(final Set<String> topics, final String logPrefix) {
         final SubscriptionUpdates subscriptionUpdates = new SubscriptionUpdates();
-        log.debug(""{}found {} topics possibly matching regex"", logPrefix, topics);
+        log.debug(""{}found {} topics possibly matching regex"", topics, logPrefix);
         // update the topic groups with the returned subscription set for regex pattern subscriptions
         subscriptionUpdates.updateTopics(topics);
         updateSubscriptions(subscriptionUpdates, logPrefix);",1
#1814: Synchronize project instead of parent directory," package org.eclipse.che.ide.ext.java.client.project.classpath;
 
 import com.google.common.base.Optional;
+import com.google.common.base.Preconditions;
 import com.google.inject.Inject;
 import com.google.inject.Singleton;
 import com.google.web.bindery.event.shared.EventBus;
@@ -21,6 +22,7 @@
 import org.eclipse.che.api.promises.client.PromiseError;
 import org.eclipse.che.ide.api.app.AppContext;
 import org.eclipse.che.ide.api.notification.NotificationManager;
+import org.eclipse.che.ide.api.resources.Container;
 import org.eclipse.che.ide.api.resources.Project;
 import org.eclipse.che.ide.api.resources.Resource;
 import org.eclipse.che.ide.dto.DtoFactory;
@@ -33,7 +35,6 @@
 import java.util.List;
 import java.util.Set;
 
-import static com.google.common.base.Preconditions.checkState;
 import static org.eclipse.che.ide.api.notification.StatusNotification.DisplayMode.EMERGE_MODE;
 import static org.eclipse.che.ide.api.notification.StatusNotification.Status.FAIL;
 import static org.eclipse.che.ide.ext.java.shared.ClasspathEntryKind.LIBRARY;
@@ -104,11 +105,9 @@
 
         final Resource resource = appContext.getResource();
 
-        checkState(resource != null);
+        Preconditions.checkState(resource != null);
 
-        final Optional<Project> optProject = resource.getRelatedProject();
-
-        checkState(optProject.isPresent());
+        final Optional<Project> project = resource.getRelatedProject();
 
         final List<ClasspathEntryDto> entries = new ArrayList<>();
         for (String path : libs) {
@@ -123,20 +122,16 @@
         for (String path : projects) {
             entries.add(dtoFactory.createDto(ClasspathEntryDto.class).withPath(path).withEntryKind(PROJECT));
         }
-
-        final Project project = optProject.get();
-
-        Promise<Void> promise = classpathUpdater.setRawClasspath(project.getLocation().toString(), entries);
+        Promise<Void> promise = classpathUpdater.setRawClasspath(project.get().getLocation().toString(), entries);
 
         promise.then(new Operation<Void>() {
             @Override
             public void apply(Void arg) throws OperationException {
-                project.synchronize().then(new Operation<Resource[]>() {
-                    @Override
-                    public void apply(Resource[] arg) throws OperationException {
-                        eventBus.fireEvent(new ClasspathChangedEvent(project.getLocation().toString(), entries));
+                eventBus.fireEvent(new ClasspathChangedEvent(project.get().getLocation().toString(), entries));
+                final Optional<Container> parent = resource.getParent();
+                if (parent.isPresent()) {
+                    parent.get().synchronize();
                 }
-                });
             }
         }).catchError(new Operation<PromiseError>() {
             @Override",1
"TextureAtlas, fixed typo in previous commit"," 		}
 
 		public void setY (float y) {
-			super.setY(y + region.offsetY);
+			super.setY(y + region.offetY);
 		}
 
 		public void setBounds (float x, float y, float width, float height) {",1
fix #411,"      * @return proxy invoker
      */
     public static Invoker parseInvoker(Object proxyObject) {
+        Field field;
         try {
-            Field field = proxyObject.getClass().getField(""proxyInvoker"");
+            field = proxyObject.getClass().getField(""proxyInvoker"");
+            if (field != null) {
                 if (!field.isAccessible()) {
                     field.setAccessible(true);
                 }
                 return (Invoker) field.get(proxyObject);
+            } else {
+                return null;
+            }
         } catch (Exception e) {
             return null;
         }",1
[Dubbo-2798] fix 2798 on branch 2.6.x,"                     && Modifier.isPublic(setter.getModifiers())
                     && setter.getParameterTypes().length == 1) {
                 Class<?> type = setter.getParameterTypes()[0];
-                String propertyName = name.substring(3, 4).toLowerCase() + name.substring(4);
-                String property = StringUtils.camelToSplitName(propertyName, ""-"");
+                String property = StringUtils.camelToSplitName(name.substring(3, 4).toLowerCase() + name.substring(4), ""-"");
                 props.add(property);
                 Method getter = null;
                 try {
@@ -224,7 +223,7 @@
                                     }
                                     reference = new RuntimeBeanReference(value);
                                 }
-                                beanDefinition.getPropertyValues().addPropertyValue(propertyName, reference);
+                                beanDefinition.getPropertyValues().addPropertyValue(property, reference);
                             }
                         }
                     }",1
JENKINS-42646# fix branch auto-creation logic for empty repo,"         }
 
         try {
-            createBranchIfNotPresent(apiUrl,owner,repoName,accessToken);
             String sha = content.getSha();
-            Map<String,Object> body = new HashMap<>();
-            body.put(""message"", content.getMessage());
-            body.put(""content"", content.getBase64Data());
-
-            if(!StringUtils.isBlank(content.getBranch())){
-                body.put(""branch"", content.getBranch());
-            }
-            if(!StringUtils.isBlank(sha)){
-                body.put(""sha"", sha);
-            }
-            final Map ghResp = HttpRequest.put(String.format(""%s/repos/%s/%s/contents/%s"",
-                    apiUrl,
-                    owner,
-                    repoName,
-                    content.getPath()))
-                    .withAuthorization(""token ""+accessToken)
-                    .withBody(body)
-                    .to(Map.class);
-
-            if(ghResp == null){
-                throw new ServiceException.UnexpectedErrorException(""Failed to save file to Github: ""+content.getPath());
-            }
-
-            final Map ghContent = (Map) ghResp.get(""content"");
-
-            if(ghContent == null){
-                throw new ServiceException.UnexpectedErrorException(""Failed to save file: ""+content.getPath());
-            }
-
-            return new GithubFile(new GithubContent.Builder()
-                    .sha((String)ghContent.get(""sha""))
-                    .name((String) ghContent.get(""name""))
-                    .repo(repoName)
-                    .owner(owner)
-                    .path((String) ghContent.get(""path""))
-                    .build());
-        } catch (IOException e) {
-            throw new ServiceException.UnexpectedErrorException(""Failed to save file: ""+e.getMessage(), e);
-        }
-    }
-
-
-    /**
-     * Auto creates branch if:
-     * <br>
-     *  <li>content.branch is provided</li>
-     *  <li>sha is not provided</li>
-     *  <li>autoCreateBranch is false or null</li>
-     *  <li>if its not empty repo</li>
-     */
-    private void createBranchIfNotPresent(String apiUrl, String owner, String repoName, String accessToken) throws IOException {
-        //If no branch or sha is provided or auto branchc reate flag is false then skip creation of branch
-        if(StringUtils.isBlank(content.getBranch()) || !StringUtils.isBlank(content.getSha())
-                || (content.isAutoCreateBranch() != null && !content.isAutoCreateBranch())){
-            return;
-        }
-
-        //If its empty repo, we can't create the branch on it. It gets created doing content creation
-        if(isEmptyRepo(apiUrl,owner,repoName,accessToken)){
-            return;
-        }
-        //check if branch exists
+            //Lets check if this branch exists, if not then create it
+            if(!StringUtils.isBlank(content.getBranch()) && (content.isAutoCreateBranch() == null || content.isAutoCreateBranch())){
                 try {
                     HttpRequest.head(String.format(""%s/repos/%s/%s/branches/%s"",
                             apiUrl,
@@ -137,9 +76,8 @@
                             repoName,
                             content.getBranch())).withAuthorization(""token ""+accessToken).to(String.class);
                 } catch (ServiceException.NotFoundException e) {
+                    //branch doesn't exist, lets create new one
 
-            String sha = content.getSha();
-            //branch doesn't exist, lets create new one
                     //1. Find commit sha off which this branch will be created
                     //2. We need to find default branch first
                     GHRepoEx repo = HttpRequest.get(String.format(""%s/repos/%s/%s"", apiUrl,
@@ -184,16 +122,44 @@
                 }
             }
 
-    private boolean isEmptyRepo(String apiUrl, String owner, String repoName, String accessToken) throws IOException {
-        try {
-            HttpRequest.head(String.format(""%s/repos/%s/%s/contents"",
+            Map<String,Object> body = new HashMap<>();
+            body.put(""message"", content.getMessage());
+            body.put(""content"", content.getBase64Data());
+
+            if(!StringUtils.isBlank(content.getBranch())){
+                body.put(""branch"", content.getBranch());
+            }
+            if(!StringUtils.isBlank(sha)){
+                body.put(""sha"", sha);
+            }
+            final Map ghResp = HttpRequest.put(String.format(""%s/repos/%s/%s/contents/%s"",
                     apiUrl,
                     owner,
-                    repoName)).withAuthorization(""token "" + accessToken).to(String.class);
-        }catch (ServiceException.NotFoundException e){
-            //its empty, return true
-            return true;
+                    repoName,
+                    content.getPath()))
+                    .withAuthorization(""token ""+accessToken)
+                    .withBody(body)
+                    .to(Map.class);
+
+            if(ghResp == null){
+                throw new ServiceException.UnexpectedErrorException(""Failed to save file to Github: ""+content.getPath());
             }
-        return false;
+
+            final Map ghContent = (Map) ghResp.get(""content"");
+
+            if(ghContent == null){
+                throw new ServiceException.UnexpectedErrorException(""Failed to save file: ""+content.getPath());
+            }
+
+            return new GithubFile(new GithubContent.Builder()
+                    .sha((String)ghContent.get(""sha""))
+                    .name((String) ghContent.get(""name""))
+                    .repo(repoName)
+                    .owner(owner)
+                    .path((String) ghContent.get(""path""))
+                    .build());
+        } catch (IOException e) {
+            throw new ServiceException.UnexpectedErrorException(""Failed to save file: ""+e.getMessage(), e);
+        }
     }
 }
\ No newline at end of file",1
Fixed missing keystore algorithm on IBM JDKs,"         String trustStore = getProperty(properties, ""trustStore"", keyStore);
         String trustStorePassword = getProperty(properties, ""trustStorePassword"", keyStorePassword);
 
-        String keyManagerAlgorithm = properties.getProperty(""keyManagerAlgorithm"", TrustManagerFactory.getDefaultAlgorithm());
-        String trustManagerAlgorithm = properties.getProperty(""trustManagerAlgorithm"", TrustManagerFactory.getDefaultAlgorithm());
+        String keyManagerAlgorithm = properties.getProperty(""keyManagerAlgorithm"", ""SunX509"");
+        String trustManagerAlgorithm = properties.getProperty(""trustManagerAlgorithm"", ""SunX509"");
         String protocol = properties.getProperty(""protocol"", ""TLS"");
 
         final char[] keyStorePassPhrase = keyStorePassword.toCharArray();",1
Fix XPath implementation throwing exception," 		dummyRoot.children = Collections.singletonList(t); // don't set t's parent.
 
 		Collection<ParseTree> work = Collections.<ParseTree>singleton(dummyRoot);
+		work.add(dummyRoot);
 
 		int i = 0;
 		while ( i < elements.length ) {",1
Fix StackOverFlow on certificate method,"      * @param port     The SSL port
      */
     public static AuthenticationScheme certificate(String certURL, String password, String certType, int port) {
-        return certificate(certURL, password, certType, port, new NoKeystoreSpecImpl());
+        return certificate(certURL, password, certType, port);
     }
 
     /**",1
"Fixed an error, made by me in previous commit ","           ""INSERT INTO "" + CTableNames.DEBUGGERS_TABLE
               + ""(name, host, port) VALUES(?, ?, ?) RETURNING id"";
               
-    try (PreparedStatement statement = connection.getConnection().prepareStatement(query)) {
+    try (PreparedStatement statement = connection.getConnection().prepareStatement(query);
+         ResultSet resultSet = statement.executeQuery()) {
 
       statement.setString(1, name);
       statement.setString(2, host);
       statement.setInt(3, port);
 
       int id = -1;
-      try (ResultSet resultSet = statement.executeQuery()) {    
+
         while (resultSet.next()) {
           id = resultSet.getInt(""id"");
         }
-      }
+      
       return new DebuggerTemplate(id, name, host, port, provider);
 
     } catch (final SQLException e) {",1
Use Files.move instead of File.renameTo," import java.nio.charset.Charset;
 import java.nio.file.Files;
 import java.nio.file.Path;
-import java.nio.file.StandardCopyOption;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Scanner;
@@ -153,7 +152,10 @@
         reader.close();
         writer.close();
 
-        Files.move(temporaryPath, filePath, StandardCopyOption.REPLACE_EXISTING);
+        if (!temporaryPath.toFile().renameTo(filePath.toFile())) {
+            throw new IOException(""Fixed file could not be renamed. Original path = "" + filePath.toAbsolutePath());
+        }
+        temporaryPath.toFile().delete();
     }
 
     private void writeUntilEOF() throws IOException {",1
fix bug," 		double min = Double.MAX_VALUE;
 
 		for (Double[] data : datas) {
-			if (data.length > 0) {
 			List<Double> dataList = Arrays.asList(data);
 			double tmp = Collections.min(dataList);
 
@@ -40,7 +39,6 @@
 				min = tmp;
 			}
 		}
-		}
 		return min;
 	}
 ",1
Fix javadoc warning in Combination," 
 import groovy.lang.Binding;
 import hudson.Util;
+import hudson.matrix.MatrixBuild.MatrixBuildExecution;
 
 import java.util.ArrayList;
 import java.util.Arrays;
@@ -95,7 +96,7 @@
      * @see #evalGroovyExpression(AxisList, String)
      * @since 1.515
      * @deprecated as of 1.528
-     *      Use {@link FilterScript#apply(hudson.matrix.MatrixBuild.MatrixBuildExecution, Combination)}
+     *      Use {@link FilterScript#apply(MatrixBuildExecution, Combination)}
      */
     public boolean evalGroovyExpression(AxisList axes, String expression, Binding binding) {
         return FilterScript.parse(expression).apply(axes, this, binding);",1
fix: delete-by-query replica operations did not work due to missing transport action binding,"         bind(TransportKeepAliveAction.class).asEagerSingleton();
         bind(TransportDistributedResultAction.class).asEagerSingleton();
         bind(TransportShardUpsertAction.class).asEagerSingleton();
-        bind(TransportShardDeleteAction.class).asEagerSingleton();
         bind(TransportFetchNodeAction.class).asEagerSingleton();
         bind(TransportKillAllNodeAction.class).asEagerSingleton();
     }",1
Correct equality check in EmailTrackingOpens,"             return false;
         EmailTrackingOpensImpl other = (EmailTrackingOpensImpl) obj;
 
-        if (id == null) {
-            if (other.id != null)
-                return false;
-        } else if (!id.equals(other.id))
-            return false;
+        if (id == null && other.id != null) {
+            return id.equals(other.id);
+        }
+
         if (dateOpened == null) {
             if (other.dateOpened != null)
                 return false;",1
Bugfix: Issue 629,"-/* Diego Felipe Lassa <diegoflassa@gmail.com>
- *
+/*
  * Copyright (C) 2014 Arpit Khurana <arpitkh96@gmail.com>, Vishal Nehra <vishalmeham2@gmail.com>
  *
  * This file is part of Amaze File Manager.
@@ -1060,7 +1059,7 @@
      */
     public void createViews(ArrayList<LayoutElement> bitmap, boolean back, String path,
                             final OpenMode openMode, boolean results, boolean grid) {
-        if ( (bitmap != null) && (isAdded()) ) {
+        if (bitmap != null) {
             synchronized (bitmap) {
                 if (GO_BACK_ITEM)
                     if (!path.equals(""/"") && (openMode == OpenMode.FILE || openMode == OpenMode.ROOT)",1
Fix set sku on discrete order item so it doesn't through an exception in...,"     @Override
     public void setSku(Sku sku) {
         this.sku = sku;
-        if (sku.hasRetailPrice()) {
+        if (sku.getRetailPrice() != null) {
             this.baseRetailPrice = sku.getRetailPrice().getAmount();
         }
-        if (sku.hasSalePrice()) {
+        if (sku.getSalePrice() != null) {
             this.baseSalePrice = sku.getSalePrice().getAmount();
         }
         this.itemTaxable = sku.isTaxable();",1
Add utility method ATNConfigSet.getAlts," 		return states;
 	}
 
-	/**
-	 * Gets the complete set of represented alternatives for the configuration
-	 * set.
-	 *
-	 * @return the set of represented alternatives in this configuration set
-	 */
-	@NotNull
-	public BitSet getAlts() {
-		BitSet alts = new BitSet();
-		for (ATNConfig config : configs) {
-			alts.set(config.alt);
-		}
-		return alts;
-	}
-
 	public List<SemanticContext> getPredicates() {
 		List<SemanticContext> preds = new ArrayList<SemanticContext>();
 		for (ATNConfig c : configs) {",1
fix context filter's bug," 
 import org.apache.dubbo.common.utils.StringUtils;
 import org.apache.dubbo.rpc.RpcContext;
+
 import org.jboss.resteasy.spi.ResteasyProviderFactory;
 
 import javax.annotation.Priority;
@@ -28,7 +29,6 @@
 import javax.ws.rs.container.ContainerRequestContext;
 import javax.ws.rs.container.ContainerRequestFilter;
 import java.io.IOException;
-import java.nio.charset.StandardCharsets;
 import java.util.Map;
 
 @Priority(Integer.MIN_VALUE + 1)
@@ -71,14 +71,14 @@
         int size = 0;
         for (Map.Entry<String, String> entry : RpcContext.getContext().getAttachments().entrySet()) {
             String key = entry.getKey();
-            String value = entry.getValue();
+            String value = entry.getKey();
             if (illegalForRest(key) || illegalForRest(value)) {
                 throw new IllegalArgumentException(""The attachments of "" + RpcContext.class.getSimpleName() + "" must not contain ',' or '=' when using rest protocol"");
             }
 
             // TODO for now we don't consider the differences of encoding and server limit
             if (value != null) {
-                size += value.getBytes(StandardCharsets.UTF_8).length;
+                size += value.getBytes(""UTF-8"").length;
             }
             if (size > MAX_HEADER_SIZE) {
                 throw new IllegalArgumentException(""The attachments of "" + RpcContext.class.getSimpleName() + "" is too big"");",1
Fix malformed JSON in EidResolver.java,"         }
         else {
             urlString = GOOGLE_PROXIMITY_BEACON_API_GET_FOR_OBSERVED_URL + ""?key="" + mGoogleProximityBeaconApiKey;
-            String jsonString = ""{\""observations\"":[{\""advertisedId\"":  {\""type\"": \""EDDYSTONE_EID\"",\""id\"": \""""+base64EncodedData+""\""}}],\""namespacedTypes\"":[\""""+mResolutionAttachmentNamespacedType+""\""]}"";
+            String jsonString = ""{\""observations\"":[{\""advertisedId\"":  {\""type\"": \""EDDYSTONE_EID\"",\""id\"": \""""+base64EncodedData+""\""}}],\""namespacedTypes:\"":[\""""+mResolutionAttachmentNamespacedType+""\""]}"";
             new AsyncCall(urlString, jsonString, new AsyncCallback() {
                 @Override
                 public void onResponse(Integer statusCode, String body, Exception exception) {",1
"Fix for ""NPE onSizeChanged"" #41","         if (DBG) Log.d(TAG, ""onColumnSync column width:"" + mColumnWidth);
 
         for (int pos = 0; pos < syncPosition; pos++) {
-            //Check for weirdness again
-            final Double heightRatio = positionHeightRatios.get(pos);
-            if(heightRatio == null){
-                break;
-            }
-
             final GridItemRecord rec = getOrCreateRecord(pos);
+            final double heightRatio = positionHeightRatios.get(pos);
             final int height = (int) (mColumnWidth * heightRatio);
             rec.heightRatio = heightRatio;
 ",1
"Enhance OType: fix for LINKBAG, add isEmbedded() method"," 
   public boolean isMultiValue() {
     return this == EMBEDDEDLIST || this == EMBEDDEDMAP || this == EMBEDDEDSET || this == LINKLIST || this == LINKMAP
-        || this == LINKSET || this == LINKBAG;
+        || this == LINKSET;
   }
 
   public boolean isLink() {
-    return this == LINK || this == LINKSET || this == LINKLIST || this == LINKMAP || this == LINKBAG;
-  }
-  
-  public boolean isEmbedded() {
-	  return this == EMBEDDED || this == EMBEDDEDLIST || this == EMBEDDEDMAP || this == EMBEDDEDSET;
+    return this == LINK || this == LINKSET || this == LINKLIST || this == LINKMAP;
   }
 
   public Class<?> getDefaultJavaType() {",1
Fixed signatures,"     // JDK fails here without ""unchecked"", Eclipse complains that it is unnecessary
     @SuppressWarnings({ ""unchecked"", ""varargs"" })
     @SafeVarargs
-    public static <T> Predicate<T> allOf(Predicate<T>... predicates) {
+    public static <T> Predicate<T> allOf(Predicate<? super T>... predicates) {
         Objects.requireNonNull(predicates, ""predicates is null"");
         return t -> List.of(predicates).foldLeft(true, (bool, pred) -> bool && pred.test(t));
     }
@@ -117,7 +117,7 @@
     // JDK fails here without ""unchecked"", Eclipse complains that it is unnecessary
     @SuppressWarnings({ ""unchecked"", ""varargs"" })
     @SafeVarargs
-    public static <T> Predicate<T> anyOf(Predicate<T>... predicates) {
+    public static <T> Predicate<T> anyOf(Predicate<? super T>... predicates) {
         Objects.requireNonNull(predicates, ""predicates is null"");
         return t -> List.of(predicates).find(pred -> pred.test(t)).isDefined();
     }
@@ -134,7 +134,7 @@
     // JDK fails here without ""unchecked"", Eclipse complains that it is unnecessary
     @SuppressWarnings({ ""unchecked"", ""varargs"" })
     @SafeVarargs
-    public static <T> Predicate<T> noneOf(Predicate<T>... predicates) {
+    public static <T> Predicate<T> noneOf(Predicate<? super T>... predicates) {
         Objects.requireNonNull(predicates, ""predicates is null"");
         return anyOf(predicates).negate();
     }",1
"ArgumentsBuilder: make SOCKS proxy authorization optional, add null checks if proxy url is set","                 if (proxy != null) {
                     switch (proxy.getProxyType()) {
                         case MANUAL:
-                            if (proxy.getHttpProxy() != null && !proxy.getHttpProxy().isEmpty()) {          //< HTTP proxy
+                            if (!proxy.getHttpProxy().isEmpty()) {          //< HTTP proxy
                                 argsBuilder.add(""--proxy-type=http"");
                                 argsBuilder.add(String.format(""--proxy=%s"", proxy.getHttpProxy()));
-                            } else if (proxy.getSocksProxy() != null && !proxy.getSocksProxy().isEmpty()) {  //< SOCKS5 proxy
+                            } else if (!proxy.getSocksProxy().isEmpty()) {  //< SOCKS5 proxy
                                 argsBuilder.add(""--proxy-type=socks5"");
                                 argsBuilder.add(String.format(""--proxy=%s"", proxy.getSocksProxy()));
-                                if (proxy.getSocksUsername() != null && !proxy.getSocksUsername().isEmpty()
-                                        && proxy.getSocksPassword() != null && !proxy.getSocksPassword().isEmpty()) {
                                 argsBuilder.add(String.format(""--proxy-auth=%s:%s"", proxy.getSocksUsername(),
                                         proxy.getSocksPassword()));
-                                }
                             } else {
                                 // TODO Not supported yet by PhantomJS
                                 checkArgument(true, ""PhantomJS supports only HTTP and Socks5 Proxy currently"");",1
Fix a signed right shift issue in BitArray.readUnsignedByte(),"    * @return The value of the parsed byte.
    */
   public int readUnsignedByte() {
-    int value;
+    byte b;
     if (bitOffset != 0) {
-      value = (data[byteOffset] << bitOffset)
-          | ((data[byteOffset + 1] & 0xFF) >>> (8 - bitOffset));
+      b = (byte) ((data[byteOffset] << bitOffset)
+          | (data[byteOffset + 1] >> (8 - bitOffset)));
     } else {
-      value = data[byteOffset];
+      b = data[byteOffset];
     }
     byteOffset++;
-    return value & 0xFF;
+    // Converting a signed byte into unsigned.
+    return b & 0xFF;
   }
 
   /**",1
Add `FulfillmentGroupItem`s for any child `OrderItems`,"                 fulfillmentGroupItem.setQuantity(1);
                 fulfillmentGroupItem = fulfillmentGroupItemDao.save(fulfillmentGroupItem);
                 fg.getFulfillmentGroupItems().add(fulfillmentGroupItem);
-
-                // Do the same for any child order items (add-ons)
-                for (OrderItem childItem : option.getOrderItem().getChildOrderItems()) {
-                    FulfillmentGroupItem childFulfillmentGroupItem = fulfillmentGroupItemDao.create();
-                    childFulfillmentGroupItem.setFulfillmentGroup(fg);
-                    childFulfillmentGroupItem.setOrderItem(childItem);
-                    childFulfillmentGroupItem.setQuantity(1);
-                    childFulfillmentGroupItem = fulfillmentGroupItemDao.save(childFulfillmentGroupItem);
-                    fg.getFulfillmentGroupItems().add(childFulfillmentGroupItem);
-                }
             } else {
                 // There are three potential scenarios where a fulfillment group item exists:
                 //   1: It has been previously created and exists in the database and",1
mixins: Don't post mouse events that have already been posted," 
 import java.awt.event.MouseEvent;
 import net.runelite.api.mixins.Copy;
-import net.runelite.api.mixins.Inject;
 import net.runelite.api.mixins.Mixin;
 import net.runelite.api.mixins.Replace;
 import net.runelite.api.mixins.Shadow;
@@ -39,9 +38,6 @@
 	@Shadow(""clientInstance"")
 	private static RSClient client;
 
-	@Inject
-	private int isInEvent;
-
 	@Copy(""mousePressed"")
 	abstract void rs$mousePressed(MouseEvent mouseEvent);
 
@@ -67,44 +63,22 @@
 	@Replace(""mousePressed"")
 	public synchronized void mousePressed(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mousePressed(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mousePressed(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 
 	@Override
 	@Replace(""mouseReleased"")
 	public synchronized void mouseReleased(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mouseReleased(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mouseReleased(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 
 	@Override
@@ -122,22 +96,11 @@
 	@Replace(""mouseEntered"")
 	public synchronized void mouseEntered(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mouseEntered(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mouseEntered(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 
 
@@ -145,65 +108,32 @@
 	@Replace(""mouseExited"")
 	public synchronized void mouseExited(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mouseExited(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mouseExited(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 
 	@Override
 	@Replace(""mouseDragged"")
 	public synchronized void mouseDragged(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mouseDragged(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mouseDragged(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 
 	@Override
 	@Replace(""mouseMoved"")
 	public synchronized void mouseMoved(MouseEvent mouseEvent)
 	{
-		if (isInEvent == 0)
-		{
 		mouseEvent = client.getCallbacks().mouseMoved(mouseEvent);
-		}
 		if (!mouseEvent.isConsumed())
 		{
-			isInEvent++;
-			try
-			{
 			rs$mouseMoved(mouseEvent);
 		}
-			finally
-			{
-				isInEvent--;
-			}
-		}
 	}
 }",1
avoid writing 2 new lines without content,"             }
             int capacity = buffer.remaining() - 10; // be safe (we'll have to add size, ending, etc.)
             int size = Math.min(nextPart.buffer.remaining(), capacity);
-            if (size != 0) {
             buffer.put(getBytes(Integer.toHexString(size)));
             buffer.put(END_PADDING);
             for (int i = 0; i < size; i++) {
                 buffer.put(nextPart.buffer.get());
             }
             buffer.put(END_PADDING);
-            }
             if (!nextPart.buffer.hasRemaining()) {
                 if (nextPart.isLast) {
                     finishState = CLOSING;",1
Bugfix: WebSocketFrameEncoder08.java for payload length > 65535 bytes,"         encoded.writeShort(dataLen);
       } else {
         encoded.writeByte(applyMaskBit(0x7F));
-        encoded.writeLong(dataLen);
+        encoded.writeInt(dataLen);
       }
 
       if (shouldMask()) {",1
Normalized uploaded file assets to lowercase the extension," import java.io.InputStream;
 import java.io.UnsupportedEncodingException;
 import java.net.URLDecoder;
+import java.util.Collection;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
@@ -124,7 +125,6 @@
 
     /**
      * Generates a filename as a set of Hex digits.
-     *
      * @param size
      * @return
      */
@@ -141,7 +141,7 @@
      * Will assemble the url from the passed in properties as 
      *     /{entityType}/{fileName}
      *     /product/7001-ab12
-     * <p>
+     * 
      * If the properties above are not set, it will generate the fileName randomly.
      *     
      * @param url
@@ -179,16 +179,11 @@
         return path.append(fileName).toString();
     }
 
-    private static String normalizeFileExtension(MultipartFile file) {
-        int index = file.getOriginalFilename().lastIndexOf(""."");
-        return file.getOriginalFilename().substring(0, index + 1) + file.getOriginalFilename().substring(index + 1, file.getOriginalFilename().length()).toLowerCase();
-    }
-
     @Override
     @Transactional(TransactionUtils.DEFAULT_TRANSACTION_MANAGER)
     public StaticAsset createStaticAssetFromFile(MultipartFile file, Map<String, String> properties) {
         try {
-            return createStaticAsset(file.getInputStream(), normalizeFileExtension(file), file.getSize(), properties);
+            return createStaticAsset(file.getInputStream(), file.getOriginalFilename(), file.getSize(), properties);
         } catch (IOException e) {
             throw new RuntimeException(e);
         }
@@ -237,7 +232,8 @@
             
             if (getShouldAcceptNonImageAsset()) {
                 newAsset =  createNonImageAsset(inputStream, fileName, properties);
-            } else {
+            }
+            else {
                 throw new RuntimeException(""Selected Asset/File was not valid image."");
             }
         }
@@ -270,16 +266,17 @@
 
     /**
      * Gets the count URL based on the original fullUrl. If requested in legacy format this will return URLs like:
-     * <p>
+     * 
      *  /path/to/image.jpg-1
      *  /path/to/image.jpg-2
-     * <p>
+     *  
      * Whereas if this is in non-legacy format (<b>legacy</b> == false):
-     * <p>
+     * 
      *  /path/to/image-1.jpg
      *  /path/to/image-2.jpg
-     * <p>
+     *  
      * Used to deal with duplicate URLs of uploaded assets
+     *  
      */
     protected String getCountUrl(String fullUrl, int count, boolean legacyFormat) {
         String countUrl = fullUrl + '-' + count;",1
Fix the change is not notify when Delete() is executed," import android.text.TextUtils;
 import com.activeandroid.Cache;
 import com.activeandroid.Model;
-import com.activeandroid.content.ContentProvider;
 import com.activeandroid.query.Join.JoinType;
 import com.activeandroid.util.Log;
 import com.activeandroid.util.SQLiteUtils;
@@ -207,8 +206,6 @@
 		}
 		else {
 			SQLiteUtils.execSql(toSql(), getArguments());
-			Cache.getContext().getContentResolver().notifyChange(ContentProvider
-					.createUri(mType, null), null);
 			return null;
 		}
 	}",1
opponent info plugin: Fix SDMM hiscore lookup," 		}
 
 		EnumSet<WorldType> worldType = client.getWorldType();
-		if (worldType.contains(WorldType.SEASONAL_DEADMAN))
+		if (worldType.contains(WorldType.DEADMAN))
+		{
+			hiscoreEndpoint = HiscoreEndpoint.DEADMAN;
+		}
+		else if (worldType.contains(WorldType.SEASONAL_DEADMAN))
 		{
 			hiscoreEndpoint = HiscoreEndpoint.SEASONAL_DEADMAN;
 		}
-		else if (worldType.contains(WorldType.DEADMAN))
-		{
-			hiscoreEndpoint = HiscoreEndpoint.DEADMAN;
-		}
 		else
 		{
 			hiscoreEndpoint = HiscoreEndpoint.NORMAL;",1
Fix changelog entries after cherry-picking," 
 
     public static final boolean SNAPSHOT = false;
-    public static final Version CURRENT = new Version(550199, SNAPSHOT, org.elasticsearch.Version.V_2_3_3);
+    public static final Version CURRENT = new Version(550299, SNAPSHOT, org.elasticsearch.Version.V_2_3_3);
 
     static {
         // safe-guard that we don't release a version with DEBUG_MODE set to true",1
Fixed trivial typo in Javadoc," 	// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
 	/**
-	 * The name of the {@link javax.persistence.spi.PersistenceProvider} implementor
+	 * THe name of the {@link javax.persistence.spi.PersistenceProvider} implementor
 	 * <p/>
 	 * See JPA 2 sections 9.4.3 and 8.2.1.4
 	 */",1
Fixes StandardHostValve.invoke() not being transformed when excludeurl is not set,"  */
 package com.navercorp.pinpoint.plugin.tomcat;
 
+import com.navercorp.pinpoint.bootstrap.config.ExcludePathFilter;
 import com.navercorp.pinpoint.bootstrap.config.Filter;
 import com.navercorp.pinpoint.bootstrap.config.ProfilerConfig;
-import com.navercorp.pinpoint.bootstrap.config.SkipFilter;
 
 /**
  * @author Jongho Moon
@@ -24,14 +24,14 @@
  */
 public class TomcatConfiguration {
     private final boolean tomcatHidePinpointHeader;
-    private final Filter<String> tomcatExcludeUrlFilter;
+    private Filter<String> tomcatExcludeUrlFilter;
 
     public TomcatConfiguration(ProfilerConfig config) {
         this.tomcatHidePinpointHeader = config.readBoolean(""profiler.tomcat.hidepinpointheader"", true);
-        if (config.getTomcatExcludeProfileMethodFilter() == null) {
-            this.tomcatExcludeUrlFilter = new SkipFilter<String>();
-        } else {
-            this.tomcatExcludeUrlFilter = config.getTomcatExcludeUrlFilter();
+        final String tomcatExcludeURL = config.readString(""profiler.tomcat.excludeurl"", """");
+        
+        if (!tomcatExcludeURL.isEmpty()) {
+            this.tomcatExcludeUrlFilter = new ExcludePathFilter(tomcatExcludeURL);
         }
     }
 ",1
Added Proxy Authentication ; fixes #328,"         final HttpParams httpParams = this.httpClient.getParams();
         httpParams.setParameter(ConnRoutePNames.DEFAULT_PROXY, proxy);
     }
-    /**
-     * Sets the Proxy by it's hostname,port,username and password
-     *
-     * @param hostname the hostname (IP or DNS name)
-     * @param port     the port number. -1 indicates the scheme default port.
-     * @param username the username
-     * @param password the password
-     */
-     public void setProxy(String hostname,int port,String username,String password){
-         httpClient.getCredentialsProvider().setCredentials(
-    		    new AuthScope(hostname, port),
-    		    new UsernamePasswordCredentials(username, password));
-        final HttpHost proxy = new HttpHost(hostname, port);
-        final HttpParams httpParams = this.httpClient.getParams();
-        httpParams.setParameter(ConnRoutePNames.DEFAULT_PROXY, proxy);
-     }
-
 
     /**
      * Sets the SSLSocketFactory to user when making requests. By default,",1
Fix AndroidZipFileHandle.length() throwing NullPointerException," 
 	@Override
 	public long length() {
-		return assetFd != null ? assetFd.getLength() : 0;
+		try {
+			return getAssetFileDescriptor().getLength();
+		} catch (IOException e) {
+		}
+		return 0;
 	}
 
 	@Override",1
Fix logger in VendorDatabaseIdProvider," /**
- *    Copyright 2009-2016 the original author or authors.
+ *    Copyright 2009-2015 the original author or authors.
  *
  *    Licensed under the Apache License, Version 2.0 (the ""License"");
  *    you may not use this file except in compliance with the License.
@@ -23,6 +23,7 @@
 
 import javax.sql.DataSource;
 
+import org.apache.ibatis.executor.BaseExecutor;
 import org.apache.ibatis.logging.Log;
 import org.apache.ibatis.logging.LogFactory;
 
@@ -39,7 +40,7 @@
  */
 public class VendorDatabaseIdProvider implements DatabaseIdProvider {
   
-  private static final Log log = LogFactory.getLog(VendorDatabaseIdProvider.class);
+  private static final Log log = LogFactory.getLog(BaseExecutor.class);
 
   private Properties properties;
 ",1
Fixed classloading if classes are not in the default classloader but tccl (backport),"             try {
                 return theClassLoader.loadClass(className);
             } catch (ClassNotFoundException ignore) {
-
-                // Reset selected classloader and try with others
-                theClassLoader = null;
             }
         }
-
         // If failed and this is a Hazelcast class try again with our classloader
         if (className.startsWith(HAZELCAST_BASE_PACKAGE) || className.startsWith(HAZELCAST_ARRAY)) {
             theClassLoader = ClassLoaderUtil.class.getClassLoader();",1
Fix typo in CSS,"     public String value;
 
     @JsonProperty
-    public Boolean important;
+    public Boolean imporant;
   }
 
   private static class CSSProperty {",1
Fix bad Javadoc," import com.github.javaparser.TokenRange;
 
 /**
- * A constructor call.
- * <br/>In <code>new HashMap.Entry&lt;String, Long>(15) {public String getKey() {return null;}};</code>
- * HashMap.Entry is the type, String and Long are type arguments, 15 is an argument, and everything in { }
+ * A constructor call. <br/>In <code>new HashMap.Entry<String, Long>(15) {public String getKey() {return null;}};</code>
+ * HashMap is the scope, Entry is the type, String and Long are type arguments, 15 is an argument, and everything in { }
  * is the anonymous class body.
- * <p/>In <code>class B { class C { public void a() { new B().new C(); } } }</code> the scope is <code>new B()</code>
- * of ObjectCreationExpr <code>new B().new C()</code>
  *
  * @author Julio Vilmar Gesser
  */",1
fix bug where ticker uses wrong privacy option,"                         switch (privateNotifications) {
                             case 0:
                                 builder.setTicker(String.format(""%s: %s"", lastMessage.mContact, lastMessage.mBody));
-                                break;
                             case 1:
                                 builder.setTicker(String.format(""%s: %s"", lastMessage.mContact, sRes.getString(R.string.new_message)));
-                                break;
                             case 2:
                                 builder.setTicker(String.format(""%s: %s"", ""QKSMS"", sRes.getString(R.string.new_message)));
-                                break;
                         }
                     }
 
@@ -328,13 +325,10 @@
                     switch (Integer.parseInt(sPrefs.getString(SettingsFragment.PRIVATE_NOTIFICATION, ""0""))) {
                         case 0:
                             inboxStyle.addLine(Html.fromHtml(""<strong>"" + message.getName() + ""</strong> "" + message.getBody()));
-                            break;
                         case 1:
                             inboxStyle.addLine(Html.fromHtml(""<strong>"" + message.getName() + ""</strong> "" + sRes.getString(R.string.new_message)));
-                            break;
                         case 2:
                             inboxStyle.addLine(Html.fromHtml(""<strong>"" + ""QKSMS"" + ""</strong> "" + sRes.getString(R.string.new_message)));
-                            break;
                     }
                 }
 ",1
Fix NUIManager issues,"     @Override
     public void popScreen() {
         if (!screens.isEmpty()) {
-            UIScreenLayer top = screens.peek();
-            closeScreen(top);
-            if (!top.isLowerLayerVisible()) {
+            UIScreenLayer popped = screens.pop();
+            screenLookup.inverse().remove(popped);
+            popped.onClosed();
+            if (!popped.isLowerLayerVisible()) {
                 UIScreenLayer current = screens.peek();
                 if (current != null) {
                     current.onShow();",1
fix hotchemi/PermissionsDispatcher#51 based on @aurae sketch code," package permissions.dispatcher;
 
-import android.Manifest;
 import android.app.Activity;
 import android.content.Context;
 import android.content.Intent;
@@ -10,30 +9,13 @@
 import android.provider.Settings;
 import android.support.annotation.Nullable;
 import android.support.v4.app.ActivityCompat;
-import android.support.v4.util.SimpleArrayMap;
 
 import static android.os.Build.VERSION_CODES.FROYO;
 import static android.os.Build.VERSION_CODES.GINGERBREAD;
-import static android.os.Build.VERSION_CODES.ICE_CREAM_SANDWICH;
-import static android.os.Build.VERSION_CODES.KITKAT_WATCH;
-import static android.os.Build.VERSION_CODES.JELLY_BEAN;
 import static android.support.v4.content.PermissionChecker.checkSelfPermission;
 
 public final class PermissionUtils {
 
-    // Map of dangerous permissions introduced in later framework versions.
-    // Used to conditionally bypass permission-hold checks on older devices.
-    private static final SimpleArrayMap<String, Integer> MIN_SDK_PERMISSIONS;
-    static {
-        MIN_SDK_PERMISSIONS = new SimpleArrayMap<>(6);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.ADD_VOICEMAIL, ICE_CREAM_SANDWICH);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.BODY_SENSORS, KITKAT_WATCH);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.READ_CALL_LOG, JELLY_BEAN);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.READ_EXTERNAL_STORAGE, JELLY_BEAN);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.USE_SIP, GINGERBREAD);
-        MIN_SDK_PERMISSIONS.put(Manifest.permission.WRITE_CALL_LOG, JELLY_BEAN);
-    }
-
     private PermissionUtils() {
     }
 
@@ -53,21 +35,6 @@
     }
 
     /**
-     * Returns true if the permission exists in this SDK version
-     *
-     * @param permission permission
-     * @return returns true if the permission exists in this SDK version
-     */
-    private static boolean permissionExists(String permission) {
-        // Check if the permission could potentially be missing on this device
-        Integer minVersion = MIN_SDK_PERMISSIONS.get(permission);
-
-        // If null was returned from the above call, there is no need for a device API level check for the permission;
-        // otherwise, we check if its minimum API level requirement is met
-        return minVersion == null || Build.VERSION.SDK_INT >= minVersion;
-    }
-
-    /**
      * Returns true if the Activity or Fragment has access to all given permissions.
      *
      * @param context     context
@@ -76,7 +43,7 @@
      */
     public static boolean hasSelfPermissions(Context context, String... permissions) {
         for (String permission : permissions) {
-            if (permissionExists(permission) && checkSelfPermission(context, permission) != PackageManager.PERMISSION_GRANTED) {
+            if (checkSelfPermission(context, permission) != PackageManager.PERMISSION_GRANTED) {
                 return false;
             }
         }",1
[1.9.x] Fix #852: query paramters should not be removed from the redirec...,"             builder.setMethod(""GET"");
         }
         builder.setUrl(uri.toString());
+        builder.resetQuery();
         for (String cookieStr : response.getHeaders().values(Header.Cookie)) {
             builder.addOrReplaceCookie(CookieDecoder.decode(cookieStr));
         }",1
Fixed #640 - Screen timeout in case of popup mode. ,"             lockManager.acquireWifiAndCpu();
 
             hideControls(DEFAULT_CONTROLS_DURATION, DEFAULT_CONTROLS_HIDE_TIME);
-
-            windowLayoutParams.flags = WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON
-                    | WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;
-            windowManager.updateViewLayout(playerImpl.getRootView(), windowLayoutParams);
         }
 
         @Override
@@ -681,9 +677,6 @@
             updateNotification(R.drawable.ic_play_arrow_white);
             videoPlayPause.setBackgroundResource(R.drawable.ic_play_arrow_white);
             lockManager.releaseWifiAndCpu();
-
-            windowLayoutParams.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;
-            windowManager.updateViewLayout(playerImpl.getRootView(), windowLayoutParams);
         }
 
         @Override
@@ -699,9 +692,6 @@
             updateNotification(R.drawable.ic_replay_white);
             videoPlayPause.setBackgroundResource(R.drawable.ic_replay_white);
             lockManager.releaseWifiAndCpu();
-
-            windowLayoutParams.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE;
-            windowManager.updateViewLayout(playerImpl.getRootView(), windowLayoutParams);
         }
 
         @Override",1
Fix duration logging in DistributedQueryRunner," import static com.facebook.presto.tests.AbstractTestQueries.TEST_SYSTEM_PROPERTIES;
 import static com.google.common.collect.Iterables.getOnlyElement;
 import static io.airlift.units.Duration.nanosSince;
+import static io.airlift.units.Duration.succinctNanos;
 import static java.util.Objects.requireNonNull;
 import static java.util.concurrent.TimeUnit.MILLISECONDS;
 import static java.util.concurrent.TimeUnit.SECONDS;
@@ -265,7 +266,7 @@
             connectorIds.add(server.createCatalog(catalogName, connectorName, properties));
         }
         ConnectorId connectorId = getOnlyElement(connectorIds);
-        log.info(""Created catalog %s (%s) in %s"", catalogName, connectorId, nanosSince(start));
+        log.info(""Created catalog %s (%s) in %s"", catalogName, connectorId, succinctNanos(start));
 
         // wait for all nodes to announce the new catalog
         start = System.nanoTime();
@@ -279,7 +280,7 @@
                 throw Throwables.propagate(e);
             }
         }
-        log.info(""Announced catalog %s (%s) in %s"", catalogName, connectorId, nanosSince(start));
+        log.info(""Announced catalog %s (%s) in %s"", catalogName, connectorId, succinctNanos(start));
     }
 
     private boolean isConnectionVisibleToAllNodes(ConnectorId connectorId)",1
Issue #1700 - Set the keepAlive flag from the config parameter,"         c.setReadMode(cfg.getReadMode());
         c.setSubscriptionMode(cfg.getSubscriptionMode());
         c.setDnsMonitoringInterval(cfg.getDnsMonitoringInterval());
-        c.setKeepAlive(cfg.isKeepAlive());
 
         return c;
     }",1
Fixed exception when writing to cache with an uncached service," import android.app.Application;
 
 import com.octo.android.robospice.persistence.CacheManager;
-import com.octo.android.robospice.persistence.exception.CacheCreationException;
-import com.octo.android.robospice.persistence.exception.CacheSavingException;
 
 /***
- * Concrete implementation of {@link SpiceService} with an empty CacheManager.
- * Using this class, requests will not be cached.
- * 
+ * Concrete implementation of {@link SpiceService} with an empty CacheManager. Using this class,
+ * requests will not be cached.
  * @author rciovati
  */
 public class UncachedSpiceService extends SpiceService {
@@ -17,13 +14,7 @@
     @Override
     public CacheManager createCacheManager(Application application) {
         // Just return an empty CacheManager
-        return new CacheManager() {
-            @Override
-            public <T> T saveDataToCacheAndReturnData(T data, Object cacheKey)
-                throws CacheSavingException, CacheCreationException {
+        return new CacheManager();
+    }
 
-                return data;
-            }
-        };
-    }
 }",1
Hot fix for UIImageSlideshow," 
     @Override
     public void onDraw(Canvas canvas) {
-        if (isImageExists()) {
+        if (images.get(index) != null) {
             images.get(index).onDraw(canvas);
         }
     }
 
     @Override
     public Vector2i getPreferredContentSize(Canvas canvas, Vector2i sizeHint) {
-        if (isImageExists()) {
+        if (images.get(index) != null) {
             return images.get(index).getPreferredContentSize(canvas, sizeHint);
         }
         return Vector2i.zero();
@@ -175,8 +175,4 @@
     public List<UIImage> getImages() {
         return images;
     }
-
-    private boolean isImageExists() {
-        return !images.isEmpty() && index < images.size() && images.get(index) != null;
-    }
 }",1
Fix NPE when SetsCookie is used and no cookie have been returned by server," 			JVar allCookiesList = methodBody.decl(stringListClass, ""allCookies"", setCookiesList);
 
 			// for loop over list... add if in string array
-			JForEach forEach = methodBody._if(allCookiesList.ne(JExpr._null()))._then() //
-					.forEach(classes().STRING, ""rawCookie"", allCookiesList);
+			JForEach forEach = methodBody.forEach(classes().STRING, ""rawCookie"", allCookiesList);
 			JVar rawCookieVar = forEach.var();
 
 			JBlock forLoopBody = forEach.body();",1
Misc minor bug fixes," 				mAccountJid.requestFocus();
 				return;
 			}
-			if (jid.isDomainJid()) {
-				mAccountJid.setError(getString(R.string.invalid_jid));
-				mAccountJid.requestFocus();
-				return;
-			}
 			final String password = mPassword.getText().toString();
 			final String passwordConfirm = mPasswordConfirm.getText().toString();
 			if (registerNewAccount) {
@@ -334,14 +329,11 @@
 		getMenuInflater().inflate(R.menu.editaccount, menu);
 		final MenuItem showQrCode = menu.findItem(R.id.action_show_qr_code);
 		final MenuItem showBlocklist = menu.findItem(R.id.action_show_block_list);
-		final MenuItem showMoreInfo = menu.findItem(R.id.action_server_info_show_more);
 		if (mAccount == null) {
 			showQrCode.setVisible(false);
 			showBlocklist.setVisible(false);
-			showMoreInfo.setVisible(false);
 		} else if (mAccount.getStatus() != Account.State.ONLINE || !mAccount.getXmppConnection().getFeatures().blocking()) {
 			showBlocklist.setVisible(false);
-			showMoreInfo.setVisible(false);
 		}
 		return true;
 	}",1
fix prepare on multi node bug," 					BinaryRowDataPacket binRowDataPk = new BinaryRowDataPacket();
 					binRowDataPk.read(fieldPackets, row);
 					binRowDataPk.packetId = ++packetId;
-					//binRowDataPk.write(source);
-					buffer = binRowDataPk.write(buffer, session.getSource(), true);
+					binRowDataPk.write(source);
 				} else {
 					row.packetId = ++packetId;
 					buffer = row.write(buffer, source, true);
@@ -589,18 +588,17 @@
 						columToIndx.put(fieldName,
 								new ColMeta(i, fieldPkg.type));
 					}
-				} else {
+				} else if (primaryKey != null && primaryKeyIndex == -1) {
+					// find primary key index
 					FieldPacket fieldPkg = new FieldPacket();
 					fieldPkg.read(field);
 					fieldPackets.add(fieldPkg);
-					fieldCount = fields.size();
-					if (primaryKey != null && primaryKeyIndex == -1) {
-					// find primary key index
 					String fieldName = new String(fieldPkg.name);
 					if (primaryKey.equalsIgnoreCase(fieldName)) {
 						primaryKeyIndex = i;
+						fieldCount = fields.size();
 					}
-				}   }
+				}
 				if (!shouldSkip) {
 					field[3] = ++packetId;
 					buffer = source.writeToBuffer(field, buffer);
@@ -658,28 +656,17 @@
 				// @since 2016-03-25
 				dataMergeSvr.onNewRecord(dataNode, row);
 			} else {
-				RowDataPacket rowDataPkg =null;
 				// cache primaryKey-> dataNode
 				if (primaryKeyIndex != -1) {
-					 rowDataPkg = new RowDataPacket(fieldCount);
+					RowDataPacket rowDataPkg = new RowDataPacket(fieldCount);
 					rowDataPkg.read(row);
 					String primaryKey = new String(rowDataPkg.fieldValues.get(primaryKeyIndex));
 					LayerCachePool pool = MycatServer.getInstance().getRouterservice().getTableId2DataNodeCache();
 					pool.putIfAbsent(priamaryKeyTable, primaryKey, dataNode);
 				}
 				row[3] = ++packetId;
-				if( prepared ) {
-					if(rowDataPkg==null) {
-						rowDataPkg = new RowDataPacket(fieldCount);
-						rowDataPkg.read(row);
-					}
-					BinaryRowDataPacket binRowDataPk = new BinaryRowDataPacket();
-					binRowDataPk.read(fieldPackets, rowDataPkg);
-					binRowDataPk.write(session.getSource());
-				} else {
 				session.getSource().write(row);
 			}
-			}
 
 		} catch (Exception e) {
 			handleDataProcessException(e);",1
Fix model group supporting  pre/post bind callbacks,"  * EpoxyModel#hide()} to have the associated view be set to GONE.
  */
 @SuppressWarnings(""rawtypes"")
-public class EpoxyModelGroup extends EpoxyModelWithHolder<Holder>
-    implements GeneratedModel<Holder> {
+public class EpoxyModelGroup extends EpoxyModelWithHolder<Holder> {
 
   protected final List<? extends EpoxyModel<?>> models;
   /** By default we save view state if any of the models need to save state. */
@@ -107,32 +106,6 @@
     shouldSaveViewState = saveState;
   }
 
-  @Override
-  public void handlePostBind(Holder groupHolder, final int position) {
-    iterateModels(groupHolder, new IterateModelsCallback() {
-      @Override
-      public void onModel(EpoxyModel model, Object boundObject, View view) {
-        if (model instanceof GeneratedModel) {
-          //noinspection unchecked
-          ((GeneratedModel) model).handlePostBind(boundObject, position);
-        }
-      }
-    });
-  }
-
-  @Override
-  public void handlePreBind(final EpoxyViewHolder holder, Holder groupHolder, final int position) {
-    iterateModels(groupHolder, new IterateModelsCallback() {
-      @Override
-      public void onModel(EpoxyModel model, Object boundObject, View view) {
-        if (model instanceof GeneratedModel) {
-          //noinspection unchecked
-          ((GeneratedModel) model).handlePreBind(holder, boundObject, position);
-        }
-      }
-    });
-  }
-
   @CallSuper
   @Override
   public void bind(Holder holder) {",1
Add missing delegation method. Fix FasterXML/jackson-dataformat-xml#97.,"     public JsonStreamContext getParsingContext() {
         return delegate.getParsingContext();
     }
-    
-    @Override public boolean isExpectedStartArrayToken() { return delegate.isExpectedStartArrayToken(); }
 
     /*
     /**********************************************************",1
cluescrolls: add bullroarer to items list for bullroarer clue," import static net.runelite.api.EquipmentInventorySlot.*;
 import static net.runelite.api.EquipmentInventorySlot.LEGS;
 import net.runelite.api.Item;
-import net.runelite.api.ItemID;
 import static net.runelite.api.ItemID.*;
 import net.runelite.api.coords.LocalPoint;
 import net.runelite.api.coords.WorldPoint;
@@ -163,7 +162,7 @@
 		new EmoteClue(""Yawn in the rogues' general store. Beware of double agents! Equip an adamant square shield, blue dragon vambraces and a rune pickaxe."", new WorldPoint(3026, 3701, 0), YAWN, item(ADAMANT_SQ_SHIELD), item(BLUE_DHIDE_VAMB), item(RUNE_PICKAXE)),
 		new EmoteClue(""Yawn at the top of Trollheim. Equip a lava battlestaff, black dragonhide vambraces and a mind shield."", new WorldPoint(2590, 4452, 0), YAWN, item(LAVA_BATTLESTAFF), item(BLACK_DHIDE_VAMB), item(MIND_SHIELD)),
 		new EmoteClue(""Yawn in the centre of Arceuus library. Nod your head before you talk to me. Equip blue dragonhide vambraces, adamant boots and an adamant dagger."", new WorldPoint(1632, 3807, 0), YAWN, YES, item(BLUE_DHIDE_VAMB), item(ADAMANT_BOOTS), item(ADAMANT_DAGGER)),
-		new EmoteClue(""Swing a bullroarer at the top of the watchtower. Beware of double agents! Equip a dragon plateskirt, climbing boots and a dragon chainbody."", new WorldPoint(2932, 4712, 0), BULL_ROARER, item(DRAGON_PLATESKIRT), item(CLIMBING_BOOTS), item(DRAGON_CHAINBODY_3140), item(ItemID.BULL_ROARER))
+		new EmoteClue(""Swing a bullroarer at the top of the watchtower. Beware of double agents! Equip a dragon plateskirt, climbing boots and a dragon chainbody."", new WorldPoint(2932, 4712, 0), BULL_ROARER, item(DRAGON_PLATESKIRT), item(CLIMBING_BOOTS), item(DRAGON_CHAINBODY_3140))
 	);
 
 	private static SingleItemRequirement item(int itemId)",1
Fix extracted mods crash report file name for Windows,"             {
                 Class<?> crashreportclass = classLoader.loadClass(""b"");
                 Object crashreport = crashreportclass.getMethod(""a"", Throwable.class, String.class).invoke(null, re, ""FML has discovered extracted jar files in the mods directory.\nThis breaks mod loading functionality completely.\nRemove the directories and replace with the jar files originally provided."");
-                File crashreportfile = new File(new File(coreMods.getParentFile(),""crash-reports""),String.format(""fml-crash-%1$tY-%1$tm-%1$td_%1$tH.%1$tM.%1$tS.txt"",Calendar.getInstance()));
+                File crashreportfile = new File(new File(coreMods.getParentFile(),""crash-reports""),String.format(""fml-crash-%1$tY-%1$tm-%1$td_%1$tT.txt"",Calendar.getInstance()));
                 crashreportclass.getMethod(""a"",File.class).invoke(crashreport, crashreportfile);
                 System.out.println(""#@!@# FML has crashed the game deliberately. Crash report saved to: #@!@# "" + crashreportfile.getAbsolutePath());
             } catch (Exception e)",1
[java] Tidy up ClassScope code," import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceBodyDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceType;
+import net.sourceforge.pmd.lang.java.ast.ASTEnumDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTExtendsList;
 import net.sourceforge.pmd.lang.java.ast.ASTFormalParameter;
 import net.sourceforge.pmd.lang.java.ast.ASTFormalParameters;
@@ -594,15 +595,19 @@
             types.addAll(firstParentOfType.findDescendantsOfType(ASTTypeParameter.class));
         }
 
-        // then search class level types, from inner-most to outer-most
-        List<ASTClassOrInterfaceDeclaration> enclosingClasses = argument
-                .getParentsOfType(ASTClassOrInterfaceDeclaration.class);
-        for (ASTClassOrInterfaceDeclaration enclosing : enclosingClasses) {
-            ASTTypeParameters classLevelTypeParameters = enclosing.getFirstChildOfType(ASTTypeParameters.class);
+        // then search class level types
+        ASTClassOrInterfaceDeclaration enclosingClassOrEnum = argument
+                .getFirstParentOfType(ASTClassOrInterfaceDeclaration.class);
+        if (enclosingClassOrEnum == null) {
+            argument.getFirstParentOfType(ASTEnumDeclaration.class);
+        }
+        ASTTypeParameters classLevelTypeParameters = null;
+        if (enclosingClassOrEnum != null) {
+            classLevelTypeParameters = enclosingClassOrEnum.getFirstChildOfType(ASTTypeParameters.class);
+        }
         if (classLevelTypeParameters != null) {
             types.addAll(classLevelTypeParameters.findDescendantsOfType(ASTTypeParameter.class));
         }
-        }
         return resolveGenericType(typeImage, types);
     }
 
@@ -626,10 +631,14 @@
     }
 
     private Node getNextSibling(Node current) {
-        if (current.jjtGetParent().jjtGetNumChildren() > current.jjtGetChildIndex() + 1) {
-            return current.jjtGetParent().jjtGetChild(current.jjtGetChildIndex() + 1);
+        Node nextSibling = null;
+        for (int i = 0; i < current.jjtGetParent().jjtGetNumChildren() - 1; i++) {
+            if (current.jjtGetParent().jjtGetChild(i) == current) {
+                nextSibling = current.jjtGetParent().jjtGetChild(i + 1);
+                break;
             }
-        return null;
+        }
+        return nextSibling;
     }
 
     public String toString() {",1
Resolved null pointer exception in getValues,"                     if (org.hasNext()) {
                         prevValue = org.next();
                     }
-                    if (prevValue != null) {
                     if (prevValue.getX() >= from) {
                         nextValue = prevValue;
                         found = true;
@@ -196,7 +195,6 @@
                             prevValue = nextValue;
                         }
                     }
-                    }
                     if (!found) {
                         nextValue = null;
                     }",1
Fix compile issue in testapp,"                 .setRecurring(form.recurring.get())
                 .setLifetime(form.persistent.get() ? Lifetime.FOREVER : Lifetime.UNTIL_NEXT_BOOT)
                 .setService(DemoJobService.class)
-                .setTrigger(Trigger.executionWindow(
+                .setTrigger(Trigger.ExecutionWindowTrigger.newInstance(
                     form.getWinStartSeconds(), form.getWinEndSeconds()))
                 .setReplaceCurrent(form.replaceCurrent.get())
                 .setRetryStrategy(jobDispatcher.newRetryStrategy(",1
Do not remove item from array to maintain the consistency with the index," 
 	public void unregisterObject(Object3D object) {
 		if (mObjectLookup.contains(object)) {
-			int index = mObjectLookup.indexOf(object);
-			mObjectLookup.set(index,null);
+			mObjectLookup.remove(object);
 		}
 		object.setPickingColor(Object3D.UNPICKABLE);
 	}",1
iOS: server socket bugfix!," import java.util.List;
 import java.util.Map;
 
-import cli.MonoTouch.ObjCRuntime.Arch;
 import cli.System.AsyncCallback;
 import cli.System.IAsyncResult;
 import cli.System.Net.Dns;
@@ -35,19 +34,33 @@
 	public int port;
 	private ServerSocketHints hints;
 	
-	/** Our listeners we have created (1 per port). Will prevent ""address already in use"" errors if used more than once. */
+	/** Our listeners we have created. Will prevent ""address already in use"" errors if used more than once. */
 	static Map<Integer, TcpListener> listeners = new HashMap<Integer, TcpListener>();
 	/** Our clients that we have accepted or null for none (1 per port). We'll constantly poll in background. */
-	static Map<Integer, TcpClient> clients = new HashMap<Integer, TcpClient>();
+	Map<Integer, TcpClient> clients = new HashMap<Integer, TcpClient>();
 	/** Our accept callbacks instantiated (1 per port). */
-	static Map<Integer, AsyncCallback> clientCallbacks = new HashMap<Integer, AsyncCallback>();
+	Map<Integer, AsyncCallback> clientCallbacks = new HashMap<Integer, AsyncCallback>();
+	/** Our accept callback method (so we can do accept timeouts!). */
+	final AsyncCallback.Method clientCallbackMethod = new AsyncCallback.Method() {		
+		@Override
+		public void Invoke (IAsyncResult ar) {
+		    // Get the listener that handles the client request.
+		    TcpListener listener = (TcpListener)ar.get_AsyncState();
+		
+		    // End the operation and display the received data on the console.
+		    clients.put(port, listener.EndAcceptTcpClient(ar));
+		
+		    // Process the connection here. (Add the client to a  server table, read data, etc.)
+		    Gdx.app.debug(""IOSServerSocket"", ""Client connected"");
+		}
+	};
 	
 
 	/** The sockets that are connected. Will need to keep them to dispose. */
 	private List<IOSSocket> sockets = new ArrayList<IOSSocket>();
 	
 	
-	public IOSServerSocket(Protocol protocol, final int port, final ServerSocketHints hints) {
+	public IOSServerSocket(Protocol protocol, int port, final ServerSocketHints hints) {
 		if (protocol == Protocol.TCP) {
 			this.protocol = protocol;
 			this.port = port;
@@ -60,10 +73,7 @@
 					// get local IP to connect with
 					IPAddress ipAddress = null;
 					String host = Dns.GetHostName(); 
-					if (cli.MonoTouch.ObjCRuntime.Runtime.Arch.Value == Arch.DEVICE) {
-						// the "".local"" is not added on the simulator!
-						host = host + "".local""; 
-					}
+					host = host + "".local""; // the "".local"" might not be needed on the simulator!?
 					IPAddress[] ips = Dns.GetHostAddresses(host);
 					for (int i = 0; i < ips.length; i++) {
 						IPAddress ip = ips[i];
@@ -92,19 +102,7 @@
 					
 					// our accept listener (runs in background and waits for the next connection)
 					// NOTE: listener.Pending() wasn't working, so we use async callbacks instead
-					AsyncCallback clientCallback = new AsyncCallback(new AsyncCallback.Method() {		
-						@Override
-						public void Invoke (IAsyncResult ar) {
-						    // Get the listener that handles the client request.
-						    TcpListener listener = (TcpListener)ar.get_AsyncState();
-						
-						    // End the operation and display the received data on the console.
-						    clients.put(port, listener.EndAcceptTcpClient(ar));
-						
-						    // Process the connection here. (Add the client to a  server table, read data, etc.)
-						    Gdx.app.debug(""IOSServerSocket"", ""Client connected"");
-						}
-					});
+					AsyncCallback clientCallback = new AsyncCallback(clientCallbackMethod);
 					clientCallbacks.put(port, clientCallback);
 					listener.BeginAcceptTcpClient(clientCallback, listener);
 				}",1
Fix a typo in the sample data,"         .build());
     db.insert(TodoItem.TABLE, null, new TodoItem.Builder()
         .listId(holidayPresentsListId)
-        .description(""Cola for Jesse W."")
+        .description(""Coal for Jesse W."")
         .build());
 
     long workListId = db.insert(TodoList.TABLE, null, new TodoList.Builder()",1
[Dubbo-1159] Fix suffixes in abstract config," 
     private static final Pattern PATTERN_KEY = Pattern.compile(""[*,\\-._0-9a-zA-Z]+"");
     private static final Map<String, String> legacyProperties = new HashMap<String, String>();
-    private static final String[] SUFFIXES = new String[]{""Config"", ""Bean""};
+    private static final String[] SUFFIXS = new String[]{""Config"", ""Bean""};
 
     static {
         legacyProperties.put(""dubbo.protocol.name"", ""dubbo.service.protocol"");
@@ -166,7 +166,7 @@
 
     private static String getTagName(Class<?> cls) {
         String tag = cls.getSimpleName();
-        for (String suffix : SUFFIXES) {
+        for (String suffix : SUFFIXS) {
             if (tag.endsWith(suffix)) {
                 tag = tag.substring(0, tag.length() - suffix.length());
                 break;",1
fix nullpointer bug," import android.content.Intent;
 import android.content.ServiceConnection;
 import android.content.pm.PackageManager;
-import android.content.pm.ResolveInfo;
 import android.os.IBinder;
 import android.os.Message;
 import android.os.Messenger;
@@ -1087,10 +1086,10 @@
     private void verifyServiceDeclaration() {
         final PackageManager packageManager = mContext.getPackageManager();
         final Intent intent = new Intent(mContext, BeaconService.class);
-        List<ResolveInfo> resolveInfo =
+        List resolveInfo =
                 packageManager.queryIntentServices(intent,
                         PackageManager.MATCH_DEFAULT_ONLY);
-        if (resolveInfo != null && resolveInfo.size() == 0) {
+        if (resolveInfo.size() == 0) {
             throw new ServiceNotDeclaredException();
         }
     }",1
Fixes possible NullPointerException,"             return Collections.emptyList();
         }
         final byte[] rowKey = getOriginalKey(result.getRow());
-        final String agentId = BytesUtils.toStringAndRightTrim(rowKey, 0, AGENT_NAME_MAX_LEN);
+        final String agentId = BytesUtils.toString(rowKey, 0, AGENT_NAME_MAX_LEN).trim();
         final long reverseTimestamp = BytesUtils.bytesToLong(rowKey, AGENT_NAME_MAX_LEN);
         final long timestamp = TimeUtils.recoveryTimeMillis(reverseTimestamp);
         NavigableMap<byte[], byte[]> qualifierMap = result.getFamilyMap(AGENT_STAT_CF_STATISTICS);",1
UNDERTOW-295: NPE fixed,"                 handle.tearDown();
             }
             ServletRequestContext current = SecurityActions.currentServletRequestContext();
-            if (current != null && current.getSession() != null && current.getSession().getSession() == session) {
+            if (current != null && current.getSession().getSession() == session) {
                 current.setSession(null);
             }
         }",1
ref #3037 - SpecFilter fix filter schemas,"                         if (property != null) {
                             Optional<Schema> filteredProperty = filter.filterSchemaProperty(property, definition, (String) propName, params, cookies, headers);
                             if (filteredProperty.isPresent()) {
-                                clonedProperties.put((String) propName, filteredProperty.get());
+                                clonedProperties.put((String) propName, property);
                             }
                         }
                     }",1
Fix memory leak in ViewGroupDescriptor," import java.util.Collections;
 import java.util.IdentityHashMap;
 import java.util.Map;
-import java.util.WeakHashMap;
 
 final class ViewGroupDescriptor extends ChainedDescriptor<ViewGroup> {
   private final Map<ViewGroup, ElementContext> mElementToContextMap =
       Collections.synchronizedMap(new IdentityHashMap<ViewGroup, ElementContext>());
 
-  /**
-   * This is a cache that maps from a View to the Fragment that contains it. If the View isn't
-   * contained by a Fragment, then this maps the View to itself. For Views contained by Fragments,
-   * we emit the Fragment instead, and then let the Fragment's descriptor emit the View as its sole
-   * child. This allows us to see Fragments in the inspector as part of the UI tree.
-   */
-  private final Map<View, Object> mViewToElementMap =
-      Collections.synchronizedMap(new WeakHashMap<View, Object>());
-
   public ViewGroupDescriptor() {
   }
 
@@ -64,25 +54,6 @@
     context.unhook();
   }
 
-  private Object getElementForView(ViewGroup parentView, View view) {
-    Object element = mViewToElementMap.get(view);
-    if (element != null) {
-      if (view.getParent() == parentView) {
-        return element;
-      }
-      mViewToElementMap.remove(view);
-    }
-
-    Object fragment = FragmentCompatUtil.findFragmentForView(view);
-    if (fragment != null) {
-      mViewToElementMap.put(view, fragment);
-      return fragment;
-    } else {
-      mViewToElementMap.put(view, view);
-      return view;
-    }
-  }
-
   @Override
   protected void onGetChildren(ViewGroup element, Accumulator<Object> children) {
     ElementContext context = mElementToContextMap.get(element);
@@ -90,6 +61,14 @@
   }
 
   private final class ElementContext {
+    // This is a cache that maps from a View to the Fragment that contains it. If the
+    // View isn't contained by a Fragment, then this maps the View to itself.
+    // For Views contained by Fragments, we emit the Fragment instead, and then let
+    // the Fragment's descriptor emit the View as its sole child. This allows us to
+    // see Fragments in the inspector as part of the UI tree.
+    private final Map<View, Object> mViewToElementMap =
+        Collections.synchronizedMap(new IdentityHashMap<View, Object>());
+
     private ViewGroup mElement;
     private boolean mIsDecorView;
 
@@ -100,6 +79,7 @@
     public void unhook() {
       if (mElement != null) {
         mElement = null;
+        mViewToElementMap.clear();
       }
     }
 
@@ -111,7 +91,7 @@
       for (int i = 0, N = mElement.getChildCount(); i < N; ++i) {
         final View child = mElement.getChildAt(i);
         if (isChildVisible(child)) {
-          final Object element = getElementForView(mElement, child);
+          final Object element = getElementForView(child);
           children.store(element);
         }
       }
@@ -120,5 +100,25 @@
     private boolean isChildVisible(View child) {
       return !mIsDecorView || !(child instanceof DOMHiddenView);
     }
+
+    private Object getElementForView(View view) {
+      if (view == null) {
+        return null;
+      }
+
+      Object element = mViewToElementMap.get(view);
+      if (element != null) {
+        return element;
+      }
+
+      Object fragment = FragmentCompatUtil.findFragmentForView(view);
+      if (fragment != null) {
+        mViewToElementMap.put(view, fragment);
+        return fragment;
+      } else {
+        mViewToElementMap.put(view, view);
+        return view;
+      }
+    }
   }
 }",1
Fix wrong theming of rename dialog edit text in Kitkat," import java.io.InputStream;
 import java.util.ArrayList;
 import java.util.Collections;
+import java.util.Timer;
+import java.util.TimerTask;
 
 import butterknife.BindView;
 import butterknife.ButterKnife;
@@ -533,7 +535,7 @@
                 return true;
 
             case R.id.action_rename:
-                final EditText editTextNewName = new EditText(this);
+                final EditText editTextNewName = new EditText(getApplicationContext());
                 editTextNewName.setText(StringUtils.getPhotoNameByPath(getCurrentMedia().getPath()));
 
                 AlertDialog renameDialog = AlertDialogsHelper.getInsertTextDialog(this, editTextNewName, R.string.rename_photo_action);",1
Fix #11: stackoverflow for string containing more newLines than maxLines and maxLines > 1,"                 "" target="" + targetWidth + "" maxLines="" + maxLines + "" lineCount="" + lineCount);
 
         if (lineCount > maxLines) {
-            // For the case that `text` has more newline characters than `maxLines`.
-            if ((high - low) < precision) {
-                return low;
-            }
             return getAutofitTextSize(text, paint, targetWidth, maxLines, low, mid, precision,
                     displayMetrics);
         }",1
fix nullpointerexception in RepositoryViewActivity,"         followItem.setTitle(isStarred ? R.string.unstar : R.string.star);
 
         MenuItem parentRepo = menu.findItem(R.id.m_parent_repo);
-        if(repository != null && repository.isFork() != null)
         parentRepo.setVisible(repository.isFork());
 
         return super.onPrepareOptionsMenu(menu);",1
Fixed image scaling,"         if (image.get() != null) {
             if (ignoreAspectRatio) {
                 ScaleMode scaleMode = canvas.getCurrentStyle().getTextureScaleMode();
-
-                if (image.get().getWidth() > (image.get().getHeight() * 2)) {
-
-                    canvas.getCurrentStyle().setTextureScaleMode(ScaleMode.SCALE_FIT);
-                } else {
-                    canvas.getCurrentStyle().setTextureScaleMode(ScaleMode.SCALE_FILL);
-                }
+                canvas.getCurrentStyle().setTextureScaleMode(ScaleMode.STRETCH);
                 canvas.drawTexture(image.get(), tint.get());
                 canvas.getCurrentStyle().setTextureScaleMode(scaleMode);
             } else {",1
Fix size-setting methods ignoring height," 
 	/** Sets the minWidth and minHeight to the specified values. */
 	public Container<T> minSize (float width, float height) {
-		minSize(new Fixed(width), new Fixed(height));
+		minSize(new Fixed(width));
 		return this;
 	}
 
@@ -326,7 +326,7 @@
 
 	/** Sets the prefWidth and prefHeight to the specified value. */
 	public Container<T> prefSize (float width, float height) {
-		prefSize(new Fixed(width), new Fixed(height));
+		prefSize(new Fixed(width));
 		return this;
 	}
 
@@ -378,7 +378,7 @@
 
 	/** Sets the maxWidth and maxHeight to the specified values. */
 	public Container<T> maxSize (float width, float height) {
-		maxSize(new Fixed(width), new Fixed(height));
+		maxSize(new Fixed(width));
 		return this;
 	}
 ",1
HLS AAC fix,"     this.extractor = extractor;
     this.shouldSpliceIn = shouldSpliceIn;
     sampleQueues = new SparseArray<DefaultTrackOutput>();
+    extractor.init(this);
   }
 
   /**
@@ -70,7 +71,6 @@
    */
   public void init(Allocator allocator) {
     this.allocator = allocator;
-    this.extractor.init(this);
   }
 
   /**",1
IntelliJ Idea 2016.1 failure fixed,"         return map(keyComparator(), (k, v) -> Tuple.of(k, valueMapper.apply(v)));
     }
 
-    // DEV-NOTE: this overridden method fixes compilation failure in IntelliJ Idea 2016.1
-    @Override
-    public <U extends V> TreeMap<K, V> merge(Map<? extends K, U> that, BiFunction<? super V, ? super U, ? extends V> collisionResolution) {
-        return super.merge(that, collisionResolution);
-    }
-
     @Override
     public TreeMap<K, V> put(K key, V value) {
         return new TreeMap<>(entries.insert(new Tuple2<>(key, value)));",1
Fixes #1813 - Video screen plane was facing the wrong direction after…," 				material.setSpecularMethod(new SpecularMethod.Phong());
 				android.setMaterial(material);
 				android.setColor(0xff99C224);
-				//getCurrentScene().addChild(android);
+				getCurrentScene().addChild(android);
 			} catch (NotFoundException e) {
 				e.printStackTrace();
 			}
@@ -74,6 +74,7 @@
 
 			Plane screen = new Plane(3, 2, 2, 2, Vector3.Axis.Z);
 			screen.setMaterial(material);
+            screen.setRotY(180);
 			screen.setX(.1f);
 			screen.setY(-.2f);
 			screen.setZ(1.5f);",1
Temporary fix for HTTP 500 errors from Wikibase. Closes #1746,"         logger.info(""Requesting documents"");
         currentDocs = null;
         int retries = 3;
-        // TODO: remove currentDocs.isEmpty() once https://github.com/Wikidata/Wikidata-Toolkit/issues/402 is solved
-        while ((currentDocs == null || currentDocs.isEmpty()) && retries > 0) {
+        while (currentDocs == null && retries > 0) {
             try {
                 currentDocs = fetcher.getEntityDocuments(qidsToFetch);
             } catch (MediaWikiApiErrorException e) {",1
RefractiveReflectiveBlocksNode.java Checkstyle Fix,"     public static final SimpleUri REFRACTIVE_REFLECTIVE_FBO_URI = new SimpleUri(""engine:fbo.sceneReflectiveRefractive"");
     private static final ResourceUrn CHUNK_MATERIAL_URN = new ResourceUrn(""engine:prog.chunk"");
 
+    private RenderQueuesHelper renderQueues;
+    private WorldRenderer worldRenderer;
+    private BackdropProvider backdropProvider;
+    private RenderingConfig renderingConfig;
+    private WorldProvider worldProvider;
+
+    private Material chunkMaterial;
+
+    private FBO lastUpdatedGBuffer;
+    private FBO refractiveReflectiveFbo;
+
+    private SubmersibleCamera activeCamera;
+
+    private boolean normalMappingIsEnabled;
+    private boolean parallaxMappingIsEnabled;
+    private boolean animatedWaterIsEnabled;
+
+    private StateChange setTerrainNormalsInputTexture;
+    private StateChange setTerrainHeightInputTexture;
+
     // TODO: rename to more meaningful/precise variable names, like waveAmplitude or waveHeight.
     @SuppressWarnings(""FieldCanBeLocal"")
     @Range(min = 0.0f, max = 2.0f)
@@ -95,26 +115,6 @@
     @Range(min = 0.0f, max = 5.0f)
     public static float waterOffsetY;
 
-    private RenderQueuesHelper renderQueues;
-    private WorldRenderer worldRenderer;
-    private BackdropProvider backdropProvider;
-    private RenderingConfig renderingConfig;
-    private WorldProvider worldProvider;
-
-    private Material chunkMaterial;
-
-    private FBO lastUpdatedGBuffer;
-    private FBO refractiveReflectiveFbo;
-
-    private SubmersibleCamera activeCamera;
-
-    private boolean normalMappingIsEnabled;
-    private boolean parallaxMappingIsEnabled;
-    private boolean animatedWaterIsEnabled;
-
-    private StateChange setTerrainNormalsInputTexture;
-    private StateChange setTerrainHeightInputTexture;
-
     @SuppressWarnings(""FieldCanBeLocal"")
     @Range(min = 0.0f, max = 2.0f)
     private float waveOverallScale = 1.0f;",1
Fix Null Pointer Exception in Ground Markers Plugin," 		}
 
 		Tile target = client.getSelectedSceneTile();
-		if (target == null)
-		{
-			return;
-		}
 		markTile(target.getLocalLocation());
 	}
 ",1
Fix EmptyStackException," import com.reactnativenavigation.layouts.Layout;
 import com.reactnativenavigation.params.FabParams;
 import com.reactnativenavigation.params.SnackbarParams;
-import com.reactnativenavigation.screens.Screen;
-
-import java.util.EmptyStackException;
 
 public class SnackbarAndFabContainer extends CoordinatorLayout implements Snakbar.OnDismissListener, Subscriber{
     private Snakbar snakbar;
@@ -70,13 +67,7 @@
             @Override
             public void run() {
                 if (fabParams != null) {
-                    Screen currentScreen = null;
-                    try {
-                        currentScreen = layout.getCurrentScreen();
-                    } catch(EmptyStackException exception) {
-                        currentScreen = null;
-                    }
-                    if (currentScreen != null && currentScreen.getScreenInstanceId().equals(fabParams.screenInstanceId)) {
+                    if (layout.getCurrentScreen().getScreenInstanceId().equals(fabParams.screenInstanceId)) {
                         fabCoordinator.add(fabParams);
                     }
                 }",1
Add null check for timer and assign to variable so it is shutdown..," 
     public RedisClient(final Timer timer, ExecutorService executor, EventLoopGroup group, Class<? extends SocketChannel> socketChannelClass, String host, int port, 
                         int connectTimeout, int commandTimeout) {
-        if (timer == null) {
-            throw new NullPointerException(""timer param can't be null"");
-        }
         this.executor = executor;
-        this.timer = timer;
         addr = new InetSocketAddress(host, port);
         bootstrap = new Bootstrap().channel(socketChannelClass).group(group).remoteAddress(addr);
         bootstrap.handler(new ChannelInitializer<Channel>() {",1
fix gwt," 
     // -- conversion overrides
 
-    @GwtIncompatible
     @Override
     public Character[] toJavaArray() {
         return toJavaArray(Character.class);",1
Deregister invocation only when you manage to complete a future,"     }
 
     private void complete(Object value) {
-        if (future.complete(value)) {
         context.invocationRegistry.deregister(this);
-        }
+        future.complete(value);
     }
 
     private void handleRetry(Object cause) {",1
fixed typo,"         this(name, host, port, null, DEFAULT_SERVICE_HEALTH);
     }
 
-    public RibbonServiceDefinition(String name, String host, int port, ServiceHealth health) {
-        this(name, host, port, null, health);
+    public RibbonServiceDefinition(String name, String host, int port, ServiceHealth healt) {
+        this(name, host, port, null, healt);
     }
 
     public RibbonServiceDefinition(String name, String host, int port,  Map<String, String> meta) {
         this(name, host, port, meta, DEFAULT_SERVICE_HEALTH);
     }
 
-    public RibbonServiceDefinition(String name, String host, int port, Map<String, String> meta, ServiceHealth health) {
+    public RibbonServiceDefinition(String name, String host, int port, Map<String, String> meta, ServiceHealth healt) {
         super(host, port);
         this.name = name;
         this.metaData = meta;
-        this.health = health;
+        this.health = healt;
     }
 
     public RibbonServiceDefinition(ServiceDefinition definition) {",1
Adjust SidecarCollectorFacade to new name validation (#5602)," import org.graylog.plugins.sidecar.rest.models.Collector;
 import org.graylog.plugins.sidecar.services.CollectorService;
 import org.graylog2.contentpacks.EntityDescriptorIds;
+import org.graylog2.contentpacks.exceptions.DivergingEntityConfigurationException;
 import org.graylog2.contentpacks.model.ModelId;
 import org.graylog2.contentpacks.model.ModelType;
 import org.graylog2.contentpacks.model.ModelTypes;
@@ -120,12 +121,19 @@
         final SidecarCollectorEntity collectorEntity = objectMapper.convertValue(entity.data(), SidecarCollectorEntity.class);
 
         final String name = collectorEntity.name().asString(parameters);
-        final String os = collectorEntity.nodeOperatingSystem().asString(parameters);
-        final Optional<Collector> existingCollector = Optional.ofNullable(collectorService.findByNameAndOs(name, os));
+        final String serviceType = collectorEntity.serviceType().asString(parameters);
+        final Optional<Collector> existingCollector = Optional.ofNullable(collectorService.findByName(name));
+        existingCollector.ifPresent(collector -> compareCollectors(name, serviceType, collector));
 
         return existingCollector.map(collector -> NativeEntity.create(entity.id(), collector.id(), TYPE_V1, collector.name(), collector));
     }
 
+    private void compareCollectors(String name, String serviceType, Collector existingCollector) {
+        if (!name.equals(existingCollector.name()) || !serviceType.equals(existingCollector.serviceType())) {
+            throw new DivergingEntityConfigurationException(""Expected service type for Collector with name \"""" + name + ""\"": <"" + serviceType + "">; actual service type: <"" + existingCollector.serviceType() + "">"");
+        }
+    }
+
     @Override
     public Optional<NativeEntity<Collector>> loadNativeEntity(NativeEntityDescriptor nativeEntityDescriptor) {
         return collectorService.get(nativeEntityDescriptor.id().id())",1
[java] Fix concurrency issue on metrics' framework," import java.util.List;
 import java.util.Map;
 import java.util.Set;
-import java.util.concurrent.ConcurrentHashMap;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
@@ -30,7 +29,7 @@
  */
 public final class JavaOperationSignature extends JavaSignature<ASTMethodOrConstructorDeclaration> {
 
-    private static final Map<Integer, JavaOperationSignature> POOL = new ConcurrentHashMap<>();
+    private static final Map<Integer, JavaOperationSignature> POOL = new HashMap<>();
     public final Role role;
     public final boolean isAbstract;
 ",1
TFJ-783 fixed," 
     @Override
     protected void preUpload() throws TwitterException {
-        uploadUrl = ""https://yfrog.com/api/xauth_upload"";
+        uploadUrl = ""https://yfrog.com/api/upload"";
         String signedVerifyCredentialsURL = generateVerifyCredentialsAuthorizationURL(TWITTER_VERIFY_CREDENTIALS_XML_V1);
         Twitter tw = new TwitterFactory().getInstance(this.oauth);
 ",1
"[chat-color] Fix ""Clan Channel Name"" colour being called ""Chan Channel"""," 	@ConfigItem(
 		position = 50,
 		keyName = ""opaqueExamineHighlight"",
-		name = ""Examine highlight"",
+		name = ""Examine Highlight"",
 		description = ""Color of highlights in Examine Text""
 	)
 	default Color opaqueExamineHighlight()
@@ -225,7 +225,7 @@
 	@ConfigItem(
 		position = 52,
 		keyName = ""opaqueFilteredHighlight"",
-		name = ""Filtered highlight"",
+		name = ""Filtered Highlight"",
 		description = ""Color of highlights in Filtered Text""
 	)
 	Color opaqueFilteredHighlight();
@@ -249,7 +249,7 @@
 	@ConfigItem(
 		position = 55,
 		keyName = ""opaqueClanChannelName"",
-		name = ""Clan channel name"",
+		name = ""Chan channel Name"",
 		description = ""Color of Clan Channel Name""
 	)
 	Color opaqueClanChannelName();
@@ -435,7 +435,7 @@
 	@ConfigItem(
 		position = 80,
 		keyName = ""transparentExamineHighlight"",
-		name = ""Examine highlight (transparent)"",
+		name = ""Examine Highlight (transparent)"",
 		description = ""Color of highlights in Examine Text (transparent)""
 	)
 	default Color transparentExamineHighlight()
@@ -454,7 +454,7 @@
 	@ConfigItem(
 		position = 82,
 		keyName = ""transparentFilteredHighlight"",
-		name = ""Filtered highlight (transparent)"",
+		name = ""Filtered Highlight (transparent)"",
 		description = ""Color of highlights in Filtered Text (transparent)""
 	)
 	Color transparentFilteredHighlight();
@@ -478,7 +478,7 @@
 	@ConfigItem(
 		position = 85,
 		keyName = ""transparentClanChannelName"",
-		name = ""Clan channel name (transparent)"",
+		name = ""Chan channel Name (transparent)"",
 		description = ""Color of Clan Channel Name (transparent)""
 	)
 	Color transparentClanChannelName();",1
Fix error in javadoc,"     /** An intermediary rect that changes in every frame according to the transition progress. */
     private final RectF mCurrentRect = new RectF();
 
-    /** Precomputed width difference between {@link #mSrcRect} and {@link #mDstRect}. */
+    /** Precomputed width difference between {@link #mSrcRect} and {@link #mSrcRect}. */
     private float mWidthDiff;
-    /** Precomputed height difference between {@link #mSrcRect} and {@link #mDstRect}. */
+    /** Precomputed height difference between {@link #mSrcRect} and {@link #mSrcRect}. */
     private float mHeightDiff;
     /** Precomputed X offset between the center points of
-     *  {@link #mSrcRect} and {@link #mDstRect}. */
+     *  {@link #mSrcRect} and {@link #mSrcRect}. */
     private float mCenterXDiff;
     /** Precomputed Y offset between the center points of
-     *  {@link #mSrcRect} and {@link #mDstRect}. */
+     *  {@link #mSrcRect} and {@link #mSrcRect}. */
     private float mCenterYDiff;
 
     /** The duration of the transition in milliseconds. The default duration is 5000 ms. */",1
Fix redirect loop in /consentReview,"         final J2EContext context = Pac4jUtils.getPac4jJ2EContext(request, response);
         final String defaultUrl = this.casProperties.getServer().getPrefix().concat(""/consentReview"");
         logic.perform(context, this.pac4jConfig, J2ENopHttpActionAdapter.INSTANCE,
-            defaultUrl, Boolean.TRUE, Boolean.FALSE, Boolean.FALSE, null);
+            defaultUrl, Boolean.FALSE, Boolean.FALSE, Boolean.FALSE, null);
     }
 }",1
Fix java.util.ConcurrentModificationException of AsyncHttpClient.,"             Log.e(LOG_TAG, ""Passed null Context to cancelRequests"");
             return;
         }
-
-        final List<RequestHandle> requestList = requestMap.get(context);
-        requestMap.remove(context);
-
-        if (Looper.myLooper() == Looper.getMainLooper()) {
-            Runnable runnable = new Runnable() {
+        Runnable r = new Runnable() {
             @Override
             public void run() {
-                    cancelRequests(requestList, mayInterruptIfRunning);
-                }
-            };
-            threadPool.submit(runnable);
-        } else {
-            cancelRequests(requestList, mayInterruptIfRunning);
-        }
-    }
-
-    private void cancelRequests(final List<RequestHandle> requestList, final boolean mayInterruptIfRunning) {
+                List<RequestHandle> requestList = requestMap.get(context);
                 if (requestList != null) {
                     for (RequestHandle requestHandle : requestList) {
                         requestHandle.cancel(mayInterruptIfRunning);
                     }
+                    requestMap.remove(context);
+                }
+            }
+        };
+        if (Looper.myLooper() == Looper.getMainLooper()) {
+            new Thread(r).start();
+        } else {
+            r.run();
         }
     }
 ",1
修复 默认节点配置bug," 	public static boolean isAllGlobalTable(DruidShardingParseInfo ctx, SchemaConfig schema) {
 		boolean isAllGlobal = false;
 		for(String table : ctx.getTables()) {
-			TableConfig tableConfig = schema.getTables().get(table);
-			if(tableConfig!=null && tableConfig.isGlobalTable()) {
+			if(schema.getTables().get(table).isGlobalTable()) {
 				isAllGlobal = true;
-				break;
+			} else {
+				return false;
 			}
 		}
 		return isAllGlobal;",1
Add the bad pattern to the exception for debugging,"     public GlobMatcher(String patternStr) {
         try {
             this.pattern = GLOB_COMPILER.compile(patternStr, GlobCompiler.CASE_INSENSITIVE_MASK);
-        } catch (Throwable e) {
-            throw new IllegalArgumentException(String.format(""bad pattern '%s'"", patternStr), e);
+        } catch (MalformedPatternException e) {
+            throw new IllegalArgumentException(""bad pattern"", e);
         }
     }
 ",1
Fixed NPE when calling canBrew,"     @Override
     public ItemStack getOutput(ItemStack input, ItemStack ingredient)
     {
-        if (ingredient != null && input != null && input.getItem() instanceof ItemPotion && isIngredient(ingredient))
+        if (ingredient != null && input != null && input.getItem() instanceof ItemPotion)
         {
             int inputMeta = input.getMetadata();
             int outputMeta = PotionHelper.applyIngredient(inputMeta, ingredient.getItem().getPotionEffect(ingredient));",1
KYLIN-3663 fix deleting project error when project has more than one …,"     }
 
     protected void cleanUnusedHBaseTables() throws IOException {
-        if (""hbase"".equals(config.getStorageUrl().getScheme())) {
+        if (""hbase"".equals(config.getStorageUrl().getScheme()) && !"""".equals(config.getMetadataUrl().getScheme())) {
             final int deleteTimeoutMin = 10; // Unit minute
             try {
                 // use reflection to isolate NoClassDef errors when HBase is not available",1
Fixed: Settings passed from command line don't override the ones from config file,"         // we put back the path.logs so we can use it in the logging configuration file
         builder.put(Environment.PATH_LOGS_SETTING.getKey(), cleanPath(newEnvironment.logsFile().toAbsolutePath().toString()));
 
-        // we put back settings from command line to override the ones from configuration file
-        builder.put(esEnvironment.settings());
         return new Environment(builder.build());
     }
 ",1
Fixed the client shell's list parsing logic,"         } else if(o instanceof List) {
             List<Object> l = (List<Object>) o;
             commandOutput.print(""["");
-            for(Object obj: l) {
+            for(Object obj: l)
                 printObject(obj);
-                commandOutput.print("", "");
-            }
             commandOutput.print(""]"");
         } else if(o instanceof Map) {
             Map<Object, Object> m = (Map<Object, Object>) o;",1
fix for nans cosine prox gradient," 
         INDArray dLda = labels.mulColumnVector(yhatL2normSq);
         dLda.subi(yhat.mulColumnVector(yhatDotyL1norm));
-
-        // transform vals to avoid nans before div
-        yL2norm = Transforms.max(yL2norm, Nd4j.EPS_THRESHOLD,false);
-        yhatL2norm = Transforms.max(yhatL2norm,  Nd4j.EPS_THRESHOLD,false);
-        yhatL2normSq = Transforms.max(yhatL2normSq,  Nd4j.EPS_THRESHOLD,false);
-
         dLda.diviColumnVector(yL2norm);
         dLda.diviColumnVector(yhatL2norm.mul(yhatL2normSq));
         dLda.muli(-1);",1
1.9: Fixed registering armor materials through EnumHelper exploding," import net.minecraft.item.EnumRarity;
 import net.minecraft.item.Item.ToolMaterial;
 import net.minecraft.item.ItemArmor.ArmorMaterial;
-import net.minecraft.util.SoundEvent;
 import net.minecraft.util.math.RayTraceResult;
 import net.minecraft.util.text.TextFormatting;
 import net.minecraft.world.EnumSkyBlock;
@@ -36,7 +35,7 @@
     private static Class[][] commonTypes =
     {
         {EnumAction.class},
-        {ArmorMaterial.class, String.class, int.class, int[].class, int.class, SoundEvent.class},
+        {ArmorMaterial.class, String.class, int.class, int[].class, int.class},
         {EnumArt.class, String.class, int.class, int.class, int.class, int.class},
         {EnumCreatureAttribute.class},
         {EnumCreatureType.class, Class.class, int.class, Material.class, boolean.class, boolean.class},
@@ -54,9 +53,9 @@
     {
         return addEnum(EnumAction.class, name);
     }
-    public static ArmorMaterial addArmorMaterial(String name, String textureName, int durability, int[] reductionAmounts, int enchantability, SoundEvent soundOnEquip)
+    public static ArmorMaterial addArmorMaterial(String name, String textureName, int durability, int[] reductionAmounts, int enchantability)
     {
-        return addEnum(ArmorMaterial.class, name, textureName, durability, reductionAmounts, enchantability, soundOnEquip);
+        return addEnum(ArmorMaterial.class, name, textureName, durability, reductionAmounts, enchantability);
     }
     public static EnumArt addArt(String name, String tile, int sizeX, int sizeY, int offsetX, int offsetY)
     {",1
CAMEL-10894 Fixed test failure,"         if (getResourceResolver() != null) {
             factory.setResourceResolver(getResourceResolver());
         }  
-        if (camelContext != null && !Boolean.parseBoolean(camelContext.getGlobalOptions().get(ACCESS_EXTERNAL_DTD))) {
+        if (!Boolean.parseBoolean(camelContext.getGlobalOptions().get(ACCESS_EXTERNAL_DTD))) {
             try {
                 factory.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, """");
             } catch (SAXException e) {",1
Fix for https://java.net/jira/browse/JERSEY-2626," import java.util.Collection;
 import java.util.Collections;
 import java.util.HashSet;
-import java.util.Iterator;
 import java.util.LinkedList;
 import java.util.List;
 import java.util.Set;
-import java.util.TreeSet;
 import java.util.concurrent.CopyOnWriteArrayList;
 import java.util.logging.Level;
 import java.util.logging.Logger;
@@ -84,13 +82,10 @@
 import org.glassfish.ejb.deployment.descriptor.EjbDescriptor;
 import org.glassfish.internal.data.ApplicationInfo;
 import org.glassfish.internal.data.ModuleInfo;
-import org.glassfish.internal.data.ApplicationRegistry;
 
 import com.sun.ejb.containers.BaseContainer;
 import com.sun.ejb.containers.EjbContainerUtil;
 import com.sun.ejb.containers.EjbContainerUtilImpl;
-import com.sun.enterprise.config.serverbeans.Application;
-import com.sun.enterprise.config.serverbeans.Applications;
 
 /**
  * EJB component provider.
@@ -161,49 +156,12 @@
         configuration.commit();
     }
 
-    private ApplicationInfo getApplicationInfo(EjbContainerUtil ejbUtil) throws NamingException
-    {
-      ApplicationRegistry appRegistry = ejbUtil.getServices().getService(ApplicationRegistry.class);
-      Applications applications = ejbUtil.getServices().getService(Applications.class);
-      String appNamePrefix = (String) initialContext.lookup(""java:app/AppName"");
-      Set<String> appNames = appRegistry.getAllApplicationNames();
-      Set<String> disabledApps = new TreeSet<>();
-      for (String appName : appNames) {
-        if (appName.startsWith(appNamePrefix)) {
-            Application appDesc = applications.getApplication(appName);
-            if (appDesc != null && !ejbUtil.getDeployment().isAppEnabled(appDesc)) {
-                // skip disabled version of the app
-                disabledApps.add(appName);
-            }
-            else
-            {
-                return ejbUtil.getDeployment().get(appName);
-            }
-        }
-      }
-    
-      // grab the latest one, there is no way to make
-      // sure which one the user is actually enabling,
-      // so use the best case, i.e. upgrade
-      Iterator<String> it = disabledApps.iterator();
-      String lastDisabledApp = null;
-      while(it.hasNext())
-      {
-        lastDisabledApp = it.next();
-      }
-      if(lastDisabledApp != null) {
-        return ejbUtil.getDeployment().get(lastDisabledApp);
-      }
-    
-      throw new NamingException(""Application Information Not Found"");
-  }
-
     private void registerEjbInterceptor() {
         try {
             final Object interceptor = new EjbComponentInterceptor(locator);
             initialContext = getInitialContext();
             final EjbContainerUtil ejbUtil = EjbContainerUtilImpl.getInstance();
-            final ApplicationInfo appInfo = getApplicationInfo(ejbUtil);
+            final ApplicationInfo appInfo = ejbUtil.getDeployment().get((String) initialContext.lookup(""java:app/AppName""));
             final List<String> tempLibNames = new LinkedList<>();
             for (ModuleInfo moduleInfo : appInfo.getModuleInfos()) {
                 final String jarName = moduleInfo.getName();",1
"Fixes ""XDestroyWindowEvent does not provide enough names"" error","         public Window window;
         public int from_configure;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""event"", ""window"", ""from_configure"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""from_configure"" }); 
         }
     }
 
@@ -1623,7 +1623,7 @@
         public Window window;
         public int override_redirect; // boolean, is override set...
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""event"", ""window"", ""override_redirect"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""override_redirect"" }); 
         }
     }
 
@@ -1635,7 +1635,7 @@
         public Window parent;
         public Window window;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""parent"", ""window"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"" }); 
         }
     }
 
@@ -1650,7 +1650,7 @@
         public int x, y;
         public int override_redirect;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""event"", ""window"", ""parent"", ""x"", ""y"", ""override_redirect"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""x"", ""y"", ""override_redirect"" }); 
         }
     }
 
@@ -1667,7 +1667,7 @@
         public Window above;
         public int override_redirect;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"",""event"", ""window"", ""x"", ""y"", ""width"", ""height"", ""border_width"", ""above"", ""override_redirect"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""x"", ""y"", ""width"", ""height"", ""border_width"", ""above"", ""override_redirect"" }); 
         }
     }
 
@@ -1680,7 +1680,7 @@
         public Window window;
         public int x, y;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""event"", ""window"", ""x"", ""y"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""x"", ""y"" }); 
         }
     }
 
@@ -1710,7 +1710,7 @@
         public int detail;          // Above, Below, TopIf, BottomIf, Opposite
         public NativeLong value_mask;
         protected List getFieldOrder() {
-            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""parent"", ""window"", ""x"", ""y"", ""width"", ""height"", ""border_width"", ""above"", ""detail"", ""value_mask"" }); 
+            return Arrays.asList(new String[] { ""type"", ""serial"", ""send_event"", ""display"", ""window"", ""x"", ""y"", ""width"", ""height"", ""above"", ""detail"", ""value_mask"" }); 
         }
     }
 ",1
Fix incorrectly failing dgetrf() and sgetrf() of CpuLapack,"             (FloatPointer)A.data().addressPointer(), 
             getLda(A), (IntPointer)IPIV.data().addressPointer()
             );
-        if( status < 0 ) {
+        if( status != 0 ) {
             throw new BlasException( ""Failed to execute sgetrf"", status ) ;
         }
     }
@@ -41,7 +41,7 @@
         int status = LAPACKE_dgetrf(getColumnOrder(A), M, N, (DoublePointer)A.data().addressPointer(), 
             getLda(A), (IntPointer)IPIV.data().addressPointer()
             );
-        if( status < 0 ) {
+        if( status != 0 ) {
             throw new BlasException( ""Failed to execute dgetrf"", status ) ;
         }
     }",1
KEYCLOAK-6510 Fix StackOverflow social login test," import org.openqa.selenium.WebElement;
 import org.openqa.selenium.support.FindBy;
 
+import static org.keycloak.testsuite.util.WaitUtils.waitUntilElement;
+
 /**
  * @author Vaclav Muzikar <vmuzikar@redhat.com>
  */
 public class StackOverflowLoginPage extends AbstractSocialLoginPage {
-    @FindBy(id = ""email"")
+    @FindBy(xpath = ""//a[@title='log in with Stack_Exchange']"")
+    private WebElement loginInitButton;
+
+    @FindBy(id = ""affiliate-signin-iframe"")
+    private WebElement loginFrame;
+
+    @FindBy(name = ""email"")
     private WebElement usernameInput;
 
     @FindBy(id = ""password"")
     private WebElement passwordInput;
 
-    @FindBy(xpath = ""//input[@value='Log in']"")
+    @FindBy(xpath = ""//input[@value='Sign In']"")
     private WebElement loginButton;
 
     @Override
     public void login(String user, String password) {
+        waitUntilElement(loginInitButton).is().visible();
+        loginInitButton.click();
+
+        driver.switchTo().frame(loginFrame);
+
+        usernameInput.clear();
         usernameInput.sendKeys(user);
         passwordInput.sendKeys(password);
 ",1
Fixed wrong StoreFactory,"         String trustStore = getProperty(properties, ""trustStore"", keyStore);
         String trustStorePassword = getProperty(properties, ""trustStorePassword"", keyStorePassword);
 
-        String keyManagerAlgorithm = properties.getProperty(""keyManagerAlgorithm"", KeyManagerFactory.getDefaultAlgorithm());
+        String keyManagerAlgorithm = properties.getProperty(""keyManagerAlgorithm"", TrustManagerFactory.getDefaultAlgorithm());
         String trustManagerAlgorithm = properties.getProperty(""trustManagerAlgorithm"", TrustManagerFactory.getDefaultAlgorithm());
         String protocol = properties.getProperty(""protocol"", ""TLS"");
 ",1
Added asserts to help debug test failures,"       _sumsqe += w*err*err;        // Squared error
       assert !Double.isNaN(_sumsqe);
 
-      assert iact < _cm.length : ""iact = "" + iact + ""; _cm.length = "" + _cm.length;
-      assert (int)ds[0] < _cm.length :  ""ds[0] = "" + ds[0] + ""; _cm.length = "" + _cm.length;
       // Plain Olde Confusion Matrix
       _cm[iact][(int)ds[0]]++; // actual v. predicted
 ",1
1485 - Ensure that startIndex and maxIndex are not sent as FilterAndSortCriteria during admin pagination,"         
         List<FilterAndSortCriteria> result = new ArrayList<FilterAndSortCriteria>();
         for (Entry<String, List<String>> entry : requestParams.entrySet()) {
-            if (!entry.getKey().equals(FilterAndSortCriteria.SORT_PROPERTY_PARAMETER)
-                    && !entry.getKey().equals(FilterAndSortCriteria.SORT_DIRECTION_PARAMETER)
-                    && !entry.getKey().equals(FilterAndSortCriteria.MAX_INDEX_PARAMETER)
-                    && !entry.getKey().equals(FilterAndSortCriteria.START_INDEX_PARAMETER)) {
+            if (!entry.getKey().equals(FilterAndSortCriteria.SORT_PROPERTY_PARAMETER) &&
+                    !entry.getKey().equals(FilterAndSortCriteria.SORT_DIRECTION_PARAMETER)) {
                 List<String> values = entry.getValue();
                 List<String> collapsedValues = new ArrayList<String>();
                 for (String value : values) {
@@ -575,7 +573,6 @@
     /**
      * @deprecated in favor of {@link #attachSectionSpecificInfo(PersistencePackageRequest, Map)}
      */
-    @Deprecated
     protected void attachSectionSpecificInfo(PersistencePackageRequest ppr) {
         
     }
@@ -665,7 +662,6 @@
     /**
      * @deprecated in favor of {@link #getSectionPersistencePackageRequest(String, List, Map)}
      */
-    @Deprecated
     protected PersistencePackageRequest getSectionPersistencePackageRequest(String sectionClassName, List<SectionCrumb> sectionCrumbs) {
         return getSectionPersistencePackageRequest(sectionClassName, sectionCrumbs, null);
     }
@@ -695,7 +691,6 @@
     /**
      * @deprecated in favor of {@link #getSectionPersistencePackageRequest(String, MultiValueMap, List, Map)}
      */
-    @Deprecated
     protected PersistencePackageRequest getSectionPersistencePackageRequest(String sectionClassName, 
             MultiValueMap<String, String> requestParams, List<SectionCrumb> sectionCrumbs) {
         return getSectionPersistencePackageRequest(sectionClassName, requestParams, sectionCrumbs, null);",1
Fix TreeSet's Comparator in Jabber Presence class,"                                         o2, parentProvider).getStatus()
                                       - jabberStatusToPresenceStatus(
                                             o1, parentProvider).getStatus();
-                                // We have run out of ""logical"" ways to order
-                                // the presences inside the TreeSet. We have
-                                // make sure we are consinstent with equals.
-                                // We do this by comparing the unique resource
-                                // names. If this evaluates to 0 again, then we
-                                // can safely assume this presence object 
-                                // represents the same resource and by that the
-                                // same client.
-                                if(res == 0)
-                                {
-                                    res = o1.getFrom().compareTo(
-                                        o2.getFrom());
-                                }
                             }
 
                             return res;",1
Extended test and fix for addressing #1852 (correct resolution in cas…,"                             visible = ((HasAccessSpecifier) resolvedReferenceTypeDeclaration).accessSpecifier() != AccessSpecifier.PRIVATE;
                         }
                     }
-                    if (internalTypeDeclaration.getName().equals(name)) {
-                        if (visible) {
+                    if (internalTypeDeclaration.getName().equals(name) && visible) {
                         return internalTypeDeclaration;
-                        } else {
-                            return null;
-                        }
                     }
                 }
                 // check recursively the ancestors of this ancestor",1
Debug : fix null pointer exception,"    * Method called whenever the DexterActivity has been destroyed.
    */
   static void onActivityDestroyed() {
-    /* Check against null values because sometimes the DexterActivity can call these internal
-       methods when the DexterInstance has been cleaned up.
-       Refer to this commit message for a more detailed explanation of the issue.
-     */
-    if (instance != null) {
     instance.onActivityDestroyed();
   }
-  }
 
   /**
    * Method called when all the permissions has been requested to the user",1
Fix crash when trying to do a search.," 
         searchPresenter = new SearchPresenter();
 
-        query = getArguments().getString(ARG_QUERY, """");
+        query = getArguments().getString(ARG_QUERY);
 
         loadingView = new LoadingView();
 ",1
Fix accidentally check exchanger in setDispatcher()(#3518),"     }
 
     public void setDispatcher(String dispatcher) {
-        checkExtension(Dispatcher.class, Constants.DISPATCHER_KEY, dispatcher);
-        checkExtension(Dispatcher.class, ""dispather"", dispatcher);
+        checkExtension(Dispatcher.class, Constants.DISPATCHER_KEY, exchanger);
+        checkExtension(Dispatcher.class, ""dispather"", exchanger);
         this.dispatcher = dispatcher;
     }
 ",1
Fixed null pointer from un-instantiated BluetoothCrashResolver use in…,"         if (mBeaconNotificationProcessor != null) {
             mBeaconNotificationProcessor.unregister();
         }
-        if (bluetoothCrashResolver != null) {
         bluetoothCrashResolver.stop();
-        }
         LogManager.i(TAG, ""onDestroy called.  stopping scanning"");
         handler.removeCallbacksAndMessages(null);
 ",1
Update side menu options on open / close callback - Android," 
 import com.reactnativenavigation.parse.Options;
 import com.reactnativenavigation.parse.SideMenuOptions;
-import com.reactnativenavigation.parse.params.Bool;
 import com.reactnativenavigation.presentation.Presenter;
 import com.reactnativenavigation.presentation.SideMenuPresenter;
 import com.reactnativenavigation.utils.CommandListener;
@@ -104,22 +103,14 @@
         return options;
     }
 
-    //For onDrawerOpened and onDrawerClosed :
-    //Merge the options to the current state, if this happened due to a gesture we need to
-    //update the option state
-
     @Override
     public void onDrawerOpened(@NonNull View drawerView) {
-        ViewController view = this.getMatchingView(drawerView);
-        view.mergeOptions(this.getOptionsWithVisability(this.viewIsLeft(drawerView), true));
-        view.onViewAppeared();
+        (left != null && drawerView.equals(left.getView()) ? left : right).onViewAppeared();
     }
 
     @Override
     public void onDrawerClosed(@NonNull View drawerView) {
-        ViewController view = this.getMatchingView(drawerView);
-        view.mergeOptions(this.getOptionsWithVisability(this.viewIsLeft(drawerView), false));
-        view.onViewDisappear();
+        (left != null && drawerView.equals(left.getView()) ? left : right).onViewDisappear();
     }
 
     @Override
@@ -163,24 +154,6 @@
         return height;
     }
 
-    private ViewController getMatchingView (View drawerView) {
-        return this.viewIsLeft(drawerView) ? left : right;
-    }
-
-    private boolean viewIsLeft (View drawerView) {
-        return (left != null && drawerView.equals(left.getView()));
-    }
-
-    private Options getOptionsWithVisability ( boolean isLeft, boolean visible ) {
-        Options options = new Options();
-        if (isLeft) {
-            options.sideMenuRootOptions.left.visible = new Bool(visible);
-        } else {
-            options.sideMenuRootOptions.right.visible = new Bool(visible);
-        }
-        return options;
-    }
-
     @Override
     public void onDrawerSlide(@NonNull View drawerView, float slideOffset) {
 ",1
Fix typo,"         // Defense against JENKINS-23152 and its ilk.
         File rootDir = r.getRootDir();
         if (rootDir.isDirectory()) {
-            throw new IllegalStateException(rootDir + "" already existed; will not overwrite with "" + r);
+            throw new IllegalStateException(rootDir + "" already existed; will not overwite with "" + r);
         }
         if (!r.getClass().getName().equals(""hudson.matrix.MatrixRun"")) { // JENKINS-26739: grandfathered in
             proposeNewNumber(r.getNumber());",1
Fixed GWT crashing when pixels is null.," 	@Override
 	public void glTexImage2D (int target, int level, int internalformat, int width, int height, int border, int format, int type,
 		Buffer pixels) {
-		if (pixels == null) {
-			gl.texImage2D(target, level, internalformat, width, height, border, format, type, null);
-		} else {
         if (pixels.limit() > 1) {
             HasArrayBufferView arrayHolder = (HasArrayBufferView) pixels;
 
@@ -476,7 +473,6 @@
             gl.texImage2D(target, level, internalformat, format, type, pixmap.getCanvasElement());
         }
 	}
-	}
 
 	@Override
 	public void glTexParameterf (int target, int pname, float param) {",1
Fix typo in matrix handle validity check," 
 	public void setViewMatrix(float[] viewMatrix) {
 		mViewMatrix = viewMatrix;
-		if(checkValidHandle(muVMatrixHandle, null))
+		if(checkValidHandle(muMMatrixHandle, null))
 			GLES20.glUniformMatrix4fv(muVMatrixHandle, 1, false, viewMatrix, 0);
 	}
 	",1
Fixed a compilation error introduced by last commit.,"  */
 public class VoldemortBuildAndPushJobRunner {
     private static final Logger logger = Logger.getLogger(VoldemortBuildAndPushJobRunner.class);
-    public static void main(String[] args) throws Exception {
+    public static void main(String[] args) {
         // Validate arguments
         if (args.length < 1) {
             logger.error(""Please provide a job config file name as the argument to this script."");",1
Fix to use compat class.," package permissions.dispatcher;
 
+import android.annotation.TargetApi;
 import android.app.Activity;
+import android.app.AppOpsManager;
 import android.content.Context;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
 import android.os.Build;
 import android.os.Process;
 import android.support.v4.app.ActivityCompat;
-import android.support.v4.app.AppOpsManagerCompat;
 import android.support.v4.util.SimpleArrayMap;
 
 import static android.support.v4.content.PermissionChecker.checkSelfPermission;
@@ -105,14 +106,11 @@
         }
     }
 
+    @TargetApi(Build.VERSION_CODES.M)
     private static boolean hasSelfPermissionForXiaomi(Context context, String permission) {
-        String permissionToOp = AppOpsManagerCompat.permissionToOp(permission);
-        if (permissionToOp == null) {
-            // in case of normal permissions(e.g. INTERNET)
-            return true;
-        }
-        int noteOp = AppOpsManagerCompat.noteOp(context, permissionToOp, Process.myUid(), context.getPackageName());
-        return noteOp == AppOpsManagerCompat.MODE_ALLOWED && checkSelfPermission(context, permission) == PackageManager.PERMISSION_GRANTED;
+        AppOpsManager appOpsManager = (AppOpsManager) context.getSystemService(Context.APP_OPS_SERVICE);
+        int checkOp = appOpsManager.checkOp(AppOpsManager.permissionToOp(permission), Process.myUid(), context.getPackageName());
+        return checkOp == AppOpsManager.MODE_ALLOWED && checkSelfPermission(context, permission) == PackageManager.PERMISSION_GRANTED;
     }
 
     /**
@@ -137,6 +135,7 @@
      * @param context context
      * @return target sdk version
      */
+    @TargetApi(Build.VERSION_CODES.DONUT)
     public static int getTargetSdkVersion(Context context) {
         if (targetSdkVersion != -1) {
             return targetSdkVersion;",1
bugfix JobExecutor thread name always android_0,"     private int counter = 0;
 
     @Override public Thread newThread(Runnable runnable) {
-      return new Thread(runnable, THREAD_NAME + counter++);
+      return new Thread(runnable, THREAD_NAME + counter);
     }
   }
 }
\ No newline at end of file",1
CAMEL-8758: Fix to Camel Cache producer to avoid NPE in race condition,"             cache.remove(key);
         } else if (checkIsEqual(operation, CacheConstants.CACHE_OPERATION_URL_GET)) {
             LOG.debug(""Quering an element with key {} from the Cache"", key);
-            Element element = cache.get(key);
-            if (element != null) {
+            if (cache.get(key) != null) {
                 exchange.getIn().setHeader(CacheConstants.CACHE_ELEMENT_WAS_FOUND, true);
-                exchange.getIn().setBody(element.getObjectValue());
+                exchange.getIn().setBody(cache.get(key).getObjectValue());
             } else {
                 exchange.getIn().removeHeader(CacheConstants.CACHE_ELEMENT_WAS_FOUND);
             }",1
[#4102] Fix null handling of BootstrapClassLoader,"             return new PinpointThreadLocalRandomFactory();
         } else if (jvmVersion.onOrAfter(JvmVersion.JAVA_7)) {
             try {
-                // @Nullable
-                final ClassLoader classLoader = ThreadLocalRandomUtils.class.getClassLoader();
+                ClassLoader classLoader = getClassLoader(ThreadLocalRandomUtils.class.getClassLoader());
 
                 final Class<? extends ThreadLocalRandomFactory> threadLocalRandomFactoryClass =
                         (Class<? extends ThreadLocalRandomFactory>) Class.forName(DEFAULT_THREAD_LOCAL_RANDOM_FACTORY, true, classLoader);
@@ -72,6 +71,13 @@
 
     }
 
+    private static ClassLoader getClassLoader(ClassLoader classLoader) {
+        if (classLoader == null) {
+            return ClassLoader.getSystemClassLoader();
+        }
+        return classLoader;
+    }
+
     private static void logError(Exception e) {
         LOGGER.info(""JdkThreadLocalRandomFactory not found. Caused by:{}"", e.getMessage(), e);
     }",1
PUBDEV-4735: Fix sharing stage between threads in DeepLearning POJO,"       JCodeGen.toClassWithArray(sb, ""static"", ""NORMSUB"", model_info().data_info()._normSub);//, ""Standardization/Normalization offset for numerical variables."");
     }
     if (model_info().data_info()._cats > 0) {
-      sb.i(0).p(""// Thread-local workspace for storing categorical input variables."").nl();
-      sb.i(0).p(""final int[] CATS = new int["" + model_info().data_info()._cats +""];"").nl();
+      JCodeGen.toStaticVar(sb, ""CATS"", new int[model_info().data_info()._cats], ""Workspace for storing categorical input variables."");
     }
-    JCodeGen.toStaticVar(sb, ""CATOFFSETS"", model_info().data_info()._catOffsets, ""Offset into the workspace for categorical variables."");
+    JCodeGen.toStaticVar(sb, ""CATOFFSETS"", model_info().data_info()._catOffsets, ""Workspace for categorical offsets."");
     if (model_info().data_info()._normRespMul != null) {
       JCodeGen.toStaticVar(sb, ""NORMRESPMUL"", model_info().data_info()._normRespMul, ""Standardization/Normalization scaling factor for response."");
       JCodeGen.toStaticVar(sb, ""NORMRESPSUB"", model_info().data_info()._normRespSub, ""Standardization/Normalization offset for response."");",1
fixed typo of variable,"     @Override
     @SuppressWarnings({""unchecked"", ""rawtypes""})
     public Result doInvoke(Invocation invocation, final List<Invoker<T>> invokers, LoadBalance loadbalance) throws RpcException {
-        List<Invoker<T>> copyInvokers = invokers;
-        checkInvokers(copyInvokers, invocation);
+        List<Invoker<T>> copyinvokers = invokers;
+        checkInvokers(copyinvokers, invocation);
         String methodName = RpcUtils.getMethodName(invocation);
         int len = getUrl().getMethodParameter(methodName, Constants.RETRIES_KEY, Constants.DEFAULT_RETRIES) + 1;
         if (len <= 0) {
@@ -62,18 +62,18 @@
         }
         // retry loop.
         RpcException le = null; // last exception.
-        List<Invoker<T>> invoked = new ArrayList<Invoker<T>>(copyInvokers.size()); // invoked invokers.
+        List<Invoker<T>> invoked = new ArrayList<Invoker<T>>(copyinvokers.size()); // invoked invokers.
         Set<String> providers = new HashSet<String>(len);
         for (int i = 0; i < len; i++) {
             //Reselect before retry to avoid a change of candidate `invokers`.
             //NOTE: if `invokers` changed, then `invoked` also lose accuracy.
             if (i > 0) {
                 checkWhetherDestroyed();
-                copyInvokers = list(invocation);
+                copyinvokers = list(invocation);
                 // check again
-                checkInvokers(copyInvokers, invocation);
+                checkInvokers(copyinvokers, invocation);
             }
-            Invoker<T> invoker = select(loadbalance, invocation, copyInvokers, invoked);
+            Invoker<T> invoker = select(loadbalance, invocation, copyinvokers, invoked);
             invoked.add(invoker);
             RpcContext.getContext().setInvokers((List) invoked);
             try {
@@ -83,7 +83,7 @@
                             + "" in the service "" + getInterface().getName()
                             + "" was successful by the provider "" + invoker.getUrl().getAddress()
                             + "", but there have been failed providers "" + providers
-                            + "" ("" + providers.size() + ""/"" + copyInvokers.size()
+                            + "" ("" + providers.size() + ""/"" + copyinvokers.size()
                             + "") from the registry "" + directory.getUrl().getAddress()
                             + "" on the consumer "" + NetUtils.getLocalHost()
                             + "" using the dubbo version "" + Version.getVersion() + "". Last error is: ""
@@ -104,7 +104,7 @@
         throw new RpcException(le.getCode(), ""Failed to invoke the method ""
                 + methodName + "" in the service "" + getInterface().getName()
                 + "". Tried "" + len + "" times of the providers "" + providers
-                + "" ("" + providers.size() + ""/"" + copyInvokers.size()
+                + "" ("" + providers.size() + ""/"" + copyinvokers.size()
                 + "") from the registry "" + directory.getUrl().getAddress()
                 + "" on the consumer "" + NetUtils.getLocalHost() + "" using the dubbo version ""
                 + Version.getVersion() + "". Last error is: """,1
Fix for lost content in sample app," 	private String mContent = ""???"";
 	
 	@Override
-	public void onCreate(Bundle savedInstanceState) {
-		super.onCreate(savedInstanceState);
-
+	public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 		if ((savedInstanceState != null) && savedInstanceState.containsKey(KEY_CONTENT)) {
 			mContent = savedInstanceState.getString(KEY_CONTENT);
 		}
-	}
 		
-	@Override
-	public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 		TextView text = new TextView(getActivity());
 		text.setGravity(Gravity.CENTER);
 		text.setText(mContent);",1
Update outdated method name in error output to help debugging,"     public void useFixedMode() {
         if (mItems != null) {
             throw new UnsupportedOperationException(""This BottomBar already has items! "" +
-                    ""You must call the useFixedMode() method before specifying any items."");
+                    ""You must call the forceFixedMode() method before specifying any items."");
         }
 
         mMaxFixedTabCount = -1;",1
Fix redundant entries in facet provider chain,"                 }
                 orderedProviders.add(provider);
             }
-        }
             result.putAll(facet, orderedProviders);
             facetCalculationInProgress.remove(facet);
         }
+    }
 
     private boolean producesFacet(FacetProvider provider, Class<? extends WorldFacet> facet) {
         Produces produces = provider.getClass().getAnnotation(Produces.class);",1
Fix typo in Maven plugin help: ore => or.,"  * <ol>
  * <li>Create an instance</li>
  * <li>Load one or multiple exec files with <code>loadExecutionData()</code></li>
- * <li>Add one or multiple formatters with <code>addXXX()</code> methods</li>
+ * <li>Add one ore multiple formatters with <code>addXXX()</code> methods</li>
  * <li>Create the root visitor with <code>initRootVisitor()</code></li>
  * <li>Process one or multiple projects with <code>processProject()</code></li>
  * </ol>",1
Fix widget size for custom skins,"         }
 
         String family = (widget.getFamily() != null) ? widget.getFamily() : state.family;
-        UISkin skin = (widget.getSkin() != null) ? widget.getSkin() : state.skin;
-        UIStyle elementStyle = skin.getStyleFor(family, widget.getClass(), UIWidget.BASE_PART, widget.getMode());
+        UIStyle elementStyle = state.skin.getStyleFor(family, widget.getClass(), UIWidget.BASE_PART, widget.getMode());
         Rect2i region = applyStyleToSize(Rect2i.createFromMinAndSize(Vector2i.zero(), sizeRestrictions), elementStyle);
         try (SubRegion ignored = subRegionForWidget(widget, region, false)) {
             Vector2i preferredSize = widget.getPreferredContentSize(this, elementStyle.getMargin().shrink(sizeRestrictions));",1
Fix spelling error in ResourceTranscoder," public interface ResourceTranscoder<Z, R> {
 
   /**
-   * Transcodes the given resource to the new resource type and returns the new resource.
+   * Transcodes the given resource to the new resource type and returns the wew resource.
    *
    * @param toTranscode The resource to transcode.
    */",1
Fix int overflow bug in reported page cache memory when dump_configuration=true,"         long totalPhysicalMemory = totalPhysicalMemory();
         String totalPhysicalMemMb = totalPhysicalMemory == -1? ""?"" : """" + totalPhysicalMemory / 1024 / 1024;
         long maxVmUsageMb = Runtime.getRuntime().maxMemory() / 1024 / 1024;
-        long maxPages = calculateMaxPages( config );
-        long pageSize = calculatePageSize( config );
-        long pageCacheMb = (maxPages * pageSize) / 1024 / 1024;
+        long pageCacheMb = (calculateMaxPages( config ) * calculatePageSize( config )) / 1024 / 1024;
         String msg = ""Physical mem: "" + totalPhysicalMemMb + "" MiB,"" +
                      "" Heap size: "" + maxVmUsageMb + "" MiB,"" +
                      "" Page cache size: "" + pageCacheMb + "" MiB."";",1
Fix #1092 -Update FormField," 
   protected LayoutDefinition layout;
 
-  // size of the dropdown
-  protected int sizeY;
-
   public String getId() {
     return id;
   }
@@ -120,14 +117,6 @@
     this.layout = layout;
   }
 
-  public int getSizeY() {
-    return sizeY;
-  }
-
-  public void setSizeY(int sizeY) {
-    this.sizeY = sizeY;
-  }
-
   @JsonInclude(Include.NON_EMPTY)
   public Map<String, Object> getParams() {
     return params;",1
[PUBDEV-5403] Fix wrong comment in h2odriver,"                     ""          o  Only one mapper may be run per host.\n"" +
                     ""          o  There are no combiners or reducers.\n"" +
                     ""          o  Each H2O cluster should have a unique jobname.\n"" +
-                    ""          o  -mapperXmx and -nodes are required.\n"" +
+                    ""          o  -mapperXmx, -nodes and -output are required.\n"" +
                     ""\n"" +
                     ""          o  -mapperXmx is set to both Xms and Xmx of the mapper to reserve\n"" +
                     ""             memory up front.\n"" +",1
This fixes a bug I _just_ introduced with my last pull request.,"         for (String part : contentType.split("";"")) {
             if (part.trim().startsWith(""charset="")) {
                 String[] val = part.split(""="");
-                if (val.length > 1) {
+                if (val[1].length > 1) {
                     return val[1].trim();
                 }
             }",1
Fix build broken by #414 by adding missing implementation," import com.polidea.rxandroidble2.RxBleCustomOperation;
 import com.polidea.rxandroidble2.RxBleDeviceServices;
 import com.polidea.rxandroidble2.exceptions.BleConflictingNotificationAlreadySetException;
-import com.polidea.rxandroidble2.internal.Priority;
 import com.polidea.rxandroidble2.internal.connection.ImmediateSerializedBatchAckStrategy;
 import com.polidea.rxandroidble2.internal.util.ObservableUtil;
 
@@ -469,9 +468,4 @@
     public <T> Observable<T> queue(@NonNull RxBleCustomOperation<T> operation) {
         throw new UnsupportedOperationException(""Mock does not support queuing custom operation."");
     }
-
-    @Override
-    public <T> Observable<T> queue(@NonNull RxBleCustomOperation<T> operation, Priority priority) {
-        throw new UnsupportedOperationException(""Mock does not support queuing custom operation."");
-    }
 }",1
"item stats: fix detecting when GE has closed, fix threading issue"," import net.runelite.api.VarPlayer;
 import net.runelite.api.Varbits;
 import net.runelite.api.events.ConfigChanged;
-import net.runelite.api.events.GameTick;
 import net.runelite.api.events.ScriptCallbackEvent;
 import net.runelite.api.events.VarbitChanged;
+import net.runelite.api.events.WidgetHiddenChanged;
 import net.runelite.api.widgets.JavaScriptCallback;
 import net.runelite.api.widgets.Widget;
 import net.runelite.api.widgets.WidgetInfo;
 import net.runelite.api.widgets.WidgetTextAlignment;
 import net.runelite.api.widgets.WidgetType;
-import net.runelite.client.callback.ClientThread;
 import net.runelite.client.config.ConfigManager;
 import net.runelite.client.eventbus.Subscribe;
 import net.runelite.client.game.ItemManager;
@@ -91,9 +90,6 @@
 	@Inject
 	private ItemStatConfig config;
 
-	@Inject
-	private ClientThread clientThread;
-
 	private Widget itemInformationTitle;
 
 	@Provides
@@ -118,7 +114,7 @@
 	protected void shutDown() throws Exception
 	{
 		overlayManager.remove(overlay);
-		clientThread.invokeLater(this::resetGEInventory);
+		resetGEInventory();
 	}
 
 	@Subscribe
@@ -126,15 +122,19 @@
 	{
 		if (event.getKey().equals(""geStats""))
 		{
-			clientThread.invokeLater(this::resetGEInventory);
+			resetGEInventory();
 		}
 	}
 
 	@Subscribe
-	public void onGameTick(GameTick event)
+	public void onWidgetHiddenChanged(WidgetHiddenChanged event)
 	{
-		if (itemInformationTitle != null && config.geStats()
-			&& client.getWidget(WidgetInfo.GRAND_EXCHANGE_WINDOW_CONTAINER) == null)
+		if (!config.geStats())
+		{
+			return;
+		}
+
+		if (event.getWidget() == client.getWidget(WidgetInfo.INVENTORY))
 		{
 			resetGEInventory();
 		}",1
Fix getAdapterPosition returning 0 when group not found,"      */
     public int getAdapterPosition(@NonNull Group group) {
         int index = groups.indexOf(group);
-        if (index == -1) return -1;
         int position = 0;
         for (int i = 0; i < index; i++) {
             position += groups.get(i).getItemCount();",1
Error in ClientHearbeatMonitor connection.close message,"         }
 
         final Connection connection = clientEndpoint.getConnection();
-        final long lastTimePacketReceived = connection.lastReadTimeMillis();
+        final long lastTimePackageReceived = connection.lastReadTimeMillis();
         final long timeoutInMillis = SECONDS.toMillis(heartbeatTimeoutSeconds);
         final long currentTimeMillis = Clock.currentTimeMillis();
-        if (lastTimePacketReceived + timeoutInMillis < currentTimeMillis) {
+        if (lastTimePackageReceived + timeoutInMillis < currentTimeMillis) {
             if (memberUuid.equals(clientEndpoint.getPrincipal().getOwnerUuid())) {
                 String message = ""Client heartbeat is timed out, closing connection to "" + connection
-                        + "". Now: "" + timeToString(currentTimeMillis)
-                        + "". LastTimePacketReceived: "" + timeToString(lastTimePacketReceived);
+                        + "". Now: "" + timeToString(lastTimePackageReceived)
+                        + "". LastTimePacketReceived: "" + timeToString(lastTimePackageReceived);
                 logger.log(Level.WARNING, message);
                 connection.close(message, null);
             }",1
fix the start parameter not being used," 	public Array (boolean ordered, T[] array, int start, int count) {
 		this(ordered, count, (Class)array.getClass().getComponentType());
 		size = count;
-		System.arraycopy(array, start, items, 0, size);
+		System.arraycopy(array, 0, items, 0, size);
 	}
 
 	public void add (T value) {",1
Fix exception when getting sessions through ZAP API," 			}
 
 			ApiResponseList response = new ApiResponseList(name);
-			String vsName = getParam(params, VIEW_PARAM_SESSION, """");
+			String vsName = params.getString(VIEW_PARAM_SESSION);
 			// If a session name was not provided
 			if (vsName == null || vsName.isEmpty()) {
 				Set<HttpSession> sessions = site.getHttpSessions();",1
"fixed bug in method gcd(int, int)"," 
       public static int gcd(int num1, int num2) {
 	
-        if (num1 == 0)
+        int gcdValue = num1 % num2;
+        while (gcdValue != 0) {
+            num2 = gcdValue;
+            gcdValue = num2 % gcdValue;
+        }
         return num2;
-
-        while (num2 != 0) {
-            if (num1 > num2)
-                num1 -= num2;
-            else
-                num2 -= num1;
     }
-
-        return num1;
-    }
-
 	public static int gcd(int[] number) {
 		  int result = number[0];
 		  for(int i = 1; i < number.length; i++) 
@@ -30,9 +24,7 @@
 
 	public static void main(String[] args) {
 		int[] myIntArray = {4,16,32};
-        
 		//call gcd function (input array)
-        System.out.println(gcd(myIntArray)); // => 4
-        System.out.printf(""gcd(40,24)=%d gcd(24,40)=%d\n"", gcd(40, 24), gcd(24, 40)); // => 8
+                System.out.println(gcd(myIntArray));
     }
 }",1
Send END_PADDING to server,"                 case CLOSING:
                     buffer.put(ZERO);
                     buffer.put(END_PADDING);
-                    buffer.put(END_PADDING);
                     finishState = FINISHED;
                     return buffer.position();
                 case FINISHED:
+                    buffer.put(END_PADDING);
                     return -1;
                 }
             }",1
fix cacheEvent,"             Calendar startTime = (Calendar) event.getEndTime().clone();
             startTime.set(Calendar.HOUR_OF_DAY, 0);
             startTime.set(Calendar.MINUTE, 0);
-            WeekViewEvent event1 = new WeekViewEvent(event.getId(), event.getName(), event.getLocation(), event.getStartTime(), endTime);
+            WeekViewEvent event1 = new WeekViewEvent(event.getId(), event.getName(), event.getStartTime(), endTime);
             event1.setColor(event.getColor());
-            WeekViewEvent event2 = new WeekViewEvent(event.getId(), event.getName(), event.getLocation(), startTime, event.getEndTime());
+            WeekViewEvent event2 = new WeekViewEvent(event.getId(), event.getName(), startTime, event.getEndTime());
             event2.setColor(event.getColor());
             mEventRects.add(new EventRect(event1, event, null));
             mEventRects.add(new EventRect(event2, event, null));",1
Fix typo," 				} else {
 					destination = account.getHostname();
 				}
-				Log.d(Config.LOGTAG, account.getJid().toBareJid() + "": connect to "" + destination + "" via Tor"");
+				Log.d(Config.LOGTAG, account.getJid().toBareJid() + "": connect to "" + destination + "" via TOR"");
 				socket = SocksSocketFactory.createSocketOverTor(destination, account.getPort());
 				startXmpp();
 			} else if (extended && account.getHostname() != null && !account.getHostname().isEmpty()) {",1
Fix MiscUtils: closeSilently should check for nullity,"     }
 
     public static void closeSilently(Closeable closeable) {
-        if(closeable != null) {
         try {
             closeable.close();
-            } catch (IOException ioe) {
-                // Ignored
-            }
+        } catch (IOException e) {
         }
     }
 }",1
fixed missed @ in javadoc,"          * then this request calls {@link JobManager#cancelAllForTag(String)} with the given tag before
          * being scheduled.
          *
-         * @param updateCurrent If {@code true} this request will cancel any preexisting job with the same tag
+         * @param updateCurrent If {code true} this request will cancel any preexisting job with the same tag
          *                      while being scheduled.
          */
         public Builder setUpdateCurrent(boolean updateCurrent) {",1
Fixes ShapeRenderer multicolor call to rect()," 			renderer.color(col1.r, col1.g, col1.b, col1.a);
 			renderer.vertex(x1, y1, 0);
 		} else {
-			renderer.color(col1.r, col1.g, col1.b, col1.a);
+			renderer.color(color);
 			renderer.vertex(x1, y1, 0);
-			renderer.color(col2.r, col2.g, col2.b, col2.a);
+			renderer.color(color);
 			renderer.vertex(x2, y2, 0);
-			renderer.color(col3.r, col3.g, col3.b, col3.a);
+			renderer.color(color);
 			renderer.vertex(x3, y3, 0);
 
-			renderer.color(col3.r, col3.g, col3.b, col3.a);
+			renderer.color(color);
 			renderer.vertex(x3, y3, 0);
-			renderer.color(col4.r, col4.g, col4.b, col4.a);
+			renderer.color(color);
 			renderer.vertex(x4, y4, 0);
-			renderer.color(col1.r, col1.g, col1.b, col1.a);
+			renderer.color(color);
 			renderer.vertex(x1, y1, 0);
 		}
 ",1
BAEL-1090 Fixed minor issue with total time calculation,"         startTime = System.currentTimeMillis();
         String appended = (String) strings.stream().limit(100_000)
           .reduce("""", (left, right) -> left.toString() + right.toString());
-        totalTime = System.currentTimeMillis() - startTime;
+        totalTime = System.currentTimeMillis() - totalTime;
         System.out.println(""Created string of length "" + appended.length() 
           + "" in "" + totalTime + "" ms."");
     }",1
Typo fix in λ.java: not - > note,"      * Returns a memoizing version of this function, which computes the return value for given arguments only one time.
      * On subsequent calls given the same arguments the memoized value is returned.
      * <p>
-     * Please note that memoizing functions do not permit `null` as single argument or return value.
+     * Please not that memoizing functions do not permit `null` as single argument or return value.
      *
      * @return a memoizing function equivalent to this.
      */",1
Fix WebEngineContext application/session isEmpty(),"                 return true;
             }
             final Enumeration<String> attributeNames = this.session.getAttributeNames();
-            return !attributeNames.hasMoreElements();
+            return attributeNames.hasMoreElements();
         }
 
         @Override
@@ -483,7 +483,7 @@
         @Override
         public boolean isEmpty() {
             final Enumeration<String> attributeNames = this.servletContext.getAttributeNames();
-            return !attributeNames.hasMoreElements();
+            return attributeNames.hasMoreElements();
         }
 
         @Override",1
fixed netInterface NullPointerException," 			else {
 				NetworkInterface netInterface = NetworkInterface
 						.getByName(networkInterface);
-				if (null == netInterface) {
+				if (null == networkInterface) {
 					throw new IllegalArgumentException(
 							""no such interface "" + networkInterface);
 				}",1
fix logMetricForSum format error," 	 *           the quantity to be accumulated
 	 */
 	public static void logMetricForSum(String name, double sum, int quantity) {
-		logMetricInternal(name, ""S,C"", String.format(""%s,%.2f"", quantity, sum));
+		logMetricInternal(name, ""S,C"", String.format(""%.2f,%s"", sum, quantity));
 	}
 
 	private static void logMetricInternal(String name, String status, String keyValuePairs) {",1
Fix issue #269,"         Cursor cursor = context.getContentResolver().query(
                 photoUri, new String[]{MediaStore.Images.ImageColumns.ORIENTATION}, null, null, null
         );
-        if (cursor == null) {
-            return 0;
-        }
         if (cursor.moveToFirst()) {
             result = cursor.getInt(0);
         } else {",1
Fix inverse constraint test for Wikidata extension.,"     private PropertyIdValue partOf;
     private PropertyIdValue referenceURL;
     private PropertyIdValue reasonForDeprecation;
-    private PropertyIdValue mother;
-    private PropertyIdValue child;
 
     public WikidataConstraintFetcherTests() {
         fetcher = new WikidataConstraintFetcher();
@@ -57,8 +55,6 @@
         partOf = Datamodel.makeWikidataPropertyIdValue(""P361"");
         referenceURL = Datamodel.makeWikidataPropertyIdValue(""P854"");
         reasonForDeprecation = Datamodel.makeWikidataPropertyIdValue(""P2241"");
-        mother = Datamodel.makeWikidataPropertyIdValue(""P25"");
-        child = Datamodel.makeWikidataPropertyIdValue(""P40"");
     }
 
     @Test
@@ -74,7 +70,7 @@
 
     @Test
     public void testGetInverseConstraint() {
-        Assert.assertEquals(fetcher.getInversePid(mother), child);
+        Assert.assertEquals(fetcher.getInversePid(partOf), hasPart);
     }
 
     @Test",1
New list in UseCaseHandler to retain error adapters in a non-weak reference," import com.karumi.rosie.domain.usecase.error.ErrorHandler;
 import com.karumi.rosie.domain.usecase.error.OnErrorCallback;
 
-import java.lang.ref.WeakReference;
-import java.util.ArrayList;
-import java.util.List;
-
 /**
  * Invoke methods annotated with UseCase annotation. The RosieUseCase instance will be executed out
  * of the Android main thread and the result of the operation will be provided asynchronously using
@@ -33,10 +29,6 @@
   private final TaskScheduler taskScheduler;
   private final ErrorHandler errorHandler;
 
-  // This list is used to retain error adapters in a non-weak reference associated with this use
-  // case handler
-  private final List<OnErrorCallback> errorCallbacks = new ArrayList<>();
-
   public UseCaseHandler(TaskScheduler taskScheduler, ErrorHandler errorHandler) {
     this.taskScheduler = taskScheduler;
     this.errorHandler = errorHandler;
@@ -53,12 +45,8 @@
     UseCaseFilter.filter(useCase, useCaseParams);
 
     useCase.setOnSuccessCallback(useCaseParams.getOnSuccessCallback());
-
-    OnErrorCallback onErrorCallback =
-        new OnErrorCallbackToErrorHandlerAdapter(errorHandler, useCaseParams.getOnErrorCallback());
-    errorCallbacks.add(onErrorCallback);
-    useCase.setOnErrorCallback(onErrorCallback);
-
+    useCase.setOnErrorCallback(
+        new OnErrorCallbackToErrorHandlerAdapter(errorHandler, useCaseParams.getOnErrorCallback()));
     UseCaseWrapper useCaseWrapper = new UseCaseWrapper(useCase, useCaseParams, errorHandler);
     taskScheduler.execute(useCaseWrapper);
   }
@@ -75,22 +63,18 @@
    * Inner class responsible for routing the errors thrown from the use case to the error handler
    */
   private static class OnErrorCallbackToErrorHandlerAdapter implements OnErrorCallback {
-    private final WeakReference<ErrorHandler> errorHandler;
-    private final WeakReference<OnErrorCallback> useCaseOnErrorCallback;
+    private final ErrorHandler errorHandler;
+    private final OnErrorCallback useCaseOnErrorCallback;
 
     public OnErrorCallbackToErrorHandlerAdapter(ErrorHandler errorHandler,
         OnErrorCallback useCaseOnErrorCallback) {
-      this.errorHandler = new WeakReference<>(errorHandler);
-      this.useCaseOnErrorCallback = new WeakReference<>(useCaseOnErrorCallback);
+      this.errorHandler = errorHandler;
+      this.useCaseOnErrorCallback = useCaseOnErrorCallback;
     }
 
     @Override public boolean onError(Error error) {
-      ErrorHandler errorHandler = this.errorHandler.get();
-      if (errorHandler != null) {
-        errorHandler.notifyError(error, useCaseOnErrorCallback.get());
+      errorHandler.notifyError(error, useCaseOnErrorCallback);
       return true;
     }
-      return false;
-    }
   }
 }",1
Fix zoom gesture crash; request camera permission upon tap if not granted.,"             }
         };
 
-        findViewById(R.id.topLayout).setOnClickListener(listener);
         Snackbar.make(mGraphicOverlay, R.string.permission_camera_rationale,
                 Snackbar.LENGTH_INDEFINITE)
                 .setAction(R.string.ok, listener)",1
Fix issue where configuration ExecutionModel was set to SEQUENTIAL re…,"      * @return
      */
     public Configuration setExecutionModel(@NonNull ExecutionModel executionModel) {
-        this.executionModel = executionModel;
+        this.executionModel = ExecutionModel.SEQUENTIAL;
 
         return this;
     }",1
[BACKLOG-23276] fix for failing test case," 
   private boolean isDeprecated;
 
-  private String suggestedStep = """";
+  private String suggestedStep;
 
   private RowDistributionInterface rowDistribution;
 ",1
Fix crash when calling dismissModal before app was launched,"         result.animateScreenTransitions = new AnimationParser(params).parse();
         result.sharedElementsTransitions = getSharedElementsTransitions(params);
 
-        result.animationType = params.getString(ANIMATION_TYPE, AppStyle.appStyle == null ? """" : AppStyle.appStyle.screenAnimationType);
+        result.animationType = params.getString(ANIMATION_TYPE, AppStyle.appStyle.screenAnimationType);
 
         return result;
     }",1
修复activity无主题时打开activity黑屏BUG,"             if (mClass == null) {
                 mClass = packageInfo.activities[0].name;
             }
-            //Finals 修复主题BUG
-            int defaultTheme = packageInfo.applicationInfo.theme;
             for (ActivityInfo a : packageInfo.activities) {
                 if (a.name.equals(mClass)) {
                     mActivityInfo = a;
-                    //Finals ADD 修复主题没有配置的时候插件异常
-                    if (mActivityInfo.theme == 0 && defaultTheme != 0) {
-		       mActivityInfo.theme = defaultTheme;
-		    } else {
-			if (Build.VERSION.SDK_INT >= 14) {
-			    mActivityInfo.theme = android.R.style.Theme_DeviceDefault;
-			} else {
-			    mActivityInfo.theme = android.R.style.Theme;
-			}
-		    }
                 }
             }
         }",1
Fix IconDrawable issue on Android 5.0.x and 5.1,"         this.icon = icon;
         paint = new TextPaint();
         paint.setTypeface(Iconify.getTypeface(context));
-        paint.setStyle(Paint.Style.FILL);
+        paint.setStyle(Paint.Style.STROKE);
         paint.setTextAlign(Paint.Align.CENTER);
         paint.setUnderlineText(false);
         paint.setColor(Color.BLACK);",1
Fix for #466," import java.nio.channels.ByteChannel;
 import java.nio.channels.SelectionKey;
 import java.nio.channels.SocketChannel;
-import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.List;
 import java.util.concurrent.ExecutorService;
 import java.util.concurrent.Executors;
@@ -37,15 +35,6 @@
 	@Override
 	public ByteChannel wrapChannel( SocketChannel channel, SelectionKey key ) throws IOException {
 		SSLEngine e = sslcontext.createSSLEngine();
-		/**
-		 * See https://github.com/TooTallNate/Java-WebSocket/issues/466
-		 *
-		 * We remove TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 from the enabled ciphers since it is just available when you patch your java installation directly.
-		 * E.g. firefox requests this cipher and this causes some dcs/instable connections
-		 */
-		List<String> ciphers = new ArrayList<String>( Arrays.asList(e.getEnabledCipherSuites()));
-		ciphers.remove(""TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"");
-		e.setEnabledCipherSuites( ciphers.toArray(new String[]{}));
 		e.setUseClientMode( false );
 		return new SSLSocketChannel2( channel, e, exec, key );
 	}",1
Fixes checkstyle issues in WorldRendererLmpl," 
 /**
  * Renders the 3D world, including background, overlays and first person/in hand objects. 2D UI elements are dealt with elsewhere.
- * <p>
+ *
  * This implementation includes support for OpenVR, through which HTC Vive and Oculus Rift is supported.
- * <p>
+ *
  * This implementation works closely with a number of support objects, in particular:
- * <p>
+ *
  * TODO: update this section to include new, relevant objects
  * - a RenderableWorld instance, providing acceleration structures caching blocks requiring different rendering treatments<br/>
  */
@@ -177,14 +177,14 @@
 
     /**
      * Instantiates a WorldRenderer implementation.
-     * <p>
+     *
      * This particular implementation works as deferred shader. The scene is rendered multiple times per frame
      * in a number of separate passes (each stored in GPU buffers) and the passes are combined throughout the
      * rendering pipeline to calculate per-pixel lighting and other effects.
-     * <p>
+     *
      * Transparencies are handled through alpha rejection (i.e. ground plants) and alpha-based blending.
      * An exception to this is water, which is handled separately to allow for reflections and refractions, if enabled.
-     * <p>
+     *
      * By the time it is fully instantiated this implementation is already connected to all the support objects
      * it requires and is ready to render via the render(RenderingStage) method.
      *
@@ -253,32 +253,32 @@
     }
 
     private void initRenderGraph() {
-        addShadowMapNodes();
+        addShadowMapNodes(renderGraph);
 
-        addReflectionNodes();
+        addReflectionNodes(renderGraph);
 
-        addSkyNodes();
+        addSkyNodes(renderGraph);
 
-        addWorldRenderingNodes();
+        addWorldRenderingNodes(renderGraph);
 
-        addLightingNodes();
+        addLightingNodes(renderGraph);
 
-        addRefractiveReflectiveNode();
+        addRefractiveReflectiveNode(renderGraph);
 
-        add3dDecorationNodes();
+        add3dDecorationNodes(renderGraph);
 
-        addPrePostProcessingNodes();
+        addPrePostProcessingNodes(renderGraph);
 
-        addPostProcessingNodes();
+        addPostProcessingNodes(renderGraph);
 
-        addOutputNodes();
+        addOutputNodes(renderGraph);
 
         renderTaskListGenerator = new RenderTaskListGenerator();
         List<Node> orderedNodes = renderGraph.getNodesInTopologicalOrder();
         renderPipelineTaskList = renderTaskListGenerator.generateFrom(orderedNodes);
     }
 
-    private void addShadowMapNodes() {
+    private void addShadowMapNodes(RenderGraph renderGraph) {
         FBOConfig shadowMapConfig = new FBOConfig(ShadowMapNode.SHADOW_MAP_FBO_URI, FBO.Type.NO_COLOR).useDepthBuffer();
         BufferClearingNode shadowMapClearingNode = new BufferClearingNode(shadowMapConfig, shadowMapResolutionDependentFBOs, GL_DEPTH_BUFFER_BIT);
         renderGraph.addNode(shadowMapClearingNode, ""shadowMapClearingNode"");
@@ -287,10 +287,9 @@
         renderGraph.addNode(shadowMapNode, ""shadowMapNode"");
     }
 
-    private void addReflectionNodes() {
+    private void addReflectionNodes(RenderGraph renderGraph) {
         FBOConfig reflectedBufferConfig = new FBOConfig(BackdropReflectionNode.REFLECTED_FBO_URI, HALF_SCALE, FBO.Type.DEFAULT).useDepthBuffer();
-        BufferClearingNode reflectedBufferClearingNode =
-                new BufferClearingNode(reflectedBufferConfig, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+        BufferClearingNode reflectedBufferClearingNode = new BufferClearingNode(reflectedBufferConfig, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
         renderGraph.addNode(reflectedBufferClearingNode, ""reflectedBufferClearingNode"");
 
         Node reflectedBackdropNode = new BackdropReflectionNode(context);
@@ -300,26 +299,25 @@
         renderGraph.addNode(worldReflectionNode, ""worldReflectionNode"");
     }
 
-    private void addSkyNodes() {
+    private void addSkyNodes(RenderGraph renderGraph) {
         FBOConfig reflectedRefractedBufferConfig = new FBOConfig(RefractiveReflectiveBlocksNode.REFRACTIVE_REFLECTIVE_FBO_URI, FULL_SCALE, FBO.Type.HDR).useNormalBuffer();
-        BufferClearingNode reflectedRefractedClearingNode =
-                new BufferClearingNode(reflectedRefractedBufferConfig, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+        BufferClearingNode reflectedRefractedClearingNode = new BufferClearingNode(reflectedRefractedBufferConfig, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
         renderGraph.addNode(reflectedRefractedClearingNode, ""reflectedRefractedClearingNode"");
 
         FBOConfig gBuffer1Config = displayResolutionDependentFBOs.getFboConfig(new SimpleUri(""engine:fbo.gBuffer1"")); // TODO: Remove the hard coded value here
         FBOConfig gBuffer2Config = displayResolutionDependentFBOs.getFboConfig(new SimpleUri(""engine:fbo.gBuffer2"")); // TODO: Remove the hard coded value here
 
-        BufferClearingNode lastUpdatedGBufferClearingNode =
-                new BufferClearingNode(gBuffer1Config, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);
+        BufferClearingNode lastUpdatedGBufferClearingNode = new BufferClearingNode(gBuffer1Config, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);
         renderGraph.addNode(lastUpdatedGBufferClearingNode, ""gBuffer1ClearingNode"");
 
-        BufferClearingNode staleGBufferClearingNode =
-                new BufferClearingNode(gBuffer2Config, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);
+        BufferClearingNode staleGBufferClearingNode = new BufferClearingNode(gBuffer2Config, displayResolutionDependentFBOs, GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);
         renderGraph.addNode(staleGBufferClearingNode, ""gBuffer2ClearingNode"");
 
         Node backdropNode = new BackdropNode(context);
         renderGraph.addNode(backdropNode, ""backdropNode"");
 
+        DisplayResolutionDependentFBOs displayResolutionDependentFBOs = context.get(DisplayResolutionDependentFBOs.class);
+
         FBOConfig hazeIntermediateConfig = new FBOConfig(HazeNode.INTERMEDIATE_HAZE_FBO_URI, ONE_16TH_SCALE, FBO.Type.DEFAULT);
         FBO hazeIntermediateFbo = displayResolutionDependentFBOs.request(hazeIntermediateConfig);
 
@@ -335,7 +333,7 @@
         renderGraph.addNode(hazeFinalNode, label + ""Node"");
     }
 
-    private void addWorldRenderingNodes() {
+    private void addWorldRenderingNodes(RenderGraph renderGraph) {
         Node opaqueObjectsNode = new OpaqueObjectsNode(context);
         renderGraph.addNode(opaqueObjectsNode, ""opaqueObjectsNode"");
 
@@ -353,7 +351,7 @@
         renderGraph.addNode(firstPersonViewNode, ""firstPersonViewNode"");
     }
 
-    private void addLightingNodes() {
+    private void addLightingNodes(RenderGraph renderGraph) {
         Node deferredPointLightsNode = new DeferredPointLightsNode(context);
         renderGraph.addNode(deferredPointLightsNode, ""DeferredPointLightsNode"");
 
@@ -364,13 +362,13 @@
         renderGraph.addNode(applyDeferredLightingNode, ""applyDeferredLightingNode"");
     }
 
-    private void addRefractiveReflectiveNode() {
+    private void addRefractiveReflectiveNode(RenderGraph renderGraph) {
         Node chunksRefractiveReflectiveNode = new RefractiveReflectiveBlocksNode(context);
         renderGraph.addNode(chunksRefractiveReflectiveNode, ""chunksRefractiveReflectiveNode"");
         // TODO: consider having a non-rendering node for FBO.attachDepthBufferTo() methods
     }
 
-    private void add3dDecorationNodes() {
+    private void add3dDecorationNodes(RenderGraph renderGraph) {
         Node outlineNode = new OutlineNode(context);
         renderGraph.addNode(outlineNode, ""outlineNode"");
 
@@ -381,7 +379,7 @@
         renderGraph.addNode(blurredAmbientOcclusionNode, ""blurredAmbientOcclusionNode"");
     }
 
-    private void addPrePostProcessingNodes() {
+    private void addPrePostProcessingNodes(RenderGraph renderGraph) {
         // Pre-post-processing, just one more interaction with 3D data (semi-transparent objects, in SimpleBlendMaterialsNode)
         // and then it's 2D post-processing all the way to the image shown on the display.
         Node prePostCompositeNode = new PrePostCompositeNode(context);
@@ -391,7 +389,7 @@
         renderGraph.addNode(simpleBlendMaterialsNode, ""simpleBlendMaterialsNode"");
     }
 
-    private void addPostProcessingNodes() {
+    private void addPostProcessingNodes(RenderGraph renderGraph) {
         // Post-Processing proper: tone mapping, light shafts, bloom and blur passes
         Node lightShaftsNode = new LightShaftsNode(context);
         renderGraph.addNode(lightShaftsNode, ""lightShaftsNode"");
@@ -401,13 +399,11 @@
 
         FBOConfig gBuffer2Config = displayResolutionDependentFBOs.getFboConfig(new SimpleUri(""engine:fbo.gBuffer2"")); // TODO: Remove the hard coded value here
         String label = ""downSampling_gBuffer_to_16x16px_forExposure"";
-        DownSamplerForExposureNode exposureDownSamplerTo16pixels =
-                new DownSamplerForExposureNode(context, gBuffer2Config, displayResolutionDependentFBOs, FBO_16X16_CONFIG, immutableFBOs, label);
+        DownSamplerForExposureNode exposureDownSamplerTo16pixels = new DownSamplerForExposureNode(context, gBuffer2Config, displayResolutionDependentFBOs, FBO_16X16_CONFIG, immutableFBOs, label);
         renderGraph.addNode(exposureDownSamplerTo16pixels, label + ""Node"");
 
         label = ""downSampling_16x16px_to_8x8px_forExposure"";
-        DownSamplerForExposureNode exposureDownSamplerTo8pixels =
-                new DownSamplerForExposureNode(context, FBO_16X16_CONFIG, immutableFBOs, FBO_8X8_CONFIG, immutableFBOs, label);
+        DownSamplerForExposureNode exposureDownSamplerTo8pixels = new DownSamplerForExposureNode(context, FBO_16X16_CONFIG, immutableFBOs, FBO_8X8_CONFIG, immutableFBOs, label);
         renderGraph.addNode(exposureDownSamplerTo8pixels, label + ""Node"");
 
         label = ""downSampling_8x8px_to_4x4px_forExposure"";
@@ -432,6 +428,8 @@
         Node highPassNode = new HighPassNode(context);
         renderGraph.addNode(highPassNode, ""highPassNode"");
 
+        DisplayResolutionDependentFBOs displayResolutionDependentFBOs = context.get(DisplayResolutionDependentFBOs.class);
+
         FBOConfig halfScaleBloomConfig = new FBOConfig(BloomBlurNode.HALF_SCALE_FBO_URI, HALF_SCALE, FBO.Type.DEFAULT);
         FBO halfScaleBloomFbo = displayResolutionDependentFBOs.request(halfScaleBloomConfig);
 
@@ -472,7 +470,7 @@
         renderGraph.addNode(finalPostProcessingNode, ""finalPostProcessingNode"");
     }
 
-    private void addOutputNodes() {
+    private void addOutputNodes(RenderGraph renderGraph) {
         Node copyToVRFrameBufferNode = new OutputToHMDNode(context);
         renderGraph.addNode(copyToVRFrameBufferNode, ""outputToVRFrameBufferNode"");
 
@@ -532,7 +530,7 @@
 
         currentRenderingStage = renderingStage;
 
-        if (currentRenderingStage == RenderingStage.MONO || currentRenderingStage == RenderingStage.LEFT_EYE) {
+        if ((currentRenderingStage == RenderingStage.MONO) || (currentRenderingStage == RenderingStage.LEFT_EYE)) {
             isFirstRenderingStageForCurrentFrame = true;
         } else {
             isFirstRenderingStageForCurrentFrame = false;
@@ -571,10 +569,10 @@
      * TODO: update javadocs
      * This method triggers the execution of the rendering pipeline and, eventually, sends the output to the display
      * or to a file, when grabbing a screenshot.
-     * <p>
+     *
      * In this particular implementation this method can be called once per frame, when rendering to a standard display,
      * or twice, each time with a different rendering stage, when rendering to the head mounted display.
-     * <p>
+     *
      * PerformanceMonitor.startActivity/endActivity statements are used in this method and in those it executes,
      * to provide statistics regarding the ongoing rendering and its individual steps (i.e. rendering shadows,
      * reflections, 2D filters...).
@@ -703,32 +701,25 @@
     }
 
     @Override
-    public void initialise() {
-    }
+    public void initialise() { }
 
     @Override
-    public void preBegin() {
-    }
+    public void preBegin() { }
 
     @Override
-    public void postBegin() {
-    }
+    public void postBegin() { }
 
     @Override
-    public void preSave() {
-    }
+    public void preSave() { }
 
     @Override
-    public void postSave() {
-    }
+    public void postSave() { }
 
     @Override
-    public void shutdown() {
-    }
+    public void shutdown() { }
 
     @Command(shortDescription = ""Debugging command for DAG."", requiredPermission = PermissionManager.NO_PERMISSION)
-    public void dagNodeCommand(@CommandParam(""nodeUri"") final String nodeUri, @CommandParam(""command"") final String command,
-                               @CommandParam(value = ""arguments"") final String... arguments) {
+    public void dagNodeCommand(@CommandParam(""nodeUri"") final String nodeUri, @CommandParam(""command"") final String command, @CommandParam(value = ""arguments"") final String... arguments) {
         Node node = renderGraph.findNode(new SimpleUri(nodeUri));
         if (node == null) {
             throw new RuntimeException((""No node is associated with URI '"" + nodeUri + ""'""));",1
[UNDERTOW-787]: Fix to convert response time to seconds format,"         final long nanos = System.nanoTime() - requestStartTime;
         if(timeUnit == TimeUnit.SECONDS) {
             StringBuilder buf = new StringBuilder();
-            long milis = TimeUnit.MILLISECONDS.convert(nanos, TimeUnit.NANOSECONDS);
+            long milis = timeUnit.convert(nanos, TimeUnit.NANOSECONDS);
             buf.append(Long.toString(milis / 1000));
             buf.append('.');
             int remains = (int) (milis % 1000);",1
HdfsFetcher fixes," 
     public static final String FS_DEFAULT_NAME = ""fs.default.name"";
 
-    private static Boolean allowFetchOfFiles = false;
-
     /* Additional constructor invoked from ReadOnlyStoreManagementServlet */
     public HdfsFetcher(VoldemortConfig config) {
         this(config, null);
@@ -435,11 +433,6 @@
                     return true;
                 }
             }
-        } else if (allowFetchOfFiles) {
-            Utils.mkdirs(dest);
-	    File copyLocation = new File(dest, source.getName());
-	    copyFileWithCheckSum(fs, source, copyLocation, stats, CheckSumType.NONE);
-	    return true;
         }
         logger.error(""Source "" + source.toString() + "" should be a directory"");
         return false;
@@ -676,23 +669,17 @@
     public static void main(String[] args) throws Exception {
         if(args.length < 1)
             Utils.croak(""USAGE: java "" + HdfsFetcher.class.getName()
-                        + "" url [keytab-location kerberos-username hadoop-config-path [destDir]]"");
+                        + "" url [keytab location] [kerberos username] [hadoop-config-path]"");
         String url = args[0];
 
         String keytabLocation = """";
         String kerberosUser = """";
         String hadoopPath = """";
-	String destDir = null;
-        if(args.length >= 4) {
+        if(args.length == 4) {
             keytabLocation = args[1];
             kerberosUser = args[2];
             hadoopPath = args[3];
         }
-        if(args.length >= 5)
-            destDir = args[4];
-
-	// for testing we want to be able to download a single file
-	allowFetchOfFiles = true;
 
         long maxBytesPerSec = 1024 * 1024 * 1024;
         Path p = new Path(url);
@@ -787,10 +774,9 @@
                                               5,
                                               5000);
         long start = System.currentTimeMillis();
-	if(destDir == null)
-	    destDir = System.getProperty(""java.io.tmpdir"") + File.separator + start;
 
-        File location = fetcher.fetch(url, destDir, hadoopPath);
+        File location = fetcher.fetch(url, System.getProperty(""java.io.tmpdir"") + File.separator
+                                           + start, hadoopPath);
 
         double rate = size * Time.MS_PER_SECOND / (double) (System.currentTimeMillis() - start);
         NumberFormat nf = NumberFormat.getInstance();",1
Reduce fixed per-group cost of array_agg,"     {
         BlockBuilder blockBuilder = state.getBlockBuilder();
         if (blockBuilder == null) {
-            blockBuilder = type.createBlockBuilder(new BlockBuilderStatus(), 4);
+            blockBuilder = type.createBlockBuilder(new BlockBuilderStatus(), 100);
             state.setBlockBuilder(blockBuilder);
         }
         long startSize = blockBuilder.getRetainedSizeInBytes();",1
Fix for rare ArrayIndexOutOfBoundsException in AndroidMultiTouchHandler," 			case MotionEvent.ACTION_DOWN:
 			case MotionEvent.ACTION_POINTER_DOWN:
 				realPointerIndex = input.getFreePointerIndex(); // get a free pointer index as reported by Input.getX() etc.
-				if (realPointerIndex >= AndroidInput.NUM_TOUCHES) break;
 				input.realId[realPointerIndex] = pointerId;
 				x = (int)event.getX(pointerIndex);
 				y = (int)event.getY(pointerIndex);
@@ -59,7 +58,6 @@
 			case MotionEvent.ACTION_CANCEL:
 				realPointerIndex = input.lookUpPointerIndex(pointerId);
 				if (realPointerIndex == -1) break;
-				if (realPointerIndex >= AndroidInput.NUM_TOUCHES) break;
 				input.realId[realPointerIndex] = -1;
 				x = (int)event.getX(pointerIndex);
 				y = (int)event.getY(pointerIndex);
@@ -80,7 +78,6 @@
 					y = (int)event.getY(pointerIndex);
 					realPointerIndex = input.lookUpPointerIndex(pointerId);
 					if (realPointerIndex == -1) continue;
-					if (realPointerIndex >= AndroidInput.NUM_TOUCHES) break;
 					postTouchEvent(input, TouchEvent.TOUCH_DRAGGED, x, y, realPointerIndex, timeStamp);
 					input.deltaX[realPointerIndex] = x - input.touchX[realPointerIndex];
 					input.deltaY[realPointerIndex] = y - input.touchY[realPointerIndex];",1
Fix windowInHours checking.," import javax.servlet.http.HttpServletRequest;
 import java.math.BigDecimal;
 import java.time.ZonedDateTime;
-import java.time.ZoneOffset;
 import java.util.Collection;
 
 /**
@@ -32,20 +31,17 @@
     @Override
     protected BigDecimal calculateScore(final HttpServletRequest request, final Authentication authentication,
                                         final RegisteredService service, final Collection<CasEvent> events) {
-        final ZonedDateTime timestamp = ZonedDateTime.now(ZoneOffset.UTC);
+        final ZonedDateTime timestamp = ZonedDateTime.now();
         LOGGER.debug(""Filtering authentication events for timestamp [{}]"", timestamp);
-        long count = 0;
 
-        if (timestamp.getHour() <= timestamp.plusHours(windowInHours).getHour()
-                && timestamp.getHour() >= timestamp.minusHours(windowInHours).getHour()){
-            count = events.stream().filter(e->e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
-                && e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
-        } else {
-            count = events.stream().filter(e -> e.getCreationTime().getHour() <= timestamp.plusHours(windowInHours).getHour()
-                || e.getCreationTime().getHour() >= timestamp.minusHours(windowInHours).getHour()).count();
-        }
+        final long count = events.stream().filter(e -> {
+            final int hour = timestamp.getHour();
+            return e.getCreationTime().getHour() == hour
+                    || e.getCreationTime().plusHours(windowInHours).getHour() == hour
+                    || e.getCreationTime().minusHours(windowInHours).getHour() == hour;
+        }).count();
         
-        LOGGER.debug(""Total authentication events found for [{}] in a [{}]h window: [{}]"", timestamp, windowInHours, count);
+        LOGGER.debug(""Total authentication events found for [{}]: [{}]"", timestamp, count);
         if (count == events.size()) {
             LOGGER.debug(""Principal [{}] has always authenticated from [{}]"", authentication.getPrincipal(), timestamp);
             return LOWEST_RISK_SCORE;",1
HHH-11725 - Fix javadoc typo," import org.hibernate.type.TypeHelper;
 
 /**
- * A convenience base class for listeners responding to save events.
+ * A convenience bas class for listeners responding to save events.
  *
  * @author Steve Ebersole.
  */",1
removed semicolon after class ending brace. fixes compilation with scala's java compiler," 	// ===========================================================
 	// Inner and Anonymous Classes
 	// ===========================================================
+};
\ No newline at end of file
-}
\ No newline at end of file",1
fix NPE because of incorrect usage of firstNonNull," import javax.inject.Inject;
 import javax.inject.Named;
 
+import static com.google.common.base.MoreObjects.firstNonNull;
+
 /**
  * Gets predefined docker containers host for machine servers instead of evaluating it from docker configuration
  *
@@ -39,7 +41,8 @@
     public LocalDockerInstanceRuntimeInfo(@Assisted ContainerInfo containerInfo,
                                           @Assisted String containerHost,
                                           @Nullable @Named(""machine.docker.local_node_host"") String dockerNodeHost) {
-        super(containerInfo, dockerNodeHost != null ? dockerNodeHost :
-                             (System.getenv(CHE_DOCKER_MACHINE_HOST) != null ? System.getenv(CHE_DOCKER_MACHINE_HOST) : containerHost));
+        super(containerInfo, firstNonNull(firstNonNull(dockerNodeHost,
+                                                       System.getenv(CHE_DOCKER_MACHINE_HOST)),
+                                          containerHost));
     }
 }",1
Fixes #114 by removing the outdated test in the TCK and adding guideline...,"   ////////////////////// OTHER RULE VERIFICATION ///////////////////////////
 
   // A Processor
+  //   must cancel its upstream Subscription if its last downstream Subscription has been cancelled
+  @Test
+  public void mustCancelItsUpstreamSubscriptionIfItsLastDownstreamSubscriptionHasBeenCancelled() throws Exception {
+    new TestSetup(env, processorBufferSize) {{
+      final ManualSubscriber<T> sub = newSubscriber();
+      sub.cancel();
+      expectCancelling();
+
+      env.verifyNoAsyncErrors();
+    }};
+  }
+
+  // A Processor
   //   must immediately pass on `onError` events received from its upstream to its downstream
   @Test
   public void mustImmediatelyPassOnOnErrorEventsReceivedFromItsUpstreamToItsDownstream() throws Exception {",1
Fix ParseFieldOperations bug,"         int size = source.readInt();
         List<Object> list = new ArrayList<>(size);
         for (int i = 0; i < size; i++) {
-          list.add(i, decoder.decode(source));
+          list.set(i, decoder.decode(source));
         }
         return new ParseAddOperation(list);
       }
@@ -123,7 +123,7 @@
         int size = source.readInt();
         List<Object> list = new ArrayList<>(size);
         for (int i = 0; i < size; i++) {
-          list.add(i, decoder.decode(source));
+          list.set(i, decoder.decode(source));
         }
         return new ParseAddUniqueOperation(list);
       }
@@ -141,7 +141,7 @@
         int size = source.readInt();
         List<Object> list = new ArrayList<>(size);
         for (int i = 0; i < size; i++) {
-          list.add(i, decoder.decode(source));
+          list.set(i, decoder.decode(source));
         }
         return new ParseRemoveOperation(list);
       }",1
fixes to docs," 
     /**
      * The default executor service is {@link Executors#newCachedThreadPool()}.
-     * Please note that it may prevent the VM from shutdown.
+     * Please note that it may prevent the VM from shutdown.}
      */
     ExecutorService DEFAULT_EXECUTOR_SERVICE = Executors.newCachedThreadPool();
 ",1
Fix tile rendering for larger conferences," 			case 4:
 				drawTile(canvas, letters[0], colors[0], fgColor,
 						0, 0, size/2 - 1, size/2 - 1);
-				drawTile(canvas, letters[1], colors[0], fgColor,
+				drawTile(canvas, letters[0], colors[0], fgColor,
 						0, size/2 + 1, size/2 - 1, size);
 				drawTile(canvas, letters[2], colors[2], fgColor,
 						size/2 + 1, 0, size, size/2 - 1);",1
"Fixed realm URI computation for the case of non absolute uri, null query, and not omit query","                 return requestURI.toString();
             }
         } else {
-            if (realm.isOmitQuery() || !isNonEmpty(requestURI.getQuery())) {
+            if (realm.isOmitQuery() && isNonEmpty(requestURI.getQuery())) {
                 return requestURI.getPath();
             } else {
                 return requestURI.getPath() + ""?"" + requestURI.getQuery();",1
Fix #508 #427,"     private void loadSource() {
         if (name != null && content != null)
             if (markdown)
-                view.loadDataWithBaseURL(null, content, ""text/html"", CHARSET_UTF8, null);
+                view.loadData(content, ""text/html; charset=utf-8"", null);
             else
                 view.loadUrl(URL_PAGE);
     }",1
Fixes memory leak when unavailable presence does not contain 'caps' extension,"      */
     public void addPacketListener(XMPPConnection connection)
     {
-        PacketFilter filter = new PacketTypeFilter(Presence.class);
+        PacketFilter filter
+            = new AndFilter(
+                    new PacketTypeFilter(Presence.class),
+                    new PacketExtensionFilter(
+                            CapsPacketExtension.ELEMENT_NAME,
+                            CapsPacketExtension.NAMESPACE));
 
         connection.addPacketListener(new CapsPacketListener(), filter);
     }
@@ -936,6 +941,30 @@
          */
         public void processPacket(Packet packet)
         {
+            CapsPacketExtension ext
+                = (CapsPacketExtension)
+                    packet.getExtension(
+                            CapsPacketExtension.ELEMENT_NAME,
+                            CapsPacketExtension.NAMESPACE);
+
+            /*
+             * Before Version 1.4 of XEP-0115: Entity Capabilities, the 'ver'
+             * attribute was generated differently and the 'hash' attribute was
+             * absent. The 'ver' attribute in Version 1.3 represents the
+             * specific version of the client and thus does not provide a way to
+             * validate the DiscoverInfo sent by the client. If
+             * EntityCapsManager receives no 'hash' attribute, it will assume
+             * the legacy format and will not cache it because the DiscoverInfo
+             * to be received from the client later on will not be trustworthy.
+             */
+            String hash = ext.getHash();
+
+            /* Google Talk web does not set hash but we need it to be cached */
+            if(hash == null)
+                hash = """";
+
+            if (hash != null)
+            {
                 // Check it the packet indicates  that the user is online. We
                 // will use this information to decide if we're going to send
                 // the discover info request.
@@ -943,44 +972,20 @@
                     = (packet instanceof Presence)
                         && ((Presence) packet).isAvailable();
 
-            CapsPacketExtension ext
-                = (CapsPacketExtension)
-                    packet.getExtension(
-                            CapsPacketExtension.ELEMENT_NAME,
-                            CapsPacketExtension.NAMESPACE);
-
-            if(ext != null && online)
+                if(online)
                 {
-                /*
-                 * Before Version 1.4 of XEP-0115: Entity Capabilities,
-                 * the 'ver' attribute was generated differently and the 'hash'
-                 * attribute was absent. The 'ver' attribute in Version 1.3
-                 * represents the specific version of the client and thus does
-                 * not provide a way to validate the DiscoverInfo sent by
-                 * the client. If EntityCapsManager receives no 'hash'
-                 * attribute, it will assume the legacy format and will not
-                 * cache it because the DiscoverInfo to be received from
-                 * the client later on will not be trustworthy.
-                 */
-                String hash = ext.getHash();
-
-                /* Google Talk web does not set hash, but we need it to
-                 * be cached
-                 */
-                if (hash == null)
-                    hash = """";
-
                     addUserCapsNode(
                             packet.getFrom(),
                             ext.getNode(), hash, ext.getVersion(),
                             ext.getExtensions(), online);
                 }
-            else if (!online)
+                else
                 {
                     removeUserCapsNode(packet.getFrom());
                 }
             }
         }
+    }
 
     /**
      * Implements an immutable value which stands for a specific node, a",1
Added null check when ValidateAddActivity evaluates the order currency,"     }
 
     protected boolean hasSameCurrency(OrderItemRequestDTO orderItemRequestDTO, CartOperationRequest request, Sku sku) {
-        if (orderItemRequestDTO instanceof NonDiscreteOrderItemRequestDTO || sku == null || sku.getCurrency() == null || request.getOrder().getCurrency() == null) {
+        if (orderItemRequestDTO instanceof NonDiscreteOrderItemRequestDTO || sku == null || sku.getCurrency() == null) {
             return true;
         } else {
             BroadleafCurrency orderCurrency = request.getOrder().getCurrency();",1
Fixes positioning when using setSelection() and setSelectionFromTop()," 	}
 
 	public void setSelection(int position) {
-		setSelectionFromTop(position, 0);
+		mList.setSelection(position);
 	}
 
 	public void setSelectionAfterHeaderView() {
@@ -738,7 +738,6 @@
 	}
 
 	public void setSelectionFromTop(int position, int y) {
-		y += mAdapter == null ? 0 : getHeaderOverlap(position);
 		mList.setSelectionFromTop(position, y);
 	}
 ",1
"Remove Query.CompleteBuilder.whereArgs(list), it was error in API, sorry guys","         }
 
         /**
+         * Optional: Specifies arguments for where clause.
+         * <p>
+         * Passed objects will be immediately converted list of
+         * to {@link String} via calling {@link Object#toString()}.
+         * <p>
+         * Default value is {@code null}.
+         *
+         * @param whereArgs list of arguments for where clause.
+         * @return builder.
+         * @see Query#whereArgs()
+         */
+        @NonNull
+        public CompleteBuilder whereArgs(@Nullable List<?> whereArgs) {
+            this.whereArgs = unmodifiableNonNullListOfStrings(whereArgs);
+            return this;
+        }
+
+        /**
          * Optional: Specifies {@code GROUP BY} clause.
          * <p>
          * Optional filter declaring how to group rows.",1
Account for plane in TileObject canvas location," 	@Inject
 	public Point getCanvasLocation(int zOffset)
 	{
-		return Perspective.worldToCanvas(client, getX(), getY(), getPlane(), zOffset);
+		return Perspective.worldToCanvas(client, getX(), getY(), 0, zOffset);
 	}
 
 	@Override",1
Fix return type in CompleteBuilder,"          * @return builder
          */
         @NonNull
-        public CompleteBuilder projection(@Nullable String... columns) {
+        public Builder projection(@Nullable String... columns) {
             projection = QueryUtil.varargsToList(columns);
             return this;
         }
@@ -179,7 +179,7 @@
          * @return builder
          */
         @NonNull
-        public CompleteBuilder where(@Nullable String where) {
+        public Builder where(@Nullable String where) {
             this.where = where;
             return this;
         }
@@ -195,7 +195,7 @@
          * @return builder
          */
         @NonNull
-        public CompleteBuilder whereArgs(@Nullable Object... whereArgs) {
+        public Builder whereArgs(@Nullable Object... whereArgs) {
             this.whereArgs = QueryUtil.varargsToList(whereArgs);
             return this;
         }
@@ -210,7 +210,7 @@
          * @return builder
          */
         @NonNull
-        public CompleteBuilder sortOrder(@Nullable String sortOrder) {
+        public Builder sortOrder(@Nullable String sortOrder) {
             this.sortOrder = sortOrder;
             return this;
         }",1
Fix Hazelcast ticket deletion when ticket encryption is enabled for 5.0.x," 
     @Override
     public boolean deleteSingleTicket(final String ticketId) {
-        final String encTicketId = encodeTicketId(ticketId);
-        return this.registry.remove(encTicketId) != null;
+        return this.registry.remove(ticketId) != null;
     }
 
     @Override",1
修复一个引起空指针异常的bug," 		}
 	}
 
-    /**
-     * 执行过此方法后,FinalBitmap的缓存已经失效,建议通过FinalBitmap.create()获取新的实例
-     * 
-     * @author fantouch
-     */
 	private void closeCacheInternalInBackgroud() {
 		if (mImageCache != null) {
 			mImageCache.close();
 			mImageCache = null;
-
-            // 修改这里是的原因是一个引起空指针异常的bug
-            // 重现:
-            // 1.Activity.onCreat()执行FinalBitmap.create(),FinalBitmap.configCompressFormat();
-            // 2.Activity的生命周期里相应调用FinalBitmap.onPause(),onResume(),onDestory()
-            // 3.退出Activity,Activity.onDestory()被执行,于是FinalBitmap.onDestory()被执行
-            // 4.再次进入Activity,FinalBitmap.configCompressFormat()报空指针
-            // 原因:
-            // FinalBitmap.onDestory()会调用本方法,导致mImageCache==null.
-            // (FinalBitmap.closeCache()也是)
-            // 解决思路:
-            // mImageCache只能在FinalBitmap.init()方法中实例化,
-            // FinalBitmap.init()只能被FinalBitmap.create()调用,
-            // 要使FinalBitmap.create()能被有效调用,必须使mFinalBitmap==null,
-            // 因此,mImageCache和mFinalBitmap的生命周期应当是同步的,
-            // 一旦mImageCache==null,也应使mFinalBitmap==null.
-            // !!另外,有必要警告用户,他们手上的FinalBitmap实例的缓存已经失效,最好通过FinalBitmap.create()获取新的实例
-            mFinalBitmap = null;
 		}
 		if (mConfig != null && mConfig.bitmapProcess != null) {
 			mConfig.bitmapProcess.clearCacheInternal();
@@ -670,10 +647,6 @@
     
     /**
      * activity onDestroy的时候调用这个方法，释放缓存
-     * <p>
-     * 执行过此方法后,FinalBitmap的缓存已经失效,建议通过FinalBitmap.create()获取新的实例
-     * 
-     * @author fantouch
      */
     public void onDestroy() {
         closeCache();
@@ -736,10 +709,6 @@
 
 	/**
 	 * 关闭缓存
-     * <p>
-     * 执行过此方法后,FinalBitmap的缓存已经失效,建议通过FinalBitmap.create()获取新的实例
-     * 
-     * @author fantouch
 	 */
 	public void closeCache() {
 		new CacheExecutecTask().execute(CacheExecutecTask.MESSAGE_CLOSE);",1
Fix: WifiManagerPatch FC: MacAddress may be null," 			public Object call(Object who, Method method, Object... args) throws Throwable {
 				WifiInfo info = (WifiInfo) super.call(who, method, args);
 				if (info != null) {
-					if (info.getMacAddress() != null && info.getMacAddress().startsWith(""00-00-00-00-00-00"")) {
+					if (info.getMacAddress().startsWith(""00-00-00-00-00-00"")) {
 						Reflect.on(info).set(""mMacAddress"", ""00:00:08:76:54:32"");
 					}
 				}",1
Fix for console suggestion throwing IOOBE," import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 import org.terasology.entitySystem.entity.EntityRef;
+import org.terasology.logic.console.commandSystem.annotations.CommandParam;
 import org.terasology.logic.console.commandSystem.exceptions.CommandExecutionException;
 import org.terasology.logic.console.commandSystem.exceptions.CommandInitializationException;
 import org.terasology.logic.console.commandSystem.exceptions.CommandParameterParseException;
@@ -36,7 +37,6 @@
 
 import java.lang.reflect.Method;
 import java.util.Collections;
-import java.util.Iterator;
 import java.util.List;
 import java.util.Queue;
 import java.util.Set;
@@ -246,10 +246,10 @@
     @Override
     public final Set<String> suggest(final String currentValue, List<String> rawParameters, EntityRef sender) throws CommandSuggestionException {
         //Generate an array to be used as a parameter in the 'suggest' method
-        Object[] processedParameters;
+        Object[] processedParametersWithoutSender;
 
         try {
-            processedParameters = processParametersMethod(rawParameters, sender);
+            processedParametersWithoutSender = processParametersMethod(rawParameters, sender);
         } catch (CommandParameterParseException e) {
             String warning = ""Invalid parameter '"" + e.getParameter() + ""'"";
             String message = e.getMessage();
@@ -263,17 +263,12 @@
 
         //Get the suggested parameter to compare the result with
         CommandParameter suggestedParameter = null;
-        Iterator<CommandParameter> paramIter = commandParameters.iterator();
 
-        for (Object processedParameter : processedParameters) {
-            if (sender.equals(processedParameter)) {
-                continue;
-            }
-            if (processedParameter == null) {
-                suggestedParameter = paramIter.next();
+        for (int i = 0; i < processedParametersWithoutSender.length; i++) {
+            if (processedParametersWithoutSender[i] == null) {
+                suggestedParameter = commandParameters.get(i);
                 break;
             }
-            paramIter.next();
         }
 
         if (suggestedParameter == null) {
@@ -283,7 +278,7 @@
         Set<Object> result = null;
 
         try {
-            result = suggestedParameter.suggest(sender, processedParameters);
+            result = suggestedParameter.suggest(sender, processedParametersWithoutSender);
         } catch (Throwable t) {
             throw new CommandSuggestionException(t.getCause()); //Skip InvocationTargetException
         }",1
[apex] Fix broken Apex visitor adapter," public class ApexParserVisitorAdapter implements ApexParserVisitor {
     @Override
     public Object visit(ApexNode<?> node, Object data) {
-        return node.childrenAccept(this, data);
+        node.childrenAccept(this, data);
+        return null;
     }
 
     @Override",1
Fix Password Management webflow state (master),"                 CasWebflowConstants.VIEW_ID_INVALID_AUTHENTICATION_HOURS);
         createViewState(flow, CasWebflowConstants.VIEW_ID_ACCOUNT_LOCKED, CasWebflowConstants.VIEW_ID_ACCOUNT_LOCKED);
         createViewState(flow, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED);
-        createEndState(flow, CasWebflowConstants.STATE_ID_PASSWORD_UPDATE_SUCCESS, CasWebflowConstants.VIEW_ID_PASSWORD_UPDATE_SUCCESS);
+        createEndState(flow, CasWebflowConstants.VIEW_ID_PASSWORD_UPDATE_SUCCESS, CasWebflowConstants.VIEW_ID_PASSWORD_UPDATE_SUCCESS);
 
         if (casProperties.getAuthn().getPm().isEnabled()) {
             configurePasswordResetFlow(flow, CasWebflowConstants.VIEW_ID_ACCOUNT_DISABLED);",1
[1.11] Fix dormant chunk cache allowing entity data to be overwritten," 
         loadChunkEntities(entry.chunk, entry.nbt, world);
 
-        cache.invalidate(coords);
         return entry.chunk;
     }
 ",1
Fixed invalid error message for Mail step,"           throw new KettleException( BaseMessages.getString( PKG, ""Mail.Exception.AttachedContentFieldEmpty"" ) );
         }
         data.indexOfAttachedContent = data.previousRowMeta.indexOfValue( attachedContentField );
-        if ( data.indexOfAttachedContent < 0 ) {
+        if ( data.indexOfComment < 0 ) {
           throw new KettleException( BaseMessages.getString(
             PKG, ""Mail.Exception.CouldnotFindAttachedContentField"", attachedContentField ) );
         }
@@ -323,7 +323,7 @@
             PKG, ""Mail.Exception.AttachedContentFileNameFieldEmpty"" ) );
         }
         data.IndexOfAttachedFilename = data.previousRowMeta.indexOfValue( attachedContentFileNameField );
-        if ( data.IndexOfAttachedFilename < 0 ) {
+        if ( data.indexOfComment < 0 ) {
           throw new KettleException( BaseMessages.getString(
             PKG, ""Mail.Exception.CouldnotFindAttachedContentFileNameField"", attachedContentFileNameField ) );
         }",1
Fixed the parametrized types in the method signatures of Model.class," 		new Delete().from(type).where(""Id=?"", id).execute();
 	}
 
-	public static <T extends Model> T load(Class<T> type, long id) {
+	public static <T extends Model> T load(Class<? extends Model> type, long id) {
 		return new Select().from(type).where(""Id=?"", id).executeSingle();
 	}
 
@@ -269,7 +269,7 @@
 	// PROTECTED METHODS
 	//////////////////////////////////////////////////////////////////////////////////////
 
-	protected final <T extends Model> List<T> getMany(Class<T> type, String foreignKey) {
+	protected final <E extends Model> List<E> getMany(Class<? extends Model> type, String foreignKey) {
 		return new Select().from(type).where(Cache.getTableName(type) + ""."" + foreignKey + ""=?"", getId()).execute();
 	}
 ",1
Fix Incorrect letter ," 	private static final String NACOS_PROPERTY_SOURCE_NAME = ""NACOS"";
 	private static final String SEP1 = ""-"";
 	private static final String DOT = ""."";
-	private static final String SHARED_CONFIG_SEPARATOR_CHAR = ""[,]"";
+	private static final String SHARED_CONFIG_SEPRATOR_CHAR = ""[,]"";
 	private static final List<String> SUPPORT_FILE_EXTENSION = Arrays.asList(""properties"",
 			""yaml"", ""yml"");
 
@@ -106,7 +106,7 @@
 			return;
 		}
 
-		String[] sharedDataIdArry = sharedDataIds.split(SHARED_CONFIG_SEPARATOR_CHAR);
+		String[] sharedDataIdArry = sharedDataIds.split(SHARED_CONFIG_SEPRATOR_CHAR);
 		checkDataIdFileExtension(sharedDataIdArry);
 
 		for (int i = 0; i < sharedDataIdArry.length; i++) {
@@ -212,7 +212,7 @@
 			return false;
 		}
 
-		String[] refreshDataIdArry = refreshDataIds.split(SHARED_CONFIG_SEPARATOR_CHAR);
+		String[] refreshDataIdArry = refreshDataIds.split(SHARED_CONFIG_SEPRATOR_CHAR);
 		for (String refreshDataId : refreshDataIdArry) {
 			if (refreshDataId.equals(sharedDataId)) {
 				return true;",1
fix not thrown exception," 		try {
 			executor.awaitTermination(Long.MAX_VALUE, TimeUnit.SECONDS);
 		} catch (InterruptedException e) {
-			throw new GdxRuntimeException(""Couldn't shutdown loading thread"", e);
+			new GdxRuntimeException(""Couldn't shutdown loading thread"");
 		}
 	}
 }",1
Fix poor quality selected title (selected title has been drawn twice),"         }
 
         //Now draw views
-        int colorTextAlpha = mColorText >>> 24;
         for (int i = 0; i < count; i++) {
             //Get the title
             RectF bound = bounds.get(i);
@@ -412,10 +411,6 @@
 
                 //Draw text as unselected
                 mPaintText.setColor(mColorText);
-                if(currentPage && currentSelected) {
-                    //Fade out/in unselected text as the selected text fades in/out
-                    mPaintText.setAlpha(colorTextAlpha - (int)(colorTextAlpha * selectedPercent));
-                }
                 canvas.drawText(mTitleProvider.getTitle(i), bound.left, bound.bottom + mTopPadding, mPaintText);
 
                 //If we are within the selected bounds draw the selected text",1
Avoid NullPointerException in ZK server stats collection," 
 import io.prometheus.client.Gauge;
 
-import org.apache.zookeeper.server.ServerCnxnFactory;
 import org.apache.zookeeper.server.ZooKeeperServer;
 import org.aspectj.lang.JoinPoint;
 import org.aspectj.lang.annotation.After;
@@ -72,12 +71,7 @@
                 .setChild(new Gauge.Child() {
                     @Override
                     public double get() {
-                        ServerCnxnFactory cnxFactory = zkServer.getServerCnxnFactory();
-                        if (cnxFactory != null) {
-                            return cnxFactory.getNumAliveConnections();
-                        } else {
-                            return -1;
-                        }
+                        return zkServer.serverStats().getNumAliveClientConnections();
                     }
                 }).register();
 ",1
FIX: ClickDetector was claiming to handle touch event when it did not," 			case TouchEvent.ACTION_UP:
 			case TouchEvent.ACTION_CANCEL:
 			    if(this.mPointerID == pSceneTouchEvent.getPointerID()) {
-					boolean handled = false;
     				final long upTimeMilliseconds = pSceneTouchEvent.getMotionEvent().getEventTime();
 
     				if(upTimeMilliseconds - this.mDownTimeMilliseconds <= this.mTriggerClickMaximumMilliseconds) {
     					this.mDownTimeMilliseconds = Long.MIN_VALUE;
     					this.mClickDetectorListener.onClick(this, pSceneTouchEvent.getPointerID(), pSceneTouchEvent.getX(), pSceneTouchEvent.getY());
-						handled = true;
     				}
 
     				this.mPointerID = TouchEvent.INVALID_POINTER_ID;
-					return handled;
+    				return true;
 			    } else {
 			        return false;
 			    }",1
[BACKLOG-16118] Fixed issue with field lengths in text input,"     boolean bEndedLineWrote = false;
     boolean fileExist;
     Object[] r = getRow(); // This also waits for a row to be finished.
-    if ( r != null && meta.getOutputFields().length == 0 ) {
+    if ( r != null ) {
       data.outputRowMeta = getInputRowMeta().clone();
     }
     if ( r != null && first ) {
-      data.outputRowMeta = getInputRowMeta().clone();
       first = false;
       meta.getFields( data.outputRowMeta, getStepname(), null, null, this, repository, metaStore );
 ",1
Fix possible NPE if GitHub repo don't have description,"             public SafeHtml getValue(final ProjectData item) {
                 return new SafeHtmlBuilder()
                         .appendHtmlConstant(""<span>"")
-                        .appendEscaped(item.getDescription() == null ? """" : item.getDescription())
+                        .appendEscaped(item.getDescription())
                         .appendHtmlConstant(""</span>"")
                         .toSafeHtml();
             }",1
Check message length before use.," 			return;
 		}
 
-		if (message.length() <= KILLCOUNT_COMMAND_STRING.length())
-		{
-			return;
-		}
-
 		ChatMessageType type = chatMessage.getType();
 		String search = message.substring(KILLCOUNT_COMMAND_STRING.length() + 1);
 
@@ -488,11 +483,6 @@
 			return;
 		}
 
-		if (message.length() <= PB_COMMAND.length())
-		{
-			return;
-		}
-
 		ChatMessageType type = chatMessage.getType();
 		String search = message.substring(PB_COMMAND.length() + 1);
 
@@ -584,11 +574,6 @@
 			return;
 		}
 
-		if (message.length() <= PRICE_COMMAND_STRING.length())
-		{
-			return;
-		}
-
 		MessageNode messageNode = chatMessage.getMessageNode();
 		String search = message.substring(PRICE_COMMAND_STRING.length() + 1);
 
@@ -652,11 +637,6 @@
 		}
 		else
 		{
-			if (message.length() <= LEVEL_COMMAND_STRING.length())
-			{
-				return;
-			}
-
 			search = message.substring(LEVEL_COMMAND_STRING.length() + 1);
 		}
 ",1
Fixes #3982," import java.io.ObjectOutputStream;
 import java.net.Socket;
 import java.net.SocketException;
-import java.util.*;
+import java.util.Collection;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Map;
 import java.util.Map.Entry;
+import java.util.Set;
+import java.util.UUID;
 
 import com.orientechnologies.common.collection.OMultiValue;
 import com.orientechnologies.common.concur.lock.OLockException;
@@ -1191,15 +1196,6 @@
         if (result == null) {
           // NULL VALUE
           channel.writeByte((byte) 'n');
-        } else if (result instanceof Map) {
-          ODocument doc = new ODocument();
-          for (Map.Entry<?, ?> entry : ((Map<?, ?>) result).entrySet()) {
-            String key = keyFromMapObject(entry.getKey());
-            doc.field(key, entry.getValue());
-          }
-          channel.writeByte((byte) 'r');
-          listener.result(doc);
-          writeIdentifiable(doc);
         } else if (result instanceof OIdentifiable) {
           // RECORD
           channel.writeByte((byte) 'r');
@@ -2142,10 +2138,4 @@
     return true;
   }
 
-  private String keyFromMapObject(Object key) {
-    if (key instanceof String) {
-      return (String) key;
-    }
-    return """" + key;
-  }
 }",1
fix a heap sort bug," 			int nextIndex = findNextValidIndex();
 
 			if (nextIndex == m_size) {
-				if (isBigger(name, m_names[0])) {
+				if (isBigger(m_names[0], name)) {
 					m_names[0] = name;
 					addAdjust();
 				}
@@ -200,9 +200,6 @@
 		public List<Name> getNames() {
 			List<Name> reports = new ArrayList<Name>();
 
-			if (findNextValidIndex() == m_size) {
-				sort();
-			}
 			for (int i = 0; i < m_size; i++) {
 				Name currentNode = m_names[i];
 ",1
bug in format of session kill statement," public class ExasolServerSessionManager implements DBAServerSessionManager<ExasolServerSession> {
 
     public static final String PROP_KILL_QUERY = ""killQuery"";
-    private static final String KILL_APP_CMD = ""kill session %s"";
-    private static final String KILL_STMT_CMD = ""kill statement in session %s"";
+    private static final String KILL_APP_CMD = ""kill session %d"";
+    private static final String KILL_STMT_CMD = ""kill statement in session %d"";
 
     private final ExasolDataSource dataSource;
 ",1
Fixed typo in public interface of SSLInformationAssociationHandler,"      * @param cipherSuite String name of the TLS cipher suite.
      * @return int indicating the effective key entropy bit-length.
      */
-    public static int getKeyLength(String cipherSuite) {
+    public static int getKeyLenght(String cipherSuite) {
         // Roughly ordered from most common to least common.
         if (cipherSuite == null) {
             return 0;
@@ -102,7 +102,7 @@
         SSLSessionInfo ssl = exchange.getConnection().getSslSessionInfo();
         if (ssl != null) {
             request.setAttribute(""javax.servlet.request.cipher_suite"", ssl.getCipherSuite());
-            request.setAttribute(""javax.servlet.request.key_size"", getKeyLength(ssl.getCipherSuite()));
+            request.setAttribute(""javax.servlet.request.key_size"", getKeyLenght(ssl.getCipherSuite()));
             request.setAttribute(""javax.servlet.request.ssl_session_id"", ssl.getSessionId());
             X509Certificate[] certs = getCerts(ssl);
             if (certs != null) {",1
fix(metrics): CapacityMonitor for EventProcessor,"         eventProcessingRegistry.register(""messageTimer"", messageTimerMonitor);
         eventProcessingRegistry.register(""latency"", eventProcessorLatencyMonitor);
         eventProcessingRegistry.register(""messageCounter"", messageCountingMonitor);
-        eventProcessingRegistry.register(""capacity"", capacityMonitor);
         registry.register(eventProcessorName, eventProcessingRegistry);
 
         List<MessageMonitor<? super EventMessage<?>>> monitors = new ArrayList<>();",1
Android bug fixes on how the video progress was being handled.,"     private float mVolume = 1.0f;
     private float mRate = 1.0f;
     private boolean mPlayInBackground = false;
-    private boolean mActiveStatePauseStatus = false;
 
     private int mMainVer = 0;
     private int mPatchVer = 0;
@@ -116,18 +115,16 @@
             @Override
             public void run() {
 
-                if (mMediaPlayerValid && !isCompleted &&!mPaused) {
+                if (mMediaPlayerValid && !isCompleted) {
                     WritableMap event = Arguments.createMap();
                     event.putDouble(EVENT_PROP_CURRENT_TIME, mMediaPlayer.getCurrentPosition() / 1000.0);
                     event.putDouble(EVENT_PROP_PLAYABLE_DURATION, mVideoBufferedDuration / 1000.0); //TODO:mBufferUpdateRunnable
                     mEventEmitter.receiveEvent(getId(), Events.EVENT_PROGRESS.toString(), event);
-
-                    // Check for update after an interval
-                    // TODO: The update interval is fixed at 250. There is a property in React component that defines this value. Totally ignored !!!
+                }
                 mProgressUpdateHandler.postDelayed(mProgressUpdateRunnable, 250);
             }
-            }
         };
+        mProgressUpdateHandler.post(mProgressUpdateRunnable);
     }
 
     @Override
@@ -301,9 +298,6 @@
         } else {
             if (!mMediaPlayer.isPlaying()) {
                 start();
-
-                // Also Start the Progress Update Handler
-                mProgressUpdateHandler.post(mProgressUpdateRunnable);
             }
         }
     }
@@ -505,26 +499,14 @@
 
     @Override
     public void onHostPause() {
+
         if (mMediaPlayer != null && !mPlayInBackground) {
-            mActiveStatePauseStatus = mPaused;
-
-            // Pause the video in background
-            setPausedModifier(true);
+            mMediaPlayer.pause();
         }
     }
 
     @Override
     public void onHostResume() {
-        if (mMediaPlayer != null && !mPlayInBackground) {
-            new Handler().post(new Runnable() {
-                @Override
-                public void run() {
-                    // Restore original state
-                    setPausedModifier(mActiveStatePauseStatus);
-                }
-            });
-
-        }
     }
 
     @Override",1
Fix bug in LazyType," 
     @Override
     public boolean isWildcard() {
-        return getType().isWildcard();
+        return getType().isArray();
     }
 
     @Override",1
"Small refactor, a source code url fix."," 
   private static final int NUMBER_OF_REQUESTS = 1000;
   private static final int N_THREADS = 100;
-  private static final int PORT = 8080;
-
-  private static AtomicInteger allCounter = new AtomicInteger();
-  private static AtomicInteger successCounter = new AtomicInteger();
-  private static AtomicInteger failureCounter = new AtomicInteger();
 
   // Convenience method so you can run it in your IDE
   public static void main(String[] args) throws InterruptedException {
@@ -52,31 +47,25 @@
         router.accept(req);
       });
 
-    server.rxListen(PORT).subscribe(res -> generateRequests());
+    server.rxListen(8080).subscribe(res -> generateRequests());
   }
 
   private void generateRequests() throws InterruptedException {
+    AtomicInteger ok = new AtomicInteger(0);
+    AtomicInteger fail = new AtomicInteger(0);
+
     List<Callable<HttpClient>> tasks = Collections.nCopies(NUMBER_OF_REQUESTS,
       () -> vertx.createHttpClient()
-        .getNow(PORT, ""localhost"", ""/"", resp ->
-          log(resp, successCounter(resp), failureCounter(resp))
+        .getNow(8080, ""localhost"", ""/"", resp ->
+          log(resp, resp.statusCode() == 200 ? ok.incrementAndGet() : ok.get(),
+            resp.statusCode() == 503 ? fail.incrementAndGet() : fail.get())
         ));
     Executors.newFixedThreadPool(N_THREADS).invokeAll(tasks);
+
   }
 
-  private int failureCounter(HttpClientResponse resp) {
-    return resp.statusCode() == 503 ? failureCounter.incrementAndGet() : failureCounter.get();
-  }
-
-  private int successCounter(HttpClientResponse resp) {
-    return resp.statusCode() == 200 ? successCounter.incrementAndGet() : successCounter.get();
-  }
-
-  private void log(HttpClientResponse response, int success, int failure) {
-    System.out.println(String
-      .format(
-        ""Response status code: [%s] , number of all responses [%s], number of correct responses [%s], number of dropped responses [%s]"",
-        response.statusCode(), allCounter.incrementAndGet(), success, failure));
+  private void log(HttpClientResponse response, int ok, int fail) {
+    System.out.println(response.statusCode() + "", ok="" + ok + "", fail="" + fail);
   }
 
 }",1
Remove duplicate coordinate clue," 		.put(new WorldPoint(2934, 2727, 0), ""Eastern shore of Crash Island."")
 		.put(new WorldPoint(1451, 3695, 0), ""West side of Lizardman Canyon with Lizardman shaman."")
 		.put(new WorldPoint(2538, 3739, 0), ""Waterbirth Island."")
+		.put(new WorldPoint(1248, 3751, 0), ""Farming Guild."")
 		.put(new WorldPoint(1698, 3792, 0), ""Arceuus church."")
 		.put(new WorldPoint(2951, 3820, 0), ""Wilderness. Chaos Temple (level 38)."")
 		.put(new WorldPoint(2202, 3825, 0), ""Pirates' Cove, between Lunar Isle and Rellekka."")",1
Update H2Schema to work with DATABASE_TO_UPPER=false," 
     @Override
     protected boolean doExists() throws SQLException {
-        return jdbcTemplate.queryForInt(""SELECT COUNT(*) FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME=?"", name) > 0;
+        return jdbcTemplate.queryForInt(""SELECT COUNT(*) FROM INFORMATION_SCHEMA.schemata WHERE schema_name=?"", name) > 0;
     }
 
     @Override
@@ -156,7 +156,7 @@
      */
     private List<String> listObjectNames(String objectType, String querySuffix) throws SQLException {
         String query = ""SELECT "" + objectType + ""_NAME FROM INFORMATION_SCHEMA."" + objectType
-                + ""S WHERE "" + objectType + ""_SCHEMA = ?"";
+                + ""S WHERE "" + objectType + ""_schema = ?"";
         if (StringUtils.hasLength(querySuffix)) {
             query += "" AND "" + querySuffix;
         }",1
Backport fix for discovery profile endpoint," 
 import lombok.val;
 import org.springframework.boot.actuate.endpoint.annotation.Endpoint;
+import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;
 import org.springframework.web.bind.annotation.GetMapping;
 import org.springframework.web.bind.annotation.ResponseBody;
 
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
 import java.util.HashMap;
 import java.util.Map;
 
@@ -43,11 +46,14 @@
     /**
      * Discovery.
      *
+     * @param request  the request
+     * @param response the response
      * @return the map
      */
     @GetMapping
     @ResponseBody
-    public Map<String, Object> discovery() {
+    @ReadOperation
+    public Map<String, Object> discovery(final HttpServletRequest request, final HttpServletResponse response) {
         val results = new HashMap<String, Object>();
         results.put(""profile"", casServerProfileRegistrar.getProfile());
         return results;",1
"[Selenium] Fix of unexpected fail of "" RollingUpdateStrategyWithWorkspacesStartStopTest"" selenium test"," import static org.eclipse.che.selenium.core.constant.TestTimeoutsConstants.LOAD_PAGE_TIMEOUT_SEC;
 import static org.eclipse.che.selenium.core.constant.TestTimeoutsConstants.PREPARING_WS_TIMEOUT_SEC;
 import static org.eclipse.che.selenium.core.constant.TestTimeoutsConstants.REDRAW_UI_ELEMENTS_TIMEOUT_SEC;
-import static org.eclipse.che.selenium.pageobject.dashboard.workspaces.Workspaces.Locators.PROGRESS_BAR_XPATH;
 import static org.eclipse.che.selenium.pageobject.dashboard.workspaces.Workspaces.Locators.WORKSPACE_ITEM_RAM;
 import static org.eclipse.che.selenium.pageobject.dashboard.workspaces.Workspaces.Locators.WORKSPACE_ITEM_STOP_START_WORKSPACE_BUTTON;
 import static org.openqa.selenium.support.ui.ExpectedConditions.*;
@@ -91,7 +90,6 @@
     String WORKSPACE_LIST_HEADER = ""//md-item[@class='noselect']//span"";
     String WORKSPACE_LIST_ITEM =
         ""(//div[@class='workspace-name-clip']/parent::div/parent::div/parent::div)[%s]"";
-    String PROGRESS_BAR_XPATH = ""(//md-progress-linear[@role='progressbar'])[2]"";
   }
 
   public interface Status {
@@ -113,10 +111,6 @@
   @FindBy(xpath = Locators.SEARCH_WORKSPACE_FIELD)
   WebElement searchWorkspaceField;
 
-  public void waitProgressBarInvisibility() {
-    seleniumWebDriverHelper.waitInvisibility(By.xpath(PROGRESS_BAR_XPATH));
-  }
-
   public String getWorkspaceStatus(String workspaceName) {
     return new WebDriverWait(seleniumWebDriver, REDRAW_UI_ELEMENTS_TIMEOUT_SEC)
         .until(
@@ -302,8 +296,6 @@
     waitWorkspaceActionTooltipDisappearance();
 
     seleniumWebDriverHelper.waitAndClick(By.xpath(buttonXpath));
-
-    waitProgressBarInvisibility();
   }
 
   public void waitWorkspaceActionTooltipDisappearance() {",1
Fix ArrayDeque.clone on andriod-8,"         try {
             @SuppressWarnings(""unchecked"")
             ArrayDeque<E> result = (ArrayDeque<E>) super.clone();
-            System.arraycopy(elements, 0, result.elements, 0, elements.length);
+            result.elements = Arrays.copyOf(elements, elements.length);
             return result;
 
         } catch (CloneNotSupportedException e) {",1
Don't cull generated item models with non-default GUI transform,"         this.particle = particle;
         this.transforms = transforms;
         this.overrides = overrides;
-        this.guiModel = hasGuiIdentity(transforms) ? new BakedGuiItemModel<>(this) : null;
-    }
-
-    private static boolean hasGuiIdentity(ImmutableMap<TransformType, TRSRTransformation> transforms)
-    {
-        TRSRTransformation guiTransform = transforms.get(TransformType.GUI);
-        return guiTransform == null || guiTransform.equals(TRSRTransformation.identity());
+        this.guiModel = new BakedGuiItemModel<>(this);
     }
 
     @Override public boolean isAmbientOcclusion() { return true; }
@@ -77,7 +71,7 @@
     @Override
     public Pair<? extends IBakedModel, Matrix4f> handlePerspective(TransformType type)
     {
-        if (type == TransformType.GUI && this.guiModel != null)
+        if (type == TransformType.GUI)
         {
             return this.guiModel.handlePerspective(type);
         }",1
CHE-2020: Fix passing project name on project creation from wizard,"             public Promise<Project> apply(Optional<Resource> resource) throws FunctionException {
 
                 final ProjectConfigDto dto = dtoFactory.createDto(ProjectConfigDto.class)
-                                                       .withName(createRequest.getBody().getName())
                                                        .withPath(path.toString())
                                                        .withDescription(createRequest.getBody().getDescription())
                                                        .withType(createRequest.getBody().getType())",1
Javadocs fixes in JsonToken,"     START_OBJECT(""{""),
         
     /**
-     * END_OBJECT is returned when encountering '}'
+     * START_OBJECT is returned when encountering '}'
      * which signals ending of an Object value
      */
     END_OBJECT(""}""),
         
     /**
-     * START_ARRAY is returned when encountering '['
+     * START_OBJECT is returned when encountering '['
      * which signals starting of an Array value
      */
     START_ARRAY(""[""),
 
     /**
-     * END_ARRAY is returned when encountering ']'
+     * START_OBJECT is returned when encountering ']'
      * which signals ending of an Array value
      */
     END_ARRAY(""]""),",1
[FIXED JENKINS-37321] Source class details from uberclassloader," import io.jenkins.blueocean.rest.model.BlueExtensionClass;
 import io.jenkins.blueocean.rest.model.BlueExtensionClassContainer;
 import io.jenkins.blueocean.rest.model.BlueExtensionClassMap;
-import jenkins.model.Jenkins;
 import org.kohsuke.stapler.QueryParameter;
 
 import java.util.Collections;
@@ -68,7 +67,7 @@
 
     private Class getClazz(String name){
         try {
-            return Jenkins.getInstance().getPluginManager().uberClassLoader.loadClass(name);
+            return this.getClass().getClassLoader().loadClass(name);
         } catch (ClassNotFoundException e) {
             throw new ServiceException.NotFoundException(String.format(""Class %s is not known"", name));
         }",1
"Fix for #4069, take into account a replicated record isnt necessarily an ODocument","         if (task instanceof OAbstractRecordReplicatedTask) {
           final ORecord record = ((OAbstractRecordReplicatedTask) task).getRecord();
 
-          if (record instanceof ODocument)
+          if (record != null)
             for (String f : ((ODocument) record).fieldNames()) {
               final Object fValue = ((ODocument) record).field(f);
               if (fValue instanceof ORecordLazyMultiValue)",1
Fix warning,"       MappedStatement ms = null;
       if (configuration.hasStatement(statementName)) {
         ms = configuration.getMappedStatement(statementName);
-      } else if (!mapperInterface.equals(method.getDeclaringClass())) { // issue #35
+      } else if (!mapperInterface.equals(method.getDeclaringClass().getName())) { // issue #35
         String parentStatementName = method.getDeclaringClass().getName() + ""."" + method.getName();
         if (configuration.hasStatement(parentStatementName)) {
           ms = configuration.getMappedStatement(parentStatementName);",1
Fix partitioning when writing sampled table," import com.google.common.collect.ImmutableMap;
 import com.google.common.collect.ImmutableSet;
 
-import java.util.ArrayList;
 import java.util.List;
 import java.util.Map;
 import java.util.Optional;
@@ -203,28 +202,15 @@
         });
 
         List<Symbol> symbols = plan.getOutputSymbols();
-
-        Optional<PartitionFunctionBinding> partitionFunctionBinding = Optional.empty();
-        if (writeTableLayout.isPresent()) {
-            List<PartitionFunctionArgumentBinding> partitionFunctionArguments = new ArrayList<>();
-            writeTableLayout.get().getPartitionColumns().stream()
+        Optional<PartitionFunctionBinding> partitionFunctionBinding = writeTableLayout.map(layout -> new PartitionFunctionBinding(
+                layout.getPartitioning(),
+                symbols,
+                layout.getPartitionColumns().stream()
                         .mapToInt(columnNames::indexOf)
                         .mapToObj(symbols::get)
                         .map(PartitionFunctionArgumentBinding::new)
-                    .forEach(partitionFunctionArguments::add);
-            plan.getSampleWeight()
-                    .map(PartitionFunctionArgumentBinding::new)
-                    .ifPresent(partitionFunctionArguments::add);
-
-            List<Symbol> outputLayout = new ArrayList<>(symbols);
-            plan.getSampleWeight()
-                    .ifPresent(outputLayout::add);
-
-            partitionFunctionBinding = Optional.of(new PartitionFunctionBinding(
-                    writeTableLayout.get().getPartitioning(),
-                    outputLayout,
-                    partitionFunctionArguments));
-        }
+                        .collect(toImmutableList()),
+                Optional.empty()));
 
         PlanNode writerNode = new TableWriterNode(
                 idAllocator.getNextId(),",1
fix VerificationWithTimout javadoc comment,"  * <pre class=""code""><code class=""java"">
  * verify(mock, timeout(100).times(5)).foo();
  *
+ * verify(mock, timeout(100).never()).bar();
+ *
  * verify(mock, timeout(200).atLeastOnce()).baz();
  * </code></pre>
  *",1
Fixes #879: ArgumentMatchers javadoc grammar improvement,"  * <p>
  * Matcher methods like <code>anyObject()</code>, <code>eq()</code> <b>do not</b> return matchers.
  * Internally, they record a matcher on a stack and return a dummy value (usually null).
- * This implementation is due to static type safety imposed by java compiler.
+ * This implementation is due static type safety imposed by java compiler.
  * The consequence is that you cannot use <code>anyObject()</code>, <code>eq()</code> methods outside of verified/stubbed method.
  * </p>
  *",1
Fix for high latency of multipart requests," import java.io.InputStream;
 import java.io.RandomAccessFile;
 import java.nio.ByteBuffer;
-import java.nio.channels.*;
+import java.nio.channels.FileChannel;
+import java.nio.channels.WritableByteChannel;
 import java.util.ArrayList;
 import java.util.List;
-import java.util.Set;
 
 public class MultipartBody implements RandomAccessBody {
 
@@ -569,30 +569,6 @@
         int maxSpin = 0;
         synchronized (byteWriter) {
             ByteBuffer message = ByteBuffer.wrap(byteWriter.toByteArray());
-
-            if (target instanceof SocketChannel) {
-		final Selector selector =  Selector.open();
-		try {
-			final SocketChannel channel = (SocketChannel) target;
-			channel.register(selector, SelectionKey.OP_WRITE);
-
-			while(written < byteWriter.size() && selector.select() != 0) {
-				final Set<SelectionKey> selectedKeys = selector.selectedKeys();
-
-				for (SelectionKey key : selectedKeys) {
-					if (key.isWritable()) {
-						written += target.write(message);  					
-					}
-				}
-			}
-
-			if (written < byteWriter.size()) {
-				throw new IOException(""Unable to write on channel "" + target);
-			}
-	            } finally {
-			selector.close();
-	            }
-            } else {
             while ((target.isOpen()) && (written < byteWriter.size())) {
                 long nWrite = target.write(message);
                 written += nWrite;
@@ -611,7 +587,6 @@
                 }
             }
         }
-        }
         return written;
     }
 ",1
Fix node indexes," 					GrammarToken newTok = new GrammarToken(g, elWithOpt.getToken());
 					newTok.originalTokenIndex = Integer.valueOf(options.get(LeftRecursiveRuleTransformer.TOKENINDEX_OPTION_NAME).getText());
 					elWithOpt.token = newTok;
-
-					GrammarAST originalNode = g.ast.getNodeWithTokenIndex(newTok.getTokenIndex());
-					if (originalNode != null) {
-						// update the AST node start/stop index to match the values
-						// of the corresponding node in the original parse tree.
-						elWithOpt.setTokenStartIndex(originalNode.getTokenStartIndex());
-						elWithOpt.setTokenStopIndex(originalNode.getTokenStopIndex());
-					}
-					else {
-						// the original AST node could not be located by index;
-						// make sure to assign valid values for the start/stop
-						// index so toTokenString will not throw exceptions.
-						elWithOpt.setTokenStartIndex(newTok.getTokenIndex());
-						elWithOpt.setTokenStopIndex(newTok.getTokenIndex());
-					}
 				}
 			}
 		}",1
Enable Copy URLs pop up menu item for all messages,"     }
 
     @Override
-    protected boolean isButtonEnabledForHistoryReference(HistoryReference historyReference) {
-        return true;
-    }
-
-    @Override
     public boolean isSafe() {
     	return true;
     }",1
Fixes #658," import java.nio.FloatBuffer;
 import java.nio.IntBuffer;
 import java.nio.ShortBuffer;
-import java.util.Arrays;
 
 import rajawali.animation.mesh.VertexAnimationObject3D;
 import rajawali.bounds.BoundingBox;
 import rajawali.bounds.BoundingSphere;
-import rajawali.math.Number3D;
 import rajawali.renderer.RajawaliRenderer;
 import rajawali.util.RajLog;
 import android.graphics.Color;
@@ -145,84 +143,6 @@
 	}
 	
 	/**
-	 * Concatenates a list of float arrays into a single array.
-	 * 
-	 * @param arrays The arrays.
-	 * @return The concatenated array.
-	 * 
-	 * @see {@link http://stackoverflow.com/questions/80476/how-to-concatenate-two-arrays-in-java}
-	 */
-	public static float[] concatAllFloat(float[] ... arrays) {
-		int totalLength = 0;
-		final int subArrayCount = arrays.length;
-		for (int i = 0; i < subArrayCount; ++i) {
-			totalLength += arrays[i].length;
-		}
-		float[] result = Arrays.copyOf(arrays[0], totalLength);
-		int offset = arrays[0].length;
-		for (int i = 1; i < subArrayCount; ++i) {
-			System.arraycopy(arrays[i], 0, result, offset, arrays[i].length);
-			offset += arrays[i].length;
-		}
-		return result;
-	}
-	
-	/**
-	 * Concatenates a list of int arrays into a single array.
-	 * 
-	 * @param arrays The arrays.
-	 * @return The concatenated array.
-	 * 
-	 * @see {@link http://stackoverflow.com/questions/80476/how-to-concatenate-two-arrays-in-java}
-	 */
-	public static int[] concatAllInt(int[] ... arrays) {
-		int totalLength = 0;
-		final int subArrayCount = arrays.length;
-		for (int i = 0; i < subArrayCount; ++i) {
-			totalLength += arrays[i].length;
-		}
-		int[] result = Arrays.copyOf(arrays[0], totalLength);
-		int offset = arrays[0].length;
-		for (int i = 1; i < subArrayCount; ++i) {
-			System.arraycopy(arrays[i], 0, result, offset, arrays[i].length);
-			offset += arrays[i].length;
-		}
-		return result;
-	}
-	
-	public static float[] getFloatArrayFromBuffer(FloatBuffer buffer) {
-		float[] array = null;
-		if (buffer.hasArray()) {
-			array = buffer.array();
-		} else {
-			buffer.rewind();
-			array = new float[buffer.capacity()];
-			buffer.get(array);		
-		}
-		return array;
-	}
-	
-	public static int[] getIntArrayFromBuffer(Buffer buffer) {
-		int[] array = null;
-		if (buffer.hasArray()) {
-			array = (int[]) buffer.array();
-		} else {
-			buffer.rewind();
-			array = new int[buffer.capacity()];
-			if (buffer instanceof IntBuffer) {
-				((IntBuffer) buffer).get(array);
-			} else if (buffer instanceof ShortBuffer) {
-				int count = 0;
-				while (buffer.hasRemaining()) {
-					array[count] = (int) (((ShortBuffer) buffer).get());
-					++count;
-				}
-			}
-		}
-		return array;
-	}
-	
-	/**
 	 * Copies another Geometry3D's BufferInfo objects. This means that it
 	 * doesn't copy or clone the actual data. It will just use the pointers
 	 * to the other Geometry3D's buffers.
@@ -241,89 +161,6 @@
 	}
 	
 	/**
-	 * Adds the geometry from the incoming geometry with the specified offset.
-	 * Note that the offset is only applied to the vertex positions.
-	 * 
-	 * @param offset {@link Number3D} containing the offset in each direction. Can be null.
-	 * @param geometry {@link Geometry3D} to be added.
-	 */
-	public void addFromGeometry3D(Number3D offset, Geometry3D geometry) {
-		float[] newVertices = null;
-		float[] newNormals = null;
-		float[] newColors = null;
-		float[] newTextureCoords = null;
-		int[] newIntIndices = null;
-		float[] mVerticesArray = null;
-		float[] mNormalsArray = null;
-		float[] mColorsArray = null;
-		float[] mTextureCoordsArray = null;
-		int[] mIndicesArray = null;
-
-		//Get the old data
-		mVerticesArray = getFloatArrayFromBuffer(mVertices);
-		mNormalsArray = getFloatArrayFromBuffer(mNormals);
-		mColorsArray = getFloatArrayFromBuffer(mColors);
-		mTextureCoordsArray = getFloatArrayFromBuffer(mTextureCoords);
-		if (!mOnlyShortBufferSupported) {
-			mIndicesArray = getIntArrayFromBuffer(mIndicesInt);
-		} else {
-        	mIndicesArray = getIntArrayFromBuffer(mIndicesShort);
-        }
-		
-		//Get the new data, offset the vertices
-		int axis = 0;
-		float[] addVertices = getFloatArrayFromBuffer(geometry.getVertices());
-		if (offset != null) {
-			for (int i = 0, j = addVertices.length; i < j; ++i) {
-				switch (axis) {
-				case 0:
-					addVertices[i] += offset.x;
-					break;
-				case 1:
-					addVertices[i] += offset.y;
-					break;
-				case 2:
-					addVertices[i] += offset.z;
-					break;
-				}
-				++axis;
-				if (axis > 2)
-					axis = 0;
-			}
-		}
-		float[] addNormals = getFloatArrayFromBuffer(geometry.getNormals());
-		float[] addColors = getFloatArrayFromBuffer(geometry.getColors());
-		float[] addTextureCoords = getFloatArrayFromBuffer(geometry.getTextureCoords());
-		int[] addIndices = getIntArrayFromBuffer(geometry.getIndices());
-		int index_offset = (mVerticesArray.length/3);
-		for (int i = 0, j = addIndices.length; i < j; ++i) {
-			addIndices[i] += index_offset;
-		}
-		
-		//Concatenate the old and new data
-		newVertices = concatAllFloat(mVerticesArray, addVertices);
-		newNormals = concatAllFloat(mNormalsArray, addNormals);
-		newColors = concatAllFloat(mColorsArray, addColors);
-		newTextureCoords = concatAllFloat(mTextureCoordsArray, addTextureCoords);
-		newIntIndices = concatAllInt(mIndicesArray, (int[]) addIndices);
-		
-		//Set the new data
-		setVertices(newVertices, true);
-		mNormals = null;
-		setNormals(newNormals);
-		mTextureCoords = null;
-		setTextureCoords(newTextureCoords);
-		mColors = null;
-		setColors(newColors);
-		mIndicesInt = null;
-		mIndicesShort = null;
-		setIndices(newIntIndices);
-
-		//Create the new buffers
-		createBuffers();
-	}
-	
-	/**
 	 * Sets the data. This methods takes two BufferInfo objects which means it'll use another
 	 * Geometry3D instance's data (vertices and normals). The remaining parameters are arrays
 	 * which will be used to create buffers that are unique to this instance.",1
ORC union type is not supported and should throw,"                 return new StructStreamReader(streamDescriptor, hiveStorageTimeZone);
             case MAP:
                 return new MapStreamReader(streamDescriptor, hiveStorageTimeZone);
+            case UNION:
             case DECIMAL:
                 return new DecimalStreamReader(streamDescriptor);
-            case UNION:
             default:
                 throw new IllegalArgumentException(""Unsupported type: "" + streamDescriptor.getStreamType());
         }",1
Fixed directive introspection,"                     .type(GraphQLString))
             .field(newFieldDefinition()
                     .name(""locations"")
-                    .type(new GraphQLList(new GraphQLNonNull(__DirectiveLocation)))
-                    .dataFetcher(new DataFetcher() {
-                        @Override
-                        public Object get(DataFetchingEnvironment environment) {
-                            GraphQLDirective directive = (GraphQLDirective) environment.getSource();
-                            return new ArrayList<DirectiveLocation>(directive.validLocations());
-                        }
-                    }))
+                    .type(new GraphQLList(new GraphQLNonNull(__DirectiveLocation))))
             .field(newFieldDefinition()
                     .name(""args"")
                     .type(new GraphQLNonNull(new GraphQLList(new GraphQLNonNull(__InputValue))))
@@ -339,39 +332,15 @@
             .field(newFieldDefinition()
                     .name(""onOperation"")
                     .type(GraphQLBoolean)
-                    .deprecate(""Use `locations`."")
-                    .dataFetcher(new DataFetcher() {
-                        @Override
-                        public Object get(DataFetchingEnvironment environment) {
-                            GraphQLDirective directive = (GraphQLDirective) environment.getSource();
-                            return directive.isOnOperation();
-                        }
-                    }))
+                    .deprecate(""Use `locations`.""))
             .field(newFieldDefinition()
                     .name(""onFragment"")
                     .type(GraphQLBoolean)
-                    .deprecate(""Use `locations`."")
-                    .dataFetcher(new DataFetcher() {
-                        @Override
-                        public Object get(DataFetchingEnvironment environment) {
-                            GraphQLDirective directive = (GraphQLDirective) environment.getSource();
-                            return directive.isOnFragment() ||
-                                    (directive.validLocations().contains(DirectiveLocation.INLINE_FRAGMENT)
-                                    && directive.validLocations().contains(DirectiveLocation.FRAGMENT_SPREAD));
-                        }
-                    }))
+                    .deprecate(""Use `locations`.""))
             .field(newFieldDefinition()
                     .name(""onField"")
                     .type(GraphQLBoolean)
-                    .deprecate(""Use `locations`."")
-                    .dataFetcher(new DataFetcher() {
-                        @Override
-                        public Object get(DataFetchingEnvironment environment) {
-                            GraphQLDirective directive = (GraphQLDirective) environment.getSource();
-                            return directive.isOnField() ||
-                                    directive.validLocations().contains(DirectiveLocation.FIELD);
-                        }
-                    }))
+                    .deprecate(""Use `locations`.""))
             .build();
 
     public static GraphQLObjectType __Schema = newObject()",1
Fixed wrong method call in ChunkIOProvider.,"     public void callStage2(QueuedChunk queuedChunk, net.minecraft.world.chunk.Chunk chunk) throws RuntimeException {
         if(chunk == null) {
             // If the chunk loading failed just do it synchronously (may generate)
-            queuedChunk.provider.originalLoadChunk(queuedChunk.x, queuedChunk.z);
+            queuedChunk.provider.loadChunk(queuedChunk.x, queuedChunk.z);
             return;
         }
 ",1
[BACKLOG-14903] Transmeta already loaded from repo fix,"   private Trans createTrans( TransMeta transMeta ) throws KettleException {
     if ( Utils.isEmpty( transMeta.getVariable( ""engine"" ) ) ) {
       log.logBasic( ""Using legacy execution engine"" );
-      return new Trans( transMeta );
+      return createLegacyTrans( transMeta );
     }
 
     return PluginRegistry.getInstance().getPlugins( EnginePluginType.class ).stream()
@@ -1675,6 +1675,16 @@
       .isPresent();
   }
 
+  private Trans createLegacyTrans( TransMeta transMeta ) {
+    try {
+      return new Trans( transMeta, rep, transMeta.getName(),
+        transMeta.getRepositoryDirectory().getPath(),
+        transMeta.getFilename() );
+    } catch ( KettleException e ) {
+      throw new RuntimeException( e );
+    }
+  }
+
   private Object loadPlugin( PluginInterface plugin ) {
     try {
       return PluginRegistry.getInstance().loadClass( plugin );",1
Fix WebSocketClient.getRemoteSocketAddress," 	@Override
 	public InetSocketAddress getRemoteSocketAddress( WebSocket conn ) {
 		if( socket != null )
-			return (InetSocketAddress) socket.getRemoteSocketAddress();
+			return (InetSocketAddress) socket.getLocalSocketAddress();
 		return null;
 	}
 ",1
Fix url regex," 
     static final Pattern URL_PATTERN = Pattern.compile(
             //         schema                          ipv4            OR           namespace                 port     path         ends
-            //   |-----------------|        |-------------------------|  |-------------------------|    |---------| |--|   |---------------|
-            ""((?:[a-z0-9]{2,}:\\/\\/)?(?:(?:[0-9]{1,3}\\.){3}[0-9]{1,3}|(?:[-\\w_]{1,}\\.[a-z]{2,}?))(?::[0-9]{1,5})?.*?(?=[!\""\u00A7 \n]|$))"",
+            //   |-----------------|        |-------------------------|  |----------------------------|    |---------| |--|   |---------------|
+            ""((?:[a-z0-9]{2,}:\\/\\/)?(?:(?:[0-9]{1,3}\\.){3}[0-9]{1,3}|(?:[-\\w_\\.]{1,}\\.[a-z]{2,}?))(?::[0-9]{1,5})?.*?(?=[!\""\u00A7 \n]|$))"",
             Pattern.CASE_INSENSITIVE);
 
     public static ITextComponent newChatWithLinks(String string){ return newChatWithLinks(string, true); }",1
JERSEY-2865: Fixed BufferOverflowException in SSE,"                     boolean shouldClose;
                     T t;
 
-                    synchronized (ChunkedOutput.this) {
+                    synchronized (this) {
                         if (flushing) {
                             // if another thread is already flushing the queue, we don't have to do anything
                             return null;
@@ -254,7 +254,7 @@
                         }
                         t = queue.poll();
                         if (t == null) {
-                            synchronized (ChunkedOutput.this) {
+                            synchronized (this) {
                                 // queue seems empty
                                 // check again in the synchronized block before clearing the flushing flag
                                 // first remember the closed flag (this has to be before polling the queue,",1
Fix multitenant mail server configuration," 
         email.setSmtpPort(mailServerInfo.getMailServerPort());
 
-        email.setSSLOnConnect(mailServerInfo.isMailServerUseSSL());
-        email.setStartTLSEnabled(mailServerInfo.isMailServerUseTLS());
+        email.setSSLOnConnect(processEngineConfiguration.getMailServerUseSSL());
+        email.setStartTLSEnabled(processEngineConfiguration.getMailServerUseTLS());
 
         String user = mailServerInfo.getMailServerUsername();
         String password = mailServerInfo.getMailServerPassword();",1
PhantomJSDriverService replaced by DriverService in PhantomJSDriver constructor," import org.openqa.selenium.remote.DriverCommand;
 import org.openqa.selenium.remote.RemoteWebDriver;
 import org.openqa.selenium.remote.service.DriverCommandExecutor;
-import org.openqa.selenium.remote.service.DriverService;
 
 /**
  * A {@link org.openqa.selenium.WebDriver} implementation that controls a PhantomJS running in Remote WebDriver mode.
@@ -92,7 +91,7 @@
      * @param service             The service to use.
      * @param desiredCapabilities The capabilities required from PhantomJS/GhostDriver.
      */
-    public PhantomJSDriver(DriverService service, Capabilities desiredCapabilities) {
+    public PhantomJSDriver(PhantomJSDriverService service, Capabilities desiredCapabilities) {
         super(new DriverCommandExecutor(service), desiredCapabilities);
     }
 ",1
AXON-368 fix in 2.4.x branch,"     public MetaData deserialize(JsonParser jp, DeserializationContext ctxt)
             throws IOException {
         JsonDeserializer<Object> deserializer = ctxt.findRootValueDeserializer(
-                ctxt.getTypeFactory().constructMapType(Map.class, String.class, Object.class));
+                ctxt.getTypeFactory().constructMapType(Map.class, String.class, String.class));
 
         return MetaData.from((Map) deserializer.deserialize(jp, ctxt));
     }",1
fix issue Possible memory leak #219," 
         context.registerReceiver(receiver, filter);
 
-        Disposable disposable = unsubscribeInUiThread(new Action() {
+        unsubscribeInUiThread(new Action() {
           @Override public void run() {
             tryToUnregisterReceiver(context, receiver);
           }
         });
-        emitter.setDisposable(disposable);
       }
     }).defaultIfEmpty(Connectivity.create());
   }",1
修复分表模式下检查分片导致无法分表bug," import io.mycat.config.model.rule.RuleAlgorithm;
 
 import java.io.Serializable;
-import java.util.List;
 
 /**
  * 路由分片函数抽象类
@@ -72,22 +71,12 @@
 		int nPartition = getPartitionNum();
 		if(nPartition > 0) { // 对于有限制分区数的规则,进行检查
 			int dnSize = tableConf.getDataNodes().size();
-			boolean  distTable = tableConf.isDistTable();
-			List tables = tableConf.getDistTables();
-			if(distTable){
-				if(tables.size() < nPartition){
-					return  -1;
-				} else if(dnSize > nPartition) {
-					return 1;
-				}
-			}else{
 			if(dnSize < nPartition) {
 				return  -1;
 			} else if(dnSize > nPartition) {
 				return 1;
 			}
 		}
-		}
 		return 0;
 	}
 	",1
Fix Fake ID exploit," 
             for (Signature signature : packageInfo.signatures) {
                 String hashedSignature = Utility.sha1hash(signature.toByteArray());
-                if (!validAppSignatureHashes.contains(hashedSignature)) {
-                    return false;
+                if (validAppSignatureHashes.contains(hashedSignature)) {
+                    return true;
                 }
             }
 
-            return true;
+            return false;
         }
 
         public TreeSet<Integer> getAvailableVersions() {",1
Fixed nullpointer exception in case of missing bootloader.path param,"     // this wait a moment for the bootloader to enumerate. On Windows, also must
     // deal with the fact that the COM port number changes from bootloader to
     // sketch.
-    if (boardPreferences.get(""bootloader.path"") != null && boardPreferences.get(""bootloader.path"").equals(""caterina"")) {
+    if (boardPreferences.get(""bootloader.path"").equals(""caterina"")) {
       String caterinaUploadPort = null;
       try {
         // Toggle 1200 bps on selected serial port to force board reset.
@@ -178,7 +178,7 @@
 	// port reconnects (or timeout after a few seconds if the sketch port never comes back).
 	// Doing this saves users from accidentally opening Serial Monitor on the soon-to-be-orphaned
 	// bootloader port.
-    if (true == avrdudeResult && boardPreferences.get(""bootloader.path"") != null && boardPreferences.get(""bootloader.path"").equals(""caterina"")) {
+    if (true == avrdudeResult && boardPreferences.get(""bootloader.path"").equals(""caterina"")) {
     	try {
     		Thread.sleep(500);
     	} catch (InterruptedException ex) { } ",1
Memory Leak Fix," 	 * Finalizes the solo object.
 	 *
 	 */  
-        @Override
+
 	public void finalize() throws Throwable {
-		activitySyncTimer.cancel();
 		try {
 			// Remove the monitor added during startup
 			if (activityMonitor != null) {
 				inst.removeMonitor(activityMonitor);
-				activityMonitor = null;
 			}
 		} catch (Exception ignored) {}
-		this.activity = null;
 		super.finalize();
 	}
 	",1
Serialized @Background task cancellation bugfix," import java.util.concurrent.Future;
 import java.util.concurrent.ScheduledExecutorService;
 import java.util.concurrent.TimeUnit;
-import java.util.concurrent.atomic.AtomicBoolean;
 
 import android.util.Log;
 
@@ -198,21 +197,11 @@
 		for (int i = tasks.size() - 1; i >= 0; i--) {
 			Task task = tasks.get(i);
 			if (id.equals(task.id)) {
+				tasks.remove(i);
 				if (task.future != null) {
 					task.future.cancel(mayInterruptIfRunning);
-					if (!task.managed.getAndSet(true)) {
-						/*
-						 * the task has been submitted to the executor, but its
-						 * execution has not started yet, so that its run()
-						 * method will never call postExecute()
-						 */
-						task.postExecute();
-					}
 				} else if (task.executionAsked) {
 					Log.w(TAG, ""A task with id "" + task.id + "" cannot be cancelled (the executor set does not support it)"");
-				} else {
-					/* this task has not been submitted to the executor */
-					tasks.remove(i);
 				}
 			}
 		}
@@ -263,20 +252,6 @@
 		private boolean executionAsked;
 		private Future<?> future;
 
-		/*
-		 * A task can be cancelled after it has been submitted to the executor
-		 * but before its run() method is called. In that case, run() will never
-		 * be called, hence neither will postExecute(): the tasks with the same
-		 * serial identifier (if any) will never be submitted.
-		 * 
-		 * Therefore, cancelAll() *must* call postExecute() if run() is not
-		 * started.
-		 * 
-		 * This flag guarantees that either cancelAll() or run() manages this
-		 * task post execution, but not both.
-		 */
-		private AtomicBoolean managed = new AtomicBoolean();
-
 		public Task(String id, int delay, String serial) {
 			if (!"""".equals(id)) {
 				this.id = id;
@@ -292,11 +267,6 @@
 
 		@Override
 		public void run() {
-			if (managed.getAndSet(true)) {
-				/* cancelled and postExecute() already called */
-				return;
-			}
-
 			try {
 				execute();
 			} finally {",1
"Revert ""[SP-4947] - Fixed missing error message in Abort step""","  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2018 by Hitachi Vantara : http://www.pentaho.com
+ * Copyright (C) 2002-2019 by Hitachi Vantara : http://www.pentaho.com
  *
  *******************************************************************************
  *
@@ -859,7 +859,7 @@
         buffer.append( getString( row, i ) );
         buffer.append( ""]"" );
       }
-      return buffer.toString();
+      return buffer.toString().equals( """" ) ? ""No data in row"" : buffer.toString();
     } finally {
       lock.readLock().unlock();
     }",1
Fix warning,"                 if (property == ObservableProperty.TYPE) {
                     VariableDeclarator vd = VariableDeclarator.this;
                     if (vd.getParentNode().isPresent() && vd.getParentNode().get() instanceof NodeWithVariables) {
-                        NodeWithVariables<?> nodeWithVariables = (NodeWithVariables<?>) vd.getParentNode().get();
+                        NodeWithVariables nodeWithVariables = (NodeWithVariables) vd.getParentNode().get();
                         // We calculate the value the property will assume after the change will be completed
                         Optional<Type> currentMaxCommonType = nodeWithVariables.getMaximumCommonType();
                         List<Type> types = new LinkedList<>();",1
CHE-4514: restore Commands Explorer active state," import org.eclipse.che.ide.command.CommandUtils;
 import org.eclipse.che.ide.command.node.NodeFactory;
 import org.eclipse.che.ide.command.type.chooser.CommandTypeChooser;
-import org.eclipse.che.providers.DynaObject;
 import org.vectomatic.dom.svg.ui.SVGResource;
 
 import java.util.ArrayList;
@@ -59,7 +58,6 @@
 import static org.eclipse.che.ide.api.parts.PartStackType.NAVIGATION;
 
 /** Presenter for Commands Explorer. */
-@DynaObject
 @Singleton
 public class CommandsExplorerPresenter extends BasePresenter implements CommandsExplorerView.ActionDelegate,
                                                                         WsAgentComponent {",1
Player can't create a game with special name from the player," 
         WidgetUtil.trySubscribe(this, ""play"", button -> {
             if (gameName.getText().isEmpty()) {
+                getManager().pushScreen(MessagePopup.ASSET_URI, MessagePopup.class).setMessage(""Error"", ""Game name cannot be empty"");
+            } else {
                 universeWrapper.setGameName(GameProvider.getNextGameName());
-            }
-            universeWrapper.setGameName(gameName.getText());
                 GameManifest gameManifest = GameManifestProvider.createGameManifest(universeWrapper, moduleManager, config);
                 if (gameManifest != null) {
                     gameEngine.changeState(new StateLoading(gameManifest, (isLoadingAsServer()) ? NetworkMode.DEDICATED_SERVER : NetworkMode.NONE));
@@ -163,6 +163,7 @@
                     MessagePopup errorPopup = getManager().createScreen(MessagePopup.ASSET_URI, MessagePopup.class);
                     errorPopup.setMessage(""Error"", ""Can't create new game!"");
                 }
+            }
         });
 
         WidgetUtil.trySubscribe(this, ""close"", button -> {",1
Use INFO-level logging for sequence generator corruption that gets auto-fixed,"                     LOG.debug(String.format(""Checking for sequence corruption on entity %s"", segmentValue));
                     Long maxEntityId = BLCNumberUtils.toLong(results.get(0));
                     if (maxEntityId > maxSequenceId) {
-                        String invalidSequenceDetectedMsg = String.format(""The sequence value for %s in %s was found as %d (or an entry did not exist) but the actual max sequence in""
-                            + "" %s's table was found as %d"", segmentValue, tableName, maxSequenceId, mappedClass.getName(), maxEntityId);
+                        LOG.error(String.format(""The sequence value for %s in %s was found as %d (or an entry did not exist) but the actual max sequence in""
+                                + "" %s's table was found as %d"", segmentValue, tableName, maxSequenceId, mappedClass.getName(), maxEntityId));
                         if (automaticallyCorrectInconsistencies) {
                             long newMaxId = maxEntityId + 10;
                             if (sequenceEntryExists) {
-                                invalidSequenceDetectedMsg += String.format("". Updating the sequence value"" + "" to %d"", newMaxId);
-                                LOG.info(invalidSequenceDetectedMsg);
+                                String log = String.format(""Correcting sequences for entity %s.  Updating the sequence value""
+                                                + "" to %d"",
+                                        mappedClass.getName(), newMaxId);
+                                LOG.warn(log);
 
                                 StringBuilder updateQuery = new StringBuilder();
                                 updateQuery.append(""update "");
@@ -232,8 +234,10 @@
                                     throw new RuntimeException(""Unable to update "" + tableName + "" with the sequence generator id for "" + segmentValue);
                                 }
                             } else {
-                                invalidSequenceDetectedMsg += String.format("". Did not find an entry in %s, inserting the new sequence value as %d"", tableName, newMaxId);
-                                LOG.info(invalidSequenceDetectedMsg);
+                                String log = String.format(""Correcting sequences for entity %s. Did not find an entry in""
+                                                + "" %s, inserting the new sequence value as %d"",
+                                        mappedClass.getName(), tableName, newMaxId);
+                                LOG.warn(log);
 
                                 StringBuilder insertQuery = new StringBuilder();
                                 insertQuery.append(""insert into "");
@@ -251,7 +255,6 @@
                                 }
                             }
                         } else {
-                            LOG.error(invalidSequenceDetectedMsg);
                             String reason = ""A data inconsistency has been detected between the "" + tableName + "" table and one or more entity tables for which it manages current max primary key values.\n"" +
                                     ""The inconsistency was detected between the managed class ("" + mappedClass.getName() + "") and the identifier ("" + segmentValue + "") in "" + tableName + "". Broadleaf\n"" +
                                     ""has stopped startup of the application in order to allow you to resolve the issue and avoid possible data corruption. If you wish to disable this detection, you may\n"" +",1
[BACKPORT] Repositioned byte-buffer to read next chunk size if next expected cha…,"     // 65536, no specific reason, similar to UDP packet size limit
     @SuppressWarnings(""checkstyle:magicnumber"")
     private static final int MAX_CAPACITY = 1 << 16;
-    private static final byte LINE_FEED = 0x0A;
-    private static final byte CARRIAGE_RETURN = 0x0D;
 
-    private final TextReadHandler readHandler;
-
-    private boolean chunked;
     private boolean nextLine;
     private boolean readyToReadData;
+
     private ByteBuffer data;
+    private ByteBuffer lineBuffer = ByteBuffer.allocate(INITIAL_CAPACITY);
     private String contentType;
-    private ByteBuffer lineBuffer = ByteBuffer.allocate(INITIAL_CAPACITY);
+    private final TextReadHandler readHandler;
+    private boolean chunked;
 
     public HttpPostCommand(TextReadHandler readHandler, String uri) {
         super(HTTP_POST, uri);
@@ -79,46 +77,6 @@
         return complete;
     }
 
-    private boolean doActualRead(ByteBuffer cb) {
-        if (readyToReadData) {
-            if (chunked && (data == null || !data.hasRemaining())) {
-
-                if (data != null && cb.hasRemaining()) {
-                    readCRLFOrPositionChunkSize(cb);
-                }
-
-                boolean done = readChunkSize(cb);
-                if (done) {
-                    return true;
-                }
-            }
-
-            IOUtil.copyToHeapBuffer(cb, data);
-        }
-
-        setReadyToReadData(cb);
-
-        return !chunked && ((data != null) && !data.hasRemaining());
-    }
-
-    private void setReadyToReadData(ByteBuffer cb) {
-        while (!readyToReadData && cb.hasRemaining()) {
-            byte b = cb.get();
-            if (b == CARRIAGE_RETURN) {
-                readLF(cb);
-                processLine(StringUtil.lowerCaseInternal(toStringAndClear(lineBuffer)));
-                if (nextLine) {
-                    readyToReadData = true;
-                }
-                nextLine = true;
-                break;
-            }
-
-            nextLine = false;
-            appendToBuffer(b);
-        }
-    }
-
     public byte[] getData() {
         if (data == null) {
             return null;
@@ -135,21 +93,61 @@
         }
     }
 
-    private void readCRLFOrPositionChunkSize(ByteBuffer cb) {
+    private void setReadyToReadData(ByteBuffer cb) {
+        while (!readyToReadData && cb.hasRemaining()) {
             byte b = cb.get();
-        if (b == CARRIAGE_RETURN) {
-            readLF(cb);
-        } else {
-            cb.position(cb.position() - 1);
+            char c = (char) b;
+
+            if (c == '\r') {
+                ensureReadLF(cb);
+
+                processLine(StringUtil.lowerCaseInternal(toStringAndClear(lineBuffer)));
+                if (nextLine) {
+                    readyToReadData = true;
+                }
+                nextLine = true;
+                break;
+            }
+
+            nextLine = false;
+            appendToBuffer(b);
         }
     }
 
-    private void readLF(ByteBuffer cb) {
-        assert cb.hasRemaining() : ""'\\n' should follow '\\r'"";
+    private boolean doActualRead(ByteBuffer cb) {
+        if (readyToReadData) {
+            if (chunked && (data == null || !data.hasRemaining())) {
 
-        byte b = cb.get();
-        if (b != LINE_FEED) {
-            throw new IllegalStateException(""'\\n' should follow '\\r', but got '"" + (char) b + ""'"");
+                if (data != null && cb.hasRemaining()) {
+                    ensureReadCRLF(cb);
+                }
+
+                boolean done = readChunkSize(cb);
+                if (done) {
+                    return true;
+                }
+            }
+            IOUtil.copyToHeapBuffer(cb, data);
+        }
+
+        setReadyToReadData(cb);
+
+        return !chunked && ((data != null) && !data.hasRemaining());
+    }
+
+    private void ensureReadCRLF(ByteBuffer cb) {
+        char c = (char) cb.get();
+        if (c != '\r') {
+            throw new IllegalStateException(""'\r' should be read, but got '"" + c + ""'"");
+        }
+        ensureReadLF(cb);
+    }
+
+    private void ensureReadLF(ByteBuffer cb) {
+        assert cb.hasRemaining() : ""'\n' should follow '\r'"";
+        char c = (char) cb.get();
+        if (c != '\n') {
+            throw new IllegalStateException(""'\n' should follow '\r', but got '"" + c + ""'"");
         }
     }
 
@@ -171,8 +169,9 @@
         boolean hasLine = false;
         while (cb.hasRemaining()) {
             byte b = cb.get();
-            if (b == CARRIAGE_RETURN) {
-                readLF(cb);
+            char c = (char) b;
+            if (c == '\r') {
+                ensureReadLF(cb);
                 hasLine = true;
                 break;
             }",1
Don't apply partition response coming from old connection,"         while (partitions.isEmpty() && client.getConnectionManager().isAlive()) {
             ClientClusterService clusterService = client.getClientClusterService();
             Collection<Member> memberList = clusterService.getMemberList();
-            Connection currentOwnerConnection = this.ownerConnection;
+            Connection ownerConnection = this.ownerConnection;
             //if member list is empty or owner is null, we will sleep and retry
-            if (memberList.isEmpty() || currentOwnerConnection == null) {
+            if (memberList.isEmpty() || ownerConnection == null) {
                 sleepBeforeNextTry();
                 continue;
             }
@@ -138,20 +138,11 @@
             // invocation should go to owner connection because the listener is added to owner connection
             // and partition state version should be fetched from one member to keep it consistent
             ClientInvocationFuture future =
-                    new ClientInvocation(client, requestMessage, null, currentOwnerConnection).invokeUrgent();
+                    new ClientInvocation(client, requestMessage, null, ownerConnection).invokeUrgent();
             try {
                 ClientMessage responseMessage = future.get();
                 ClientGetPartitionsCodec.ResponseParameters response =
                         ClientGetPartitionsCodec.decodeResponse(responseMessage);
-                Connection connection = responseMessage.getConnection();
-                if (!currentOwnerConnection.equals(ownerConnection)) {
-                    if (logger.isFinestEnabled()) {
-                        logger.finest("" We will not apply the response, since response come from an old connection  "" + connection
-                                + "". Current connection "" + this.ownerConnection + "" state version:""
-                                + (response.partitionStateVersionExist ? response.partitionStateVersion : ""NotAvailable""));
-                    }
-                    continue;
-                }
                 processPartitionResponse(response.partitions,
                         response.partitionStateVersion, response.partitionStateVersionExist);
             } catch (Exception e) {",1
"Clarity , optimization, doc fix","             mDrawerToggle.setHomeAsUpIndicator(R.drawable.ic_drawer_l);
         }
         //recents header color implementation
-        if (SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
+        if (SDK_INT >= 21) {
             ActivityManager.TaskDescription taskDescription = new ActivityManager.TaskDescription(""Amaze"",
                     ((BitmapDrawable) getResources().getDrawable(R.mipmap.ic_launcher)).getBitmap(),
                     getColorPreference().getColor(ColorUsage.getPrimary(MainActivity.currentTab)));
@@ -549,11 +549,11 @@
                             if (file.isDirectory(MainActivity.this))
                                 goToMain(path);
                             else {
-                                goToMain(null);
+                                goToMain("""");
                                 FileUtils.openFile(new File(path), MainActivity.this, getPrefs());
                             }
                         } else {
-                            goToMain(null);
+                            goToMain("""");
 
                         }
                     }
@@ -631,7 +631,7 @@
      * of possible deadlock situation and the asynchronous behaviour of LibSuperSU
      */
     private void initializeInteractiveShell() {
-        // only one looper can be associated to a thread. So we are making sure not to create new
+        // only one looper can be associated to a thread. So we're making sure not to create new
         // handler threads every time the code relaunch.
         if (rootMode) {
             handlerThread = new HandlerThread(""handler"");
@@ -740,8 +740,8 @@
         if (usbManager.getDeviceList().size()!=0) {
             // we need to set this every time as there is no way to know that whether USB device was
             // disconnected after closing the app and another one was connected
-            // in that case the URI will obviously change
-            // other wise we could persist the URI even after reopening the app by not writing
+            // in that case the uri will obviously change
+            // other wise we could persist the uri even after reopening the app by not writing
             // this preference when it's not null
             getPrefs().edit().putString(KEY_PREF_OTG, VALUE_PREF_OTG_NULL).apply();
             return true;
@@ -801,14 +801,14 @@
                 if (file.isDirectory(this))
                     goToMain(path);
                 else {
-                    goToMain(null);
+                    goToMain("""");
                     FileUtils.openFile(new File(path), this, getPrefs());
                 }
             } else {
-                goToMain(null);
+                goToMain("""");
             }
         } else {
-            goToMain(null);
+            goToMain("""");
         }
     }
 
@@ -1295,7 +1295,7 @@
             } else if (intent.getAction().equals(UsbManager.ACTION_USB_DEVICE_DETACHED)) {
                 getPrefs().edit().putString(KEY_PREF_OTG, null).apply();
                 refreshDrawer();
-                goToMain(null);
+                goToMain("""");
             }
         }
     };
@@ -1404,7 +1404,7 @@
 
         parent = new File(""/mnt/sdcard/usbStorage"");
         if (parent.exists() && parent.canExecute())
-            return parent;
+            return (parent);
         parent = new File(""/mnt/sdcard/usb_storage"");
         if (parent.exists() && parent.canExecute())
             return parent;",1
Fixed toString() represention of OrderBy,"             sb.append(leaf.representation());
             sb.append("" "");
             if (reverseFlags[i]) {
+                sb.append(""ASC"");
+            } else {
                 sb.append(""DESC"");
-            } else {
-                sb.append(""ASC"");
             }
             Boolean nullFirst = nullsFirst[i];
             if (nullFirst != null) {",1
"Make NettyConnectionsPool properly trace open channels, fix #222","                     }
                 }
 
-                if (log.isTraceEnabled()) {
-                    int openChannels = 0;
-                    for (ConcurrentLinkedQueue<IdleChannel> hostChannels: connectionsPool.values()) {
-                        openChannels += hostChannels.size();
-                    }
+                if (log.isTraceEnabled())
                     log.trace(String.format(""%d channel open, %d idle channels closed (times: 1st-loop=%d, 2nd-loop=%d).\n"",
-                            openChannels, channelsInTimeout.size(), endConcurrentLoop - currentTime, System.currentTimeMillis() - endConcurrentLoop));
-                }
+                        connectionsPool.size(), channelsInTimeout.size(), endConcurrentLoop - currentTime, System.currentTimeMillis() - endConcurrentLoop));
             } catch (Throwable t) {
                 log.error(""uncaught exception!"", t);
             }",1
TFJ-704 fix bug. Add null check.," 
             this.url = json.getString(""url"");
             this.expandedURL = json.getString(""expanded_url"");
-            if (!json.isNull(""display_url"")) {
             this.displayURL = json.getString(""display_url"");
-            }
         } catch (JSONException jsone) {
             throw new TwitterException(jsone);
         }",1
Muc Icon tile color fix," 			case 4:
 				drawTile(canvas, letters[0], colors[0], fgColor,
 						0, 0, size/2 - 1, size/2 - 1);
-				drawTile(canvas, letters[1], colors[1], fgColor,
+				drawTile(canvas, letters[1], colors[0], fgColor,
 						0, size/2 + 1, size/2 - 1, size);
 				drawTile(canvas, letters[2], colors[2], fgColor,
 						size/2 + 1, 0, size, size/2 - 1);",1
# Fixes issue 2608,"         desiredStateResets.remove(stateChange.getDefaultInstance());
     }
 
-    // TODO: to be refactored - nodes should request a refresh but this should be pending until the end of the frame
     protected void refreshTaskList() {
-        if (taskListGenerator != null) {
         taskListGenerator.refresh();
     }
-    }
 
     public Set<StateChange> getDesiredStateChanges() {
         return desiredStateChanges;",1
Fix #3561," 		int result = gl.glCheckFramebufferStatus(GL20.GL_FRAMEBUFFER);
 
 		if (result == GL20.GL_FRAMEBUFFER_UNSUPPORTED && hasDepth && hasStencil
-			&& (Gdx.graphics.supportsExtension(""GL_OES_packed_depth_stencil"") ||
-				Gdx.graphics.supportsExtension(""GL_EXT_packed_depth_stencil""))) {
+			&& Gdx.graphics.supportsExtension(""GL_OES_packed_depth_stencil"")) {
 			if (hasDepth) {
 				gl.glDeleteRenderbuffer(depthbufferHandle);
 				depthbufferHandle = 0;",1
Fix sink-record to get topic name,"     }
 
     @Override
-    public Optional<String> getTopicName() {
-        return sourceRecord.getTopicName();
-    }
-
-    @Override
     public Optional<String> getKey() {
         return sourceRecord.getKey();
     }",1
misc fixes," import java.nio.channels.SelectionKey;
 import java.nio.channels.Selector;
 import java.nio.channels.SocketChannel;
-import java.nio.channels.UnresolvedAddressException;
 import java.util.Iterator;
 import java.util.Set;
 
@@ -127,17 +126,13 @@
 		client.connect( remote );
 		selector = Selector.open();
 		client.register( selector, SelectionKey.OP_CONNECT );
+		conn = new WebSocket( this, draft, client );
 	}
 
 	// Runnable IMPLEMENTATION /////////////////////////////////////////////////
 	public void run() {
 		if(thread == null)
 			thread = Thread.currentThread();
-		interruptableRun();
-		thread = null;
-	}
-
-	protected void interruptableRun() {
 		try {
 			tryToConnect( new InetSocketAddress( uri.getHost(), getPort() ) );
 		} 
@@ -146,17 +141,14 @@
 			return;
 		}catch ( IOException e ) {//
 			onError( conn, e );
+			conn.close();
 			return;
 		} catch ( SecurityException e ) {
 			onError( conn, e );
-			return;
-        } catch ( UnresolvedAddressException e ) {
-            onError( conn, e );
+			conn.close();
 			return;
 		}
 
-		conn = new WebSocket( this, draft, client );
-
 		while ( !Thread.interrupted() ) {
 			SelectionKey key = null;
 			try {
@@ -258,7 +250,6 @@
 	 * @param conn
 	 * @param message
 	 */
-	@Override
 	public void onMessage( WebSocket conn, String message ) {
 		onMessage( message );
 	}
@@ -268,7 +259,6 @@
 	 * 
 	 * @param conn
 	 */
-	@Override
 	public void onOpen( WebSocket conn ) {
 		onOpen();
 	}
@@ -278,7 +268,6 @@
 	 * 
 	 * @param conn
 	 */
-	@Override
 	public void onClose( WebSocket conn ) {
 		thread.interrupt();
 		onClose();
@@ -289,8 +278,7 @@
 	 * 
 	 * @param conn
 	 */
-	@Override
-	public void onError( WebSocket conn, Exception ex ) {
+	public void onError( WebSocket conn, IOException ex ) {
 		onError( ex );
 	}
 ",1
Fix error message in split pane. Fixes #3356.," 	}
 
 	public void setMaxSplitAmount (float maxAmount) {
-		if (maxAmount > 1) throw new GdxRuntimeException(""maxAmount has to be <= 1"");
+		if (maxAmount > 1) throw new GdxRuntimeException(""maxAmount has to be >= 0"");
 		if (maxAmount <= minAmount) throw new GdxRuntimeException(""maxAmount has to be > minAmount"");
 		this.maxAmount = maxAmount;
 	}",1
Export context's session management data," 
 	@Override
 	public void exportContextData(Context ctx, Configuration config) {
-		SessionManagementMethodType type = ctx.getSessionManagementMethod().getType();
-		config.setProperty(CONTEXT_CONFIG_SESSION_TYPE, type.getUniqueIdentifier());
-		type.exportData(config, ctx.getSessionManagementMethod());
+		config.setProperty(CONTEXT_CONFIG_SESSION_TYPE, ctx.getSessionManagementMethod().getType().getUniqueIdentifier());
 	}
 
 	@Override",1
Fixed issue where Solr delete queries did not filter out non-product documents," 
     @Override
     public void deleteByQuery(String deleteQuery) throws SolrServerException, IOException {
-        String productFilter = shs.getTypeFieldName() + "":"" + shs.getPrimaryDocumentType();
-
-        // transform the deleteQuery to include the productFilter, this is necessary to ensure that we don't delete non-product documents accidentally
-        deleteQuery = productFilter + "" AND ("" + deleteQuery + "")"";
-
-        String childDeleteQuery = ""{!child of="" + productFilter + ""} "" + deleteQuery;
+        String childDeleteQuery = ""{!child of="" + shs.getTypeFieldName() + "":"" + shs.getPrimaryDocumentType() + ""} "" + deleteQuery;
         solrConfiguration.getServer().deleteByQuery(childDeleteQuery);
         solrConfiguration.getServer().deleteByQuery(deleteQuery);
 ",1
Fix bad import," 
 package org.deeplearning4j.util;
 
+import com.sun.prism.impl.shape.ShapeUtil;
 import org.deeplearning4j.nn.conf.layers.PoolingType;
 import org.nd4j.linalg.api.ndarray.INDArray;
 import org.nd4j.linalg.api.ops.impl.broadcast.BroadcastAddOp;",1
Fix ConnectorManager dropConnection leaving AnalyzeProperty entry behind,"         metadataManager.getTablePropertyManager().removeProperties(connectorId);
         metadataManager.getColumnPropertyManager().removeProperties(connectorId);
         metadataManager.getSchemaPropertyManager().removeProperties(connectorId);
-        metadataManager.getAnalyzePropertyManager().removeProperties(connectorId);
         metadataManager.getSessionPropertyManager().removeConnectorSessionProperties(connectorId);
 
         MaterializedConnector materializedConnector = connectors.remove(connectorId);",1
Fix crash when selecting automatic export interval,"             public boolean onPreferenceChange(Preference preference, Object autoExportInterval) {
                 String summary = String.format(
                         getApplicationContext().getString(R.string.pref_summary_auto_export_interval),
-                        Integer.valueOf((String) autoExportInterval));
+                        (int) autoExportInterval);
                 preference.setSummary(summary);
                 boolean auto_export_enabled = GBApplication.getPrefs().getBoolean(GBPrefs.AUTO_EXPORT_ENABLED, false);
-                PeriodicExporter.sheduleAlarm(getApplicationContext(), Integer.valueOf((String) autoExportInterval), auto_export_enabled);
+                PeriodicExporter.sheduleAlarm(getApplicationContext(), (int) autoExportInterval, auto_export_enabled);
                 return true;
             }
         });",1
Fix typo,"         this(protocol, null, null, host, port, null, (Map<String, String>) null);
     }
 
-    public URL(String protocol, String host, int port, String[] pairs) { // varargs ... conflict with the following path argument, use array instead.
+    public URL(String protocol, String host, int port, String[] pairs) { // varargs ... confilict with the following path argument, use array instead.
         this(protocol, null, null, host, port, null, CollectionUtils.toStringMap(pairs));
     }
 ",1
Track the directories with scripts," 	 */
 	private boolean shouldLoadTemplatesOnScriptTypeRegistration;
 	
-	/**
-	 * The directories added to the extension, to automatically add and remove its scripts.
-	 * 
-	 * @see #addScriptsFromDir(File)
-	 * @see #removeScriptsFromDir(File)
-	 */
-	private List<File> trackedDirs = Collections.synchronizedList(new ArrayList<>());
-	
     public ExtensionScript() {
         super(NAME);
         this.setOrder(EXTENSION_ORDER);
@@ -270,15 +262,6 @@
 		// Templates for this engine might not have been loaded
 		this.loadTemplates(wrapper);
 
-		synchronized (trackedDirs) {
-			String engineName = wrapper.getLanguageName() + LANG_ENGINE_SEP + wrapper.getEngineName();
-			for (File dir : trackedDirs) {
-				for (ScriptType type : this.getScriptTypes()) {
-					addScriptsFromDir(dir, type, engineName);
-				}
-			}
-		}
-
 		if (scriptUI != null) {
 			try {
 				scriptUI.engineAdded(wrapper);
@@ -500,12 +483,6 @@
 		if (shouldLoadTemplatesOnScriptTypeRegistration) {
 			loadScriptTemplates(type);
 		}
-
-		synchronized (trackedDirs) {
-			for (File dir : trackedDirs) {
-				addScriptsFromDir(dir, type, null);
-			}
-		}
 	}
 	
 	/**
@@ -821,68 +798,17 @@
     }
 
 	
-	/**
-	 * Adds the scripts from the given directory and starts tracking it.
-	 * <p>
-	 * The directory will be tracked to add or remove its scripts when a new script engine/type is added or removed.
-	 * <p>
-	 * The scripts are expected to be under directories of the corresponding script type, for example:
-	 * <pre>
-	 * {@code
-	 * (dir specified)
-	 * ├── active
-	 * │   ├── gof_lite.js
-	 * │   ├── TestInsecureHTTPVerbs.py
-	 * │   └── User defined attacks.js
-	 * ├── extender
-	 * │   └── HTTP Message Logger.js
-	 * ├── httpfuzzerprocessor
-	 * │   ├── add_msgs_sites_tree.js
-	 * │   ├── http_status_code_filter.py
-	 * │   └── showDifferences.js
-	 * ├── httpsender
-	 * │   ├── add_header_request.py
-	 * │   └── Capture and Replace Anti CSRF Token.js
-	 * └── variant
-	 *     └── JsonStrings.js
-	 * }
-	 * </pre>
-	 * 
-	 * where {@code active}, {@code extender}, {@code httpfuzzerprocessor}, {@code httpsender}, and {@code variant} are the
-	 * script types.
-	 * 
-	 * @param dir the directory from where to add the scripts.
-	 * @return the number of scripts added.
-	 * @since 2.4.1
-	 * @see #removeScriptsFromDir(File)
-	 */
 	public int addScriptsFromDir (File dir) {
 		logger.debug(""Adding scripts from dir: "" + dir.getAbsolutePath());
-		trackedDirs.add(dir);
 		int addedScripts = 0;
 		for (ScriptType type : this.getScriptTypes()) {
-			addedScripts += addScriptsFromDir(dir, type, null);
-		}
-		return addedScripts;
-	}
-
-	/**
-	 * Adds the scripts from the given directory of the given script type and, optionally, for the engine with the given name.
-	 *
-	 * @param dir the directory from where to add the scripts.
-	 * @param type the script type, must not be {@code null}.
-	 * @param targetEngineName the engine that the scripts must be of, {@code null} for all engines.
-	 * @return the number of scripts added.
-	 */
-	private int addScriptsFromDir(File dir, ScriptType type, String targetEngineName) {
-		int addedScripts = 0;
-		File typeDir = new File(dir, type.getName());
-		if (typeDir.exists()) {
-			for (File f : typeDir.listFiles()) {
+			File locDir = new File(dir, type.getName());
+			if (locDir.exists()) {
+				for (File f : locDir.listFiles()) {
 					String ext = f.getName().substring(f.getName().lastIndexOf(""."") + 1);
 					String engineName = this.getEngineNameForExtension(ext);
 					
-				if (engineName != null && (targetEngineName == null || engineName.equals(targetEngineName))) {
+					if (engineName != null) {
 						try {
 							if (f.canWrite()) {
 								String scriptName = this.getUniqueScriptName(f.getName(), ext);
@@ -909,23 +835,12 @@
 					}
 				}
 			}
+		}
 		return addedScripts;
 	}
 
-	/**
-	 * Removes the scripts added from the given directory and stops tracking it.
-	 * <p>
-	 * The number of scripts removed might be different than the number of scripts initially added, as a script engine or type
-	 * might have been added or removed in the meantime.
-	 * 
-	 * @param dir the directory previously added.
-	 * @return the number of scripts removed.
-	 * @since 2.4.1
-	 * @see #addScriptsFromDir(File)
-	 */
 	public int removeScriptsFromDir (File dir) {
 		logger.debug(""Removing scripts from dir: "" + dir.getAbsolutePath());
-		trackedDirs.remove(dir);
 		int removedScripts = 0;
 		
 		for (ScriptType type : this.getScriptTypes()) {
@@ -967,13 +882,6 @@
 		return file.getParentFile().equals(directory);
 	}
 
-	/**
-	 * Gets the numbers of scripts for the given directory for the currently registered script engines and types.
-	 * 
-	 * @param dir the directory to check.
-	 * @return the number of scripts.
-	 * @since 2.4.1
-	 */
 	public int getScriptCount(File dir) {
 		int scripts = 0;
 		",1
Fixed Label setEllipsis method," 	/** When true the text will be truncated ""..."" if it does not fit within the width of the label. Wrapping will not occur when
 	 * ellipsis is true. Default is false. */
 	public void setEllipsis (boolean ellipsis) {
-		if(ellipsis)
 		this.ellipsis = ""..."";
-		else
-			this.ellipsis = null;
 	}
 
 	/** Allows subclasses to access the cache in {@link #draw(Batch, float)}. */",1
[java] Fix same package import from default package,"          */
         public CurrentPackageResolver(PMDASMClassLoader pmdClassLoader, String pkg) {
             super(pmdClassLoader);
-            if (pkg == null || pkg.length() == 0) {
+            if (pkg == null) {
                 this.pkg = null;
             } else {
                 this.pkg = pkg + ""."";",1
Fix gl2_source_collector field for default collector,"         final String beatsPreambel =
                 ""# Needed for Graylog\n"" +
                 ""fields_under_root: true\n"" +
-                ""fields.collector_node_id: ${nodeName}\n"" +
-                ""fields.gl2_source_collector: ${nodeId}\n\n"";
+                ""fields.collector_node_id: ${nodeId}\n"" +
+                ""fields.gl2_source_collector: ${nodeName}\n\n"";
 
         ensureCollector(
                 ""filebeat"",",1
"Add State/Province/Region, PostalCode, and PhoneNumber Empty/Whitespace check to Common Address Validator."," import org.broadleafcommerce.profile.core.domain.Address;
 import org.springframework.validation.Errors;
 import org.springframework.validation.ValidationUtils;
-
 import javax.annotation.Resource;
 
 /**
@@ -57,10 +56,6 @@
 
         ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.addressLine1"", ""addressLine1.required"");
         ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.city"", ""city.required"");
-        ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.stateProvinceRegion"", ""state.required"");
-        ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.postalCode"", ""postalCode.required"");
-        ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.phonePrimary.phoneNumber"", ""phonePrimary.required"");
-
         if (isValidateFullNameOnly()) {
             ValidationUtils.rejectIfEmptyOrWhitespace(errors, ""address.fullName"", ""fullName.required"");
         } else {",1
fix https://github.com/google/android-classyshark/issues/110," import com.google.classyshark.silverghost.TokensMapper;
 import com.google.classyshark.silverghost.translator.Translator;
 import com.google.classyshark.silverghost.translator.apk.ApkTranslator;
-import com.google.classyshark.silverghost.translator.jar.JarInfoTranslator;
 import org.jf.dexlib2.dexbacked.DexBackedDexFile;
 import org.jf.dexlib2.iface.DexFile;
 
@@ -80,10 +79,6 @@
             element = new ELEMENT(""\nmethods: "" + dataPack.getMethodCount(), TAG.IDENTIFIER);
             elements.add(element);
 
-            element = new ELEMENT(""\n\nFile size: "" +
-                    JarInfoTranslator.readableFileSize(classesDex.length()), TAG.DOCUMENT);
-            elements.add(element);
-
             element = new ELEMENT(""\n\nClasses with Native Calls\n"", TAG.MODIFIER);
             elements.add(element);
 ",1
Fix constant typo,"     private static final String TAG = ""StaggeredGridView"";
     private static final boolean DBG = false;
 
-    private static final int DEFAULT_COLUMNS_PORTRAIT = 2;
+    private static final int DEFAUlT_COLUMNS_PORTRAIT = 2;
     private static final int DEFAULT_COLUMNS_LANDSCAPE = 3;
 
     private int mColumnCount;
@@ -48,7 +48,7 @@
     private int mColumnWidth;
     private boolean mNeedSync;
 
-    private int mColumnCountPortrait = DEFAULT_COLUMNS_PORTRAIT;
+    private int mColumnCountPortrait = DEFAUlT_COLUMNS_PORTRAIT;
     private int mColumnCountLandscape = DEFAULT_COLUMNS_LANDSCAPE;
 
     /**
@@ -154,7 +154,7 @@
 
             mColumnCountPortrait = typedArray.getInteger(
                     R.styleable.StaggeredGridView_column_count_portrait,
-                    DEFAULT_COLUMNS_PORTRAIT);
+                    DEFAUlT_COLUMNS_PORTRAIT);
             mColumnCountLandscape = typedArray.getInteger(
                     R.styleable.StaggeredGridView_column_count_landscape,
                     DEFAULT_COLUMNS_LANDSCAPE);",1
NPE bug fixed.," 
     @Override
     public String toString() {
-        return getInterface() + "" -> "" + (getUrl() == null ? "" "" : getUrl().toString());
+        return getInterface() + "" -> "" + getUrl() == null ? "" "" : getUrl().toString();
     }
 
     public void destroy() {",1
Fixed SpnegoWebflowConfigurer to use the evaluateClientRequest as documented," 
     private void augmentWebflowToStartSpnego(final Flow flow) {
         final ActionState state = getState(flow, CasWebflowConstants.STATE_ID_INIT_LOGIN_FORM, ActionState.class);
-        if (casProperties.getAuthn().getSpnego().isMixedModeAuthentication()) {
-            createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, EVALUATE_SPNEGO_CLIENT, true);
-        } else {
         createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, START_SPNEGO_AUTHENTICATE, true);
     }
-    }
 
     private void createStartSpnegoAction(final Flow flow) {
         final ActionState actionState = createActionState(flow, START_SPNEGO_AUTHENTICATE, createEvaluateAction(SPNEGO_NEGOTIATE));
@@ -75,6 +71,6 @@
         final ActionState evaluateClientRequest = createActionState(flow, EVALUATE_SPNEGO_CLIENT,
                 createEvaluateAction(casProperties.getAuthn().getSpnego().getHostNameClientActionStrategy()));
         evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_YES, START_SPNEGO_AUTHENTICATE));
-        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, CasWebflowConstants.STATE_ID_VIEW_LOGIN_FORM));
+        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, getStartState(flow)));
     }
 }",1
Handle empty date fields in the admin,"                         if (value == null) {
                             value = ""false"";
                         }
-                    } else if (metadata.getFieldType().equals(SupportedFieldType.DATE)) {
-                        if (StringUtils.isEmpty(value)) {
-                            value = null;
-                        }
                     }
 
                     if (attemptToPopulateValue(property, fieldManager, instance, setId, metadata, entity, value)) {",1
Workspace.close() fix,"         }
 
         // this is for safety. We have to be sure that no ops were left non-processed
-        Nd4j.getExecutioner().commit();
+        if (Nd4j.getExecutioner() instanceof GridExecutioner)
+            ((GridExecutioner) Nd4j.getExecutioner()).flushQueue();
 
 
         // checking, if we should reallocate this workspace to higher amount of memory",1
Use proxies more correctly. Fixes #322,"         }
         final URI uri = URI.create(requestUrl);
         for (Proxy proxy : proxies) {
-            if (!proxy.isNonProxyHost(uri.getHost())) {
+            if (proxy.protocol.equals(uri.getScheme()) && !proxy.isNonProxyHost(uri.getHost())) {
                 return proxy;
             }
         }
-        LOGGER.info(""Could not find matching proxy for host: {}"" + uri.getHost());
+        LOGGER.info(""Could not find matching proxy for protocol {}"", uri.getScheme());
         return null;
     }
 ",1
Fixed some typos in comments," 
     public void validate(Pet pet, Errors errors) {
         String name = pet.getName();
-        // name validation
+        // name validaation
         if (!StringUtils.hasLength(name)) {
             errors.rejectValue(""name"", ""required"", ""required"");
         } else if (pet.isNew() && pet.getOwner().getPet(name, true) != null) {
             errors.rejectValue(""name"", ""duplicate"", ""already exists"");
         }
         
-        // type validation
+        // type valication
         if (pet.isNew() && pet.getType() == null) {
             errors.rejectValue(""type"", ""required"", ""required"");
         }
         
-        // birth date validation
+     // type valication
         if (pet.getBirthDate()==null) {
             errors.rejectValue(""birthDate"", ""required"", ""required"");
         }",1
Fix #2004 - Indent breaks when hitting enter before spaces,"           //textarea.setSelectionStart(origIndex + 1);
           textarea.setSelectionEnd(textarea.getSelectionStop() - spaceCount);
           textarea.setSelectedText(""\n"");
-          textarea.setCaretPosition(textarea.getCaretPosition() + extraCount + spaceCount);
         } else {
           String insertion = ""\n"" + spaces(spaceCount);
           textarea.setSelectedText(insertion);
-          textarea.setCaretPosition(textarea.getCaretPosition() + extraCount);
         }
 
         // not gonna bother handling more than one brace",1
Add the SemanticContext.Operator interface," 	}
 
 	/**
-	 * This is the base class for semantic context ""operators"", which operate on
-	 * a collection of semantic context ""operands"".
-	 */
-	public static abstract class Operator extends SemanticContext {
-		/**
-		 * Gets the operands for the semantic context operator.
-		 *
-		 * @return a collection of {@link SemanticContext} operands for the
-		 * operator.
-		 */
-		@NotNull
-		public abstract Collection<SemanticContext> getOperands();
-	}
-
-	/**
 	 * A semantic context which is true whenever none of the contained contexts
 	 * is false.
 	 */
-    public static class AND extends Operator {
+    public static class AND extends SemanticContext {
 		@NotNull public final SemanticContext[] opnds;
 
 		public AND(@NotNull SemanticContext a, @NotNull SemanticContext b) {
@@ -243,11 +228,6 @@
         }
 
 		@Override
-		public Collection<SemanticContext> getOperands() {
-			return Arrays.asList(opnds);
-		}
-
-		@Override
 		public boolean equals(Object obj) {
 			if ( this==obj ) return true;
 			if ( !(obj instanceof AND) ) return false;
@@ -319,7 +299,7 @@
 	 * A semantic context which is true whenever at least one of the contained
 	 * contexts is true.
 	 */
-    public static class OR extends Operator {
+    public static class OR extends SemanticContext {
 		@NotNull public final SemanticContext[] opnds;
 
 		public OR(@NotNull SemanticContext a, @NotNull SemanticContext b) {
@@ -340,11 +320,6 @@
         }
 
 		@Override
-		public Collection<SemanticContext> getOperands() {
-			return Arrays.asList(opnds);
-		}
-
-		@Override
 		public boolean equals(Object obj) {
 			if ( this==obj ) return true;
 			if ( !(obj instanceof OR) ) return false;",1
Fixes up JavaDoc on what is allowed to come back from scalars serialize," 
     /**
      * Called to convert a Java object result of a DataFetcher to a valid runtime value for the scalar type.
-     * <p>
-     * Note : Throw {@link graphql.schema.CoercingSerializeException} if there is fundamental
-     * problem during serialisation, don't return null to indicate failure.
-     * <p>
+     *
      * Note : You should not allow {@link java.lang.RuntimeException}s to come out of your serialize method, but rather
      * catch them and fire them as {@link graphql.schema.CoercingSerializeException} instead as per the method contract.
      *
      * @param dataFetcherResult is never null
      *
-     * @return a serialized value which may be null.
+     * @return a serialized value which is never null
      *
      * @throws graphql.schema.CoercingSerializeException if value input can't be serialized
      */
@@ -42,7 +39,7 @@
 
     /**
      * Called to resolve a input from a query variable into a Java object acceptable for the scalar type.
-     * <p>
+     *
      * Note : You should not allow {@link java.lang.RuntimeException}s to come out of your parseValue method, but rather
      * catch them and fire them as {@link graphql.schema.CoercingSerializeException} instead as per the method contract.
      *
@@ -57,7 +54,7 @@
     /**
      * Called during query validation to convert an query input AST node into a Java object acceptable for the scalar type.  The input
      * object will be an instance of {@link graphql.language.Value}.
-     * <p>
+     *
      * Note : You should not allow {@link java.lang.RuntimeException}s to come out of your parseLiteral method, but rather
      * catch them and fire them as {@link graphql.schema.CoercingParseLiteralException} instead as per the method contract.
      *
@@ -72,11 +69,11 @@
     /**
      * Called during query execution to convert an query input AST node into a Java object acceptable for the scalar type.  The input
      * object will be an instance of {@link graphql.language.Value}.
-     * <p>
+     *
      * Note : You should not allow {@link java.lang.RuntimeException}s to come out of your parseLiteral method, but rather
      * catch them and fire them as {@link graphql.schema.CoercingParseLiteralException} instead as per the method contract.
-     * <p>
-     * Many scalar types don't need to implement this method because they don't take AST {@link graphql.language.VariableReference}
+     *
+     * Many scalar types don't need to implement this method because they do'nt take AST {@link graphql.language.VariableReference}
      * objects and convert them into actual values.  But for those scalar types that want to do this, then this
      * method should be implemented.
      *",1
Suggested fix for #2072," 	}
 
 	protected String resolve (FileHandle originalHandle, String suffix) {
-		String parentString = """";
-		FileHandle parent = originalHandle.parent();
-		if (parent != null && !parent.name().equals("""")) {
-			parentString = parent + ""/"";
-		}		
-		return parentString + suffix + ""/"" + originalHandle.name();
+		return originalHandle.parent() + ""/"" + suffix + ""/"" + originalHandle.name();
 	}
 
 	static public Resolution choose (Resolution... descriptors) {",1
Fix loading resources from theme,"     private String parentName;
     private String importName;
     private File themeDir;
-    private File resourcesDir;
     private String name;
     private Type type;
     private final Properties properties;
@@ -35,8 +34,6 @@
             parentName = properties.getProperty(""parent"");
             importName = properties.getProperty(""import"");
         }
-
-        resourcesDir = new File(themeDir, ""resources"");
     }
 
     @Override
@@ -76,13 +73,8 @@
         if (File.separatorChar != '/') {
             path = path.replace('/', File.separatorChar);
         }
-
-        File file = new File(resourcesDir, path);
-        if (!file.isFile() || !file.getCanonicalPath().startsWith(resourcesDir.getCanonicalPath())) {
-            return null;
-        } else {
-            return file.toURI().toURL();
-        }
+        File file = new File(themeDir, ""/resources/"" + path);
+        return file.isFile() ? file.toURI().toURL() : null;
     }
 
     @Override",1
Fixing 100% CPU untilisation when SSL negotiations fail," 	 **/
 	private synchronized ByteBuffer unwrap() throws SSLException {
 		int rem;
-		//There are some ssl test suites, which get around the selector.select() call, which cause an infinite unwrap and 100% cpu usage (see #459 and #458)
-		if(readEngineResult.getStatus() == SSLEngineResult.Status.CLOSED && sslEngine.getHandshakeStatus() == HandshakeStatus.NOT_HANDSHAKING){
-			try {
-				close();
-			} catch (IOException e) {
-				//Not really interesting
-			}
-		}
 		do {
 			rem = inData.remaining();
 			readEngineResult = sslEngine.unwrap( inCrypt, inData );",1
fix null ptr exception as reported by Coverity," 		}
 
 		if ( !containsPredicate ) {
-			return null;
+			pairs = null;
 		}
 
 //		System.out.println(Arrays.toString(altToPred)+""->""+pairs);",1
fix zk," 
     public static void main(String[] args) {
         zkConfig = loadZkConfig();
-        String url = zkConfig.containsKey(CONFIG_URL_KEY)? (String) zkConfig.get(CONFIG_URL_KEY) : ""127.0.0.1:2181"";
         framework =
-            createConnection(url)
+            createConnection((String) zkConfig.getOrDefault(CONFIG_URL_KEY, ""127.0.0.1:2181""))
                 .usingNamespace(""mycat"");
 
         createConfig(MYCAT_HOST_KEY, false, MYCAT_HOST_KEY);",1
Fix 515 - change yarn warnings in log,"         return new LogLevelAgnosticLogger() {
             @Override
             public void log(String value) {
-                // fix #343 and #515
-                if (value.startsWith(""npm WARN "") || value.startsWith(""warning "")) {
+                // fix #343
+                if (value.startsWith(""npm WARN "")) {
                     logger.warn(value);
                 } else {
                     logger.error(value);",1
Fix a logical error and set a method to private," 	  input.close();
         } 
 
-        private static int wordCount(String s){
-          if(s.isEmpty() || s == null) return 0;
+        public static int wordCount(String s){
+          if(s.isEmpty() || s == null) return -1;
           return s.trim().split(""[\\s]+"").length;
         }
         ",1
node v4.0.0 download path fix,"     public String getNodeDownloadFilename(String nodeVersion) {
         if(isWindows()) {
             if(architecture == Architecture.x64){
-                if (nodeVersion == ""v4.0.0"") {
-                    return nodeVersion+""/win-x64/node.exe"";    
-                } else {
                 return nodeVersion+""/x64/node.exe"";
-                }
-            } else {
-                if (nodeVersion == ""v4.0.0"") {
-                    return nodeVersion+""/win-x86/node.exe"";    
             } else {
                 return nodeVersion + ""/node.exe"";
             }
-            }
         } else {
             return nodeVersion + ""/"" + getLongNodeFilename(nodeVersion) + "".tar.gz"";
         }",1
[BACKLOG-24014] Amqp Consumer bug fix for step metrics table," package org.pentaho.di.ui.spoon.trans;
 
 import java.util.ArrayList;
+import java.util.Date;
 import java.util.List;
 import java.util.ResourceBundle;
 import java.util.Timer;
 import java.util.TimerTask;
-import java.util.concurrent.locks.ReentrantLock;
-
+import java.util.concurrent.atomic.AtomicBoolean;
 import com.google.common.base.Strings;
 
 import org.eclipse.swt.SWT;
@@ -76,6 +76,8 @@
 
   private static final int STEP_NAME_COLUMN = 1;
 
+  public static final long REFRESH_TIME = 100L;
+
   public static final long UPDATE_TIME_VIEW = 1000L;
 
   private TransGraph transGraph;
@@ -84,6 +86,10 @@
 
   private TableView transGridView;
 
+  private boolean refresh_busy;
+
+  private long lastUpdateView;
+
   private XulToolbar toolbar;
 
   private Composite transGridComposite;
@@ -92,8 +98,6 @@
 
   private boolean showSelectedSteps;
 
-  private final ReentrantLock refreshViewLock = new ReentrantLock();
-
   /**
    * @param spoon
    * @param transGraph
@@ -223,18 +227,28 @@
     ValueMetaInterface numberColumnValueMeta = new ValueMetaString( ""#"", TransGridDelegate::subStepCompare );
     numberColumn.setValueMeta( numberColumnValueMeta );
 
-    // Timer updates the view every UPDATE_TIME_VIEW interval
+    // Add a timer to update this view every couple of seconds...
+    //
     final Timer tim = new Timer( ""TransGraph: "" + transGraph.getMeta().getName() );
+    final AtomicBoolean busy = new AtomicBoolean( false );
 
     TimerTask timtask = new TimerTask() {
       public void run() {
         if ( !spoon.getDisplay().isDisposed() ) {
-          spoon.getDisplay().asyncExec( TransGridDelegate.this::refreshView );
+          spoon.getDisplay().asyncExec( new Runnable() {
+            public void run() {
+              if ( !busy.get() ) {
+                busy.set( true );
+                refreshView();
+                busy.set( false );
+              }
+            }
+          } );
         }
       }
     };
 
-    tim.schedule( timtask, 0L, UPDATE_TIME_VIEW );
+    tim.schedule( timtask, 0L, REFRESH_TIME ); // schedule to repeat a couple of times per second to get fast feedback
 
     transGridTab.addDisposeListener( new DisposeListener() {
       public void widgetDisposed( DisposeEvent disposeEvent ) {
@@ -298,8 +312,6 @@
   }
 
   private void refreshView() {
-    refreshViewLock.lock();
-    try {
     boolean tableCleared = false;
     int numberStepsToDisplay = -1;
     int baseStepCount = -1;
@@ -307,6 +319,9 @@
     if ( transGridView == null || transGridView.isDisposed() ) {
       return;
     }
+    if ( refresh_busy ) {
+      return;
+    }
 
     List<StepMeta> selectedSteps = new ArrayList<StepMeta>();
     if ( showSelectedSteps ) {
@@ -315,9 +330,15 @@
 
     int topIdx = transGridView.getTable().getTopIndex();
 
+    refresh_busy = true;
+
     Table table = transGridView.table;
 
-      if ( transGraph.trans != null && !transGraph.trans.isPreparing() ) {
+    long time = new Date().getTime();
+    long msSinceLastUpdate = time - lastUpdateView;
+    if ( transGraph.trans != null && !transGraph.trans.isPreparing() && msSinceLastUpdate > UPDATE_TIME_VIEW ) {
+      lastUpdateView = time;
+
       baseStepCount = transGraph.trans.nrSteps();
       if ( hideInactiveSteps ) {
         numberStepsToDisplay = transGraph.trans.nrActiveSteps();
@@ -344,8 +365,8 @@
       }
 
       if ( numberStepsToDisplay == 0 && table.getItemCount() == 0 ) {
-          // We need at least one table-item in a table
         new TableItem( table, SWT.NONE );
+        refresh_busy = false;
         return;
       }
 
@@ -381,7 +402,7 @@
         }
       } else {
         // iterate over and update the existing rows in the table
-          for ( int rowIndex = 0; rowIndex < table.getItemCount(); rowIndex++ ) {
+        for ( int rowIndex = 0; rowIndex < numberStepsToDisplay; rowIndex++ ) {
           TableItem ti = table.getItem( rowIndex );
 
           if ( ti == null ) {
@@ -389,14 +410,14 @@
           }
 
           String tableStepNumber = ti.getText( STEP_NUMBER_COLUMN );
+          String[] tableStepNumberSplit = tableStepNumber.split( ""\\."" );
 
-            //The first row step number may be empty if the table was just cleared
-            if ( rowIndex == 0 && Strings.isNullOrEmpty( tableStepNumber ) ) {
-              log.logDebug( ""Table step number null or empty for row 0"" );
+          if ( tableStepNumberSplit.length <= 0 ) {
+            log.logError(
+              ""Table base.sub step number length less than or equal to 0, skipping update for table row: "" + rowIndex );
             continue;
           }
 
-            String[] tableStepNumberSplit = tableStepNumber.split( ""\\."" );
           String tableBaseStepNumber = tableStepNumberSplit[ 0 ];
 
           if ( Strings.isNullOrEmpty( tableBaseStepNumber ) ) {
@@ -474,10 +495,14 @@
       if ( transGridView.getTable().getTopIndex() != topIdx ) {
         transGridView.getTable().setTopIndex( topIdx );
       }
+    } else {
+      // We need at least one table-item in a table!
+      if ( table.getItemCount() == 0 ) {
+        new TableItem( table, SWT.NONE );
       }
-    } finally {
-      refreshViewLock.unlock();
     }
+
+    refresh_busy = false;
   }
 
   private void updateRowFromBaseStep( StepInterface baseStep, TableItem row ) {",1
fix broadcast on x86," 
     @Override
     public INDArray exec(BroadcastOp broadcast, int... dimension) {
-        if (dimension.length == broadcast.x().rank()) {
-            dimension = new int[]{Integer.MAX_VALUE};
-        }
-
-        if(broadcast.isPassThrough()){
-            broadcast.exec(dimension);
-            return broadcast.z();
-        }
-
-        Task<Void> task = taskFactory.getBroadcastOpAction(broadcast);
-        task.invokeBlocking();
-        return broadcast.z();
+       throw new UnsupportedOperationException();
     }
 }",1
Improve globbing algorithm. Fixes #439," 
 import static java.nio.charset.StandardCharsets.UTF_8;
 
-import com.google.common.base.Joiner;
 import com.google.common.base.Preconditions;
-import com.google.common.base.Splitter;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableMap;
 import com.google.common.collect.ImmutableSet;
@@ -509,58 +507,20 @@
      */
     List<String> getJsFiles(PrintStream err) throws CmdLineException, IOException {
       final Set<String> allJsInputs = new LinkedHashSet<>();
+      final List<String> matchedPaths = new ArrayList<>();
       List<String> patterns = new ArrayList<>();
       patterns.addAll(js);
       patterns.addAll(arguments);
       for (String pattern : patterns) {
         if (!pattern.contains(""*"") && !pattern.startsWith(""!"")) {
-          File matchedFile = new File(pattern);
-          if (matchedFile.isDirectory()) {
-            matchPaths(new File(matchedFile, ""**.js"").toString(), allJsInputs);
+          allJsInputs.add(pattern);
         } else {
-            allJsInputs.add(pattern);
-          }
-        } else {
-          matchPaths(pattern, allJsInputs);
-        }
-      }
-
-      if (!patterns.isEmpty() && allJsInputs.isEmpty()) {
-        throw new CmdLineException(""No inputs matched"");
-      }
-
-      return new ArrayList<>(allJsInputs);
-    }
-
-    private void matchPaths(String pattern, final Set<String> allJsInputs)
-        throws IOException {
           FileSystem fs = FileSystems.getDefault();
           final boolean remove = pattern.indexOf(""!"") == 0;
           if (remove) pattern = pattern.substring(1);
-
-      if (File.separator.equals(""\\"")) {
-        pattern = pattern.replace('\\', '/');
-      }
-
-      // Split the pattern into two pieces: the globbing part
-      // and the non-globbing prefix.
-      List<String> patternParts =
-          ImmutableList.copyOf(Splitter.on(""/"").split(pattern));
-      String prefix = ""."";
-      for (int i = 0; i < patternParts.size(); i++) {
-        if (patternParts.get(i).contains(""*"")) {
-          if (i == 0) {
-            break;
-          } else {
-            prefix = Joiner.on(""/"").join(patternParts.subList(0, i));
-            pattern = Joiner.on(""/"").join(patternParts.subList(i, patternParts.size()));
-          }
-        }
-      }
-
           final PathMatcher matcher = fs.getPathMatcher(""glob:"" + pattern);
           java.nio.file.Files.walkFileTree(
-          fs.getPath(prefix), new SimpleFileVisitor<Path>() {
+              fs.getPath("".""), new SimpleFileVisitor<Path>() {
               @Override public FileVisitResult visitFile(
                   Path p, BasicFileAttributes attrs) {
                 if (matcher.matches(p)) {
@@ -570,10 +530,24 @@
                     allJsInputs.add(p.toString());
                   }
                 }
+                matchedPaths.add(p.toString());
                 return FileVisitResult.CONTINUE;
               }
           });
         }
+      }
+
+      if (!patterns.isEmpty() && allJsInputs.isEmpty()) {
+        err.println(""Paths attempted to match:"");
+        for (String path : matchedPaths) {
+          err.println(path);
+        }
+
+        throw new CmdLineException(""No inputs matched"");
+      }
+
+      return new ArrayList<>(allJsInputs);
+    }
 
     List<SourceMap.LocationMapping> getSourceMapLocationMappings() {
       List<SourceMap.LocationMapping> locationMappings =",1
Fix processing.mode.java.runner.Runner's exception trace for when the file name of a StackTraceElement is not known ( Fixes Issue #2346 ),"         ObjectReference ref = (ObjectReference)val;
         method = ((ClassType) ref.referenceType()).concreteMethodByName(""getFileName"", ""()Ljava/lang/String;"");
         StringReference strref = (StringReference) ref.invokeMethod(thread, method, new ArrayList<Value>(), ObjectReference.INVOKE_SINGLE_THREADED);
-        String filename = strref == null ? ""Unknown Source"" : strref.value();
+        String filename = strref.value();
         method = ((ClassType) ref.referenceType()).concreteMethodByName(""getLineNumber"", ""()I"");
         IntegerValue intval = (IntegerValue) ref.invokeMethod(thread, method, new ArrayList<Value>(), ObjectReference.INVOKE_SINGLE_THREADED);
         int lineNumber = intval.intValue() - 1;",1
Fix resource leak in query queue,"                         }
                     }
                 });
-                if (queryExecution.getQueryInfo().getState().isDone()) {
-                    settableFuture.set(null);
-                }
-                else {
                 queryExecutor.execute(new Runnable()
                 {
                     @Override
@@ -491,7 +487,6 @@
                         }
                     }
                 });
-                }
                 return settableFuture;
             }
         }",1
PUBDEV-5877: Fix a race condition in Hdfs file import,"   }
 
   private static void addFolder(FileSystem fs, Path p, ArrayList<String> keys, ArrayList<String> failed) {
+    try {
       if( fs == null ) return;
+
       Futures futures = new Futures();
-    try {
       for( FileStatus file : fs.listStatus(p, HIDDEN_FILE_FILTER) ) {
         Path pfs = file.getPath();
         if(file.isDirectory()) {
@@ -311,8 +312,6 @@
     } catch( Exception e ) {
       Log.err(e);
       failed.add(p.toString());
-    } finally {
-      futures.blockForPending();
     }
   }
 ",1
Fixing GPUImageChromaKeyBlendFilter,"  * Selectively replaces a color in the first image with the second image
  */
 public class GPUImageChromaKeyBlendFilter extends GPUImageTwoInputFilter {
-    public static final String CHROMA_KEY_BLEND_FRAGMENT_SHADER = "" precision highp float;\n"" +
-            "" \n"" +
-            "" varying highp vec2 textureCoordinate;\n"" +
+    public static final String CHROMA_KEY_BLEND_FRAGMENT_SHADER = ""varying highp vec2 textureCoordinate;\n"" +
             "" varying highp vec2 textureCoordinate2;\n"" +
             "" \n"" +
-            "" uniform float thresholdSensitivity;\n"" +
-            "" uniform float smoothing;\n"" +
-            "" uniform vec3 colorToReplace;\n"" +
             "" uniform sampler2D inputImageTexture;\n"" +
             "" uniform sampler2D inputImageTexture2;\n"" +
             "" \n"" +
+            "" highp float lum(lowp vec3 c) {\n"" +
+            ""     return dot(c, vec3(0.3, 0.59, 0.11));\n"" +
+            "" }\n"" +
+            "" \n"" +
+            "" lowp vec3 clipcolor(lowp vec3 c) {\n"" +
+            ""     highp float l = lum(c);\n"" +
+            ""     lowp float n = min(min(c.r, c.g), c.b);\n"" +
+            ""     lowp float x = max(max(c.r, c.g), c.b);\n"" +
+            ""     \n"" +
+            ""     if (n < 0.0) {\n"" +
+            ""         c.r = l + ((c.r - l) * l) / (l - n);\n"" +
+            ""         c.g = l + ((c.g - l) * l) / (l - n);\n"" +
+            ""         c.b = l + ((c.b - l) * l) / (l - n);\n"" +
+            ""     }\n"" +
+            ""     if (x > 1.0) {\n"" +
+            ""         c.r = l + ((c.r - l) * (1.0 - l)) / (x - l);\n"" +
+            ""         c.g = l + ((c.g - l) * (1.0 - l)) / (x - l);\n"" +
+            ""         c.b = l + ((c.b - l) * (1.0 - l)) / (x - l);\n"" +
+            ""     }\n"" +
+            ""     \n"" +
+            ""     return c;\n"" +
+            "" }\n"" +
+            ""\n"" +
+            "" lowp vec3 setlum(lowp vec3 c, highp float l) {\n"" +
+            ""     highp float d = l - lum(c);\n"" +
+            ""     c = c + vec3(d);\n"" +
+            ""     return clipcolor(c);\n"" +
+            "" }\n"" +
+            "" \n"" +
             "" void main()\n"" +
             "" {\n"" +
-            ""     vec4 textureColor = texture2D(inputImageTexture, textureCoordinate);\n"" +
-            ""     vec4 textureColor2 = texture2D(inputImageTexture2, textureCoordinate2);\n"" +
+            ""   highp vec4 baseColor = texture2D(inputImageTexture, textureCoordinate);\n"" +
+            ""   highp vec4 overlayColor = texture2D(inputImageTexture2, textureCoordinate2);\n"" +
             ""\n"" +
-            ""     float maskY = 0.2989 * colorToReplace.r + 0.5866 * colorToReplace.g + 0.1145 * colorToReplace.b;\n"" +
-            ""     float maskCr = 0.7132 * (colorToReplace.r - maskY);\n"" +
-            ""     float maskCb = 0.5647 * (colorToReplace.b - maskY);\n"" +
-            ""     \n"" +
-            ""     float Y = 0.2989 * textureColor.r + 0.5866 * textureColor.g + 0.1145 * textureColor.b;\n"" +
-            ""     float Cr = 0.7132 * (textureColor.r - Y);\n"" +
-            ""     float Cb = 0.5647 * (textureColor.b - Y);\n"" +
-            ""     \n"" +
-            ""     float blendValue = 1.0 - smoothstep(thresholdSensitivity, thresholdSensitivity + smoothing, distance(vec2(Cr, Cb), vec2(maskCr, maskCb)));\n"" +
-            ""     gl_FragColor = mix(textureColor, textureColor2, blendValue);\n"" +
+            ""     gl_FragColor = vec4(baseColor.rgb * (1.0 - overlayColor.a) + setlum(overlayColor.rgb, lum(baseColor.rgb)) * overlayColor.a, baseColor.a);\n"" +
             "" }"";
 
     private int mThresholdSensitivityLocation;",1
"When uploading an asset, if a filename collision is detected, the new generated name is not correct","         int count = 0;
         while (newAsset != null) {
             count++;
-            
-            //try the new format first, then the old
-            newAsset = staticAssetDao.readStaticAssetByFullUrl(getCountUrl(fullUrl, count, false), null);
-            if (newAsset == null) {
-                newAsset = staticAssetDao.readStaticAssetByFullUrl(getCountUrl(fullUrl, count, true), null);
-            }
+            newAsset = staticAssetDao.readStaticAssetByFullUrl(fullUrl + ""-"" + count, null);
         }
 
         if (count > 0) {
-            fullUrl = getCountUrl(fullUrl, count, false);
+            fullUrl = fullUrl + ""-"" + count;
         }
 
         try {
@@ -225,30 +220,6 @@
         return staticAssetDao.addOrUpdateStaticAsset(newAsset, false);
     }
 
-    /**
-     * Gets the count URL based on the original fullUrl. If requested in legacy format this will return URLs like:
-     * 
-     *  /path/to/image.jpg-1
-     *  /path/to/image.jpg-2
-     *  
-     * Whereas if this is in non-lagacy format (<b>legacy</b> == false):
-     * 
-     *  /path/to/image-1.jpg
-     *  /path/to/image-2.jpg
-     *  
-     * Used to deal with duplicate URLs of uploaded assets
-     *  
-     */
-    protected String getCountUrl(String fullUrl, int count, boolean legacyFormat) {
-        String countUrl = fullUrl + '-' + count;
-        int dotIndex = fullUrl.lastIndexOf('.');
-        if (dotIndex != -1 && !legacyFormat) {
-            countUrl = fullUrl.substring(0, dotIndex) + '-' + count + '.' + fullUrl.substring(dotIndex + 1);
-        }
-        
-        return countUrl;
-    }
-
     protected void getMimeType(MultipartFile file, StaticAsset newAsset) {
         Collection mimeTypes = MimeUtil.getMimeTypes(file.getOriginalFilename());
         if (!mimeTypes.isEmpty()) {",1
[HOTFIX][StackedEnsemble] Do not show StackedEnsemble model builder i…,"     };
   }
 
-  @Override public BuilderVisibility builderVisibility() { return BuilderVisibility.Experimental; }
-
   @Override protected StackedEnsembleDriver trainModelImpl() { return _driver = new StackedEnsembleDriver(); }
 
   public static void addModelPredictionsToLevelOneFrame(Model aModel, Frame aModelsPredictions, Frame levelOneFrame) {",1
Fix for TexturePacker2," 					int imageHeight = image.getHeight();
 					// Copy corner pixels to fill corners of the padding.
 					g.drawImage(image, rectX - amountX, rectY - amountY, rectX, rectY, 0, 0, 1, 1, null);
-					g.drawImage(image, rectX + imageWidth, rectY - amountY, rectX + imageWidth + amountX, rectY, imageWidth - 1, 0, imageWidth, 1, null);
-					g.drawImage(image, rectX - amountX, rectY + imageHeight, rectX, rectY + imageHeight + amountY, 0, imageHeight - 1, 1, imageHeight, null);
+					g.drawImage(image, rectX + imageWidth, rectY - amountY, rectX + imageWidth + amountX, rectY, 0, 0, 1, 1, null);
+					g.drawImage(image, rectX - amountX, rectY + imageHeight, rectX, rectY + imageHeight + amountY, 0, 0, 1, 1, null);
 					g.drawImage(image, rectX + imageWidth, rectY + imageHeight, rectX + imageWidth + amountX, rectY + imageHeight
-						+ amountY, imageWidth - 1, imageHeight - 1, imageWidth, imageHeight, null);
+						+ amountY, 0, 0, 1, 1, null);
 					// Copy edge pixels into padding.
 					g.drawImage(image, rectX, rectY - amountY, rectX + imageWidth, rectY, 0, 0, imageWidth, 1, null);
 					g.drawImage(image, rectX, rectY + imageHeight, rectX + imageWidth, rectY + imageHeight + amountY, 0,",1
node v4.0.0 download path fix,"     public String getNodeDownloadFilename(String nodeVersion) {
         if(isWindows()) {
             if(architecture == Architecture.x64){
-                if (nodeVersion.startsWith(""v0."")) {
+                if (nodeVersion == ""v4.0.0"") {
+                    return nodeVersion+""/win-x64/node.exe"";    
+                } else {
                     return nodeVersion+""/x64/node.exe"";
-                } else {
-                    return nodeVersion+""/win-x64/node.exe"";
                 }
             } else {
-                if (nodeVersion.startsWith(""v0."")) {
+                if (nodeVersion == ""v4.0.0"") {
+                    return nodeVersion+""/win-x86/node.exe"";    
+                } else {
                     return nodeVersion + ""/node.exe"";
-                } else {
-                    return nodeVersion+""/win-x86/node.exe"";
                 }
             }
         } else {",1
Fix RuntimeException when an AZ is missing,"                     }
                     UsageType usageType = getUsageType(offer.getInstanceType(), offer.getProductDescription());
                     // Unknown Zone
-                    if (Zone.getZone(offer.getAvailabilityZone()) == null) {
+                    if (Zone.getZone(offer.getAvailabilityZone()) == null) 
                         logger.error(""No Zone for "" + offer.getAvailabilityZone());
-                    } else {
                     hasNewPrice = setPrice(utilization, currentTime, Zone.getZone(offer.getAvailabilityZone()).region, usageType,
                             offer.getFixedPrice(), hourly) || hasNewPrice;
 
                     logger.info(""Setting RI price for "" + Zone.getZone(offer.getAvailabilityZone()).region + "" "" + utilization + "" "" + usageType + "" "" + offer.getFixedPrice() + "" "" + hourly);
                 }
-                }
             } while (!StringUtils.isEmpty(token));
         }
 ",1
achievement diary plugin: Fix Abyssal demon req," 		add(""Craft a Black dragonhide body in Canifis bank."",
 			new Requirement(Skill.CRAFTING, 84));
 		add(""Kill an Abyssal demon in the Slayer Tower."",
-			new Requirement(Skill.SLAYER, 85));
+			new Requirement(Skill.SLAYER, 61));
 		add(""Loot the Barrows chest while wearing any complete barrows set."",
 			new Requirement(Skill.DEFENCE, 70),
 			new Requirement(Skill.ATTACK, 70,",1
changed mSelectedItemIdentifier to long to FIX #1270,"     }
 
     // item to select
-    protected long mSelectedItemIdentifier = 0;
+    protected int mSelectedItemIdentifier = 0;
 
     /**
      * Set this to the identifier of the item, you would love to select upon start
@@ -822,7 +822,7 @@
      * @param selectedItemIdentifier
      * @return
      */
-    public DrawerBuilder withSelectedItem(long selectedItemIdentifier) {
+    public DrawerBuilder withSelectedItem(int selectedItemIdentifier) {
         this.mSelectedItemIdentifier = selectedItemIdentifier;
         return this;
     }
@@ -1657,7 +1657,7 @@
         }
 
         //predefine selection (should be the first element
-        if (mSelectedItemPosition == 0 && mSelectedItemIdentifier != 0L) {
+        if (mSelectedItemPosition == 0 && mSelectedItemIdentifier != 0) {
             mSelectedItemPosition = DrawerUtils.getPositionByIdentifier(this, mSelectedItemIdentifier);
         }
         if (mHeaderView != null && mSelectedItemPosition == 0) {",1
Fixed : Time remains paused even when the back button is clicked in the pause menu.," import org.terasology.crashreporter.CrashReporter;
 import org.terasology.engine.GameEngine;
 import org.terasology.engine.LoggingContext;
-import org.terasology.engine.Time;
 import org.terasology.engine.modes.StateMainMenu;
-import org.terasology.network.NetworkMode;
-import org.terasology.network.NetworkSystem;
 import org.terasology.registry.CoreRegistry;
-import org.terasology.registry.In;
 import org.terasology.rendering.nui.CoreScreenLayer;
 import org.terasology.rendering.nui.WidgetUtil;
 import org.terasology.telemetry.TelemetryScreen;
@@ -32,12 +28,6 @@
  */
 public class PauseMenu extends CoreScreenLayer {
 
-    @In
-    private Time time;
-
-    @In
-    private NetworkSystem networkSystem;
-
     @Override
     public void initialise() {
         WidgetUtil.trySubscribe(this, ""close"", widget -> getManager().closeScreen(PauseMenu.this));
@@ -54,10 +44,4 @@
         getManager().removeOverlay( ""engine:onlinePlayersOverlay"" );
     }
 
-    @Override
-    public void onClosed() {
-        if (networkSystem.getMode() == NetworkMode.NONE) {
-            time.setPaused(false);
-        }
-    }
 }",1
Fix incorrect transaction size shown for bonding,"                                     duration,
                                     formatter.formatCoinWithCode(miningFee),
                                     CoinUtil.getFeePerByte(miningFee, txSize),
-                                    txSize / 1000d
+                                    txSize
                             ))
                             .actionButtonText(Res.get(""shared.yes""))
                             .onAction(() -> publishLockupTx(lockupAmount, lockupTime, lockupReason, hash, resultHandler))
@@ -180,7 +180,7 @@
                                     duration,
                                     formatter.formatCoinWithCode(miningFee),
                                     CoinUtil.getFeePerByte(miningFee, txSize),
-                                    txSize / 1000d
+                                    txSize
                             ))
                             .actionButtonText(Res.get(""shared.yes""))
                             .onAction(() -> publishUnlockTx(lockupTxId, resultHandler))",1
[#383] Trying to fix undeliverable exception when disposing MTU watcher.," package com.polidea.rxandroidble2.internal.connection;
 
 
-import com.polidea.rxandroidble2.exceptions.BleGattException;
-import com.polidea.rxandroidble2.exceptions.BleGattOperationType;
-import com.polidea.rxandroidble2.internal.RxBleLog;
-
 import bleshadow.javax.inject.Inject;
 import bleshadow.javax.inject.Named;
+
 import io.reactivex.Observable;
+import io.reactivex.disposables.SerialDisposable;
 import io.reactivex.functions.Consumer;
-import io.reactivex.functions.Predicate;
 
 @ConnectionScope
 class MtuWatcher implements ConnectionSubscriptionWatcher, MtuProvider, Consumer<Integer> {
 
     private Integer currentMtu;
     private final Observable<Integer> mtuObservable;
+    private final SerialDisposable serialSubscription = new SerialDisposable();
 
     @Inject
     MtuWatcher(
             final RxBleGattCallback rxBleGattCallback,
             @Named(ConnectionComponent.NamedInts.GATT_MTU_MINIMUM) final int initialValue
     ) {
-        this.mtuObservable = rxBleGattCallback.getOnMtuChanged()
-                .retry(new Predicate<Throwable>() {
-                    @Override
-                    public boolean test(Throwable throwable) throws Exception {
-                        return throwable instanceof BleGattException
-                                && ((BleGattException) throwable).getBleGattOperationType() == BleGattOperationType.ON_MTU_CHANGED;
-                    }
-                });
+        this.mtuObservable = rxBleGattCallback.getOnMtuChanged().retry();
         this.currentMtu = initialValue;
     }
 
@@ -40,17 +31,12 @@
 
     @Override
     public void onConnectionSubscribed() {
-        mtuObservable.subscribe(this, new Consumer<Throwable>() {
-            @Override
-            public void accept(Throwable throwable) throws Exception {
-                RxBleLog.d(throwable, ""An error received when listening to MTU changes."");
-            }
-        });
+        serialSubscription.set(mtuObservable.subscribe(this));
     }
 
     @Override
     public void onConnectionUnsubscribed() {
-        // Not required
+        serialSubscription.dispose();
     }
 
     @Override",1
Prevent overlays from moving off-screen," 
 import com.google.common.base.MoreObjects;
 import com.google.common.eventbus.Subscribe;
-import com.google.common.primitives.Ints;
 import java.awt.Color;
 import java.awt.Dimension;
 import java.awt.Graphics2D;
@@ -192,13 +191,12 @@
 
 					if (preferredLocation != null)
 					{
-						location.setLocation(preferredLocation);
-					}
-				}
-
 						final Dimension realDimensions = client.getRealDimensions();
-				location.x = Ints.constrainToRange(location.x, 0, realDimensions.width - dimension.width);
-				location.y = Ints.constrainToRange(location.y, 0, realDimensions.height - dimension.height);
+						final int x = Math.min(realDimensions.width - 5, preferredLocation.x);
+						final int y = Math.min(realDimensions.height - 5, preferredLocation.y);
+						location.setLocation(x, y);
+					}
+				}
 
 				if (overlay.getPreferredSize() != null)
 				{
@@ -286,10 +284,7 @@
 
 		if (movedOverlay != null)
 		{
-			final Dimension realDimension = client.getRealDimensions();
 			mousePoint.translate(-overlayOffset.x, -overlayOffset.y);
-			mousePoint.x = Ints.constrainToRange(mousePoint.x, 0, realDimension.width - movedOverlay.getBounds().width);
-			mousePoint.y = Ints.constrainToRange(mousePoint.y, 0, realDimension.height - movedOverlay.getBounds().height);
 			movedOverlay.setPreferredPosition(null);
 			movedOverlay.setPreferredLocation(mousePoint);
 			mouseEvent.consume();",1
1.x: fix reset() shutting down everything other than the schedulers,"             if (INSTANCE.compareAndSet(null, current)) {
                 return current;
             } else {
-                current.shutdownInstance();
+                shutdown();
             }
         }
     }
@@ -168,10 +168,8 @@
      */
     @Experimental
     public static void reset() {
-        Schedulers s = INSTANCE.getAndSet(null);
-        if (s != null) {
-            s.shutdownInstance();
-        }
+        shutdown();
+        INSTANCE.set(null);
     }
     
     /**
@@ -180,10 +178,16 @@
      */
     /* public test only */ static void start() {
         Schedulers s = getInstance();
-        
-        s.startInstance();
-        
         synchronized (s) {
+            if (s.computationScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.computationScheduler).start();
+            }
+            if (s.ioScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.ioScheduler).start();
+            }
+            if (s.newThreadScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.newThreadScheduler).start();
+            }
             GenericScheduledExecutorService.INSTANCE.start();
             
             RxRingBuffer.SPSC_POOL.start();
@@ -197,9 +201,17 @@
      */
     public static void shutdown() {
         Schedulers s = getInstance();
-        s.shutdownInstance();
+        synchronized (s) {
+            if (s.computationScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.computationScheduler).shutdown();
+            }
+            if (s.ioScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.ioScheduler).shutdown();
+            }
+            if (s.newThreadScheduler instanceof SchedulerLifecycle) {
+                ((SchedulerLifecycle) s.newThreadScheduler).shutdown();
+            }
 
-        synchronized (s) {
             GenericScheduledExecutorService.INSTANCE.shutdown();
 
             RxRingBuffer.SPSC_POOL.shutdown();
@@ -207,34 +219,4 @@
             RxRingBuffer.SPMC_POOL.shutdown();
         }
     }
-    
-    /**
-     * Start the instance-specific schedulers.
-     */
-    synchronized void startInstance() {
-        if (computationScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) computationScheduler).start();
-        }
-        if (ioScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) ioScheduler).start();
-        }
-        if (newThreadScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) newThreadScheduler).start();
-        }
-    }
-    
-    /**
-     * Start the instance-specific schedulers.
-     */
-    synchronized void shutdownInstance() {
-        if (computationScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) computationScheduler).shutdown();
-        }
-        if (ioScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) ioScheduler).shutdown();
-        }
-        if (newThreadScheduler instanceof SchedulerLifecycle) {
-            ((SchedulerLifecycle) newThreadScheduler).shutdown();
-        }
-    }
 }",1
fix mobile retina profile banner URL," 
     @Override
     public String getProfileBannerMobileRetinaURL() {
-        return profileBannerImageUrl != null ? profileBannerImageUrl + ""/mobile_retina"" : null;
+        return profileBannerImageUrl != null ? profileBannerImageUrl + ""/ipad_retina"" : null;
     }
 
     /**",1
Fixed archived search facet ranges not being filtered out,"  */
 package org.broadleafcommerce.core.search.dao;
 
+import org.broadleafcommerce.common.persistence.ArchiveStatus;
 import org.broadleafcommerce.common.persistence.EntityConfiguration;
-import org.broadleafcommerce.common.persistence.Status;
 import org.broadleafcommerce.core.catalog.domain.ProductImpl;
 import org.broadleafcommerce.core.catalog.domain.Sku;
 import org.broadleafcommerce.core.search.domain.Field;
@@ -146,8 +146,9 @@
         Root<SearchFacetRangeImpl> ranges = criteria.from(SearchFacetRangeImpl.class);
         criteria.select(ranges);
         Predicate facetRestriction = builder.equal(ranges.get(""searchFacet""), searchFacet);
-
-        if (isSearchFacetRangeArchivable()) {
+        // ArchiveStatus could have been dynamically weaved onto SearchFacet, this query will fail
+        // if it hadn't
+        if (ArchiveStatus.class.isAssignableFrom(SearchFacetRangeImpl.class)) {
             criteria.where(
                     builder.and(
                         facetRestriction,
@@ -169,8 +170,4 @@
             return new ArrayList<>();
         }
     }
-    
-    protected boolean isSearchFacetRangeArchivable() {
-        return Status.class.isAssignableFrom(SearchFacetRangeImpl.class);
-    }
 }",1
Save listener ref only if needed,"    * request for permission process.
    */
   void continuePendingRequestsIfPossible(MultiplePermissionsListener listener) {
-    if (!pendingPermissions.isEmpty()) {
+    boolean isShowingRationale = !pendingPermissions.isEmpty() && !rationaleAccepted.get();
     this.listener = listener;
-      if (!rationaleAccepted.get()) {
+    if (isShowingRationale) {
       onActivityReady(activity);
     }
   }
-  }
 
   /**
    * Method called whenever the inner activity has been created or restarted and is ready to be",1
[1.12] Add a FluidUtil method to interact with an arbitrary IFluidHandler,"      */
     public static boolean interactWithFluidHandler(@Nonnull EntityPlayer player, @Nonnull EnumHand hand, @Nonnull World world, @Nonnull BlockPos pos, @Nullable EnumFacing side)
     {
+        Preconditions.checkNotNull(player);
+        Preconditions.checkNotNull(hand);
         Preconditions.checkNotNull(world);
         Preconditions.checkNotNull(pos);
 
-        IFluidHandler blockFluidHandler = getFluidHandler(world, pos, side);
-        return blockFluidHandler != null && interactWithFluidHandler(player, hand, blockFluidHandler);
-    }
-
-    /**
-     * Used to handle the common case of a player holding a fluid item and right-clicking on a fluid handler.
-     * First it tries to fill the item from the handler,
-     * if that action fails then it tries to drain the item into the handler.
-     * Automatically updates the item in the player's hand and stashes any extra items created.
-     *
-     * @param player  The player doing the interaction between the item and fluid handler.
-     * @param hand    The player's hand that is holding an item that should interact with the fluid handler.
-     * @param handler The fluid handler.
-     * @return true if the interaction succeeded and updated the item held by the player, false otherwise.
-     */
-    public static boolean interactWithFluidHandler(@Nonnull EntityPlayer player, @Nonnull EnumHand hand, @Nonnull IFluidHandler handler)
-    {
-        Preconditions.checkNotNull(player);
-        Preconditions.checkNotNull(hand);
-        Preconditions.checkNotNull(handler);
-
         ItemStack heldItem = player.getHeldItem(hand);
         if (!heldItem.isEmpty())
         {
+            IFluidHandler blockFluidHandler = getFluidHandler(world, pos, side);
+            if (blockFluidHandler != null)
+            {
                 IItemHandler playerInventory = player.getCapability(CapabilityItemHandler.ITEM_HANDLER_CAPABILITY, null);
                 if (playerInventory != null)
                 {
-                FluidActionResult fluidActionResult = tryFillContainerAndStow(heldItem, handler, playerInventory, Integer.MAX_VALUE, player);
+                    FluidActionResult fluidActionResult = tryFillContainerAndStow(heldItem, blockFluidHandler, playerInventory, Integer.MAX_VALUE, player);
                     if (!fluidActionResult.isSuccess())
                     {
-                    fluidActionResult = tryEmptyContainerAndStow(heldItem, handler, playerInventory, Integer.MAX_VALUE, player);
+                        fluidActionResult = tryEmptyContainerAndStow(heldItem, blockFluidHandler, playerInventory, Integer.MAX_VALUE, player);
                     }
 
                     if (fluidActionResult.isSuccess())
@@ -114,6 +98,7 @@
                     }
                 }
             }
+        }
         return false;
     }
 ",1
Fix configuration url,"     protected final void ensureAuthorizationEnabled() {
         if (!auth.isEnabled()) {
             throw new IllegalStateException(
-                    ""Authentication credentials are missing. See http://twitter4j.org/en/configuration.html for the detail."");
+                    ""Authentication credentials are missing. See http://twitter4j.org/configuration.html for the detail."");
         }
     }
 
     protected final void ensureOAuthEnabled() {
         if (!(auth instanceof OAuthAuthorization)) {
             throw new IllegalStateException(
-                    ""OAuth required. Authentication credentials are missing. See http://twitter4j.org/en/configuration.html for the detail."");
+                    ""OAuth required. Authentication credentials are missing. See http://twitter4j.org/configuration.html for the detail."");
         }
     }
 ",1
Fix loading for individual .class files,"                                             final ClassNode cn = JarUtils.getNode(bytes);
 
                                             FileContainer container = new FileContainer(f);
-                                            container.files.put(cn.name + "".class"", bytes);
+                                            container.files.put(fn, bytes);
                                             container.add(cn);
                                             BytecodeViewer.files.add(container);
                                         } else {",1
Non-discrete order item attributes and child items are not copied over when creating an item request from an existing order item," package org.broadleafcommerce.core.order.service;
 
 import org.apache.commons.collections.MapUtils;
-import org.apache.commons.collections4.CollectionUtils;
 import org.broadleafcommerce.core.catalog.domain.Category;
 import org.broadleafcommerce.core.catalog.domain.Product;
 import org.broadleafcommerce.core.catalog.domain.ProductBundle;
@@ -29,6 +28,7 @@
 import org.broadleafcommerce.core.catalog.service.CatalogService;
 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPrices;
 import org.broadleafcommerce.core.catalog.service.dynamic.DynamicSkuPricingService;
+import org.broadleafcommerce.core.catalog.service.dynamic.SkuPricingConsiderationContext;
 import org.broadleafcommerce.core.order.dao.OrderItemDao;
 import org.broadleafcommerce.core.order.domain.BundleOrderItem;
 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;
@@ -437,6 +437,7 @@
         if (item instanceof DiscreteOrderItem) {
             DiscreteOrderItem doi = (DiscreteOrderItem) item;
             orderItemRequest = new OrderItemRequestDTO();
+            orderItemRequest.setQuantity(doi.getQuantity());
             
             if (doi.getCategory() != null) {
                 orderItemRequest.setCategoryId(doi.getCategory().getId());
@@ -450,9 +451,9 @@
                 orderItemRequest.setSkuId(doi.getSku().getId());
             }
             
-            if (doi.getAdditionalAttributes() != null) {
-                for (Entry<String, String> entry : doi.getAdditionalAttributes().entrySet()) {
-                    orderItemRequest.getAdditionalAttributes().put(entry.getKey(), entry.getValue());
+            if (doi.getOrderItemAttributes() != null) {
+                for (Entry<String, OrderItemAttribute> entry : item.getOrderItemAttributes().entrySet()) {
+                    orderItemRequest.getItemAttributes().put(entry.getKey(), entry.getValue().getValue());
                 }
             }
         } else {
@@ -460,23 +461,11 @@
             NonDiscreteOrderItemRequestDTO ndr = (NonDiscreteOrderItemRequestDTO) orderItemRequest;
             
             ndr.setItemName(item.getName());
+            ndr.setQuantity(item.getQuantity());
             ndr.setOverrideRetailPrice(item.getRetailPrice());
             ndr.setOverrideSalePrice(item.getSalePrice());
         }
         
-        orderItemRequest.setQuantity(item.getQuantity());
-        if (item.getOrderItemAttributes() != null) {
-            for (Entry<String, OrderItemAttribute> entry : item.getOrderItemAttributes().entrySet()) {
-                orderItemRequest.getItemAttributes().put(entry.getKey(), entry.getValue().getValue());
-            }
-        }
-
-        if (CollectionUtils.isNotEmpty(item.getChildOrderItems())) {
-            for (OrderItem childItem : item.getChildOrderItems()) {
-                orderItemRequest.getChildOrderItems().add(buildOrderItemRequestDTOFromOrderItem(childItem));
-            }
-        }
-
         return orderItemRequest;
     }
 
@@ -616,7 +605,6 @@
         extensionManager.getProxy().mergeOrderItemRequest(itemRequest, orderItem);
     }
 
-    @Override
     public List<OrderItem> findOrderItemsForCustomersInDateRange(List<Long> customerIds, Date startDate, Date endDate) {
         return orderItemDao.readOrderItemsForCustomersInDateRange(customerIds, startDate, endDate);
     }",1
Fixes #492 - Camera bob on death,"         CharacterMovementComponent characterMovementComponent = entity.getComponent(CharacterMovementComponent.class);
         LocationComponent location = entity.getComponent(LocationComponent.class);
 
+        if (localPlayerComponent.isDead) {
+            return;
+        }
+
         updateMovement(localPlayerComponent, characterMovementComponent, location);
 
         // TODO: Remove, use component camera, breaks spawn camera anyway
         Quat4f lookRotation = new Quat4f();
         QuaternionUtil.setEuler(lookRotation, TeraMath.DEG_TO_RAD * localPlayerComponent.viewYaw, TeraMath.DEG_TO_RAD * localPlayerComponent.viewPitch, 0);
-        updateCamera(characterMovementComponent, location.getWorldPosition(), lookRotation, entity);
+        updateCamera(characterMovementComponent, location.getWorldPosition(), lookRotation);
 
         // Hand animation update
         localPlayerComponent.handAnimation = Math.max(0, localPlayerComponent.handAnimation - 2.5f * delta);
@@ -328,9 +332,8 @@
         characterMovementComponent.setDrive(relMove);
     }
 
-
-    @ReceiveEvent(components = {LocalPlayerComponent.class})
-    private void updateCamera(CharacterMovementComponent charMovementComp, Vector3f position, Quat4f rotation, EntityRef entity) {        // The camera position is the player's position plus the eye offset
+    private void updateCamera(CharacterMovementComponent charMovementComp, Vector3f position, Quat4f rotation) {
+        // The camera position is the player's position plus the eye offset
         Vector3d cameraPosition = new Vector3d();
         // TODO: don't hardset eye position
         cameraPosition.add(new Vector3d(position), new Vector3d(0, 0.6f, 0));
@@ -344,8 +347,7 @@
         bobFactor += stepDelta;
         lastStepDelta = charMovementComp.footstepDelta;
 
-        LocalPlayerComponent localPlayerComponent = entity.getComponent(LocalPlayerComponent.class);
-        if ((playerCamera.getClass() == PerspectiveCamera.class)&& !(localPlayerComponent.isDead)) {
+        if (playerCamera.getClass() == PerspectiveCamera.class) {
             if (config.getRendering().isCameraBobbing()) {
                 ((PerspectiveCamera) playerCamera).setBobbingRotationOffsetFactor(calcBobbingOffset(0.0f, 0.01f, 2.5f));
                 ((PerspectiveCamera) playerCamera).setBobbingVerticalOffsetFactor(calcBobbingOffset((float) java.lang.Math.PI / 4f, 0.025f, 3f));",1
Fix comment issues.," 
 /**
  * Defines an object which represents the three dimensional plane and how a device can be rotated
- * about it. Each of the axes is in positive degrees on the real number scale (0 &lt;= deg &lt;=
+ * about it. Each of the axis is in positive degrees on the real number scale (0 &lt;= deg &lt;=
  * 360).
  *
- * <p>Example instantiation to rotate device to ""Landscape Right"": DeviceRotation(0, 0, 90);
+ * <p>Example Instantiation to rotate device to ""Landscape Right"": DeviceRotation(0, 0, 90);
  */
 public class DeviceRotation {
-  // The default orientation is portrait.
+  //Default orientation is portrait
   private int x = 0;
   private int y = 0;
   private int z = 0;
@@ -46,7 +46,7 @@
   }
 
   /**
-   * Instantiate a DeviceRotation object based on a HashMap object where the keys are the axes x, y,
+   * Instantiate a DeviceRotation object based on a HashMap object where the keys are the axis x, y,
    * and z respectively: x : xVal y : yVal z : zVal
    */
   public DeviceRotation(Map<String, Number> map) {
@@ -75,22 +75,22 @@
     }
   }
 
-  /** @return The x. */
+  /** @return the x */
   public int getX() {
     return x;
   }
 
-  /** @return The y. */
+  /** @return the y */
   public int getY() {
     return y;
   }
 
-  /** @return The z. */
+  /** @return the z */
   public int getZ() {
     return z;
   }
 
-  /** @return All axes mapped to a Map. */
+  /** @return returns all axis mapped to a Map */
   public Map<String, Integer> parameters() {
     HashMap<String, Integer> values = new HashMap<>();
     values.put(""x"", this.x);",1
Up button appearance bug fix,"     super.onResume();
     if (!mIsDemoMode) {
       getActivity().getActionBar().setTitle(R.string.title_nearby_beacons);
-      getActivity().getActionBar().setDisplayHomeAsUpEnabled(false);
       startScanning();
     } else {
       getActivity().getActionBar().setTitle(R.string.title_nearby_beacons_demo);",1
Fixed ClassCastException in AndroidScanner #1474," 
 import android.content.Context;
 import dalvik.system.DexFile;
+import dalvik.system.PathClassLoader;
 import org.flywaydb.core.api.FlywayException;
 import org.flywaydb.core.api.android.ContextHolder;
 import org.flywaydb.core.internal.util.ClassUtils;
@@ -39,10 +40,10 @@
 
     private final Context context;
 
-    private final ClassLoader classLoader;
+    private final PathClassLoader classLoader;
 
     public AndroidScanner(ClassLoader classLoader) {
-        this.classLoader = classLoader;
+        this.classLoader = (PathClassLoader) classLoader;
         context = ContextHolder.getContext();
         if (context == null) {
             throw new FlywayException(""Unable to scan for Migrations! Context not set. "" +",1
Fixed record type truncation in generated externs," 
 package com.google.javascript.rhino.jstype;
 
-import com.google.common.base.Function;
 import com.google.common.base.Joiner;
 import com.google.common.base.Preconditions;
 import com.google.common.collect.ImmutableList;
-import com.google.common.collect.Lists;
 
 /**
  * An object type with declared template types, such as
@@ -76,17 +74,11 @@
   }
 
   @Override
-  String toStringHelper(final boolean forAnnotations) {
+  String toStringHelper(boolean forAnnotations) {
     String typeString = super.toStringHelper(forAnnotations);
 
     if (!templateTypes.isEmpty()) {
-      typeString += ""<""
-          + Joiner.on("","").join(Lists.transform(templateTypes, new Function<JSType, String>() {
-            @Override
-            public String apply(JSType type) {
-              return type.toStringHelper(forAnnotations);
-            }
-          })) + "">"";
+      typeString += ""<"" + Joiner.on("","").join(templateTypes) + "">"";
     }
 
     return typeString;",1
Back compatibility problem fix.,"   public static final String                DEFAULT_TIMEZONE = ""UTC"";
   public static final String                DEFAULT_CHARSET  = ""UTF-8"";
 
-  public static final int                   CURRENT_VERSION  = 5;
+  public static final int                   CURRENT_VERSION  = 4;
 
   public int                                version          = -1;
   public String                             name;
@@ -205,12 +205,7 @@
         phyClusterLocal.name = clusterName;
         index = phySegmentFromStream(values, index, phyClusterLocal);
 
-        final String holeFlag;
-        if (version > 4) {
-          holeFlag = read(values[index++]);
-        } else {
-          holeFlag = ""f"";
-        }
+        String holeFlag = read(values[index++]);
         if (holeFlag.equals(""f""))
           phyClusterLocal.setHoleFile(new OStorageClusterHoleConfiguration(phyClusterLocal, read(values[index++]),
               read(values[index++]), read(values[index++])));",1
Fix crash when rapidly adding/removing SharedPreferences keys," 
 import android.content.Context;
 import android.content.SharedPreferences;
-import com.facebook.stetho.common.LogUtil;
 import com.facebook.stetho.inspector.console.CLog;
 import com.facebook.stetho.inspector.helper.ChromePeerManager;
 import com.facebook.stetho.inspector.helper.PeerRegistrationListener;
@@ -143,9 +142,7 @@
             SharedPreferencesHelper.valueToString(newValue));
         mCopy.put(key, newValue);
       } else {
-        // This can happen due to the async nature of the onSharedPreferenceChanged callback.  A
-        // rapid put/remove as two separate commits on a background thread would cause this.
-        LogUtil.i(""Detected rapid put/remove of %s"", key);
+        throw new RuntimeException(""Prefs change detected for unknown key="" + key);
       }
     }
   }",1
[BACKLOG-15535] - Fixed issue where optional injection fields were be…,"  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2017 by Pentaho : http://www.pentaho.com
+ * Copyright (C) 2002-2016 by Pentaho : http://www.pentaho.com
  *
  *******************************************************************************
  *
@@ -239,8 +239,8 @@
         String coll = Const.NVL( XMLHandler.getTagValue( fnode, ""collator_enabled"" ), ""N"" );
         caseSensitive[i] = Utils.isEmpty( sens ) || ""Y"".equalsIgnoreCase( sens );
         collatorEnabled[i] = ""Y"".equalsIgnoreCase( coll );
-        collatorStrength[i] =
-            Integer.parseInt( Const.NVL( XMLHandler.getTagValue( fnode, ""collator_strength"" ), defaultStrength ) );
+        collatorStrength[i] = Integer.parseInt(
+          Const.NVL( XMLHandler.getTagValue( fnode, ""collator_strength"" ), defaultStrength ) );
         String presorted = XMLHandler.getTagValue( fnode, ""presorted"" );
         preSortedField[i] = ""Y"".equalsIgnoreCase( presorted );
       }
@@ -301,8 +301,7 @@
   }
 
   @Override
-  public void readRep( Repository rep, IMetaStore metaStore, ObjectId id_step, List<DatabaseMeta> databases )
-    throws KettleException {
+  public void readRep( Repository rep, IMetaStore metaStore, ObjectId id_step, List<DatabaseMeta> databases ) throws KettleException {
     try {
       directory = rep.getStepAttributeString( id_step, ""directory"" );
       prefix = rep.getStepAttributeString( id_step, ""prefix"" );
@@ -325,9 +324,8 @@
         ascending[i] = rep.getStepAttributeBoolean( id_step, i, ""field_ascending"" );
         caseSensitive[i] = rep.getStepAttributeBoolean( id_step, i, ""field_case_sensitive"", true );
         collatorEnabled[i] = rep.getStepAttributeBoolean( id_step, i, ""field_collator_enabled"", false );
-        collatorStrength[i] =
-            Integer.parseInt( Const.NVL( rep.getStepAttributeString( id_step, i, ""field_collator_strength"" ),
-                defaultStrength ) );
+        collatorStrength[i] = Integer.parseInt(
+            Const.NVL( rep.getStepAttributeString( id_step, i, ""field_collator_strength"" ), defaultStrength ) );
         preSortedField[i] = rep.getStepAttributeBoolean( id_step, i, ""field_presorted"", false );
       }
     } catch ( Exception e ) {
@@ -355,8 +353,7 @@
   }
 
   @Override
-  public void saveRep( Repository rep, IMetaStore metaStore, ObjectId id_transformation, ObjectId id_step )
-    throws KettleException {
+  public void saveRep( Repository rep, IMetaStore metaStore, ObjectId id_transformation, ObjectId id_step ) throws KettleException {
     try {
       rep.saveStepAttribute( id_transformation, id_step, ""directory"", directory );
       rep.saveStepAttribute( id_transformation, id_step, ""prefix"", prefix );
@@ -387,20 +384,10 @@
       int idx = inputRowMeta.indexOfValue( fieldName[i] );
       if ( idx >= 0 ) {
         ValueMetaInterface valueMeta = inputRowMeta.getValueMeta( idx );
-        // On all these valueMetas, check to see if the value actually exists before we try to
-        // set them.
-        if ( ascending.length > i ) {
         valueMeta.setSortedDescending( !ascending[i] );
-        }
-        if ( caseSensitive.length > i ) {
         valueMeta.setCaseInsensitive( !caseSensitive[i] );
-        }
-        if ( collatorEnabled.length > i ) {
         valueMeta.setCollatorDisabled( !collatorEnabled[i] );
-        }
-        if ( collatorStrength.length > i ) {
         valueMeta.setCollatorStrength( collatorStrength[i] );
-        }
         // Also see if lazy conversion is active on these key fields.
         // If so we want to automatically convert them to the normal storage type.
         // This will improve performance, see also: PDI-346
@@ -409,18 +396,19 @@
         valueMeta.setStorageMetadata( null );
       }
     }
+
   }
 
   @Override
-  public void check( List<CheckResultInterface> remarks, TransMeta transMeta, StepMeta stepMeta, RowMetaInterface prev,
-      String[] input, String[] output, RowMetaInterface info, VariableSpace space, Repository repository,
-      IMetaStore metaStore ) {
+  public void check( List<CheckResultInterface> remarks, TransMeta transMeta, StepMeta stepMeta,
+    RowMetaInterface prev, String[] input, String[] output, RowMetaInterface info, VariableSpace space,
+    Repository repository, IMetaStore metaStore ) {
     CheckResult cr;
 
     if ( prev != null && prev.size() > 0 ) {
       cr =
-          new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString( PKG,
-              ""SortRowsMeta.CheckResult.FieldsReceived"", """" + prev.size() ), stepMeta );
+        new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString(
+          PKG, ""SortRowsMeta.CheckResult.FieldsReceived"", """" + prev.size() ), stepMeta );
       remarks.add( cr );
 
       String error_message = """";
@@ -442,13 +430,13 @@
       } else {
         if ( fieldName.length > 0 ) {
           cr =
-              new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString( PKG,
-                  ""SortRowsMeta.CheckResult.AllSortKeysFound"" ), stepMeta );
+            new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString(
+              PKG, ""SortRowsMeta.CheckResult.AllSortKeysFound"" ), stepMeta );
           remarks.add( cr );
         } else {
           cr =
-              new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,
-                  ""SortRowsMeta.CheckResult.NoSortKeysEntered"" ), stepMeta );
+            new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString(
+              PKG, ""SortRowsMeta.CheckResult.NoSortKeysEntered"" ), stepMeta );
           remarks.add( cr );
         }
       }
@@ -460,45 +448,45 @@
       if ( f.exists() ) {
         if ( f.isDirectory() ) {
           cr =
-              new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString( PKG,
-                  ""SortRowsMeta.CheckResult.DirectoryExists"", realDirectory ), stepMeta );
+            new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString(
+              PKG, ""SortRowsMeta.CheckResult.DirectoryExists"", realDirectory ), stepMeta );
           remarks.add( cr );
         } else {
           cr =
-              new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,
-                  ""SortRowsMeta.CheckResult.ExistsButNoDirectory"", realDirectory ), stepMeta );
+            new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString(
+              PKG, ""SortRowsMeta.CheckResult.ExistsButNoDirectory"", realDirectory ), stepMeta );
           remarks.add( cr );
         }
       } else {
         cr =
-            new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,
-                ""SortRowsMeta.CheckResult.DirectoryNotExists"", realDirectory ), stepMeta );
+          new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString(
+            PKG, ""SortRowsMeta.CheckResult.DirectoryNotExists"", realDirectory ), stepMeta );
         remarks.add( cr );
       }
     } else {
       cr =
-          new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,
-              ""SortRowsMeta.CheckResult.NoFields"" ), stepMeta );
+        new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString(
+          PKG, ""SortRowsMeta.CheckResult.NoFields"" ), stepMeta );
       remarks.add( cr );
     }
 
     // See if we have input streams leading to this step!
     if ( input.length > 0 ) {
       cr =
-          new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString( PKG,
-              ""SortRowsMeta.CheckResult.ExpectedInputOk"" ), stepMeta );
+        new CheckResult( CheckResultInterface.TYPE_RESULT_OK, BaseMessages.getString(
+          PKG, ""SortRowsMeta.CheckResult.ExpectedInputOk"" ), stepMeta );
       remarks.add( cr );
     } else {
       cr =
-          new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString( PKG,
-              ""SortRowsMeta.CheckResult.ExpectedInputError"" ), stepMeta );
+        new CheckResult( CheckResultInterface.TYPE_RESULT_ERROR, BaseMessages.getString(
+          PKG, ""SortRowsMeta.CheckResult.ExpectedInputError"" ), stepMeta );
       remarks.add( cr );
     }
   }
 
   @Override
-  public StepInterface getStep( StepMeta stepMeta, StepDataInterface stepDataInterface, int cnr, TransMeta transMeta,
-      Trans trans ) {
+  public StepInterface getStep( StepMeta stepMeta, StepDataInterface stepDataInterface, int cnr,
+    TransMeta transMeta, Trans trans ) {
     return new SortRows( stepMeta, stepDataInterface, cnr, transMeta, trans );
   }
 ",1
Fixed typo and few sentences," package com.github.pedrovgs.problem8;
 
 /**
- * Given an array full of integers positive or negative, write a method to move every negative number
- * to the left and every positive number to the right. Take into account that the order of these
- * elements among the same group(positive or negative) into the array doesn't care.
+ * Given an array full of integers positive or negative write a method to move every negative number
+ * to the left and every positive number to the right. Take into account that the order of this
+ * elements into the array doesn't care.
  *
  * Input: [1,2,3,-1-,2,-3] Output: [-2,-1,-3,2,3,1]
  *
@@ -27,11 +27,12 @@
 public class SplitArray {
 
   /**
-   * The first solution implemented for this problem is based on the ""Bubble Sort Algorithm"".
+   * First solution implemented for this problem. It's is based on a sorting algorithm called
+   * ""Bubble Sorting Algorithm"".
    *
-   * The time complexity of this solution is O(N^2) where N is number of elements in the array. It is even worse
-   * than the bubble sort algorithm because to check if we have to swap between any pair of elements is really
-   * expensive. The space complexity of this algorithm is O(1) because we are not
+   * The complexity order in this O(N^2) where N is number of elements in the array. Is even worst
+   * than the bubble sorting algorithm because to check if we have to swap any element is really
+   * expensive. In space terms, the complexity order of this algorithm is O(1) because we are not
    * using any additional data structure.
    */
   public void splitSorting(int[] array) {
@@ -52,11 +53,11 @@
   }
 
   /**
-   * The second solution for this problem is much faster than the previous one. Here, instead of using a sorting
-   * algorithm we are going over the array from left to right using two pointers and swapping
-   * elements if needed. The time complexity of this algorithm is O(N) where N is the
-   * number of elements in the array. The space complexity is also O(1) because we are not using any additional
-   * data structure here as well.
+   * This solution for the problem is much faster than the previous one. Instead of use a sorting
+   * algorithm we are going to go over the array from left to right using two pointers and swapping
+   * elements if needed. The complexity order of this algorithm in time terms is O(N) where N is the
+   * number of elements in the array. In space terms is O(1) because we are not using any additional
+   * data structure.
    */
   public void splitSwappingIterative(int[] array) {
     if (array == null) {
@@ -83,7 +84,7 @@
   }
 
   /**
-   * Using partition Method of Quicksort to split the array.
+   * Using partition Method of quicksort to split array.
    * Its called Hoare's Partitioning Algorithm
    */
   public void splitSwappingPartition(int[] array) {
@@ -109,10 +110,10 @@
   }
 
   /**
-   * This is a tail recursive solution for this problem. This implementation has the same time complexity,
-   * O(N). Here, the only change is how we are going to iterate over the array; in the previous
-   * implementation we used a classic iterative approach whereas in this solution we are using
-   * recursion to iterate. In this case, the space complexity is also O(1) because we are not using any additional data
+   * Tail recursive solution for this problem. This implementation has the same complexity order
+   * O(N) and the only change is how we are going to iterate over the array, with the previous
+   * implementation we are using a classic iterative approach and with this solution we are using
+   * recursion to iterate. In space terms is O(1) because we are not using any additional data
    * structure.
    */
   public void splitSwappingRecursive(int[] array) {",1
Checkstyle fixes ...," 
 import java.util.List;
 
-import org.pentaho.di.core.CheckResult;
-import org.pentaho.di.core.CheckResultInterface;
-import org.pentaho.di.core.Const;
-import org.pentaho.di.core.KettleAttributeInterface;
-import org.pentaho.di.core.ProvidesDatabaseConnectionInformation;
-import org.pentaho.di.core.SQLStatement;
+import org.pentaho.di.core.*;
 import org.pentaho.di.core.database.Database;
 import org.pentaho.di.core.database.DatabaseMeta;
 import org.pentaho.di.core.exception.KettleException;
@@ -37,6 +32,7 @@
 import org.pentaho.di.core.exception.KettleXMLException;
 import org.pentaho.di.core.row.RowMeta;
 import org.pentaho.di.core.row.RowMetaInterface;
+import org.pentaho.di.core.row.ValueMeta;
 import org.pentaho.di.core.row.ValueMetaInterface;
 import org.pentaho.di.core.variables.VariableSpace;
 import org.pentaho.di.core.xml.XMLHandler;
@@ -47,13 +43,8 @@
 import org.pentaho.di.trans.DatabaseImpact;
 import org.pentaho.di.trans.Trans;
 import org.pentaho.di.trans.TransMeta;
-import org.pentaho.di.trans.step.BaseStepMeta;
-import org.pentaho.di.trans.step.StepDataInterface;
-import org.pentaho.di.trans.step.StepInjectionMetaEntry;
-import org.pentaho.di.trans.step.StepInterface;
-import org.pentaho.di.trans.step.StepMeta;
-import org.pentaho.di.trans.step.StepMetaInjectionInterface;
-import org.pentaho.di.trans.step.StepMetaInterface;
+import org.pentaho.di.trans.step.*;
+import org.pentaho.di.trans.steps.selectvalues.SelectMetadataChange;
 import org.pentaho.metastore.api.IMetaStore;
 import org.w3c.dom.Node;
 
@@ -63,8 +54,8 @@
  * @author Sven Boden (originally)
  */
 public class PGBulkLoaderMeta extends BaseStepMeta implements StepMetaInjectionInterface, StepMetaInterface,
+
   ProvidesDatabaseConnectionInformation {
-
   private static Class<?> PKG = PGBulkLoaderMeta.class; // for i18n purposes, needed by Translator2!!
 
   /** what's the schema for the target? */
@@ -698,6 +689,7 @@
   }
 
 
+
     public StepMetaInjectionInterface getStepMetaInjectionInterface() {
         return this;
     }
@@ -716,8 +708,6 @@
             // Set top level attributes...
             //
             if ( entry.getValueType() != ValueMetaInterface.TYPE_NONE ) {
-
-        logBasic( ""TODO"" );
             } else {
                 // The data sets...
                 //
@@ -753,8 +743,7 @@
                 }
                 if (!Const.isEmpty(getFieldStream())){
                     for (int i = 0; i < getFieldStream().length; i++) {
-            logDetailed( ""row "" + Integer.toString( i ) + "": stream="" + getFieldStream()[i]
-              + "" : table="" + getFieldTable()[i] );
+                        logDetailed(""row "" + Integer.toString(i) + "": stream="" + getFieldStream()[i] + "" : table="" + getFieldTable()[i] );
                     }
                 }
 
@@ -763,4 +752,12 @@
     }
 
 
+
+
+
+
+
+
+
+
 }",1
Emit StreamsChangedEvent and StreamDeletedEvent in BundleImporter," import com.google.common.base.Throwables;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableMap;
-import com.google.common.collect.ImmutableSet;
 import org.bson.types.ObjectId;
 import org.graylog2.dashboards.DashboardImpl;
 import org.graylog2.dashboards.DashboardService;
@@ -54,8 +53,6 @@
 import org.graylog2.streams.StreamRuleImpl;
 import org.graylog2.streams.StreamRuleService;
 import org.graylog2.streams.StreamService;
-import org.graylog2.streams.events.StreamDeletedEvent;
-import org.graylog2.streams.events.StreamsChangedEvent;
 import org.graylog2.timeranges.TimeRangeFactory;
 import org.joda.time.DateTime;
 import org.slf4j.Logger;
@@ -228,10 +225,8 @@
 
     private void deleteCreatedStreams() throws NotFoundException {
         for (Map.Entry<String, org.graylog2.plugin.streams.Stream> entry : createdStreams.entrySet()) {
-            final String streamId = entry.getKey();
-            LOG.debug(""Deleting stream {} from database"", streamId);
+            LOG.debug(""Deleting stream {} from database"", entry.getKey());
             streamService.destroy(entry.getValue());
-            clusterBus.post(streamId);
         }
     }
 
@@ -470,9 +465,6 @@
                 streamsByReferenceId.put(referenceId, stream);
             }
         }
-
-        final ImmutableSet<String> streamIds = ImmutableSet.copyOf(createdStreams.keySet());
-        clusterBus.post(StreamsChangedEvent.create(streamIds));
     }
 
     private org.graylog2.plugin.streams.Stream createStream(final String bundleId, final Stream streamDescription, final String userName)",1
Fixes #1042," 			Map<String, Integer> result = tokenTypeMapCache.get(vocabulary);
 			if (result == null) {
 				result = new HashMap<String, Integer>();
-				for (int i = 0; i <= getATN().maxTokenType; i++) {
+				for (int i = 0; i < getATN().maxTokenType; i++) {
 					String literalName = vocabulary.getLiteralName(i);
 					if (literalName != null) {
 						result.put(literalName, i);",1
Fixed #143," package org.schabi.newpipe;
 
-import android.Manifest;
-import android.app.Activity;
 import android.app.Dialog;
 import android.app.DownloadManager;
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.SharedPreferences;
-import android.content.pm.PackageManager;
 import android.net.Uri;
 import android.os.Bundle;
 import android.os.Environment;
 import android.preference.PreferenceManager;
 import android.support.annotation.NonNull;
-import android.support.v4.app.ActivityCompat;
 import android.support.v4.app.DialogFragment;
-import android.support.v4.content.ContextCompat;
 import android.support.v7.app.AlertDialog;
 import android.util.Log;
 
@@ -56,8 +51,6 @@
     public Dialog onCreateDialog(Bundle savedInstanceState) {
         arguments = getArguments();
         super.onCreateDialog(savedInstanceState);
-        if(ContextCompat.checkSelfPermission(this.getContext(),Manifest.permission.WRITE_EXTERNAL_STORAGE)!= PackageManager.PERMISSION_GRANTED)
-            ActivityCompat.requestPermissions(getActivity(),new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE},0);
         AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());
         builder.setTitle(R.string.download_dialog_title)
                 .setItems(R.array.download_options, new DialogInterface.OnClickListener() {",1
Fix NPE on extra beacon data tracker," 
     @Override
     public boolean onStartJob(final JobParameters jobParameters) {
-        initialzeScanHelper();
+        mScanHelper = new ScanHelper(this);
         if (jobParameters.getJobId() == IMMEDIATE_SCAN_JOB_ID) {
             LogManager.i(TAG, ""Running immediate scan job: instance is ""+this);
         }
@@ -164,8 +164,8 @@
         LogManager.d(TAG, ""Scanning stopped"");
     }
 
-    private void initialzeScanHelper() {
-        mScanHelper = new ScanHelper(this);
+    // Returns true of scanning actually was started, false if it did not need to be
+    private boolean restartScanning() {
         mScanState = ScanState.restore(ScanJob.this);
         mScanState.setLastScanStartTimeMillis(System.currentTimeMillis());
         mScanHelper.setMonitoringStatus(mScanState.getMonitoringStatus());
@@ -175,13 +175,10 @@
         if (mScanHelper.getCycledScanner() == null) {
             mScanHelper.createCycledLeScanner(mScanState.getBackgroundMode(), null);
         }
-    }
-
-    // Returns true of scanning actually was started, false if it did not need to be
-    private boolean restartScanning() {
         if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
             mScanHelper.stopAndroidOBackgroundScan();
         }
+
         long scanPeriod = mScanState.getBackgroundMode() ? mScanState.getBackgroundScanPeriod() : mScanState.getForegroundScanPeriod();
         long betweenScanPeriod = mScanState.getBackgroundMode() ? mScanState.getBackgroundBetweenScanPeriod() : mScanState.getForegroundBetweenScanPeriod();
         mScanHelper.getCycledScanner().setScanPeriods(scanPeriod,",1
fix a kind of wrong init," import com.github.ybq.android.spinkit.style.FoldingCube;
 import com.github.ybq.android.spinkit.style.Pulse;
 import com.github.ybq.android.spinkit.style.RotatingPlane;
-import com.github.ybq.android.spinkit.style.Wave;
 import com.github.ybq.android.spinkit.style.ThreeBounce;
 import com.github.ybq.android.spinkit.style.WanderingCubes;
 
@@ -67,7 +66,7 @@
                 setIndeterminateDrawable(new DoubleBounce());
                 break;
             case WAVE:
-                setIndeterminateDrawable(new Wave());
+                setIndeterminateDrawable(new RotatingPlane());
                 break;
             case WANDERING_CUBES:
                 setIndeterminateDrawable(new WanderingCubes());",1
Fixed getFrameRate()," 		if (frameRate == -1) frameRate = 10;
 		if (frameRate == 0) frameRate = graphics.config.backgroundFPS;
 		if (frameRate == 0) frameRate = 30;
-		return frameRate;
+		return 0;
 	}
 
 	protected void exception (Throwable ex) {",1
Fix a minor typo in Javadoc," 
 /**
  * This is the main callback interface that should be implemented to get access to flyway lifecycle notifications.
- * Simply add code to the callback method you are interested in having. A convenience implementation with all methods
+ * Simply add code to the callback method you are interested in having. A convenience implementation will all methods
  * doing nothing is provided with {@link BaseFlywayCallback}. To ensure backward compatibility, you are encouraged
  * to subclass that class instead of implementing this interface directly.
  *",1
Fix null pointer exception in error handling,"     }
 
     private Field findFieldInClass(Class<?> nodeClass, String name) {
-        Class<?> searchClass = nodeClass;
         do {
-            for (Field field : searchClass.getDeclaredFields()) {
+            for (Field field : nodeClass.getDeclaredFields()) {
                 if (field.getName().equals(name)) {
                     return field;
                 }
             }
-            searchClass = searchClass.getSuperclass();
-        } while (searchClass != null);
+            nodeClass = nodeClass.getSuperclass();
+        } while (nodeClass != null);
         throw new AssertionError(f(""Couldn't find constructor parameter %s as a field, class %s"", name, nodeClass.getSimpleName()));
     }
 ",1
DecrementInventoryActivity could have incorrect results if it needs to roll back,"                 List<DiscreteOrderItem> discreteItems = bundleItem.getDiscreteOrderItems();
                 for (DiscreteOrderItem discreteItem : discreteItems) {
                     if (InventoryType.CHECK_QUANTITY.equals(discreteItem.getSku().getInventoryType())) {
-                        Integer quantity = skuInventoryMap.get(discreteItem.getSku());
+                        Integer quantity = skuInventoryMap.get(discreteItem.getSku().getId());
                         if (quantity == null) {
                             quantity = (discreteItem.getQuantity() * bundleItem.getQuantity());
                         } else {",1
Add us-east-1f support,"     public static final Zone US_EAST_1C = new Zone(Region.US_EAST_1, ""us-east-1c"");
     public static final Zone US_EAST_1D = new Zone(Region.US_EAST_1, ""us-east-1d"");
     public static final Zone US_EAST_1E = new Zone(Region.US_EAST_1, ""us-east-1e"");
-    public static final Zone US_EAST_1F = new Zone(Region.US_EAST_1, ""us-east-1f"");
 
     public static final Zone US_EAST_2A = new Zone(Region.US_EAST_2, ""us-east-2a"");
     public static final Zone US_EAST_2B = new Zone(Region.US_EAST_2, ""us-east-2b"");
@@ -101,7 +100,6 @@
         zonesByName.put(US_EAST_1C.name, US_EAST_1C);
         zonesByName.put(US_EAST_1D.name, US_EAST_1D);
         zonesByName.put(US_EAST_1E.name, US_EAST_1E);
-        zonesByName.put(US_EAST_1F.name, US_EAST_1F);
 
         zonesByName.put(US_EAST_2A.name, US_EAST_2A);
         zonesByName.put(US_EAST_2B.name, US_EAST_2B);",1
small fix for color channel variables," }
     public float[] calculatevalues(String color){
         int c=Color.parseColor(color);
-        float r= (float) Color.red(c)/255;
-        float g= (float) Color.green(c)/255;
-        float b= (float) Color.blue(c)/255;
+        float r=Color.red(c)/255;
+        float g=Color.green(c)/255;
+        float b=Color.blue(c)/255;
+        Toast.makeText(getActivity(),Color.red(c)+"" ""+r+"" ""+Color.green(c)+"" ""+g+"" ""+Color.blue(c)+"" ""+b,Toast.LENGTH_LONG).show();
         return new float[]{r,g,b};
     }
     private void random() {",1
:bug: Fixing a bug. #115,"     private int start = 1;
 
     /**
-     * 对 flag 的写入虽然加锁保证了线程安全，但读取的时候由于 不是 volatile 所以可能会读取到旧值
-     *
+     * 保证内存可见性
+     * 其实用锁了之后也可以保证可见性 这里用不用 volatile 都一样
      */
-    private volatile boolean flag = false;
+    private boolean flag = false;
 
     /**
      * 重入锁
@@ -54,7 +54,7 @@
 
         @Override
         public void run() {
-            while (number.start <= 1000) {
+            while (number.start <= 100) {
 
                 if (number.flag) {
                     try {
@@ -67,6 +67,13 @@
                     } finally {
                         LOCK.unlock();
                     }
+                } else {
+                    try {
+                        //防止线程空转
+                        Thread.sleep(10);
+                    } catch (InterruptedException e) {
+                        e.printStackTrace();
+                    }
                 }
             }
         }
@@ -85,7 +92,7 @@
 
         @Override
         public void run() {
-            while (number.start <= 1000) {
+            while (number.start <= 100) {
 
                 if (!number.flag) {
                     try {
@@ -98,6 +105,13 @@
                     } finally {
                         LOCK.unlock();
                     }
+                } else {
+                    try {
+                        //防止线程空转
+                        Thread.sleep(10);
+                    } catch (InterruptedException e) {
+                        e.printStackTrace();
+                    }
                 }
             }
         }",1
解决用户还没有点击更新，就去动mDownloadBinder，导致的空指针bug,"     }
 
     public void cancelDownloadService() {
-        if (mDownloadBinder != null) {
-            // 标识用户已经点击了更新，之后点击取消
         mDownloadBinder.stop(""取消下载"");
     }
-    }
 
     private void installApp() {
         if (AppUpdateUtils.appIsDownloaded(mUpdateApp)) {",1
"bug fix: Nd4j - ""Invalid opType SHORT"" when creating short buffer","      */
     @Override
     public DataBuffer createSame(DataBuffer buffer, boolean init) {
-        return create(buffer.dataType(), buffer.length(), init);
+        switch (buffer.dataType()) {
+            case INT:
+                return createInt(buffer.length(), init);
+            case FLOAT:
+                return createFloat(buffer.length(), init);
+            case DOUBLE:
+                return createDouble(buffer.length(), init);
+            case HALF:
+                return createHalf(buffer.length(), init);
+            default:
+                throw new UnsupportedOperationException(""Unknown dataType: "" + buffer.dataType());
+        }
     }
 
     /**
@@ -361,7 +372,18 @@
      */
     @Override
     public DataBuffer createSame(DataBuffer buffer, boolean init, MemoryWorkspace workspace) {
-        return create(buffer.dataType(), buffer.length(), init, workspace);
+        switch (buffer.dataType()) {
+            case INT:
+                return createInt(buffer.length(), init, workspace);
+            case FLOAT:
+                return createFloat(buffer.length(), init, workspace);
+            case DOUBLE:
+                return createDouble(buffer.length(), init, workspace);
+            case HALF:
+                return createHalf(buffer.length(), init, workspace);
+            default:
+                throw new UnsupportedOperationException(""Unknown dataType: "" + buffer.dataType());
+        }
     }
 
     @Override
@@ -565,24 +587,14 @@
     @Override
     public DataBuffer create(Pointer pointer, DataType type, long length, @NonNull Indexer indexer) {
         switch (type) {
-            case BOOL:
-                return new BoolBuffer(pointer, indexer, length);
-            case BYTE:
-                return new Int8Buffer(pointer, indexer, length);
-            case UBYTE:
-                return new UInt8Buffer(pointer, indexer, length);
-            case SHORT:
-                return new Int16Buffer(pointer, indexer, length);
             case INT:
                 return new IntBuffer(pointer, indexer, length);
+            case DOUBLE:
+                return new DoubleBuffer(pointer, indexer, length);
+            case FLOAT:
+                return new FloatBuffer(pointer, indexer, length);
             case LONG:
                 return new LongBuffer(pointer, indexer, length);
-            case HALF:
-                return new HalfBuffer(pointer, indexer, length);
-            case FLOAT:
-                return new FloatBuffer(pointer, indexer, length);
-            case DOUBLE:
-                return new DoubleBuffer(pointer, indexer, length);
         }
         throw new IllegalArgumentException(""Invalid opType "" + type);
     }",1
Fix not writing value to JsonWriter in example.,"     }
 
     @Override public void toJson(JsonWriter writer, Object value) throws IOException {
-      delegate.toJson(writer, new Envelope<>(value));
+      delegate.toJson(new Envelope<>(value));
     }
   }
 }",1
Fix big performance hit on committing transactions,"           for (int i = 0; i < createdRecords; i++) {
             currentRid = network.readRID();
             createdRid = network.readRID();
-			iTx.updateIdentityAfterCommit(currentRid, createdRid);
+            for (ORecordOperation txEntry : iTx.getAllRecordEntries()) {
+              if (txEntry.getRecord().getIdentity().equals(currentRid)) {
+                txEntry.getRecord().setIdentity(createdRid);
+                break;
+              }
+            }
           }
           final int updatedRecords = network.readInt();
           ORecordId rid;
@@ -1156,9 +1161,8 @@
 
             // SEARCH THE RECORD WITH THAT ID TO UPDATE THE VERSION
             for (ORecordOperation txEntry : iTx.getAllRecordEntries()) {
-			  ORecordOperation rop = iTx.getRecordEntry(rid);
-			  if (rop != null) {
-			    rop.getRecord().getRecordVersion().copyFrom(network.readVersion());
+              if (txEntry.getRecord().getIdentity().equals(rid)) {
+                txEntry.getRecord().getRecordVersion().copyFrom(network.readVersion());
                 break;
               }
             }",1
Add more debug log instrumentation,"     @Override
     public Map<String, Object> getAttributes(final Principal principal, final Service selectedService,
                                              final RegisteredService registeredService) {
-
-        LOGGER.debug(""Initiating attributes release phase for principal [{}] accessing service [{}] defined by registered service [{}]..."",
-                principal.getId(), selectedService.getId(), registeredService.getServiceId());
-
         LOGGER.debug(""Locating principal attributes for [{}]"", principal.getId());
         final Map<String, Object> principalAttributes = getPrincipalAttributesRepository() == null
                 ? principal.getAttributes() : getPrincipalAttributesRepository().getAttributes(principal);
@@ -127,8 +123,7 @@
             LOGGER.debug(""Invoking attribute filter [{}] on the final set of attributes"", getAttributeFilter());
             return getAttributeFilter().filter(attributesToRelease);
         }
-        LOGGER.debug(""Finalizing attributes release phase for principal [{}] accessing service [{}] defined by registered service [{}]..."",
-                principal.getId(), selectedService.getId(), registeredService.getServiceId());
+
         return returnFinalAttributesCollection(attributesToRelease, registeredService);
     }
 ",1
fix possible deadlock in serialized background," 			task.executionAsked = true;
 			future = directExecute(task, task.remainingDelay);
 		}
-		if ((task.id != null || task.serial != null) && !task.managed.get()) {
+		if (task.id != null || task.serial != null) {
 			/* keep task */
 			task.future = future;
 			TASKS.add(task);",1
Fixed UV contraction for the texture in the top-left corner of the texture map,"             }
             if(contractUVs)
             {
-                float tX = texture.getIconWidth() / (texture.getMaxU() - texture.getMinU());
-                float tY = texture.getIconHeight() / (texture.getMaxV() - texture.getMinV());
+                float tX = texture.getOriginX() / texture.getMinU();
+                float tY = texture.getOriginY() / texture.getMinV();
                 float tS = tX > tY ? tX : tY;
                 float ep = 1f / (tS * 0x100);
                 int uve = 0;",1
Fix the redirected URL when converting deploy process to editable model," 
 	          URL explorerURL = ExplorerApp.get().getURL();
 	          URL url = new URL(explorerURL.getProtocol(), explorerURL.getHost(), explorerURL.getPort(),
-			          explorerURL.getPath().replace(""/ui"", """") + ""modeler.html?modelId="" + modelData.getId());
+			          explorerURL.getPath().replace(""/ui"", """") + ""service/editor?id="" + modelData.getId());
               ExplorerApp.get().getMainWindow().open(new ExternalResource(url));
             }
           }",1
Fixed issue #50,"         ArrayList<RectF> bounds = calculateAllBounds(mPaintText);
 
         //Make sure we're on a page that still exists
-        if (mCurrentPage > bounds.size()) {
+        if (mCurrentPage >= bounds.size()) {
             setCurrentItem(bounds.size()-1);
         }
 ",1
fix expected nodes settings check," 
     private static final int ID = 2;
     private static final String DESCRIPTION = ""The value of the cluster setting 'gateway.expected_nodes' "" +
-            ""must be equal to the maximum/expected number of master and data nodes in the cluster."";
+            ""must be equal to the maximum/expected number of nodes in the cluster."";
 
     @Inject
     public RecoveryExpectedNodesSysCheck(ClusterService clusterService, Settings settings) {
@@ -47,12 +47,12 @@
 
     @Override
     public boolean validate() {
-        return validate(clusterService.state().nodes().masterAndDataNodes().size(),
+        return validate(clusterService.state().nodes().getSize(),
                 CrateSettings.GATEWAY_EXPECTED_NODES.extract(settings)
         );
     }
 
-    protected boolean validate(int dataAndMaster, int expectedNodes) {
-        return dataAndMaster == 1 || dataAndMaster == expectedNodes;
+    protected boolean validate(int clusterSize, int expectedNodes) {
+        return clusterSize == 1 || clusterSize == expectedNodes;
     }
 }",1
Fix password management,"             val originalTargetState = initializeLoginFormState.getTransition(CasWebflowConstants.STATE_ID_SUCCESS).getTargetStateId();
             val pswdResetSubFlowState = createSubflowState(flow, CasWebflowConstants.STATE_ID_PASSWORD_RESET_SUBFLOW, FLOW_ID_PASSWORD_RESET);
 
-            val createTgt = getTransitionableState(flow, CasWebflowConstants.STATE_ID_CREATE_TICKET_GRANTING_TICKET);
-            createTgt.getEntryActionList().add(
+            val realSubmit = getTransitionableState(flow, CasWebflowConstants.STATE_ID_REAL_SUBMIT);
+            realSubmit.getEntryActionList().add(
                 createEvaluateAction(String.join(DO_CHANGE_PASSWORD_PARAMETER, ""flowScope."", "" = requestParameters."", "" != null"")));
 
             createDecisionState(flow, CasWebflowConstants.DECISION_STATE_CHECK_FOR_PASSWORD_RESET_TOKEN_ACTION, ""requestParameters.""
@@ -155,11 +155,11 @@
                 CasWebflowConstants.STATE_ID_CHECK_DO_CHANGE_PASSWORD,
                 ""flowScope."" + DO_CHANGE_PASSWORD_PARAMETER + "" == true"",
                 CasWebflowConstants.VIEW_ID_MUST_CHANGE_PASSWORD,
-                createTgt
+                realSubmit
                     .getTransition(CasWebflowConstants.TRANSITION_ID_SUCCESS).getTargetStateId())
                 .getEntryActionList().add(createEvaluateAction(""flowScope.pswdChangePostLogin=true""));
 
-            createTransitionForState(createTgt,
+            createTransitionForState(realSubmit,
                 CasWebflowConstants.TRANSITION_ID_SUCCESS, CasWebflowConstants.STATE_ID_CHECK_DO_CHANGE_PASSWORD, true);
 
             createDecisionState(flow,",1
"Fix the response HTTP Header ""Set-Cookie"" can't work.","      */
     protected boolean setCookiesFromHeaders(Map<String, List<String>> headers, boolean executeInNewThread) {
         if (null != headers) {
-            final List<String> cookies = headers.get(SonicSessionConnection.HTTP_HEAD_FILED_SET_COOKIE.toLowerCase());
+            final List<String> cookies = headers.get(SonicSessionConnection.HTTP_HEAD_FILED_SET_COOKIE);
             if (null != cookies && 0 != cookies.size()) {
                 if (!executeInNewThread) {
                     return SonicEngine.getInstance().getRuntime().setCookie(getCurrentUrl(), cookies);",1
Fix showRightView,"+
 package org.holoeverywhere.slider;
 
 import static android.view.ViewGroup.LayoutParams.MATCH_PARENT;
@@ -971,7 +972,7 @@
 
     @Override
     public void showRightView(boolean smooth) {
-        show(mRightViewWidth, smooth, STATE_RIGHT_OPENED);
+        show(mRightViewWidth, smooth, STATE_LEFT_OPENED);
     }
 
     @Override",1
KEYCLOAK-4329 Fix NPE when not providing KeyInfo element in IdP initiated SSO SAML,"      * @return The object or {@code null} if not found.
      */
     public static <T> T getContent(Iterable<Object> objects, Class<T> clazz) {
-        if (objects == null) {
-            return null;
-        }
         for (Object o : objects) {
             if (clazz.isInstance(o)) {
                 return (T) o;
@@ -48,11 +45,11 @@
 
 
     public static KeyName getKeyName(KeyInfo keyInfo) {
-        return keyInfo == null ? null : getContent(keyInfo.getContent(), KeyName.class);
+        return getContent(keyInfo.getContent(), KeyName.class);
     }
 
     public static X509Data getX509Data(KeyInfo keyInfo) {
-        return keyInfo == null ? null : getContent(keyInfo.getContent(), X509Data.class);
+        return getContent(keyInfo.getContent(), X509Data.class);
     }
 
     public static X509Certificate getX509Certificate(KeyInfo keyInfo) {",1
fix for locales," import org.nd4j.linalg.api.ndarray.INDArray;
 
 import java.text.DecimalFormat;
-import java.text.DecimalFormatSymbols;
 
 /**
  * @author Adam Gibson
@@ -20,6 +19,7 @@
     private String decFormatRest = """";
     private DecimalFormat decimalFormat = new DecimalFormat(decFormatNum + decFormatRest);
 
+
     public NDArrayStrings(String sep) {
         this("", "",2);
     }
@@ -38,10 +38,6 @@
             }
         }
         this.decimalFormat = new DecimalFormat(decFormatNum + decFormatRest);
-        DecimalFormatSymbols sepNgroup = DecimalFormatSymbols.getInstance();
-        sepNgroup.setDecimalSeparator('.');
-        sepNgroup.setGroupingSeparator(',');
-        decimalFormat.setDecimalFormatSymbols(sepNgroup);
     }
 
     public NDArrayStrings() {",1
Fix for showing multiple PDFViews at the same time. #75,"         decodingAsyncTask.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);
 
         renderingAsyncTask = new RenderingAsyncTask(this);
-        renderingAsyncTask.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);
+        renderingAsyncTask.execute();
     }
 
     /**",1
Get frame delay before advancing to show the current frame for the correct amount of time,"         }
         isLoadPending = true;
 
+        gifDecoder.advance();
         long targetTime = SystemClock.uptimeMillis() + gifDecoder.getNextDelay();
-        gifDecoder.advance();
         DelayTarget next = new DelayTarget(handler, gifDecoder.getCurrentFrameIndex(), targetTime);
         requestBuilder
                 .signature(new FrameSignature())",1
Fixed a bug in HikariConfig.setConnectionTimeout(long),"     /** {@inheritDoc} */
     public void setConnectionTimeout(long connectionTimeoutMs)
     {
+        if (connectionTimeoutMs < 100)
+        {
+            throw new IllegalArgumentException(""connectionTimeout cannot be less than 100ms"");
+        }
         if (connectionTimeoutMs == 0)
         {
             this.connectionTimeout = Integer.MAX_VALUE;
         }
-        else if (connectionTimeoutMs < 100)
-        {
-            throw new IllegalArgumentException(""connectionTimeout cannot be less than 100ms"");
-        }
-        else
-        {
         this.connectionTimeout = connectionTimeoutMs;
     }
-    }
 
     public String getDataSourceClassName()
     {",1
Fixed setting previousScrollFocus in Dialog class," 
 		previousScrollFocus = null;
 		actor = stage.getScrollFocus();
-		if (actor != null && !actor.isDescendantOf(this)) previousScrollFocus = actor;
+		if (actor != null && !actor.isDescendantOf(this)) stage.setScrollFocus(previousScrollFocus);
 
 		pack();
 		setPosition(Math.round((stage.getWidth() - getWidth()) / 2), Math.round((stage.getHeight() - getHeight()) / 2));
@@ -200,6 +200,17 @@
 	/** Hides the dialog. Called automatically when a button is clicked. The default implementation fades out the dialog over
 	 * {@link #fadeDuration} seconds and then removes it from the stage. */
 	public void hide () {
+		if (fadeDuration > 0) {
+			addCaptureListener(ignoreTouchDown);
+			addAction(sequence(fadeOut(fadeDuration, Interpolation.fade), Actions.removeListener(ignoreTouchDown, true),
+				Actions.removeActor()));
+		} else
+			remove();
+	}
+
+	protected void setParent (Group parent) {
+		super.setParent(parent);
+		if (parent == null) {
 			Stage stage = getStage();
 			if (stage != null) {
 				if (previousKeyboardFocus != null && previousKeyboardFocus.getStage() == null) previousKeyboardFocus = null;
@@ -210,12 +221,7 @@
 				actor = stage.getScrollFocus();
 				if (actor == null || actor.isDescendantOf(this)) stage.setScrollFocus(previousScrollFocus);
 			}
-		if (fadeDuration > 0) {
-			addCaptureListener(ignoreTouchDown);
-			addAction(sequence(fadeOut(fadeDuration, Interpolation.fade), Actions.removeListener(ignoreTouchDown, true),
-				Actions.removeActor()));
-		} else
-			remove();
+		}
 	}
 
 	public void setObject (Actor actor, Object object) {",1
"Fix wrong ""equals"" implementation","         }
 
         Item other = (Item) obj;
-        return id == other.id
-                && (mimeType != null && mimeType.equals(other.mimeType)
-                    || (mimeType == null && other.mimeType == null))
-                && (uri != null && uri.equals(other.uri)
-                    || (uri == null && other.uri == null))
-                && size == other.size
-                && duration == other.duration;
+        return other.uri.equals(uri);
     }
 
     @Override",1
Bug fixes in Animation3D," 		if (isPlaying())
 			throw new RuntimeException(""Listeners can only be added and removed when the animation is not playing."");
 		
-		if (!mAnimationListeners.contains(animationListener))
 		return mAnimationListeners.add(animationListener);
-		else
-			return false;
 	}
 
 	/**
@@ -288,7 +285,7 @@
 	 * @param deltaTime
 	 */
 	public void update(final double deltaTime) {
-		if (mPaused)
+		if (mPaused || !mPlaying)
 			return;
 
 		// Do not run the animation until the delay is over
@@ -309,7 +306,7 @@
 		eventUpdate(deltaTime);
 
 		// End of animation reached
-		if (mElapsedTime >= mDuration && !mEnded) {
+		if (mElapsedTime >= mDuration) {
 			mEnded = true;
 			mPaused = false;
 			mPlaying = false;
@@ -353,8 +350,8 @@
 		}
 
 		// Calculate the interpolated time
-		final float interpolatedTime = mInterpolator
-				.getInterpolation((float) ((mElapsedTime) / mDuration));
+		final float interpolatedTime = 1f - mInterpolator
+				.getInterpolation((float) ((mDuration - mElapsedTime) / mDuration));
 		mInterpolatedTime = interpolatedTime > 1 ? 1 : interpolatedTime < 0 ? 0 : interpolatedTime;
 
 		if (mIsReversing)",1
Fix parameter order to UtilsHandler.removeFromDatabase() for SSH targets," 
                 AppConfig.runInBackground(() -> {
                     utilsHandler.removeFromDatabase(new OperationData(UtilsHandler.Operation.SFTP,
-                            path, connectionName, null, null, null));
+                            connectionName, path, null, null, null));
                 });
                 ((MainActivity) getActivity()).getDrawer().refreshDrawer();
             }",1
Fix #3299," 
 		// set number of triangles
 		split.total = 3;
-		split.numFront = (r1 ? 0 : 1) + (r2 ? 0 : 1) + (r3 ? 0 : 1);
+		split.numFront = (r1 ? 1 : 0) + (r2 ? 1 : 0) + (r3 ? 1 : 0);
 		split.numBack = split.total - split.numFront;
 
 		// hard case, split the three edges on the plane
 		// determine which array to fill first, front or back, flip if we
 		// cross the plane
-		split.setSide(!r1);
+		split.setSide(r1);
 
 		// split first edge
 		int first = 0;",1
Fixed CheckForNewAppVersionTask being executed when it shouldn't," 
 import android.app.Application;
 import android.app.PendingIntent;
-import android.content.Context;
 import android.content.Intent;
 import android.content.SharedPreferences;
 import android.content.pm.PackageInfo;
 import android.content.pm.PackageManager;
 import android.content.pm.Signature;
-import android.net.ConnectivityManager;
 import android.net.Uri;
 import android.os.AsyncTask;
 import android.preference.PreferenceManager;
@@ -71,8 +69,6 @@
     @Override
     protected String doInBackground(Void... voids) {
 
-        if(isCancelled() || !isConnected()) return null;
-
         // Make a network request to get latest NewPipe data.
         if (client == null) {
 
@@ -231,12 +227,4 @@
 
         return getCertificateSHA1Fingerprint().equals(GITHUB_APK_SHA1);
     }
-    
-    private boolean isConnected() {
-     
-        ConnectivityManager cm = 
-                (ConnectivityManager) app.getSystemService(Context.CONNECTIVITY_SERVICE);
-        return cm.getActiveNetworkInfo() != null
-				&& cm.getActiveNetworkInfo().isConnected();
-    }
 }",1
Fix check for subselect mergeability," 
         boolean notMergeableOrderBy = childQuerySpec.orderBy().isPresent() && parentQuerySpec.orderBy().isPresent()
                                       && !childQuerySpec.orderBy().equals(parentQuerySpec.orderBy())
-                                      && (childQuerySpec.limit().isPresent() || childQuerySpec.offset().isPresent())
+                                      && (parentQuerySpec.limit().isPresent() || parentQuerySpec.offset().isPresent())
                                       && (parentQuerySpec.limit().isPresent() || parentQuerySpec.offset().isPresent());
 
         return !hasAggregations && !notMergeableOrderBy &&",1
fixed dupe quotes issue with category names that require quotes when save is called more than once,"             write(out, pad0, COMMENT_SEPARATOR, NEW_LINE);
         }
 
-        String displayName = name;
-
         if (!allowedProperties.matchesAllOf(name))
         {
-            displayName = '""' + name + '""';
+            name = '""' + name + '""';
         }
 
-        write(out, pad0, displayName, "" {"");
+        write(out, pad0, name, "" {"");
 
         Property[] props = getOrderedValues().toArray(new Property[] {});
 ",1
Solves bug on generated code by @RootContext annotation when used on …," 		} else {
 			AbstractJClass extendingContextClass = getEnvironment().getJClass(typeQualifiedName);
 
-			JConditional cond = targetBlock._if(contextRef._instanceof(extendingContextClass));
-			cond._then().add(fieldRef.assign(cast(extendingContextClass, contextRef)));
+			JConditional cond = getInvocationBlock(holder)._if(holder.getContextRef()._instanceof(extendingContextClass));
+			cond._then().add(fieldRef.assign(cast(extendingContextClass, holder.getContextRef())));
 
 			JInvocation warningInvoke = getClasses().LOG.staticInvoke(""w"");
 			warningInvoke.arg(logTagForClassHolder(holder));
-			warningInvoke.arg(
-					lit(""Due to Context class "").plus(contextRef.invoke(""getClass"").invoke(""getSimpleName"")).plus(lit("", the @RootContext "" + extendingContextClass.name() + "" won't be populated"")));
+			warningInvoke.arg(lit(""Due to Context class "").plus(holder.getContextRef().invoke(""getClass"").invoke(""getSimpleName""))
+					.plus(lit("", the @RootContext "" + extendingContextClass.name() + "" won't be populated"")));
 			cond._else().add(warningInvoke);
 		}
 	}",1
Fix crash when leaktrace size is 1,"       if (currentReachability == Reachability.UNKNOWN) {
         maybeLeakCause = true;
       } else if (currentReachability == Reachability.REACHABLE) {
-        if (i < elements.size() - 1) {
         Reachability nextReachability = expectedReachability.get(i + 1);
         if (nextReachability !=  Reachability.REACHABLE) {
           maybeLeakCause = true;
         }
-        } else {
-          maybeLeakCause = true;
-        }
       }
       sb.append(element.toString(maybeLeakCause)).append(""\n"");
     }",1
Fix leak of query and task when cleanup request is rejected,"             public void onFailure(Throwable t)
             {
                 if (t instanceof RejectedExecutionException) {
-                    // TODO: we should only give up retrying when the client has been shutdown
-                    logError(t, ""Unable to %s task at %s. Got RejectedExecutionException."", action, request.getUri());
-                    cleanUpLocally();
+                    // client has been shutdown
                     return;
                 }
 
                 // record failure
                 if (cleanupBackoff.failure()) {
-                    logError(t, ""Unable to %s task at %s. Back off depleted."", action, request.getUri());
-                    cleanUpLocally();
+                    logError(t, ""Unable to %s task at %s"", action, request.getUri());
+                    // Update the taskInfo with the new taskStatus.
+                    // This is required because the query state machine depends on TaskInfo (instead of task status)
+                    // to transition its own state.
+                    // Also, since this TaskInfo is updated in the client the ""finalInfo"" flag will not be set,
+                    // indicating that the stats are stale.
+                    // TODO: Update the query state machine and stage state machine to depend on TaskStatus instead
+                    updateTaskInfo(getTaskInfo().withTaskStatus(getTaskStatus()));
                     return;
                 }
 
@@ -647,27 +651,6 @@
                     errorScheduledExecutor.schedule(() -> doScheduleAsyncCleanupRequest(cleanupBackoff, request, action), delayNanos, NANOSECONDS);
                 }
             }
-
-            private void cleanUpLocally()
-            {
-                // Update the taskInfo with the new taskStatus.
-
-                // Generally, we send a cleanup request to the worker, and update the TaskInfo on
-                // the coordinator based on what we fetched from the worker. If we somehow cannot
-                // get the cleanup request to the worker, the TaskInfo that we fetch for the worker
-                // likely will not say the task is done however many times we try. In this case,
-                // we have to set the local query info directly so that we stop trying to fetch
-                // updated TaskInfo from the worker. This way, the task on the worker eventually
-                // expires due to lack of activity.
-
-                // This is required because the query state machine depends on TaskInfo (instead of task status)
-                // to transition its own state.
-                // TODO: Update the query state machine and stage state machine to depend on TaskStatus instead
-
-                // Since this TaskInfo is updated in the client the ""complete"" flag will not be set,
-                // indicating that the stats may not reflect the final stats on the worker.
-                updateTaskInfo(getTaskInfo().withTaskStatus(getTaskStatus()));
-            }
         }, executor);
     }
 ",1
fixes #478 service getting unregistered from consul after a while," import java.util.List;
 import java.util.Map;
 import java.util.concurrent.CountDownLatch;
-import java.util.concurrent.atomic.AtomicInteger;
 import java.util.concurrent.atomic.AtomicReference;
 
 /**
@@ -53,7 +52,6 @@
 public class ConsulClientImpl implements ConsulClient {
 	private static final Logger logger = LoggerFactory.getLogger(ConsulClientImpl.class);
 	private static final ConsulConfig config = (ConsulConfig)Config.getInstance().getJsonObjectConfig(ConsulConstants.CONFIG_NAME, ConsulConfig.class);
-	private static AtomicInteger reqCounter = new AtomicInteger(0);
 
 	// Single Factory Object so just like static.
 	Http2Client client = Http2Client.getInstance();
@@ -64,6 +62,7 @@
 	OptionMap optionMap;
 	URI uri;
 	int maxReqPerConn;
+	int reqCounter = 0;
 	String wait = ""600s"";
 
 	/**
@@ -94,17 +93,17 @@
 		final CountDownLatch latch = new CountDownLatch(1);
 		final AtomicReference<ClientResponse> reference = new AtomicReference<>();
 		try {
-			if(connection == null || !connection.isOpen() || reqCounter.get() >= maxReqPerConn) {
+			if(connection == null || !connection.isOpen() || reqCounter >= maxReqPerConn) {
 				if(logger.isDebugEnabled()) logger.debug(""connection is closed with counter "" + reqCounter + "", reconnecting..."");
 				connection = client.connect(uri, Http2Client.WORKER, Http2Client.SSL, Http2Client.BUFFER_POOL, optionMap).get();
-				reqCounter = new AtomicInteger(0);
+				reqCounter = 0;
 			}
 			ClientRequest request = new ClientRequest().setMethod(Methods.PUT).setPath(path);
 			request.getRequestHeaders().put(Headers.HOST, ""localhost"");
 			if(token != null) request.getRequestHeaders().put(HttpStringConstants.CONSUL_TOKEN, token);
 			connection.sendRequest(request, client.createClientCallback(reference, latch));
 			latch.await();
-			reqCounter.getAndIncrement();
+			reqCounter++;
 			int statusCode = reference.get().getResponseCode();
 			if(statusCode >= 300){
 				logger.error(""Failed to checkPass on Consul: "" + statusCode + "":"" + reference.get().getAttachment(Http2Client.RESPONSE_BODY));
@@ -122,17 +121,17 @@
 		final CountDownLatch latch = new CountDownLatch(1);
 		final AtomicReference<ClientResponse> reference = new AtomicReference<>();
 		try {
-			if(connection == null || !connection.isOpen() || reqCounter.get() >= maxReqPerConn) {
+			if(connection == null || !connection.isOpen() || reqCounter >= maxReqPerConn) {
 				if(logger.isDebugEnabled()) logger.debug(""connection is closed with counter "" + reqCounter + "", reconnecting..."");
 				connection = client.connect(uri, Http2Client.WORKER, Http2Client.SSL, Http2Client.BUFFER_POOL, optionMap).get();
-				reqCounter = new AtomicInteger(0);
+				reqCounter = 0;
 			}
 			ClientRequest request = new ClientRequest().setMethod(Methods.PUT).setPath(path);
 			request.getRequestHeaders().put(Headers.HOST, ""localhost"");
 			if(token != null) request.getRequestHeaders().put(HttpStringConstants.CONSUL_TOKEN, token);
 			connection.sendRequest(request, client.createClientCallback(reference, latch));
 			latch.await();
-			reqCounter.getAndIncrement();
+			reqCounter++;
 			int statusCode = reference.get().getResponseCode();
 			if(statusCode >= 300){
 				logger.error(""Failed to checkPass on Consul: "" + statusCode + "":"" + reference.get().getAttachment(Http2Client.RESPONSE_BODY));
@@ -150,10 +149,10 @@
 		final CountDownLatch latch = new CountDownLatch(1);
 		final AtomicReference<ClientResponse> reference = new AtomicReference<>();
 		try {
-			if(connection == null || !connection.isOpen() || reqCounter.get() >= maxReqPerConn) {
+			if(connection == null || !connection.isOpen() || reqCounter >= maxReqPerConn) {
 				if(logger.isDebugEnabled()) logger.debug(""connection is closed with counter "" + reqCounter + "", reconnecting..."");
 				connection = client.connect(uri, Http2Client.WORKER, Http2Client.SSL, Http2Client.BUFFER_POOL, optionMap).get();
-				reqCounter = new AtomicInteger(0);
+				reqCounter = 0;
 			}
 			ClientRequest request = new ClientRequest().setMethod(Methods.PUT).setPath(path);
 			if(token != null) request.getRequestHeaders().put(HttpStringConstants.CONSUL_TOKEN, token);
@@ -161,7 +160,7 @@
 			request.getRequestHeaders().put(Headers.TRANSFER_ENCODING, ""chunked"");
 			connection.sendRequest(request, client.createClientCallback(reference, latch, json));
 			latch.await();
-			reqCounter.getAndIncrement();
+			reqCounter++;
 			int statusCode = reference.get().getResponseCode();
 			if(statusCode >= 300){
 				throw new Exception(""Failed to register on Consul: "" + statusCode);
@@ -178,10 +177,10 @@
 		final CountDownLatch latch = new CountDownLatch(1);
 		final AtomicReference<ClientResponse> reference = new AtomicReference<>();
 		try {
-			if(connection == null || !connection.isOpen() || reqCounter.get() >= maxReqPerConn) {
+			if(connection == null || !connection.isOpen() || reqCounter >= maxReqPerConn) {
 				if(logger.isDebugEnabled()) logger.debug(""connection is closed with counter "" + reqCounter + "", reconnecting..."");
 				connection = client.connect(uri, Http2Client.WORKER, Http2Client.SSL, Http2Client.BUFFER_POOL, optionMap).get();
-				reqCounter = new AtomicInteger(0);
+				reqCounter = 0;
 			}
 
 			ClientRequest request = new ClientRequest().setMethod(Methods.PUT).setPath(path);
@@ -189,7 +188,7 @@
 			if(token != null) request.getRequestHeaders().put(HttpStringConstants.CONSUL_TOKEN, token);
 			connection.sendRequest(request, client.createClientCallback(reference, latch));
 			latch.await();
-			reqCounter.getAndIncrement();
+			reqCounter++;
 			int statusCode = reference.get().getResponseCode();
 			if(statusCode >= 300){
 				System.out.println(""body = "" + reference.get().getAttachment(Http2Client.RESPONSE_BODY));
@@ -212,17 +211,17 @@
 		final CountDownLatch latch = new CountDownLatch(1);
 		final AtomicReference<ClientResponse> reference = new AtomicReference<>();
 		try {
-			if(connection == null || !connection.isOpen() || reqCounter.get() >= maxReqPerConn) {
+			if(connection == null || !connection.isOpen() || reqCounter >= maxReqPerConn) {
 				if(logger.isDebugEnabled()) logger.debug(""connection is closed with counter "" + reqCounter + "", reconnecting..."");
 				connection = client.connect(uri, Http2Client.WORKER, Http2Client.SSL, Http2Client.BUFFER_POOL, optionMap).get();
-				reqCounter = new AtomicInteger(0);
+				reqCounter = 0;
 			}
 			ClientRequest request = new ClientRequest().setMethod(Methods.GET).setPath(path);
 			if(token != null) request.getRequestHeaders().put(HttpStringConstants.CONSUL_TOKEN, token);
 			request.getRequestHeaders().put(Headers.HOST, ""localhost"");
 			connection.sendRequest(request, client.createClientCallback(reference, latch));
 			latch.await();
-			reqCounter.getAndIncrement();
+			reqCounter++;
 			int statusCode = reference.get().getResponseCode();
 			if(statusCode >= 300){
 				if(logger.isDebugEnabled()) logger.debug(""body = "" + reference.get().getAttachment(Http2Client.RESPONSE_BODY));",1
Fix It,"     DrawerLayout mDrawerLayout;
     Toolbar toolbar;
     boolean editmode = false, hidden = false;
-    private SwipeRefreshLayout SwipeContainerRV;
+    SwipeRefreshLayout SwipeContainerRV;
 
     private GoogleApiClient client;
 
@@ -71,7 +71,6 @@
     public void onCreate(Bundle savedInstanceState) {
         super.onCreate(savedInstanceState);
         setContentView(R.layout.activity_albums);
-
         /****TODO: WORK BUT, MUST BE FIXXED BETTER****/
         SwipeContainerRV = (SwipeRefreshLayout) findViewById(R.id.swipeRefreshLayout);
         SwipeContainerRV.setColorSchemeResources(R.color.accent_amber,
@@ -82,17 +81,21 @@
         SwipeContainerRV.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {
             @Override
             public void onRefresh() {
-                refreshItems();
+                //refreshItems();
+                new Handler().postDelayed(new Runnable() {
+                    @Override
+                    public void run() {
+                        loadAlbums();
+                        SwipeContainerRV.setRefreshing(false);
+                    }
+                }, 500);
             }
         });
-
         /************************/
 
         initUiTweaks();
         checkPermissions();
 
-
-        /****** APPP INTROOOOOOOOOOOOO*/
         Thread t = new Thread(new Runnable() {
             @Override
             public void run() {
@@ -100,6 +103,7 @@
                         .getDefaultSharedPreferences(getBaseContext());
                 boolean isFirstStart = getPrefs.getBoolean(""firstStart"", true);
                 if (isFirstStart) {
+                    //albums.loadPreviewHiddenAlbums();
                     Intent i = new Intent(AlbumsActivity.this, IntroActivity.class);
                     startActivity(i);
                     SharedPreferences.Editor e = getPrefs.edit();
@@ -110,94 +114,12 @@
         });
         t.start();
 
-
         // ATTENTION: This was auto-generated to implement the App Indexing API.
         // See https://g.co/AppIndexing/AndroidStudio for more information.
         client = new GoogleApiClient.Builder(this).addApi(AppIndex.API).build();
 
     }
 
-    void refreshItems() {
-        new Handler().postDelayed(new Runnable() {
-            @Override
-            public void run() {
-                LoadAlbumsData();
-            }
-        }, 1);
-        onItemsLoadComplete();
-    }
-
-    void onItemsLoadComplete() {
-        new Handler().postDelayed(new Runnable() {
-            @Override
-            public void run() {
-                LoadUiAlbums();
-            }
-        }, 1);
-        SwipeContainerRV.setRefreshing(false);//STOPPA IL PULL REFRESH
-    }
-
-    private void LoadAlbumsData(){
-        if (hidden) {
-            albums.loadPreviewHiddenAlbums();
-        } else
-            albums.loadPreviewAlbums();
-    }
-
-    private void LoadUiAlbums(){
-        /**** ALBUM UI LOAD ***/
-        mRecyclerView = (RecyclerView) findViewById(R.id.grid_albums);
-        adapt = new AlbumsAdapter(albums.dispAlbums, getApplicationContext());
-
-        /**** ON ALBUM LONG CLICK ***/
-        adapt.setOnLongClickListener(new View.OnLongClickListener() {
-            @Override
-            public boolean onLongClick(View v) {
-                TextView a = (TextView) v.findViewById(R.id.album_name);
-                adapt.notifyItemChanged(albums.toggleSelectAlbum(a.getTag().toString()));
-                editmode = true;
-                invalidateOptionsMenu();
-                return true;
-            }
-        });
-
-        /**** ON ALBUMS CLICK ***/
-        adapt.setOnClickListener(new View.OnClickListener() {
-            @Override
-            public void onClick(View v) {
-                TextView a = (TextView) v.findViewById(R.id.album_name);
-                if (editmode) {
-                    adapt.notifyItemChanged(albums.toggleSelectAlbum(a.getTag().toString()));
-                    invalidateOptionsMenu();
-                } else {
-                    Album album = albums.getAlbum(a.getTag().toString());
-                    Intent intent = new Intent(AlbumsActivity.this, PhotosActivity.class);
-
-                    //intent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION);
-                    //intent.addFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
-
-                    Bundle b = new Bundle();
-                    b.putParcelable(""album"", album);
-                    intent.putExtras(b);
-                    startActivity(intent);
-                }
-            }
-        });
-
-        mRecyclerView.setHasFixedSize(true);
-        mRecyclerView.setAdapter(adapt);
-        mRecyclerView.setLayoutManager(new GridLayoutManager(this, 2));
-        mRecyclerView.setItemAnimator(new DefaultItemAnimator());
-        //mRecyclerView.addItemDecoration(new GridSpacingItemDecoration(2, 5, true));
-        if (RVdecor) {
-            mRecyclerView.addItemDecoration(new GridSpacingItemDecoration(2, 5, true));
-            RVdecor = false;
-        }
-        adapt.notifyDataSetChanged();
-        mRecyclerView.setBackgroundColor(getBackgroundColor());
-    }
-
-
     @Override
     public void onPostCreate(Bundle savedInstanceState) {
             super.onPostCreate(savedInstanceState);
@@ -253,9 +175,6 @@
         });
 
         setRecentApp(getString(R.string.app_name));
-
-
-        /***********************************/
     }
 
     public void setDrawerTheme(){
@@ -358,8 +277,8 @@
             else
                 ActivityCompat.requestPermissions(AlbumsActivity.this,
                         new String[]{Manifest.permission.READ_EXTERNAL_STORAGE}, 0);
-        } //else
-            //loadAlbums();
+        } else
+            loadAlbums();
     }
 
     @Override
@@ -614,7 +533,7 @@
         switch (requestCode) {
             case 0:
                 if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED)
-                    //loadAlbums();
+                    loadAlbums();
                 break;
             case 1:
                 if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED)
@@ -623,7 +542,6 @@
         }
     }
 
-    /*
     private void loadAlbums() {
 
         if (hidden) {
@@ -634,7 +552,6 @@
 
         mRecyclerView = (RecyclerView) findViewById(R.id.grid_albums);
         adapt = new AlbumsAdapter(albums.dispAlbums, getApplicationContext());
-
         adapt.setOnLongClickListener(new View.OnLongClickListener() {
             @Override
             public boolean onLongClick(View v) {
@@ -671,7 +588,6 @@
         mRecyclerView.setAdapter(adapt);
         mRecyclerView.setLayoutManager(new GridLayoutManager(this, 2));
         mRecyclerView.setItemAnimator(new DefaultItemAnimator());
-        //mRecyclerView.addItemDecoration(new GridSpacingItemDecoration(2, 5, true));
         if (RVdecor) {
             mRecyclerView.addItemDecoration(new GridSpacingItemDecoration(2, 5, true));
             RVdecor = false;
@@ -679,7 +595,6 @@
         adapt.notifyDataSetChanged();
         mRecyclerView.setBackgroundColor(getBackgroundColor());
     }
-    */
 
     private void hideViews() {
         fabCamera.animate().translationY(fabCamera.getHeight()*2/*+fabBottomMargin*/).setInterpolator(new AccelerateInterpolator(2)).start();",1
Correct install dir detection from ZAP JAR," // ZAP: 2018/02/14 Remove unnecessary boxing / unboxing
 // ZAP: 2018/03/16 Use equalsIgnoreCase (Issue 4327).
 // ZAP: 2018/04/16 Keep backup of malformed config file.
-// ZAP: 2018/06/13 Correct install dir detection from JAR.
 
 package org.parosproxy.paros;
 
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
-import java.net.URISyntaxException;
 import java.net.URL;
 import java.nio.file.FileSystems;
 import java.nio.file.Files;
@@ -1058,19 +1056,14 @@
     		String path = ""."";
     		Path localDir = Paths.get(path);
     		if ( ! Files.isDirectory(localDir.resolve(""db"")) || ! Files.isDirectory(localDir.resolve(""lang""))) {
-    			try {
-    				Path sourceLocation = Paths.get(ZAP.class.getProtectionDomain().getCodeSource().getLocation().toURI());
-    				if (!Files.isDirectory(sourceLocation)) {
-    					sourceLocation = sourceLocation.getParent();
-    				}
-    				path = sourceLocation.toString();
-    			} catch (URISyntaxException e) {
-    				System.err.println(""Failed to determine the ZAP installation dir: "" + e.getMessage());
-    				path = localDir.toAbsolutePath().toString();
-    			}
+    			path = ZAP.class.getProtectionDomain().getCodeSource().getLocation().getPath();
     			// Loggers wont have been set up yet
     			System.out.println(""Defaulting ZAP install dir to "" + path);
             }
+    		if (path.startsWith(""/"") && path.indexOf("":"") > 0) {
+    			// This is likely to be a Windows path, remove to initial slash or it will fail
+    			path = path.substring(1);
+    		}
 
     		zapInstall = getAbsolutePath(path);
     	}",1
fix NullPointerException in WebSocketClient," 			conn = (WebSocketImpl) wf.createWebSocket( this, draft, channel.socket() );
 		} catch ( IOException e ) {
 			onWebsocketError( null, e );
-			
-			if(conn != null) {
 			conn.closeConnection( CloseFrame.NEVER_CONNECTED, e.getMessage() );
-			}
-			
 			return;
 		}
 	}
@@ -227,11 +223,7 @@
 			return;
 		} catch ( /*IOException | SecurityException | UnresolvedAddressException*/Exception e ) {//
 			onWebsocketError( conn, e );
-			
-			if(conn != null) {
 			conn.closeConnection( CloseFrame.NEVER_CONNECTED, e.getMessage() );
-			}
-			
 			return;
 		}
 ",1
Fix: Fixed a bug where some searchers were,"         request.executionNodeId(executionNodeId);
         request.toFetchReferences(toFetchReferences);
         request.jobSearchContextDocIds(nodeBucket.docIds());
-        if (bulkSize > NO_BULK_REQUESTS && remainingUpstreams.get() > 0) {
+        if (bulkSize > NO_BULK_REQUESTS) {
             request.closeContext(false);
         }
         transportFetchNodeAction.execute(nodeBucket.nodeId, request, new ActionListener<NodeFetchResponse>() {",1
Bugfix/pcapwriting," import org.csploit.android.plugins.mitm.SpoofSession.OnSessionReadyListener;
 import org.csploit.android.tools.TcpDump;
 
-import java.io.*;
+import java.io.File;
+import java.io.IOException;
 import java.net.InetAddress;
 import java.util.ArrayList;
 import java.util.Collections;
@@ -336,7 +337,7 @@
       @Override
       public void onConfirm(){
         mDumpToFile = true;
-        mPcapFileName = (new File(Sniffer.this.getCacheDir(), ""csploit-sniff-"" + java.lang.System.currentTimeMillis() + "".pcap"")).getAbsolutePath();
+        mPcapFileName = (new File(System.getStoragePath(), ""csploit-sniff-"" + java.lang.System.currentTimeMillis() + "".pcap"")).getAbsolutePath();
       }
 
       @Override
@@ -409,21 +410,6 @@
       if (mFileActivity != null) {
         mFileActivity.stopWatching();
         mFileActivity = null;
-        //copy pcap file from cache to storage
-          try {
-              InputStream in = new FileInputStream(mPcapFileName);
-              OutputStream out = new FileOutputStream(new File(System.getStoragePath(),new File(mPcapFileName).getName()));
-              byte[] buf = new byte[1024];
-              int len;
-              while ((len = in.read(buf)) > 0) {
-                  out.write(buf, 0, len);
-              }
-              in.close();
-              out.close();
-          } catch (IOException e) {
-              e.printStackTrace();
-          }
-
       }
     }
 ",1
Fix getCenter(out)," 	/** @param out The {@link Vector3} to receive the center of the bounding box.
 	 * @return The vector specified with the out argument. */
 	public Vector3 getCenter (Vector3 out) {
-		return out.set(cnt);
+		return cnt;
 	}
 
 	public float getCenterX () {",1
Fix build issue in master,"         return brokerContainers.values();
     }
 
+    public Collection<BrokerContainer> getBrokers() {
+        return brokerContainers.values();
+    }
+
     public ExecResult runAdminCommandOnAnyBroker(String...commands) throws Exception {
         BrokerContainer container = getAnyBroker();
         String[] cmds = new String[commands.length + 1];",1
Fix broken SuppressLint," package eu.siacs.conversations.ui;
 
-import android.annotation.TargetApi;
+import android.annotation.SuppressLint;
 import android.app.PendingIntent;
 import android.content.Context;
 import android.content.IntentSender.SendIntentException;
 import android.graphics.Bitmap;
-import android.os.Build;
 import android.os.Bundle;
 import android.view.LayoutInflater;
 import android.view.Menu;
@@ -260,7 +259,7 @@
 		}
 	}
 
-	@TargetApi(Build.VERSION_CODES.JELLY_BEAN)
+	@SuppressLint(""JELLY_BEAN"")
 	private void setListItemBackgroundOnView(View view) {
 		int sdk = android.os.Build.VERSION.SDK_INT;
 		if (sdk < android.os.Build.VERSION_CODES.JELLY_BEAN) {",1
Pattern-match generator should use full class names in generated code,"             body = pattern(im, 0) + "".of("" + paramTypeName + "".class)"";
         } else {
             final String args = IntStream.rangeClosed(1, arity).mapToObj(i -> ""p"" + i).collect(joining("", ""));
-            final String unapplyRef = classModel.getFullQualifiedName() + ""::"" + name;
+            final String unapplyRef = classModel.getClassName() + ""::"" + name;
             body = String.format(""%s.of(%s, %s, %s)"", pattern(im, arity), paramTypeName + "".class"", args, unapplyRef);
         }
         final List<String> typeArgs = methodModel.getTypeParameters().stream()",1
fix no output of profiler data,"     final StringBuilder buffer = new StringBuilder(super.dump());
 
     if (tips.size() == 0)
-      return buffer.toString();
+      return """";
 
     buffer.append(""TIPS:"");
 ",1
Fixed SpnegoWebflowConfigurer to use the evaluateClientRequest as documented," 
     private void augmentWebflowToStartSpnego(final Flow flow) {
         final ActionState state = getState(flow, CasWebflowConstants.STATE_ID_INIT_LOGIN_FORM, ActionState.class);
-        if (casProperties.getAuthn().getSpnego().isMixedModeAuthentication()) {
-            createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, EVALUATE_SPNEGO_CLIENT, true);
-        } else {
         createTransitionForState(state, CasWebflowConstants.TRANSITION_ID_SUCCESS, START_SPNEGO_AUTHENTICATE, true);
     }
-    }
 
     private void createStartSpnegoAction(final Flow flow) {
         final ActionState actionState = createActionState(flow, START_SPNEGO_AUTHENTICATE, createEvaluateAction(SPNEGO_NEGOTIATE));
@@ -73,6 +69,6 @@
         final ActionState evaluateClientRequest = createActionState(flow, EVALUATE_SPNEGO_CLIENT,
                 createEvaluateAction(casProperties.getAuthn().getSpnego().getHostNameClientActionStrategy()));
         evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_YES, START_SPNEGO_AUTHENTICATE));
-        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, CasWebflowConstants.STATE_ID_VIEW_LOGIN_FORM));
+        evaluateClientRequest.getTransitionSet().add(createTransition(CasWebflowConstants.TRANSITION_ID_NO, getStartState(flow)));
     }
 }",1
"Fix for ACT-2081, use userIdForCandidateAndAssignee for retrieving groups if set","     
     } else if (candidateUser != null) {
       return getGroupsForCandidateUser(candidateUser);
-
-    } else if (userIdForCandidateAndAssignee != null) {
-      return getGroupsForCandidateUser(userIdForCandidateAndAssignee);
     } 
     return null;
   }",1
Fix typo and remove unused import," package gcm.play.android.samples.com.gcmsender;
 
 import org.apache.commons.io.IOUtils;
+import org.json.JSONArray;
 import org.json.JSONObject;
 
 import java.io.IOException;
@@ -30,7 +31,7 @@
 // but it's not meant to serve as an example for a production app server.
 // This class should also not be included in the client (Android) applicaiton
 // since it includes the server's API key. For information on GCM server
-// implementation see: https://developers.google.com/cloud-messaging/server
+// implementaion see: https://developers.google.com/cloud-messaging/server
 public class GcmSender {
 
     public static final String API_KEY = ""API_KEY"";",1
Fix highlight detection in MUC channels," import java.util.Date;
 import java.util.List;
 import java.util.Locale;
-import java.util.regex.Pattern;
-import java.util.regex.Matcher;
 
 import eu.siacs.conversations.R;
 import eu.siacs.conversations.entities.Account;
@@ -325,15 +323,6 @@
 		mNotificationManager.notify(1111, notification);
 	}
 
-	private static Pattern generateNickHighlightPattern(String nick) {
-		// We expect a word boundary, i.e. space or start of string, followed by the
-		// nick (matched in case-insensitive manner), followed by optional
-		// punctuation (for example ""bob: i disagree"" or ""how are you alice?""),
-		// followed by another word boundary.
-		return Pattern.compile(""\\b""+nick+""\\p{Punct}?\\b"",
-				Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);
-	}
-
 	public static void updateNotification(Context context,
 			List<Conversation> conversations, Conversation currentCon, boolean notify) {
 		NotificationManager mNotificationManager = (NotificationManager) context
@@ -354,9 +343,7 @@
 		
 		if ((currentCon != null) &&(currentCon.getMode() == Conversation.MODE_MULTI)&&(!alwaysNotify)) {
 			String nick = currentCon.getMucOptions().getNick();
-			Pattern highlight = generateNickHighlightPattern(nick);
-			Matcher m = highlight.matcher(currentCon.getLatestMessage().getBody());
-			notify = m.find();
+			notify = currentCon.getLatestMessage().getBody().contains(nick);
 		}
 		
 		List<Conversation> unread = new ArrayList<Conversation>();
@@ -466,13 +453,11 @@
 	private static boolean wasHighlighted(Conversation conversation) {
 		List<Message> messages = conversation.getMessages();
 		String nick = conversation.getMucOptions().getNick();
-		Pattern highlight = generateNickHighlightPattern(nick);
 		for(int i = messages.size() - 1; i >= 0; --i) {
 			if (messages.get(i).isRead()) {
 				break;
 			} else {
-				Matcher m = highlight.matcher(messages.get(i).getBody());
-				if (m.find()) {
+				if (messages.get(i).getBody().contains(nick)) {
 					return true;
 				}
 			}",1
Fix SplashScreen race condition on close," import java.awt.event.ActionListener;
 import java.util.Queue;
 
-import javax.swing.SwingUtilities;
 import javax.swing.Timer;
 
 import com.google.common.collect.Queues;
@@ -83,18 +82,12 @@
 
     @Override
     public void close() {
-        SwingUtilities.invokeLater(new Runnable() {
-
-            @Override
-            public void run() {
         SplashScreen splashScreen = SplashScreen.getSplashScreen();
 
-                if (splashScreen != null) {
+        if (splashScreen != null && splashScreen.isVisible()) {
             splashScreen.close();
         }
     }
-        });
-    }
 
     private void update(SplashScreen splashScreen) {
         frame++;",1
Backport fix for #222 in 1.7.x,"                     }
                 }
 
-                if (log.isTraceEnabled()) {
-                    int openChannels = 0;
-                    for (ConcurrentLinkedQueue<IdleChannel> hostChannels: connectionsPool.values()) {
-                        openChannels += hostChannels.size();
-                    }
                 log.trace(String.format(""%d channel open, %d idle channels closed (times: 1st-loop=%d, 2nd-loop=%d).\n"",
-                            openChannels, channelsInTimeout.size(), endConcurrentLoop - currentTime, System.currentTimeMillis() - endConcurrentLoop));
-                }
-
+                        connectionsPool.size(), channelsInTimeout.size(), endConcurrentLoop - currentTime, System.currentTimeMillis() - endConcurrentLoop));
             } catch (Throwable t) {
                 log.error(""uncaught exception!"", t);
             }",1
Fix NPE in CreateGame screen when modules are deleted,"                     // find the first gameplay module that is available
                     for (Name moduleName : config.getDefaultModSelection().listModules()) {
                         Module module = moduleManager.getRegistry().getLatestModuleVersion(moduleName);
-
-                        // module is null if it is no longer present
-                        if (module != null && moduleManager.isGameplayModule(module)) {
+                        if (moduleManager.isGameplayModule(module)) {
                             set(module);
                             return selected;
                         }",1
Fixed issue where debugQuery=true was passed to Solr on every single query," import org.broadleafcommerce.common.extension.ExtensionResultHolder;
 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;
 import org.broadleafcommerce.common.locale.domain.Locale;
-import org.broadleafcommerce.common.util.BLCSystemProperty;
 import org.broadleafcommerce.common.web.BroadleafRequestContext;
 import org.broadleafcommerce.core.catalog.dao.ProductDao;
 import org.broadleafcommerce.core.catalog.dao.SkuDao;
@@ -114,13 +113,6 @@
     @Value(""${solr.global.facets.category.search:false}"")
     protected boolean globalFacetsForCategorySearch;
 
-    /**
-     * @return whether or not to enable debug query info for the SolrQuery
-     */
-    protected boolean shouldShowDebugQuery() {
-        return BLCSystemProperty.resolveBooleanSystemProperty(""solr.showDebugQuery"", false);
-    }
-
     @Override
     public void rebuildIndex() throws ServiceException, IOException {
         solrIndexService.rebuildIndex();
@@ -230,7 +222,7 @@
         
         modifySolrQuery(solrQuery, searchCriteria.getQuery(), facets, searchCriteria, defaultSort);
 
-        solrQuery.setShowDebugInfo(shouldShowDebugQuery());
+        solrQuery.setShowDebugInfo(true);
 
         if (LOG.isTraceEnabled()) {
             try {",1
fix subscription when enable monitor," import com.alibaba.dubbo.rpc.cluster.Cluster;
 import com.alibaba.dubbo.rpc.support.MockInvoker;
 
-import static com.alibaba.dubbo.common.utils.NetUtils.isInvalidLocalHost;
-
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.List;
@@ -227,16 +225,7 @@
         if (ConfigUtils.getPid() > 0) {
             map.put(Constants.PID_KEY, String.valueOf(ConfigUtils.getPid()));
         }
-        //set ip
-        String hostToRegistry = ConfigUtils.getSystemProperty(Constants.DUBBO_IP_TO_REGISTRY);
-        if (hostToRegistry == null || hostToRegistry.length() == 0) {
-            hostToRegistry = NetUtils.getLocalHost();
-        } else if (isInvalidLocalHost(hostToRegistry)) {
-            throw new IllegalArgumentException(""Specified invalid registry ip from property:"" + Constants.DUBBO_IP_TO_REGISTRY + "", value:"" + hostToRegistry);
-        }
-        map.put(Constants.REGISTER_IP_KEY, hostToRegistry);
         appendParameters(map, monitor);
-        appendParameters(map, application);
         String address = monitor.getAddress();
         String sysaddress = System.getProperty(""dubbo.monitor.address"");
         if (sysaddress != null && sysaddress.length() > 0) {",1
Removing own AMQP reconnecting in favor of the library's.,"  */
 package org.graylog2.inputs.transports;
 
+import com.google.common.util.concurrent.Uninterruptibles;
 import com.rabbitmq.client.AMQP;
 import com.rabbitmq.client.Channel;
 import com.rabbitmq.client.Connection;
 import com.rabbitmq.client.ConnectionFactory;
 import com.rabbitmq.client.DefaultConsumer;
 import com.rabbitmq.client.Envelope;
+import com.rabbitmq.client.ShutdownListener;
+import com.rabbitmq.client.ShutdownSignalException;
 import org.graylog2.plugin.inputs.MessageInput;
 import org.graylog2.plugin.journal.RawMessage;
 import org.slf4j.Logger;
@@ -92,7 +95,12 @@
         this.requeueInvalid = requeueInvalid;
         this.amqpTransport = amqpTransport;
 
-        scheduler.scheduleAtFixedRate(() -> lastSecBytesRead.set(lastSecBytesReadTmp.getAndSet(0)), 1, 1, TimeUnit.SECONDS);
+        scheduler.scheduleAtFixedRate(new Runnable() {
+            @Override
+            public void run() {
+                lastSecBytesRead.set(lastSecBytesReadTmp.getAndSet(0));
+            }
+        }, 1, 1, TimeUnit.SECONDS);
     }
 
     public void run() throws IOException {
@@ -148,8 +156,6 @@
         factory.setPort(port);
         factory.setVirtualHost(virtualHost);
         factory.setRequestedHeartbeat(heartbeatTimeout);
-        // explicitly setting this, to ensure it is true even if the default changes.
-        factory.setAutomaticRecoveryEnabled(true);
 
         if (tls) {
             try {
@@ -181,15 +187,35 @@
         if (null != channel && prefetchCount > 0) {
             channel.basicQos(prefetchCount);
 
-            LOG.debug(""AMQP prefetch count overriden to <{}>."", prefetchCount);
+            LOG.info(""AMQP prefetch count overriden to <{}>."", prefetchCount);
         }
 
-        connection.addShutdownListener(cause -> {
+        connection.addShutdownListener(new ShutdownListener() {
+            @Override
+            public void shutdownCompleted(ShutdownSignalException cause) {
                 if (cause.isInitiatedByApplication()) {
-                LOG.info(""Shutting down AMPQ consumer."");
+                    LOG.info(""Not reconnecting connection, we disconnected explicitly."");
                     return;
                 }
-            LOG.warn(""AMQP connection lost! Reconnecting ..."");
+                while (true) {
+                    try {
+                        LOG.error(""AMQP connection lost! Trying reconnect in 1 second."");
+
+                        Uninterruptibles.sleepUninterruptibly(1, TimeUnit.SECONDS);
+
+                        connect();
+
+                        LOG.info(""Connected! Re-starting consumer."");
+
+                        run();
+
+                        LOG.info(""Consumer running."");
+                        break;
+                    } catch (IOException e) {
+                        LOG.error(""Could not re-connect to AMQP broker."", e);
+                    }
+                }
+            }
         });
     }
 ",1
compile fix for java 1.6,"         final long start = System.nanoTime();
         final Future<Boolean> f = putIfAbsentAsyncInternal(key, value, expiryPolicy, true, false);
         try {
-            boolean saved = f.get();
+            boolean saved = toObject(f.get());
             if (statisticsEnabled) {
                 handleStatisticsOnPutIfAbsent(start, saved);
             }
@@ -349,7 +349,7 @@
         final long start = System.nanoTime();
         final Future<Boolean> f = replaceAsyncInternal(key, oldValue, newValue, expiryPolicy, true, true, false);
         try {
-            boolean replaced = f.get();
+            boolean replaced = toObject(f.get());
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(false, start, replaced);
             }
@@ -364,7 +364,7 @@
         final long start = System.nanoTime();
         final Future<Boolean> f = replaceAsyncInternal(key, null, value, expiryPolicy, false, true, false);
         try {
-            boolean replaced = f.get();
+            boolean replaced = toObject(f.get());
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(false, start, replaced);
             }
@@ -379,7 +379,7 @@
         final long start = System.nanoTime();
         final Future<V> f = replaceAndGetAsyncInternal(key, null, value, expiryPolicy, false, true, false);
         try {
-            V oldValue = f.get();
+            V oldValue = toObject(f.get());
             if (statisticsEnabled) {
                 handleStatisticsOnReplace(true, start, oldValue);
             }",1
Fixed connection mock direct writeCharacteristic not callind setValue," 
     @Override
     public Observable<byte[]> writeCharacteristic(@NonNull BluetoothGattCharacteristic bluetoothGattCharacteristic, @NonNull byte[] data) {
-        bluetoothGattCharacteristic.setValue(data);
-
         return Observable.just(data);
     }
 ",1
Fix some typo and clean up AsynchronousLock class,"  */
 public class AsynchronousLock implements Lock {
 
-  private final Vertx vertx;
-  private final Queue<LockWaiter> waiters = new LinkedList<>();
+  private Vertx vertx;
+  private Queue<LockWaiter> waiters = new LinkedList<>();
   private boolean owned;
 
   public AsynchronousLock(Vertx vertx) {
     this.vertx = vertx;
   }
 
+  public AsynchronousLock() {
+  }
+
   public void acquire(long timeout, Handler<AsyncResult<Lock>> resultHandler) {
     Context context = vertx.getOrCreateContext();
     doAcquire(context, timeout, resultHandler);
@@ -55,14 +58,14 @@
       if (!owned) {
         // We now have the lock
         owned = true;
-        lockAcquired(context, resultHandler);
+        lockAquired(context, resultHandler);
       } else {
         waiters.add(new LockWaiter(this, context, timeout, resultHandler));
       }
     }
   }
 
-  private void lockAcquired(Context context, Handler<AsyncResult<Lock>> resultHandler) {
+  private void lockAquired(Context context, Handler<AsyncResult<Lock>> resultHandler) {
     context.runOnContext(v -> resultHandler.handle(Future.succeededFuture(this)));
   }
 
@@ -77,7 +80,7 @@
     }
   }
 
-  private static class LockWaiter {
+  private class LockWaiter {
     final AsynchronousLock lock;
     final Context context;
     final Handler<AsyncResult<Lock>> resultHandler;
@@ -104,7 +107,7 @@
 
     void acquire(AsynchronousLock lock) {
       acquired = true;
-      lock.lockAcquired(context, resultHandler);
+      lock.lockAquired(context, resultHandler);
     }
 
   }",1
Fixed spelling error in Database.java,"             setAutoCommit( isAutoCommit() );
           }
         } catch ( Exception e ) {
-          throw new KettleDatabaseException( ""Error occurred while trying to connect to the database"", e );
+          throw new KettleDatabaseException( ""Error occured while trying to connect to the database"", e );
         }
       } else {
         connectUsingClass( databaseMeta.getDriverClass(), partitionId );
@@ -424,7 +424,7 @@
         }
       }
     } catch ( Exception e ) {
-      throw new KettleDatabaseException( ""Error occurred while trying to connect to the database"", e );
+      throw new KettleDatabaseException( ""Error occured while trying to connect to the database"", e );
     }
   }
 ",1
shutdown bug fix,"                 thread.shutdown();
             }
             synchronized (ticket) {
-                ticket.notifyAll();
+                ticket.notify();
             }
         }
     }",1
Fixed incorrect vanilla biome entries in BiomeDictionary,"         addTypes(Biomes.EXTREME_HILLS_WITH_TREES,         MOUNTAIN, FOREST,     SPARSE                            );
         addTypes(Biomes.SAVANNA,                          HOT,      SAVANNA,    PLAINS,   SPARSE                  );
         addTypes(Biomes.SAVANNA_PLATEAU,                  HOT,      SAVANNA,    PLAINS,   SPARSE,   RARE          );
-        addTypes(Biomes.MESA,                             MESA,     SANDY,      DRY                               );
-        addTypes(Biomes.MESA_ROCK,                        MESA,     SANDY,      DRY,      SPARSE                  );
-        addTypes(Biomes.MESA_CLEAR_ROCK,                  MESA,     SANDY,      DRY                               );
+        addTypes(Biomes.MESA,                             MESA,     SANDY                                         );
+        addTypes(Biomes.MESA_ROCK,                        MESA,     SPARSE,     SANDY                             );
+        addTypes(Biomes.MESA_CLEAR_ROCK,                  MESA,     SANDY                                         );
         addTypes(Biomes.VOID,                             VOID                                                    );
         addTypes(Biomes.MUTATED_PLAINS,                   PLAINS,   RARE                                          );
         addTypes(Biomes.MUTATED_DESERT,                   HOT,      DRY,        SANDY,    RARE                    );
@@ -465,9 +465,9 @@
         addTypes(Biomes.MUTATED_EXTREME_HILLS_WITH_TREES, MOUNTAIN, SPARSE,     RARE                              );
         addTypes(Biomes.MUTATED_SAVANNA,                  HOT,      DRY,        SPARSE,   SAVANNA,  MOUNTAIN, RARE);
         addTypes(Biomes.MUTATED_SAVANNA_ROCK,             HOT,      DRY,        SPARSE,   SAVANNA,  HILLS,    RARE);
-        addTypes(Biomes.MUTATED_MESA,                     HOT,      DRY,        SPARSE,   MOUNTAIN, RARE          );
+        addTypes(Biomes.MUTATED_MESA,                     HOT,      DRY,        SPARSE,   SAVANNA,  MOUNTAIN, RARE);
         addTypes(Biomes.MUTATED_MESA_ROCK,                HOT,      DRY,        SPARSE,   HILLS,    RARE          );
-        addTypes(Biomes.MUTATED_MESA_CLEAR_ROCK,          HOT,      DRY,        SPARSE,   MOUNTAIN, RARE          );
+        addTypes(Biomes.MUTATED_MESA_CLEAR_ROCK,          HOT,      DRY,        SPARSE,   SAVANNA,  MOUNTAIN, RARE);
 
 
         if (DEBUG)",1
TFJ-698 & TFJ-699 bug fix.,"         this.limit = limit;
         this.remaining = remaining;
         this.resetTimeInSeconds = resetTimeInSeconds;
-        this.secondsUntilReset = (int) ((resetTimeInSeconds * 1000L - System.currentTimeMillis()) / 1000);
+        this.secondsUntilReset = (int) ((resetTimeInSeconds * 1000 - System.currentTimeMillis()) / 1000);
     }
 
     RateLimitStatusJSONImpl(JSONObject json) throws TwitterException {
@@ -87,7 +87,7 @@
         this.limit = getInt(""limit"", json);
         this.remaining = getInt(""remaining"", json);
         this.resetTimeInSeconds = getInt(""reset"", json);
-        this.secondsUntilReset = (int) ((resetTimeInSeconds * 1000L - System.currentTimeMillis()) / 1000);
+        this.secondsUntilReset = (int) ((resetTimeInSeconds * 1000 - System.currentTimeMillis()) / 1000);
     }
 
     static RateLimitStatus createFromResponseHeader(HttpResponse res) {
@@ -113,7 +113,7 @@
         String reset = res.getResponseHeader(""X-Rate-Limit-Reset"");
         if (reset != null) {
             long longReset = Long.parseLong(reset);
-            resetTimeInSeconds = (int) longReset;
+            resetTimeInSeconds = (int) (longReset / 1000);
         } else {
             return null;
         }",1
data race for AppEventsLogger.stateMap fixed,"     static class PersistedEvents {
         static final String PERSISTED_EVENTS_FILENAME = ""AppEventsLogger.persistedevents"";
 
+        private static Object staticLock = new Object();
+
         private Context context;
         private HashMap<AccessTokenAppIdPair, List<AppEvent>> persistedEvents =
                 new HashMap<AccessTokenAppIdPair, List<AppEvent>>();",1
#1377 Added debug method to method for printing generated material shade...," 	protected VertexShader mCustomVertexShader;
 	protected FragmentShader mCustomFragmentShader;
 
-    private boolean debug;
-
 	/**
 	 * The Material class is where you define the visual characteristics of your 3D model.
 	 * Here you can specify lighting parameters, specular highlights, ambient colors and much more.
@@ -275,10 +273,6 @@
 		mCustomFragmentShader = customFragmentShader;
 	}
 	
-    public void setDebug(boolean flag) {
-        debug = flag;
-    }
-	
 	/**
  	 * Indicates that this material should use a color value for every vertex. These colors are
 	 * contained in a separate color buffer. 
@@ -661,6 +655,12 @@
 			
 			mVertexShader.buildShader();
 			mFragmentShader.buildShader();
+			/*
+			RajLog.d(""-=-=-=- VERTEX SHADER -=-=-=-"");
+			RajLog.d(mVertexShader.getShaderString());
+			RajLog.d(""-=-=-=- FRAGMENT SHADER -=-=-=-"");
+			RajLog.d(mFragmentShader.getShaderString());
+			*/
 		}
 		else
 		{
@@ -672,13 +672,12 @@
 
 			if(mVertexShader.needsBuild()) mVertexShader.buildShader();
 			if(mFragmentShader.needsBuild()) mFragmentShader.buildShader();
-		}
-
-        if (debug) {
+			/*
 			RajLog.d(""-=-=-=- VERTEX SHADER -=-=-=-"");
 			RajLog.d(mVertexShader.getShaderString());
 			RajLog.d(""-=-=-=- FRAGMENT SHADER -=-=-=-"");
 			RajLog.d(mFragmentShader.getShaderString());
+			*/
 		}
 		
 		mProgramHandle = createProgram(mVertexShader.getShaderString(), mFragmentShader.getShaderString());",1
Fix crashing bugs that happen when the user's name has non-ASCII characters on Windows.,"       String decodedPath = PApplet.urlDecode(path);
 
       if (decodedPath.contains(""/app/bin"")) {  // This means we're in Eclipse
-        final File build = new File(decodedPath, ""../../build"").getAbsoluteFile();
         if (Platform.isMacOS()) {
-          processingRoot = new File(build, ""macosx/work/Processing.app/Contents/Java"");
+          processingRoot =
+            new File(path, ""../../build/macosx/work/Processing.app/Contents/Java"");
         } else if (Platform.isWindows()) {
-          processingRoot =  new File(build, ""windows/work"");
+          processingRoot =  new File(path, ""../../build/windows/work"");
         } else if (Platform.isLinux()) {
-          processingRoot =  new File(build, ""linux/work"");
+          processingRoot =  new File(path, ""../../build/linux/work"");
         }
       } else {
         // The .jar file will be in the lib folder
@@ -311,8 +311,7 @@
           System.err.println(""Could not find lib folder via "" +
             jarFolder.getAbsolutePath() +
             "", switching to user.dir"");
-          final String userDir = System.getProperty(""user.dir"");
-          processingRoot = new File(PApplet.urlDecode(userDir));
+          processingRoot = new File(System.getProperty(""user.dir""));
         }
       }
     }",1
JENKINS-50452# Fix node graph visitor log levels,"                 throw t;
             }
         } else {
-            logger.debug(""Could not find execution for run "" + run.getExternalizableId());
+            logger.error(""Could not find execution for run "" + run.getExternalizableId());
         }
     }
 
@@ -271,7 +271,7 @@
         }
 
         if(nestedbranches.size() != parallelBranchEndNodes.size()){
-            logger.debug(String.format(""nestedBranches size: %s not equal to parallelBranchEndNodes: %s"",
+            logger.error(String.format(""nestedBranches size: %s not equal to parallelBranchEndNodes: %s"",
                     nestedbranches.size(), parallelBranchEndNodes.size()));
             return;
         }
@@ -419,7 +419,7 @@
     }
 
     private void dump(String str){
-        logger.debug(System.identityHashCode(this) + "": ""+ str);
+        System.out.println(System.identityHashCode(this) + "": ""+ str);
     }
 
     /**",1
fix indentation,"     }
 
 	@Override
-    public boolean relaxedOffer(final E message) {
+	public boolean relaxedOffer(E message) {
 		return offer(message);
 	}
 ",1
fix #3173 - iterate filtered paths,"         final Set<String> filteredTags = new HashSet<>();
 
         Paths clonedPaths = new Paths();
-        for (String resourcePath : filteredOpenAPI.getPaths().keySet()) {
-            PathItem pathItem = filteredOpenAPI.getPaths().get(resourcePath);
+        for (String resourcePath : openAPI.getPaths().keySet()) {
+            PathItem pathItem = openAPI.getPaths().get(resourcePath);
 
             PathItem filteredPathItem = filterPathItem(filter, pathItem, resourcePath, params, cookies, headers);
 ",1
Fix possible crash in EventBus,"     public void unregister(Object object)
     {
         ArrayList<IEventListener> list = listeners.remove(object);
-        if (list == null)
-            return;
         for (IEventListener listener : list)
         {
             ListenerList.unregisterAll(busID, listener);",1
Fix: Use the correct reference.,"           // copy the sketch inside
           File properPdeFile = new File(properFolder, sketchFile.getName());
           try {
-            Base.copyFile(sketchFile, properPdeFile);
+            Base.copyFile(file, properPdeFile);
           } catch (IOException e) {
             Base.showWarning(_(""Error""), _(""Could not copy to a proper location.""), e);
             return false;",1
"Revert ""Fix: SignleTop launch mode"""," 					}
 				}
 			} break;
+			case ONLY_TOP : {
+				marked = false;
+			} break;
 		}
 
 		return marked;
@@ -239,7 +242,7 @@
 
 		switch (info.launchMode) {
 			case LAUNCH_SINGLE_TOP : {
-				clearTarget = ClearTarget.AFTER_TOP;
+				clearTarget = ClearTarget.ONLY_TOP;
 				if (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {
 					reuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
 							? ReuseTarget.MULTIPLE
@@ -593,7 +596,9 @@
 		NOTHING,
 		SPEC_ACTIVITY,
 		FULL_TASK(true),
-		AFTER_TOP(true);
+		AFTER_TOP(true),
+		ONLY_TOP(true);
+
 		boolean deliverIntent;
 
 		ClearTarget() {",1
Fixes issue 1566," 
         checkForCorruptedDataBaseFiles();
 
-        String bitcoinLocalhostNodeKey = ""bitcoinLocalhostNode"";
-        if (bisqEnvironment.isBitcoinLocalhostNodeRunning() && preferences.showAgain(bitcoinLocalhostNodeKey)) {
-            new Popup<>().backgroundInfo(Res.get(""popup.bitcoinLocalhostNode.msg""))
-                    .dontShowAgainId(bitcoinLocalhostNodeKey)
-                    .show();
-        }
-
         allBasicServicesInitialized = true;
     }
 ",1
Initialise the source of the Alert always," // ZAP: 2016/10/11 Issue 2592: Differentiate the source of alerts
 // ZAP: 2017/02/22 Issue 3224: Use TreeCellRenderers to prevent HTML injection issues
 // ZAP: 2017/08/30: Issue 1984: Ensure element setters set empty string if passed a null value
-// ZAP: 2017/09/15 Initialise the source from the RecordAlert always.
 
 package org.parosproxy.paros.core.scanner;
 
@@ -227,11 +226,18 @@
 
 	public Alert(RecordAlert recordAlert) {
 	    this(recordAlert.getPluginId(), recordAlert.getRisk(), recordAlert.getConfidence(), recordAlert.getAlert());
+	    // ZAP: Set the alertId
+	    this.alertId = recordAlert.getAlertId();
+	    this.source = Source.getSource(recordAlert.getSourceId());
+        try {
+        	HistoryReference hRef = new HistoryReference(recordAlert.getHistoryId());
+            setDetail(recordAlert.getDescription(), recordAlert.getUri(), 
+            		recordAlert.getParam(), recordAlert.getAttack(), recordAlert.getOtherInfo(), 
+            		recordAlert.getSolution(), recordAlert.getReference(),
+            		recordAlert.getEvidence(), recordAlert.getCweId(), recordAlert.getWascId(),
+            		null);
 
-        HistoryReference hRef = null;
-        try {
-            hRef = new HistoryReference(recordAlert.getHistoryId());
-
+            setHistoryRef(hRef);
         } catch (HttpMalformedHeaderException e) {
         	// ZAP: Just an indication the history record doesnt exist
         	logger.debug(e.getMessage(), e);
@@ -240,31 +246,18 @@
         	logger.error(e.getMessage(), e);
         }
 	    
-        init(recordAlert, hRef);
-	}
-
-	private void init(RecordAlert recordAlert, HistoryReference ref) {
-		this.alertId = recordAlert.getAlertId();
-		this.source = Source.getSource(recordAlert.getSourceId());
-		setDetail(
-				recordAlert.getDescription(),
-				recordAlert.getUri(),
-				recordAlert.getParam(),
-				recordAlert.getAttack(),
-				recordAlert.getOtherInfo(),
-				recordAlert.getSolution(),
-				recordAlert.getReference(),
-				recordAlert.getEvidence(),
-				recordAlert.getCweId(),
-				recordAlert.getWascId(),
-				null);
-		setHistoryRef(ref);
 	}
 	
 	public Alert(RecordAlert recordAlert, HistoryReference ref) {
 	    this(recordAlert.getPluginId(), recordAlert.getRisk(), recordAlert.getConfidence(), recordAlert.getAlert());
-
-		init(recordAlert, ref);
+	    // ZAP: Set the alertId
+	    this.alertId = recordAlert.getAlertId();
+        setDetail(recordAlert.getDescription(), recordAlert.getUri(), 
+        		recordAlert.getParam(), recordAlert.getAttack(), recordAlert.getOtherInfo(), 
+        		recordAlert.getSolution(), recordAlert.getReference(), 
+        		recordAlert.getEvidence(), recordAlert.getCweId(), recordAlert.getWascId(),
+        		null);
+        setHistoryRef(ref);
 	}
 	/**
 	 * @deprecated  (2.4.0) Replaced by {@link #setRiskConfidence(int, int)}.",1
Prompt the user to give the L suffix on numbers,"           exception = new SketchException(errorMessage);
         }
 
-        String[] parts = null;
-
         if (errorMessage.startsWith(""The import "") &&
             errorMessage.endsWith(""cannot be resolved"")) {
           // The import poo cannot be resolved
@@ -255,18 +253,9 @@
           // ""Duplicate nested type xxx""
           // ""Duplicate local variable xxx""
 
-        } else if (null != (parts = PApplet.match(errorMessage,
-                ""literal (\\S*) of type (\\S*) is out of range""))) {
-          if (""int"".equals(parts[2])) {
-            exception.setMessage(""The type int can't handle numbers that big. Try ""
-                + parts[1] + ""L to upgrade to long."");
         } else {
-            // I'd like to give an essay on BigInteger and BigDecimal, but
-            // this margin is too narrow to contain it.
-            exception.setMessage(""Even the type "" + parts[2] + "" can't handle ""
-                + parts[1] + "". Research big numbers in Java."");
-          }
-        } else {
+          String[] parts = null;
+
           // The method xxx(String) is undefined for the type Temporary_XXXX_XXXX
           //xxx(""blah"");
           // The method xxx(String, int) is undefined for the type Temporary_XXXX_XXXX",1
Don't add account if user cancels. Fixes #2797," 
 		@Override
 		public void onClick(final View v) {
-			deleteAccountAndReturnIfNecessary();
+			deleteMagicCreatedAccountAndReturnIfNecessary();
 			finish();
 		}
 	};
@@ -296,22 +296,23 @@
 
 	@Override
 	public boolean onNavigateUp() {
-		deleteAccountAndReturnIfNecessary();
+		deleteMagicCreatedAccountAndReturnIfNecessary();
 		return super.onNavigateUp();
 	}
 
 	@Override
 	public void onBackPressed() {
-		deleteAccountAndReturnIfNecessary();
+		deleteMagicCreatedAccountAndReturnIfNecessary();
 		super.onBackPressed();
 	}
 
-	private void deleteAccountAndReturnIfNecessary() {
-		if (mInitMode && mAccount != null && !mAccount.isOptionSet(Account.OPTION_LOGGED_IN_SUCCESSFULLY)) {
+	private void deleteMagicCreatedAccountAndReturnIfNecessary() {
+		if (Config.MAGIC_CREATE_DOMAIN != null
+				&& mAccount != null
+				&& mAccount.isOptionSet(Account.OPTION_MAGIC_CREATE)
+				&& mAccount.isOptionSet(Account.OPTION_REGISTER)
+				&& xmppConnectionService.getAccounts().size() == 1) {
 			xmppConnectionService.deleteAccount(mAccount);
-		}
-
-		if (xmppConnectionService.getAccounts().size() == 0) {
 			Intent intent = new Intent(EditAccountActivity.this, WelcomeActivity.class);
 			WelcomeActivity.addInviteUri(intent, getIntent());
 			startActivity(intent);",1
Fix extranneous boxing and also fix use of binarySearch," import com.facebook.stetho.common.Accumulator;
 import com.facebook.stetho.common.ArrayListAccumulator;
 import com.facebook.stetho.common.LogUtil;
-import com.facebook.stetho.common.Util;
 import com.facebook.stetho.inspector.helper.ObjectIdMapper;
 import com.facebook.stetho.inspector.helper.ThreadBoundProxy;
 
@@ -345,7 +344,11 @@
     // TODO: it'd be nice if we could delegate our calls into mPeerManager.sendNotificationToPeers()
     //       to a background thread so as to offload the UI from JSON serialization stuff
 
-    // Applying the ShadowDocument.Update is done in five stages:
+    // Applying the ShadowDocument.Update is done in five stages. You may notice that the code is
+    // calling mObjectIdMapper.getIdForObject(), which returns Integer and whose return is annotated
+    // with @Nullable, and storing it in an int without doing a null check. This is intentional: if
+    // the element being requested is not in mObjectIdMapper, then that indicates a pretty serious
+    // bug in the implementation of this algorithm. It's a cheap runtime assert, in other words.
 
     // Stage 1: any elements that have been disconnected from the tree, and any elements in those
     // sub-trees which have not been reconnected to the tree, should be garbage collected. For now
@@ -366,7 +369,7 @@
     docUpdate.getGarbageElements(new Accumulator<Object>() {
       @Override
       public void store(Object element) {
-        Integer nodeId = Util.throwIfNull(mObjectIdMapper.getIdForObject(element));
+        int nodeId = mObjectIdMapper.getIdForObject(element);
         ElementInfo newElementInfo = docUpdate.getElementInfo(element);
 
         // Only raise onChildNodeRemoved for the root of a disconnected tree. The remainder of the
@@ -390,10 +393,10 @@
     docUpdate.getChangedElements(new Accumulator<Object>() {
       @Override
       public void store(Object element) {
-        Integer nodeId = Util.throwIfNull(mObjectIdMapper.getIdForObject(element));
+        int nodeId = mObjectIdMapper.getIdForObject(element);
 
         // Skip garbage elements
-        if (Collections.binarySearch(garbageElementIds, nodeId) >= 0) {
+        if (Collections.binarySearch(garbageElementIds, nodeId) > 0) {
           return;
         }
 ",1
fix typo (doirplugin -> droidplugin),"  */
 public class PluginManager implements ServiceConnection {
 
-    public static final String ACTION_PACKAGE_ADDED = ""com.morgoo.droidplugin.PACKAGE_ADDED"";
-    public static final String ACTION_PACKAGE_REMOVED = ""com.morgoo.droidplugin.PACKAGE_REMOVED"";
+    public static final String ACTION_PACKAGE_ADDED = ""com.morgoo.doirplugin.PACKAGE_ADDED"";
+    public static final String ACTION_PACKAGE_REMOVED = ""com.morgoo.doirplugin.PACKAGE_REMOVED"";
     public static final String ACTION_DROIDPLUGIN_INIT = ""com.morgoo.droidplugin.ACTION_DROIDPLUGIN_INIT"";
     public static final String ACTION_MAINACTIVITY_ONCREATE = ""com.morgoo.droidplugin.ACTION_MAINACTIVITY_ONCREATE"";
     public static final String ACTION_MAINACTIVITY_ONDESTORY = ""com.morgoo.droidplugin.ACTION_MAINACTIVITY_ONDESTORY"";",1
fix metric complete bug," 	public void complete() {
 		setCompleted(true);
 
-		if (m_manager != null) {
+		if (m_manager != null && m_manager.getThreadLocalMessageTree().getMessage() == null) {
 			m_manager.add(this);
 		}
 	}",1
Fixes #87,"   private final ScanCallback mScanCallback = new ScanCallback() {
     @Override
     public void onScanResult(int callbackType, ScanResult scanResult) {
-      UriBeacon uriBeacon = UriBeacon.parseFromBytes(scanResult.getScanRecord().getBytes());
-      if (uriBeacon != null) {
-        String url = uriBeacon.getUriString();
+      String address = scanResult.getDevice().getAddress();
       switch (callbackType) {
         case ScanSettings.CALLBACK_TYPE_FIRST_MATCH:
-            if (mDeviceAddressesFound.add(url)) {
+          if (mDeviceAddressesFound.add(address)) {
             updateNearbyDevicesNotification();
           }
           break;
         case ScanSettings.CALLBACK_TYPE_MATCH_LOST:
-            if (mDeviceAddressesFound.remove(url)) {
+          if (mDeviceAddressesFound.remove(address)) {
             updateNearbyDevicesNotification();
           }
           break;
@@ -136,7 +134,6 @@
           Log.e(TAG, ""Unrecognized callback type constant received: "" + callbackType);
       }
     }
-    }
 
     @Override
     public void onScanFailed(int errorCode) {",1
fix first start activity with flag=0x24000000,"                     deliverNewIntentLocked(sourceRecord, topRecord, intent);
                     delivered = true;
                 }
-                if (isClearTop_SingleTop && hasActivity(topRecord, intent.getComponent())) {
+                if (isClearTop_SingleTop) {
                     topRecord.marked = false;
                     deliverNewIntentLocked(sourceRecord, topRecord, intent);
                     delivered = true;
@@ -612,14 +612,6 @@
         }
     }
 
-    private boolean hasActivity(ActivityRecord topRecord, ComponentName component) {
-        for (ActivityRecord ar : topRecord.task.activities) {
-            if (component.equals(ar.component)) {
-                return true;
-            }
-        }
-        return false;
-    }
 
     private enum ClearTarget {
         NOTHING,",1
fix creating processEngine with instance of ProcessEngineConfigurationIm...,"     }
 
     protected void configureExternallyManagedTransactions() {
-        if (processEngineConfiguration instanceof SpringProcessEngineConfiguration) { // remark: any config can be injected, so we cannot have SpringConfiguration as member
         SpringProcessEngineConfiguration engineConfiguration = (SpringProcessEngineConfiguration) processEngineConfiguration;
         if (engineConfiguration.getTransactionManager() != null) {
             processEngineConfiguration.setTransactionsExternallyManaged(true);
         }
     }
-    }
 
     public Class<ProcessEngine> getObjectType() {
         return ProcessEngine.class;",1
[golang] Fix code gen for MetaAttributes. Issue #620.,"             final Token varDataToken = Generators.findFirst(""varData"", tokens, i);
             final String characterEncoding = varDataToken.encoding().characterEncoding();
 
-            generateFieldMetaAttributeMethod(sb, typeName, propertyName, token);
+            generateFieldMetaAttributeMethod(sb, typeName, token);
             generateVarDataDescriptors(sb, token, typeName, propertyName, characterEncoding, lengthOfLengthField);
 
             i += token.componentTokenCount();
@@ -2085,7 +2085,7 @@
 
                 generateId(sb, containingTypeName, propertyName, signalToken);
                 generateSinceActingDeprecated(sb, containingTypeName, propertyName, signalToken);
-                generateFieldMetaAttributeMethod(sb, containingTypeName, propertyName, signalToken);
+                generateFieldMetaAttributeMethod(sb, containingTypeName, signalToken);
 
                 switch (encodingToken.signal())
                 {
@@ -2113,7 +2113,6 @@
     private static void generateFieldMetaAttributeMethod(
         final StringBuilder sb,
         final String containingTypeName,
-        final String propertyName,
         final Token token)
     {
         final Encoding encoding = token.encoding();
@@ -2123,21 +2122,20 @@
         final String presence = encoding.presence() == null ? """" : encoding.presence().toString().toLowerCase();
 
         sb.append(String.format(
-            ""\nfunc (*%1$s) %2$sMetaAttribute(meta int) string {\n"" +
+            ""\nfunc (*%1$s) %3$sMetaAttribute(meta int) string {\n"" +
             ""\tswitch meta {\n"" +
             ""\tcase 1:\n"" +
+            ""\t\treturn \""%2$s\""\n"" +
+            ""\tcase 2:\n"" +
             ""\t\treturn \""%3$s\""\n"" +
-            ""\tcase 2:\n"" +
+            ""\tcase 3:\n"" +
             ""\t\treturn \""%4$s\""\n"" +
-            ""\tcase 3:\n"" +
+            ""\tcase 4:\n"" +
             ""\t\treturn \""%5$s\""\n"" +
-            ""\tcase 4:\n"" +
-            ""\t\treturn \""%6$s\""\n"" +
             ""\t}\n"" +
             ""\treturn \""\""\n"" +
             ""}\n"",
             containingTypeName,
-            propertyName,
             epoch,
             timeUnit,
             semanticType,",1
Mongo fix,"             ""org.keycloak.models.mongo.keycloak.entities.MongoRoleEntity"",
             ""org.keycloak.models.mongo.keycloak.entities.MongoGroupEntity"",
             ""org.keycloak.models.mongo.keycloak.entities.MongoClientEntity"",
-            ""org.keycloak.models.mongo.keycloak.entities.MongoClientTemplateEntity"",
             ""org.keycloak.models.mongo.keycloak.entities.MongoUserConsentEntity"",
             ""org.keycloak.models.mongo.keycloak.entities.MongoMigrationModelEntity"",
             ""org.keycloak.models.mongo.keycloak.entities.MongoOnlineUserSessionEntity"",",1
Minor typo in exception message of DefaultChannelHandlerContext,"             }
 
             if (buf == null) {
-                throw new ChannelPipelineException(""A user handler's newOutboundBuffer() returned null"");
+                throw new ChannelPipelineException(""A user handler's newInboundBuffer() returned null"");
             }
 
             if (buf instanceof ByteBuf) {",1
Fix small todo in MethodDeclaration.," 
 	public MethodDeclaration(final int modifiers, final List<AnnotationExpr> annotations,
 			final List<TypeParameter> typeParameters, final Type type, final String name,
-			final List<Parameter> parameters, final int arrayCount, final List<ReferenceType> throws_, final BlockStmt body) {
+			final List<Parameter> parameters, final int arrayCount, final List<ReferenceType> throws_, final BlockStmt block) {
 		super(annotations);
 		setModifiers(modifiers);
 		setTypeParameters(typeParameters);
@@ -85,13 +85,13 @@
 		setParameters(parameters);
 		setArrayCount(arrayCount);
 		setThrows(throws_);
-		setBody(body);
+		setBody(block);
 	}
 
 	public MethodDeclaration(final int beginLine, final int beginColumn, final int endLine, final int endColumn,
 			final int modifiers, final List<AnnotationExpr> annotations,
 			final List<TypeParameter> typeParameters, final Type type, final String name,
-			final List<Parameter> parameters, final int arrayCount, final List<ReferenceType> throws_, final BlockStmt body) {
+			final List<Parameter> parameters, final int arrayCount, final List<ReferenceType> throws_, final BlockStmt block) {
 		super(beginLine, beginColumn, endLine, endColumn, annotations);
 		setModifiers(modifiers);
 		setTypeParameters(typeParameters);
@@ -100,7 +100,7 @@
 		setParameters(parameters);
 		setArrayCount(arrayCount);
 		setThrows(throws_);
-		setBody(body);
+		setBody(block);
 	}
 
 	@Override public <R, A> R accept(final GenericVisitor<R, A> v, final A arg) {
@@ -115,6 +115,7 @@
 		return arrayCount;
 	}
 
+	// FIXME this is called ""Block"" in the constructor. Pick one.
 	public BlockStmt getBody() {
 		return body;
 	}",1
loot tracker: validate boxes after rebuilding," 			subTitleLabel.setText(""x "" + kills);
 		}
 
-		validate();
 		repaint();
 	}
 ",1
Fix file descriptor leak on LinuxBrokerHostUsageImpl," import java.util.List;
 import java.util.concurrent.TimeUnit;
 import java.util.stream.Collectors;
-import java.util.stream.Stream;
 
 /**
  * Class that will return the broker host usage.
@@ -121,8 +120,8 @@
      * this would include iowait, irq and steal.
      */
     private CpuStat getTotalCpuUsage() {
-        try (Stream<String> stream = Files.lines(Paths.get(""/proc/stat""))) {
-            String[] words = stream
+        try {
+            String[] words = Files.lines(Paths.get(""/proc/stat""))
                     .findFirst()
                     .get().split(""\\s+"");
 
@@ -147,8 +146,8 @@
     }
 
     private List<String> getNics() {
-        try (Stream<Path> stream = Files.list(Paths.get(""/sys/class/net/""))) {
-            return stream
+        try {
+            return Files.list(Paths.get(""/sys/class/net/""))
                     .filter(this::isPhysicalNic)
                     .map(path -> path.getFileName().toString())
                     .collect(Collectors.toList());",1
Fix mischievous Javadoc comment in io.undertow.server.HttpServerExcha…,"     }
 
     /**
-     * Get the destination address of the HTTP request.
+     * Get the source address of the HTTP request.
      *
-     * @return the destination address of the HTTP request
+     * @return the source address of the HTTP request
      */
     public InetSocketAddress getDestinationAddress() {
         if (destinationAddress != null) {",1
Fix some typos,"  * Custom argument matchers via {@link ArgumentMatcher} are usually better for stubbing.
  *
  * <p>
- * This utility class <strong>*doesn't do any type checks*</strong>. The generic signatures are only there to avoid casting
+ * This utility class <strong>*don't do any type checks*</strong>, the generic signatures are only there to avoid casting
  * in your code.
  * <p>
  * There is an <strong>annotation</strong> that you might find useful: &#64;{@link Captor}
@@ -136,7 +136,7 @@
     /**
      * Build a new <code>ArgumentCaptor</code>.
      * <p>
-     * Note that an <code>ArgumentCaptor</code> <b>*doesn't do any type checks*</b>. It is only there to avoid casting
+     * Note that an <code>ArgumentCaptor</code> <b>*don't do any type checks*</b>, it is only there to avoid casting
      * in your code. This might however change (type checks could be added) in a
      * future major release.
      *",1
fixed broken build........," package com.badlogic.gdx.math;
 
 public class Polyline implements Shape2D {
-	private float[] localVertices;
+	private final float[] localVertices;
 	private float[] worldVertices;
 	private float x, y;
 	private float originX, originY;",1
Fix potential infinite loop in AbstractFramedChannel#flushSenders,"                     }
                 }
 
-            } catch (IOException|RuntimeException e) {
+            } catch (IOException e) {
                 safeClose(channel);
                 markWritesBroken(e);
             }",1
CoxPH: Fix typo in CoxPH validation,"         }
       }
 
-      if ((_parms._stop_column != null) && ! _parms.stopVec().isNumeric())
+      if ((_parms._start_column != null) && ! _parms.stopVec().isNumeric())
         error(""stop_column"", ""stop time must be of type numeric"");
 
       if ((_parms._response_column != null) && ! _response.isInt() && (! _response.isCategorical()))",1
Fix SettingsActivity,"         TextView showBoundsText = (TextView) showBoundsContainer.findViewById(R.id.text);
 
         ViewGroup showOffsetsContainer = (ViewGroup) findViewById(R.id.show_offsets);
-        SwitchCompat showOffsetsSwitch =  (SwitchCompat) showOffsetsContainer.findViewById(R.id.the_switch);
-        TextView showOffsetsText = (TextView) showOffsetsContainer.findViewById(R.id.text);
+        SwitchCompat showOffsetsSwitch =  (SwitchCompat) showBoundsContainer.findViewById(R.id.the_switch);
+        TextView showOffsetsText = (TextView) showBoundsContainer.findViewById(R.id.text);
 
         showBoundsText.setText(R.string.show_bounds);
         showOffsetsText.setText(R.string.show_offsets);",1
fix tile?,"  */
 public class Tile extends DynamicCustomOp {
     private int[] axis;
-    private boolean is_static_reps = false;
 
     public Tile(SameDiff sameDiff, SDVariable i_v, int[] axis) {
         super(null,sameDiff, new SDVariable[]{i_v}, false);
         this.axis = axis;
-        addArguments();
+        addIArgument(axis);
     }
 
     public Tile() {}
 
-    private void addArguments() {
-        this.is_static_reps = true;
-        addIArgument(axis);
-    }
+
 
     @Override
     public void initFromTensorFlow(NodeDef nodeDef, SameDiff initWith, Map<String, AttrValue> attributesForNode, GraphDef graph) {
@@ -61,7 +57,7 @@
         val arr = TFGraphMapper.getInstance().getNDArrayFromTensor(""value"",lastNode,graph);
         if(arr != null) {
             this.axis = arr.data().asInt();
-            addArguments();
+            addIArgument(axis);
         }
 
 
@@ -109,9 +105,6 @@
          *
          * And during actual op invocation both inputs should be available due to topo sort
          */
-        if (is_static_reps)
-            return Nd4j.getExecutioner().calculateOutputShape(this);
-
         if (inputArguments().length < 2)
             return Collections.emptyList();
 
@@ -127,7 +120,6 @@
             return Nd4j.getExecutioner().calculateOutputShape(this);
     }
 
-
     @Override
     public String opName() {
         return ""tile"";",1
[java] Fix Issue 1343: Update CommentDefaultAccessModifierRule," 
 package net.sourceforge.pmd.lang.java.rule.codestyle;
 
-import java.util.*;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Set;
 
+import net.sourceforge.pmd.lang.java.ast.ASTAnnotation;
 import net.sourceforge.pmd.lang.java.ast.ASTAnyTypeDeclaration;
+import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceBodyDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;
 import net.sourceforge.pmd.lang.java.ast.ASTConstructorDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTFieldDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;
 import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclarator;
+import net.sourceforge.pmd.lang.java.ast.ASTName;
 import net.sourceforge.pmd.lang.java.ast.ASTVariableDeclaratorId;
 import net.sourceforge.pmd.lang.java.ast.AbstractAnyTypeDeclaration;
 import net.sourceforge.pmd.lang.java.ast.AbstractJavaAccessNode;
 import net.sourceforge.pmd.lang.java.ast.Comment;
-import net.sourceforge.pmd.lang.java.rule.AbstractIgnoredAnnotationRule;
+import net.sourceforge.pmd.lang.java.rule.documentation.AbstractCommentRule;
 import net.sourceforge.pmd.properties.RegexProperty;
 
 /**
  * Check for Methods, Fields and Nested Classes that have a default access
  * modifier
- * This rule ignores all nodes annotated with @VisibleForTesting by default.
- * Use the ignoredAnnotationsDescriptor property to customize the ignored rules.
  *
  * @author Damián Techeira
  */
-public class CommentDefaultAccessModifierRule extends AbstractIgnoredAnnotationRule {
+public class CommentDefaultAccessModifierRule extends AbstractCommentRule {
 
     private static final RegexProperty REGEX_DESCRIPTOR = RegexProperty.named(""regex"")
             .desc(""Regular expression"").defaultValue(""\\/\\*\\s+(default|package)\\s+\\*\\/"").uiOrder(1.0f).build();
@@ -41,14 +44,6 @@
     }
 
     @Override
-    protected Collection<String> defaultSuppressionAnnotations() {
-        Collection<String> ignoredStrings = new ArrayList<>();
-        ignoredStrings.add(""com.google.common.annotations.VisibleForTesting"");
-        ignoredStrings.add(""android.support.annotation.VisibleForTesting"");
-        return ignoredStrings;
-    }
-
-    @Override
     public Object visit(final ASTCompilationUnit node, final Object data) {
         interestingLineNumberComments.clear();
         final List<Comment> comments = node.getComments();
@@ -117,8 +112,16 @@
 
     private boolean hasNoVisibleForTestingAnnotation(AbstractJavaAccessNode decl) {
         boolean result = true;
-        if(hasIgnoredAnnotation(decl)){
+        ASTClassOrInterfaceBodyDeclaration parent = decl.getFirstParentOfType(ASTClassOrInterfaceBodyDeclaration.class);
+        if (parent != null) {
+            List<ASTAnnotation> annotations = parent.findChildrenOfType(ASTAnnotation.class);
+            for (ASTAnnotation annotation : annotations) {
+                final ASTName name = annotation.getFirstDescendantOfType(ASTName.class);
+                if (name.hasImageEqualTo(""VisibleForTesting"")) {
                     result = false;
+                    break;
+                }
+            }
         }
         return result;
     }",1
Fix contribution compatibility check.," 
 
   public boolean isCompatible(int versionNum) {
-    return ((maxRevision == 0 || versionNum <= maxRevision) && versionNum >= minRevision);
+    return ((maxRevision == 0 || versionNum < maxRevision) && versionNum > minRevision);
   }
 
 ",1
Fix issue #187: Bad image on mobile network.,"             int bytesum = 0;
             int byteread = 0;
             out = new BufferedOutputStream(new FileOutputStream(file));
-
-            InputStream is = urlConnection.getInputStream();
-            String content_encode = urlConnection.getContentEncoding();
-            if (null != content_encode && !"""".equals(content_encode) &&
-                    content_encode.equals(""gzip"")) {
-                is = new GZIPInputStream(is);
-            }
-            in = new BufferedInputStream(is);
+            in = new BufferedInputStream(urlConnection.getInputStream());
 
             final Thread thread = Thread.currentThread();
             byte[] buffer = new byte[1444];",1
Fix incorrect required BSQ amount in warning text,"             if (requireChangeOutput) {
                 checkArgument(change.isPositive(),
                         ""This transaction requires a mandatory BSQ change output. "" +
-                                ""At least "" + Restrictions.getMinNonDustOutput().add(fee).value / 100d + "" "" +
+                                ""At least "" + Restrictions.getMinNonDustOutput().add(fee) + "" "" +
                                 ""BSQ is needed for this transaction"");
             }
 
@@ -565,7 +565,7 @@
                 checkArgument(Restrictions.isAboveDust(change),
                         ""The change output of "" + change.value / 100d + "" BSQ is below the min. dust value of ""
                                 + Restrictions.getMinNonDustOutput().value / 100d +
-                                "". At least "" + Restrictions.getMinNonDustOutput().add(fee).value / 100d + "" "" +
+                                "". At least "" + Restrictions.getMinNonDustOutput().add(fee) + "" "" +
                                 ""BSQ is needed for this transaction"");
                 tx.addOutput(change, getChangeAddress());
             }",1
GWT fix.," 		int stride = strideInBytes / 4;
 		float[] m = matrix.val;
 		for (int i = 0; i < count; i++) {
+			idx += stride;
 			final float x = arr[idx    ];
 			final float y = arr[idx + 1];
 			final float z = dimensions >= 3 ? arr[idx + 2] : 0f;
@@ -379,7 +380,6 @@
 				if (dimensions >= 4)
 					arr[idx+3] = x * m[ 3] + y * m[ 7] + z * m[11] + w * m[15];
 			}
-			idx += stride;
 		}
 		buffer.put(arr);
 		buffer.position(pos);
@@ -401,6 +401,7 @@
 		int stride = strideInBytes / 4;
 		float[] m = matrix.val;
 		for (int i = 0; i < count; i++) {
+			idx += stride;
 			final float x = arr[idx    ];
 			final float y = arr[idx + 1];
 			final float z = dimensions >= 3 ? arr[idx + 2] : 1f;
@@ -408,7 +409,6 @@
 			arr[idx+1] = x * m[ 1] + y * m[ 4] + z * m[ 7];
 			if (dimensions >= 3)
 				arr[idx+2] = x * m[ 2] + y * m[ 5] + z * m[8];
-			idx += stride;
 		}
 		buffer.put(arr);
 		buffer.position(pos);",1
Fix ConcurrentModificationException starting passive scan on Android 8," import org.altbeacon.beacon.distance.ModelSpecificDistanceCalculator;
 import org.altbeacon.beacon.logging.LogManager;
 import org.altbeacon.beacon.utils.ProcessUtils;
-
-import java.util.ArrayList;
 import java.util.List;
 
 
@@ -105,9 +103,7 @@
     private void startPassiveScanIfNeeded() {
         LogManager.d(TAG, ""Checking to see if we need to start a passive scan"");
         boolean insideAnyRegion = false;
-        // Clone the collection before iterating to prevent ConcurrentModificationException per #577
-        List<Region> regions = new ArrayList<>(mScanState.getMonitoringStatus().regions());
-        for (Region region : regions) {
+        for (Region region : mScanState.getMonitoringStatus().regions()) {
             RegionMonitoringState state = mScanState.getMonitoringStatus().stateOf(region);
             if (state != null && state.getInside()) {
                 insideAnyRegion = true;",1
Fixed previous commit," 			if (type != null) {
 				object.getProperties().put(""type"", type);
 			}
-			object.getProperties().put(""x"", x);
-			object.getProperties().put(""y"", yUp ? y - height : y);
+			object.getProperties.put(""x"", x);
+			object.getProperties.put(""y"", yUp ? y - height : y);
 			object.setVisible(element.getIntAttribute(""visible"", 1) == 1);
 			Element properties = element.getChildByName(""properties"");
 			if (properties != null) {",1
Fixes node information in service disco manager.,"     private final EntityCapsManager capsManager;
 
     /**
+     * The attribute associated with our node.
+     */
+    private final String nodeAttribute;
+
+    /**
      * The {@link ServiceDiscoveryManager} that we are wrapping.
      */
     private final ServiceDiscoveryManager discoveryManager;
@@ -183,6 +188,9 @@
         // For every XMPPConnection, add one EntityCapsManager.
         this.capsManager = new EntityCapsManager();
         this.capsManager.addPacketListener(connection);
+        this.nodeAttribute
+            = this.capsManager.getNode()
+                + ""#"" + this.capsManager.getCapsVersion();
 
         /*
          * XXX initFeatures() has to happen before updateEntityCapsVersion().
@@ -256,8 +264,7 @@
         DiscoverInfo di = new DiscoverInfo();
 
         di.setType(IQ.Type.result);
-        di.setNode(
-            capsManager.getNode() + ""#"" + capsManager.getCapsVersion());
+        di.setNode(this.nodeAttribute);
 
         // Add discover info
         addDiscoverInfoTo(di);
@@ -393,7 +400,7 @@
             //make sure we'll be able to handle requests for the newly generated
             //node once we've used it.
             discoveryManager.setNodeInformationProvider(
-                caps.getNode() + ""#"" + caps.getVer(), this);
+                this.nodeAttribute, this);
 
             // Remove old capabilities extension if present
             ExtensionElement oldCaps
@@ -643,9 +650,7 @@
             retriever.stop();
 
         // we need to clean up our reference
-        discoveryManager.removeNodeInformationProvider(
-            this.capsManager.getNode()
-                + ""#"" + this.capsManager.getCapsVersion());
+        discoveryManager.removeNodeInformationProvider(this.nodeAttribute);
 
         this.connection = null;
     }",1
Fix Typo,"         final LocationSettingsStates states = LocationSettingsStates.fromIntent(data);//intent);
         switch (requestCode) {
             case REQUEST_CHECK_SETTINGS:
-                //Reference: https://developers.google.com/android/reference/com/google/android/gms/location/SettingsApi
+                //Refrence: https://developers.google.com/android/reference/com/google/android/gms/location/SettingsApi
                 switch (resultCode) {
                     case RESULT_OK:
                         // All required changes were successfully made",1
Fix achievement diary plugin requirements," 		add(""Craft 56 Cosmic runes simultaneously."",
 			new Requirement(Skill.RUNECRAFT, 59));
 		add(""Travel from Lumbridge to Edgeville on a Waka Canoe."",
-			new Requirement(Skill.WOODCUTTING, 57));
+			new Requirement(Skill.FARMING, 63));
 		add(""Pick some Belladonna from the farming patch at Draynor Manor."",
-			new Requirement(Skill.FARMING, 63));
+			new Requirement(Skill.FARMING, 68));
 		add(""Light your mining helmet in the Lumbridge castle basement."",
 			new Requirement(Skill.FIREMAKING, 65));
 		add(""Recharge your prayer at Clan Wars with Smite activated."",",1
fix zk 编译错误,"     private static Map<String, Object> zkConfig;
 
     public static void main(String[] args) {
-         String url;
+        final String url;
         if (args != null && args.length > 0) {
             ZK_CONFIG_FILE_NAME = args[0];
             url = args[1];
+        } else {
+            url = (String) zkConfig.get(CONFIG_URL_KEY);
         }
 
-
         zkConfig = loadZkConfig();
-         url = zkConfig.containsKey(CONFIG_URL_KEY)? (String) zkConfig.get(CONFIG_URL_KEY) : ""127.0.0.1:2181"";
+        String url = zkConfig.containsKey(CONFIG_URL_KEY)? (String) zkConfig.get(CONFIG_URL_KEY) : ""127.0.0.1:2181"";
         framework =
             createConnection(url)
                 .usingNamespace(""mycat"");",1
Use https for RealmVersionChecker," 
 
 public class RealmVersionChecker {
-    public static final String REALM_ANDROID_DOWNLOAD_URL = ""https://static.realm.io/downloads/java/latest"";
+    public static final String REALM_ANDROID_DOWNLOAD_URL = ""http://static.realm.io/downloads/java/latest"";
 
-    private static final String VERSION_URL = ""https://static.realm.io/update/java?"";
+    private static final String VERSION_URL = ""http://static.realm.io/update/java?"";
     private static final String REALM_VERSION = Version.VERSION;
     private static final String REALM_VERSION_PATTERN = ""\\d+\\.\\d+\\.\\d+"";
     private static final int READ_TIMEOUT = 2000;",1
fix NPE.," 
             // remap
             final ASMMethodNodeAdapter newMethodNode = classNode.getDeclaredMethod(pointCutMethodNode.getName(), pointCutMethodNode.getDesc());
-            if (newMethodNode == null) {
-                throw new InstrumentException(""not found new method. "" + classNode.getInternalName() + ""."" + pointCutMethodNode.getName());
-            }
             remapper.setName(methodName);
             newMethodNode.remapMethodInsnNode(remapper);
         }",1
"When searching, removing ""system"" parameters (e.g. blLocale) so they do not influence the primary search parameter","             String fieldName = request.getParameter(""facetField"");
             List<String> activeFieldFilters = new ArrayList<String>();
             Map<String, String[]> parameters = new HashMap<String, String[]>(request.getParameterMap());
-            parameters.remove(""blLocaleCode"");
             
             for (Iterator<Entry<String,String[]>> iter = parameters.entrySet().iterator(); iter.hasNext();){
                 Map.Entry<String, String[]> entry = iter.next();",1
Skip process automated msgs for HTTP Sessions tab," 	@Override
 	public void onHttpResponseReceive(HttpMessage msg, int initiator, HttpSender sender) {
 		if (initiator == HttpSender.ACTIVE_SCANNER_INITIATOR || initiator == HttpSender.SPIDER_INITIATOR
-				|| initiator == HttpSender.AJAX_SPIDER_INITIATOR || initiator == HttpSender.FORCED_BROWSE_INITIATOR
 				|| initiator == HttpSender.CHECK_FOR_UPDATES_INITIATOR || initiator == HttpSender.FUZZER_INITIATOR
 				|| initiator == HttpSender.AUTHENTICATION_INITIATOR) {
 			// Not a session we care about",1
BiomeManager: Fix off-by-one errors,"     public static ImmutableList<BiomeEntry> getBiomes(BiomeType type)
     {
         int idx = type.ordinal();
-        List<BiomeEntry> list = idx >= biomes.length ? null : biomes[idx];
+        List<BiomeEntry> list = idx > biomes.length ? null : biomes[idx];
 
         return list != null ? ImmutableList.copyOf(list) : null;
     }
@@ -179,7 +179,7 @@
 
             if (ret.ordinal() >= biomes.length)
             {
-                biomes = Arrays.copyOf(biomes, ret.ordinal() + 1);
+                biomes = Arrays.copyOf(biomes, ret.ordinal());
             }
 
             return ret;",1
Fix unnecessary stack trace when deleting and no saved game selected,"                     return;
                 }
 
-                int selectionIndex = list.getSelectionIndex();
-                if ( (selectionIndex < 0) || (selectionIndex >= list.getItemCount()) ) {
-                    getGUIManager().showMessage(""Error"", ""Please choose a saved game first."");
-                    return;
-                }
-
                 try {
                     GameManifest gameManifest = (GameManifest) list.getSelection().getValue();
                     Path world = PathManager.getInstance().getSavePath(gameManifest.getTitle());
                     FilesUtil.recursiveDelete(world);
-                    list.removeItem(selectionIndex);
+                    list.removeItem(list.getSelectionIndex());
                 } catch (Exception e) {
                     logger.error(""Failed to delete saved game"", e);
                     getGUIManager().showMessage(""Error"", ""Failed to remove saved game - sorry."");",1
fix typo,"  */
 public class DefaultResultSetHandler implements ResultSetHandler {
 
-  private static final Object DEFERRED = new Object();
+  private static final Object DEFERED = new Object();
 
   private final Executor executor;
   private final Configuration configuration;
@@ -443,7 +443,7 @@
         final String property = propertyMapping.getProperty();
         if (property == null) {
           continue;
-        } else if (value == DEFERRED) {
+        } else if (value == DEFERED) {
           foundValues = true;
           continue;
         }
@@ -465,7 +465,7 @@
       return getNestedQueryMappingValue(rs, metaResultObject, propertyMapping, lazyLoader, columnPrefix);
     } else if (propertyMapping.getResultSet() != null) {
       addPendingChildRelation(rs, metaResultObject, propertyMapping);   // TODO is that OK?
-      return DEFERRED;
+      return DEFERED;
     } else {
       final TypeHandler<?> typeHandler = propertyMapping.getTypeHandler();
       final String column = prependPrefix(propertyMapping.getColumn(), columnPrefix);
@@ -747,12 +747,12 @@
       final Class<?> targetType = propertyMapping.getJavaType();
       if (executor.isCached(nestedQuery, key)) {
         executor.deferLoad(nestedQuery, metaResultObject, property, key, targetType);
-        value = DEFERRED;
+        value = DEFERED;
       } else {
         final ResultLoader resultLoader = new ResultLoader(configuration, executor, nestedQuery, nestedQueryParameterObject, targetType, key, nestedBoundSql);
         if (propertyMapping.isLazy()) {
           lazyLoader.addLoader(property, metaResultObject, resultLoader);
-          value = DEFERRED;
+          value = DEFERED;
         } else {
           value = resultLoader.loadResult();
         }",1
Fix for #1502,"     @Override
     protected void onAttachedToWindow() {
         super.onAttachedToWindow();
-        if (!isInEditMode()) {
         onResume();
     }
-    }
 
     @Override
     protected void onDetachedFromWindow() {",1
Fixed setRequestMethodViaJreBugWorkaround() to work with HTTPS as well as HTTP,"                 AccessController.doPrivileged(new PrivilegedExceptionAction<Object>() {
                     @Override
                     public Object run() throws NoSuchFieldException, IllegalAccessException {
-                        final Class<?> parentClass = httpURLConnectionClass
-                                .getSuperclass();
-                        final Field methodField;
-                        // If the implementation class is an HTTPS URL Connection, we
-                        // need to go up one level higher in the heirarchy to modify the
-                        // 'method' field.
-                        if (parentClass == HttpsURLConnection.class) {
-                            methodField = parentClass.getSuperclass().getDeclaredField(
-                                ""method"");
-                        } else {
-                            methodField = parentClass.getDeclaredField(""method"");
-                        }
+                        final Field methodField = httpURLConnectionClass.getSuperclass().getDeclaredField(""method"");
                         methodField.setAccessible(true);
                         methodField.set(httpURLConnection, method);
                         return null;",1
Make dialectPrefix accessible to subclasses," 
     }
 
-    protected final String getDialectPrefix() {
-        return this.dialectPrefix;
-    }
 
     public final MatchingElementName getMatchingElementName() {
         return this.matchingElementName;",1
Fix RestPasswordManagementService to use 'urlChange' endpoint,"         headers.put(""oldPassword"", Arrays.asList(upc.getPassword()));
 
         final HttpEntity<String> entity = new HttpEntity<>(headers);
-        final ResponseEntity<Boolean> result = restTemplate.exchange(rest.getEndpointUrlChange(), HttpMethod.POST, entity, Boolean.class);
+        final ResponseEntity<Boolean> result = restTemplate.exchange(rest.getEndpointUrlEmail(), HttpMethod.POST, entity, Boolean.class);
         if (result.getStatusCodeValue() == HttpStatus.OK.value()) {
             return result.getBody();
         }",1
Fixes #40," 	}
 
 	@Override
-	public void draw(Canvas canvas) {
-		super.draw(canvas);
+	protected void onDraw(Canvas canvas) {
+		super.onDraw(canvas);
 
 		boolean needsInvalidate = false;
 ",1
fix gwt isButtonPressed," 
 	@Override
 	public boolean isButtonPressed (int button) {
-		return pressedButtons.contains(button) && touched[0];
+		return button == Buttons.LEFT && touched[0];
 	}
 
 	@Override",1
Fix TimSort runLength," 
 	/** Examines the stack of runs waiting to be merged and merges adjacent runs until the stack invariants are reestablished:
 	 * 
-	 * 1. runLen[n - 2] > runLen[n - 1] + runLen[n] 2. runLen[n - 1] > runLen[n]
-	 * 
-	 * where n is the index of the last run in runLen.
-	 * 
-	 * This method has been formally verified to be correct after checking the last 4 runs.
-	 * Checking for 3 runs results in an exception for large arrays.
-	 * (Source: http://envisage-project.eu/proving-android-java-and-python-sorting-algorithm-is-broken-and-how-to-fix-it/)
+	 * 1. runLen[i - 3] > runLen[i - 2] + runLen[i - 1] 2. runLen[i - 2] > runLen[i - 1]
 	 * 
 	 * This method is called each time a new run is pushed onto the stack, so the invariants are guaranteed to hold for i <
 	 * stackSize upon entry to the method. */
 	private void mergeCollapse () {
 		while (stackSize > 1) {
 			int n = stackSize - 2;
-			if ((n >= 1 && runLen[n - 1] <= runLen[n] + runLen[n + 1]) || (n >= 2 && runLen[n - 2] <= runLen[n] + runLen[n - 1])) {
+			if (n > 0 && runLen[n - 1] <= runLen[n] + runLen[n + 1]) {
 				if (runLen[n - 1] < runLen[n + 1]) n--;
-			} else if (runLen[n] > runLen[n + 1]) {
+				mergeAt(n);
+			} else if (runLen[n] <= runLen[n + 1]) {
+				mergeAt(n);
+			} else {
 				break; // Invariant is established
 			}
-			mergeAt(n);
 		}
 	}
 ",1
Patch to support Hibernate's @Formula - prevent ClassCastExceptions in the admin,"             Column column = null;
             for (Property property : addMetadataFromMappingDataRequest.getComponentProperties()) {
                 if (property.getName().equals(addMetadataFromMappingDataRequest.getPropertyName())) {
-                    Object columnObject = property.getColumnIterator().next();
-                    if (columnObject instanceof Column) {
-                        column = (Column) columnObject;
-                    }
+                    column = (Column) property.getColumnIterator().next();
                     break;
                 }
             }",1
Fixed SplitPane handle drawing," 				ScissorStack.popScissors();
 			}
 		}
-		batch.setColor(color.r, color.g, color.b, parentAlpha * color.a);
+		batch.setColor(color.r, color.g, color.b, color.a);
 		handle.draw(batch, handleBounds.x, handleBounds.y, handleBounds.width, handleBounds.height);
 		resetTransform(batch);
 	}",1
Fixing NPE found on issue #2695," 	}
 
 	//TODO temp hack
-	private void onReactContextInitialized(ReactContext context) {
-		reactEventEmitter = new NavigationReactEventEmitter(context);
+	private void onReactContextInitialized() {
+		reactEventEmitter = new NavigationReactEventEmitter(getReactContext());
 	}
 
 	private static class ReactNativeHostImpl extends ReactNativeHost implements ReactInstanceManager.ReactInstanceEventListener {
@@ -171,7 +171,7 @@
 
 		@Override
 		public void onReactContextInitialized(ReactContext context) {
-			((NavigationReactGateway) NavigationApplication.instance.getReactGateway()).onReactContextInitialized(context);
+			((NavigationReactGateway) NavigationApplication.instance.getReactGateway()).onReactContextInitialized();
 			NavigationApplication.instance.onReactInitialized(context);
 		}
 ",1
Enable PulsarAdmin to trust multiple certificates,"             if (trustCertficates == null || trustCertficates.length == 0) {
                 tmf.init((KeyStore) null);
             } else {
-                for (int i = 0; i < trustCertficates.length; i++) {
-                    ksh.setCertificate(""trust"" + i, trustCertficates[i]);
-                }
+                ksh.setCertificate(""trust"", trustCertficates[0]);
                 tmf.init(ksh.getKeyStore());
             }
 ",1
Fix Jarvis infinite loop," 		do
 		{
 			ch.add(current);
-			assert ch.size() <= points.size() : ""hull has more points than graph"";
-			if (ch.size() > points.size())
-			{
-				// Just to make sure we never somehow get stuck in this loop
-				return null;
-			}
 
 			// the next point - all points are to the right of the
 			// line between current and next
@@ -84,7 +78,7 @@
 					continue;
 				}
 
-				long cp = crossProduct(current, p, next);
+				int cp = crossProduct(current, p, next);
 				if (cp > 0 || (cp == 0 && current.distanceTo(p) > current.distanceTo(next)))
 				{
 					next = p;
@@ -97,6 +91,7 @@
 				return null;
 			}
 
+			assert ch.size() <= points.size() : ""hull has more points than graph"";
 			current = next;
 		}
 		while (current != left);
@@ -123,10 +118,10 @@
 		return left;
 	}
 
-	private static long crossProduct(Point p, Point q, Point r)
+	private static int crossProduct(Point p, Point q, Point r)
 	{
-		long val = (long)(q.getY() - p.getY()) * (r.getX() - q.getX())
-			- (long)(q.getX() - p.getX()) * (r.getY() - q.getY());
+		int val = (q.getY() - p.getY()) * (r.getX() - q.getX())
+			- (q.getX() - p.getX()) * (r.getY() - q.getY());
 		return val;
 	}
 }",1
Fix android TitleBar center on configuration change," 
 import android.annotation.TargetApi;
 import android.app.Activity;
-import android.content.res.Configuration;
 import android.graphics.Color;
 import android.os.Build;
 import android.os.Bundle;
@@ -70,12 +69,6 @@
     }
 
     @Override
-    protected void onConfigurationChanged(Configuration newConfig) {
-        super.onConfigurationChanged(newConfig);
-        setStyle();
-    }
-
-    @Override
     public void onEvent(Event event) {
         if (ContextualMenuHiddenEvent.TYPE.equals(event.getType()) && isShown()) {
             topBar.onContextualMenuHidden();",1
"Revert ""Fix arsc decoder for wrong chunk header read and table config size 64 processing""","     private final static short ENTRY_FLAG_WEAK = 0x0004;
 
     private static final Logger LOGGER             = Logger.getLogger(ARSCDecoder.class.getName());
-    private static final int    KNOWN_CONFIG_BYTES = 56;
+    private static final int    KNOWN_CONFIG_BYTES = 64;
 
     private static HashMap<Integer, Set<String>> mExistTypeNames;
 
@@ -138,18 +138,24 @@
             System.out.printf(""Decoding Shared Library (%s), pkgId: %d\n"", packageName, packageId);
         }
 
-        while(nextChunk().type == Header.TYPE_TYPE) {
+        nextChunk();
+        while(mHeader.type == Header.TYPE_TYPE) {
             readTableTypeSpec();
         }
     }
 
     private void readTableTypeSpec() throws AndrolibException, IOException {
         readSingleTableTypeSpec();
-        while (nextChunk().type == Header.TYPE_SPEC_TYPE) {
+
+        nextChunk();
+        while (mHeader.type == Header.TYPE_SPEC_TYPE) {
             readSingleTableTypeSpec();
+            nextChunk();
         }
-        while (nextChunk().type == Header.TYPE_TYPE) {
+
+        while (mHeader.type == Header.TYPE_TYPE) {
             readConfig();
+            nextChunk();
         }
     }
 
@@ -160,6 +166,10 @@
         int entryCount = mIn.readInt();
 
         /* flags */mIn.skipBytes(entryCount * 4);
+
+        mCurTypeID = id;
+        mResId = (0xff000000 & mResId) | id << 16;
+        mType = new ResType(mTypeNames.getString(id - 1), mPkg);
     }
 
     private void readConfig() throws IOException, AndrolibException {
@@ -289,6 +299,11 @@
             read = 56;
         }
 
+        if (size >= 64) {
+            mIn.skipBytes(8);
+            read = 64;
+        }
+
         int exceedingSize = size - KNOWN_CONFIG_BYTES;
         if (exceedingSize > 0) {
             byte[] buf = new byte[exceedingSize];
@@ -305,12 +320,13 @@
                 ));
                 isInvalid = true;
             }
-        }
+        } else {
             int remainingSize = size - read;
             if (remainingSize > 0) {
                 mIn.skipBytes(remainingSize);
             }
         }
+    }
 
     private String readScriptOrVariantChar(int length) throws AndrolibException, IOException {
         StringBuilder string = new StringBuilder(16);",1
Fix: NPE in pulsar source close," 
     @Override
     public void close() throws Exception {
-        if (inputConsumers != null ) {
         inputConsumers.forEach(consumer -> {
             try {
                 consumer.close();
@@ -150,7 +149,6 @@
             }
         });
     }
-    }
 
     @SuppressWarnings(""unchecked"")
     @VisibleForTesting",1
fix心跳," 		// should continues check error status
 		if (++errorCount < maxRetryCount) {
 
-            if (detector != null && !detector.isQuit()) {
+			if (detector != null && isStop.get()) {
+				detector.quit();
+			} else {
 				heartbeat(); // error count not enough, heart beat again
 			}
-
+		//	return;
 		}else
         {
             if (detector != null ) {",1
fix 一个方法在基类中时，热修复包反射调用会找不到该调用的方法的bug,"             for (Class<?> clazz = object.getClass(); clazz != null; clazz = clazz.getSuperclass()) {
                 try {
                     method = clazz.getDeclaredMethod(methodName, parameterTypes);
-                    if (method != null) {
                     if (!method.isAccessible()) {
                         method.setAccessible(true);
                     }
+                    if (null == declaringClass || clazz.equals(declaringClass)) {
                         return method;
                     }
                 } catch (Exception e) {",1
PR to fix preDraw count bug (no issue #)," 
 		GLES20.glClear(clearMask);
 
-        // Execute onPreFrame callbacks
+        // Execute pre-frame callbacks
         // We explicitly break out the steps here to help the compiler optimize
         final int preCount = mPreCallbacks.size();
         if (preCount > 0) {
@@ -1064,12 +1064,12 @@
             }
         }
 
-        // Execute onPreDraw callbacks
+        // Execute pre-frame callbacks
         // We explicitly break out the steps here to help the compiler optimize
-        final int preDrawCount = mPreDrawCallbacks.size();
-        if (preDrawCount > 0) {
+        final int preRenderCount = mPreDrawCallbacks.size();
+        if (preRenderCount > 0) {
             synchronized (mPreDrawCallbacks) {
-                for (int i = 0; i < preDrawCount; ++i) {
+                for (int i = 0; i < preCount; ++i) {
                     mPreDrawCallbacks.get(i).onPreDraw(ellapsedTime, deltaTime);
                 }
             }
@@ -1136,7 +1136,7 @@
 			renderTarget.unbind();
 		}
 
-        // Execute onPostFrame callbacks
+        // Execute post-render callbacks
         // We explicitly break out the steps here to help the compiler optimize
         final int postCount = mPostCallbacks.size();
         if (postCount > 0) {",1
fixed the issue related to user authentication,"     String actualLogin = login;
     User userFromDatabase = null;
 
+    actualLogin = login.toLowerCase();
     userFromDatabase = identityService.createUserQuery().userId(actualLogin).singleResult();
 
     // Verify user",1
CAMEL-12037 Idempotent repository cache initialization fix.,"     protected void doStart() throws Exception {
         ObjectHelper.notNull(fileStore, ""fileStore"", this);
 
-        //CAMEL-12037
-        if (this.cache == null) {
         // default use a 1st level cache
         this.cache = LRUCacheFactory.newLRUCache(1000);
-        }
 
         // init store if not loaded before
         if (init.compareAndSet(false, true)) {",1
HHH-9907 - bytecode enhancer - fix resource path on windows," import java.io.ByteArrayInputStream;
 import java.io.ByteArrayOutputStream;
 import java.io.DataOutputStream;
+import java.io.File;
 import java.io.IOException;
+import javax.tools.JavaFileObject;
 
 import javassist.ClassPool;
 import javassist.CtClass;
@@ -105,8 +107,11 @@
 	}
 
 	private CtClass loadCtClassFromClass(ClassPool cp, Class<?> aClass) throws IOException {
-		String resourceName = aClass.getName().replace( '.', '/' ) + "".class"";
-		return cp.makeClass( aClass.getClassLoader().getResourceAsStream( resourceName ) );
+		return cp.makeClass( aClass.getClassLoader().getResourceAsStream( getFilenameForClass( aClass ) ) );
+	}
+
+	private String getFilenameForClass(Class<?> aClass) {
+		return aClass.getName().replace( '.', File.separatorChar ) + JavaFileObject.Kind.CLASS.extension;
 	}
 
 	private void enhance(CtClass managedCtClass) {",1
Fix duplicate entwork ids at items get splitted that caused invisible items.," package org.terasology.logic.inventory;
 
 import org.terasology.entitySystem.Component;
+import org.terasology.entitySystem.entity.EntityManager;
 import org.terasology.entitySystem.entity.EntityRef;
 import org.terasology.logic.inventory.events.BeforeItemPutInInventory;
 import org.terasology.logic.inventory.events.BeforeItemRemovedFromInventory;
 import org.terasology.logic.inventory.events.InventorySlotChangedEvent;
 import org.terasology.logic.inventory.events.InventorySlotStackSizeChangedEvent;
+import org.terasology.registry.CoreRegistry;
 
 import java.util.HashMap;
 import java.util.HashSet;
@@ -356,7 +358,7 @@
         EntityRef itemTo = getItemAt(to, slotTo);
 
         if (!itemTo.exists()) {
-            EntityRef fromCopy = itemFrom.copy();
+            EntityRef fromCopy = CoreRegistry.get(EntityManager.class).copy(itemFrom);
 
             ItemComponent copyItem = fromCopy.getComponent(ItemComponent.class);
             copyItem.stackCount = (byte) amount;",1
Fixed issue with TicketRegistryCleaner schedule,"         @Scheduled(initialDelayString = ""${cas.ticket.registry.cleaner.schedule.startDelay:PT30S}"",
                 fixedDelayString = ""${cas.ticket.registry.cleaner.schedule.repeatInterval:PT120S}"")
         public void run() {
-            try {
             this.ticketRegistryCleaner.clean();
-            } catch (final Exception e) {
-                LOGGER.error(e.getMessage(), e);
-            }
         }
     }
 }",1
Fix incorrect comparison causing verify fulfillment groups to fail unexp...,"         }
         
         for (Entry<Long, Integer> entry : oiQuantityMap.entrySet()) {
-            if (!entry.getValue().equals(0)) {
+            if (entry.getValue() != 0) {
                 throw new IllegalStateException(""Not enough fulfillment group items found for DiscreteOrderItem id: "" + entry.getKey());
             }
         }",1
Fix NPE on surrogation mail notification,"         }
         if (communicationsManager.isMailSenderDefined()) {
             final EmailProperties mail = casProperties.getAuthn().getSurrogate().getMail();
-            final String emailAttribute = mail.getAttributeName();
-            final Object to = principal.getAttributes().get(emailAttribute);
-            if (to != null) {
+            final String to = principal.getAttributes().get(mail.getAttributeName()).toString();
             final String text = mail.getText().concat(""\n"").concat(eventDetails);
-                this.communicationsManager.email(text, mail.getFrom(), mail.getSubject(), to.toString(), mail.getCc(), mail.getBcc());
-            } else {
-                LOGGER.trace(""The principal has no {} attribute, cannot send email notification"", emailAttribute);
-            }
+            this.communicationsManager.email(text, mail.getFrom(), mail.getSubject(), to, mail.getCc(), mail.getBcc());
         } else {
             LOGGER.trace(""CAS is unable to send surrogate-authentication email messages given no settings are defined to account for servers, etc"");
         }",1
Fixed screen quad texture coordinates.," 				-.5f, -.5f, 0
 		};
 		float[] textureCoords = new float[] {
-				0, 0, 1, 0, 1, 1, 0, 1
+				0, 1, 1, 1, 1, 0, 0, 0
 		};
 		float[] normals = new float[] {
 				0, 0, 1,",1
"Fixup release, so no longer a snapshot","     // the (internal) format of the id is there so we can easily do after/before checks on the id
 
 
-    public static final boolean SNAPSHOT = false;
+    public static final boolean SNAPSHOT = true;
     public static final Version CURRENT = new Version(2010199, SNAPSHOT, org.elasticsearch.Version.V_5_4_3_UNRELEASED);
 
     static {",1
[SP-4384] Fixes regression for fields without a specified metadata le…,"             }
             String string = getString( data );
             int len = string.length();
-            int maxlen = isLengthInvalidOrZero() ? len : getLength();
-            if ( len <= maxlen ) {
+            int maxlen = isLengthInvalidOrZero() ? 0 : getLength();
+            if ( len < maxlen ) {
               preparedStatement.setString( index, string );
             } else {
               // Take the last maxlen characters of the string...",1
"+tck #29 null checks fixed - `null` from ABQueue#poll means ""timeout""","       env.flop(errorMsg);
     }
 
+
     public void expectCompletion(long timeoutMillis, String errorMsg) throws InterruptedException {
       if (!isCompleted()) {
         T val = abq.poll(timeoutMillis, TimeUnit.MILLISECONDS);
-
         if (val == null) {
           env.flop(String.format(""%s within %d ms"", errorMsg, timeoutMillis));
         } else {
@@ -528,12 +528,12 @@
     public T next(long timeoutMillis, String errorMsg) throws InterruptedException {
       Optional<T> value = abq.poll(timeoutMillis, TimeUnit.MILLISECONDS);
 
-      if (value == null) {
+      if (value.isEmpty()) {
+        env.flop(""Expected element but got end-of-stream"");
+      } else if (value.get() == null) {
         env.flop(String.format(""%s within %d ms"", errorMsg, timeoutMillis));
-      } else if (value.isDefined()) {
+      } else {
         return value.get();
-      } else {
-        env.flop(""Expected element but got end-of-stream"");
       }
 
       return null; // keep compiler happy
@@ -541,12 +541,12 @@
 
     public Optional<T> nextOrEndOfStream(long timeoutMillis, String errorMsg) throws InterruptedException {
       Optional<T> value = abq.poll(timeoutMillis, TimeUnit.MILLISECONDS);
-
-      if (value == null) {
+      if (value.isDefined()) {
+        return value;
+      } else {
         env.flop(String.format(""%s within %d ms"", errorMsg, timeoutMillis));
+        return null; // keep compiler happy
       }
-
-      return value;
     }
 
     public List<T> nextN(int elements, long timeoutMillis, String errorMsg) throws InterruptedException {
@@ -564,11 +564,13 @@
     public void expectCompletion(long timeoutMillis, String errorMsg) throws InterruptedException {
       Optional<T> value = abq.poll(timeoutMillis, TimeUnit.MILLISECONDS);
 
-      if (value == null) {
+      if (value.isEmpty()) {
+        // ok
+      } else if (value.get() == null) {
         env.flop(String.format(""%s within %d ms"", errorMsg, timeoutMillis));
-      } else if (value.isDefined()) {
+      } else {
         env.flop(""Expected end-of-stream but got "" + value.get());
-      } // else, ok
+      }
     }
 
     void expectNone(long withinMillis, String errorMsgPrefix) throws InterruptedException {",1
Fix incorrect loading logic of AutoActive in FilterChain.,"                     String alias = extensionClass.getAlias();
                     if (autoActive.providerSide()) {
                         PROVIDER_AUTO_ACTIVES.put(alias, extensionClass);
-                    }
-                    if (autoActive.consumerSide()) {
+                    } else if (autoActive.consumerSide()) {
                         CONSUMER_AUTO_ACTIVES.put(alias, extensionClass);
                     }
                     if (LOGGER.isDebugEnabled()) {",1
fixed exception message spacing,,1
 fixed : has NullPointerException at com.weibo.api.motan.proxy.RefererInvocationHandler.clustersToString if not check and use local protocol.," import java.util.Map;
 
 /**
+ * 
+ * @author maijunsheng
+ * 
  * @param <T>
- * @author maijunsheng
  */
 public class RefererInvocationHandler<T> implements InvocationHandler {
 
@@ -179,7 +181,6 @@
     
     /**
      * tostring,equals,hashCode,finalize等接口未声明的方法不进行远程调用
-     *
      * @param method
      * @return
      */
@@ -199,12 +200,9 @@
         StringBuilder sb = new StringBuilder();
         for(Cluster<T> cluster: clusters){
             sb.append(""{protocol:"").append(cluster.getUrl().getProtocol());
-            List<Referer<T>> referers = cluster.getReferers();
-            if (referers != null) {
-                for (Referer<T> refer : referers) {
+            for(Referer<T> refer : (List<Referer<T>>)cluster.getReferers()){
                 sb.append(""["").append(refer.getUrl().toSimpleString()).append("", available:"").append(refer.isAvailable()).append(""]"");
             }
-            }
             sb.append(""}"");
         }
         return sb.toString();",1
Fixing JS,"     public EntityRef getBlockEntityAt(Vector3i blockPosition) {
         if (GameThread.isCurrentThread()) {
             EntityRef blockEntity = getExistingBlockEntityAt(blockPosition);
-            if ( (!blockEntity.exists() || !blockEntity.hasComponent(NetworkComponent.class)) && isBlockRelevant(blockPosition.x, blockPosition.y, blockPosition.z)) {
+            if (!blockEntity.exists() && isBlockRelevant(blockPosition.x, blockPosition.y, blockPosition.z)) {
                 Block block = getBlock(blockPosition.x, blockPosition.y, blockPosition.z);
                 blockEntity = createBlockEntity(blockPosition, block);
             }",1
[CHECKSTYLE]   fixed copyright year,"  *
  * Pentaho Data Integration
  *
- * Copyright (C) 2002-2016 by Pentaho : http://www.pentaho.com
+ * Copyright (C) 2002-2013 by Pentaho : http://www.pentaho.com
  *
  *******************************************************************************
  *",1
Fix the bug that ReferenceBean refers service more than once when debugging.,"                 try {
                     String name = method.getName();
                     if ((name.startsWith(""get"") || name.startsWith(""is""))
-                            && !""get"".equals(name) && !""is"".equals(name)
-                            && !""getClass"".equals(name) && !""getObject"".equals(name)
+                            && !""getClass"".equals(name) && !""get"".equals(name) && !""is"".equals(name)
                             && Modifier.isPublic(method.getModifiers())
                             && method.getParameterTypes().length == 0
                             && isPrimitive(method.getReturnType())) {",1
Small bugfix with regards to PolygonSprite Color usage," 	}
 
 	public void setColor (Color tint) {
-		color.set(tint);
 		float color = tint.toFloatBits();
 
 		final float[] vertices = this.vertices;
@@ -156,7 +155,6 @@
 	}
 
 	public void setColor (float r, float g, float b, float a) {
-		color.set(r, g, b, a);
 		int intBits = ((int)(255 * a) << 24) | ((int)(255 * b) << 16) | ((int)(255 * g) << 8) | ((int)(255 * r));
 		float color = NumberUtils.intToFloatColor(intBits);
 		final float[] vertices = this.vertices;
@@ -313,12 +311,6 @@
 	/** Returns the color of this sprite. Changing the returned color will have no affect, {@link #setColor(Color)} or
 	 * {@link #setColor(float, float, float, float)} must be used. */
 	public Color getColor () {
-		return color;
-	}
-
-	/** Returns the actual color used in the vertices of this sprite. Changing the returned color will have no affect,
-	 * {@link #setColor(Color)} or {@link #setColor(float, float, float, float)} must be used. */
-	public Color getVertexColor () {
 		int intBits = NumberUtils.floatToIntColor(vertices[2]);
 		Color color = this.color;
 		color.r = (intBits & 0xff) / 255f;",1
Fixed the bug #115," 
 
         // Calculate left and right position for all the events.
-        // Get the maxRowCount by looking in all columns.
-        int maxRowCount = 0;
-        for (List<EventRect> column : columns){
-            maxRowCount = Math.max(maxRowCount, column.size());
-        }
+        int maxRowCount = columns.get(0).size();
         for (int i = 0; i < maxRowCount; i++) {
             // Set the left and right values of the event.
             float j = 0;",1
fix collect views < JELLY_BEAN,"         try {
             Activity targetActivity = UETool.getInstance().getTargetActivity();
             WindowManager windowManager = targetActivity.getWindowManager();
-
-            if (Build.VERSION.SDK_INT > Build.VERSION_CODES.JELLY_BEAN) {
             Field mGlobalField = Class.forName(""android.view.WindowManagerImpl"").getDeclaredField(""mGlobal"");
             mGlobalField.setAccessible(true);
 
@@ -125,21 +123,6 @@
                     }
                 }
             }
-            } else {
-                // http://androidxref.com/4.1.1/xref/frameworks/base/core/java/android/view/WindowManagerImpl.java
-                Field mWindowManagerField = Class.forName(""android.view.WindowManagerImpl$CompatModeWrapper"").getDeclaredField(""mWindowManager"");
-                mWindowManagerField.setAccessible(true);
-                Field mViewsField = Class.forName(""android.view.WindowManagerImpl"").getDeclaredField(""mViews"");
-                mViewsField.setAccessible(true);
-                List<View> views = Arrays.asList((View[]) mViewsField.get(mWindowManagerField.get(windowManager)));
-                for (int i = views.size() - 1; i >= 0; i--) {
-                    View targetView = getTargetDecorView(targetActivity, views.get(i));
-                    if (targetView != null) {
-                        traverse(targetView);
-                        break;
-                    }
-                }
-            }
         } catch (Exception e) {
             e.printStackTrace();
         }",1
Woodcutting: Add support for sullicep mushrooms for logs/hr and logs cut," 	{
 		if (event.getType() == ChatMessageType.FILTERED || event.getType() == ChatMessageType.SERVER)
 		{
-			if (event.getMessage().startsWith(""You get some"") && (event.getMessage().endsWith(""logs."") || event.getMessage().endsWith(""mushrooms."")))
+			if (event.getMessage().startsWith(""You get some"") && event.getMessage().endsWith(""logs.""))
 			{
 				if (session == null)
 				{",1
Fix bugs with Bits.nextClearBit(int)," 		return -1;
 	}
 
-	/** Returns the index of the first bit that is set to false that occurs on or after the specified starting index. */
+	/** Returns the index of the first bit that is set to false that occurs on or after the specified starting index. If no such bit
+	 * exists then -1 is returned. */
 	public int nextClearBit (int fromIndex) {
 		long[] bits = this.bits;
 		int word = fromIndex >>> 6;
 		int bitsLength = bits.length;
-		if (word >= bitsLength) return bits.length << 6;
+		if (word >= bitsLength) return -1;
 		long bitsAtWord = bits[word];
 		for (int i = fromIndex & 0x3f; i < 64; i++) {
 			if ((bitsAtWord & (1L << (i & 0x3F))) == 0L) {
@@ -198,7 +199,7 @@
 				}
 			}
 		}
-		return bits.length << 6;
+		return -1;
 	}
 
 	/** Performs a logical <b>AND</b> of this target bit set with the argument bit set. This bit set is modified so that each bit in",1
fix win mysqldump," import io.mycat.backend.datasource.PhysicalDatasource;
 import io.mycat.config.model.DBHostConfig;
 import io.mycat.config.model.SystemConfig;
-import io.mycat.memory.environment.OperatingSystem;
 import io.mycat.route.function.PartitionByCRC32PreSlot.Range;
 import io.mycat.util.ProcessUtil;
 import io.mycat.util.ZKUtils;
@@ -67,14 +66,13 @@
         }
         file.mkdirs();
 
-            String encose= OperatingSystem.isWindows()?""\\"":"""";
         String finalCmd = DataMigratorUtil
                 .paramsAssignment(mysqldump,""?"", """", config.getIp(), String.valueOf(config.getPort()), config.getUser(),
                 config.getPassword(),MigrateUtils.getDatabaseFromDataNode(task.getFrom()), task.getTable() , makeWhere(task), file.getPath());
             List<String> args= Arrays.asList(""mysqldump"", ""-h""+config.getIp(), ""-P""+String.valueOf(config.getPort()), ""-u""+config.getUser(),
                     ""-p""+config.getPassword(), MigrateUtils.getDatabaseFromDataNode(task.getFrom()), task.getTable(), ""--single-transaction"",""-q"",""--default-character-set=utf8mb4"",""--hex-blob"",""--where=""+makeWhere(task), ""--master-data=1"",""-T""+file.getPath()
 
-                    ,""--fields-enclosed-by=""+encose+""\"""",""--fields-terminated-by=,"", ""--lines-terminated-by=\\n"",  ""--fields-escaped-by=\\\\"");
+                    ,""--fields-enclosed-by=\"""",""--fields-terminated-by=,"", ""--lines-terminated-by=\\n"",  ""--fields-escaped-by=\\\\"");
       String result=  ProcessUtil.execReturnString(args);
         int logIndex = result.indexOf(""MASTER_LOG_FILE='"");
         int logPosIndex = result.indexOf(""MASTER_LOG_POS="");",1
Carefully manage Keep-Alive connections in HttpStaticFileServer,"             return;
         }
 
-        final boolean keepAlive = HttpUtil.isKeepAlive(request);
         final String uri = request.uri();
         final String path = sanitizeUri(uri);
         if (path == null) {
@@ -138,9 +137,9 @@
 
         if (file.isDirectory()) {
             if (uri.endsWith(""/"")) {
-                sendListing(ctx, file, uri, keepAlive);
+                sendListing(ctx, file, uri);
             } else {
-                sendRedirect(ctx, uri + '/', keepAlive);
+                sendRedirect(ctx, uri + '/');
             }
             return;
         }
@@ -161,7 +160,7 @@
             long ifModifiedSinceDateSeconds = ifModifiedSinceDate.getTime() / 1000;
             long fileLastModifiedSeconds = file.lastModified() / 1000;
             if (ifModifiedSinceDateSeconds == fileLastModifiedSeconds) {
-                sendNotModified(ctx, keepAlive);
+                sendNotModified(ctx);
                 return;
             }
         }
@@ -179,9 +178,8 @@
         HttpUtil.setContentLength(response, fileLength);
         setContentTypeHeader(response, file);
         setDateAndCacheHeaders(response, file);
-
-        if (!keepAlive) {
-            response.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.CLOSE);
+        if (HttpUtil.isKeepAlive(request)) {
+            response.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);
         }
 
         // Write the initial line and the header.
@@ -220,7 +218,7 @@
         });
 
         // Decide whether to close the connection or not.
-        if (!keepAlive) {
+        if (!HttpUtil.isKeepAlive(request)) {
             // Close the connection when the whole content is written out.
             lastContentFuture.addListener(ChannelFutureListener.CLOSE);
         }
@@ -266,7 +264,7 @@
 
     private static final Pattern ALLOWED_FILE_NAME = Pattern.compile(""[^-\\._]?[^<>&\\\""]*"");
 
-    private static void sendListing(ChannelHandlerContext ctx, File dir, String dirPath, boolean keepAlive) {
+    private static void sendListing(ChannelHandlerContext ctx, File dir, String dirPath) {
         FullHttpResponse response = new DefaultFullHttpResponse(HTTP_1_1, OK);
         response.headers().set(HttpHeaderNames.CONTENT_TYPE, ""text/html; charset=UTF-8"");
 
@@ -306,14 +304,16 @@
         response.content().writeBytes(buffer);
         buffer.release();
 
-        sendAndCleanupConnection(ctx, response, keepAlive);
+        // Close the connection as soon as the error message is sent.
+        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
     }
 
-    private static void sendRedirect(ChannelHandlerContext ctx, String newUri, boolean keepAlive) {
+    private static void sendRedirect(ChannelHandlerContext ctx, String newUri) {
         FullHttpResponse response = new DefaultFullHttpResponse(HTTP_1_1, FOUND);
         response.headers().set(HttpHeaderNames.LOCATION, newUri);
 
-        sendAndCleanupConnection(ctx, response, keepAlive);
+        // Close the connection as soon as the error message is sent.
+        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
     }
 
     private static void sendError(ChannelHandlerContext ctx, HttpResponseStatus status) {
@@ -321,7 +321,8 @@
                 HTTP_1_1, status, Unpooled.copiedBuffer(""Failure: "" + status + ""\r\n"", CharsetUtil.UTF_8));
         response.headers().set(HttpHeaderNames.CONTENT_TYPE, ""text/plain; charset=UTF-8"");
 
-        sendAndCleanupConnection(ctx, response, false);
+        // Close the connection as soon as the error message is sent.
+        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
     }
 
     /**
@@ -330,32 +331,12 @@
      * @param ctx
      *            Context
      */
-    private static void sendNotModified(ChannelHandlerContext ctx, boolean keepAlive) {
+    private static void sendNotModified(ChannelHandlerContext ctx) {
         FullHttpResponse response = new DefaultFullHttpResponse(HTTP_1_1, NOT_MODIFIED);
         setDateHeader(response);
 
-        sendAndCleanupConnection(ctx, response, keepAlive);
-    }
-
-    /**
-     * If Keep-Alive is disabled, attaches ""Connection: close"" header to the response
-     * and closes the connection after the response being sent.
-     */
-    private static void sendAndCleanupConnection(ChannelHandlerContext ctx, FullHttpResponse response,
-                                                 boolean keepAlive) {
-        HttpUtil.setContentLength(response, response.content().readableBytes());
-        if (!keepAlive) {
-            // We're going to close the connection as soon as the response is sent,
-            // so we should also make it clear for the client.
-            response.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.CLOSE);
-        }
-
-        ChannelFuture flushPromise = ctx.writeAndFlush(response);
-
-        if (!keepAlive) {
-            // Close the connection as soon as the response is sent.
-            flushPromise.addListener(ChannelFutureListener.CLOSE);
-        }
+        // Close the connection as soon as the error message is sent.
+        ctx.writeAndFlush(response).addListener(ChannelFutureListener.CLOSE);
     }
 
     /**",1
Fixed Lookup redirect logic on Proxy side,"                         String brokerUrl = connectWithTLS ? result.brokerUrlTls : result.brokerUrl;
                         if (result.redirect) {
                             // Need to try the lookup again on a different broker
-                            performLookup(clientRequestId, topic, brokerUrl, result.authoritative, numberOfRetries - 1);
+                            performLookup(clientRequestId, topic, brokerUrl, authoritative, numberOfRetries - 1);
                         } else {
                             // Reply the same address for both TLS non-TLS. The reason is that whether we use TLS
                             // between proxy",1
Fix SMS warning message,"      */
     public boolean sms(final String from, final String to, final String text) {
         if (!isSmsSenderDefined() || StringUtils.isBlank(text) || StringUtils.isBlank(from)) {
-            LOGGER.warn(""Could not send SMS to [{}] because either no from/text is found or SMS settings are not configured."", to);
+            LOGGER.warn(""Could not send email to [{}] because either no address/subject/text is found or email settings are not configured."", to);
             return false;
         }
         return this.smsSender.send(from, to, text);",1
order by 带函数的 的bug," 	private String[] buildGroupByCols(List<SQLExpr> groupByItems,Map<String, String> aliaColumns) {
 		String[] groupByCols = new String[groupByItems.size()]; 
 		for(int i= 0; i < groupByItems.size(); i++) {
-			SQLExpr expr = ((MySqlSelectGroupByExpr)groupByItems.get(i)).getExpr();			
-			String column; 
-			if (expr instanceof SQLName) {
-				column= removeBackquote(((SQLName)expr).getSimpleName());//不要转大写 2015-2-10 sohudo removeBackquote(expr.getSimpleName().toUpperCase());
-			}
-			else {
-				column= removeBackquote(expr.toString());
-			}
+			SQLName expr = (SQLName) ((MySqlSelectGroupByExpr)groupByItems.get(i)).getExpr();
+			String column = removeBackquote(expr.getSimpleName());//不要转大写 2015-2-10 sohudo removeBackquote(expr.getSimpleName().toUpperCase());
 			groupByCols[i] = getAliaColumn(aliaColumns,column);//column;
 		}
 		return groupByCols;
@@ -294,14 +288,8 @@
 		for(int i= 0; i < orderByItems.size(); i++) {
 			SQLOrderingSpecification type = orderByItems.get(i).getType();
             //orderColumn只记录字段名称,因为返回的结果集是不带表名的。
-			SQLExpr expr =  orderByItems.get(i).getExpr();
-			String col;
-			if (expr instanceof SQLName) {
-			   col = ((SQLName)expr).getSimpleName();
-			}
-			else {
-				col =expr.toString();
-			}
+			SQLName expr = (SQLName) orderByItems.get(i).getExpr();
+			String col = expr.getSimpleName();
 			if(type == null) {
 				type = SQLOrderingSpecification.ASC;
 			}",1
Fix for process instance created via signal from a suspended process …,"   		if (processDefinition == null) {
   			throw new ActivitiObjectNotFoundException(""No process definition found for id '"" + processDefinitionId + ""'"", ProcessDefinition.class);
   		}
-  		if (processDefinition.isSuspended()) {
-  			throw new ActivitiException(""Could not handle signal: process definition with id: "" + processDefinitionId + "" is suspended"");
-  		}
  
   		ActivityImpl startActivity = processDefinition.findActivity(eventSubscription.getActivityId());
   		if (startActivity == null) {",1
Surgical fix to default command line parameters,"         parser.allowsUnrecognizedOptions();
 
         parser.accepts(AppOptionKeys.USER_DATA_DIR_KEY,
-                format(""User data directory (default: %s)"", DEFAULT_USER_DATA_DIR))
-                .withRequiredArg();
+                ""User data directory"")
+                .withRequiredArg()
+                .defaultsTo(DEFAULT_USER_DATA_DIR);
 
         parser.accepts(AppOptionKeys.APP_NAME_KEY,
-                format(""Application name (default: %s)"", DEFAULT_APP_NAME))
-                .withRequiredArg();
+                ""Application name"")
+                .withRequiredArg()
+                .defaultsTo(DEFAULT_APP_NAME);
 
         OptionSet options;
         try {
@@ -325,9 +327,10 @@
     protected void customizeOptionParsing(OptionParser parser) {
         //CommonOptionKeys
         parser.accepts(CommonOptionKeys.LOG_LEVEL_KEY,
-                format(""Log level (default: %s)"", BisqEnvironment.LOG_LEVEL_DEFAULT))
+                ""Log level"")
                 .withRequiredArg()
-                .describedAs(""OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE"");
+                .describedAs(""OFF|ALL|ERROR|WARN|INFO|DEBUG|TRACE"")
+                .defaultsTo(BisqEnvironment.LOG_LEVEL_DEFAULT);
 
         //NetworkOptionKeys
         parser.accepts(NetworkOptionKeys.SEED_NODES_KEY,
@@ -348,19 +351,22 @@
 
         // use a fixed port as arbitrator use that for his ID
         parser.accepts(NetworkOptionKeys.PORT_KEY,
-                format(""Port to listen on (default: %s)"", ""9999""))
+                ""Port to listen on"")
                 .withRequiredArg()
-                .ofType(int.class);
+                .ofType(int.class)
+                .defaultsTo(9999);
 
         parser.accepts(NetworkOptionKeys.USE_LOCALHOST_FOR_P2P,
-                format(""Use localhost P2P network for development (default: %s)"", ""false""))
+                ""Use localhost P2P network for development"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(NetworkOptionKeys.MAX_CONNECTIONS,
-                format(""Max. connections a peer will try to keep (default: %s)"", P2PService.MAX_CONNECTIONS_DEFAULT))
+                ""Max. connections a peer will try to keep"")
                 .withRequiredArg()
-                .ofType(int.class);
+                .ofType(int.class)
+                .defaultsTo(P2PService.MAX_CONNECTIONS_DEFAULT);
 
         parser.accepts(NetworkOptionKeys.SOCKS_5_PROXY_BTC_ADDRESS,
                 ""A proxy address to be used for Bitcoin network."")
@@ -414,57 +420,66 @@
 
         //AppOptionKeys
         parser.accepts(AppOptionKeys.USER_DATA_DIR_KEY,
-                format(""User data directory (default: %s)"", BisqEnvironment.DEFAULT_USER_DATA_DIR))
-                .withRequiredArg();
+                ""User data directory"")
+                .withRequiredArg()
+                .defaultsTo(BisqEnvironment.DEFAULT_USER_DATA_DIR);
 
         parser.accepts(AppOptionKeys.APP_NAME_KEY,
-                format(""Application name (default: %s)"", BisqEnvironment.DEFAULT_APP_NAME))
-                .withRequiredArg();
+                ""Application name"")
+                .withRequiredArg()
+                .defaultsTo(BisqEnvironment.DEFAULT_APP_NAME);
 
         parser.accepts(AppOptionKeys.MAX_MEMORY,
-                format(""Max. permitted memory (used only at headless versions) (default: %s)"", ""600""))
-                .withRequiredArg();
+                ""Max. permitted memory (used only at headless versions)"")
+                .withRequiredArg()
+                .defaultsTo(""600"");
 
         parser.accepts(AppOptionKeys.APP_DATA_DIR_KEY,
-                format(""Application data directory (default: %s)"", BisqEnvironment.DEFAULT_APP_DATA_DIR))
-                .withRequiredArg();
+                ""Application data directory"")
+                .withRequiredArg()
+                .defaultsTo(BisqEnvironment.DEFAULT_APP_DATA_DIR);
 
         parser.accepts(AppOptionKeys.IGNORE_DEV_MSG_KEY,
-                format(""If set to true all signed network_messages from bisq developers are ignored "" +
-                        ""(Global alert, Version update alert, Filters for offers, nodes or trading account data) (default: %s)"", ""false""))
+                ""If set to true all signed network_messages from bisq developers are ignored "" +
+                        ""(Global alert, Version update alert, Filters for offers, nodes or trading account data)"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.DESKTOP_WITH_HTTP_API,
-                format(""If set to true Bisq Desktop starts with Http API (default: %s)"", ""false""))
+                ""If set to true Bisq Desktop starts with Http API"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.DESKTOP_WITH_GRPC_API,
-                format(""If set to true Bisq Desktop starts with gRPC API (default: %s)"", ""false""))
+                ""If set to true Bisq Desktop starts with gRPC API"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.USE_DEV_PRIVILEGE_KEYS,
-                format(""If that is true all the privileged features which requires a private key "" +
-                        ""to enable it are overridden by a dev key pair (This is for developers only!) (default: %s)"", ""false""))
+                ""If that is true all the privileged features which requires a private key "" +
+                        ""to enable it are overridden by a dev key pair (This is for developers only!)"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.REFERRAL_ID,
                 ""Optional Referral ID (e.g. for API users or pro market makers)"")
                 .withRequiredArg();
 
         parser.accepts(CommonOptionKeys.USE_DEV_MODE,
-                format(""Enables dev mode which is used for convenience for developer testing (default: %s)"", ""false""))
+                ""Enables dev mode which is used for convenience for developer testing"")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.DUMP_STATISTICS,
-                format(""If set to true the trade statistics are stored as json file in the data dir. (default: %s)"",
-                        ""false""))
+                ""If set to true the trade statistics are stored as json file in the data dir."")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(AppOptionKeys.PROVIDERS,
                 ""Custom providers (comma separated)"")
@@ -478,10 +493,10 @@
                 .ofType(String.class)
                 .describedAs(format(""%s|%s|%s"", BTC_MAINNET, BTC_TESTNET, BTC_REGTEST));
 
-        parser.accepts(BtcOptionKeys.REG_TEST_HOST,
-                format(""(default: %s)"", RegTestHost.DEFAULT))
+        parser.accepts(BtcOptionKeys.REG_TEST_HOST)
                 .withRequiredArg()
-                .ofType(RegTestHost.class);
+                .ofType(RegTestHost.class)
+                .defaultsTo(RegTestHost.DEFAULT);
 
         parser.accepts(BtcOptionKeys.BTC_NODES,
                 ""Custom nodes used for BitcoinJ as comma separated IP addresses."")
@@ -493,10 +508,11 @@
                 .withRequiredArg();
 
         parser.accepts(BtcOptionKeys.SOCKS5_DISCOVER_MODE,
-                format(""Specify discovery mode for Bitcoin nodes. One or more of: [ADDR, DNS, ONION, ALL]"" +
-                        "" (comma separated, they get OR'd together). (default: %s)"", ""ALL""))
+                ""Specify discovery mode for Bitcoin nodes. One or more of: [ADDR, DNS, ONION, ALL]"" +
+                        "" (comma separated, they get OR'd together)."")
                 .withRequiredArg()
-                .describedAs(""mode[,...]"");
+                .describedAs(""mode[,...]"")
+                .defaultsTo(""ALL"");
 
         parser.accepts(BtcOptionKeys.USE_ALL_PROVIDED_NODES,
                 ""Set to true if connection of bitcoin nodes should include clear net nodes"")
@@ -507,8 +523,9 @@
                 .withRequiredArg();
 
         parser.accepts(BtcOptionKeys.NUM_CONNECTIONS_FOR_BTC,
-                format(""Number of connections to the Bitcoin network (default: %s)"", ""9""))
-                .withRequiredArg();
+                ""Number of connections to the Bitcoin network"")
+                .withRequiredArg()
+                .defaultsTo(""9"");
 
         //RpcOptionKeys
         parser.accepts(DaoOptionKeys.RPC_USER,
@@ -528,10 +545,11 @@
                 .withRequiredArg();
 
         parser.accepts(DaoOptionKeys.DUMP_BLOCKCHAIN_DATA,
-                format(""If set to true the blockchain data from RPC requests to Bitcoin Core are "" +
-                        ""stored as json file in the data dir. (default: %s)"", ""false""))
+                ""If set to true the blockchain data from RPC requests to Bitcoin Core are "" +
+                        ""stored as json file in the data dir."")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
 
         parser.accepts(DaoOptionKeys.FULL_DAO_NODE,
                 ""If set to true the node requests the blockchain data via RPC requests "" +
@@ -544,13 +562,15 @@
                 .withRequiredArg();
 
         parser.accepts(DaoOptionKeys.GENESIS_BLOCK_HEIGHT,
-                format(""Genesis transaction block height when not using the hard coded one (default: %s)"", ""-1""))
-                .withRequiredArg();
+                ""Genesis transaction block height when not using the hard coded one"")
+                .withRequiredArg()
+                .defaultsTo(""-1"");
 
         parser.accepts(DaoOptionKeys.DAO_ACTIVATED,
-                format(""Developer flag. If true it enables dao phase 2 features. (default: %s)"", ""false""))
+                ""Developer flag. If true it enables dao phase 2 features."")
                 .withRequiredArg()
-                .ofType(boolean.class);
+                .ofType(boolean.class)
+                .defaultsTo(false);
     }
 
     public static BisqEnvironment getBisqEnvironment(OptionSet options) {",1
RMSProp constructor fix that didn't get pushed up in last PR,"     private INDArray lastGradient;
     private double rmsDecay = DEFAULT_RMSPROP_RMSDECAY;
     private double learningRate = 1e-1;
-    private double epsilon = DEFAULT_RMSPROP_EPSILON;
+    private static final double epsilon = DEFAULT_RMSPROP_EPSILON;
 
     public RmsProp(double learningRate, double rmsDecay) {
-        this(learningRate, rmsDecay, DEFAULT_RMSPROP_EPSILON);
-    }
-
-    public RmsProp(double learningRate, double rmsDecay, double epsilon){
         this.learningRate = learningRate;
         this.rmsDecay = rmsDecay;
-        this.epsilon = epsilon;
     }
 
     @Override",1
Fixes #1047," import org.terasology.logic.console.CoreMessageType;
 import org.terasology.logic.console.Message;
 import org.terasology.logic.console.MessageType;
-import org.terasology.network.ClientComponent;
+import org.terasology.network.Client;
+import org.terasology.network.NetworkMode;
 import org.terasology.network.NetworkSystem;
 import org.terasology.registry.CoreRegistry;
 import org.terasology.rendering.FontColor;
@@ -251,8 +252,8 @@
             }
         }
 
-        ClientComponent cc = callingClient.getComponent(ClientComponent.class);
-        if (cc.local) {
+        Client owner = networkSystem.getOwner(callingClient);
+        if (networkSystem.getMode() == NetworkMode.NONE || (owner != null && owner.isLocal())) {
             localCommandHistory.add(command);
         }
 ",1
[JENKINS-34448] Fixed offlineCause race condition,"                     try {
                         for (ComputerListener cl : ComputerListener.all())
                             cl.preLaunch(SlaveComputer.this, taskListener);
-                        offlineCause = null;
+
                         launcher.launch(SlaveComputer.this, taskListener);
                     } catch (AbortException e) {
                         taskListener.error(e.getMessage());
@@ -266,7 +266,7 @@
                         throw e;
                     }
                 } finally {
-                    if (channel==null && offlineCause == null) {
+                    if (channel==null) {
                         offlineCause = new OfflineCause.LaunchFailed();
                         for (ComputerListener cl : ComputerListener.all())
                             cl.onLaunchFailure(SlaveComputer.this, taskListener);",1
Fixing NPE crash in ElementInfo.<init>() from Document.createDOMUpdate(),"       NodeDescriptor descriptor = mDocumentProvider.getNodeDescriptor(element);
       mObjectIdMapper.putObject(element);
       descriptor.getChildren(element, childrenAccumulator);
-
-      for (int i = 0, size = childrenAccumulator.size(); i < size; ++i) {
-        Object child = childrenAccumulator.get(i);
-        if (child != null) {
-          mCachedUpdateQueue.add(child);
-        } else {
-          // This could be indicative of a bug in Stetho code, but could also be caused by a
-          // custom element of some kind, e.g. ViewGroup. Let's not allow it to kill the hosting
-          // app.
-          LogUtil.e(
-              ""%s.getChildren() emitted a null child at position %s for element %s"",
-              descriptor.getClass().getName(),
-              Integer.toString(i),
-              element);
-
-          childrenAccumulator.remove(i);
-          --i;
-          --size;
+      updateBuilder.setElementChildren(element, childrenAccumulator);
+      for (int i = 0, N = childrenAccumulator.size(); i < N; ++i) {
+        mCachedUpdateQueue.add(childrenAccumulator.get(i));
       }
-      }
-
-      updateBuilder.setElementChildren(element, childrenAccumulator);
       childrenAccumulator.clear();
     }
 ",1
Fix javadoc typo in MultiLayerNetwork.score(Data),"     }
 
     /**Sets the input and labels and returns a score for the prediction with respect to the true labels<br>
-     * This is equivalent to {@link #score(DataSet, boolean)} with training==false.
+     * This is equivalent to {@link #score(DataSet, boolean)} with training==true.
      * @param data the data to score
      * @return the score for the given input,label pairs
      * @see #score(DataSet, boolean)",1
[5.3] Fix potential non-threadsafe usage for Cipher class," 
     private final SecretKeySpec encryptionKey;
 
-    private final String cipherAlgorithm = ""AES"";
+    private final Cipher aesCipher;
 
     /**
      * Instantiates a new cryptic ticket cipher executor.
@@ -64,23 +64,22 @@
         ensureSigningKeyExists(signingSecretKey, signingKeySize);
         ensureEncryptionKeyExists(encryptionSecretKey, encryptionKeySize);
         this.encryptionKey = new SecretKeySpec(this.encryptionSecretKey, this.secretKeyAlgorithm);
+        this.aesCipher = Cipher.getInstance(""AES"");
     }
 
     @Override
     @SneakyThrows
     public byte[] encode(final byte[] value, final Object[] parameters) {
-        final Cipher aesCipher = Cipher.getInstance(cipherAlgorithm);
-        aesCipher.init(Cipher.ENCRYPT_MODE, this.encryptionKey);
-        final byte[] result = aesCipher.doFinal(value);
+        this.aesCipher.init(Cipher.ENCRYPT_MODE, this.encryptionKey);
+        final byte[] result = this.aesCipher.doFinal(value);
         return sign(result);
     }
 
     @Override
     @SneakyThrows
     public byte[] decode(final byte[] value, final Object[] parameters) {
-        final Cipher aesCipher = Cipher.getInstance(cipherAlgorithm);
         final byte[] verifiedValue = verifySignature(value);
-        aesCipher.init(Cipher.DECRYPT_MODE, this.encryptionKey);
+        this.aesCipher.init(Cipher.DECRYPT_MODE, this.encryptionKey);
         final byte[] bytePlainText = aesCipher.doFinal(verifiedValue);
         return bytePlainText;
     }",1
Add missing empty ammo slot to the remaining emote steps.," 		new EmoteClue(""Headbang in the Fight Arena pub. Equip a pirate bandana, a dragonstone necklace and and a magic longbow."", OUTSIDE_THE_BAR_BY_THE_FIGHT_ARENA, new WorldPoint(2568, 3149, 0), HEADBANG, any(""Any pirate bandana"", item(PIRATE_BANDANA), item(PIRATE_BANDANA_7124), item(PIRATE_BANDANA_7130), item(PIRATE_BANDANA_7136)), item(DRAGON_NECKLACE), item(MAGIC_LONGBOW)),
 		new EmoteClue(""Do a jig at the barrow's chest. Beware of double agents! Equip any full barrows set."", BARROWS_CHEST, new WorldPoint(3551, 9694, 0), JIG, any(""Any full barrows set"", all(range(AHRIMS_HOOD_100, AHRIMS_HOOD_0), range(AHRIMS_STAFF_100, AHRIMS_STAFF_0), range(AHRIMS_ROBETOP_100, AHRIMS_ROBETOP_0), range(AHRIMS_ROBESKIRT_100, AHRIMS_ROBESKIRT_0)), all(range(DHAROKS_HELM_100, DHAROKS_HELM_0), range(DHAROKS_GREATAXE_100, DHAROKS_GREATAXE_0), range(DHAROKS_PLATEBODY_100, DHAROKS_PLATEBODY_0), range(DHAROKS_PLATELEGS_100, DHAROKS_PLATELEGS_0)), all(range(GUTHANS_HELM_100, GUTHANS_HELM_0), range(GUTHANS_WARSPEAR_100, GUTHANS_WARSPEAR_0), range(GUTHANS_PLATEBODY_100, GUTHANS_PLATEBODY_0), range(GUTHANS_CHAINSKIRT_100, GUTHANS_CHAINSKIRT_0)), all(range(KARILS_COIF_100, KARILS_COIF_0), range(KARILS_CROSSBOW_100, KARILS_CROSSBOW_0), range(KARILS_LEATHERTOP_100, KARILS_LEATHERTOP_0), range(KARILS_LEATHERSKIRT_100, KARILS_LEATHERSKIRT_0)), all(range(TORAGS_HELM_100, TORAGS_HELM_0), range(TORAGS_HAMMERS_100, TORAGS_HAMMERS_0), range(TORAGS_PLATEBODY_100, TORAGS_PLATEBODY_0), range(TORAGS_PLATELEGS_100, TORAGS_PLATELEGS_0)), all(range(VERACS_HELM_100, VERACS_HELM_0), range(VERACS_FLAIL_100, VERACS_FLAIL_0), range(VERACS_BRASSARD_100, VERACS_BRASSARD_0), range(VERACS_PLATESKIRT_100, VERACS_PLATESKIRT_0)))),
 		new EmoteClue(""Jig at Jiggig. Beware of double agents! Equip a Rune spear, rune platelegs and any rune heraldic helm."", IN_THE_MIDDLE_OF_JIGGIG, new WorldPoint(2477, 3047, 0), JIG, range(""Any rune heraldic helm"", RUNE_HELM_H1, RUNE_HELM_H5), item(RUNE_SPEAR), item(RUNE_PLATELEGS)),
-		new EmoteClue(""Cheer at the games room. Have nothing equipped at all when you do."", null, new WorldPoint(2207, 4952, 0), CHEER, emptySlot(""Nothing at all"", HEAD, CAPE, AMULET, WEAPON, BODY, SHIELD, LEGS, GLOVES, BOOTS, RING, AMMO)),
-		new EmoteClue(""Panic on the pier where you catch the Fishing trawler. Have nothing equipped at all when you do."", null, new WorldPoint(2676, 3169, 0), PANIC, emptySlot(""Nothing at all"", HEAD, CAPE, AMULET, WEAPON, BODY, SHIELD, LEGS, GLOVES, BOOTS, RING, AMMO)),
+		new EmoteClue(""Cheer at the games room. Have nothing equipped at all when you do."", null, new WorldPoint(2207, 4952, 0), CHEER, emptySlot(""Nothing at all"", HEAD, CAPE, AMULET, WEAPON, BODY, SHIELD, LEGS, GLOVES, BOOTS, RING)),
+		new EmoteClue(""Panic on the pier where you catch the Fishing trawler. Have nothing equipped at all when you do."", null, new WorldPoint(2676, 3169, 0), PANIC, emptySlot(""Nothing at all"", HEAD, CAPE, AMULET, WEAPON, BODY, SHIELD, LEGS, GLOVES, BOOTS, RING)),
 		new EmoteClue(""Panic in the heart of the Haunted Woods. Beware of double agents! Have no items equipped when you do."", null, new WorldPoint(3611, 3492, 0), PANIC, emptySlot(""Nothing at all"", HEAD, CAPE, AMULET, WEAPON, BODY, SHIELD, LEGS, GLOVES, BOOTS, RING, AMMO)),
 		new EmoteClue(""Show your anger towards the Statue of Saradomin in Ellamaria's garden. Beware of double agents! Equip a zamorak godsword."", BY_THE_BEAR_CAGE_IN_VARROCK_PALACE_GARDENS, new WorldPoint(3230, 3478, 0), ANGRY, item(ZAMORAK_GODSWORD)),
 		new EmoteClue(""Show your anger at the Wise old man. Beware of double agents! Equip an abyssal whip, a legend's cape and some spined chaps."", BEHIND_MISS_SCHISM_IN_DRAYNOR_VILLAGE, new WorldPoint(3088, 3254, 0), ANGRY, item(ABYSSAL_WHIP), item(CAPE_OF_LEGENDS), item(SPINED_CHAPS)),",1
Fixes NPE in smoothScrollToPosition* methods," 	private int getHeaderOverlap(int position) {
 		boolean isStartOfSection = isStartOfSection(position);
 		if (!isStartOfSection) {
-			View header = mAdapter.getHeaderView(position, null, mList);
-			header.setLayoutParams(new ViewGroup.LayoutParams(
-					LayoutParams.MATCH_PARENT, LayoutParams.WRAP_CONTENT));
+			View header = mAdapter.getView(position, null, mList);
 
 			final int width = getWidth();
 			final int parentWidthMeasureSpec = MeasureSpec.makeMeasureSpec(",1
Fix Windows system tray icon resolution,"         try {
             BufferedImage trayIconImage = ImageIO.read(getClass().getResource(path));
             TrayIcon trayIcon = new TrayIcon(trayIconImage);
-            // On Windows and Linux the icon needs to be resized
+            // On Windows and Linux the icon needs to be scaled
             // On macOS we get the correct size from the provided image
             if (!Utilities.isOSX()) {
-                if (ImageUtil.isRetina()) {
-                    // Using auto sizing provides better results with high resolution
-                    trayIcon.setImageAutoSize(true);
-                } else {
-                    // Using scaling provides better results with low resolution
-                    trayIcon = new TrayIcon(trayIconImage.getScaledInstance(trayIcon.getSize().width, -1, Image.SCALE_SMOOTH));
-                }
+                int trayIconWidth = trayIcon.getSize().width;
+                trayIcon = new TrayIcon(trayIconImage.getScaledInstance(trayIconWidth, -1, Image.SCALE_SMOOTH));
             }
 
             trayIcon.setPopupMenu(popupMenu);",1
Fix Typo issue," 	 */
 	static String quote(final List<String> args) {
 		final StringBuilder result = new StringBuilder();
-		boolean separate = false;
+		boolean seperate = false;
 		for (final String arg : args) {
-			if (separate) {
+			if (seperate) {
 				result.append(BLANK);
 			}
 			result.append(quote(arg));
-			separate = true;
+			seperate = true;
 		}
 		return result.toString();
 	}
@@ -70,7 +70,7 @@
 	 * present.
 	 * 
 	 * @param commandline
-	 *            combined command line
+	 *            combinded command line
 	 * @return list of arguments
 	 */
 	static List<String> split(final String commandline) {
@@ -79,11 +79,11 @@
 		}
 		final List<String> args = new ArrayList<String>();
 		final StringBuilder current = new StringBuilder();
-		int mode = M_STRIP_WHITESPACE;
+		int mode = M_STRIPWHITESPACE;
 		int endChar = BLANK;
 		for (final char c : commandline.toCharArray()) {
 			switch (mode) {
-			case M_STRIP_WHITESPACE:
+			case M_STRIPWHITESPACE:
 				if (!Character.isWhitespace(c)) {
 					if (c == QUOTE) {
 						endChar = QUOTE;
@@ -91,13 +91,13 @@
 						current.append(c);
 						endChar = BLANK;
 					}
-					mode = M_PARSE_ARGUMENT;
+					mode = M_PARSEARGUMENT;
 				}
 				break;
-			case M_PARSE_ARGUMENT:
+			case M_PARSEARGUMENT:
 				if (c == endChar) {
 					addArgument(args, current);
-					mode = M_STRIP_WHITESPACE;
+					mode = M_STRIPWHITESPACE;
 				} else if (c == SLASH) {
 					current.append(SLASH);
 					mode = M_ESCAPED;
@@ -110,11 +110,11 @@
 					current.setCharAt(current.length() - 1, c);
 				} else if (c == endChar) {
 					addArgument(args, current);
-					mode = M_STRIP_WHITESPACE;
+					mode = M_STRIPWHITESPACE;
 				} else {
 					current.append(c);
 				}
-				mode = M_PARSE_ARGUMENT;
+				mode = M_PARSEARGUMENT;
 				break;
 			}
 		}
@@ -130,8 +130,8 @@
 		}
 	}
 
-	private static final int M_STRIP_WHITESPACE = 0;
-	private static final int M_PARSE_ARGUMENT = 1;
+	private static final int M_STRIPWHITESPACE = 0;
+	private static final int M_PARSEARGUMENT = 1;
 	private static final int M_ESCAPED = 2;
 
 	private CommandLineSupport() {",1
fix #1074 Shutdown request task executor in event loop's forceShutdown," 		int t = terminated;
 		if (t != FORCED_SHUTDOWN && TERMINATED.compareAndSet(this, t, FORCED_SHUTDOWN)) {
 			executor.shutdownNow();
-			requestTaskExecutor.shutdownNow();
 		}
 		return drain();
 	}",1
Missing space character in debug log,,1
"Header Fix, re-opened"," 
 import java.util.Collections;
 import java.util.Iterator;
-import java.util.TreeMap;
+import java.util.LinkedHashMap;
+import java.util.Locale;
 
 public class HandshakedataImpl1 implements HandshakeBuilder {
 	private byte[] content;
-	private TreeMap<String,String> map;
+	private LinkedHashMap<String,String> map;
 
 	public HandshakedataImpl1() {
-		map = new TreeMap<String,String>( String.CASE_INSENSITIVE_ORDER );
+		map = new LinkedHashMap<String,String>();
 	}
 
 	/*public HandshakedataImpl1( Handshakedata h ) {
@@ -31,7 +32,7 @@
 
 	@Override
 	public String getFieldValue( String name ) {
-		String s = map.get( name );
+		String s = map.get( name.toLowerCase( Locale.ENGLISH ) );
 		if( s == null ) {
 			return """";
 		}
@@ -50,11 +51,11 @@
 
 	@Override
 	public void put( String name, String value ) {
-		map.put( name, value );
+		map.put( name.toLowerCase( Locale.ENGLISH ), value );
 	}
 
 	@Override
 	public boolean hasFieldValue( String name ) {
-		return map.containsKey( name );
+		return map.containsKey( name.toLowerCase( Locale.ENGLISH ) );
 	}
 }",1
Fix warnings in BlockEncodingManager," import static com.google.common.base.Preconditions.checkArgument;
 import static com.google.common.base.Preconditions.checkNotNull;
 
-public final class BlockEncodingManager
+public class BlockEncodingManager
         implements BlockEncodingSerde
 {
     private final TypeManager typeManager;
@@ -79,7 +79,6 @@
         String encodingName = encoding.getName();
 
         // look up the encoding factory
-        @SuppressWarnings(""unchecked"")
         BlockEncodingFactory<T> blockEncoding = (BlockEncodingFactory<T>) blockEncodings.get(encodingName);
         checkArgument(blockEncoding != null, ""Unknown block encoding %s"", encodingName);
 
@@ -98,9 +97,9 @@
         return new String(bytes, Charsets.UTF_8);
     }
 
-    private static void writeLengthPrefixedString(SliceOutput output, String value)
+    private static void writeLengthPrefixedString(SliceOutput output, String string)
     {
-        byte[] bytes = value.getBytes(Charsets.UTF_8);
+        byte[] bytes = string.getBytes(Charsets.UTF_8);
         output.writeInt(bytes.length);
         output.writeBytes(bytes);
     }",1
Fix color validation on CropViewConfig,"     }
 
     void setViewportHeaderFooterColor(int viewportHeaderFooterColor) {
-        this.viewportHeaderFooterColor = viewportHeaderFooterColor;
+        this.viewportHeaderFooterColor =
+                viewportHeaderFooterColor <= 0
+                        ? DEFAULT_VIEWPORT_HEADER_FOOTER_COLOR
+                        : viewportHeaderFooterColor;
     }
 
     public float getViewportHeightRatio() {",1
Fix for  video not playable,"     }
 
     @Override
-    public void onStart() {
-        super.onStart();
+    public void onActivityCreated(Bundle savedInstanceBundle) {
+        super.onActivityCreated(savedInstanceBundle);
         Activity a = getActivity();
 
         infoItemBuilder = new InfoItemBuilder(a, a.findViewById(android.R.id.content));",1
Fix viewHolder.contentParent & recycle check at ExpandableListItemAdapter," 		}
 
 		View titleView = getTitleView(position, viewHolder.titleView, viewHolder.titleParent);
-		if (titleView != viewHolder.titleView) {
+		if (!titleView.equals(viewHolder.titleView)) {
 			viewHolder.titleParent.removeAllViews();
 			viewHolder.titleParent.addView(titleView);
 
@@ -116,11 +116,11 @@
 		viewHolder.titleView = titleView;
 
 		View contentView = getContentView(position, viewHolder.contentView, viewHolder.contentParent);
-		if (contentView != viewHolder.contentView) {
+		if (!contentView.equals(viewHolder.contentView)) {
 			viewHolder.contentParent.removeAllViews();
 			viewHolder.contentParent.addView(contentView);
 		}
-		viewHolder.contentParent = contentParent;
+		viewHolder.titleView = titleView;
 
 		viewHolder.contentParent.setVisibility(mVisibleIds.contains(getItemId(position)) ? View.VISIBLE : View.GONE);
 		viewHolder.contentParent.setTag(getItemId(position));",1
Fix plugin inter-dependencies by using one class loader for all plugins," import java.net.MalformedURLException;
 import java.net.URL;
 import java.net.URLClassLoader;
-import java.util.Arrays;
 import java.util.Collection;
 import java.util.Collections;
 import java.util.Comparator;
-import java.util.List;
 import java.util.Objects;
 import java.util.ServiceLoader;
 import java.util.Set;
-import java.util.stream.Collectors;
 
 import static com.google.common.base.Preconditions.checkNotNull;
 import static java.util.Objects.requireNonNull;
@@ -85,27 +82,25 @@
         }
 
         LOG.debug(""Loading [{}] plugins"", files.length);
-        final List<URL> urls = Arrays.stream(files)
-                .filter(File::isFile)
-                .map(jar -> {
+        final ImmutableSet.Builder<Plugin> plugins = ImmutableSet.builder();
+        for (File jar : files) {
+            if (!jar.isFile()) {
+                LOG.debug(""{} is not a file, skipping."", jar);
+            } else {
                 try {
                     LOG.debug(""Loading <"" + jar.getAbsolutePath() + "">"");
-                        return jar.toURI().toURL();
+                    final ClassLoader pluginClassLoader = URLClassLoader.newInstance(new URL[]{jar.toURI().toURL()});
+                    classLoader.addClassLoader(pluginClassLoader);
+                    final ServiceLoader<Plugin> pluginServiceLoader = ServiceLoader.load(Plugin.class, classLoader);
+
+                    plugins.addAll(pluginServiceLoader);
                 } catch (MalformedURLException e) {
                     LOG.error(""Cannot open JAR file for discovering plugins"", e);
-                        return null;
                 }
-                })
-                .filter(Objects::nonNull)
-                .collect(Collectors.toList());
+            }
+        }
 
-        // Create one URL class loader for all plugins so they can see each other.
-        // This makes plugin inter-dependencies work.
-        classLoader.addClassLoader(URLClassLoader.newInstance(urls.toArray(new URL[urls.size()])));
-
-        final ServiceLoader<Plugin> pluginServiceLoader = ServiceLoader.load(Plugin.class, classLoader);
-
-        return ImmutableSet.copyOf(pluginServiceLoader);
+        return plugins.build();
     }
 
     public static class PluginComparator implements Comparator<Plugin> {",1
Fix typo in exception link," @Slf4j
 public class DefaultOpExecutioner implements OpExecutioner {
 
-    private static final String SCOPE_PANIC_MSG = ""For more details, see the ND4J User Guide: nd4j.org/userguide#workspaces-panic"";
+    private static final String SCOPE_PANIC_MSG = ""For more details, see the ND4J User Guide: nd4.org/userguide#workspaces-panic"";
 
     protected ProfilingMode profilingMode = ProfilingMode.SCOPE_PANIC;
     protected ExecutionMode executionMode = ExecutionMode.JAVA;",1
[WIP] Fixed A Crash Of Sample App When Sample App Get Back To Foreground," 
 package permissions.dispatcher.sample.camera;
 
-import android.app.Activity;
 import android.hardware.Camera;
 import android.os.Bundle;
 import android.support.v4.app.Fragment;
@@ -105,12 +104,6 @@
         if (mCamera != null) {
             mCamera.release();        // release the camera for other applications
             mCamera = null;
-
-            Activity activity = getActivity();
-
-            if (activity != null) {
-                activity.onBackPressed();
-            }
         }
     }
 }",1
fix:LruCache accessOrder 没设置为 true 的问题," 
 import com.alibaba.dubbo.cache.Cache;
 import com.alibaba.dubbo.common.URL;
-import com.alibaba.dubbo.common.utils.LRUCache;
 
 import java.util.LinkedHashMap;
 import java.util.Map;
@@ -34,7 +33,14 @@
 
     public LruCache(URL url) {
         final int max = url.getParameter(""cache.size"", 1000);
-        this.store = new LRUCache<Object,Object>(max);
+        this.store = new LinkedHashMap<Object, Object>() {
+            private static final long serialVersionUID = -3834209229668463829L;
+
+            @Override
+            protected boolean removeEldestEntry(Entry<Object, Object> eldest) {
+                return size() > max;
+            }
+        };
     }
 
     public void put(Object key, Object value) {",1
Make heartbeat timeout option for AmqpTransport optional,"                             ""Heartbeat timeout"",
                             ConnectionFactory.DEFAULT_HEARTBEAT,
                             ""Heartbeat interval in seconds (use 0 to disable heartbeat)"",
-                            ConfigurationField.Optional.OPTIONAL
+                            ConfigurationField.Optional.NOT_OPTIONAL
                     )
             );
 ",1
Netty ChannelManager.tryToOfferChannelToPool makes channel available for...,"     public final void tryToOfferChannelToPool(Channel channel, boolean keepAlive, String partition) {
         if (channel.isConnected() && keepAlive && channel.isReadable()) {
             LOGGER.debug(""Adding key: {} for channel {}"", partition, channel);
-            Channels.setDiscard(channel);
             channelPool.offer(channel, partition);
             if (maxConnectionsPerHostEnabled)
                 channelId2KeyPool.putIfAbsent(channel.getId(), partition);
+            Channels.setDiscard(channel);
         } else {
             // not offered
             closeChannel(channel);",1
Truncate timestamps when adding demo data to a Postgres database,"                 newCommand = charMatcher.replaceAll(""CHR("" + charCode + "")"");
             }
 
-            // Replace CURRENT_TIMESTAMP with date_trunc('second', CURRENT_TIMESTAMP) otherwise the time will be in fractions of a second
-            // This is an issue because when adding a collection item to a sandboxable item the time will be rounded and
-            // an attempt to save straight to production will occur resulting in an error
-            newCommand = newCommand.replaceAll(""CURRENT_TIMESTAMP"", ""date_trunc('second', CURRENT_TIMESTAMP)"");
-
             newCommands[i] = newCommand;
             i++;
         }",1
fixed bug: high speed scroll could prevent calling onMoreAsked,"                             break;
                     }
 
-                    if (((totalItemCount - lastVisibleItemPosition) <= ITEM_LEFT_TO_LOAD_MORE ||
+                    if (((totalItemCount - lastVisibleItemPosition) == ITEM_LEFT_TO_LOAD_MORE ||
                          (totalItemCount - lastVisibleItemPosition) == 0 && totalItemCount > visibleItemCount)
                         && !isLoadingMore) {
 ",1
adds check for local source module to module downloader," import org.terasology.module.DependencyResolver;
 import org.terasology.module.Module;
 import org.terasology.module.ModuleRegistry;
-import org.terasology.module.PathModule;
 import org.terasology.module.ResolutionResult;
 import org.terasology.naming.Name;
 import org.terasology.naming.Version;
@@ -56,16 +55,6 @@
                 .collect(Collectors.toSet());
     }
 
-    /**
-     * Whether the given module is present as source in the workspace.
-     *
-     * This is relevant when running the game from a local workspace to prevent downloading modules already present as
-     * source.
-     */
-    private boolean isSourceModule(Module module) {
-        return module instanceof PathModule;
-    }
-
     private boolean isOnlineVersionNewer(Module localVersion, Module onlineVersion) {
         if (onlineVersion == null) {
             return false;
@@ -77,10 +66,6 @@
         if (versionCompare > 0) {
             return true;
         } else if (versionCompare == 0) {
-            if (isSourceModule(localVersion)) {
-                // In case the version of the local source module is the same as remote, don't download it again.
-                return false;
-            } else {
                 /*
                  * Multiple binaries get released as the same snapshot version, A version name match thus does not
                  * guarantee that we have the newest version already if it is a snapshot version.
@@ -89,7 +74,6 @@
                  * being stuck on an outdated snapshot binary.
                  */
             return onlineVersion.getVersion().isSnapshot();
-            }
         } else {
             return false;
         }",1
Long can never be equals to a String,"         }
 
         // Record the open
-        if (emailId != null) {
+        if (emailId != null && !""null"".equals(emailId)) {
             if (LOG.isDebugEnabled()) {
                 LOG.debug(""service() => Recording Open for Email["" + emailId + ""]"");
             }",1
Apply access-level changes to inner class attributes," import org.objectweb.asm.tree.AbstractInsnNode;
 import org.objectweb.asm.tree.ClassNode;
 import org.objectweb.asm.tree.FieldNode;
-import org.objectweb.asm.tree.InnerClassNode;
 import org.objectweb.asm.tree.MethodInsnNode;
 import org.objectweb.asm.tree.MethodNode;
 
@@ -205,15 +204,6 @@
                 {
                     FMLLog.log.debug(""Class: {} {} -> {}"", name, toBinary(m.oldAccess), toBinary(m.newAccess));
                 }
-                // if this is an inner class, also modify the access flags on the corresponding InnerClasses attribute
-                for (InnerClassNode innerClass : classNode.innerClasses)
-                {
-                    if (innerClass.name.equals(classNode.name))
-                    {
-                        innerClass.access = getFixedAccess(innerClass.access, m);
-                        break;
-                    }
-                }
                 continue;
             }
             if (m.desc.isEmpty())
@@ -271,12 +261,9 @@
                     }
                 }
 
-                if (!nowOverrideable.isEmpty())
-                {
                 replaceInvokeSpecial(classNode, nowOverrideable);
             }
         }
-        }
 
         ClassWriter writer = new ClassWriter(ClassWriter.COMPUTE_MAXS);
         classNode.accept(writer);",1
Update setOrderSubtotalToPriceWithoutAdjustments to call calculateSubtot...," 
     @Override
     public void setOrderSubTotalToPriceWithoutAdjustments() {
-        Money calculatedSubTotal = calculateSubtotalWithoutAdjustments();
+        Money calculatedSubTotal = calculateOrderSubTotalWithoutOrderAdjustments();
         order.setSubTotal(calculatedSubTotal);
     }
     
@@ -86,6 +86,14 @@
         order.setSubTotal(calculatedSubTotal);
     }    
 
+    private Money calculateOrderSubTotalWithoutOrderAdjustments() {
+        Money calculatedSubTotal = BroadleafCurrencyUtils.getMoney(order.getCurrency());
+        for (OrderItem orderItem : order.getOrderItems()) {
+            calculatedSubTotal = calculatedSubTotal.add(orderItem.getTotalPrice());
+        }
+        return calculatedSubTotal;
+    }
+
     @Override
     public List<PromotableOrderItem> getAllOrderItems() {
         if (allOrderItems == null) {",1
Fixes #90 Remove UncaughtExceptionHandler from CameraController in stopImmediately,"             // Don't check, try stop again.
             LOG.i(""Stop immediately. State was:"", ss());
             mState = STATE_STOPPING;
-            // Prevent leaking CameraController.
-            mHandler.getThread().setUncaughtExceptionHandler(null);
             onStop();
             mState = STATE_STOPPED;
             LOG.i(""Stop immediately. Stopped. State is:"", ss());",1
NPE is fixed when owner is null in the InternalPartitionServiceImpl.,"             try {
                 MigrationInfo info = migrationInfo;
                 InternalPartitionImpl partition = partitions[info.getPartitionId()];
-                Address owner = partition.getOwner();
-                if (owner == null) {
-                    logger.severe(""ERROR: partition owner is not set! -> ""
+                if (!partition.getOwner().equals(info.getSource())) {
+                    logger.severe(""ERROR: partition owner is not the source of migration! -> ""
                             + partition + "" -VS- "" + info);
-                    return;
-                }
-                if (!owner.equals(info.getSource())) {
-                    logger.severe(""ERROR: partition owner is not the source of migration! -> ""
-                            + partition + "" -VS- "" + info + "" found owner:"" + owner);
-                    return;
                 }
                 sendMigrationEvent(migrationInfo, MigrationStatus.STARTED);
                 Boolean result = Boolean.FALSE;",1
Findbugs failed ClientSmartListenerService.reRegisterAll() makes inefficient use of keySet iterator instead of entrySet iterator ," 
             members.add(member);
 
-            for (Map.Entry<ClientRegistrationKey, Map<Member, ClientEventRegistration>> entry : registrations.entrySet()) {
-                ClientRegistrationKey registrationKey = entry.getKey();
-                Map<Member, ClientEventRegistration> registrationMap = entry.getValue();
+            for (ClientRegistrationKey registrationKey : registrations.keySet()) {
+                Map<Member, ClientEventRegistration> registrationMap = registrations.get(registrationKey);
                 // Only register if not already registered
                 if (null == registrationMap.get(member)) {
                     try {
@@ -370,8 +369,7 @@
     }
 
     private void reRegisterAll() {
-        for (Map.Entry<ClientRegistrationKey, Map<Member, ClientEventRegistration>> entry : registrations.entrySet()) {
-            ClientRegistrationKey key = entry.getKey();
+        for (ClientRegistrationKey key : registrations.keySet()) {
             logger.finest(""Reregistering listener "" + key + "" to the cluster."");
 
             deregister(key, getMemberUuids());
@@ -379,7 +377,7 @@
             try {
                 register(key);
             } catch (Exception e) {
-                Map<Member, ClientEventRegistration> registrationMap = entry.getValue();
+                Map<Member, ClientEventRegistration> registrationMap = registrations.get(key);
                 if (null == registrationMap) {
                     // put back an empty map for keeping the key to be registered in the next try
                     registrations.put(key, new ConcurrentHashMap<Member, ClientEventRegistration>());",1
Add scale to exception message to help debug,"         }
         else
         {
-            throw new IllegalStateException(""Unknown pointer size: "" + scale);
+            throw new IllegalStateException(""Unknown pointer size"");
         }
         REF_ARRAY_BASE = UnsafeAccess.UNSAFE.arrayBaseOffset(Object[].class);
     }",1
Fix NPE for issue #1901,"     }
 
     public boolean isPlaying() {
-        if (simpleExoPlayer == null) return false;
         final int state = simpleExoPlayer.getPlaybackState();
         return (state == Player.STATE_READY || state == Player.STATE_BUFFERING)
                 && simpleExoPlayer.getPlayWhenReady();",1
"Fixed the offer code with named ""$item"" that can not be stored in a cookie"," 
     @Column(name = ""OFFER_CODE"", nullable=false)
     @Index(name=""OFFERCODE_CODE_INDEX"", columnNames={""OFFER_CODE""})
-    @AdminPresentation(friendlyName = ""OfferCodeImpl_Offer_Code"", order = 1000, prominent = true, gridOrder = 1000,
-            validationConfigurations = { @ValidationConfiguration(validationImplementation = ""blRegexPropertyValidator"",
-                    configurationItems = {
-                            @ConfigurationItem(itemName = ConfigurationItem.ERROR_MESSAGE, itemValue = ""The name can contain alphanumeric or \""()-=*.?;,+/:&_\"" symbols with a maximum length of 255""),
-                            @ConfigurationItem(itemName = ""regularExpression"", itemValue = ""^[a-zA-Z0-9()\\-=\\*\\.\\?;,+\\/:&_ ]{1,255}$"")})})
+    @AdminPresentation(friendlyName = ""OfferCodeImpl_Offer_Code"", order = 1000, prominent = true, gridOrder = 1000)
     protected String offerCode;
 
     @Column(name = ""START_DATE"")",1
Fix charset computation when it's not specified in contentType,"         
     	if (charset == null) {
 	        String contentType = getContentType();
-        	if (contentType != null)
-        		charset = AsyncHttpProviderUtils.parseCharset(contentType); // parseCharset can return null
+	        if (contentType != null) {
+	            charset = AsyncHttpProviderUtils.parseCharset(contentType);
+	        } else {
+	        	charset = DEFAULT_CHARSET;
 	        }
-        return charset != null? charset: DEFAULT_CHARSET;
+    	}
+
+        return charset;
     }
 
     public boolean hasResponseStatus() {",1
KEYCLOAK-4329 Fix NPE when not providing KeyInfo element in IdP initiated SSO SAML,"      * @return The object or {@code null} if not found.
      */
     public static <T> T getContent(Iterable<Object> objects, Class<T> clazz) {
-        if (objects == null) {
-            return null;
-        }
         for (Object o : objects) {
             if (clazz.isInstance(o)) {
                 return (T) o;
@@ -48,11 +45,11 @@
 
 
     public static KeyName getKeyName(KeyInfo keyInfo) {
-        return keyInfo == null ? null : getContent(keyInfo.getContent(), KeyName.class);
+        return getContent(keyInfo.getContent(), KeyName.class);
     }
 
     public static X509Data getX509Data(KeyInfo keyInfo) {
-        return keyInfo == null ? null : getContent(keyInfo.getContent(), X509Data.class);
+        return getContent(keyInfo.getContent(), X509Data.class);
     }
 
     public static X509Certificate getX509Certificate(KeyInfo keyInfo) {",1
Prevent to set URL.factory to null in case of concurrent URL creation…," import java.net.URLConnection;
 import java.net.URLStreamHandler;
 import java.net.URLStreamHandlerFactory;
-import java.util.concurrent.atomic.AtomicInteger;
 
 /**
  * 
@@ -33,7 +32,6 @@
 public class URLBuilder {
 
     private static URLStreamHandlerFactory currentFactory;
-    private static AtomicInteger refCounter = new AtomicInteger();
     
     private final static URLStreamHandlerFactory newFactory = new URLStreamHandlerFactory() {
         @Override
@@ -65,28 +63,28 @@
     };
     
     public static synchronized void restoreURLFactory() {
-        if (refCounter.decrementAndGet() == 0) {
         try {
             Field field = URL.class.getDeclaredField(""factory"");
             field.setAccessible(true);
             field.set(null, currentFactory);
-                currentFactory = null;
         } catch (Exception e) {
             throw new IllegalStateException(e);
         }
     }
-    }
     
     public static synchronized void replaceURLFactory() {
         try {
-            refCounter.incrementAndGet();
             Field field = URL.class.getDeclaredField(""factory"");
             field.setAccessible(true);
-            final URLStreamHandlerFactory temp = (URLStreamHandlerFactory) field.get(null);
-            if (temp != newFactory) {
-                currentFactory = temp;
+            currentFactory = (URLStreamHandlerFactory) field.get(null);
+            if (currentFactory != null && currentFactory != newFactory) {
                 field.set(null, null);
+            }
+            
+            if (currentFactory != newFactory) {
                 URL.setURLStreamHandlerFactory(newFactory);
+            } else {
+                currentFactory = null;
             }
         } catch (Exception e) {
             throw new IllegalStateException(e);",1
Fixes UNDERTOW-353,"                     WebSockets.sendBinary(ByteBuffer.wrap((byte[])o), webSocketChannel, callback, sendTimeout);
                 } else if(o instanceof ByteBuffer) {
                     WebSockets.sendBinary((ByteBuffer)o, webSocketChannel, callback, sendTimeout);
-                } else if (encoding.canEncodeText(o.getClass())) {
+                } if (encoding.canEncodeText(o.getClass())) {
                     WebSockets.sendText(encoding.encodeText(o), webSocketChannel, callback, sendTimeout);
                 } else if (encoding.canEncodeBinary(o.getClass())) {
                     WebSockets.sendBinary(encoding.encodeBinary(o), webSocketChannel, callback, sendTimeout);",1
Fixed VoldemortConfig bug introduced in 3692fa3.,"                                                                     REPORTING_INTERVAL_BYTES);
         this.readOnlyFetchRetryCount = props.getInt(""fetcher.retry.count"", 5);
         this.readOnlyFetchRetryDelayMs = props.getLong(""fetcher.retry.delay.ms"", 5000);
-        this.fetcherBufferSize = (int) props.getBytes(""hdfs.fetcher.buffer.size"",
+        this.fetcherBufferSize = props.getInt(""hdfs.fetcher.buffer.size"",
                                               DEFAULT_FETCHER_BUFFER_SIZE);
         this.fetcherSocketTimeout = props.getInt(""hdfs.fetcher.socket.timeout"",
                                                  DEFAULT_FETCHER_SOCKET_TIMEOUT);",1
Moved setUseClientMode above setSSLParameters to fix #991 in 1.9.x,"             SSLContext sslContext = SslUtils.getInstance().getSSLContext(config);
             
             SSLEngine sslEngine = sslContext.createSSLEngine(peerHost, peerPort);
-            sslEngine.setUseClientMode(true);
             if (!config.isAcceptAnyCertificate()) {
                 SSLParameters params = sslEngine.getSSLParameters();
                 params.setEndpointIdentificationAlgorithm(""HTTPS"");
                 sslEngine.setSSLParameters(params);
             }
+            sslEngine.setUseClientMode(true);
 
             if (isNonEmpty(config.getEnabledProtocols()))
                 sslEngine.setEnabledProtocols(config.getEnabledProtocols());",1
Fix setStartDelay() is not reset by clear(),"     ViewCompat.setRotationX(v, 0);
     ViewCompat.setPivotY(v, v.getMeasuredHeight() / 2);
     ViewCompat.setPivotX(v, v.getMeasuredWidth() / 2);
-    ViewCompat.animate(v)
-            .setInterpolator(null)
-            .setStartDelay(0);
+    ViewCompat.animate(v).setInterpolator(null);
   }
 }",1
Fix: Custom views should have MATCH_PARENT as default width,"     if (null == croutonView.getParent()) {
       ViewGroup.LayoutParams params = croutonView.getLayoutParams();
       if (null == params) {
-        params = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT);
+        params = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT);
       }
       // display Crouton in ViewGroup is it has been supplied
       if (null != crouton.getViewGroup()) {",1
Fix for adding Double.NaN to IntAryVisitor via addValue().,"     }
     @Override
     public void addValue(double val) {
-      if (Double.isNaN(val)) {
-        vals[_k++] = _na;
-      } else {
       int i = (int)val;
       if( i != val)
         throw new RuntimeException(val + "" does not fit into int"");
       vals[_k++] = i;
     }
-    }
     @Override
     public void addZeros(int zeros) {
       int k = _k;",1
Fixed -unkWord option in RNNOptions.java,"       wordVectors = args[argIndex + 1];
       return argIndex + 2;
     } else if (args[argIndex].equalsIgnoreCase(""-unkWord"")) {
-      unkWord = args[argIndex + 1];
+      unkWord = args[argIndex] + 1;
       return argIndex + 2;
     } else if (args[argIndex].equalsIgnoreCase(""-numHid"")) {
       numHid = Integer.parseInt(args[argIndex + 1]);",1
Fix cache bug,"         final String prefix = getCachePrefix();
         String[] cacheFileNameList = getCacheFolder().list( new FilenameFilter() {
             @Override
-            public boolean accept( File dir, String filename ) {
-                return filename.startsWith( prefix );
+            public boolean accept( File arg0, String arg1 ) {
+                return arg0.getName().startsWith( prefix );
             }
         } );
         List< Object > result = new ArrayList< Object >();",1
AXON-368 fix in master (3.x) branch,"     public MetaData deserialize(JsonParser jp, DeserializationContext ctxt)
             throws IOException {
         JsonDeserializer<Object> deserializer = ctxt.findRootValueDeserializer(
-                ctxt.getTypeFactory().constructMapType(Map.class, String.class, Object.class));
+                ctxt.getTypeFactory().constructMapType(Map.class, String.class, String.class));
 
         return MetaData.from((Map) deserializer.deserialize(jp, ctxt));
     }",1
Add missing config check to party leave message," 		{
 			party.changeParty(null);
 
-			if (!config.messages())
-			{
-				return;
-			}
-
 			final String leaveMessage = new ChatMessageBuilder()
 				.append(ChatColorType.HIGHLIGHT)
 				.append(""You have left the party."")",1
Swap clearing memory cache and pool to prevent re-pooling Bitmaps,"      * @see android.content.ComponentCallbacks2#onLowMemory()
      */
     public void clearMemory() {
-        // Engine asserts this anyway when removing resources, fail faster and consistently
-        Util.assertMainThread();
-        // memory cache needs to be cleared before bitmap pool to clear re-pooled Bitmaps too. See #687.
+        bitmapPool.clearMemory();
         memoryCache.clearMemory();
-        bitmapPool.clearMemory();
     }
 
     /**
@@ -379,11 +376,8 @@
      * @see android.content.ComponentCallbacks2#onTrimMemory(int)
      */
     public void trimMemory(int level) {
-        // Engine asserts this anyway when removing resources, fail faster and consistently
-        Util.assertMainThread();
-        // memory cache needs to be trimmed before bitmap pool to trim re-pooled Bitmaps too. See #687.
+        bitmapPool.trimMemory(level);
         memoryCache.trimMemory(level);
-        bitmapPool.trimMemory(level);
     }
 
     /**
@@ -410,9 +404,6 @@
      * </p>
      */
     public void setMemoryCategory(MemoryCategory memoryCategory) {
-        // Engine asserts this anyway when removing resources, fail faster and consistently
-        Util.assertMainThread();
-        // memory cache needs to be trimmed before bitmap pool to trim re-pooled Bitmaps too. See #687.
         memoryCache.setSizeMultiplier(memoryCategory.getMultiplier());
         bitmapPool.setSizeMultiplier(memoryCategory.getMultiplier());
     }",1
Fix deadlock in SqlStageExecution.waitForNewExchangesOrBuffers," import static com.google.common.collect.Iterables.all;
 import static com.google.common.collect.Iterables.any;
 import static com.google.common.collect.Iterables.transform;
-import static com.google.common.collect.Sets.newConcurrentHashSet;
 import static io.airlift.http.client.HttpUriBuilder.uriBuilderFrom;
 import static io.airlift.units.DataSize.Unit.BYTE;
 import static java.util.concurrent.TimeUnit.NANOSECONDS;
@@ -127,7 +126,7 @@
 
     private final LinkedBlockingQueue<Throwable> failureCauses = new LinkedBlockingQueue<>();
 
-    private final Set<PlanNodeId> completeSources = newConcurrentHashSet();
+    private final Set<PlanNodeId> completeSources = new HashSet<>();
 
     @GuardedBy(""this"")
     private OutputBuffers currentOutputBuffers = INITIAL_EMPTY_OUTPUT_BUFFERS;
@@ -775,19 +774,7 @@
                 return;
             }
 
-            synchronized (this) {
-                // wait for a state change
-                //
-                // NOTE this must be a wait with a timeout since there is no notification
-                // for new exchanges from the child stages
-                try {
-                    TimeUnit.MILLISECONDS.timedWait(this, 100);
-                }
-                catch (InterruptedException e) {
-                    Thread.currentThread().interrupt();
-                    throw Throwables.propagate(e);
-                }
-            }
+            waitForNewExchangesOrBuffers();
         }
     }
 
@@ -823,6 +810,39 @@
         return finished;
     }
 
+    private synchronized void waitForNewExchangesOrBuffers()
+    {
+        while (!getState().isDone()) {
+            // if next loop will finish, don't wait
+            Set<PlanNodeId> completeSources = updateCompleteSources();
+            boolean allSourceComplete = completeSources.containsAll(allSources);
+            if (allSourceComplete && getCurrentOutputBuffers().isNoMoreBufferIds()) {
+                return;
+            }
+            // do we have a new set of output buffers?
+            if (nextOutputBuffers != null) {
+                return;
+            }
+
+            // do we have new exchange locations?
+            if (!getNewExchangeLocations().isEmpty()) {
+                return;
+            }
+
+            // wait for a state change
+            //
+            // NOTE this must be a wait with a timeout since there is no notification
+            // for new exchanges from the child stages
+            try {
+                TimeUnit.MILLISECONDS.timedWait(this, 100);
+            }
+            catch (InterruptedException e) {
+                Thread.currentThread().interrupt();
+                throw Throwables.propagate(e);
+            }
+        }
+    }
+
     private Set<PlanNodeId> updateCompleteSources()
     {
         for (RemoteSourceNode remoteSourceNode : fragment.getRemoteSourceNodes()) {",1
Fix Javadoc code formatting for JsonReader.peek().,"    * Returns a new {@code JsonReader} that can read data from this {@code JsonReader} without
    * consuming it. The returned reader becomes invalid once this one is next read or closed.
    *
-   * For example, we can use {@code peek()} to lookahead and read the same data multiple times.
+   * For example, we can use `peek()` to lookahead and read the same data multiple times.
    *
    * <pre> {@code
    *",1
Additional fix for DataVec API change,"     }
 
     @Override
-    public List<List<Writable>> next(int i) {
+    public List<Writable> next(int i) {
         throw new UnsupportedOperationException();
     }
 ",1
Fix read stencilset.json gibberish when in other languages," @RestController
 public class StencilsetRestResource {
   
-  @RequestMapping(value=""/editor/stencilset"", method = RequestMethod.GET, produces = ""application/json;charset=utf-8"")
+  @RequestMapping(value=""/editor/stencilset"", method = RequestMethod.GET, produces = ""application/json"")
   public @ResponseBody String getStencilset() {
     InputStream stencilsetStream = this.getClass().getClassLoader().getResourceAsStream(""stencilset.json"");
     try {
-      return IOUtils.toString(stencilsetStream, ""utf-8"");
+      return IOUtils.toString(stencilsetStream);
     } catch (Exception e) {
       throw new ActivitiException(""Error while loading stencil set"", e);
     }",1
Fix spawn javadoc,"   void register(Object subscriber);
 
   /**
-   * Create a child Bus. Children provide no scoping with respect to posting events:
-   * any event posted to any undestroyed bus in the tree will be processed by all
-   * undestroyed buses. Children are useful because they are the only way to unregister
-   * subscribers.
+   * Create a child Bus.  All subscribers to a child bus will receive events sent to its ancestors.
+   * Events posted to a child bus will not be sent to subscribers of its ancestors.
    *
    * Must be called on the main thread.
    */",1
Fixed missing assignment of constructor arg (thanks @Lunatrius),"     public Configuration(File file, String configVersion)
     {
         this.file = file;
-        this.definedConfigVersion = configVersion;
         String basePath = ((File)(FMLInjectionData.data()[6])).getAbsolutePath().replace(File.separatorChar, '/').replace(""/."", """");
         String path = file.getAbsolutePath().replace(File.separatorChar, '/').replace(""/./"", ""/"").replace(basePath, """");
         if (PARENT != null)",1
fix race condition in RestApiTest shutdown: fixes flaky test in 5.0.x," 
   @Override
   public void stop() throws Exception {
-    super.stop();
     ksqlEngine.close();
     commandRunner.close();
     try {
@@ -176,6 +175,7 @@
     } catch (final InterruptedException exception) {
       log.error(""Interrupted while waiting for CommandRunner thread to complete"", exception);
     }
+    super.stop();
   }
 
   @Override",1
Fixed iterator(Order) return type,"     }
 
     /**
-     * Traverses this tree values in a specific {@link javaslang.collection.Tree.Order}.
+     * Traverses this tree in a specific {@link javaslang.collection.Tree.Order}.
      *
      * @param order A traversal order
      * @return A new Iterator
      */
-    default Iterator<T> iterator(Order order) {
-        return values(order).iterator();
+    default Iterator<Node<T>> iterator(Order order) {
+        return traverse(order).iterator();
     }
 
     /**",1
Fix NPE.," 
         GrantedAuthority[] r = new GrantedAuthority[roles==null ? 1 : roles.length+1];
         r[0] = SecurityRealm.AUTHENTICATED_AUTHORITY;
-        if (roles != null) {
-            for (int i = 1; i < roles.length; i++) {
+        for (int i = 1; i < r.length; i++) {
             r[i] = new GrantedAuthorityImpl(roles[i-1]);
         }
-        }
         return r;
     }
 ",1
Explain missing column type bug fix,"         {
             for (PlanFragmentId planFragmentId : node.getSourceFragmentIds()) {
                 PlanFragment target = fragmentsById.get().get(planFragmentId);
-                target.getRoot().accept(new Visitor(target.getSymbols(), fragmentsById), indent);
+                target.getRoot().accept(this, indent);
             }
             return null;
         }",1
Handle self-loop edges in CassandraInputFormat.," import com.thinkaurelius.titan.hadoop.formats.util.input.TitanHadoopSetup;
 import org.apache.tinkerpop.gremlin.structure.T;
 import org.apache.tinkerpop.gremlin.structure.Direction;
-import org.apache.tinkerpop.gremlin.structure.Vertex;
 import org.apache.tinkerpop.gremlin.structure.VertexProperty;
 import org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerEdge;
 import org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph;
@@ -22,7 +21,6 @@
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import java.util.Iterator;
 import java.util.NoSuchElementException;
 
 public class TitanVertexDeserializer implements AutoCloseable {
@@ -43,20 +41,6 @@
         this.idManager = setup.getIDManager();
     }
 
-    private static Boolean isLoopAdded(Vertex vertex, String label) {
-        Iterator<Vertex> adjacentVertices = vertex.vertices(Direction.BOTH, label);
-
-        while (adjacentVertices.hasNext()) {
-            Vertex adjacentVertex = adjacentVertices.next();
-
-            if(adjacentVertex.equals(vertex)){
-                return true;
-            }
-        }
-
-        return false;
-    }
-
     // Read a single row from the edgestore and create a TinkerVertex corresponding to the row
     // The neighboring vertices are represented by DetachedVertex instances
     public TinkerVertex readHadoopVertex(final StaticBuffer key, Iterable<Entry> entries) {
@@ -139,18 +123,14 @@
                     // Decode edge
                     TinkerEdge te;
 
-                    // We don't know the label of the other vertex, but one must be provided
-                    TinkerVertex adjacentVertex = getOrCreateVertex(relation.getOtherVertexId(), null, tg);
-
-                    // handle self-loop edges
-                    if (tv.equals(adjacentVertex) && isLoopAdded(tv, type.name())) {
-                        continue;
-                    }
-
                     if (relation.direction.equals(Direction.IN)) {
-                        te = (TinkerEdge)adjacentVertex.addEdge(type.name(), tv, T.id, relation.relationId);
+                        // We don't know the label of the other vertex, but one must be provided
+                        TinkerVertex outV = getOrCreateVertex(relation.getOtherVertexId(), null, tg);
+                        te = (TinkerEdge)outV.addEdge(type.name(), tv, T.id, relation.relationId);
                     } else if (relation.direction.equals(Direction.OUT)) {
-                        te = (TinkerEdge)tv.addEdge(type.name(), adjacentVertex, T.id, relation.relationId);
+                        // We don't know the label of the other vertex, but one must be provided
+                        TinkerVertex inV = getOrCreateVertex(relation.getOtherVertexId(), null, tg);
+                        te = (TinkerEdge)tv.addEdge(type.name(), inV, T.id, relation.relationId);
                     } else {
                         throw new RuntimeException(""Direction.BOTH is not supported"");
                     }",1
Fixes #819. fix-TokenStreamRewriter-doc-getText,"  * ...
  * rewriter.insertAfter(t, ""text to put after t"");}
  * rewriter.insertAfter(u, ""text after u"");}
- * System.out.println(rewriter.getText());
+ * System.out.println(rewriter.toString());
  * </pre>
  *
  * <p>
@@ -104,8 +104,8 @@
  * <pre>
  * rewriter.insertAfter(""pass1"", t, ""text to put after t"");}
  * rewriter.insertAfter(""pass2"", u, ""text after u"");}
- * System.out.println(rewriter.getText(""pass1""));
- * System.out.println(rewriter.getText(""pass2""));
+ * System.out.println(rewriter.toString(""pass1""));
+ * System.out.println(rewriter.toString(""pass2""));
  * </pre>
  *
  * <p>
@@ -371,13 +371,6 @@
 		return getText(DEFAULT_PROGRAM_NAME, Interval.of(0,tokens.size()-1));
 	}
 
-	/** Return the text from the original tokens altered per the
-	 *  instructions given to this rewriter in programName.
- 	 */
-	public String getText(String programName) {
-		return getText(programName, Interval.of(0,tokens.size()-1));
-	}
-
 	/** Return the text associated with the tokens in the interval from the
 	 *  original token stream but with the alterations given to this rewriter.
 	 *  The interval refers to the indexes in the original token stream.",1
Fix occasional exception while editing text,"     int wordStart = 0;
     int wordEnd = lineText.length();
 
-    int charPos = PApplet.constrain(offset - 1, 0, lineText.length() - 1);
-    char ch = lineText.charAt(charPos);
+    char ch = lineText.charAt(Math.max(0,offset - 1));
 
     CharacterKinds thisWord = CharacterKind(ch,noWordSep);
 ",1
fix bound,"      * @return The {@link ColorPreference} object itself.
      */
     public static UserColorPreferences randomize(Context c) {
-        @ColorRes int[] colorPos = RANDOM_COMBINATIONS[new Random().nextInt(RANDOM_COMBINATIONS.length)];
+        @ColorRes int[] colorPos = RANDOM_COMBINATIONS[new Random().nextInt(RANDOM_COMBINATIONS.length - 1)];
 
         return new UserColorPreferences(Utils.getColor(c, colorPos[0]), Utils.getColor(c, colorPos[0]),
                 Utils.getColor(c, colorPos[1]), Utils.getColor(c, colorPos[2]));",1
Fix the BaseBooleanFieldFacet3D," 
     @Override
     public void setWorld(Vector3i pos, boolean value) {
-        setWorld(pos.x, pos.y, pos.z, value);
+
     }
 
     @Override",1
Check to see if the structured content's id is null or an empty string," 
 import org.apache.commons.collections.CollectionUtils;
 import org.apache.commons.collections.MapUtils;
-import org.apache.commons.lang3.StringUtils;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.broadleafcommerce.cms.field.domain.FieldDefinition;
@@ -188,7 +187,7 @@
                     property.setIsDirty(true);
                 }
 
-                if (SupportedFieldType.ADDITIONAL_FOREIGN_KEY.equals(def.getFieldType()) && StringUtils.isNotEmpty(value)) {
+                if (SupportedFieldType.ADDITIONAL_FOREIGN_KEY.equals(def.getFieldType()) && value != null) {
                     // we need to look up the display value
                     String display = service.getForeignEntityName(def.getAdditionalForeignKeyClass(), value);
                     property.setDisplayValue(display);",1
Workaround serious throughput issue in Stetho's HTTP server,"         HttpParams params) throws IOException {
       init(socket.getOutputStream(), bufferSize, params);
     }
-
-    @Override
-    public void flush() throws IOException {
-      // Do not call through to super.flush() to fix a serious throughput issue due to a
-      // polling/sleep based implementation of LocalSocketImpl#flush.  This is apparently done to
-      // guarantee that after flush is called the write buffer has been fully drained but we don't
-      // need or expect this guarantee since our buffering strategy is entirely at the HTTP
-      // level.
-      flushBuffer();
-    }
   }
 }",1
Fix - Min date after current month,"         CalendarDay c = currentMonth;
         adapter.setRangeDates(min, max);
         currentMonth = c;
-        if (min != null) {
-            currentMonth = min.isAfter(currentMonth) ? min : currentMonth;
-        }
         int position = adapter.getIndexForDay(c);
         pager.setCurrentItem(position, false);
         updateUi();",1
Fix problem with running already finished actions by ParallelAction.," 		try {
 			Array<Action> actions = this.actions;
 			for (int i = 0, n = actions.size; i < n && actor != null; i++) {
-				Action currentAction = actions.get(i);
-				if (currentAction.getActor()!=null && !currentAction.act(delta))
-					complete = false;
+				if (!actions.get(i).act(delta)) complete = false;
 				if (actor == null) return true; // This action was removed.
 			}
 			return complete;",1
Documentation fix on response object," 
         result = result.withResizedFile(resized);
 
-        try (FileOutputStream fos = new FileOutputStream(result.resized))
+        FileOutputStream fos;
+        try
         {
-            bytes.writeTo(fos);
+            fos = new FileOutputStream(result.resized);
+            fos.write(bytes.toByteArray());
         }
         catch (IOException e)
         {",1
Fix null pointer for tests,"         @Override
         public void onServiceConnected(ComponentName name, IBinder service) {
             try {
-                if (service != null) {
                 queue.put(service);
-                }
             } catch (InterruptedException e) {
             }
         }",1
Compile error fix," 
             sb.append(""\t"");
             sb.append(method);
-            sb.append(""\theaders:"");
+            sb.append(""\theaders:""
             for (String name : headers.keySet()) {
                 sb.append(""\t"");
                 sb.append(name);
                 sb.append("":"");
                 sb.append(headers.getJoinedValue(name, "", ""));
             }
-            sb.append(""\tparams:"");
+            sb.append(""\tparams:""
             for (String name : params.keySet()) {
                 sb.append(""\t"");
                 sb.append(name);",1
Fix missing read timeout in RequestBuilder,"     this.file = prototype.getFile();
     this.followRedirect = prototype.getFollowRedirect();
     this.requestTimeout = prototype.getRequestTimeout();
-    this.readTimeout = prototype.getReadTimeout();
     this.rangeOffset = prototype.getRangeOffset();
     this.charset = prototype.getCharset();
     this.channelPoolPartitioning = prototype.getChannelPoolPartitioning();",1
Bugfix for #390,"                     } else {
                         setCursorToTextPosition(cursorPosition + 1);
                     }
-                    event.consume();
                 }
                 //move cursor up
                 else if (event.getKey() == Keyboard.KEY_UP && event.isDown()) {",1
fix #1086,"     			sql = sql.replaceFirst(""\\?"", ""NULL"");
     			continue;
     		}
-    		switch(paramType & 0xff) {
+    		switch(paramType) {
     		case Fields.FIELD_TYPE_TINY:
     			sql = sql.replaceFirst(""\\?"", String.valueOf(bindValue.byteBinding));
     			break;",1
Fixed typo," 	public void start() {
 		if( selectorthread != null )
 			throw new IllegalStateException( getClass().getName() + "" can only be started once."" );
-		new Thread( this ).start();
+		new Thread( this ).start();;
 	}
 
 	/**",1
Fixed problem #1110 Selecting non-duplicates during import doesn't work.," import org.eclipse.swt.widgets.Shell;
 import org.eclipse.swt.widgets.Table;
 import org.eclipse.swt.widgets.TableColumn;
-import org.eclipse.swt.widgets.TableItem;
 
 /**
  * Implements a dialog for the user to select a rule set to import
@@ -225,13 +224,16 @@
     
 	private void checkNonDupes() {
 
+		RuleSet rs = selectedRuleset();
+		if (rs == null) {
+			ruleTable.setCheckedElements(new Object[0]);
+			return;
+		}
+		
 		List<Rule> nonDupes = new ArrayList<Rule>();
 
-		for (TableItem item : ruleTable.getTable().getItems()) {
-			Rule rule = (Rule) item.getData();
-			if (dupeChecker.isDuplicate(rule)) {
-				continue;
-			}
+		for (Rule rule : rs.getRules()) {
+			if (dupeChecker.isDuplicate(rule)) continue;
 			nonDupes.add(rule);
 		}
 ",1
[BACKLOG-23276] fix for failing tests with npe,"         this.isDeprecated = true;
       }
     }
-    this.suggestedStep = registry.findPluginWithId( StepPluginType.class, this.stepid ) != null
-      ? registry.findPluginWithId( StepPluginType.class, this.stepid ).getSuggestedStep() : """";
+    this.suggestedStep = registry.findPluginWithId( StepPluginType.class, this.stepid ).getSuggestedStep();
   }
 
   public boolean isMissing() {",1
Kylin 3597 fix sonar issues,"             final ICuboidResultListener listener) throws IOException {
 
         long startTime = System.currentTimeMillis();
-        logger.info(""In Mem Cube Build2 start, {}"", cubeDesc.getName());
+        logger.info(""In Mem Cube Build2 start, "" + cubeDesc.getName());
 
         // build base cuboid
         buildBaseCuboid(input, listener);
@@ -172,8 +172,8 @@
         rootTask.join();
 
         long endTime = System.currentTimeMillis();
-        logger.info(""In Mem Cube Build2 end, {}, takes {} ms"", cubeDesc.getName(), (endTime - startTime));
-        logger.info(""total CuboidResult count: {}"", resultCollector.getAllResult().size());
+        logger.info(""In Mem Cube Build2 end, "" + cubeDesc.getName() + "", takes "" + (endTime - startTime) + "" ms"");
+        logger.info(""total CuboidResult count:"" + resultCollector.getAllResult().size());
         return resultCollector.getAllResult();
     }
 
@@ -263,26 +263,26 @@
 
     private void makeMemoryBudget() {
         int systemAvailMB = MemoryBudgetController.gcAndGetSystemAvailMB();
-        logger.info(""System avail {} MB"", systemAvailMB);
+        logger.info(""System avail "" + systemAvailMB + "" MB"");
         int reserve = reserveMemoryMB;
-        logger.info(""Reserve {} MB for system basics"", reserve);
+        logger.info(""Reserve "" + reserve + "" MB for system basics"");
 
         int budget = systemAvailMB - reserve;
         if (budget < baseResult.aggrCacheMB) {
             // make sure we have base aggr cache as minimal
             budget = baseResult.aggrCacheMB;
-            logger.warn(
-                    ""System avail memory ({} MB) is less than base aggr cache ({} MB) + minimal reservation ({} MB), consider increase JVM heap -Xmx"",
-                    systemAvailMB, baseResult.aggrCacheMB, reserve);
+            logger.warn(""System avail memory ("" + systemAvailMB + "" MB) is less than base aggr cache (""
+                    + baseResult.aggrCacheMB + "" MB) + minimal reservation ("" + reserve
+                    + "" MB), consider increase JVM heap -Xmx"");
         }
 
-        logger.info(""Memory Budget is {} MB"", budget);
+        logger.info(""Memory Budget is "" + budget + "" MB"");
         memBudget = new MemoryBudgetController(budget);
     }
 
     private <T> CuboidResult createBaseCuboid(RecordConsumeBlockingQueueController<T> input,
             MemoryBudgetController.MemoryWaterLevel baseCuboidMemTracker) throws IOException {
-        logger.info(""Calculating base cuboid {}"", baseCuboidId);
+        logger.info(""Calculating base cuboid "" + baseCuboidId);
 
         Stopwatch sw = new Stopwatch();
         sw.start();
@@ -295,7 +295,7 @@
         GTScanRequest req = new GTScanRequestBuilder().setInfo(baseCuboid.getInfo()).setRanges(null).setDimensions(null)
                 .setAggrGroupBy(dimensionMetricsBitSet.getFirst()).setAggrMetrics(dimensionMetricsBitSet.getSecond())
                 .setAggrMetricsFuncs(metricsAggrFuncs).setFilterPushDown(null).createGTScanRequest();
-        try (GTAggregateScanner aggregationScanner = new GTAggregateScanner(baseInput, req)) {
+        GTAggregateScanner aggregationScanner = new GTAggregateScanner(baseInput, req);
         aggregationScanner.trackMemoryLevel(baseCuboidMemTracker);
 
         int count = 0;
@@ -306,20 +306,19 @@
             baseBuilder.write(r);
             count++;
         }
-
+        aggregationScanner.close();
         baseBuilder.close();
 
         sw.stop();
-            logger.info(""Cuboid {} has {} rows, build takes {}ms"", baseCuboidId, count, sw.elapsedMillis());
+        logger.info(""Cuboid "" + baseCuboidId + "" has "" + count + "" rows, build takes "" + sw.elapsedMillis() + ""ms"");
 
         int mbEstimateBaseAggrCache = (int) (aggregationScanner.getEstimateSizeOfAggrCache()
                 / MemoryBudgetController.ONE_MB);
-            logger.info(""Wild estimate of base aggr cache is {} MB"", mbEstimateBaseAggrCache);
+        logger.info(""Wild estimate of base aggr cache is "" + mbEstimateBaseAggrCache + "" MB"");
 
         return updateCuboidResult(baseCuboidId, baseCuboid, count, sw.elapsedMillis(), 0,
                 input.inputConverterUnit.ifChange());
     }
-    }
 
     private CuboidResult updateCuboidResult(long cuboidId, GridTable table, int nRows, long timeSpent,
             int aggrCacheMB) {
@@ -365,7 +364,7 @@
                 aggrMask[i] = !measureDescs[i].getFunction().getMeasureType().onlyAggrInBaseCuboid();
 
                 if (!aggrMask[i]) {
-                    logger.info(""{} doesn't need aggregation."", measureDescs[i]);
+                    logger.info(measureDescs[i].toString() + "" doesn't need aggregation."");
                 }
             }
             scanner.setAggrMask(aggrMask);
@@ -378,7 +377,7 @@
             long cuboidId, ImmutableBitSet aggregationColumns, ImmutableBitSet measureColumns) throws IOException {
         Stopwatch sw = new Stopwatch();
         sw.start();
-        logger.info(""Calculating cuboid {}"", cuboidId);
+        logger.info(""Calculating cuboid "" + cuboidId);
 
         GTAggregateScanner scanner = prepareGTAggregationScanner(gridTable, parentId, cuboidId, aggregationColumns,
                 measureColumns);
@@ -402,7 +401,7 @@
             builder.close();
         }
         sw.stop();
-        logger.info(""Cuboid {} has {} rows, build takes {}ms"", cuboidId, count, sw.elapsedMillis());
+        logger.info(""Cuboid "" + cuboidId + "" has "" + count + "" rows, build takes "" + sw.elapsedMillis() + ""ms"");
 
         return updateCuboidResult(cuboidId, newGridTable, count, sw.elapsedMillis(), 0);
     }",1
Truncate debug display of player position to 2 decimals,"  */
 package org.terasology.rendering.gui.windows;
 
-import java.util.Locale;
-
 import org.terasology.asset.Assets;
 import org.terasology.config.Config;
 import org.terasology.engine.CoreRegistry;
@@ -38,7 +36,6 @@
 import org.terasology.world.WorldProvider;
 
 import javax.vecmath.Vector2f;
-import javax.vecmath.Vector3f;
 import javax.vecmath.Vector4f;
 
 /**
@@ -224,9 +221,7 @@
             if (entityManager != null) {
                 debugLine2.setText(String.format(""Active Entities: %s, Current Target: %s"", entityManager.getActiveEntityCount(), cameraTarget.toString()));
             }
-            Vector3f pos = CoreRegistry.get(LocalPlayer.class).getPosition();
-            float yaw = (character != null) ? character.yaw : 0;
-            debugLine3.setText(String.format(Locale.US, ""Pos (%.2f, %.2f, %.2f), Yaw %.2f"", pos.x, pos.y, pos.z, yaw));
+            debugLine3.setText(String.format(""%s, %.2f"", CoreRegistry.get(LocalPlayer.class).getPosition(), (character != null) ? character.yaw : 0));
             debugLine4.setText(String.format(""total vus: %s | active threads: %s | worldTime: %.2f"",
                     ChunkTessellator.getVertexArrayUpdateCount(), CoreRegistry.get(GameEngine.class).getActiveTaskCount(),
                     CoreRegistry.get(WorldProvider.class).getTime().getDays()));",1
Fix SMS warning message,"      */
     public boolean sms(final String from, final String to, final String text) {
         if (!isSmsSenderDefined() || StringUtils.isBlank(text) || StringUtils.isBlank(from)) {
-            LOGGER.warn(""Could not send SMS to [{}] because either no from/text is found or SMS settings are not configured."", to);
+            LOGGER.warn(""Could not send email to [{}] because either no address/subject/text is found or email settings are not configured."", to);
             return false;
         }
         return this.smsSender.send(from, to, text);",1
Fix WikiPlugin Crash," 				return;
 			}
 			children[0] = null;
-
-			onDeselect();
-			client.setSpellSelected(false);
 		});
 	}
 
@@ -189,11 +186,8 @@
 	private void onDeselect()
 	{
 		wikiSelected = false;
-		if (icon != null)
-		{
 		icon.setSpriteId(WikiSprite.WIKI_ICON.getSpriteId());
 	}
-	}
 
 	@Subscribe
 	private void onMenuOptionClicked(MenuOptionClicked ev)",1
Drop debugging code from UPCEWriter,"       (7 * 6) + // bars
       6; // end guard
 
+  public static void main(String[] args) throws Exception {
+    BitMatrix bm = new UPCEWriter().encode(""12345670"", BarcodeFormat.UPC_E, 200, 100, null);
+    System.out.println(bm);
+  }
+
   @Override
   public BitMatrix encode(String contents,
                           BarcodeFormat format,",1
Fix the measure bug,"                 break;
             case MeasureSpec.AT_MOST:
             case MeasureSpec.UNSPECIFIED:
-                if (mCircleCount <= 0) {
-                    result = getPaddingLeft() + getPaddingRight();
-                } else {
                 result = (mCircleCount - 1) * mMinRadius * 2 + mMaxRadius * 2 + (mCircleCount - 1) * mCircleSpacing + getPaddingLeft() + getPaddingRight();
-                }
                 break;
             default:
                 break;
@@ -213,7 +209,7 @@
     @Override
     public void notifyDataSetChanged() {
         prepareCirclePoints();
-        requestLayout();
+        invalidate();
     }
 
     @Override",1
Fix typo in Scrypt Javadoc: `costParam` -> `blockSize`," 	 * 
 	 * @param passphrase The passphrase
 	 * @param salt Salt, ideally randomly generated
-	 * @param costParam Cost parameter <code>N</code>, larger than 1, a power of 2 and less than <code>2^(128 * blockSize / 8)</code>
+	 * @param costParam Cost parameter <code>N</code>, larger than 1, a power of 2 and less than <code>2^(128 * costParam / 8)</code>
 	 * @param blockSize Block size <code>r</code>
 	 * @param keyLengthInBytes Key output length <code>dkLen</code>
 	 * @return Derived key",1
Fix HttpRequest.followRedirects use of static setter,"    * @return this request
    */
   public HttpRequest followRedirects(final boolean followRedirects) {
-    getConnection().setInstanceFollowRedirects(followRedirects);
+    getConnection().setFollowRedirects(followRedirects);
     return this;
   }
 }",1
iOS Bugfix: playing music files that are not in the assets folder!," 		verify(fileHandle);
 
 		// create audio player - from file path
-		String path = fileHandle.file().getPath().replace('\\', '/');
 		NSError[] error = new NSError[1];
-		AVAudioPlayer player = AVAudioPlayer.FromUrl(NSUrl.FromFilename(path), error);
+		AVAudioPlayer player = AVAudioPlayer.FromUrl(NSUrl.FromFilename(fileHandle.path()), error);
 		if (error[0] == null) {
 			// no error: return the music object
 			return new IOSMusic(player);
 		} else {
 			// throw an exception
-			throw new GdxRuntimeException(""Error opening music file at "" + path + "": "" + error[0].ToString());
+			throw new GdxRuntimeException(""Error opening music file at "" + fileHandle.path() + "": "" + error[0].ToString());
 		}
 	}
 }",1
KEYCLOAK-8035 Fix failing GitLab Social Login test,"         catch (NoSuchElementException e) {
             // already logged in
         }
-
-        try {
         authorizeButton.click();
     }
-        catch (NoSuchElementException e) {
-            // might not be necessary
-        }
-    }
 }",1
service startup scan fix," import android.graphics.Color;
 import android.net.Uri;
 import android.os.Build;
-import android.os.Handler;
 import android.os.IBinder;
 import android.os.PowerManager;
 import android.support.v4.app.NotificationCompat;
@@ -91,15 +90,6 @@
       Log.d(TAG, ""onScanFailed  "" + ""errorCode: "" + errorCode);
     }
   };
-  private Runnable mFirstUriBeaconScanTimeout = new Runnable() {
-    @Override
-    public void run() {
-      // Stop low latency scanning
-      getLeScanner().stopScan(mScanCallback);
-      // Start low power scanning
-      startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_POWER);
-    }
-  };
   private static final String NOTIFICATION_GROUP_KEY = ""URI_BEACON_NOTIFICATIONS"";
   private static final int NEAREST_BEACON_NOTIFICATION_ID = 23;
   private static final int SECOND_NEAREST_BEACON_NOTIFICATION_ID = 24;
@@ -108,7 +98,6 @@
   private static final int NON_LOLLIPOP_NOTIFICATION_TITLE_COLOR = Color.parseColor(""#ffffff"");
   private static final int NON_LOLLIPOP_NOTIFICATION_URL_COLOR = Color.parseColor(""#999999"");
   private static final int NON_LOLLIPOP_NOTIFICATION_SNIPPET_COLOR = Color.parseColor(""#999999"");
-  private static final long DURATION_FIRST_URI_BEACON_SCAN = TimeUnit.SECONDS.toMillis(2);
   private ScreenBroadcastReceiver mScreenStateBroadcastReceiver;
   private RegionResolver mRegionResolver;
   private NotificationManagerCompat mNotificationManager;
@@ -116,7 +105,6 @@
   private List<String> mSortedDevices;
   private HashMap<String, String> mDeviceAddressToUrl;
   private MdnsUrlDiscoverer mMdnsUrlDiscoverer;
-  private Handler mHandler;
   private Comparator<String> mComparator = new Comparator<String>() {
     @Override
     public int compare(String address, String otherAddress) {
@@ -152,19 +140,16 @@
   }
 
   private void initialize() {
-    mHandler = new Handler();
     mNotificationManager = NotificationManagerCompat.from(this);
     mMdnsUrlDiscoverer = new MdnsUrlDiscoverer(this, UriBeaconDiscoveryService.this);
     initializeScreenStateBroadcastReceiver();
   }
-
   private void initializeLists() {
     mRegionResolver = new RegionResolver();
     mUrlToUrlMetadata = new HashMap<>();
     mSortedDevices = null;
     mDeviceAddressToUrl = new HashMap<>();
   }
-
   /**
    * Create the broadcast receiver that will listen
    * for screen on/off events
@@ -194,10 +179,7 @@
     // Start scanning only if the screen is on
     PowerManager powerManager = (PowerManager) getSystemService(Context.POWER_SERVICE);
     if (powerManager.isScreenOn()) {
-      // Start a brief low latency scan
-      startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_LATENCY);
-      mHandler.postDelayed(mFirstUriBeaconScanTimeout, DURATION_FIRST_URI_BEACON_SCAN);
-      // Start mdns discovery
+      startSearchingForUriBeacons();
       mMdnsUrlDiscoverer.startScanning();
     }
 
@@ -214,8 +196,7 @@
   @Override
   public void onDestroy() {
     Log.d(TAG, ""onDestroy:  service exiting"");
-    getLeScanner().stopScan(mScanCallback);
-    mHandler.removeCallbacks(mFirstUriBeaconScanTimeout);
+    stopSearchingForUriBeacons();
     mMdnsUrlDiscoverer.stopScanning();
     unregisterReceiver(mScreenStateBroadcastReceiver);
     mNotificationManager.cancelAll();
@@ -251,10 +232,10 @@
     }
   }
 
-  private void startUriBeaconScan(int scanMode) {
+  private void startSearchingForUriBeacons() {
     ScanSettings settings = new ScanSettings.Builder()
         .setCallbackType(ScanSettings.CALLBACK_TYPE_ALL_MATCHES)
-        .setScanMode(scanMode)
+        .setScanMode(ScanSettings.SCAN_MODE_LOW_POWER)
         .build();
 
     List<ScanFilter> filters = new ArrayList<>();
@@ -267,7 +248,12 @@
 
     filters.add(filter);
 
-    getLeScanner().startScan(filters, settings, mScanCallback);
+    boolean started = getLeScanner().startScan(filters, settings, mScanCallback);
+    Log.v(TAG, started ? ""... scan started"" : ""... scan NOT started"");
+  }
+
+  private void stopSearchingForUriBeacons() {
+    getLeScanner().stopScan(mScanCallback);
   }
 
   private void handleFoundDevice(ScanResult scanResult) {
@@ -493,15 +479,10 @@
       initializeLists();
       mNotificationManager.cancelAll();
       if (isScreenOn) {
-        // Start a brief low latency scan
-        startUriBeaconScan(ScanSettings.SCAN_MODE_LOW_LATENCY);
-        mHandler.postDelayed(mFirstUriBeaconScanTimeout, DURATION_FIRST_URI_BEACON_SCAN);
-        // Start mdns discovery
+        startSearchingForUriBeacons();
         mMdnsUrlDiscoverer.startScanning();
       } else {
-        // Stop all scanning and service discovery
-        getLeScanner().stopScan(mScanCallback);
-        mHandler.removeCallbacks(mFirstUriBeaconScanTimeout);
+        stopSearchingForUriBeacons();
         mMdnsUrlDiscoverer.stopScanning();
       }
     }",1
Fix forge:default-block transformation.,"                             builder.put(TransformType.THIRD_PERSON_RIGHT_HAND, thirdperson);
                             builder.put(TransformType.THIRD_PERSON_LEFT_HAND,  leftify(thirdperson));
                             builder.put(TransformType.FIRST_PERSON_RIGHT_HAND, get(0, 0, 0, 0, 45, 0, 0.4f));
-                            builder.put(TransformType.FIRST_PERSON_LEFT_HAND,  get(0, 0, 0, 0, 225, 0, 0.4f));
+                            builder.put(TransformType.FIRST_PERSON_LEFT_HAND,  get(0, 0, 0, 0, 255, 0, 0.4f));
                             ret.state = Optional.<IModelState>of(new SimpleModelState(builder.build()));
                         }
                         // item/generated",1
Fix another small mistake in the message regarding missing error View," 
     if (errorView == null) {
       throw new NullPointerException(
-          ""Error view is null! Have you specified an error view in your layout xml file?""
+          ""Error view is null! Have you specified a content view in your layout xml file?""
               + "" You have to give your error View the id R.id.errorView"");
     }
 ",1
Fixed issue #233. Exception on some devices when we use default videoCodec.,"         mMediaRecorder.setOutputFormat(profile.fileFormat);
         mMediaRecorder.setVideoFrameRate(profile.videoFrameRate);
         mMediaRecorder.setVideoSize(profile.videoFrameWidth, profile.videoFrameHeight);
-        if (mVideoCodec == VideoCodec.DEFAULT) {
-            mMediaRecorder.setVideoEncoder(profile.videoCodec);
-        } else {
         mMediaRecorder.setVideoEncoder(mMapper.map(mVideoCodec));
-        }
         mMediaRecorder.setVideoEncodingBitRate(profile.videoBitRate);
         if (mAudio == Audio.ON) {
             mMediaRecorder.setAudioChannels(profile.audioChannels);",1
Fixed boolean literals in Derby versions 10.7+,"     public DerbyTenSevenDialect() {
          registerColumnType( Types.BOOLEAN, ""boolean"" );
     }
-
-    public String toBooleanValueString(boolean bool) {
-        return String.valueOf(bool);
-    }
 }",1
Fix for ACT-4263," 
         // TODO!
         execution.destroy();
-		
-		// GDH - fix for ACT-4263
-		List<JobEntity> jobs = (List) Context.getCommandContext()
-		          .getJobEntityManager()
-		          .findJobsByExecutionId(execution.getId());
-		for (Job job: jobs) {
-		    ((JobEntity) job).delete();
-		}		
         propagatingExecution = execution;
         
       } else {",1
fix stack overflow in nd4j buffer," 
     @Override
     public Pointer pointer() {
-        return underlyingDataBuffer() != null  && underlyingDataBuffer() != this ? underlyingDataBuffer().pointer() : pointer;
+        return underlyingDataBuffer() != null ? underlyingDataBuffer().pointer() : pointer;
     }
 
     @Override",1
Create global cluster marker for standalone pulsar,"         // Create a sample namespace
         URL webServiceUrl = new URL(
                 String.format(""http://%s:%d"", config.getAdvertisedAddress(), config.getWebServicePort()));
-        final String brokerServiceUrl = String.format(""pulsar://%s:%d"", config.getAdvertisedAddress(),
+        String brokerServiceUrl = String.format(""pulsar://%s:%d"", config.getAdvertisedAddress(),
                 config.getBrokerServicePort());
         admin = new PulsarAdmin(webServiceUrl, config.getBrokerClientAuthenticationPlugin(),
                 config.getBrokerClientAuthenticationParameters());
-        final String property = ""sample"";
-        final String cluster = config.getClusterName();
-        final String globalCluster = ""global"";
-        final String namespace = property + ""/"" + cluster + ""/ns1"";
+        String property = ""sample"";
+        String cluster = config.getClusterName();
+        String namespace = property + ""/"" + cluster + ""/ns1"";
         try {
             ClusterData clusterData = new ClusterData(webServiceUrl.toString(), null /* serviceUrlTls */,
                     brokerServiceUrl, null /* brokerServiceUrlTls */);
@@ -183,11 +182,6 @@
                 admin.clusters().updateCluster(cluster, clusterData);
             }
 
-            // Create marker for ""global"" cluster
-            if (!admin.clusters().getClusters().contains(globalCluster)) {
-                admin.clusters().createCluster(globalCluster, new ClusterData(null, null));
-            }
-
             if (!admin.properties().getProperties().contains(property)) {
                 admin.properties().createProperty(property,
                         new PropertyAdmin(Lists.newArrayList(config.getSuperUserRoles()), Sets.newHashSet(cluster)));",1
Added debug and info log messages that I found missing.,"             digestString(md, securityKey);
             ssalt = md.digest();
         }
-
-        UndertowLogger.ROOT_LOGGER.infof(""Undertow starts mod_cluster proxy advertisements on %s with frequency %d ms."", address, config.getAdvertiseFrequency());
     }
 
     private static final String CRLF = ""\r\n"";
@@ -161,10 +159,9 @@
 
             final String payload = builder.toString();
             final ByteBuffer byteBuffer = ByteBuffer.wrap(payload.getBytes());
-            UndertowLogger.ROOT_LOGGER.debugf(""Gonna send payload: \n%s"", payload);
             channel.sendTo(address, byteBuffer);
         } catch (Exception e) {
-            UndertowLogger.ROOT_LOGGER.errorf(e, ""Cannot send advertise message. address: %s"", address);
+            UndertowLogger.ROOT_LOGGER.errorf(e, ""Cannot send advertise message"");
         }
     }
 ",1
fixing lint: LongLogTag," 
 public class AccountAuthenticator extends AbstractAccountAuthenticator {
 
-    private static final String TAG = ""GHAccountAuthenticator"";
+    private static final String TAG = ""GitHubAccountAuthenticator"";
 
     private static final List<String> SCOPES = Arrays.asList(""repo"", ""user"", ""gist"");
 ",1
Fix compilation issue with Eclipse APT implementation,"      */
     public AnnotationMetadata build(T element) {
         DefaultAnnotationMetadata annotationMetadata = new DefaultAnnotationMetadata();
-
-        try {
         AnnotationMetadata metadata = buildInternal(null, element, annotationMetadata, true);
         if (metadata.isEmpty()) {
             return AnnotationMetadata.EMPTY_METADATA;
         }
         return metadata;
-        } catch(RuntimeException e) {
-            if(""org.eclipse.jdt.internal.compiler.problem.AbortCompilation"".equals(e.getClass().getName())) {
-                // workaround for a bug in the Eclipse APT implementation. See bug 541466 on their Bugzilla.
-                return AnnotationMetadata.EMPTY_METADATA;
-            } else {
-                throw e;
-            }
-        }
     }
 
     /**",1
fix wrong value assigned to EventPadding from xml,"             mTodayHeaderTextColor = a.getColor(R.styleable.WeekView_todayHeaderTextColor, mTodayHeaderTextColor);
             mEventTextSize = a.getDimensionPixelSize(R.styleable.WeekView_eventTextSize, (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, mEventTextSize, context.getResources().getDisplayMetrics()));
             mEventTextColor = a.getColor(R.styleable.WeekView_eventTextColor, mEventTextColor);
-            mEventPadding = a.getDimensionPixelSize(R.styleable.WeekView_eventPadding, mEventPadding);
+            mEventPadding = a.getDimensionPixelSize(R.styleable.WeekView_hourSeparatorHeight, mEventPadding);
             mHeaderColumnBackgroundColor = a.getColor(R.styleable.WeekView_headerColumnBackground, mHeaderColumnBackgroundColor);
             mDayNameLength = a.getInteger(R.styleable.WeekView_dayNameLength, mDayNameLength);
             mOverlappingEventGap = a.getDimensionPixelSize(R.styleable.WeekView_overlappingEventGap, mOverlappingEventGap);",1
Instantiate exception only when required," 
     @SuppressWarnings(""WeakerAccess"")
     <T> T convertFromJSON(String json, Class<T> tClazz) throws JWTDecodeException {
+        JWTDecodeException exception = new JWTDecodeException(String.format(""The string '%s' doesn't have a valid JSON format."", json));
         if (json == null) {
-            throw exceptionForInvalidJson(null);
+            throw exception;
         }
         try {
             return mapper.readValue(json, tClazz);
         } catch (IOException e) {
-            throw exceptionForInvalidJson(json);
+            throw exception;
         }
     }
-
-    private JWTDecodeException exceptionForInvalidJson(String json) {
-        return new JWTDecodeException(String.format(""The string '%s' doesn't have a valid JSON format."", json));
-    }
 }",1
"fix md2 models orientation, change from read xzy fromat to xyz format "," 
 		for (int i = 0; i < mHeader.numFrames; i++) {
 			float scaleX = is.readFloat();
+			float scaleZ = is.readFloat();
 			float scaleY = is.readFloat();
-			float scaleZ = is.readFloat();
 			float translateX = is.readFloat();
+			float translateZ = is.readFloat();
 			float translateY = is.readFloat();
-			float translateZ = is.readFloat();
 			String name = is.readString(16);
 			IAnimationFrame frame = mFrames.get(i);
 
@@ -225,8 +225,8 @@
 
 			for (int j = 0; j < mHeader.numVerts; j++) {
 				vertices[index + 0] = scaleX * is.readUnsignedByte() + translateX;
-				vertices[index + 1] = scaleY * is.readUnsignedByte() + translateZ;
-				vertices[index + 2] = scaleZ * is.readUnsignedByte() + translateY;
+				vertices[index + 2] = scaleZ * is.readUnsignedByte() + translateZ;
+				vertices[index + 1] = scaleY * is.readUnsignedByte() + translateY;
 				index += 3;
 				is.readUnsignedByte();
 ",1
